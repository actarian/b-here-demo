/*! AgoraRTC|BUILD v3.5.2-0-g0d49ed1 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("AgoraRTC",[],e):"object"==typeof exports?exports.AgoraRTC=e():t.AgoraRTC=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=92)}([function(t,e,n){"use strict";n.r(e);var r,i=n(11),o=n.n(i),a=function(){var t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()},s=n(14),c=n(3),u=n(1),l=n(45),d=n.n(l),h=n(46),f=n.n(h),p=new Array(32).fill(void 0);function v(t){return p[t]}p.push(void 0,null,!0,!1);var m=p.length;function g(t){var e=v(t);return function(t){t<36||(p[t]=m,m=t)}(t),e}var A=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});A.decode();var y=null;function b(){return null!==y&&y.buffer===r.memory.buffer||(y=new Uint8Array(r.memory.buffer)),y}function w(t,e){return A.decode(b().subarray(t,t+e))}function E(t){m===p.length&&p.push(p.length+1);var e=m;return m=p[e],p[e]=t,e}var _=0,S=new TextEncoder("utf-8"),T="function"==typeof S.encodeInto?function(t,e){return S.encodeInto(t,e)}:function(t,e){var n=S.encode(t);return e.set(n),{read:t.length,written:n.length}},C=null;function x(){return null!==C&&C.buffer===r.memory.buffer||(C=new Int32Array(r.memory.buffer)),C}var R,I=function(){function t(){d()(this,t)}return f()(t,[{key:"free",value:function(){var t=this.ptr;this.ptr=0,r.__wbg_signmanager_free(t)}},{key:"get_digest",value:function(t){return g(r.signmanager_get_digest(this.ptr,E(t)))}}],[{key:"__wrap",value:function(e){var n=Object.create(t.prototype);return n.ptr=e,n}},{key:"new",value:function(){var e=r.signmanager_new();return t.__wrap(e)}}]),t}(),O=!1,M=null,L=0,k="free",B=[],N=[],P=0;(M?Promise.resolve(M):new Promise((function(t){O||r||function t(){var e={wbg:{}};e.wbg.__wbindgen_object_drop_ref=function(t){g(t)},e.wbg.__wbindgen_string_new=function(t,e){return E(w(t,e))},e.wbg.__wbindgen_string_get=function(t,e){var n=v(e),i="string"==typeof n?n:void 0,o=null==i?0:function(t,e,n){if(void 0===n){var r=S.encode(t),i=e(r.length);return b().subarray(i,i+r.length).set(r),_=r.length,i}for(var o=t.length,a=(i=e(o),b()),s=0;s<o;s++){var c=t.charCodeAt(s);if(c>127)break;a[i+s]=c}if(s!==o){0!==s&&(t=t.slice(s)),i=n(i,o,o=s+3*t.length);var u=b().subarray(i+s,i+o);s+=T(t,u).written}return _=s,i}(i,r.__wbindgen_malloc,r.__wbindgen_realloc),a=_;x()[t/4+1]=a,x()[t/4+0]=o},e.wbg.__wbindgen_throw=function(t,e){throw new Error(w(t,e))};for(var n=Uint8Array.from(atob("55ZBgM/2Bzm2JGhNn//ljJsSorhWUYE66a1Hf8O7pfQGR2zfol8qRP6CDhsi3iG7nFZu9stSyPq/qu2Rr2w8QkTGP6Gm2cg3J5qsQgq5bcHA9mDpGv/b24uEwsixZVl1eGkdV4SB/6ayw2v48hLmNA+w5UlnTCiWwerzESQPidpSUMbamXL3pU815EQm12GhhZ9aWzo568gdZvXevBc/WHfFKQSuTgWva4e4eSmW7UxpH8sY4HlDsCTMu0WwEB8B95XsZwOp3GLgfOQmJBw036DgIKU+XGn4KpIEq77WE/h6R7sZKsFUp+u+2cDnW7IPNe7xfd9areFo0EUh0/9K9CqxUkLqMB5hlgS1fwQHRzKPhQ7gALyc6HwMCPooS0M1NrzjdfH3vUn0PeQ1GBlnrnXgiu8TunfHg5TcbBfPEbxbyiiow1Np+VEBlHNh00PiAWyu024NHaPbDGfMtzu4WF02fgkh8Pxb7bCSpCZndjTytQgAzfZxk2bbe6NoHHFnsviqYzHVpxoPEk7icHRWcZC28d2muthq673KCMQay1fJcPqSTuYhWUZS5eylIguT33lP+TBbOWQI8KtCzBN5FzqILfKzRkzrJ3L192BUF8SILdwmriv10HU9ZlQAyQA1VdegnzOl/dYk2GGsB3724y7w/7aJLHJzEfwrfIzFd5CoAft7ct+zQW2G4Wm2kpoz6uJfgrNyykQgwCO6pkPy1ADrBUuJon9ySjhgcFru6AKa99wTlIhzBw3FKFt9Aa1/1KWWy7W1wAIGzRTs/7rLXRkKFjNqGVXBdoVNTpHFtfEFsuX0X98ISr0Bennlx0h2Yl/CGNb5Kc7i3bio1XJHX24avcMsEAwfdfskCki4/dkStn7QC97YJC3z+7gD84IiEEeGcnn7gHJyeALr0ssbqDUcKqxEyheyFs9FToJziLB+eYw6nMQLmYTrQyrg3b+3YBdgx7pzNEDSyz3tmaPaikwcLSyB/Igo6U/oP/fS2TZLtmN03m4iS76YrDJAgI+2W1GboabuixVcLdxm6SQ4CzUnHSPl1knhcGhW/+OcKa53tB5j5C4wEpiENv6T9PUu4K0YwtEAqFbd/eN2wVAYCKn/nlVA8uiESxCfgs0411mRFk4i1pixJLPP5AFPG9QFZnj6X19TqmhmIhl8D6Q1rOvPCqPZV/z04HjayX4qPzPzP/5NVilN/sHhQe7ulriGmU/3rj5QEuiOymsL7EdCQMc/4mXDPdVrDBfbt6dnv11oLYGmqOP1oSBj02FtsmYrMn9pRg7HJoCh86jAnzuOYn4tGnQ4gw/89sb64NAXcoIbTIjyiHBAQCCK2Yn4I/fNF10rkQlvSvkpqLG2eYpJmpWrcouNDEUtJFR607oNraLdmUKyLc1g7SNpS+ofp1FL6rua/HFSrb5kTF2Vcy2gl+6MACbFRChKoP/un7IbYJuOima/JWFZcs/MXokIx+ijuqjMtVKaYRTzNI5ncPa2y/EXTNdUUFpMhbE7sa39Uoh6Hci/viXy2KFTNbiw+BkWOPnyOr04LjIYKlJ8ud/KvjuvNUGQOHJvj6tpZJxj97tr0OrgZCAxSHGU5JQfqEd/U0QfzGM8Wh3zdsnd9LhoIIRJAtyA2PmjwJk4zTxeYlgwPqAVTU3+9bA1QD+jLZZ3Ffk3MRq+Ar2RT8YN6ASR4bItt3omBj0LJe0zeGY3OzfhljL6LA1m4+IUp+CzeWo0aEjnvRk3iCJeajgdC+NUGB5qh8PWKtBeC58woavnRjvRNphXS4b9M7Aymcfq26B2YY2lS+wLf763OnGJlVdV/srgyAUJJZjarxom4zrYy23kLFB8zFzWuwSMue5Xm1YWape91JGDuRLIctrJWU47/XfLm6Zgei4xOwq1RcjikGuaZtDwcFg9aKtO+JOGJsCjy9AiPnmt+rmdX83GsT3KtTETnLv6ZQcnGtmt4H8AjFgGYePdQc40cj8VAOV8NCLspyW5w63b3g37GXJrzjm9Fym3fh27psjo5RuTs7XCSrNENxKm9jCcXPqWxyuXJSn6dhdWnw5SAnUjixXviWS4HsnYjw4Xt4cSwkqCB9naLstVXt5D2HgG4fzHFNHvnETft0mrhU81IBDTSyNFdDvFEX8cifoc6FcNq7pzXlotl2ZS1FIzNXddZrdXpBNYZPV52gtCok6ePpUR/Y8jyJpE9P3q8dmFVivVGgmKTcBKMDDbzeOfl4MpOGBtBX/Lab/kzqG42sTyOyGUyOoFXYGMUWJ33GPI2KNa/mW8zVl+imshfbj7PiK1qRUn74KjAkH4wjKnu50AONYUaiveSdwnEc1zCjZSJ3dmBKSxhWAcO2PdHBg5m9+JCiPGCVfK9dzoM8Bm7xx9noJiqt4hNiVa5di1Fd1JRN4rnd1DbKglKpAVSoqvJPxmuyH56TFE4BQjhfKbDMZezQJqx+KXDiW1JWGeDYaPVBWPYeZX6STIzC/DjS7UFlqoKgGGAGP17x8wmMRE6O/axG5jDzloCGxCmrymT0ZGCh4g54O1iDYUtmJr7Bo1d+H9RQj2Y10BxcMkLFTIZVjm9e3vtIbeRx0OdXE1Ou37J/WeJZyPXn1fszvp/KonCqVnt862LrxfoB/0sF5gk4Y/f6LVneU5hun9/V1OVre9XrnDBhcVaQa9Ye6gs8sHW9HCNchaFbkUpxSiyxVEFZIlbejbjSPFlkYOLhtQHduwZWRHWA9akqykJNG3PKvOZAaJG5nWQq8+e4K0JF/AXTKIIr4J7zDt8ZR4xb9T2gxjl1nfqzidMRIY5B4rkw0oetta+j8rqkFpTEGA+hU/tw7bDtpkPYvCguwncnCjwULNFT9I9jXx3H4Ws3WWMCit29F7kGq2Ka+rU/MjnuP0lsXkoB1rr8LawHH5gaf8rajq/BhKrGTIfjDiZG5qz+L7SZBZsMSZZ9pM1QhKju+GTD9iC+9HlhfXMtj94gz8U4h7eGXziEO7lo7LwLL6/DVMrGbkv68JYUYhGz2yBm/8cbQEh5vhakbhmpv1K6XYM9rzdsd9bwYcYt3cfKE3m+/NrUa42+RpJBdFg7cAmxsZ7/0TMyVw6Aqu2gzldb2ag4iLrPNEyW1ywaJ2DXMgPi/sjnDzhuo+vIUrc86j4ZLhT4GAN6uqwbnXq5UDzX7TfuB48oMvvE1sK5q6owkdWfklgnC6pSBpK7wl+e3kuvaYnGRGJJMBQuVgWL1awHrVtfOTsSE1vc0ZdG+a/Jbza6pHbyfi5L7FXJAGdQTk0EP3VT54+F7RZ/MJ9fj56aMxzhJRwQJ6df3cM26qSc5bW/zP3PFXypTOBwzCvVtwGQzkGvDW7XGwgLbTNHDpQXOd2BQ5Zd9bjQqGg+S+kIqWZVZCqVLfyFPF9bEOHfPepL6nRDJUD2l5uRnXqeTvidaSIoqS1Fbc6mLPtYnbp6uuts6Qo8TbMzFuI7NuaPuKnQIyVu7vUGJ8jg1uVOjlMNKdVtLPr9/ZEKVZVj7lsFA+nm3zRjjr1DRKhr/wY1CI1iXKVTeQZ0i2PSnN99j4iVTSwNAYQLWWD+KyZ/xRLVxmZQPuSkLeKBRAkavxjWnIFQb1dn72wMSUdcB9cNCNJNdyTkrl44MRR+pUuiVrTAnTlzL33X32eEYwT+vn564yxFJLUDyIMNjJ0nx+GreKSOglI2et0kAwRHKYFclH9GVTiVlB0TWeUJGD+7JYogF7BizjTGyPOUEWQCguIEmtC4fHD5461T80Z3Mp7rhNTI+Cswuknr9hrIZmpRyFSrSrP8R4S1Cf34Tu4RNrDxpofVK9nGTklZPsYM6eiP29Lx264fsX9oLdYhq7vCwcrRMJ1a5d0QHXUYRV5IqTFBoUSpxkQ6IHHL8ckM4NCzwk8K0CA3pj5Jp2a9wZjfKq7R/eukzQFuhMxV2qgHf2E3t7/SA8N7sMvsmF0p3J96QRE3rA85ekH1q8nrBVujlIqahmL0Qto3+JxdqAfnKMCblQGSKVWZgWLMm82MG/9pjhdkMzG7C2GRLGMty2y8NhX1pZWHNbLOmvaC424LNz/Nl5tkPv7fVbCT2ItB+/dx3ZhVhmgSLd1zL+2PsNFmj7VGBruTttezlo1mDKErjY27nTswjf2fY/Uq8lPcVAgRpJM+m7jS/8dk8cdl7fkY7Tuj4TfiSe0tiNSoJgZwom4+9haoBQ65AifaB7pUiTc0MAXCvG+nDydkRIbKx5fL6gAlyMAnBbQf+Qh1naLfzzwLVTP0EEyoenW2W1zKqfMql5rwGlyCB9mSa2s25yHf4SDSBlgEVMJtplpRgegZvDakpWDKgx3UR4W7yKW+RD7bd7rEa/GQmA/q0RYAOIaXfO/2CgEUPtNhPS2uqy29lBYFPPv5SHQ0t/jRxQLBpe09ateAWKypt9TWS7Z5gynOePS5M2NC16AhF0Xz6s7DUjtI0xNho9Y6GK16J5V8HqHypV/OAz7+VBzTaiR57XGH4r62GoAiJqfWOM7okzKCeeSBnOIKPHtwgM0SQbvCvv7rmS6ZAacu4BbXZ5R9gOhdR9H3bi7lWLBNnqqLPIy0k6m4XBhtl40B6z/5AcJxjtKfwvIExl7VsQRqbW8gpPMsmJZfSp3uC35g1AkP+BJlju3RVoFZNo3JR18A5uc60NGD4zvzIdGTAOth4ZAZx0ZGQItHuNcLz/0CiavJdkjD65h4avf1vf7LFZ1uogJz6vLK3uDisXIBIGkXOlIpxTdjjjTQt6Khy50bYbXsG9JBrSUGhsBWpeRUnq2cZWOifhfueY95gFIDAu37oKR3FQ1YxGMg3UMq+L2VN2rtqodelSHof8SyYZVQWs7L0bjtgolId1tAAjHI7J1/+JIRXeUBjjaGGQAU+az9XFfiqn+VRAGG8JDdP/WmEqjhYpcy00LIBIBzCF9I9mbXCv8IX9fhPlI5NqWGO/v0ikpfn+hb5U16FcPYsx+xLb4la6nSbvrTDP5MthPyeLIIY7ZE/rNU4ajgPmI0/3RvD7WtEbo8UGPjnev55N2ELuFpEPzkNu9MzXqq8K0cWxk4lT2DQPi3rDO8x8i5jX7wWQi8e0neCMb0SUO67zRfaekZONGfaFl47LByciUuy5dhqxMPokhTE2WbzxqCyt/s2TqG66R0ocYHmzv9f7tJ+TES8NFyzL3fhNoZoW5IxWNE+stYWutd3LPwa7HKhhRAbl5uCEbEGjrUzTXwbzG0qvpmNtpnYnmKjzTaSAFNCxfw9edcjaxCiRKKIDd6GS/eDsGBgTvJexDfwGmVWm9jadZhee9jRFiZFtL6m7sY1oQa8F9ycxSuPANXCqWkApcaEfQLkt1yyfeRs5yC5O/6XGJ4TEtJmCTPJFRr95au20STIPgkoEF1mzZ+5ZRtWKUYuWJVZDwcA/lTy6oYp0/d0LGPRUXnXRm0qtIXQVdnoVhKZPeWACt9rujRL57MEDi2kHtfV/ucu+k03bN0fQlbalUJ0faY99GC6L8MO8MXTSmqDAxNSpqpIFPhgHgAg0YK/GZhlQjbQXE4tMDEDO9obNfp4W6m8fdznMesSSRINBG5FDf//DkT9pSRQsIdSg4VK7W7j2d2jsQUIyjJmbd/2zCTaqh0Yq0cH6mS/5g/cq3eGOiJbaCNo6oVwGURzXVAeVaGIfJFhd2A59sVp+rVfe1f8B6bVbCLIKgGUgpUokO0vTg6ouAxXGQKtveMhhBT83ukPIRZ02+qF1kvM+nNCVy8uzrB0+W9QIKbMio2m/7zW78xd5Tf9itocpLbRuNC5cuS/GyRGXw6fzFzjM1UITlQ5dlvoyYxuvb7ol4S1MyhkfMNZbif6/xic0wB3uSScez3oFTRbCHBd0cbJL3cLwfQjCBpGBrRVC7174qW4XWnw0eYGSSzTVSEDOlMaTUIGJO+s7/z8JxaZprcEsoB4+vt9/+uwtM/iyqLVPidu8ZTh+F1rsEWKwZhDAg/giVc6VzRq+DJCrhn81b/LYlLJOdgoAjID2VnwgU+mQhCL6KhgIqqiVraD25UIYEqxMcZ1aRcZvHa8x5gh5onPtsVcl53Xek9BOYqkyj64acX921zwqoY0lmNA81NE7BzVts3cwWDZ4Dk6uuzwtfJuJc7vVS+fdVDEg3ATwC9oG5/Vb1swTyzTsl2V4m+93bSQo5STFG5AruTDWTym6Lxtt4OrAeIVgdoyTJL+keHiHTNiL0/nO5oYwftSQK1aYBuA0e12t/FVN+LsCk0L/hfCCcke89LuP4d46qnFo3NLpHb+NFrvekXVT4GiZgMW2H0orIY0TpS15wlxVUaGCUo7YSN0yWDRU5+p41dCOs5/vXq1do7K+Byjj35/mPlQ+VEDqqF7OIBQrXfHgCXYPy8ye3Ih3io+tYA6nK0/2clIERrpA0AMHKLTGEO7q/IzIcOCwYN9W/ISH4v4uk9MhzNu7Fg2IPCq5CQF1GLuzQu+wNv2h94NIA2UJydawv5X2bHkZjv+kB/WQCYjxUNEU8ssUdxDZstpv2qNAHmI6BMD84olxMiwFdK5J80zc9x7de/cz3ZNIkkGIpMCZJqKKkaLVo1MLnR/h/hQeUvfqJmvkPeIre3EjnliNkKJKL0KNaupHzY7Eoztaj0cNOhJ5dxIRB2is3kLcSK1FZswRJR0B5OXX+Q4UlFIrhR10lIge3Fg5DnaGoZoOyFaaHztrdF251JubDsCZRDSWA0y6ysykO+h4jhXtuWF7D5Wp7B4Hx3EQvKsmPPZYcLevowjlWghHbRBEhwPI3bzjhNWXlqtym5ObYAeYxuHyvyYue2X4651f7Om3+m8KT7Y/JqLWXwgayCdzxHuJidti1ITuf/oXzeCfTRbG5ytXlDk/epX061W6BO074jI7nV518OkYtRJDnPqdDFAf0uWcATfk0h17+gP7GHjy0Rc0Ive9XmvA6gCkoMjNjMEA7GQ3xy7e12DzfNpIfND7GKKojMifTrvkDXrfa3o4wNYktY6/VlBdHtrcH9F7uMWICej/BjZXVX83WFGcVHx3nOXxSL59kE9bSmHc3Xp8iDbPuSG5GIRp3fTFHnmTzzGedl6al2gUbGFKtkC0jFNtKTk2rr8LEObiGgfCoSpTWknvAYDQBoj93s0KiRNPOqgY++Xka2cQiDwqUsLl8/i57YC/V6sy5/NvhViRRZgCzcyjNHGzZsYA5YMtUntyfC1gNFP7cL3AwVA+326NJI7MQJoxTqcHL/YhntsnYTR5R6GVVvFYIlW8Nv9qn3daoGXMz0MoAsXpCzbiHZ0XWkfw2qlJkmZjgQtMAEhHXNgokGRPfOprmtlvNZaNlGB1EjQTVX1Y4tCyJFZhdhID4CowB23uQF16NifyxH+DGnQrnxeklnG7UQV2BRVdr6ZEKZYv7Gj+PbpojzAskvbdtaFsataqPrLDoejjc6ZfPA5zA0iYcCvcNjzuy9SuT0uG8NWMTLv2OsImL++PQV1sifUENAwi4O3yBvzTy4J77B7mMBpjCYGXAyjFGFZL4eAazSmvZ8thJ0FFW+keLHL+ft1dQBKmXY6JatelGebcIC/PyLBHdfX9bRcauGg4xEO7mMl8AjlcPMczkPniNQpiQFqcDJYrFGoxMV2hskxMn0bRQT8Ajc6w6sQYkGl0CQUImPrGfie9dsk4mrCLMIFOqcm0WT8O8AiREEGmooBTO7WI0qk506NsV7ffvc0rVJERJKcyRyCmFZdTSn/SrBfjV7SXT3pQlgluoY4FBUCDDkzwBgjkrE1oFUA3ls+xVP10w5jjBIMwKBSQqRVAEDXw+Dyj+jH3ila8czULWsCKhWd4qGsMFN7++OGBAz9eXHjAO9m++mTXF6qiyG35Q+61yjYQKsBrjR4NNexrwVGqBwAZA6cr5mp8AhoyzPomJ6TLfWEJjEeRI3QsX5oQkNuyF7u650QFka+VjFeNRY6ALklleTW9I0v4ABKDCXTGkjv80vqVNk+FTL0bJK7ndSjjMJD7OBFIEywBPJFrxTdyzocmxEgG0zu1VDgsQuXITYCx1RRty89A/F+CdSAlbMlIkptCC0GrF/jFS8PAU+6TNV1eBqJrCr9BgH1mth8FtdfE7druR+xyZKn5idfUKzGW6ACGF4M61IRoSs9o6xmaj3dnAVQvFWUsMcR6MI3xTKJNyMxkhXhhvT0IxialnG7i/BBzXfMXYh5jl4BXzCSNlxU4+aboEgIDr48/+pfj8J3WcNccFfzV6eiX05qkNktmafoBcxrEsrM8WQV0VVSRybQyXPOqJ1yndwBI6BOGO9oGxGDAd+HcKaZlptCMJsR1Cp3m7F9HpBFSu/NYVj+WSDY7jWSFBlTBSCFyyPEUn8S9NmBVa+mwGVsz0Q+fxe23w1w6wVO7sVnZqRpmXJeXg72QFkl7Qda1lBzn/FW+rRwLvFxCsuad67Wmzab1RJdzPGsuq8AzW6tL+JiwW/VPUSBbBmV1+EjqQ28x1u9W5Eoy7zhsU8NT87CtNbZ0lPEpsoWMewxC80kPanfWPrQXmixWDXXz7uf1kBTr1J/iYuls7fUsyAChXjKcKOaCF4ySqkhMTGmjNqYiG5joBUi/SZpWvgxk28pyIPhf28YULINiqmbWPBKuTCLFruV7JfRgGM87XfNEFc7tgnYx503k/0UXJfpmjx6wKbKcvV5fqrctx+OrIn++TxRxSKlTScEIwd2vG5mg/p5wsQDpiD+X91XbkReKLB25Jvp/IJaJh715RXqBzwCwlY3URonyy+oZoTD8Ym8XMMv/dMllh0LCFZkZFn2gYcLG9iO+I5S/GyxwjajQLQtwH7o+n50vimC+ES8ePOpPDwlu4oG8KhS7NL/OTdIWPIHbSa6/9DfjOq9W66EpaK57R78PpEzVNLkTP2L6lllqDT6SDhIDIvQS3SQbxG96khXgvW/rME+tiXFXi+BC0udi9keyGlc3sLBN3CP3QXzswhBGTxvz2LmRMkU3rLuSkYR1Gzr7vj1VxTN1y1iciA0DswsPZ38eB6X10Uzk6HZqjzBK+EJ5osJJJ/s3b0MFRIWYlM15TPm1uzeOk1zQ96quClQLEZbpxmV/eAduIotXUYQZjWAkTulBJt7kw9uEnLo7OpZrf8k+0ZQP0agcOTLbfrekHji86Mxr7rTwve82mePKoAkkEthE45VI+f1VqpyWNW1kbBbVVfuatKt6MEKqyTUyxSFGHk81kY7CxkgMNexiikN0+IeiUNsfuktjfOAiMfDhbTe4rtxSEPvO4CCUGaktA58TGnSO8rHdCicmGkNrwWsnXgUWjhp8bllNcnQN10TbwxYPAwQKW/JJiYQadr4THXO+vWudiq3I47vqmEM/Ab3Dlq11Q7RmRWntYOEyESbTI8PZYwbtsmjcSwBtTAIHQ5h3I633h3FpOkT2c0PlMjzj0Q/OuqaTVt639fowVppqvSlNcK5KupBnrxfKHQK+SoKSuaO8PNMkYkbcEAc9F0I4uzPfRVP/q5QkvJVsVoJ8BEWW/q1+kivHEMQfb+J2NfJjSTG+WhjHjL8eqi7FgfVewxwmqG9IOnTkwDjAHUaJMIyhVkadW/+GQjLyNP4zyHcLAdWcB5zQ2kc/blAx2RKfG+ON3RfC+iQ5Th7V2i5abkoy0pjfyOwTjIvaq9slSCtoNGBZggBDOiWwau0CX4NAIThFyqu9VWCLr8TsqhQZvQP+xrywovGs6A079U7YBjhEXyQw4Q3rbQY1EQnxTPXNlHfn9vQnuhsJnzx6PZrCqry8fidPz2U1scmAMVPHxa/injIf+hDziEU02xWm9ou67OgebktON9V6wwVotoNOzVNJhiDBlHbktBwOjX1BlJHybLox5y/7NhR7uc8f85O6xdxueabhwtJjYcBzac56v6RbuI9IRvPzOnNbltj8Hh0ftwwhWyHAyiEat0oDSEVZ925jmxJKAqTo4/uHnkozgMDsnkzXPXBDJ1sDTawXy23mXuTJOYV6ZVWrervMaGGGQpgQjAnfP7KPZro+OKt/MpnoM0NeGQgIFAiH7dU7Nl1QbcMiwO6/5nIosJtrFB8w1kpqb6OjI9BgZHG1nzTMGA++HNrl4WQNcq3SajD4C9utQYAu/fETPFMMJeCDwHRCnPuRAlqJ5t0E5h3Wlh1Nw57LQ36kDjC3lS9w0a89eI8ym6BzEA25Cdz3LQAyz94Fvjqp7MyHrpm3PzmsV/tbSLF9NJBjFmzWPQ8Tfgvj3fi8dg78tXvEatqtUhLxsNp2VCU6IzSqafxWw93+Wk47skJv5qxM+tv7CrpYKvWLEylJNEXlh7GHm9UenNf2/szZOl+54P4ZWksh1r6+rphL68QYhmqW7DqKVrc2rjzPYcvFDmKtCGL/F62i3riMV9z+LoLnuVaMn4dtpNNFmQEQ4uEhDfLYU4x8G2OHCz7gnxLCa4zE4CFo9m/+ECmdzziVumHM/P00/BESH2rxUYMBL8/9NRG5fiskFJr4AO0qNUKUCgTRgEiFsTbGXtP4DTTzc8ZAmfNJuJQE5Kp7W7U7QZnBXKepfSHkYTEqgOhqo95Jw9i56kYGt4BWwX50mC27CCW92SVMl4tbUEhBDSB36zgztz5Zts0563Kjc34B+6ZUnMIk+BiQNvqSkZHnk3rHNSaYthO72IWLIxij0hcv7n228yc82FsQLK9jmptjY6estDfH3OSMaAj+poCLKwRFXvXWb6jwM9mG4nu1yug0Cc4L89w4EYek6dnV17VBfIxB2dmFFQdp0kqx3BM9gdMAr0KS7WLOSf3cn5eDItDLP2UW7MWaIR+GJ0EGcEL3ejBdu0to6vDh04JcRMNU55usmSn3jp74myzWE3azMIT96wr39F62c3G/ldGskbqTIMTk3gMg61vNBQ0cJSIxVdcgNb3xFDowwVyIqYz54F8Rqg0uQE4FIiUGZxJhND/AWhkukqIqLLZEpxj07kPBN6Zb2pWht/X5JrC8yJzPlvFhfJndQ4jcgjFyhvymr/a17uxTKHpKNWDEoL4nNa9/Prf7TYRw6Gyo6vcwYcUHk17SMb9aEdVnx24msNCDEKbj0OVzRaA3gFJeXZPObqJKvWqFlavGpxXnP+4ZYTl0Dmcri6vMdwX687ApG+ygiGHZDwNzU68F4JMPQ9JB45vLkCsE2w50QNP1kJZlI56dVGzfK1MyRqP4J6VshesfOT4hzR6MYq373IoONlLvENdYXN6pTxo5eRzQkwk2tZ1zmZqczCytqTEhpweKcBCCZ/FhizgLm8/x5ScBlO0wEXHZm90mpmL1gR/J2CUnz3wDU99YFFKqm01AZ8q2S5Fnh81CbD687c7K2OjWlZgdvEJA9M0JT3eKdIRd9GCx6g1TO5PWTE8OOphUDKdazyYnmMqFhFxfJ//cWJTsgYbol2a7Ob/Q69Fy3kb9K7aZLzH+Kl/uCzWnqTOrQonVL7LTFPr7wbTaepfAl5zSgMInjrGXY+Gspw+fCNgEU1zyC0Suum6VFyHBjdKWft7strrOXqOSQwxsYXp4F013mN9gZyu4Hc84A4dzIHN5UNXmxNn+vPjS82JM6klySWB9pLCzLBUgXiMDllaG6fT2PSBv/b+yaruyWBVcpsOKuEaQ37W3A3t9YFRcgB5rFMDjwOn3c0lfsg+5V+dBX2EmWLTSelNZkeq67CFnxaKtnlsAJRPBqYvoWVZcJKn0zSelrO2TwnailO7zgAHaMRmQYbXo9beBs16JWf7V8LjYGS/DYUKTTE1zKECC/pK1EKf6mxIgmV+mJ+Mc8h04qep+okIIEXaN351J3N0VUk7cEEaOLE1rFF3W4vqRcodPfbLqINF6QtTsfny1+O46J5ahlamZEyxglZtpjEkKd9yKDsgwnzqoAPN5o76IsI+FRaBc8u1qLBWxpKU615chTVegNFR5V4o1T2JGwVkueD6CjAhOplPnRyv8sauMnMy2wEMARR6AmCQ8S5ebL0nCEqjSztMoUyAEjQ6FDYqkGweu48DkBR5HjwlBloKVawYcDezxKBH8WWnMpJKZj1Ol+OHMmg5iq9xDswLx0iTNkujgatOkeRU0c/GmSSH+7GTTMLQJdj51l3EkojjEwWOjw8XBOm88GqC4bWPEE+U/5XYtZNJG/X4FYjgIvVd69RYVbMEMfPSKJ825e3XQ6RBesp/G+lkMk4VIxRakyUBPLO1u0UYnNG9ExAnPdOO0OfFvcPOL9rBJO8bR+q9Lp9/i+fH32KkaNR2WgoxQY3FY+rS2NUvtCOgZAaF9vny16WG/3zeUtRP9V28PcGivAHAwwCcRk0D0iohjAfgL/EKXJkr8gIFqbNq7lXUFRKqMbpBa182ol77SqJq1M5setGUJuSBKqYBYKdDZv3XdT/u6J5aKKkLvA5ez6PuWX0RT7kELSKDKfg9w9nwSmMmJHjbnr0blM2WvpiirR/nLid6SRN9+5KoLUb+pLw3QzD8JlS3X2q0m4BNRxfltr5KWqryOuuGDt6IOHSE8/zqGXMiTqgrUOfDH58NoWe0te4mFc1GxswvhZXWJZmaWaMJo2SBnuXa7+jIfFbnhNH74Z6jygwcqXsldYfI/Zh8BZbqTh2I7Hu44dilfbX8Uh18NVB3phRnTwpUonKquUs/iZXRnDFjtEmKg2YRQm2CP1FWRb/B92HqJlHT7Hs/Tpl3RrlxvkoskpNlW53/6Ujse0fkHLNeUm97TlDsaRXpfZkR1uWMTwhPv4oYM2Bv941R+c7nQ0yBdFNVQpZRkpejmIfjFrdQUA7DPwR69aq6Pzmk3IXarIMKG6R4MBdkB3j3HWxohnZLWpaNy/BMxS+84e4vPPfO/7+nLWVZsdpUY/nGDkQts0NGnRpZK/lW60tmncMoTepY5fMbow1GyKhqSXLbOZkz59l8DG9v9ZHPwA1roKz3MW/j2tN/U+lPQVYXTa6h1ePQkSWR2bp9OHmCCvT6s8v9PVG2ufK7dkbpY500gNx7fdArzH3yCjY33Fa5TbOuybLNdW8juJyJtikDn+5jMnMzIWP/+v12XkaXj195xk6eOKuvA5zeKk1i1PrSnmWA46Ca2ldgNqJ0rvLqM9X2EPn/QuMjLnLg0iVJ4H4r5S2PgpGdSdfVoiX/rBAq6yVDc30v8DOUae4oquSM0YDCIafLQ+hvEmB5b/f+QsTFtAR0zIVWeLyYbmrx3g9gHhVRfelCz9/exh19AGsyXcwuSaBiCzQIoctYvyhhkdCsC/cdZDce/1Fav35JQt+RJFAjiMRQhCdE4eS3SmfsREHe9LZa0ElOLhxxvs5uS/SnMYssyK9FxiucRjjOqfaIp2N8CmuNJqg3WvtMk+MlbAYeji9K94rx6U7nj9L1TGhVcAyz+Gb4sib21AW94HRzWbTrRKEkx5+KLE69Vc+8Cj1Vu2GkZ1AA2E4kaJ2aTjsEL2C0srAINXRAjnxwI3p5ED0NRYn9sT1iY9GPBJwhhd6WXEJ/Z44D0rufaDOA8dUj1SIqywRs2b7SjYcCYS8eefkwdWlpN0DvnecdwHVc3TqyCcUy7K2PMS2l2KZHzZfLCTCPaPq/NVc/Nlc5hVJoFvnNUpKWZcTsxVeHfH1mnELREECq9YES9v6FcvONCxXLQmf0k3S2dyNmsxbvlXM0u7lSqkx81md0rad3E33PPuPpDGM9UiBhSeJn3Sejmx+LdLCiZYcVxow59nCqrUmXGAbsR4O7wVQzyHdL6DX5s8k5BjHXlONz0PaIqS89xMhkYetMw6w7JZ5c/oJBH2jdZPbS6KbR0RpEe16BATLzU4QiHybxArrjBM8MKKP8Zz6MVbg/d8yb76U8nQzCK4Eqa5ombBm7/6xo2dR9O/ByfcU6qDu+efdLFAP4LiCr6C3aihDPjigUYuy0voLuX3Flevl7xXRtRZ4Vc48j2tgA7tK0wqv4OjLwCzZJn9lYIQuScQBEFMBjA6Vj8FTp4h3OphB6g0uA13nTnVLmKQ+zfELl+6znWX5nCWvbwak0t3q4qwWK3MAPKE2vqDEeCsFKvmJ2Ws+VOqnrA+ekCk9jaszBsZd71InADWijT4SHnyVmc55dv5ivXl1fED4vwNrxbiZHWeGinS3ImcoDAT1vGiLpP/D3NaiIPq9A2h5DT5SgaCVCh0JKu7DKsHjW9ZAACRxHgTSo5jrVWUJfGKweg2auQuittVidB+JaCdwYd0x9oJ4jyI5UygrB9Nzi2gbLVcCnpu+1ytsiWCbJb1Xxas8FhG/EX86taG6flZZauhaGnpRyfBB5ojGdsdPBVHEtb8R951oaNTvKXK7CddSeWaeOi2FIDPEhWhAk19RzuR9wSKEwvvi8nQFz649+fUlBMuDL7VmUBSsC1ExWwqY+uSdNKowEkpsBb+/KpWl6oGxymyR/e4uKjipBJrVPXg0nE2j6HL2JbCHNh01lV+/+6FUglhV8GTypzdvdfhYc7t0ZYtkyH/17wDakU7r1GAdUIXXmtxamhK2FdelBa4BPryblCC9gJG9htJue9LMrNS7mM6gbRA1xSFnWNsziDuGZeS3Dcu4bjsWaIebrgNnxpl/pLGxV5EtkFwDeh8fPyfPU8CZAM/Ljk3+Vi7jUtNZmZM8+f7d4wlUIkTHiAULRUKu0ODFIeyk20BiqLB7vvAT342SIDP+z5FPaa6Tjyqh/AsX2jFhbeIXKxDMb8fid0jHAWk6JKhswbtvtP6bDz+lYjvXIPwV1Y+nyft2uM8c1aUxmDHAUmZnJBvZXT43mxjXDHP05R1/dKfoExcgcYzv3wO5mazi7ugS01z6oUmByKtfQ6fA2+MQynPCoDHcp1eDtag/E3HQpHMWAgGkNh9wWR5Y48YG0W4CgvOrngI111j/x+MIuH5xFlVkxqptSjW+hnVbt9qxtXndEH5RtnxWfd9eP+kli/x3LU1WGsZVAkVElXD274LBGK0bMveEUbj/6EpnocEnvRSlglpE4GiAO5S4JdYb4uYd6oeK8vuZvTQaWMS3dEIJ2ssCxWz8DqYmc/b38ynz0DWCCeF1gCyipaLG2Kq9wqfHz3S6m7CS+H42nmDYAz2dYcx77M8purGOS5tQ4aykJXIDQBwHjIGSU+52M+1OV53rp4B3JbIXecQWEjfk9gkVoz8T6HJbIhFgm3quNMk+cIyRHlj/BdURXY8o7H7dBQfsdpLJhAsxS/1JtMkY8JoP4YdyOxzJY5x/+A9scOTXvPVoQAMqgmP899s6GvRtzNFGXLX7VHSnUj7VPO8K1qxaS/a/6v/YhRlUtNgnqnth3Jo/DKbdhdPn6HgB9YjU5GuN1uPyUXZJDZYfFwMfdqNPVoI8d1csoHMK5tquGoK060mIwBHMk3pFGqBosajr9g/5kBPrrtuIIEPFZnaAKSCQqLdeQq2B6Bs8WxD8+DfzGJ2nu0Xeb58spPoiHZAVV+I5lRUseUE0IA4E844UzFYADNYcLBW3zsP7aWzLnUZoQPuIDR3FX3bkM5mCunvXaPSi4PRkKnItEv8/OYiq8RSKQcaTwxX9YgdNbgPuXLwb5ARofv0Zj3WpHhNnlTq2Qu/lwvM3PUaqv8L7kpFqQR9aRaXfFanbLgbyxJ2kAx9oA1kRMyH3JXI06oQhRiZQ1LtWz+QKKxme0zAgI2q6/dmYApsA7WGeBae5+Y3eqkqDjXyS7Q+LzYgrM3EiqGHsibaKZKgFecxpGiMLXY5+kkuDKBdMkj2Bd8uTKI+aTWpu97gNp78fm891zYuT68sIEzE5JggpWjlWFSpzYayxvnOxJ3JYK/q8WbCy14KhtCFhdLOxCEAvyqXN3K+oP52ZzdxHiCAac5LX2TO5CTmkxp6zCT5JZDIBgnnmQU8GBowEvogfPni17fE1sljd55P2C4mWCNDr8l3hMH+4zpyZqp3iFbJx20nGtU+9LJozl0OxNrk/c0C9chEe+k4vUECnUaXbS8JqdnymqbZ1SCI+4+1BYMW4nzYKDLaqL3Nm08C/Ug7zNg2BuwhWepXrkqaRX58LCWLPDQyUzn369E1drtekeuNcI4SgdmyQZ/7xhXZ6sOKg9G/HEiJQsriRQThvHz4BhaFaXic4nlrz4LhUthGBLbnnB6tufJizYx4c6b2rY1E63pLDA8QdZsTOD7euNMku1a0T2nNQ9rOPBYPDyksaP+EmKTvqcgRycKMtzhHh37mAqVERuzIIMs/zXE9jGBpJBBWb8KCPZne6Sxw0+UFlY6/VeXJUHunHXY1csfc40Tw95XrkpLzxqX/LrsaYM7Y0UQ/Qe6PTjMQUXDseSMhYwHTXCohySQ+1fIjz/yjZWRFI1/a4d9eQzWLoGjz8O8ldPhzhpWFwwlaR0T1gpMP3VeHvDOx4RJocHJOSRQ+H4/nHJsiuXWDKowYZZW8Jk9vUiw2jExedn7glAsC/bgN1NrgIp1y+y3tmLd2V9x7yKVC+QK6MOFq19dlQflj350qUavBULMCTn0BvCRQY4q6VjniU6XHISUsaApCVoQeevAOuCUFcnwWfK+44XDo1qSpPF1wcnbH7N9aO+AzD212PgFlGkXlaQ3Gbfz9XIUMjulgGUREelr6IX+tR2K9H/yep959z5WLXlZ81Z8HCIV8CyU0JKYzkIeFqf6o2ywb2O73oRi7i8F6Vcn2zU1VWZpLfSXgTNkRtqM7r5s13UimLWtAVZs97rLcMRlwXzYp98ZnKvQLj/dpKn8nfNnU9V2Bp90frlQedeKt6zd4mPR53FKQ1J4r95n1G8ph0XG37DC9b185sWbnoyC4Q1iUvyy5IOxBrIqbqn/JSUWzdrlOiZGDJrU5IGuzUl5TaupUTIgFeLfT6uh0gIEJ5nZQ/8XjB0mmEZxTvocrU/BFoOaUvV/N48W3W/aQu5nR3KwsSByfSDAEq6qBqTVTkZtkaAd/1Rie2jkdRlZvxFMu0MGnLc0SHPII8eOz/bjfIhSQhAb38dSRcFmfRb+fpDrDHeazED6EHNayy0kESoRG+XFbJa6xWB6OlbwHVDwdO9Ka7bIOqLRHpZjwXmv/2DR9nu+2xwxE39cBHq/7Vv99HcvH8ZJeGmgHr8mBKQmOCTkvLkxf5k4FrqZuNpaRNhCB3puFuF5d2nnQbhgAaANLMCYAiGsJhX2bFM/r3BGhR/dkGPXeBQUJ4tTARQnVqA07mW/42Dv2k7Wa7hWU/wv7FTIWLwWyHX0Vqdg4BHrlJ7zh+b+T6fH+W3d53LS5rkXK5GIctMIttK+osfGYIvOD0BkkXBJR0EYUmteToIxpoaMVKZmCRC2BbmBLdUTIZiI1kVYKYnq9Q5xMGODu+6vCT2ofvYE0pmGbQ9Ln6wnBDYZUD/BL9rmiPn3n28Zs33OsHUQcLp2vjUEV5sOBLO2ScyescGu0N58y1q1NSNJuXCzI4fu4RWJtSIn3P3+9eAsMo/2NupFeaf70/usLGd2Z0F27EjLoIj+nmJ4/Q5edPFhVNpPURQrUzPALNNzEvx3e82rDtPpbZjugv7Abm2q2vMGwz5W+hGH0hkCzXdZhPFbLk0sR5vVhScLgAPdZIVZIjTuzwIKVuWmvpMr7Gwxgiglpy8ecfOAZcCpXRzG6lNuRB64D4G9AWD9vQi/crWV4Xq5VjJnRjQc3g4bJe+MmksjEctghn27n5i5PHZvW/gM0BsXzo8Pou6yOLnp49dGXpK/oLAbOdOel9h+kDqEtZunvsXa9EFomdl0QbDvk+H58SjszCVqVOXSgDpOdZjXWfZpFL6S/fd1Lq8FQS3LklgiNhdvE5GzgSO8uq3gtj8I2o+JzucnrUSrtoxa6IejmVQLGzF3rSCy3fdhBPhZnDdgctC89dRJ+PTfW4ga5WWAyaWspzFg5251FoByB8LUbD3AxhvV6M1ARNXRJ4NhPe2j9WOlu5I2KmCMGvGP5CbHAyZk3YhiuIdtDgOvre9Cz0yOWvHH5FpZQzqzyHE5XkTTFMU2JhG1nvne9SCi9zNvPnGj9h/bQXgpue78rpogXJl8oDSfMwz9fp4ocyOxEV1JCEslSsRvodEzPbUsMUYWDERNzR6f45Ku6EmW3qdD48dcFQtc9rr2wF3o85edZ/2SY0BSkOdQX1ahwPVBP554Q1Z4lbd0d/vrRCO5k3QBWOb3iML0vI4MRkiKwqt735Q2fkq0Xl1pI3nk4ll51cSEHOrFTctkxwLOiQl6HJh2q3iqHFmtOCSo0A4YLl+mllolm7FLpe/79gMoe7A5cbFPCbX9Z3GhI43FgBbWoq8pwaIoDlklRimVauOx355pv7v26P0MLrgiqWTOxJaIGO/UhHf7GSOm0r1O5m1sPYYn1bathmEkYfrQLiEWQ2/3IjunsIxgAmi6t4JsxalYxE4YyvD59EpzvswOjZUvSgkHwPZonVtaiMTLXnV3p0dKpCSSz38Kv8QbNFzqLbwbBBRUHw/nHSxNipNm5vtjfkuf06jWRwkctgu8wZqKwS/7IcGnFtmwnbJFPhpGcyV9GVFzCCG+TOeNgAWxOUPgmtLdD8JawVVDV+e3iR8kHuaZXIknncI/3uFnblTd2P/OdWvxl+9CXbqJb1CS8osg2fg/qaA9KvM3FQoZQ79JRZC/Upm90ABPCGzksTWJ7Xy9VHpnPZCgGzAVbJhmurq8tm24BjBvnm1GOKfotvCqXyIXFE1bYTRS1WtzgZrGWgR/oOUDnNgDPXqUfTmyFPfNCD9MX22hvuBans/Kl1DustiTunl9Kravj0NG1Ds5nkTqlQSYOfhgvRIowimmWAYWma55eqvaQL9GvHmuH/hIVB/tiN6s7yOW2iahReL8dNddIbMJ6BLVguJ4n1dnquV3ZNqi6V0H/Vn00j0cE80ERsZTgsHPJ0eUjxYik+eDtaEHnyAsYeR2AjRcGw=="),(function(t){return t.charCodeAt(0)})),i=new Uint8Array([177,156,215,89,13,111,230,1]),o=new Uint8Array(n.length),a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;var c,u=0;for(s=0;s<256;s++){var l=[a[u=(u+a[s]+i[s%i.length])%256],a[s]];a[s]=l[0],a[u]=l[1]}s=0,u=0;for(var d=0;d<0+n.length;d++){var h=[a[u=(u+a[s=(s+1)%256])%256],a[s]];a[s]=h[0],a[u]=h[1],c=a[(a[s]+a[u])%256],d>=0&&(o[d-0]=n[d-0]^c)}return O=!0,new Promise((function(n){(function(t,e){return WebAssembly.instantiate(t,e)})(o.buffer,e).then((function(e){O=!1,r=e.instance.exports,t.__wbindgen_wasm_module=e.module,n()}))}))}().then((function(){M=I.new(),t(M)}))}))).then((function(t){R=t})),setInterval((function(){Object(c.getParameter)("UPLOAD_LOG")&&U.info("console log upload")}),9e5);var U=function(){var t,e,n,r,i,l,d=null,h=["DEBUG","INFO","WARNING","ERROR","NONE"],f=0,p=function(t,e){if(Object(c.getParameter)("UPLOAD_LOG"))try{e=Array.prototype.slice.call(e);var n="";e.forEach((function(t){"object"===o()(t)&&(t=JSON.stringify(t)),n=n+t+" "})),B.push({payload:n,log_level:t}),"free"===k&&function t(e){k="uploading",setTimeout((function(){!function(t,e,n){var r={};Array.isArray(t)||(t=[t]),t=t.map((function(t){return{log_item_id:L++,log_level:t.log_level,payload_str:t.payload}})),r={timestamp:Date.now(),sdk_version:c.VERSION,process_id:Object(u.getProcessId)(),payload:JSON.stringify(t)},R?r.hash=R.get_digest("".concat(r.payload).concat(r.process_id).concat(r.timestamp)):n&&n();try{var i=d,o=d||"https://".concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2");Object(s.post)(o,r,(function(t){"OK"===t?e&&e(t):n&&n(t)}),(function(t){n&&n(t)}),i?{withCredentials:!0}:{withCredentials:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}catch(t){n&&n(t)}}(e,(function(){P=0,0!==B.length?(N=B.length<10?B.splice(0,B.length):B.splice(0,10),t(N)):k="free"}),(function(){setTimeout((function(){t(N)}),P++<2?200:1e4)}))}),3e3)}(N=B.length<10?B.splice(0,B.length):B.splice(0,10))}catch(t){}};e=function(){for(var e=[0],n=0;n<arguments.length;n++)e.push(arguments[n]);t.apply(this,e)},n=function(){for(var e=[1],n=0;n<arguments.length;n++)e.push(arguments[n]);t.apply(this,e)},r=function(){for(var e=[2],n=0;n<arguments.length;n++)e.push(arguments[n]);t.apply(this,e)},i=function(){for(var e=[3],n=0;n<arguments.length;n++)e.push(arguments[n]);t.apply(this,e)};var v={};return l=function(t){v[t]||(r.apply(void 0,arguments),v[t]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,enableLogUpload:function(){Object(c.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(c.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(t){d=t?"https://".concat(t,"/ls/?h=").concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v2"):"https://".concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2")},setLogLevel:function(t){t>4?t=4:t<0&&(t=0),f=t},log:t=function(){var t=arguments[0],e=arguments;if(e[0]=a()+" Agora-SDK ["+(h[t]||"DEFAULT")+"]:",p(t,e),!(t<f))switch(t){case 0:case 1:console.log.apply(console,e);break;case 2:console.warn.apply(console,e);break;case 3:console.log.apply(console,e);break;default:return void console.log.apply(console,e)}},debug:e,info:n,warning:r,deprecate:l,error:i}}();e.default=U},function(t,e,n){"use strict";n.r(e),n.d(e,"report",(function(){return C})),n.d(e,"SESSION_INIT",(function(){return g})),n.d(e,"JOIN_CHOOSE_SERVER",(function(){return A})),n.d(e,"JOIN_GATEWAY",(function(){return y})),n.d(e,"PUBLISH",(function(){return b})),n.d(e,"SUBSCRIBE",(function(){return w})),n.d(e,"getProcessId",(function(){return T}));var r=n(43),i=n.n(r),o=n(7),a=n.n(o),s=n(3),c=n(0),u=n(14),l=n(28),d=n.n(l),h=n(44);function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v,m,g="session_init",A="join_choose_server",y="join_gateway",b="publish",w="subscribe",E=new(n.n(h).a),_={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},S=null,T=function(){return S||(S="process-"+d()(),c.default.info("processId: "+S)),S},C=(m=0,(v={list:{},setProxyServer:function(t){E.setProxy(t),v.proxyServerURL=t},getUrl:function(){return v.proxyServerURL?"https://".concat(v.proxyServerURL,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message")},getBackUrl:function(){return v.proxyServerURL?"https://".concat(v.proxyServerURL,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message")},getSessionStartTime:function(t){return v.list[t]?v.list[t].startTime:(c.default.DEBUG("[getSessionStartTime]: session ".concat(t," no exit")),0)},sessionInit:function(t,e){var n=a()({},_);n.startTime=+new Date,n.sid=t,n.cname=e.cname,v.list[t]=n;var r=a()({},{willUploadConsoleLog:Object(s.getParameter)("UPLOAD_LOG"),areaVersion:"global"},e.extend),i=a()({},n);i.eventType=g,i.appid=e.appid,i.browser=navigator.userAgent,i.build=s.BUILD,i.lts=+new Date,i.elapse=i.lts-i.startTime,i.extend=JSON.stringify(r),i.mode=e.mode,i.process=T(),i.success=e.succ,i.version=s.VERSION,delete i.startTime,v.send({type:"Session",data:i}),v._flushInvokeReport(t)},joinChooseServer:function(t,e,n){if(v.list[t]){e.uid&&(v.list[t].uid=parseInt(e.uid)),e.cid&&(v.list[t].cid=parseInt(e.cid)),e.vid&&(v.list[t].vid=parseInt(e.vid));var r=a()({},v.list[t]);r.eventType=A;var i=e.lts;r.lts=Date.now(),r.eventElapse=r.lts-i,r.chooseServerAddr=e.csAddr,r.errorCode=e.ec,r.elapse=r.lts-r.startTime,r.success=e.succ,r.chooseServerAddrList=JSON.stringify(e.serverList),delete r.startTime,v.send({type:"JoinChooseServer",data:r})}},reqUserAccount:function(t,e){e.vid&&(v.list[t].vid=parseInt(e.vid));var n=a()({},v.list[t]),r=e.lts;n.eventType="req_user_account",n.lts=Date.now(),n.success=e.success,n.serverAddress=e.serverAddress,n.stringUid=e.stringUid,n.uid=e.uid,n.errorCode=e.errorCode,n.elapse=n.lts-n.startTime,n.eventElapse=n.lts-r,n.extend="string"==typeof e.extend?e.extend:JSON.stringify(e.extend),delete n.startTime,v.send({type:"ReqUserAccount",data:n})},joinGateway:function(t,e){e.vid&&(v.list[t].vid=parseInt(e.vid));var n=a()({},v.list[t]),r=e.lts;n.eventType=y,n.firstSuccess=e.firstSuccess,n.lts=Date.now(),n.gatewayAddr=e.addr,n.success=e.succ,n.errorCode=e.ec,n.elapse=n.lts-n.startTime,n.eventElapse=n.lts-r,delete n.startTime,v.send({type:"JoinGateway",data:n})},publish:function(t,e){var n=a()({},v.list[t]);n.eventType=b;var r=e.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.success=e.succ,n.errorCode=e.ec,n.audio=e.audio,n.video=e.video,n.screenshare=e.screenshare,n.publishRequestid=e.publishRequestid,n.p2pid=e.p2pid,e.videoName&&(n.videoName=e.videoName),e.audioName&&(n.audioName=e.audioName),e.screenName&&(n.screenName=e.screenName),delete n.startTime,v.send({type:"Publish",data:n}),v._flushInvokeReport(t)},subscribe:function(t,e){var n=a()({},v.list[t]);n.eventType=w;var r=e.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.errorCode=e.ec,n.success=e.succ,n.subscribeRequestid=e.subscribeRequestid,n.p2pid=e.p2pid,isFinite(e.peerid)?n.peer=e.peerid:n.peerSuid=""+e.peerid,"boolean"==typeof e.video&&(n.video=e.video),"boolean"==typeof e.audio&&(n.audio=e.audio),delete n.startTime,v.send({type:"Subscribe",data:n}),v._flushInvokeReport(t)},firstRemoteFrame:function(t,e){var n=a()({},v.list[t]);n.eventType="first_remote_frame";var r=e.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.width=e.width,n.height=e.height,n.success=e.succ,n.errorCode=e.ec,isFinite(e.peerid)?n.peer=e.peerid:n.peerSuid=""+e.peerid,delete n.startTime,v.send({type:"FirstFrame",data:n})},firstVideoReceived:function(t,e){var n=a()({},v.list[t]);n.eventType="first_video_received",n.lts=Date.now(),n.peer=e.peerid,n.uid=e.uid,n.elapse=e.elapse,n.subscribeElapse=e.subscribeElapse,n.subscribeRequestid=e.subscribeRequestid,n.p2pid=e.p2pid,v.send({type:"FirstVideoReceived",data:n})},firstAudioReceived:function(t,e){var n=a()({},v.list[t]);n.eventType="first_audio_received",n.lts=Date.now(),n.peer=e.peerid,n.uid=e.uid,n.elapse=e.elapse,n.subscribeElapse=e.subscribeElapse,n.subscribeRequestid=e.subscribeRequestid,n.p2pid=e.p2pid,v.send({type:"FirstAudioReceived",data:n})},firstVideoDecode:function(t,e){var n=a()({},v.list[t]);n.eventType="first_video_decode",n.lts=Date.now(),n.peer=e.peerid,n.uid=e.uid,n.elapse=e.elapse,n.videowidth=e.width,n.videoheight=e.height,n.subscribeElapse=e.subscribeElapse,n.subscribeRequestid=e.subscribeRequestid,n.p2pid=e.p2pid,v.send({type:"FirstVideoDecode",data:n})},firstAudioDecode:function(t,e){var n=a()({},v.list[t]);n.eventType="first_audio_decode",n.lts=Date.now(),n.uid=e.uid,n.peer=e.peerid,n.elapse=e.elapse,n.subscribeElapse=e.subscribeElapse,n.subscribeRequestid=e.subscribeRequestid,n.p2pid=e.p2pid,v.send({type:"FirstAudioDecode",data:n})},onAddAudioStream:function(t,e){var n=a()({},v.list[t]);n.eventType="on_add_audio_stream",n.lts=Date.now(),n.uid=e.uid,n.peer=e.peerid,v.send({type:"OnAddAudioStream",data:n})},onAddVideoStream:function(t,e){var n=a()({},v.list[t]);n.eventType="on_add_video_stream",n.lts=Date.now(),n.uid=e.uid,n.peer=e.peerid,v.send({type:"OnAddVideoStream",data:n})},onUpdateStream:function(t,e){var n=a()({},v.list[t]);n.eventType="on_update_stream",n.lts=Date.now(),n.uid=e.uid,n.peer=e.peerid,n.audio=e.audio,n.video=e.video,v.send({type:"OnUpdateStream",data:n})},onRemoveStream:function(t,e){var n=a()({},v.list[t]);n.eventType="on_remove_stream",n.lts=Date.now(),n.uid=e.uid,n.peer=e.peerid,v.send({type:"OnRemoveStream",data:n})},streamSwitch:function(t,e){var n=a()({},v.list[t]);n.eventType="stream_switch",n.lts=Date.now(),n.isDual=e.isdual,n.elapse=n.lts-n.startTime,n.success=n.succ,delete n.startTime,v.send({type:"StreamSwitch",data:n})},audioSendingStopped:function(t,e){var n=a()({},v.list[t]);n.eventType="audio_sending_stopped",n.lts=Date.now(),n.elapse=n.lts-n.startTime,n.reason=e.reason,n.success=e.succ,delete n.startTime,v.send({type:"AudioSendingStopped",data:n})},videoSendingStopped:function(t,e){var n=a()({},v.list[t]);n.eventType="video_sending_stopped",n.lts=Date.now(),n.elapse=n.lts-n.startTime,n.reson=e.reason,n.success=e.succ,delete n.startTime,v.send({type:"VideoSendingStopped",data:n})},requestProxyAppCenter:function(t,e){var n=a()({},v.list[t]),r=e.lts;n.eventType="request_proxy_appcenter",n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.extend=e.extend+"",n.APAddr=e.APAddr,n.workerManagerList=e.workerManagerList,n.response=e.response,n.errorCode=e.ec,n.success=e.succ,delete n.startTime,v.send({type:"RequestProxyAppCenter",data:n})},requestProxyWorkerManager:function(t,e){var n=a()({},v.list[t]),r=e.lts;n.eventType="request_proxy_worker_manager",n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.extend=e.extend,n.workerManagerAddr=e.workerManagerAddr,n.response=e.response,n.errorCode=e.ec,n.success=e.succ,delete n.startTime,v.send({type:"RequestProxyWorkerManager",data:n})},requestWorkerEvent:function(t,e){var n=a()({},v.list[t]),r=n.startTime,i=Date.now();delete(n=p({},n,{},e,{elapse:i-r,lts:i,productType:"WebRTC"})).startTime,v.send({type:"WorkerEvent",data:n})},requestApWorkerEvent:function(t,e){var n=a()({},v.list[t]),r=n.startTime,i=Date.now();n=p({},n,{},e,{elapse:i-r,lts:i}),v.send({type:"APWorkerEvent",data:n})},sendCustomReportMessage:function(t,e,n){var r={type:"UserAnalytics",data:p({sid:t},e)},i=v.getUrl(),o=!!v.proxyServerURL;Object(u.post)(i,r,(function(t){n&&n()}),(function(t){var e=v.getBackUrl();Object(u.post)(e,r,(function(t){n&&n()}),(function(t){n&&n("Failed")}),o?{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}),o?{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},joinChannelTimeOut:function(t){v.send({type:"JoinChannelTimeout",data:p({},t)})},peerPublishStatus:function(t){v.send({type:"PeerPublishStatus",data:p({},t)})},joinWebProxyAP:function(t){v.send({type:"JoinWebProxyAP",data:p({},t)})},webSocketQuit:function(t){v.send({type:"WebSocketQuit",data:p({},t)})}}).reportApiInvoke=function(t,e){var n=e.tag,r=e.name,i=e.getStates,o=e.options,a=e.timeout,u=void 0===a?6e4:a,l=e.callback,d=e.reportResult,h=void 0===d||d,f=Date.now(),v=0,g=m++,A=function(){return p({tag:n,invokeId:g,sid:t,name:r,apiInvokeTime:f,options:o},i&&{states:(e=i(),Object.keys(e).reduce((function(t,n){var r=t;return null!=e[n]&&(r[n]=e[n]),r}),{}))});var e},y=!!Object(s.getParameter)("SHOW_REPORT_INVOKER_LOG");y&&c.default.info("".concat(r," start"));var b=setTimeout((function(){C._sendApiInvoke(p({},A(),{error:"API_INVOKE_TIMEOUT",success:!1}))}),u);return function(t,e){if(clearTimeout(b),++v>1&&(t="EXECUTOR_INVOKE_".concat(v)),t)return C._sendApiInvoke(p({},A(),{success:!1,error:t},i&&{states:i()})),y&&c.default.info("".concat(r," onFailure"),t),l&&l(t);C._sendApiInvoke(p({},A(),{success:!0},h&&{result:e},{},i&&{states:i()})),y&&c.default.info("".concat(r," onSuccess")),l&&l(null,e)}},v._cachedItems=[],v._cacheInvokeReport=function(t){t.lts||(t.lts=Date.now()),v._cachedItems.push(t),v._cachedItems.length>50&&v._cachedItems.shift()},v._flushInvokeReport=function(t){if(v._cachedItems.length){var e=v._cachedItems;v._cachedItems=[],c.default.debug("Flush cached event reporting:",e.length),e.forEach((function(e,n){e.sid=t,setTimeout((function(){v._sendApiInvoke(e)}),5e3+500*n)}))}},v._sendApiInvoke=function(t){var e=t.tag,n=t.invokeId,r=t.sid,i=t.name,o=t.result,a=t.states,c=t.options,u=t.error,l=t.success,d=t.apiInvokeTime,h=t.lts,f=Object(s.getParameter)("NOT_REPORT_EVENT");if(!(e&&f instanceof Array&&-1!==f.indexOf(e)))if(v.list[r]){var m=v.list[r],g=m.startTime,A=m.cname,y=m.uid,b=m.cid,w=(h=h||Date.now())-g,E=h-d,_="";if(c)try{_=JSON.stringify(c)}catch(t){_=c.toString()}var S=p({invokeId:n,sid:r,cname:A,cid:b,lts:h,uid:y,success:l,elapse:w,apiName:i,execElapse:E},void 0!==c&&{options:_},{},void 0!==a&&{execStates:JSON.stringify(a)},{},void 0!==u&&{errorCode:JSON.stringify(u)},{},void 0!==o&&{execResult:JSON.stringify(o)});v.send({type:"ApiInvoke",data:S})}else v._cacheInvokeReport(arguments[0])},v.sendCache=[],v.sendTimer=null,v.send=function(t){if(t.data){var e=t.data;v._lastLts&&v._lastLts>=e.lts&&(e.lts=v._lastLts+1),v._lastLts=e.lts}if(v.sendCache.push(t),null===v.sendTimer)return function t(){v.sendTimer=setTimeout((function(){if(0!==v.sendCache.length){var e=v.sendCache.length<10?v.sendCache.splice(0,v.sendCache.length):v.sendCache.splice(0,10),n=v.list[e[0].data.sid].vid;return E.sendReportList(e,n),t()}v.sendTimer=null}),Object(s.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},v)},function(t,e,n){"use strict";n.r(e),n.d(e,"checkValidObject",(function(){return s})),n.d(e,"checkValidString",(function(){return c})),n.d(e,"checkValidNumber",(function(){return u})),n.d(e,"checkValidArray",(function(){return l})),n.d(e,"checkValidFloatNumber",(function(){return d})),n.d(e,"checkValidBoolean",(function(){return h})),n.d(e,"checkValidEnum",(function(){return a})),n.d(e,"checkValidUID",(function(){return f})),n.d(e,"isValidString",(function(){return p})),n.d(e,"isValidNumber",(function(){return v})),n.d(e,"isValidBoolean",(function(){return g})),n.d(e,"isASCII",(function(){return b})),n.d(e,"isInteger",(function(){return w})),n.d(e,"isNumber",(function(){return E})),n.d(e,"isString",(function(){return _})),n.d(e,"isArray",(function(){return S})),n.d(e,"isEmpty",(function(){return T})),n.d(e,"isValidToken",(function(){return A})),n.d(e,"isValidChannelName",(function(){return y}));var r=n(11),i=n.n(r),o=n(10),a=function(t,e,n){for(var r=0;r<n.length;r++)if(t===n[r])return!0;throw new Error("".concat(e," can only be set as ").concat(JSON.stringify(n)))},s=function(t,e){if(!t)throw new Error("Invalid param: ".concat(e||"param"," cannot be empty"));if("object"!==i()(t))throw new Error("".concat(e||"This paramter"," is of the object type"));return!0},c=function(t,e,n,r,i){if(T(n)&&(n=1),r=r||255,T(i)&&(i=!0),T(t))throw new Error("".concat(e||"param"," cannot be empty"));if(!p(t,n,r,i))throw new Error("Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))},u=function(t,e,n,r){if(T(n)&&(n=1),r=r||1e4,T(t))throw new Error("".concat(e||"param"," cannot be empty"));if(!v(t,n,r))throw new Error("Invalid ".concat(e||"number param",": The value range is [").concat(n,",").concat(r,"]. integer only"))},l=function(t,e){if(!Array.isArray(t))throw new Error("".concat(e," should be an array"))},d=function(t,e,n,r){if(null==t)throw new Error("".concat(e||"param"," cannot be null"));if(T(n)&&(n=0),r=r||1e4,T(t))throw new Error("".concat(e||"param"," cannot be empty"));if(!m(t,n,r))throw new Error("Invalid ".concat(e||"number param",": The value range is [").concat(n,",").concat(r,"]."))},h=function(t,e){if(T(t))throw new Error("".concat(e||"param"," cannot be empty"));if(!g(t))throw new Error("Invalid ".concat(e||"boolean param",": The value is of the boolean type."))},f=function(t){if(!Object(o.is32Uint)(t)&&!p(t,1,255))throw logger.error("Invalid UID ".concat(t," ").concat(i()(t))),new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")},p=function(t,e,n,r){return e||(e=0),n||(n=Number.MAX_SAFE_INTEGER),T(r)&&(r=!0),_(t)&&(!r||b(t))&&t.length>=e&&t.length<=n},v=function(t,e,n){return w(t)&&t>=e&&t<=n},m=function(t,e,n){return E(t)&&t>=e&&t<=n},g=function(t){return"boolean"==typeof t},A=function(t){return p(t,1,2047)},y=function(t){return _(t)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t)},b=function(t){if("string"==typeof t){for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);if(n<0||n>255)return!1}return!0}},w=function(t){return"number"==typeof t&&t%1==0},E=function(t){return"number"==typeof t},_=function(t){return"string"==typeof t},S=function(t){return t instanceof Array},T=function(t){return null==t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BUILD="v3.5.2-0-g0d49ed1",e.VERSION="3.5.2";var r=0*Date.now()+11499+86604+5615+6547+846;e.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,100,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},e.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var i={AREA_SETTING:["NORTH_AMERICA","OVERSEA"],WEBCS_DOMAIN:["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],LOG_UPLOAD_SERVER:"logservice-oversea.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1-oversea.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"statscollector-2-oversea.agora.io",ENABLE_LIVE_SERVER_LIST:!1,LIVE_SERVER_LIST:[],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,GATEWAY_DOMAINS:["edge.agora.io"],WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,LIVESTREAMING_ALIGN:!0,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e7,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,REPORT_STATS_TIMEOUT:3e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,TICKET_RENEW_TIMEOUT:828e5,LIVE_STREAMING_TIMEOUT:12e4,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,FORCE_CHANGED_GATEWAY_FLAG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",CHROME_NEW_STATS:!1,AP_BACKOFF_MAX_TIME:8,SET_DEFAULT_TURNSERVER:!0,TURN_SERVER_PASSWORD:r.toString(),PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",NGINX:"webrtc-cloud-proxy.agora.io",CR:!0,CRL:10,CRI:6,CUSTOMER_REPORT_TIMEOUT:5e3,LIVE_STREAMING_ADDRESS:""};i.AREA_SETTING=["CHINA","GLOBAL"],i.WEBCS_DOMAIN=["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],i.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],i.PROXY_CS=["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],i.CDS_AP=["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],i.ACCOUNT_REGISTER=["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],i.UAP_AP=["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],i.LOG_UPLOAD_SERVER="logservice.agora.io",i.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",i.EVENT_REPORT_BACKUP_DOMAIN="web-3.statscollector.sd-rtn.com",i.GATEWAY_DOMAINS=["edge.agora.io","edge.sd-rtn.com"],i.NGINX="webrtc-cloud-proxy.sd-rtn.com",e.setParameter=function(t,e){return void 0!==i[t]&&(i[t]=e,!0)},e.getParameter=function(t){return void 0!==i[t]?i[t]:null}},function(t,e,n){"use strict";n.r(e),n.d(e,"getBrowserInfo",(function(){return A})),n.d(e,"getBrowserVersion",(function(){return h})),n.d(e,"getBrowserOS",(function(){return f})),n.d(e,"isChrome",(function(){return r})),n.d(e,"isSafari",(function(){return i})),n.d(e,"isFireFox",(function(){return a})),n.d(e,"isOpera",(function(){return s})),n.d(e,"isEdge",(function(){return o})),n.d(e,"isQQBrowser",(function(){return c})),n.d(e,"isWeChatBrowser",(function(){return u})),n.d(e,"isLegacyChrome",(function(){return v})),n.d(e,"isSupportedPC",(function(){return l})),n.d(e,"isSupportedMobile",(function(){return d})),n.d(e,"getChromeKernelVersion",(function(){return g})),n.d(e,"isChromeKernel",(function(){return p}));var r=function(){var t=A();return t.name&&"Chrome"===t.name},i=function(){var t=A();return t.name&&"Safari"===t.name},o=function(){var t=A();return t.name&&"Edge"===t.name},a=function(){var t=A();return t.name&&"Firefox"===t.name},s=function(){var t=A();return t.name&&"OPR"===t.name},c=function(){var t=A();return t.name&&"QQBrowser"===t.name},u=function(){var t=A();return t.name&&"MicroMessenger"===t.name},l=function(){var t=f();return"Linux"===t||"Mac OS X"===t||"Mac OS"===t||-1!==t.indexOf("Windows")},d=function(){var t=f();return"Android"===t||"iOS"===t},h=function(){return A().version},f=function(){return A().os},p=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)};function v(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var m,g=function(){var t=navigator.userAgent.match(/chrome\/[\d]./i);return t&&t[0]&&t[0].split("/")[1]},A=(m=function(){var t,e=navigator.userAgent,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(t=e.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=t),"Safari"===n[1]&&null!=(t=e.match(/version\/(\d+)/i))&&(n[2]=t[1]),~e.toLowerCase().indexOf("qqbrowser")&&null!=(t=e.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=t),~e.toLowerCase().indexOf("micromessenger")&&null!=(t=e.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=t),~e.toLowerCase().indexOf("edge")&&null!=(t=e.match(/(edge(?=\/))\/?(\d+)/i))&&(n=t),~e.toLowerCase().indexOf("trident")&&null!=(t=/\brv[ :]+(\d+)/g.exec(e)||[])&&(n=[null,"IE",t[1]]);var r=void 0,i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var o in i){var a=i[o];if(a.r.test(navigator.userAgent)){r=a.s;break}}return{name:n[1],version:n[2],os:r}}(),function(){return m})},function(t,e,n){"use strict";n.r(e),n.d(e,"APErrorCode",(function(){return r})),n.d(e,"GatewayErrorCode",(function(){return i})),n.d(e,"StringUidErrorCode",(function(){return o})),n.d(e,"JOIN_GS_TRYNEXT_LIST",(function(){return a})),n.d(e,"JOIN_CS_RETRY_LIST",(function(){return s})),n.d(e,"JOIN_PROXY_RETRY_LIST",(function(){return c})),n.d(e,"INJECT_STREAM_STATUS",(function(){return u})),n.d(e,"WEBSOCKET_CLOSE_REASON",(function(){return l}));var r={1010100:"NO_FLAG_SET",1010101:"FLAG_SET_BUT_EMPTY",1010102:"INVALID_FALG_SET",2010005:"INVALID_VENDOR_KEY",2010007:"INVALID_CHANNEL_NAME",2010008:"INTERNAL_ERROR",2010009:"NO_AUTHORIZED",2010010:"DYNAMIC_KEY_TIMEOUT",2010011:"NO_ACTIVE_STATUS",2010013:"DYNAMIC_KEY_EXPIRED",2010014:"STATIC_USE_DYANMIC_KEY",2010015:"DYNAMIC_USE_STATIC_KEY",2010016:"USER_OVERLOAD",2010018:"FORBIDDEN_REGION",2010019:"CANNOT_MEET_AREA_DEMAND"},i={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",2011:"ERR_NOT_JOINED",2012:"WARN_REPEAT_JOIN",2013:"ERR_INVALID_VENDOR_KEY",2014:"ERR_INVALID_CHANNEL_NAME",2015:"ERR_INVALID_STRINGUID",2016:"ERR_TOO_MANY_USERS",2017:"ERR_SET_CLIENT_ROLE_TIMEOUT",2018:"ERR_SET_CLIENT_ROLE_NO_PERMISSION",2019:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",2020:"ERR_PUBLISH_REQUEST_INVALID",2021:"ERR_SUBSCRIBE_REQUEST_INVALID",2022:"ERR_NOT_SUPPORTED_MESSAGE",2023:"ERR_ILLEAGAL_PLUGIN",2028:"ILLEGAL_AES_PASSWORD",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},o={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},a=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],s=["NO_SERVICE_AVAILABLE"],c=["NO_SERVICE_AVAILABLE","REQUEST_PROXY_SERVER_FAILED","REQUEST_PROXY_SERVER_TIME_OUT"],u={INJECT_STREAM_STATUS_START_SUCCESS:0,INJECT_STREAM_STATUS_START_ALREADY_EXISTS:1,INJECT_STREAM_STATUS_START_UNAUTHORIZED:2,INJECT_STREAM_STATUS_START_TIMEDOUT:3,INJECT_STREAM_STATUS_START_FAILED:4,INJECT_STREAM_STATUS_STOP_SUCCESS:5,INJECT_STREAM_STATUS_STOP_NOT_FOUND:6,INJECT_STREAM_STATUS_STOP_UNAUTHORIZED:7,INJECT_STREAM_STATUS_STOP_TIMEDOUT:8,INJECT_STREAM_STATUS_STOP_FAILED:9,INJECT_STREAM_STATUS_BROKEN:10},l={WS_DISCONNECT:"WS_DISCONNECT"};e.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",NO_TRACK_IN_STREAM:"NO_TRACK_IN_STREAM",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",PLAYER_NOT_FOUND:"PLAYER_NOT_FOUND",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN",BAD_ENVIRONMENT:"BAD_ENVIRONMENT",LOAD_AUDIO_FAILED:"LOAD_AUDIO_FAILED"}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),n(0);var r=function(t,e,n){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight","VideoPublishDuration","AudioPublishDuration"].indexOf(e)>-1&&("string"==typeof n||isFinite(n)))return t[e]=""+n},i=function(t){var e={};return t.forEach((function(t){t.id&&t.type&&(-1===t.id.indexOf("send")&&-1===t.type.toLowerCase().indexOf("outbound")&&-1===t.id.indexOf("outbound_rtp")&&-1===t.id.indexOf("OutboundRTP")||("audio"===t.mediaType?(r(e,"audioSendBytes",t.bytesSent),r(e,"audioSendPackets",t.packetsSent),r(e,"audioSendPacketsLost",t.packetsLost)):(r(e,"videoSendBytes",t.bytesSent),r(e,"videoSendPackets",t.packetsSent),r(e,"videoSendPacketsLost",t.packetsLost),r(e,"videoSendFrameRate",t.googFrameRateSent),r(e,"videoSendResolutionWidth",t.googFrameWidthSent),r(e,"videoSendResolutionHeight",t.googFrameHeightSent))))})),e},o=function(t){var e={};return t.forEach((function(t){t.id&&t.type&&(-1===t.id.indexOf("recv")&&-1===t.type.toLowerCase().indexOf("inbound")&&-1===t.id.indexOf("inbound_rtp")&&-1===t.id.indexOf("inbound-rtp")&&-1===t.id.indexOf("InboundRTP")||("audio"===t.mediaType?(r(e,"audioReceiveBytes",t.bytesReceived),r(e,"audioReceivePackets",t.packetsReceived),r(e,"audioReceivePacketsLost",t.packetsLost)):(r(e,"videoReceiveBytes",t.bytesReceived),r(e,"videoReceivePacketsLost",t.packetsLost),r(e,"videoReceivePackets",t.packetsReceived),r(e,"videoReceiveFrameRate",t.googFrameRateReceived),r(e,"videoReceiveDecodeFrameRate",t.googFrameRateDecoded),r(e,"videoReceiveResolutionWidth",t.googFrameWidthReceived),r(e,"videoReceiveResolutionHeight",t.googFrameHeightReceived))))})),e}},function(t,e){function n(){return t.exports=n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},n.apply(this,arguments)}t.exports=n},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"e",(function(){return a})),n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return u}));var r=n(0),i=function(){var t={dispatcher:{}};return t.dispatcher.eventListeners={},t.addEventListener=function(e,n){void 0===t.dispatcher.eventListeners[e]&&(t.dispatcher.eventListeners[e]=[]),t.dispatcher.eventListeners[e].push(n)},t.hasListeners=function(e){return!(!t.dispatcher.eventListeners[e]||!t.dispatcher.eventListeners[e].length)},t.on=t.addEventListener,t.removeEventListener=function(e,n){var r;t.dispatcher.eventListeners[e]&&-1!==(r=t.dispatcher.eventListeners[e].indexOf(n))&&t.dispatcher.eventListeners[e].splice(r,1)},t.dispatchEvent=function(e){var n;for(n in t.dispatcher.eventListeners[e.type])if(t.dispatcher.eventListeners[e.type]&&t.dispatcher.eventListeners[e.type].hasOwnProperty(n)&&"function"==typeof t.dispatcher.eventListeners[e.type][n])try{t.dispatcher.eventListeners[e.type][n](e)}catch(n){r.default.debug("[".concat(t.clientId,"] Error in ").concat(e.type," event"),n)}},t.dispatchSocketEvent=function(e){var n;for(n in t.dispatcher.eventListeners[e.type])t.dispatcher.eventListeners[e.type]&&t.dispatcher.eventListeners[e.type].hasOwnProperty(n)&&"function"==typeof t.dispatcher.eventListeners[e.type][n]&&t.dispatcher.eventListeners[e.type][n](e.msg)},t},o=function(t){var e={};return e.type=t.type,e},a=function(t){var e=o(t);return e.stream=t.stream,e.reason=t.reason,e.msg=t.msg,e},s=function(t){var e=o(t);return e.uid=t.uid,e.attr=t.attr,e.stream=t.stream,e},c=function(t){var e=o(t);return e.msg=t.msg,e},u=function(t){var e=o(t);return e.url=t.url,e.uid=t.uid,e.status=t.status,e.reason=t.reason,e}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=s(n(67)),u=n(3),l=s(n(0)),d=n(2),h=n(14),f=n(10),p=function(t){function e(e,n){var r=t.call(this)||this;return r._state=y.RELAY_STATE_IDLE,r._onStatus=function(t){l.default.debug("["+r.clientId+"] ChannelMediaStatus: "+JSON.stringify(t)),t&&t.command&&("onAudioPacketReceived"===t.command&&r.emit("event",A.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===t.command&&r.emit("event",A.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===t.command&&(r._state=y.RELAY_STATE_FAILURE,r.emit("state",y.RELAY_STATE_FAILURE,b.SRC_TOKEN_EXPIRED)),"onDestTokenPrivilegeDidExpire"===t.command&&(r._state=y.RELAY_STATE_FAILURE,r.emit("state",y.RELAY_STATE_FAILURE,b.DEST_TOKEN_EXPIRED,t.channelName?{came:t.channelName}:null)))},r._onClose=function(){return o(r,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:if(l.default.debug("["+this.clientId+"] ChannelMediaSocket onClose"),this.emit("event",A.NETWORK_DISCONNECTED),this.state=y.RELAY_STATE_IDLE,!this._prevChannelMediaConfig)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startChannelMediaRelay(this._prevChannelMediaConfig)];case 2:return e.sent(),[3,4];case 3:return(t=e.sent())instanceof E&&(t.message===m.WS_ABORT||t.message===m.AP_REQUEST_ABORT)?[2]:(this.emit("state",y.RELAY_STATE_FAILURE,b.SERVER_CONNECTION_LOST),[3,4]);case 4:return[2]}}))}))},r.token=e.appId,r.appId=e.appId,r.cname=e.cname,r.uid=e.uid,r.sid=e.sid,r.clientId=n,r}return i(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){var e=this._state;this._state=t,e!==t&&this.emit("state",t)},enumerable:!0,configurable:!0}),e.prototype.startChannelMediaRelay=function(t){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:if(this.state!==y.RELAY_STATE_IDLE)throw new E(m.BAD_STATE);return this.state=y.RELAY_STATE_CONNECTING,[4,this._connect()];case 1:return e.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: connect success"),[4,this._sendStartRelayMessage(t)];case 2:return e.sent(),this._prevChannelMediaConfig=t,[2]}}))}))},e.prototype.updateChannelMediaRelay=function(t){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:if(this.state!==y.RELAY_STATE_RUNNING)throw new E(m.BAD_STATE);return[4,this._sendUpdateMessage(t)];case 1:return e.sent(),this._prevChannelMediaConfig=t,[2]}}))}))},e.prototype.stopChannelMediaRelay=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this._sendStopRelayMessage()];case 1:return t.sent(),l.default.debug("["+this.clientId+"] stopChannelMediaRelay: send stop message success"),this.state=y.RELAY_STATE_IDLE,this.dispose(),[2]}}))}))},e.prototype.dispose=function(){l.default.debug("["+this.clientId+"] disposeChannelMediaRelay"),this.state=y.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()},e.prototype._requestOneAP=function(t){var e=this;return new Promise((function(n,r){var i={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:"",ts:+new Date,version:u.VERSION,cname:e.cname,uid:e.uid+"",seq:1,requestId:1},o={service_name:"tele_channel",json_body:JSON.stringify(i)},a="https://"+t;h.post(a,o,(function(t){var e=null,i=null;try{e=JSON.parse(t)}catch(t){r(new E(m.AP_JSON_PARSE_ERROR,t))}0!==e.code&&r(new E(m.AP_REQUEST_ERROR,e));try{i=JSON.parse(e.json_body)}catch(t){r(new E(m.AP_JSON_PARSE_ERROR,t))}200!==i.code&&r(new E(m.AP_REQUEST_ERROR,i)),i.servers?n(i.servers):r(new E(m.AP_JSON_PARSE_ERROR,i))}),(function(t){return r(t)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})}))},e.prototype._requestAP=function(){var t=this,e=u.getParameter("UAP_AP");return new Promise((function(n,r){setTimeout((function(){r(new E(m.AP_REQUEST_TIMEOUT))}),5e3),t.on("dispose",(function(){r(new E(m.AP_REQUEST_ABORT))})),e.forEach((function(e){e+="/api/v1",t._requestOneAP(e).then((function(r){l.default.debug("["+t.clientId+"] startChannelMediaRelay request AP "+e+" success: "+JSON.stringify(r));var i=r[0],o="wss://"+i.address.replace(/\./g,"-")+".edge.agora.io:"+i.wss;n(o)})).catch((function(n){l.default.debug("["+t.clientId+"] startChannelMediaRelay request AP "+e+" failed: "+JSON.stringify(n))}))}))}))},e.prototype._connectWebsocket=function(t){return this._signal=new w(this.appId,this.cname,this.uid,this.sid),this._signal.connect(t)},e.prototype._connect=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,this._requestAP()];case 1:return t=e.sent(),[4,this._connectWebsocket(t)];case 2:return e.sent(),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",A.NETWORK_CONNECTED),[2]}}))}))},e.prototype._sendStartRelayMessage=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return this._checkSignal(),e=this._genMessage(g.StopPacketTransfer),[4,this._signal.request(e)];case 1:return a.sent(),[4,this._signal.waitStatus("Normal Quit")];case 2:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: StopPacketTransfer success"),n=this._genMessage(g.SetSdkProfile,t),[4,this._signal.request(n)];case 3:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSdkProfile success"),r=this._genMessage(g.SetSourceChannel,t),[4,this._signal.request(r)];case 4:return a.sent(),[4,this._signal.waitStatus("SetSourceChannelStatus")];case 5:return a.sent(),this.emit("event",A.PACKET_JOINED_SRC_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceChannel success"),i=this._genMessage(g.SetSourceUserId,t),[4,this._signal.request(i)];case 6:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceUserId success"),o=this._genMessage(g.SetDestChannel,t),[4,this._signal.request(o)];case 7:return a.sent(),[4,this._signal.waitStatus("SetDestChannelStatus")];case 8:return a.sent(),this.emit("event",A.PACKET_JOINED_DEST_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetDestChannel success"),s=this._genMessage(g.StartPacketTransfer,t),[4,this._signal.request(s)];case 9:return a.sent(),this.emit("event",A.PACKET_SENT_TO_DEST_CHANNEL),this.state=y.RELAY_STATE_RUNNING,l.default.debug("["+this.clientId+"] startChannelMediaRelay: StartPacketTransfer success"),[2]}}))}))},e.prototype._sendReconnectMessage=function(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return this._checkSignal(),e=this._genMessage(g.Reconnect,t),[4,this._signal.request(e)];case 1:return n.sent(),[2]}}))}))},e.prototype._sendUpdateMessage=function(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return this._checkSignal(),e=this._genMessage(g.UpdateDestChannel,t),[4,this._signal.request(e)];case 1:return n.sent(),this.emit("event",A.PACKET_UPDATE_DEST_CHANNEL),l.default.debug("["+this.clientId+"] sendUpdateMessage: UpdateDestChannel success"),[2]}}))}))},e.prototype._sendStopRelayMessage=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return this._checkSignal(),t=this._genMessage(g.StopPacketTransfer),[4,this._signal.request(t)];case 1:return e.sent(),l.default.debug("["+this.clientId+"] sendStopRelayMessage: StopPacketTransfer success"),[2]}}))}))},e.prototype._genMessage=function(t,e){var n=this,r=[],i=[],o=[],a={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:u.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}},s=null;switch(t){case g.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case g.SetSourceChannel:return s=e.getSrcChannelMediaInfo(),a.clientRequest={command:"SetSourceChannel",uid:s.uid+"",channelName:s.channelName,token:s.token||this.appId},a;case g.SetSourceUserId:return s=e.getSrcChannelMediaInfo(),a.clientRequest={command:"SetSourceUserId",uid:this.uid+""},a;case g.SetDestChannel:return e.getDestChannelMediaInfos().forEach((function(t){r.push(t.channelName),i.push(t.uid+""),o.push(t.token||n.appId)})),a.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:o},a;case g.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case g.Reconnect:return a.clientRequest={command:"Reconnect"},a;case g.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case g.UpdateDestChannel:return e.getDestChannelMediaInfos().forEach((function(t){r.push(t.channelName),i.push(t.uid+""),o.push(t.token||n.appId)})),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:o},a}},e.prototype._checkSignal=function(){if(!this._signal||!this._signal.isConnect())throw new E(m.WS_DISCONNECTED)},e}(c.default);e.default=p;var v=function(){function t(){this.destChannelMediaInfos=new Map}return t.prototype.setSrcChannelInfo=function(t){d.checkValidObject(t,"srcInfo");var e=t.uid,n=t.channelName,r=t.token;if(r&&!d.isValidToken(r))throw new Error("Invalid token in SrcChannelInfo");if(!d.isValidChannelName(n))throw new Error("Invalid channelName in SrcChannelInfo");if(!f.is32Uint(e))throw new Error("Invalid uid in SrcChannelInfo");this.srcChannelMediaInfo=t},t.prototype.setDestChannelInfo=function(t,e){if(!d.isValidChannelName(t))throw new Error("Invalid channelName in DestChannelInfo");d.checkValidObject(e,"destInfo");var n=e.uid,r=e.token,i=e.channelName;if(r&&!d.isValidToken(r))throw new Error("Invalid token in DestChannelInfo");if(!d.isValidChannelName(i))throw new Error("Invalid channelName in DestChannelInfo");if(!f.is32Uint(n))throw new Error("Invalid uid in DestChannelInfo");this.destChannelMediaInfos.set(t,e)},t.prototype.removeDestChannelInfo=function(t){if(!d.isValidChannelName(t))throw new Error("Invalid channelName when invoke removeDestChannelInfo");this.destChannelMediaInfos.delete(t)},t.prototype.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},t.prototype.getDestChannelMediaInfos=function(){return this.destChannelMediaInfos},t}();e.ChannelMediaRelayConfiguration=v;var m,g,A,y,b,w=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o._onOpen=function(){o.emit("open")},o._onClose=function(t){o.emit("close"),o.dispose()},o._onMessage=function(t){var e=JSON.parse(t.data);if(!e||"serverResponse"!==e.command||!e.requestId)return e&&"serverStatus"===e.command&&e.serverStatus&&e.serverStatus.command?(o.emit("status",e.serverStatus),void o.emit(e.serverStatus.command,e.serverStatus)):void 0;o.emit("req_"+e.requestId,e)},o._requestId=1,o.appId=e,o.cname=n,o.uid=r,o.sid=i,o}return i(e,t),e.prototype.isConnect=function(){return this._ws&&this._ws.readyState===WebSocket.OPEN},e.prototype.sendMessage=function(t){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new E(m.WS_DISCONNECTED);var e=this._requestId++;return t.requestId=e,t.seq=e,this._ws.send(JSON.stringify(t)),e},e.prototype.waitStatus=function(t){var e=this;return new Promise((function(n,r){var i=window.setTimeout((function(){r(new E(m.WAIT_STATUS_TIMEOUT,t))}),5e3);e.once(t,(function(e){clearTimeout(i),e.state&&0!==e.state?r(new E(m.WAIT_STATUS_ERROR,t)):n()})),e.once("dispose",(function(){clearTimeout(i),r(new E(m.WS_ABORT))}))}))},e.prototype.request=function(t){var e=this;return new Promise((function(n,r){var i=e.sendMessage(t),o=window.setTimeout((function(){e.removeAllListeners("req_"+i),r(new E(m.REQUEST_TIMEOUT))}),3e3);e.once("req_"+i,(function(t){clearTimeout(o),t&&200===t.code?n(t):r(new E(m.REQUEST_FAILED,t))})),e.once("dispose",(function(){clearTimeout(o),r(new E(m.WS_ABORT))}))}))},e.prototype.connect=function(t){var e=this;return new Promise((function(n,r){e._ws=new WebSocket(t),e._ws.onopen=function(){e._onOpen(),e._prvUrl=t,e._ws.onmessage=e._onMessage,e._ws.onclose=e._onClose,e._startHeartBeatCheck(),n()},e._ws.onclose=function(t){e._ws=null,r(new E(m.CONNECT_FAILED,"websocket error code: "+t.code))},setTimeout((function(){e._ws&&e._ws.readyState!==WebSocket.OPEN&&(e._ws.onopen=null,e._ws.onclose=null,e._ws.close(),e._ws=null,r(new E(m.CONNECT_TIMEOUT)))}),5e3),e.once("dispose",(function(){r(new E(m.WS_ABORT))}))}))},e.prototype.dispose=function(){this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.close()),this._ws=null},e.prototype._sendPing=function(t){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new E(m.WS_DISCONNECTED);var e=this._requestId++;return t.requestId=e,this._ws.send(JSON.stringify(t)),e},e.prototype._startHeartBeatCheck=function(){var t=this;this._heartBeatTimer=window.setInterval((function(){t._sendPing({command:"ping",appId:t.appId,cname:t.cname,uid:t.uid+"",sid:t.sid,ts:+new Date,requestId:0})}),3e3)},e.prototype._clearHeartBeatCheck=function(){window.clearInterval(this._heartBeatTimer)},e}(c.default),E=function(t,e,n){void 0===t&&(t=""),this.code=n,this.data=e,this.message=t};e.ChannelMediaError=E,function(t){t.CONNECT_FAILED="connect failed",t.CONNECT_TIMEOUT="connect timeout",t.WS_DISCONNECTED="websocket disconnected",t.REQUEST_TIMEOUT="request timeout",t.REQUEST_FAILED="request failed",t.WAIT_STATUS_TIMEOUT="wait status timeout",t.WAIT_STATUS_ERROR="wait status error",t.BAD_STATE="bad state",t.WS_ABORT="ws abort",t.AP_REQUEST_TIMEOUT="AP request timeout",t.AP_JSON_PARSE_ERROR="AP json parse error",t.AP_REQUEST_ERROR="AP request error",t.AP_REQUEST_ABORT="AP request abort"}(m=e.CHANNEL_MEDIA_ERROR||(e.CHANNEL_MEDIA_ERROR={})),function(t){t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile"}(g||(g={})),function(t){t[t.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",t[t.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",t[t.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",t[t.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",t[t.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",t[t.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",t[t.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",t[t.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",t[t.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t[t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(A=e.CHANNEL_MEDIA_RELAY_EVENT||(e.CHANNEL_MEDIA_RELAY_EVENT={})),function(t){t[t.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",t[t.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",t[t.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",t[t.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE"}(y=e.CHANNEL_MEDIA_RELAY_STATE||(e.CHANNEL_MEDIA_RELAY_STATE={})),function(t){t[t.RELAY_OK=0]="RELAY_OK",t[t.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",t[t.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",t[t.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",t[t.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",t[t.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",t[t.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",t[t.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",t[t.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",t[t.INTERNAL_ERROR=9]="INTERNAL_ERROR",t[t.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",t[t.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",t[t.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",t[t.RELAY_NOT_START=13]="RELAY_NOT_START",t[t.OPERATION_ABORT=14]="OPERATION_ABORT"}(b=e.CHANNEL_MEDIA_RELAY_ERROR||(e.CHANNEL_MEDIA_RELAY_ERROR={}))},function(t,e,n){"use strict";n.r(e),n.d(e,"isLiveTranscodingValid",(function(){return A})),n.d(e,"generateSessionId",(function(){return v})),n.d(e,"audioLevelHelper",(function(){return h})),n.d(e,"vsResHack",(function(){return m})),n.d(e,"is32Uint",(function(){return g})),n.d(e,"safeCall",(function(){return d})),n.d(e,"random",(function(){return b})),n.d(e,"popBanTip",(function(){return _})),n.d(e,"lengthInUtf8Bytes",(function(){return w})),n.d(e,"audioTimerLoop",(function(){return E})),n.d(e,"generateId",(function(){return p}));var r=n(11),i=n.n(r),o=n(4),a=n(0),s=n(28),c=n.n(s),u=n(25),l=n(15),d=function(){var t=arguments[0];if("function"==typeof t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e)}},h=function(t){return this.audioContext=Object(u.a)(),this.sourceNode=t.otWebkitAudioSource||this.audioContext.createMediaStreamSource(t),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var t=0,e=0;e<this.timeDomainData.length;e++)t=Math.max(t,Math.abs(this.timeDomainData[e]-128));return t/128}return a.default.warning("can't find analyser in audioLevelHelper"),0},this},f=1e4;function p(){return++f}function v(){return c()().replace(/-/g,"").toUpperCase()}var m=function(t,e,n){try{a.default.debug("start vsResHack",t);var r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(r),r.addEventListener("playing",(function(n){o.isFireFox()?r.videoWidth&&(a.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),t),e(r.videoWidth,r.videoHeight),document.body.removeChild(r)):(a.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),t),e(r.videoWidth,r.videoHeight),document.body.removeChild(r))})),Object(l.setSrcObject)(r,t)}catch(t){n(t)}},g=function(t){return"number"==typeof t&&0<=t&&t<=4294967295},A=function(t){var e=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var n in t)if("lowLatency"===n&&"boolean"!=typeof t[n]||"userConfigExtraInfo"===n&&"object"!==i()(t[n])||"transcodingUsers"===n&&!y(t[n])||!~e.indexOf(n)&&"number"!=typeof t[n])throw new Error("Param ["+n+"] is inValid");return!0},y=function(t){for(var e=0;e<t.length;e++)for(var n in t[e])if("number"!=typeof t[e][n])throw new Error("Param user["+e+"] - ["+n+"] is inValid");return!0},b=function(t){isNaN(t)&&(t=1e3);var e=+new Date,n=(e=(9301*e+49297)%233280)/233280;return Math.ceil(n*t)},w=function(t){var e=encodeURIComponent(t).match(/%[89ABab]/g);return t.length+(e?e.length:0)},E=function(t,e){var n=1/e,r=Object(u.a)(),i=r.createGain();i.gain.value=0,i.connect(r.destination);var o=!1;return function e(){var a=r.createOscillator();a.onended=e,a.connect(i),a.start(0),a.stop(r.currentTime+n),t(r.currentTime),o&&(a.onended=function(){})}(),function(){o=!0}},_=function(){if(!document.getElementById("agora-ban-tip")){var t=document.createElement("div");t.id="agora-ban-tip",t.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(t);var e=document.createElement("div");e.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",t.append(e);var n=document.createElement("div");n.style="height: 76px; display: flex; justify-content: center; align-items: center;";var r=document.createElement("span");r.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",r.innerText="!";var i=document.createElement("span");i.innerText="This browser does not support webRTC",n.append(r),n.append(i);var o=document.createElement("div");o.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",o.innerText="OK",e.append(n),e.append(o),o.onclick=function(){var t=document.getElementById("agora-ban-tip");t.parentNode.removeChild(t)}}}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,n,r){"use strict";var i=r(13),o=r.n(i),a=r(17),s=r.n(a),c=r(11),u=r.n(c),l=r(30),d=r.n(l),h=r(7),f=r.n(h),p=r(22),v=r(8),m=function(t){t&&t.apply(this,[].slice.call(arguments,1))},g=r(0),A=r(1),y=r(10),b=r(14),w=r(3),E=function(t){var e=Object(v.b)(t);e.needReconnect=!0,e.isTimeout=!1,e.isInit=!0,e.sendbytes=0,e.recvbytes=0,e.startTime=Date.now(),e.lastMsgTime=null,e.clientId=t.clientId,e.hostIndex=0,e.requestID=0,t.host instanceof Array?e.host=t.host:e.host=[t.host],e.getSendBytes=function(){return e.sendbytes},e.getRecvBytes=function(){return e.recvbytes},e.getDuration=function(){return Math.ceil((Date.now()-e.startTime)/1e3)},e.getURL=function(){return e.connection.url},e.reconnect=function(){e.isInit=!0,e.creatConnection()},e.connectNext=function(){e.isInit=!0,++e.hostIndex,g.default.debug("["+e.clientId+"] Gateway length:"+e.host.length+" current index:"+e.hostIndex),e.hostIndex>=e.host.length?e.dispatchEvent(Object(v.d)({type:"recover"})):e.creatConnection()},e.replaceHost=function(t){e.host=t||e.host,e.hostIndex=0,e.creatConnection()},e.creatConnection=function(){e.needReconnect=!0,e.lts=(new Date).getTime(),e.connection=new WebSocket("wss://"+e.host[e.hostIndex]),e.connection.binaryType="arraybuffer",e.turnConfig={};var n=t.proxyServerType;if(e.connection.url&&3!==n){var r=e.connection.url.match(/wss\:\/\/([^:]+):(\d+)/),i=e.host[e.hostIndex].split(":"),o=e.connection.url.match(/h=([^:]+)&p=(\d+)/);r?(e.turnConfig.url=r[1],Object(w.getParameter)("TURN_ENABLE_TCP")&&(e.turnConfig.tcpport=parseInt(r[2])+30),Object(w.getParameter)("TURN_ENABLE_UDP")&&(e.turnConfig.udpport=parseInt(r[2])+30)):o?(e.turnConfig.url=o[1],Object(w.getParameter)("TURN_ENABLE_TCP")&&(e.turnConfig.tcpport=parseInt(o[2])+30),Object(w.getParameter)("TURN_ENABLE_UDP")&&(e.turnConfig.udpport=parseInt(o[2])+30)):i&&(e.turnConfig.url=i[0],Object(w.getParameter)("TURN_ENABLE_TCP")&&(e.turnConfig.tcpport=parseInt(i[1])+30),Object(w.getParameter)("TURN_ENABLE_UDP")&&(e.turnConfig.udpport=parseInt(i[1])+30))}e.connection.onopen=function(t){e.needReconnect=!0,e.isTimeout=!1,e.isInit=!1,e.sendbytes=0,e.recvbytes=0,e.startTime=Date.now(),Object(b.resetHTTPByetsCount)(),clearTimeout(e.timeoutCheck),e.dispatchEvent(Object(v.d)({type:"onopen",event:t,socket:e}))},e.connection.onmessage=function(t){if(t.data instanceof ArrayBuffer)e.dispatchEvent({type:"onBinaryData",data:t.data});else{e.recvbytes+=Object(y.lengthInUtf8Bytes)(t.data);var n=JSON.parse(t.data);e.lastMsgTime=Date.now(),n.hasOwnProperty("_id")?e.dispatchEvent(Object(v.d)({type:n._id,msg:n})):n.hasOwnProperty("_type")&&e.dispatchSocketEvent(Object(v.d)({type:n._type,msg:n._message}))}},e.connection.onclose=function(n){e.needReconnect?e.isTimeout||e.isInit?(g.default.debug("["+e.clientId+"] websockect connect timeout"),A.report.joinGateway(t.sid,{lts:e.lts,succ:!1,ec:"timeout",addr:e.connection.url}),e.connectNext()):(e.dispatchEvent(Object(v.d)({type:"disconnect",event:n})),e.requests&&e.requests instanceof Array&&(e.requests.map((function(t){t.callback("REQUEST_ABORT")})),e.requests=[])):(g.default.debug("["+e.clientId+"] websockect closeed"),m(t.onFailure,n),clearTimeout(e.timeoutCheck),e.dispatchEvent(Object(v.d)({type:"close",event:n})),e.connection.onopen=void 0,e.connection.onclose=void 0,e.connection.onerror=void 0,e.connection.onmessage=void 0,e.connection=void 0)},e.connection.onerror=function(t){},setTimeout((function(){e.connection&&e.connection.readyState!=WebSocket.OPEN&&(e.isTimeout=!0,e.connection.close())}),5e3)},e.creatConnection(),e.sendMessage=function(t,n){if(e.connection&&e.connection.readyState==WebSocket.OPEN){var r=JSON.stringify(t);e.sendbytes+=Object(y.lengthInUtf8Bytes)(r),e.connection.send(r)}else n({error:"Gateway not connected"})},e.disconnect=function(){e.needReconnect=!0,e.connection.close()},e.close=function(){e.needReconnect=!1,e.connection.onclose=void 0,e.connection.close(),clearInterval(e.requestTimer),e.requests&&e.requests instanceof Array&&(e.requests.map((function(t){t.callback("REQUEST_ABORT")})),e.requests=[])},e.sendSignalCommand=function(t,n){t._id="_request_"+e.requestID,e.requestID+=1,"publish_stats"!==t._type&&"subscribe_stats"!==t._type&&"publish_stats_low"!==t._type&&e.on(t._id,(function(r){r.msg&&n&&n(r.msg._result,r.msg.message),delete e.dispatcher.eventListeners[t._id]})),e.sendMessage(t,(function(t){t.reason="NOT_CONNECTED",n&&n(t.reason,t)}))},e.requests=[];var n=function(t){var n=e.requests.findIndex((function(e){return e.id===t.type}));if(n>=0)var r=e.requests.splice(n,1)[0];r&&e.dispatcher.eventListeners[t.type]?(delete e.dispatcher.eventListeners[t.type],t.msg&&r.callback&&r.callback(t.msg._result,t.msg._message)):g.default.warning("Detached Response",t.type,t.msg)},r=function(t){var n=this,r=e.requests.findIndex((function(t){return t.id===n.id}));r>=0&&(n=e.requests.splice(r,1)[0]),n&&e.dispatcher.eventListeners[t.type]?(delete e.dispatcher.eventListeners[t.type],t.reason="NOT_CONNECTED",n.callback&&n.callback(t.reason,t)):g.default.warning("handleSendError",n)};return e.sendRequest=function(t,i){t=f()({_id:"_request_"+e.requestID},t),e.requestID+=1;var o={id:t._id,timeoutCounter:0,stalledAt:Date.now(),message:t,callback:i};e.requests.push(o),e.addEventListener(t._id,n),e.sendMessage(t,r.bind(o))},e.checkRequestTimeout=function(){for(var t=Math.ceil(Object(w.getParameter)("SIGNAL_REQUEST_TIMEOUT")/Object(w.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),n=e.requests.length-1;n>=0;n--){var r=e.requests[n];r.timeoutCounter>=t?(e.requests.splice(n,1),g.default.error("Request Timeout",r.timeoutCounter,r.message),r.callback&&r.callback("TIMEOUT")):r.timeoutCounter++}},clearInterval(e.requestTimer),e.requestTimer=setInterval(e.checkRequestTimeout,Object(w.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),e.sendReport=function(t){e.sendMessage(t,(function(){}))},e},_=function(t,e){var n={connect:function(){e.host=t,n.signal=E(e),n.on=n.signal.on,n.dispatchEvent=n.signal.dispatchEvent,n.signal.on("onopen",(function(t){n.signal.onEvent=function(t){n.dispatchEvent(Object(v.d)({type:t.event,msg:t}))},n.dispatchEvent(Object(v.d)({type:"connect",msg:t}))})),n.signal.on("onError",(function(t){var e=t.msg;onError(e.code,"error")}))},getLastMsgTime:function(){return n.signal&&n.signal.lastMsgTime},getSendBytes:function(){return n.signal.getSendBytes()},getRecvBytes:function(){return n.signal.getRecvBytes()},getDuration:function(){return n.signal.getDuration()},disconnect:function(){n.signal.disconnect()},close:function(){n.signal.close()},getURL:function(){return n.signal.getURL()},reconnect:function(){n.signal.reconnect()},connectNext:function(){n.signal.connectNext()},replaceHost:function(t){n.signal.replaceHost(t)},emitSimpleMessage:function(t,e){n.signal.sendSignalCommand(t,e)},emitRequest:function(t,e){n.signal.sendRequest(t,e)},emitReport:function(t){n.signal.sendReport(t)}};return n.connect(),n},S=r(23),T=r(5),C=r(20),x=r(4),R={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",K_SERVICE_NOT_READY:"tryNext",K_SERVICE_TOO_HEAVY:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},I={googActualEncBitrate:"A_aeb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googAvailableReceiveBandwidth:"A_arb",googTargetEncBitrate:"A_teb",googBucketDelay:"A_bd",googTransmitBitrate:"A_tb",googCodecName:"A_cn",bytesSent:"bytesSent",packetsLost:"packetsLost",packetsSent:"packetsSent",googAdaptationChanges:"A_ac",googAvgEncodeMs:"A_aem",googEncodeUsagePercent:"A_eup",googFirsReceived:"A_fr",googFrameHeightInput:"A_fhi",googFrameHeightSent:"A_fhs",googFrameRateInput:"A_fri",googFrameRateSent:"A_frs",googFrameWidthInput:"A_fwi",googFrameWidthSent:"A_fws",googNacksReceived:"A_nr",googPlisReceived:"A_pr",googRtt:"A_rtt",aecDivergentFilterFraction:"A_adff",audioInputLevel:"A_ail",googEchoCancellationReturnLoss:"A_ecrl",googEchoCancellationReturnLossEnhancement:"A_ecrle",googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_relrm",googTargetDelayMs:"A_tdm",bytesReceived:"bytesReceived",packetsReceived:"packetsReceived",googDecodeMs:"A_dm",googMaxDecodeMs:"A_mdm",googRenderDelayMs:"A_rdm",googFrameWidthReceived:"A_fwr",googFrameHeightReceived:"A_fhr",googFrameRateReceived:"A_frr",googFrameRateDecoded:"A_frd",googFrameRateOutput:"A_fro",googJitterBufferMs:"A_jbm",googCurrentDelayMs:"A_cdm",googMinPlayoutDelayMs:"A_mpdm",googNacksSent:"A_ns",googPlisSent:"A_ps",googFirsSent:"A_fs",audioOutputLevel:"A_aol",googAccelerateRate:"A_ar",googDecodingCNG:"A_dcng",googDecodingCTN:"A_dctn",googDecodingCTSG:"A_dctsg",googDecodingNormal:"A_dn",googDecodingPLC:"A_dplc",googDecodingPLCCNG:"A_dplccng",googExpandRate:"A_er",googJitterReceived:"A_jr",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sdr",googSpeechExpandRate:"A_ser",uplink_fraction_lost:"B_ufl",uplink_cumulative_lost:"B_ucl",uplink_available_bandwidth:"B_uab",period_fir:"B_fir",access_delay:"B_acd",uplink_network_quality:"B_unq",downlink_network_quality:"B_dnq",pub_audio_lost_ratio_400ms:"B_palr4",pub_video_lost_ratio_400ms:"B_pvlr4",e2e_delay:"B_ed",audio_delay:"B_ad",video_delay:"B_vd",stream_type:"B_st",e2e_audio_lost_ratio_400ms:"B_ealr4",e2e_video_lost_ratio_400ms:"B_evlr4",downlink_estimate_bandwidth:"B_deb",peer_publish_audio_duration:"B_ppad",peer_publish_video_duration:"B_ppvd"},O={};for(var M in I){var L=I[M];O[L]&&g.default.error("Key Conflict: ".concat(L,": ").concat(I[L],"| ").concat(M)),O[L]=M}var k=function(t){return I[t]||t},B=function(t){return O[t]||t},N=r(9),P=r.n(N),U=r(51),D=function t(n){var r=!1,i=function(t){return{_type:"control",_message:t}},a=function(t,e){var n={};return Object.keys(e).forEach((function(t){Object(w.getParameter)("STATS_FILTER")[t]||(n[k(t)]=e[t])})),{_type:"subscribe_related_stats",_message:{stream_type:"high",stream_id:t,stats:n}}},c=function(t){return{_type:"publish",_message:t}},l=function(t,e){var n={};return Object.keys(e).forEach((function(t){Object(w.getParameter)("STATS_FILTER")[t]||(n[k(t)]=e[t])})),{_type:"subscribe_stats",_message:{stream_id:t,stats:n}}},h=t.DISCONNECTED,b=t.CONNECTING,E=t.CONNECTED,I=t.DISCONNECTING,O=h,M=Object(v.b)(n);Object.defineProperty(M,"state",{set:function(e){var n=O;O=e,Object(C._setClientConnectionStateRecord)(M.clientId,e),e!==t.CONNECTED&&e!==t.DISCONNECTING&&(M.hasJoined=!1),n!==e&&M.dispatchEvent({type:"connection-state-change",prevState:t.connetionStateMap[n],curState:t.connetionStateMap[e]})},get:function(){return O}}),M.socket=void 0,M.state=h,M.mode=n.mode,M.role=n.role,M.codec=n.codec,M.config={},M.timers={},M.timer_counter={},M.localStreams={},M.remoteStreams={},M.remoteMuteState={},M.attemps=1,M.p2p_attemps=1,M.audioLevel={},M.activeSpeaker=void 0,M.reconnectMode="tryNext",M.rejoinAttempt=0,M.hasChangeBGPAddress=!1,M.traffic_stats={},M.clientId=n.clientId,M.pingpongCounter=0,M.hasInvokeLeave=!1,M.p2ps=new Map,M.liveStreams=new Map,M.injectLiveStreams=new Map,M.remoteStreamsInChannel=new Set,M.subscribeRequestId=new Map,M.publishRequestId=0,M.hasJoined=!1,M.isFirstSuccess=!0,M.peerPublishDurationMap=new Map,function(t){var e=m;t.makeRequest=function(n,r,i){if(void 0===t.socket)return g.default.debug("[".concat(t.clientId,"] No socket available")),void e(i,T.default.INVALID_OPERATION);try{t.socket.emitRequest(n,(function(t,e){var n;"success"===t?"function"==typeof r&&r(e):"function"==typeof i&&(n=e&&e.error_code&&T.GatewayErrorCode[e.error_code]?T.GatewayErrorCode[e.error_code]:e&&e.error_str?e.error_str:e&&e.error_code?"UNKNOW_ERROR_".concat(e.error_code):t,i(n,e))}))}catch(r){g.default.debug("[".concat(t.clientId,"] Socket emit message failed ").concat(JSON.stringify(n))),g.default.debug("[".concat(t.clientId,"] "),r),e(i,T.default.SOCKET_ERROR)}},t.makeReport=function(e){void 0===t.socket&&g.default.debug("[".concat(t.clientId,"] No socket available"));try{t.socket.emitReport(e)}catch(n){g.default.debug("[".concat(t.clientId,"] Socket emit report failed ").concat(JSON.stringify(e)))}}}(M),M.inChannelInfo={joinAt:null,duration:0},M._sendMessage=function(t,e){switch(t){case"SubscribeStats":M.makeReport(l.apply(void 0,d()(e)));break;case"SubscribeRelatedStats":M.makeReport(a.apply(void 0,d()(e)))}};var L=m;M.p2pCounter=Object(y.random)(1e5),M.generateP2PId=function(){return++M.p2pCounter},M.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},M.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},M.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},M.configPublisher=function(t){M.config=t},M.getGatewayInfo=function(t,e){M.makeRequest({_type:"gateway_info"},t,e)},M.setClientRole=function(t,e){g.default.debug("[".concat(M.clientId,"] setClientRole to ").concat(t));var n=A.report.reportApiInvoke(M.joinInfo.sid,{name:"_setClientRole",callback:e});M.makeRequest({_type:"set_client_role",_message:{role:t}},(function(){M.role=t,M.dispatchEvent({type:"client-role-changed",role:t}),n&&n(null,{role:t})}),(function(e,r){if(r&&r.code&&(e=T.GatewayErrorCode[r.code]||"UNKNOW_ERROR_"+r.code),"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE"===e)return n&&n(null);g.default.error("set Client role error to "+t+": "+e),n&&n(e)}))},M.join=function(t,e,r,i){M.hasInvokeLeave=!1,t.useProxyServer&&(M.hasChangeBGPAddress=!0);var o=(new Date).getTime(),a=t.uid;if(M.inChannelInfo.joinAt&&(M.inChannelInfo.duration+=o-M.inChannelInfo.joinAt),M.inChannelInfo.joinAt=o,M.state!==b)return g.default.error("[".concat(M.clientId,"] GatewayClient.join Failed: state "),M.state),i&&i(T.default.INVALID_OPERATION),void A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:T.default.INVALID_OPERATION,addr:null});if(null!=a&&parseInt(a)!==a)return g.default.error("[".concat(M.clientId,"] Input uid is invalid")),M.state=h,i&&i(T.default.INVALID_PARAMETER),void A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:T.default.INVALID_PARAMETER,addr:null});var s=F.register(M,{uid:a,cname:t&&t.cname});if(s)return M.state=h,i&&i(s),void A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:s,addr:null});M.joinInfo=f()({},t),M.uid=a,M.key=e,M.pingpongCounter=0,V(t,(function(e){if(t.useLocalAccessPoint)try{var s=M.socket.signal.connection.url.match(/wss\:\/\/([^:]+):(\d+)/)[1];Object(w.setParameter)("EVENT_REPORT_DOMAIN",s),Object(w.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",s),Object(w.setParameter)("LOG_UPLOAD_SERVER","".concat(s,":6444"))}catch(t){g.default.debug("[".concat(M.clientId,"] LocalAccessPoint error: ").concat(t))}if(M.state===I||M.state===h)return i&&i("LEAVE_BEFORE_JOIN_SUCCESS");M.state=E,g.default.debug("[".concat(M.clientId,"] Connected to gateway server")),clearInterval(M.pingTimer),M.pingTimer=setInterval((function(){var t=Object(w.getParameter)("PING_PONG_TIME_OUT");if(++M.pingpongCounter>=t){var e=Date.now();M.socket&&g.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-M.socket.getLastMsgTime(),"ms")),M.socket&&M.socket.getLastMsgTime()&&e-M.socket.getLastMsgTime()>Object(w.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(M.pingpongCounter=0,M.socket.close(),M.socket.dispatchEvent(Object(v.d)({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var n=Date.now();M.makeRequest({_type:"ping"},(function(){M.pingpongCounter=0;var t=Date.now()-n;setTimeout((function(){Object(w.getParameter)("REPORT_STATS")&&M.makeRequest({_type:"ping_back",_message:{pingpongElapse:t}})}),1e3)}),(function(t,e){"TIMEOUT"!==t&&(g.default.error("Ping Error ".concat(t," ").concat(JSON.stringify(e))),e&&e.error_code&&M.socket&&M.socket.signal&&M.socket.signal.connection&&M.socket.signal.connection.readyState===WebSocket.OPEN&&(g.default.info("Disconnecting websocket connection"),M.socket.signal.connection.close()))}))}),3e3),M.makeRequest(function(t){var e=t.role,r=f()({},M.joinInfo.apResponse),i={session_id:M.joinInfo.sid,app_id:n.appId,channel_key:M.key,channel_name:M.joinInfo.cname,sdk_version:w.VERSION,browser:navigator.userAgent,process_id:Object(A.getProcessId)(),mode:M.mode,codec:M.codec,role:e,has_changed_gateway:Object(w.getParameter)("FORCE_CHANGED_GATEWAY_FLAG")||M.hasChangeBGPAddress,ap_response:r,optionalInfo:M.joinInfo.optionalInfo,extend:Object(w.getParameter)("JOIN_EXTEND"),details:{}};if(M.joinInfo.hasOwnProperty("stringUid")&&(i.string_uid=M.joinInfo.stringUid),M.joinInfo.aesmode&&M.joinInfo.aespassword&&(i.aes_mode=M.joinInfo.aesmode,i.aes_secret=Object(U.encryptAES)(M.joinInfo.aespassword,M.joinInfo.uid),i.aes_encrypt=!0),M.socket&&M.socket.signal&&M.socket.signal&&(r.addresses[M.socket.signal.hostIndex]&&(i.ap_response.ticket=r.addresses[M.socket.signal.hostIndex].ticket,delete r.addresses),Object(w.getParameter)("SET_DEFAULT_TURNSERVER")&&M.socket.signal.turnConfig)){var o={username:"test",credential:Object(w.getParameter)("TURN_SERVER_PASSWORD"),forceturn:Object(w.getParameter)("FORCE_TURN")};o.url=M.socket.signal.turnConfig.url,M.socket.signal.turnConfig.tcpport&&(o.tcpport=""+M.socket.signal.turnConfig.tcpport),M.socket.signal.turnConfig.udpport&&(o.udpport=""+M.socket.signal.turnConfig.udpport),M.joinInfo.turnServers.find((function(t){if(t.url===o.url)return!0}))||M.joinInfo.turnServers.push(o)}return 3===M.joinInfo.proxyServerType&&(i.plugin="web_cloud_proxy"),M.dispatchEvent({type:"join-message-hook",joinMessage:i}),{_type:"join",_message:i}}({role:M.role}),(function(e){if(A.report.joinGateway(t.sid,{lts:o,succ:!0,ec:null,vid:t.vid,addr:M.socket.getURL(),firstSuccess:M.isFirstSuccess}),M.joinSuccessLts=Date.now(),M.isFirstSuccess=!1,M.rejoinAttempt=0,M.hasJoined=!0,r&&r(e.uid),!0===e.return_vosip||!0===Object(w.getParameter)("ENABLE_LIVE_SERVER_LIST")){var n=null;try{n=M.socket.signal.connection.url}catch(t){g.default.debug("[".concat(M.clientId,"] Can not get gateway ip: ").concat(t))}n?Object(w.setParameter)("LIVE_SERVER_LIST",[n]):Object(w.setParameter)("LIVE_SERVER_LIST",[])}M.dispatchEvent({type:"join"}),clearInterval(M.timers.trafficStats),M.timers.trafficStats=setInterval((function(){M.makeRequest({_type:"traffic_stats"},(function(t){var e={};for(var n in t)e[B(n)]=t[n];if(e.peer_delay&&e.peer_delay.length){var r=[];e.peer_delay.forEach((function(t){var e={};for(var n in t)e[B(n)]=t[n];r.push(e)})),e.peer_delay=r}M.traffic_stats=e,M.traffic_stats.timestamp=Date.now();var i=M.joinInfo.stringUid,o=M.localStreams[a]||M.localStreams[i];o&&(o.traffic_stats={access_delay:e.access_delay}),e.peer_delay&&e.peer_delay.forEach((function(t){var n=M.remoteStreams[t.peer_uid];n&&(n.traffic_stats={access_delay:e.access_delay,e2e_delay:t.e2e_delay,audio_delay:t.audio_delay,video_delay:t.video_delay})})),M.dispatchEvent({type:"after-getTrafficStats",trafficStats:e})}))}),3e3)}),(function(e,n){if(g.default.error("[".concat(M.clientId,"] User join failed [").concat(e,"]")),"ERR_JOIN_BY_MULTI_IP"===e){try{A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:"ERR_JOIN_BY_MULTI_IP",addr:M.socket.getURL()})}catch(t){}return M.dispatchEvent({type:"onMultiIP",option:n.option})}R[e]&&M.rejoinAttempt<4?M._doWithAction(R[e],r,i):i&&i(e),A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:e,addr:M.socket&&M.socket.getURL()})}))}),(function(e){g.default.error("[".concat(M.clientId,"] User join failed [").concat(e,"]")),i&&i(e),A.report.joinGateway(t.sid,{lts:o,succ:!1,ec:e,addr:M.socket.getURL()})})),this.remoteMuteState={},M.resetAudioVolumeIndication()},M.leave=function(t,e){var n=F.unregister(M);switch(n&&g.default.debug("[".concat(M.clientId,"] "),n),M.p2ps.clear(),M.state){case h:return g.default.debug("[".concat(M.clientId,"] Client Already in DISCONNECTED status")),void L(t);case I:return g.default.debug("[".concat(M.clientId,"] Client Already in DISCONNECTING status")),void L(e,T.default.INVALID_OPERATION);case b:return M.socket&&M.socket.close(),M.socket=void 0,g.default.info("[".concat(M.clientId,"] Client connecting, Leave channel success")),M.state=h,t&&t()}for(var r in M.state=I,M.channelMediaConfig&&(M.channelMediaRelayController&&M.channelMediaRelayController.dispose(),M.channelMediaConfig,M.channelMediaRelayController=null),clearInterval(M.pingTimer),M.timers)M.timers.hasOwnProperty(r)&&clearInterval(M.timers[r]);for(var r in M.inChannelInfo.joinAt&&(M.inChannelInfo.duration+=Date.now()-M.inChannelInfo.joinAt,M.inChannelInfo.joinAt=null),M.hasJoined?M.makeRequest({_type:"leave"},(function(e){M.socket.close(),M.socket=void 0,g.default.info("[".concat(M.clientId,"] Leave channel success")),M.state=h,t&&t(e)}),(function(t){"TIMEOUT"!==t&&"REQUEST_ABORT"!==t&&(g.default.error("[".concat(M.clientId,"] Leave Channel Failed"),t),M.state=E,e&&e(t))})):(M.socket&&(M.socket.close(),M.socket=void 0),g.default.info("[".concat(M.clientId,"] Leave channel before joined")),M.state=h,t&&t()),M.localStreams)if(M.localStreams.hasOwnProperty(r)){var i=M.localStreams[r];delete M.localStreams[r],void 0!==i.pc&&(i.pc.close(),i.pc=void 0)}z()},M.publish=function(t,e,n,r){var o=(new Date).getTime(),a=!1;if(t.publishLTS=o,"object"!==u()(t)||null===t)return g.default.error("[".concat(M.clientId,"] Invalid local stream")),r&&r(T.default.INVALID_LOCAL_STREAM),void A.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:T.default.INVALID_LOCAL_STREAM});if(!t.stream&&void 0===t.url)return g.default.error("[".concat(M.clientId,"] Invalid local media stream")),r&&r(T.default.INVALID_LOCAL_STREAM),void A.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:T.default.INVALID_LOCAL_STREAM});if(M.state!==E)return g.default.error("[".concat(M.clientId,"] User is not in the session")),r&&r(T.default.INVALID_OPERATION),void A.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:T.default.INVALID_OPERATION});var s=t.getAttributes()||{};if(t.local&&void 0===M.localStreams[t.getId()]&&(t.hasAudio()||t.hasVideo()||t.hasScreen())){var l=M.generateP2PId();if(M.p2ps.set(l,t),t.p2pId=l,void 0!==t.url)G(c({state:"url",audio:t.hasAudio(),video:t.hasVideo(),attributes:t.getAttributes()},t.url),(function(e,n){"success"===e?(t.getUserId()!==n&&t.setUserId(n),M.localStreams[n]=t,t.onClose=function(){M.unpublish(t)}):g.default.error("[".concat(M.clientId,"] Publish local stream failed"),e)}));else{M.localStreams[t.getId()]=t,t.connectionSpec={callback:function(s){s||r&&r("CANNOT_GET_OFFER"),"motion"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-framerate"),"detail"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-resolution"),M.makeRequest(c({state:"offer",stream_type:1==e.streamType?"low":"high",p2p_id:l,sdp:s,audio:t.audio||t.screenAudio,video:t.screen||t.video,screen:t.screen,attributes:t.getAttributes(),dtx:t.DTX,hq:t.highQuality,lq:t.lowQuality,stereo:t.stereo,speech:t.speech,codec:M.codec,extend:Object(w.getParameter)("PUB_EXTEND")}),(function(e){t.getUserId()!==e.uid&&t.setUserId(e.uid),g.default.info("[".concat(M.clientId,"] Local stream published with uid"),e.uid),t.onClose=function(){M.unpublish(t)},t._onAudioUnmute=function(){M.makeReport(i({action:"unmute_local_audio",stream_id:t.getId()}))},t._onVideoUnmute=function(){M.makeReport(i({action:"unmute_local_video",stream_id:t.getId()}))},t._onAudioMute=function(){M.makeReport(i({action:"mute_local_audio",stream_id:t.getId()}))},t._onVideoMute=function(){M.makeReport(i({action:"mute_local_video",stream_id:t.getId()}))},t.getId()===t.getUserId()&&(t.isAudioOn()||t.hasAudio()&&(g.default.debug("[".concat(M.clientId,"] local stream audio mute")),t._onAudioMute()),t.isVideoOn()||(t.hasVideo()||t.hasScreen())&&(g.default.debug("[".concat(M.clientId,"] local stream video mute")),t._onVideoMute())),t.pc.oniceconnectionstatechange=function(e){if("failed"===e){if(null!=M.timers[t.getId()]&&(clearInterval(M.timers[t.getId()]),clearInterval(M.timers[t.getId()]+"_RelatedStats")),g.default.error("[".concat(M.clientId,"] Publisher connection is lost -- streamId: ").concat(t.getId(),", p2pId: ").concat(l)),M.p2ps.delete(l),g.default.debug("[".concat(M.clientId,"] publish p2p failed: "),M.p2ps),!a)return a=!0,A.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:T.default.PEERCONNECTION_FAILED,publishRequestid:M.publishRequestId||0,p2pid:l}),M.dispatchEvent(Object(v.a)({type:"pubP2PLost",stream:t})),r&&r(T.default.PEERCONNECTION_FAILED);M.dispatchEvent(Object(v.a)({type:"pubP2PLost",stream:t}))}else if("connected"===e&&(g.default.debug("[".concat(M.clientId,"] publish p2p connected: "),M.p2ps),t.getId()===t.getUserId()&&(t._isAudioMuted()?M.makeReport(i({action:"mute_local_audio",stream_id:t.getId()})):M.makeReport(i({action:"unmute_local_audio",stream_id:t.getId()})),t._isVideoMuted()?M.makeReport(i({action:"mute_local_video",stream_id:t.getId()})):M.makeReport(i({action:"unmute_local_video",stream_id:t.getId()}))),!a))return a=!0,A.report.publish(M.joinInfo.sid,{lts:o,succ:!0,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:null,publishRequestid:M.publishRequestId||0,p2pid:l}),n&&n()},t.pc.processSignalingMessage(e.sdp)}),(function(e,n){g.default.error("Publish Failed: ".concat(e)),A.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:e,publishRequestid:M.publishRequestId||0,p2pid:l}),"TIMEOUT"!=e&&(M.processPublishFailure(t),r&&r(e))}))},audio:t.hasAudio(),video:t.hasVideo(),screen:t.hasScreen(),optimizationMode:t.optimizationMode,isSubscriber:!1,stunServerUrl:M.stunServerUrl,turnServers:M.joinInfo.turnServers,maxAudioBW:s.maxAudioBW,minVideoBW:s.minVideoBW,maxVideoBW:s.maxVideoBW,mode:M.mode,codec:M.codec,isVideoMute:t.userMuteVideo||t.peerMuteVideo,isAudioMute:t.userMuteAudio||t.peerMuteAudio,maxFrameRate:t.attributes.maxFrameRate,agoraStream:t,clientId:M.clientId},t.pc=Object(S.a)(t.connectionSpec),t.pc.addStream(t.stream),g.default.debug("[".concat(M.clientId,"] PeerConnection add stream :"),t.stream),t.pc.onnegotiationneeded=function(n){"motion"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-framerate"),"detail"===t.optimizationMode&&t.pc.setRtpSenderParameters("maintain-resolution");var r={state:"negotiation",stream_type:1===e.streamType?"low":"high",p2p_id:l,sdp:n};M.makeRequest(c(r),(function(e){g.default.debug("Negotating Stream ".concat(t.getId())),t.pc.processSignalingMessage(e.sdp)}),(function(t,e){g.default.error("Negotiation failed ".concat(t),e,r)}))},clearInterval(M.timers[t.getId()]),M.timers[t.getId()]=setInterval((function(){if(Object(w.getParameter)("REPORT_STATS")){var e=0;t&&t.pc&&t.pc.getStats&&t.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id&&!(/_recv$/.test(n.id)||/^time$/.test(n.id)||~n.type.toLowerCase().indexOf("inbound"))&&t.getUserId()){if(-1===n.id.indexOf("outbound_rtp")&&-1===n.id.indexOf("OutboundRTP")&&-1===n.type.toLowerCase().indexOf("outbound")||"video"!==n.mediaType||(n.googFrameWidthSent=t.videoWidth+"",n.googFrameHeightSent=t.videoHeight+""),"video"===n.mediaType)try{var r=t.stream.getVideoTracks()[0];n.A_vstd=r.enabled?"0":"1"}catch(t){}if("audio"===n.mediaType)try{var i=t.stream.getAudioTracks()[0];n.A_astd=i.enabled?"0":"1"}catch(t){}if(t.getId()==t.getUserId()){var o=200*e;e++,setTimeout((function(){var t=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();t>Object(w.getParameter)("REPORT_STATS_TIMEOUT")?g.default.debug("PublishStats report blocked by REPORT_STATS_TIMEOUT ".concat(t)):M.makeReport(function(t){var e={};return Object.keys(t).forEach((function(n){Object(w.getParameter)("STATS_FILTER")[n]||(e[k(n)]=t[n])})),{_type:"publish_stats",_message:{stream_type:"high",stats:e}}}(n))}),o)}else o=200*e,e++,setTimeout((function(){var t=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();t>Object(w.getParameter)("REPORT_STATS_TIMEOUT")?g.default.debug("PublishStatsLow report blocked by REPORT_STATS_TIMEOUT ".concat(t)):M.makeReport(function(t){var e={};return Object.keys(t).forEach((function(n){Object(w.getParameter)("STATS_FILTER")[n]||(e[k(n)]=t[n])})),{_type:"publish_stats",_message:{stream_type:"low",stats:e}}}(n))}),o)}}))}))}}),3e3);var d=function(){Object(w.getParameter)("REPORT_STATS")&&t&&t.pc&&t.pc.getVideoRelatedStats&&t.pc.getVideoRelatedStats((function(e){var n,r,i=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();i>Object(w.getParameter)("REPORT_STATS_TIMEOUT")?g.default.debug("PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(i)):t.getId()===t.getUserId()?M.makeReport((n=e,r={},Object.keys(n).forEach((function(t){Object(w.getParameter)("STATS_FILTER")[t]||(r[k(t)]=n[t])})),{_type:"publish_related_stats",_message:{stream_type:"high",stats:r}})):M.makeReport(function(t){var e={};return Object.keys(t).forEach((function(n){Object(w.getParameter)("STATS_FILTER")[n]||(e[k(n)]=t[n])})),{_type:"publish_related_stats",_message:{stream_type:"low",stats:e}}}(e))}))};d(),clearInterval(M.timers[t.getId()+"_RelatedStats"]),M.timers[t.getId()+"_RelatedStats"]=setInterval(d,1e3)}}},M.unpublish=function(t,e,n,r){if("object"!==u()(t)||null===t)return g.default.error("[".concat(M.clientId,"] Invalid local stream")),void L(r,T.default.INVALID_LOCAL_STREAM);if(M.state!==E)return g.default.error("[".concat(M.clientId,"] User not in the session")),void L(r,T.default.INVALID_OPERATION);if(null!=M.timers[t.getId()]&&(clearInterval(M.timers[t.getId()]),clearInterval(M.timers[t.getId()+"_RelatedStats"])),void 0!==M.socket)if(t.local&&void 0!==M.localStreams[t.getId()]){delete M.localStreams[t.getId()];var i={stream_id:t.getUserId(),stream_type:1===e.streamType?"low":"high"};M.makeRequest({_type:"unpublish",_message:i}),(t.hasAudio()||t.hasVideo()||t.hasScreen())&&void 0===t.url&&void 0!==t.pc&&(t.pc.close(),t.pc=void 0),t.onClose=void 0,t._onAudioMute=void 0,t._onAudioUnute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,M.p2ps.delete(t.p2pId),n&&n()}else g.default.error("[".concat(M.clientId,"] Invalid local stream")),L(r,T.default.INVALID_LOCAL_STREAM);else g.default.error("[".concat(M.clientId,"] User not in the session")),L(r,T.default.INVALID_OPERATION)},M.subscribe=function(t,e,n){var r=(new Date).getTime();t.subscribeLTS=r;var o=!1;if(g.default.info("[".concat(M.clientId,"] Gatewayclient ").concat(M.uid," Subscribe ").concat(t.getId(),": ").concat(JSON.stringify(t.subscribeOptions))),"object"!==u()(t)||null===t)return g.default.error("[".concat(M.clientId,"] Invalid remote stream")),n&&n(T.default.INVALID_REMOTE_STREAM),void A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:T.default.INVALID_REMOTE_STREAM});if(M.state!==E&&(g.default.error("[".concat(M.clientId,"] User is not in the session")),!o))return o=!0,A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:T.default.INVALID_OPERATION}),n&&n(T.default.INVALID_OPERATION);if(!t.local&&M.remoteStreams.hasOwnProperty(t.getId()))if(t.hasAudio()||t.hasVideo()||t.hasScreen()){var s=M.generateP2PId();M.p2ps.set(s,t),t.p2pId=s,t.pc=Object(S.a)({callback:function(e){e||n&&n("CANNOT_GET_OFFER");var i={stream_id:t.getId(),audio:!t.subscribeOptions||t.subscribeOptions.audio,video:!t.subscribeOptions||t.subscribeOptions.video,codec:M.codec,p2p_id:s,sdp:e,tcc:Object(w.getParameter)("SUBSCRIBE_TCC"),extend:Object(w.getParameter)("SUB_EXTEND")};M.makeRequest({_type:"subscribe",_message:i},(function(e){t.pc.processSignalingMessage(e.sdp)}),(function(e,i){g.default.error("[".concat(M.clientId,"] Subscribe remote stream Failed: ").concat(e,", closing stream "),t.getId(),i),A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:e}),"TIMEOUT"!=e&&(M.processSubscribeFailure(t),n&&n(e))}))},nop2p:!0,audio:!0,video:!0,screen:t.hasScreen(),isSubscriber:!0,stunServerUrl:M.stunServerUrl,turnServers:M.joinInfo.turnServers,isVideoMute:t.userMuteVideo,isAudioMute:t.userMuteAudio,uid:t.getId(),agoraStream:t,clientId:M.clientId}),t.pc.onaddstream=function(e,n){if(t._onAudioUnmute=function(){M.makeReport(i({action:"unmute_remote_audio",stream_id:t.getId()}),(function(){}),(function(){}))},t._onAudioMute=function(){M.makeReport(i({action:"mute_remote_audio",stream_id:t.getId()}),(function(){}),(function(){}))},t._onVideoUnmute=function(){M.makeReport(i({action:"unmute_remote_video",stream_id:t.getId()}),(function(){}),(function(){}))},t._onVideoMute=function(){M.makeReport(i({action:"mute_remote_video",stream_id:t.getId()}),(function(){}),(function(){}))},"ontrack"===n&&"video"===e.track.kind||"onaddstream"===n){g.default.info("[".concat(M.clientId,"] Remote stream subscribed with uid "),t.getId());var r=M.remoteStreams[t.getId()];if(M.remoteStreams[t.getId()].stream="onaddstream"===n?e.stream:e.streams[0],M.remoteStreams[t.getId()].hasVideo()){if(Object(x.isFireFox)()||Object(x.isSafari)()){var o=M.remoteStreams[t.getId()].stream;Object(y.vsResHack)(o,(function(e,n){t.videoWidth=e,t.videoHeight=n}),(function(t){return g.default.warning("[".concat(M.clientId,"] vsResHack failed: ")+t)}))}}else{var a=M.remoteStreams[t.getId()];a.peerMuteVideo=!0,M._adjustPCMuteStatus(a)}r&&r.isPlaying()&&r.elementID&&(g.default.debug("[".concat(M.clientId,"] Reload Player ").concat(r.elementID," StreamId ").concat(r.getId())),t.audioOutput=r.audioOutput,r.stop(),t.play(r.elementID,r.playOptions)),delete t.audioLevelHelper;var s=Object(v.e)({type:"stream-subscribed",stream:M.remoteStreams[t.getId()]});M.dispatchEvent(s)}},clearInterval(M.timers[t.getId()]),M.timers[t.getId()]=setInterval((function(){if(Object(w.getParameter)("REPORT_STATS")){var e=0;t&&t.pc&&t.pc.getStats&&t.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id){if(/_send$/.test(n.id)||/^time$/.test(n.id)||/^bweforvideo$/.test(n.id))return;-1===n.id.indexOf("inbound_rtp")&&-1===n.id.indexOf("inbound-rtp")&&-1===n.type.toLowerCase().indexOf("inbound")||"video"!==n.mediaType||(n.googFrameWidthReceived=t.videoWidth+"",n.googFrameHeightReceived=t.videoHeight+"");var r=200*e;e++;var i=t.getId();setTimeout((function(){var e=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();if(e>Object(w.getParameter)("REPORT_STATS_TIMEOUT"))g.default.debug("SubscribeStats report blocked by REPORT_STATS_TIMEOUT ".concat(e));else{if("video"===n.mediaType)try{var r=t.stream.getVideoTracks()[0];n.A_vrtd=r.enabled?"0":"1",t.player&&t.player.freezeTimeCounterList.length>0&&(n.A_vrft=t.player.freezeTimeCounterList.splice(0,1)[0].toString())}catch(t){}if("audio"===n.mediaType)try{var o=t.stream.getAudioTracks()[0];n.A_artd=o.enabled?"0":"1"}catch(t){}M.makeReport(l(i,n))}}),r)}}))}))}}),3e3),clearInterval(M.timers[t.getId()+"_RelatedStats"]),M.timers[t.getId()+"_RelatedStats"]=setInterval((function(){if(Object(w.getParameter)("REPORT_STATS")&&t&&t.pc){var e=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();if(e>Object(w.getParameter)("REPORT_STATS_TIMEOUT"))return void g.default.debug("SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(e));t.pc.getVideoRelatedStats&&t.pc.getVideoRelatedStats((function(e){t.player&&(t.hasVideo()&&!t.peerMuteVideo&&(e.isFreeze=t.player.freezeCount>t.player.lastFreezeCount),t.player.lastFreezeCount=t.player.freezeCount),M.makeReport(a(t.getId(),e))})),t.pc.getAudioRelatedStats&&t.pc.getAudioRelatedStats((function(e){M.makeReport(a(t.getId(),e))}))}}),1e3),M.audioLevel[t.getId()]=0,clearInterval(M.timers[t.getId()+"audio"]),M.timers[t.getId()+"audio"]=setInterval((function(){M.hasListeners("active-speaker")&&t&&t.pc&&"established"===t.pc.state&&t.pc.getStats&&t.pc.getStats((function(e){e.forEach((function(e){if("audio"===e.mediaType){if(e.audioOutputLevel>5e3)for(var n in M.audioLevel[t.getId()]<20&&(M.audioLevel[t.getId()]+=1),M.audioLevel)n!==""+t.getId()&&M.audioLevel[n]>0&&(M.audioLevel[n]-=1);var r=Object.keys(M.audioLevel).sort((function(t,e){return M.audioLevel[e]-M.audioLevel[t]}));if(M.activeSpeaker!==r[0]){var i=Object(v.a)({type:"active-speaker",uid:r[0]});M.dispatchEvent(i),M.activeSpeaker=r[0],g.default.debug("[".concat(M.clientId,"] Update active speaker: ").concat(M.activeSpeaker))}}}))}),50)}),50),t.pc.oniceconnectionstatechange=function(i){if("failed"===i)null!=M.timers[t.getId()]&&(clearInterval(M.timers[t.getId()]),clearInterval(M.timers[t.getId()]+"audio")),g.default.error("[".concat(M.clientId,"] Subscriber connection is lost -- streamId: ").concat(t.getId(),", p2pId: ").concat(s)),g.default.debug("[".concat(M.clientId,"] subscribe p2p failed: "),M.p2ps),o||(o=!0,n&&n(T.default.PEERCONNECTION_FAILED),A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:T.default.PEERCONNECTION_FAILED,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s})),M.remoteStreams[t.getId()]&&M.p2ps.has(s)&&(M.p2ps.delete(s),M.dispatchEvent(Object(v.a)({type:"subP2PLost",stream:t})));else if("connected"===i&&(g.default.debug("[".concat(M.clientId,"] subscribe p2p connected: "),M.p2ps),!o)){o=!0,A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!0,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:null,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s}),M._adjustPCMuteStatus(t);var a=!1,c=!1,u=!1,l=setInterval((function(){a&&c||(t.pc?t.pc.getStats((function(e){e.forEach((function(e){if((-1!==e.id.indexOf("recv")||e.type&&-1!==e.type.toLowerCase().indexOf("inbound")||-1!==e.id.indexOf("inbound_rtp")||-1!==e.id.indexOf("inbound-rtp")||-1!==e.id.indexOf("InboundRTP"))&&"audio"===e.mediaType){if((e.googDecodingNormal>0||e.audioOutputLevel>0)&&!a){a=!0,M.dispatchEvent({type:"first-audio-frame-decode",stream:t}),a&&c&&clearInterval(l);var n=Date.now(),r=A.report.getSessionStartTime(M.joinInfo.sid);A.report.firstAudioDecode(M.joinInfo.sid,{peerid:t.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-t.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s})}parseInt(e.packetsReceived)>0&&!c&&(c=!0,M.dispatchEvent({type:"first-audio-packet-received",stream:t}),a&&c&&clearInterval(l),n=Date.now(),r=A.report.getSessionStartTime(M.joinInfo.sid),A.report.firstAudioReceived(M.joinInfo.sid,{peerid:t.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-t.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s}))}}))}),100):clearInterval(l))}),100),d=!1,h=!1,f=setInterval((function(){d&&h||(t.pc?t.pc.getStats((function(e){e.forEach((function(e){if((-1!==e.id.indexOf("recv")||e.type&&-1!==e.type.toLowerCase().indexOf("inbound")||-1!==e.id.indexOf("inbound_rtp")||-1!==e.id.indexOf("inbound-rtp")||-1!==e.id.indexOf("InboundRTP"))&&"video"===e.mediaType){if((e.framesDecoded>0||e.googFramesDecoded>0)&&!d){d=!0,M.dispatchEvent({type:"first-video-frame-decode",stream:t}),d&&h&&clearInterval(f);var n=Date.now(),r=A.report.getSessionStartTime(M.joinInfo.sid);t.firstFrameTime=(new Date).getTime()-t.subscribeLTS,A.report.firstVideoDecode(M.joinInfo.sid,{peerid:t.uintId,width:parseInt(e.googFrameWidthReceived)||0,height:parseInt(e.googFrameHeightReceived)||0,uid:M.uid,elapse:n-r,subscribeElapse:n-t.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s})}e.packetsReceived>0&&!h&&(h=!0,M.dispatchEvent({type:"first-video-packet-received",stream:t}),d&&h&&clearInterval(f),n=Date.now(),r=A.report.getSessionStartTime(M.joinInfo.sid),A.report.firstVideoReceived(M.joinInfo.sid,{peerid:t.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-t.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:s}))}}))}),100):clearInterval(f))}),100),p=setInterval((function(){if(!u){var e=t.getId(),n=M.traffic_stats;if(n&&n.peer_delay){var r=n.peer_delay.find((function(t){return t.peer_uid==e}));if(r){if(u=!0,M.peerPublishDurationMap.get(t.getId()))return void clearInterval(p);var i=r.peer_publish_audio_duration,o=r.peer_publish_video_duration;if(void 0===i||void 0===o)return;M.peerPublishDurationMap.set(t.getId(),!0);var a=A.report.getSessionStartTime(M.joinInfo.sid),s=(i||o)+(Date.now()-n.timestamp),c=Date.now();A.report.peerPublishStatus({audiotag:i?1:-1,videotag:o?1:-1,lts:c,sid:M.joinInfo.sid,cname:M.joinInfo.cname,cid:M.joinInfo.cid,uid:M.joinInfo.uid,elapse:c-a,peer:t.uintId,peerPublishDuration:s,joinChannelSuccessElapse:c-M.joinSuccessLts,subscribeElapse:c-t.subscribeLTS}),clearInterval(p)}}}}),1e3);return t.sid=M.joinInfo.sid,e&&e()}}}else g.default.error("[".concat(M.clientId,"] Invalid remote stream")),o||(o=!0,n&&n(T.default.INVALID_REMOTE_STREAM),A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:T.default.INVALID_REMOTE_STREAM}));else g.default.error("[".concat(M.clientId,"] No such remote stream")),o||(o=!0,n&&n(T.default.NO_SUCH_REMOTE_STREAM),A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:T.default.NO_SUCH_REMOTE_STREAM}))},M.subscribeChange=function(t,e,n){var r=Date.now();g.default.info("[".concat(M.clientId,"] Gatewayclient ").concat(M.uid," SubscribeChange ").concat(t.getId(),": ").concat(JSON.stringify(t.subscribeOptions))),M._adjustPCMuteStatus(t);var i={stream_id:t.getId(),audio:t.subscribeOptions.audio,video:t.subscribeOptions.video};M.makeRequest({_type:"subscribe_change",_message:i},(function(n){var i=Object(v.e)({type:"stream-subscribe-changed",stream:M.remoteStreams[t.getId()]});A.report.subscribe(M.joinInfo.sid,{lts:r,succ:!0,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:t.getId(),ec:null,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:M.p2ps.get(t.getId())}),M.dispatchEvent(i),e&&e()}),(function(e,r){g.default.error("[".concat(M.clientId,"] Subscribe Change Failed ").concat(t.getId()),e,r),n&&n(e,r)}))},M.processPublishFailure=function(t){t.publishLTS=null,t.p2pId&&M.p2ps.get(t.p2pId)===t&&M.p2ps.delete(t.p2pId),M.localStreams[t.getUserId()]===t&&delete M.localStreams[t.getUserId()],M.localStreams[t.getId()]===t&&delete M.localStreams[t.getId()],t.pc&&(t.pc.processSignalingMessage=function(){},t.pc.oniceconnectionstatechange=function(){},t.pc.close(),delete t.pc),delete t.onClose,delete t._onAudioUnmute,delete t._onVideoUnmute,delete t._onAudioMute,delete t._onVideoMute,delete t._onAudioUnmute},M.processSubscribeFailure=function(t){t.p2pId&&M.p2ps.get(t.p2pId)===t&&M.p2ps.delete(t.p2pId),t.pc&&(t.pc.onaddstream=function(){},t.pc.processSignalingMessage=function(){},t.pc.oniceconnectionstatechange=function(){},t.pc.close(),delete t.pc),delete t.onClose,delete t._onAudioUnmute,delete t._onVideoUnmute,delete t._onAudioMute,delete t._onVideoMute,delete t._onAudioUnmute},M._adjustPCMuteStatus=function(t){g.default.debug("[".concat(M.clientId,"]: use _adjustPCMuteStatus: ").concat(t.getId())),g.default.debug("[".concat(M.clientId,"]: video: ").concat(t.video,", audio: ").concat(t.audio,", suboption: ").concat(JSON.stringify(t.subscribeOptions),",userMuteVideo: ").concat(t.userMuteVideo,", peerMuteVideo: ").concat(t.peerMuteVideo,", userMuteAudio: ").concat(t.userMuteAudio,", peerMuteAudio: ").concat(t.peerMuteAudio)),!t.local&&t.pc&&t.pc.peerConnection.getReceivers&&t.pc.peerConnection.getReceivers().forEach((function(e){if(e&&e.track&&"audio"===e.track.kind){var n=!t.userMuteAudio&&!t.peerMuteAudio;t.subscribeOptions&&!t.subscribeOptions.audio&&(n=!1),g.default.debug("[".concat(M.clientId,"]: set receiver audio track: ").concat(n)),e.track.enabled=!!n}else if(e&&e.track&&"video"===e.track.kind){var r=!t.userMuteVideo&&!t.peerMuteVideo;t.subscribeOptions&&!t.subscribeOptions.video&&(r=!1),g.default.debug("[".concat(M.clientId,"]: set receiver video track: ").concat(r)),e.track.enabled=!!r}}))},M.unsubscribe=function(t,e,n){if("object"!==u()(t)||null===t)return g.default.error("[".concat(M.clientId,"] Invalid remote stream")),void L(n,T.default.INVALID_REMOTE_STREAM);if(M.state!==E)return g.default.error("[".concat(M.clientId,"] User is not in the session")),void L(n,T.default.INVALID_OPERATION);if(null!=M.timers[t.getId()]&&(clearInterval(M.timers[t.getId()]),clearInterval(M.timers[t.getId()]+"audio")),null!=M.audioLevel[t.getId()]&&delete M.audioLevel[t.getId()],null!=M.timer_counter[t.getId()]&&delete M.timer_counter[t.getId()],M.remoteStreams.hasOwnProperty(t.getId())){if(!M.socket)return g.default.error("[".concat(M.clientId,"] User is not in the session")),void L(n,T.default.INVALID_OPERATION);if(t.local)return g.default.error("[".concat(M.clientId,"] Invalid remote stream")),void L(n,T.default.INVALID_REMOTE_STREAM);t.close(),t.stop();var r={stream_id:t.getId()};M.makeRequest({_type:"unsubscribe",_message:r}),void 0!==t.pc&&(t.pc.close(),t.pc=void 0),t.onClose=void 0,t._onAudioMute=void 0,t._onAudioUnute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,delete t.subscribeOptions,M.p2ps.delete(t.p2pId),g.default.info("[".concat(M.clientId,"] Unsubscribe stream success")),e&&e()}else L(n,T.default.NO_SUCH_REMOTE_STREAM)},M.setRemoteVideoStreamType=function(t,e){if(g.default.debug("[".concat(M.clientId,"] Switching remote video stream ").concat(t.getId()," to ").concat(e)),"object"===u()(t)&&null!==t)if(M.state===E){if(!t.local){switch(e){case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}var n={stream_id:t.getId(),stream_type:e};M.makeRequest({_type:"switch_video_stream",_message:n},(function(){g.default.debug("SwitchVideoStream Success ".concat(n.stream_id," ").concat(n.stream_type))}),(function(t,e){g.default.error("SwitchVideoStream Error ".concat(t," ").concat(n.stream_id," ").concat(n.stream_type),e)}))}}else g.default.error("[".concat(M.clientId,"] User is not in the session"));else g.default.error("[".concat(M.clientId,"] Invalid remote stream"))},M.renewToken=function(t,e,n){t?M.key?M.state!==E?(g.default.debug("[".concat(M.clientId,"] Client is not connected. Trying to rejoin")),M.key=t,M.rejoin(),e&&e()):(g.default.debug("[".concat(M.clientId,"] renewToken from ").concat(M.key," to ").concat(t)),M.key=t,M.makeRequest({_type:"renew_token",_message:{token:t}},e,n)):(g.default.error("[".concat(M.clientId,"] Client is previously joined without token")),n&&n(T.default.INVALID_PARAMETER)):(g.default.error("[".concat(M.clientId,"] Invalid Token ").concat(t)),n&&n(T.default.INVALID_PARAMETER))},M.setStreamFallbackOption=function(t,e){if(g.default.debug("[".concat(M.clientId,"] Set stream fallback option ").concat(t.getId()," to ").concat(e)),"object"===u()(t)&&null!==t)if(M.state===E){if(!t.local){switch(e){case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}var n={stream_id:t.getId(),fallback_type:e};M.makeRequest({_type:"set_fallback_option",_message:n},(function(){g.default.debug("SetStreamFallbackOption success ".concat(n.stream_id," ").concat(e))}),(function(t,r){g.default.error("Failed to SetStreamFallbackOption ".concat(n.stream_id," ").concat(e," ").concat(t),r)}))}}else g.default.error("[".concat(M.clientId,"] User is not in the session"));else g.default.error("[".concat(M.clientId,"] Invalid remote stream"))},M.enableAudioVolumeIndicator=function(t,e){M.audioVolumeIndication.enabled=!0,M.audioVolumeIndication.interval=t,M.audioVolumeIndication.smooth=e,M.resetAudioVolumeIndication()},M.resetAudioVolumeIndication=function(){if(clearInterval(M.timers.audioVolumeIndication),clearInterval(M.timers.audioVolumeSampling),M.audioVolumeIndication.enabled&&M.audioVolumeIndication.interval){var t=Math.floor(1e3*M.audioVolumeIndication.smooth/100);clearInterval(M.timers.audioVolumeSampling),M.timers.audioVolumeSampling=setInterval((function(){M.audioVolumeSampling||(M.audioVolumeSampling={});var e={};for(var n in M.remoteStreams){var r=M.remoteStreams[n];if(r.stream&&r.hasAudio()){var i=r.getAudioLevel();i>0&&i<1&&(i*=100);var o=M.audioVolumeSampling[n]||[];for(o.push(i);o.length>t;)o.shift();e[n]=o}}M.audioVolumeSampling=e}),100),clearInterval(M.timers.audioVolumeIndication),M.timers.audioVolumeIndication=setInterval((function(){if(M.socket&&M.socket.signal&&M.socket.signal.connection&&M.socket.signal.connection.readyState===WebSocket.OPEN){var t=[];for(var e in M.remoteStreams)if(M.audioVolumeSampling&&M.audioVolumeSampling[e]){var n=M.audioVolumeSampling[e],r=0;n.forEach((function(t){r+=t}));var i={uid:e,level:Math.floor(r/n.length)};i.level&&t.push(i)}var o=t.sort((function(t,e){return t.level-e.level}));g.default.debug("[".concat(M.clientId,"] volume-indicator "),JSON.stringify(o)),M.audioVolumeIndication.sortedAudioVolumes=o;var a=Object(v.a)({type:"volume-indicator",attr:o});M.dispatchEvent(a)}}),M.audioVolumeIndication.interval)}},M.closeGateway=function(){g.default.debug("[".concat(M.clientId,"] close gateway")),M.state=h,M.socket.close(),H()},M.startChannelMediaRelay=function(){var t=s()(o.a.mark((function t(e){var n,r,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!M.channelMediaRelayController){t.next=2;break}throw new N.ChannelMediaError("RELAY_ALREADY_START","",N.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return n=function(t){M.dispatchEvent({type:"channel-media-relay-event",code:t})},r=function(t,e,n){t===N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&e===N.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(M.channelMediaRelayController.dispose(),M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:t,code:e,data:n})},M.channelMediaRelayController=new P.a(M.joinInfo,M.clientId),M.channelMediaRelayController.on("event",n),M.channelMediaRelayController.on("state",r),t.prev=7,t.next=10,M.channelMediaRelayController.startChannelMediaRelay(e);case 10:t.next=22;break;case 12:throw t.prev=12,t.t0=t.catch(7),g.default.debug("[".concat(M.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(t.t0))),i=N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",a=t.t0 instanceof N.ChannelMediaError?"SetSourceChannelStatus"===t.t0.data||t.t0.data&&t.t0.data.serverResponse&&"SetSourceChannel"===t.t0.data.serverResponse.command?"FAILED_JOIN_SRC":"SetDestChannelStatus"===t.t0.data||t.t0.data&&t.t0.data.serverResponse&&"SetDestChannel"===t.t0.data.serverResponse.command?"FAILED_JOIN_DEST":t.t0.data&&t.t0.data.serverResponse&&"StartPacketTransfer"===t.t0.data.serverResponse.command?"FAILED_PACKET_SENT_TO_DEST":t.t0.message===N.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||t.t0.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":t.t0.message===N.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||t.t0.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":t.t0.message===N.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":t.t0.message===N.CHANNEL_MEDIA_ERROR.WS_ABORT||t.t0.message===N.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-state",state:i,code:N.CHANNEL_MEDIA_RELAY_ERROR[a]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new N.ChannelMediaError(a,null,N.CHANNEL_MEDIA_RELAY_ERROR[a]);case 22:M.dispatchEvent({type:"channel-media-relay-state",state:N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:N.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),M.channelMediaConfig=e;case 24:case"end":return t.stop()}}),t,null,[[7,12]])})));return function(e){return t.apply(this,arguments)}}(),M.updateChannelMediaRelay=function(){var t=s()(o.a.mark((function t(n){var r,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.channelMediaRelayController){t.next=2;break}throw new N.ChannelMediaError("RELAY_NOT_START",null,N.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,M.channelMediaRelayController.updateChannelMediaRelay(n);case 5:t.next=18;break;case 7:throw t.prev=7,t.t0=t.catch(2),g.default.debug("[".concat(M.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e))),r=N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",i=e instanceof N.ChannelMediaError?e.message===N.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===N.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.message===N.CHANNEL_MEDIA_ERROR.WS_ABORT||e.message===N.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-event",code:N.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),M.dispatchEvent({type:"channel-media-relay-state",state:r,code:N.CHANNEL_MEDIA_RELAY_ERROR[i]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new N.ChannelMediaError(i,null,N.CHANNEL_MEDIA_RELAY_ERROR[i]);case 18:M.channelMediaConfig=n;case 19:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}(),M.stopChannelMediaRelay=s()(o.a.mark((function t(){var n,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.channelMediaRelayController){t.next=2;break}throw new N.ChannelMediaError("RELAY_NOT_START",null,N.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,M.channelMediaRelayController.stopChannelMediaRelay();case 5:t.next=17;break;case 7:throw t.prev=7,t.t0=t.catch(2),g.default.debug("[".concat(M.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e))),n=N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",r=e instanceof N.ChannelMediaError?e.message===N.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===N.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===N.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-state",state:n,code:N.CHANNEL_MEDIA_RELAY_ERROR[r]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:N.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new N.ChannelMediaError(r,null,N.CHANNEL_MEDIA_RELAY_ERROR[r]);case 17:M.channelMediaConfig=null,M.channelMediaRelayController=null;case 19:case"end":return t.stop()}}),t,null,[[2,7]])}))),M.sendMetadata=function(t,e){M.makeRequest(function(t){return{_type:"send_metadata",_message:{session_id:M.joinInfo.sid,metadata:window.btoa(unescape(encodeURIComponent(t)))}}}(t),(function(){g.default.debug("[".concat(M.clientId,'] send metadata "').concat(t,'" success')),e&&e(null)}),(function(n){g.default.error("[".concat(M.clientId,'] send metadata "').concat(t,'" failed'),n),e&&e(n)}))},M._reportWebsocketCloseEvent=function(t,e){try{var n=A.report.getSessionStartTime(M.joinInfo.sid),r=Date.now();A.report.webSocketQuit({lts:r,sid:M.joinInfo.sid,cname:M.joinInfo.cname,cid:M.joinInfo.cid,uid:M.joinInfo.uid,elapse:r-n,succ:t,errorCode:e,ip:null})}catch(t){g.default.debug("[".concat(M.clientId,"]: _reportWebsocketCloseEvent exception, ").concat(t))}};var D=function(){g.default.debug("[".concat(M.clientId,"] Reconnect gateway")),M.state=h,M.socket.close(),H(),M.reconnectMode="recover",M.state=b,j()};M.recover=D;var H=function(){for(var t in M.dispatchEvent({type:"before-clear-connection"}),M.timers)M.timers.hasOwnProperty(t)&&clearInterval(M.timers[t]);for(var t in M.remoteStreams)if(M.remoteStreams.hasOwnProperty(t)){var e=M.remoteStreams[t],n=Object(v.a)({type:"stream-removed",uid:e.getId(),stream:e});M.dispatchEvent(n)}M.p2ps.clear(),z(),Q(),clearInterval(M.pingTimer)};M.rejoin=function(){M.socket&&(clearInterval(M.pingTimer),M.socket.close(),M.socket=void 0),M.state=b,j()};var j=function(t,e){M.dispatchEvent(Object(v.a)({type:"rejoin-start"})),t=t||function(t){g.default.info("[".concat(M.clientId,"] User ").concat(t," is re-joined to ").concat(M.joinInfo.cname)),M.dispatchEvent(Object(v.a)({type:"rejoin"})),M.channelMediaConfig&&M.startChannelMediaRelay(M.channelMediaConfig).then((function(){g.default.debug("[".concat(M.clientId,"] restartChannelMediaRelay success"))})).catch((function(t){g.default.debug("[".concat(M.clientId,"] restartChannelMediaRelay failed: ").concat(JSON.stringify(t)))})),M.liveStreams&&M.liveStreams.size&&M.liveStreams.forEach((function(t,e){t&&M.setLiveTranscoding(M.transcoding),M.startLiveStreaming(e,t)})),M.injectLiveStreams&&M.injectLiveStreams.size&&M.injectLiveStreams.forEach((function(t,e){M.addInjectStreamUrl(e,t)}))},e=e||function(t){g.default.error("[".concat(M.clientId,"] Re-join to channel failed "),t),M.dispatchEvent(Object(v.e)({type:"error",reason:t}))},M.key?(++M.rejoinAttempt,M.join(M.joinInfo,M.key,t,e)):g.default.error("[".concat(M.clientId,"] Connection recover failed [Invalid channel key]"))},V=function(t,e,n){if(M.onConnect=e,M.socket){if(M.dispatchEvent({type:"reconnect"}),"retry"===M.reconnectMode)g.default.debug("[".concat(M.clientId,"] Retry current gateway")),M.socket.reconnect();else if("tryNext"===M.reconnectMode)g.default.debug("[".concat(M.clientId,"] Try next gateway")),M.socket.connectNext();else if("recover"===M.reconnectMode){g.default.debug("[".concat(M.clientId,"] Recover gateway")),g.default.debug("[".concat(M.clientId,"] Try to reconnect choose server and get gateway list again ")),M.reconnectingCS=!0;var i=M.joinInfo&&M.joinInfo.sid;Object(C.getGatewayList)(M.joinInfo,(function(t){g.default.debug("[".concat(M.clientId,"] session:  ").concat(i," get gateway list success")),M.joinInfo.apResponse=t.res,M.reconnectingCS?M.socket.replaceHost(t.gateway_addr):g.default.debug("[".concat(M.clientId,"] session:  ").concat(i," already leave"))}))}}else o=t.gatewayAddr,M.socket=_(o,{sid:M.joinInfo.sid,clientId:M.clientId,proxyServerType:M.joinInfo.proxyServerType}),M.socket.on("start-connection",(function(t){M.ticket=t&&t.msg&&t.msg.ticket})),M.socket.on("on_uplink_stats",(function(t){var e={};for(var n in t)e[B(n)]=t[n];if(M.OutgoingAvailableBandwidth=e.uplink_available_bandwidth,M.localStreams[M.uid]){var r=M.localStreams[M.uid].uplinkStats;r&&r.period_fir===e.period_fir||g.default.debug("[".concat(M.clientId,"]: Period fir change to: ").concat(e.period_fir)),M.localStreams[M.uid].uplinkStats=e}})),M.socket.on("connect",(function(){M.dispatchEvent({type:"connected"}),M.attemps=1,M.onConnect()})),M.socket.on("recover",(function(){M.state=b,g.default.debug("[".concat(M.clientId,"] Try to reconnect choose server and get gateway list again ")),M.reconnectingCS=!0;var t=M.joinInfo&&M.joinInfo.sid;Object(C.getGatewayList)(M.joinInfo,(function(e){g.default.debug("[".concat(M.clientId,"] session:  ").concat(t," get gateway list success")),M.reconnectingCS?M.socket.replaceHost(e.gateway_addr):g.default.debug("[".concat(M.clientId,"] session:  ").concat(t," already leave"))}))})),M.socket.on("disconnect",(function(t){if(g.default.debug("[".concat(M.clientId,"] Receive disconnect message")),M.state!==h){M.state=h,M._reportWebsocketCloseEvent(-1,T.WEBSOCKET_CLOSE_REASON.WS_DISCONNECT);var e=Object(v.e)({type:"error",reason:T.default.SOCKET_DISCONNECTED});if(M.dispatchEvent(e),0===M.p2ps.size?M.reconnectMode="tryNext":M.reconnectMode="retry",H(),M.channelMediaRelayController&&M.channelMediaRelayController.dispose(),M.channelMediaRelayController=null,1!=r){var n,i=(n=M.attemps,1e3*Math.min(30,Math.pow(2,n)-1));if(g.default.error("[".concat(M.clientId,"] Disconnect from server [").concat(JSON.stringify(t),"], attempt to recover [#").concat(M.attemps,"] after ").concat(i/1e3," seconds")),M.hasInvokeLeave)return g.default.debug("[".concat(M.clientId,"] No reconnection because Client.leave has been invoked")),void(M.hasInvokeLeave=!1);setTimeout((function(){M.attemps++,M.state=b,M.inChannelInfo&&Date.now()-M.inChannelInfo.joinAt>Object(w.getParameter)("TICKET_RENEW_TIMEOUT")?(g.default.debug("Recovering to renew ticket"),D()):j()}),i)}}})),M.socket.on("on_add_audio_stream",(function(t){if(g.default.info("[".concat(M.clientId,"] Newly added audio stream with uid ").concat(t.uid)),M.joinInfo.stringUid&&"string"!=typeof t.uid&&g.default.error("StringUID is Mixed with UintUID"),M.remoteStreamsInChannel.has(t.uid)||M.remoteStreamsInChannel.add(t.uid),void 0===M.remoteStreams[t.uid]){var e=Object(p.a)({streamID:t.uid,local:!1,audio:t.audio,video:t.video,uintUID:t.uint_id||t.uid});e.peerMuteVideo=!0,M.remoteStreams[t.uid]=e;var n=Object(v.e)({type:"stream-added",stream:e});M.dispatchEvent(n);var r=M.remoteMuteState[t.uid];r&&r.audio&&(n=Object(v.a)({type:"mute-audio",uid:t.uid}),M.dispatchEvent(n)),r&&r.video&&(n=Object(v.a)({type:"mute-video",uid:t.uid}),M.dispatchEvent(n))}A.report.onAddAudioStream(M.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:M.uid})})),M.socket.on("on_update_stream",(function(t){g.default.info("[".concat(M.clientId,"] on_update_stream:"),t);var e=M.remoteStreams[t.uid];if(M.joinInfo.stringUid&&"string"!=typeof t.uid&&g.default.error("StringUID is Mixed with UintUID"),e){e.audio=t.audio,e.video=t.video,e.screen=t.screen,e.pc&&M._adjustPCMuteStatus(e);var n=Object(v.e)({type:"stream-updated",stream:e});M.dispatchEvent(n)}else g.default.debug("[".concat(M.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(t.uid));A.report.onUpdateStream(M.joinInfo.sid,{peerid:t.uint_id||t.uid,audio:t.audio,video:t.video,uid:M.uid})})),M.socket.on("on_add_video_stream",(function(t){if(g.default.info("[".concat(M.clientId,"] Newly added remote stream with uid ").concat(t.uid,".")),M.joinInfo.stringUid&&"string"!=typeof t.uid&&g.default.error("StringUID is Mixed with UintUID"),M.remoteStreamsInChannel.has(t.uid)||M.remoteStreamsInChannel.add(t.uid),void 0===M.remoteStreams[t.uid]){var e=Object(p.a)({streamID:t.uid,local:!1,audio:t.audio,video:t.video,uintUID:t.uint_id||t.uid});M.remoteStreams[t.uid]=e;var n=Object(v.e)({type:"stream-added",stream:e});M.dispatchEvent(n);var r=M.remoteMuteState[t.uid];r&&r.audio&&(n=Object(v.a)({type:"mute-audio",uid:t.uid}),M.dispatchEvent(n)),r&&r.video&&(n=Object(v.a)({type:"mute-video",uid:t.uid}),M.dispatchEvent(n))}else{var i=M.remoteStreams[t.uid];if(i.video=!0,i.peerMuteVideo=!1,i.pc&&M._adjustPCMuteStatus(i),g.default.info("[".concat(M.clientId,"] Stream changed: enable video ").concat(t.uid)),void 0!==i.stream&&i.isPlaying()){var o=i.player.elementID;i.stop(),i.play(o,i.playOptions)}}A.report.onAddVideoStream(M.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:M.uid})})),M.socket.on("on_remove_stream",(function(t){g.default.info("[".concat(M.clientId,"] on_remove_stream:"),t),M.remoteStreamsInChannel.has(t.uid)&&M.remoteStreamsInChannel.delete(t.uid);var e=M.remoteStreams[t.uid];if(e){delete M.remoteStreams[t.uid],delete M.remoteMuteState[t.uid];var n=Object(v.e)({type:"stream-removed",stream:e});M.dispatchEvent(n),e.close(),void 0!==e.pc&&(e.pc.close(),e.pc=void 0,M.p2ps.delete(e.p2pId)),A.report.onRemoveStream(M.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:M.uid})}else g.default.error("ERROR stream ",t.uid," not found onRemoveStream ",t)})),M.socket.on("on_publish_stream",(function(t){g.default.info("[".concat(M.clientId,"] on_publish_stream:"),t);var e=M.localStreams[t.uid];M.dispatchEvent({type:"streamPublished",stream:e,proxy:t.proxy}),A.report.reportApiInvoke(M.joinInfo.sid,{name:"on_publish_stream",options:{proxy:t.proxy}})()})),M.socket.on("mute_audio",(function(t){g.default.info("[".concat(M.clientId,"] rcv peer mute audio: ").concat(t.uid)),M.remoteMuteState[t.uid]=M.remoteMuteState[t.uid]||{audio:!1,video:!1},M.remoteMuteState[t.uid].audio=!0;var e=Object(v.a)({type:"mute-audio",uid:t.uid}),n=M.remoteStreams[t.uid];n?(n.peerMuteAudio=!0,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(e)):g.default.debug("Ignoring event ".concat(t.type),t)})),M.socket.on("unmute_audio",(function(t){g.default.info("[".concat(M.clientId,"] rcv peer unmute audio: ").concat(t.uid)),M.remoteMuteState[t.uid]=M.remoteMuteState[t.uid]||{audio:!1,video:!1},M.remoteMuteState[t.uid].audio=!1;var e=Object(v.a)({type:"unmute-audio",uid:t.uid}),n=M.remoteStreams[t.uid];n?(n.peerMuteAudio=!1,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(e)):g.default.debug("Ignoring event ".concat(t.type),t)})),M.socket.on("mute_video",(function(t){g.default.info("[".concat(M.clientId,"] rcv peer mute video: ").concat(t.uid)),M.remoteMuteState[t.uid]=M.remoteMuteState[t.uid]||{audio:!1,video:!1},M.remoteMuteState[t.uid].video=!0;var e=Object(v.a)({type:"mute-video",uid:t.uid}),n=M.remoteStreams[t.uid];n?(n.peerMuteVideo=!0,n.player&&(n.player.peerVideoReady=!1),n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(e)):g.default.debug("Ignoring event ".concat(t.type),t)})),M.socket.on("unmute_video",(function(t){g.default.info("[".concat(M.clientId,"] rcv peer unmute video: ").concat(t.uid)),M.remoteMuteState[t.uid]=M.remoteMuteState[t.uid]||{audio:!1,video:!1},M.remoteMuteState[t.uid].video=!1;var e=Object(v.a)({type:"unmute-video",uid:t.uid}),n=M.remoteStreams[t.uid];n?(n.peerMuteVideo=!1,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(e)):g.default.debug("Ignoring event ".concat(t.type),t)})),M.socket.on("on_crypt_error",(function(t){g.default.warning("[".concat(M.clientId,"] stream crypt error"));var e=Object(v.a)({type:"crypt-error",cryptType:t.crypt_type});M.dispatchEvent(e)})),M.socket.on("on_user_banned",(function(t){g.default.info("[".concat(M.clientId,"] user banned uid: ").concat(t.uid," error: ").concat(t.error_code));var e=Object(v.a)({type:"client-banned",uid:t.uid,attr:t.error_code});M.dispatchEvent(e),r=!0})),M.socket.on("on_stream_fallback_update",(function(t){g.default.info("[".concat(M.clientId,"] stream fallback peerId: ").concat(t.stream_id," type: ").concat(t.stream_type));var e=Object(v.a)({type:"stream-fallback",uid:t.stream_id,stream:t.stream_id,attr:t.stream_type});M.dispatchEvent(e)})),M.socket.on("stream_recover",(function(t){g.default.info("[".concat(M.clientId,"] stream recover uid: ").concat(t.id," peerId: ").concat(t.peerid," type: ").concat(t.type));var e=Object(v.a)({type:"stream-recover",uid:t.id,stream:t.peerid,attr:t.type});M.dispatchEvent(e)})),M.socket.on("on_p2p_lost",(function(t){g.default.debug("[".concat(M.clientId,"] p2plost: "),t,"p2ps:",M.p2ps);var e,n="DTLS failed";(e=M.localStreams[t.uid]||M.remoteStreams[t.uid])?(e.pc&&e.pc.offerCandidates&&0===e.pc.offerCandidates.length&&(n="NO_CANDIDATES_IN_OFFER"),"publish"===t.event&&A.report.publish(M.joinInfo.sid,{lts:e.publishLTS,succ:!1,audio:e.hasAudio(),video:e.hasVideo(),screenshare:e.hasScreen(),audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:n,publishRequestid:M.publishRequestId||0,p2pid:M.p2ps.get(e.getId())}),"subscribe"===t.event&&A.report.subscribe(M.joinInfo.sid,{lts:e.subscribeLTS,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:t.uid+"",ec:n,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:M.p2ps.get(e.getId())})):g.default.warning("P2PLost Stream Not found",t),g.default.debug("[".concat(M.clientId,"] p2plost:"),t.p2pid),(e=M.p2ps.get(t.p2pid))&&(M.p2ps.delete(t.p2pid),e.local?M.dispatchEvent(Object(v.a)({type:"pubP2PLost",stream:e,attr:n})):M.remoteStreams[e.getId()]&&M.dispatchEvent(Object(v.a)({type:"subP2PLost",stream:e,attr:n})))})),M.socket.on("on_token_privilege_will_expire",(function(t){g.default.debug("[".concat(M.clientId,"] Received Message onTokenPrivilegeWillExpire")),M.dispatchEvent(Object(v.a)({type:"onTokenPrivilegeWillExpire"}))})),M.socket.on("on_token_privilege_did_expire",(function(){g.default.warning("[".concat(M.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),M.closeGateway(),M.dispatchEvent(Object(v.a)({type:"onTokenPrivilegeDidExpire"}))})),M.socket.on("enable_local_video",(function(t){g.default.info("[".concat(M.clientId,"] enable_local_video:"),t),M.dispatchEvent(Object(v.a)({type:"enable-local-video",uid:t.uid}))})),M.socket.on("disable_local_video",(function(t){g.default.info("[".concat(M.clientId,"] disable_local_video:"),t),M.dispatchEvent(Object(v.a)({type:"disable-local-video",uid:t.uid}))})),M._doWithAction=function(t,e,n){"tryNext"===t?function(t,e){g.default.debug("[".concat(M.clientId,"] Connect next gateway")),M.state=h,M.socket.close(),H(),M.reconnectMode="tryNext",M.state=b,j(t,e)}(e,n):"retry"===t?function(t,e){g.default.debug("[".concat(M.clientId,"] Reconnect gateway")),M.state=h,M.socket.close(),H(),M.reconnectMode="retry",M.state=b,j(t,e)}(e,n):"quit"===t?(g.default.debug("[".concat(M.clientId,"] quit gateway")),M.state=h,M.socket.close(),H()):"recover"===t&&D()},M.socket.on("on_notification",(function(t){if(g.default.debug("[".concat(M.clientId,"] Receive notification: "),t),"ERR_JOIN_BY_MULTI_IP"===T.GatewayErrorCode[t.code])return M.dispatchEvent({type:"onMultiIP",option:t.option});t.detail?M._doWithAction(R[T.GatewayErrorCode[t.code]]):t.action&&M._doWithAction(t.action)})),M.socket.on("on_user_offline",(function(t){g.default.info("[".concat(M.clientId,"] on_user_offline:"),t);var e=Object(v.a)({type:"peer-leave",uid:t.uid});if(M.remoteStreamsInChannel.has(t.uid)&&M.remoteStreamsInChannel.delete(t.uid),M.remoteStreams.hasOwnProperty(t.uid)&&(e.stream=M.remoteStreams[t.uid]),e.reason=t.reason,M.dispatchEvent(e),g.default.info("[".concat(M.clientId,"] remove remoteMuteState "),t.uid),delete M.remoteMuteState[t.uid],M.remoteStreams.hasOwnProperty(t.uid)){g.default.info("[".concat(M.clientId,"] closing stream on peer leave"),t.uid);var n=M.remoteStreams[t.uid];n.close(),delete M.remoteStreams[t.uid],A.report.onRemoveStream(M.joinInfo.sid,{peerid:t.uint_id||t.uid,uid:M.uid}),void 0!==n.pc&&(n.pc.close(),n.pc=void 0,M.p2ps.delete(n.p2pId))}M.timers.hasOwnProperty(t.uid)&&(clearInterval(M.timers[t.uid]),clearInterval(M.timers[t.uid]+"_RelatedStats"),delete M.timers[t.uid]),null!=M.audioLevel[t.uid]&&delete M.audioLevel[t.uid],null!=M.timer_counter[t.uid]&&delete M.timer_counter[t.uid]})),M.socket.on("onUplinkStats",(function(t){})),M.socket.on("liveStreamingStarted",(function(t){var e=Object(v.c)({type:"liveStreamingStarted",url:t.url});M.dispatchEvent(e)})),M.socket.on("liveStreamingFailed",(function(t){var e=Object(v.c)({type:"liveStreamingFailed",url:t.url});M.dispatchEvent(e)})),M.socket.on("liveStreamingStopped",(function(t){var e=Object(v.c)({type:"liveStreamingStopped",url:t.url});M.dispatchEvent(e)})),M.socket.on("liveTranscodingUpdated",(function(t){var e=Object(v.c)({type:"liveTranscodingUpdated",reason:t.reason});M.dispatchEvent(e)})),M.socket.on("streamInjectedStatus",(function(t){var e=Object(v.c)({type:"streamInjectedStatus",url:t.url,uid:t.uid,status:t.status});M.dispatchEvent(e)})),M.socket.on("on_user_online",(function(t){M.joinInfo.stringUid&&"string"!=typeof t.uid&&g.default.error("StringUID is Mixed with UintUID"),M.dispatchEvent({type:"peer-online",uid:t.uid})})),M.socket.on("receive_metadata",(function(t){M.joinInfo.stringUid&&"string"!=typeof t.uid&&g.default.error("StringUID is Mixed with UintUID");var e=decodeURIComponent(escape(window.atob(t.metadata)));g.default.debug("[".concat(M.clientId,"] received ").concat(t.uid," metadata: ").concat(e)),M.dispatchEvent({type:"receive-metadata",uid:t.uid,metadata:e})}));var o},G=function(t,e){if(void 0!==M.socket)try{M.socket.emitSimpleMessage(t,(function(t,n){e&&e(t,n)}))}catch(t){g.default.error("[".concat(M.clientId,"] Error in sendSimpleSdp [").concat(t,"]"))}else g.default.error("[".concat(M.clientId,"] Error in sendSimpleSdp [socket not ready]"))},Q=function(){for(var t in M.localStreams)if(void 0!==M.localStreams[t]){var e=M.localStreams[t];delete M.localStreams[t],void 0!==e.pc&&(e.pc.close(),e.pc=void 0)}},z=function(){for(var t in M.remoteStreamsInChannel.clear(),M.remoteStreams)if(M.remoteStreams.hasOwnProperty(t)){var e=M.remoteStreams[t];e.isPlaying()&&e.stop(),e.close(),delete M.remoteStreams[t],void 0!==e.pc&&(e.pc.close(),e.pc=void 0)}};return M},F={_gatewayClients:{},register:function(t,e){if(!e.uid){var n="NO_UID_PROVIDED";return g.default.error("[".concat(t.clientId,"] "),n,e),n}if(e.cname)return this._gatewayClients[e.cname]&&this._gatewayClients[e.cname][e.uid]&&this._gatewayClients[e.cname][e.uid]!==t?(n="UID_CONFLICT",g.default.error("[".concat(t.clientId,"] "),n,e),n):(g.default.debug("[".concat(t.clientId,"] register client Channel"),e.cname,"Uid",e.uid),this._gatewayClients[e.cname]||(this._gatewayClients[e.cname]={}),this._gatewayClients[e.cname][e.uid]=t,null);n="NO_CHANNEL_PROVIDED";return g.default.error("[".concat(t.clientId,"] "),n,e),n},unregister:function(t){var e=t&&t.uid,n=t.joinInfo&&t.joinInfo.cname;if(!e||!n){var r="INVALID_GATEWAYCLIENT";return g.default.error("[".concat(t.clientId,"] "),r),r}if(this._gatewayClients[n]&&this._gatewayClients[n][e])return this._gatewayClients[n][e]!==t?(r="GATEWAYCLIENT_UID_CONFLICT",g.default.error("[".concat(t.clientId,"] "),r),r):(g.default.debug("[".concat(t.clientId,"] unregister client "),t.uid),delete this._gatewayClients[n][e],null);r="GATEWEAY_CLIENT_UNREGISTERED";g.default.error("[".concat(t.clientId,"] "),r)}};D.DISCONNECTED=0,D.CONNECTING=1,D.CONNECTED=2,D.DISCONNECTING=3,D.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"},n.a=D},function(t,e,n){t.exports=n(62)},function(t,e,n){"use strict";n.r(e),n.d(e,"post",(function(){return l})),n.d(e,"shouldUseHttps",(function(){return d})),n.d(e,"getHTTPSendBytes",(function(){return s})),n.d(e,"getHTTPRecvBytes",(function(){return c})),n.d(e,"resetHTTPByetsCount",(function(){return u}));var r=n(3),i=n(10),o=0,a=0,s=function(){return o},c=function(){return a},u=function(){o=0,a=0},l=function(t,e,n,s,c){var u=new XMLHttpRequest;if(u.timeout=e.timeout||Object(r.getParameter)("HTTP_CONNECT_TIMEOUT"),u.open("POST",t,!0),u.setRequestHeader("Content-type","application/json; charset=utf-8"),c)for(var l in c)"withCredentials"==l?u.withCredentials=!0:u.setRequestHeader(l,c[l]);u.onload=function(t){a+=Object(i.lengthInUtf8Bytes)(u.responseText),n&&n(u.responseText)},u.onerror=function(e){s&&s(e,t)},u.ontimeout=function(e){s&&s(e,t)};var d=JSON.stringify(e);o+=Object(i.lengthInUtf8Bytes)(d),u.send(d)},d=function(){return"https:"==document.location.protocol}},function(t,e,n){"use strict";n.r(e),n.d(e,"RTCPeerConnection",(function(){return _})),n.d(e,"getUserMedia",(function(){return a})),n.d(e,"attachMediaStream",(function(){return s})),n.d(e,"reattachMediaStream",(function(){return c})),n.d(e,"setSrcObject",(function(){return f})),n.d(e,"getSrcObject",(function(){return p})),n.d(e,"webrtcDetectedBrowser",(function(){return u})),n.d(e,"webrtcDetectedVersion",(function(){return l})),n.d(e,"webrtcMinimumVersion",(function(){return d})),n.d(e,"webrtcTesting",(function(){return S})),n.d(e,"webrtcUtils",(function(){return g}));var r=n(11),i=n.n(r),o=n(4),a=null,s=null,c=null,u=null,l=null,d=null,h=null,f=null,p=null,v=null,m={addStream:null},g={log:function(){},extractVersion:function(t,e,n){var r=t.match(e);return r&&r.length>=n&&parseInt(r[n])}};if("object"==("undefined"==typeof window?"undefined":i()(window))?(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)?(f=function(t,e){"mozSrcObject"in t?t.mozSrcObject=e:(t._srcObject=e,t.src=e?URL.createObjectURL(e):null)},p=function(t){return"mozSrcObject"in t?t.mozSrcObject:t._srcObject}):(f=function(t,e){t.srcObject=e},p=function(t){return t.srcObject}),a=window.navigator&&window.navigator.getUserMedia):(f=function(t,e){t.srcObject=e},p=function(t){return t.srcObject}),s=function(t,e){f(t,e)},c=function(t,e){f(t,p(e))},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var A in g.log("This appears to be Firefox"),u="firefox",l=g.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),d=31,v=mozRTCPeerConnection,m)m[A]=v.prototype[A];if(h=function(t,e){if(l<38&&t&&t.iceServers){for(var n=[],r=0;r<t.iceServers.length;r++){var i=t.iceServers[r];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var a={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(a.username=i.username,a.credential=i.credential),n.push(a)}else n.push(t.iceServers[r])}t.iceServers=n}var s=new v(t,e);for(var c in m)s[c]=m[c];return s},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),a=function(t,e,n){var r=function(t){if("object"!==i()(t)||t.require)return t;var e=[];return Object.keys(t).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=t[n]="object"===i()(t[n])?t[n]:{ideal:t[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||e.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:t[n]=r.exact,delete r.exact),void 0!==r.ideal){t.advanced=t.advanced||[];var o={};"number"==typeof r.ideal?o[n]={min:r.ideal,max:r.ideal}:o[n]=r.ideal,t.advanced.push(o),delete r.ideal,Object.keys(r).length||delete t[n]}}})),e.length&&(t.require=e),t};return l<38&&(g.log("spec: "+JSON.stringify(t)),t.audio&&(t.audio=r(t.audio)),t.video&&(t.video=r(t.video)),g.log("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,e,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:E,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise((function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},l<41){var y=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return y().then(void 0,(function(t){if("NotFoundError"===t.name)return[];throw t}))}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var A in g.log("This appears to be Chrome"),u="chrome",l=g.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),d=38,v=webkitRTCPeerConnection,m)m[A]=v.prototype[A];h=function(t,e){t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var n=new v(t,e);for(var r in m)n[r]=m[r];var i=n.getStats.bind(n);return n.getStats=function(t,e,n){var r=arguments;r.length>0&&"function"==typeof t&&(e?(n=e,e=t,r=[t=null,e,n]):(e=t,r=[t=null,e]));var o=function(t){var e={};return t.result().forEach((function(t){var n={id:t.id,timestamp:t.timestamp,type:t.type};t.names().forEach((function(e){n[e]=t.stat(e)})),e[n.id]=n})),e};if(r.length>=2){var a=function(t){r[1](o(t))};return i.apply(this,[a,r[0]])}return i()},n},["createOffer","createAnswer"].forEach((function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"===i()(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new Promise((function(r,i){e.apply(t,[r,i,n])}))}return e.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=arguments,n=this;return new Promise((function(r,i){e.apply(n,[t[0],function(){r(),t.length>=2&&t[1].apply(null,[])},function(e){i(e),t.length>=3&&t[2].apply(null,[e])}])}))}}));var b=function(t){if("object"!==i()(t)||t.mandatory||t.optional)return t;var e={};return Object.keys(t).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===i()(t[n])?t[n]:{ideal:t[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==r.ideal){e.optional=e.optional||[];var a={};"number"==typeof r.ideal?(a[o("min",n)]=r.ideal,e.optional.push(a),(a={})[o("max",n)]=r.ideal,e.optional.push(a)):(a[o("",n)]=r.ideal,e.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(e.mandatory=e.mandatory||{},e.mandatory[o("",n)]=r.exact):["min","max"].forEach((function(t){void 0!==r[t]&&(e.mandatory=e.mandatory||{},e.mandatory[o(t,n)]=r[t])}))}})),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e};if(a=function(t,e,n){return t.audio&&(t.audio=b(t.audio)),t.video&&(t.video=b(t.video)),g.log("chrome: "+JSON.stringify(t)),navigator.webkitGetUserMedia(t,e,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:E,enumerateDevices:function(){return new Promise((function(t){var e={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(n){t(n.map((function(t){return{label:t.label,kind:e[t.kind],deviceId:t.id,groupId:""}})))}))}))}}),navigator.mediaDevices.getUserMedia){if((Object(o.getBrowserVersion)()?Number(Object(o.getBrowserVersion)().split(".")[0]):void 0)<46){var w=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return g.log("spec:   "+JSON.stringify(t)),t.audio=b(t.audio),t.video=b(t.video),g.log("chrome: "+JSON.stringify(t)),w(t)}}}else navigator.mediaDevices.getUserMedia=function(t){return E(t)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){g.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){g.log("Dummy mediaDevices.removeEventListener called.")}),s=function(t,e){l>=43?f(t,e):void 0!==t.src?t.src=e?URL.createObjectURL(e):null:g.log("Error attaching stream to element.")},c=function(t,e){l>=43?f(t,p(e)):t.src=e.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(g.log("This appears to be Edge"),u="edge",l=g.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),d=12):g.log("Browser does not appear to be WebRTC-capable");else g.log("This does not appear to be a browser"),u="not a browser";function E(t){return new Promise((function(e,n){a(t,e,n)}))}var _,S={};try{Object.defineProperty(S,"version",{set:function(t){l=t}})}catch(t){}h?_=h:"undefined"!=typeof window&&(_=window.RTCPeerConnection)},function(t,e,n){"use strict";var r=n(13),i=n.n(r),o=n(17),a=n.n(o),s=n(48),c=n.n(s),u=n(4),l=n(1),d=n(2),h=n(0),f=(n(25),n(3),n(5),n(49)),p=n.n(f),v=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function m(t){for(var e=new Uint8Array([99,114,121,112,116,105,105]),n=e.length,r=t,i=r.length,o=new Uint8Array(i),a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;for(var c=0,u=0;u<256;u++){var l=[a[c=(c+a[u]+e[u%n])%256],a[u]];a[u]=l[0],a[c]=l[1]}var d,h=0;c=0;for(var f=0;f<0+i;f++){var p=[a[c=(c+a[h=(h+1)%256])%256],a[h]];a[h]=p[0],a[c]=p[1],d=a[(a[h]+a[c])%256],f>=0&&(o[f-0]=r[f-0]^d)}var v=String.fromCharCode.apply(null,o);return Function("var winSize = 5; return `"+v+"`")()}function g(t,e){var n=m(e),r=p.a.createProgramFromSources(t,[m(v),n]),i=t.getAttribLocation(r,"a_position"),o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(i);var a=2,s=t.FLOAT,c=!1,u=0,l=0;t.vertexAttribPointer(i,a,s,c,u,l);var d=t.getAttribLocation(r,"a_texCoord"),h=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(d),a=2,s=t.FLOAT,c=!1,u=0,l=0,t.vertexAttribPointer(d,a,s,c,u,l),r}var A=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];function y(t,e,n){var r=t.gl;this.program=g(r,A),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY");r.uniform1f(t,1)}}var b=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];function w(t,e,n){var r=t.gl,i=1/e,o=1/n,a=5;this.program=g(r,b),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),e=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(e,i,o),r.uniform1f(n,a),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(a=t.denoiseLevel)},this.setSize=function(t,e){i=1/t,o=1/e}}var E=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];function _(t,e,n){var r=t.gl,i=1/e,o=1/n,a=5;this.program=g(r,E),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),e=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(e,i,o),r.uniform1f(n,a),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(a=t.denoiseLevel)},this.setSize=function(t,e){i=1/t,o=1/e}}var S=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];function T(t,e,n){var r=t.gl,i=1/e,o=1/n,a=5;this.program=g(r,S),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var t=r.getUniformLocation(this.program,"u_flipY"),e=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(e,i,o),r.uniform1f(n,a),r.uniform1f(t,1)},this.setParameters=function(t){void 0!==t.denoiseLevel&&(a=t.denoiseLevel)},this.setSize=function(t,e){i=1/t,o=1/e}}var C=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144];function x(t,e,n){var r=t.gl,i=5,o=.1,a=.5,s=175/180*3.141593,c=115/180*3.141593,u=173/180*3.141593,l=116/180*3.141593,d=2.04203545,h=0,f=0,p=0,v=[],m=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],A=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],y=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];this.program=g(r,C),this.setUniforms=function(){var e=r.getUniformLocation(this.program,"u_flipY"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform1f(n,i),r.uniform1f(e,1);var m=r.getUniformLocation(this.program,"light");r.uniform1f(m,o);var g=r.getUniformLocation(this.program,"redness");r.uniform1f(g,a);var A=r.getUniformLocation(this.program,"skin_he_max"),y=r.getUniformLocation(this.program,"skin_he_min"),b=r.getUniformLocation(this.program,"skin_hc_max"),w=r.getUniformLocation(this.program,"skin_hc_min"),E=r.getUniformLocation(this.program,"skin_hc_axis"),_=r.getUniformLocation(this.program,"facts_rotate_c"),S=r.getUniformLocation(this.program,"facts_rotate_le"),T=r.getUniformLocation(this.program,"facts_rotate_ge");r.uniform1f(A,s),r.uniform1f(y,c),r.uniform1f(b,u),r.uniform1f(w,l),r.uniform1f(E,d),r.uniform1f(_,h),r.uniform1f(S,f),r.uniform1f(T,p);var C=r.getUniformLocation(this.program,"u_originImage");r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,t.inputTexture),r.uniform1i(C,2);for(var x=["lighten_lut"],R=[r.TEXTURE3],I=0;I<x.length;I++){var O=r.getUniformLocation(this.program,x[I]);r.activeTexture(R[I]),r.bindTexture(r.TEXTURE_2D,v[I]),r.uniform1i(O,I+3)}},this.setParameters=function(t){void 0!==t.denoiseLevel&&(i=t.denoiseLevel),void 0!==t.lightLevel&&(o=t.lightLevel),void 0!==t.rednessLevel&&(a=t.rednessLevel,this._updateRedness(a)),void 0!==t.lighteningContrastLevel&&this._updateLut(t.lighteningContrastLevel)},this._updateRedness=function(t){var e,n,r=3.141593,i=t,o=i;i>1&&(i=1),i<0&&(i=0),o>1&&(o=1),o<0&&(o=0),h=.8*i,o<.8&&(o=0),(d=(117-4*o)/180*r)<(l=(116-4*o)/180*r)&&(d=l),l<r/2&&(l=r/2),d<r/2&&(d=r/2),(c=(115-4*o)/180*r)<r/2&&(c=r/2),(u=173/180*r)>r&&(u=r),d>r&&(d=r),(s=175/180*r)>r&&(s=r),n=u-d,p=(e=s-u)>.01?h*n/e:h,n=d-l,f=(e=l-c)>.01?h*n/e:h},this._updateLut=function(t){var e=null;0==t&&(e=A),1==t&&(e=y),2==t&&(e=m);for(var n=[new Uint8Array(e)],i=[256],o=[1],a=0;a<n.length;a++)r.bindTexture(r.TEXTURE_2D,v[a]),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,i[a],o[a],0,r.LUMINANCE,r.UNSIGNED_BYTE,n[a])},this._init=function(){for(var t=[new Uint8Array(A)],e=[256],n=[1],i=0;i<t.length;i++){var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,e[i],n[i],0,r.LUMINANCE,r.UNSIGNED_BYTE,t[i]),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),v.push(o)}},this._init()}var R=!1;function I(){this.programs=[];var t=this,e=null,n=null;t.gl=null,t.inputTexture=null;var r=[],i=[],o=0,a=0;t._initGl=function(n,s){t.inputTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.inputTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);for(var c=0;c<4;c++){var u=e.createTexture();e.bindTexture(e.TEXTURE_2D,u),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),c<2?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,s,0,e.RGBA,e.UNSIGNED_BYTE,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,s,n,0,e.RGBA,e.UNSIGNED_BYTE,null);var l=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,l),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),r.push(u),i.push(l)}e.viewport(0,0,n,s),o=n,a=s},t.render=function(s){if(e){var c=0;a==s.videoWidth&&o===s.videoHeight&&(c=2),e.viewport(0,0,s.videoWidth,s.videoHeight),e.bindTexture(e.TEXTURE_2D,t.inputTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s);for(var u=R?t.programs.length-1:0,l=0;l<=u;l++){var d=t.programs[l].program;e.useProgram(d);var h=e.getUniformLocation(d,"u_image");t.programs[l].setUniforms(),e.bindFramebuffer(e.FRAMEBUFFER,i[c+l%2]),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r[c+l%2]),e.uniform1i(h,0)}e.useProgram(n);var f=e.getUniformLocation(n,"u_flipY");e.uniform1f(f,-1),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6)}},t.setEnableBeauty=function(t){R=t},t.init=function(r,i,o){if("undefined"==typeof WebGLRenderingContext)throw new Error("NOT_SUPPORT");e=o.getContext("webgl"),t.gl=e,t._initGl(r,i),t.programs.push(new y(this,r,i)),t.programs.push(new w(this,r,i)),t.programs.push(new _(this,r,i)),t.programs.push(new T(this,r,i)),t.programs.push(new x(this,r,i)),n=t.programs[0].program},t.release=function(){t.gl=null,e=null,n=null,t.inputTexture=null,t.programs=[],r=[],i=[]},t.setDenoiseLevel=function(e){t.programs.forEach((function(t){t.setParameters&&t.setParameters({denoiseLevel:e})}))},t.setLightLevel=function(e){t.programs.forEach((function(t){t.setParameters&&t.setParameters({lightLevel:e})}))},t.setRednessLevel=function(e){t.programs.forEach((function(t){t.setParameters&&t.setParameters({rednessLevel:e})}))},t.setContrastLevel=function(e){t.programs.forEach((function(t){t.setParameters&&t.setParameters({lighteningContrastLevel:e})}))},t.setSize=function(e,n){t.programs.forEach((function(t){t.setSize&&t.setSize(e,n)}))}}I._instance=null,I.getInstance=function(){return I._instance||(I._instance=new I),I._instance},e.a={addVideoEffectCapability:function(t){t.videoEffect={canvas:null,video:null,fps:30,stopChromeBackgroundLoop:null,enableBeauty:!1,denoiseLevel:5,lightLevel:.35,rednessLevel:.5,lighteningContrastLevel:1,videoContextInited:!1,originVideoTrack:null,canvasVideoTrack:null,ctx:null},t._initVideoContext=function(){if(t.videoEffect.videoContextInited)throw new Error("Failed to init video context. Already inited");if(!t.stream)throw new Error("Failed to init video context. Local Stream not initialized");t.videoEffect.originVideoTrack=t.stream.getVideoTracks()[0],t.attributes&&t.attributes.maxFrameRate&&(t.videoEffect.fps=t.attributes.maxFrameRate),t.videoEffect.videoContextInited=!0},t._renderWithWebGL=function(e){return new Promise((function(n){t.videoEffect.canvas||(t.videoEffect.canvas=document.createElement("canvas")),t.videoEffect.video||(t.videoEffect.video=document.createElement("video")),t.videoEffect.video.setAttribute("autoplay",""),t.videoEffect.video.setAttribute("muted",""),t.videoEffect.video.muted=!0,t.videoEffect.video.setAttribute("playsinline",""),t.videoEffect.video.setAttribute("style","display:none"),t.videoEffect.video.srcObject=e;var r=e.getVideoTracks()[0].getSettings(),i=r.width,o=r.height;console.log("Width: ".concat(i,", Height: ").concat(o)),t.videoEffect.canvas.setAttribute("width",i),t.videoEffect.canvas.setAttribute("height",o),t.videoEffect.video.setAttribute("width",i),t.videoEffect.video.setAttribute("height",o);var a=I.getInstance();a.init(t.videoEffect.video.width,t.videoEffect.video.height,t.videoEffect.canvas),a.setDenoiseLevel(t.videoEffect.denoiseLevel),a.setLightLevel(t.videoEffect.lightLevel),a.setRednessLevel(t.videoEffect.rednessLevel),a.setContrastLevel(t.videoEffect.lighteningContrastLevel),t.videoEffect.video.addEventListener("playing",(function e(){var r=t.videoEffect.canvas.captureStream(t.videoEffect.fps);t.videoEffect.video.removeEventListener("playing",e,!0),n([r.getVideoTracks()[0],t.videoEffect.video])}),!0),t.videoEffect.video.play()}))},t._disableEffect=function(){t.videoEffect.videoContextInited||t._initVideoContext();var e=t.videoEffect.originVideoTrack;if(!e)return h.default.warning("Video track is null, fail to disable video effect!"),Promise.resolve();if(t.pc&&t.pc.peerConnection&&t.pc.peerConnection){var n=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find((function(t){return t&&t.track&&"video"==t.track.kind}));if(n&&n.replaceTrack&&e)return n.replaceTrack(e)}return Promise.resolve()},t._releaseEffect=function(){var e;return e=t.videoEffect.enableBeauty?t._disableEffect():Promise.resolve(),I.getInstance().release(),t.videoEffect.videoContextInited=!1,t.videoEffect.canvasVideoTrack=null,e},t._enableEffect=function(){return t.videoEffect.videoContextInited||t._initVideoContext(),t.videoEffect.originVideoTrack?t.videoEffect.canvasVideoTrack?(t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()):t._renderWithWebGL(t.stream).then((function(e){var n=c()(e,2),r=n[0],i=n[1];t.videoEffect.canvasVideoTrack=r;var o=I.getInstance();return requestAnimationFrame((function e(){t.videoEffect.enableBeauty&&o.render(i),t.videoEffect.videoContextInited&&requestAnimationFrame(e)})),u.isChrome()&&document.addEventListener("visibilitychange",(function(){document.hidden,document.hidden?t.videoEffect.stopChromeBackgroundLoop=function(t,e){var n=1/e,r=new AudioContext,i=r.createGain();i.gain.value=0,i.connect(r.destination),function e(){var a=r.createOscillator();a.onended=e,a.connect(i),a.start(0),a.stop(r.currentTime+n),t(r.currentTime),o&&(a.onended=function(){r.close()})}();var o=!1;return function(){o=!0}}((function(){t.videoEffect.enableBeauty&&o.render(i)}),t.videoEffect.fps):t.videoEffect.stopChromeBackgroundLoop&&(t.videoEffect.stopChromeBackgroundLoop(),t.videoEffect.stopChromeBackgroundLoop=null)}),!1),t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()})):(h.default.warning("Video track is null, fail to enable video effect!"),Promise.resolve())},t._showEffectInLocalPlayer=function(){if(t.player){var e=t.player.div.children[0];if("none"!==e.style.display&&(t.player.div.appendChild(t.videoEffect.canvas),"video"===e.tagName.toLowerCase())){var n=e.getAttribute("style");t.videoEffect.canvas.setAttribute("style",n),"none"!==e.style.display&&(e.style.display="none")}}},t._removeEffectFromLocalPlayer=function(){if(t.player&&t.player.div&&t.videoEffect.enableBeauty&&t.videoEffect.canvas){t.player.div.removeChild(t.videoEffect.canvas);var e=t.player.div.children[0];"video"===e.tagName.toLowerCase()&&(t.videoEffect.canvas.style.display="none",e.style.display="block")}},t._replaceWithCanvasTrack=function(){var e=null;return t.pc&&t.pc.peerConnection&&t.pc.peerConnection&&(e=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find((function(t){return t&&t.track&&"video"==t.track.kind}))),e&&e.replaceTrack&&t.videoEffect.canvasVideoTrack?e.replaceTrack(t.videoEffect.canvasVideoTrack):Promise.resolve()},t.setBeautyEffectOptions=function(){var e=a()(i.a.mark((function e(n,r){var o,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(d.checkValidBoolean)(n,"enabled"),o=I.getInstance(),t.videoEffect.enableBeauty==n){e.next=14;break}if(o.setEnableBeauty(n),!n){e.next=9;break}return e.next=7,t._enableEffect();case 7:e.next=12;break;case 9:return t._removeEffectFromLocalPlayer(),e.next=12,t._releaseEffect();case 12:t.videoEffect.enableBeauty=n,l.report.reportApiInvoke(t.sid,{callback:null,options:a,name:"Stream.setBeautyEffectOptions",tag:"tracer"});case 14:if(n){e.next=16;break}return e.abrupt("return");case 16:if(!r){e.next=20;break}Object(d.checkValidObject)(r,"options"),e.next=21;break;case 20:return e.abrupt("return");case 21:if(void 0!==r.smoothnessLevel&&(Object(d.checkValidFloatNumber)(r.smoothnessLevel,"smoothnessLevel",0,1),t.videoEffect.denoiseLevel=10*r.smoothnessLevel,t.videoEffect.denoiseLevel<.1&&(t.videoEffect.denoiseLevel=.1),o.setDenoiseLevel(t.videoEffect.denoiseLevel)),void 0!==r.lighteningLevel&&(Object(d.checkValidFloatNumber)(r.lighteningLevel,"lighteningLevel",0,1),t.videoEffect.lightLevel=r.lighteningLevel/2,t.videoEffect.lightLevel<.01&&(t.videoEffect.lightLevel=.01),o.setLightLevel(t.videoEffect.lightLevel)),void 0!==r.rednessLevel&&(Object(d.checkValidFloatNumber)(r.rednessLevel,"rednessLevel",0,1),t.videoEffect.rednessLevel=r.rednessLevel,t.videoEffect.rednessLevel<.01&&(t.videoEffect.rednessLevel=.01),o.setRednessLevel(t.videoEffect.rednessLevel)),void 0===r.lighteningContrastLevel){e.next=29;break}if(0===r.lighteningContrastLevel||1===r.lighteningContrastLevel||2===r.lighteningContrastLevel){e.next=27;break}throw new Error("Invalid lighteningContrastLevel: The value should be 0, 1 or 2.");case 27:t.videoEffect.lighteningContrastLevel=parseFloat(r.lighteningContrastLevel),o.setContrastLevel(t.videoEffect.lighteningContrastLevel);case 29:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},restoreVideoEffect:function(t){return t.videoEffect.enableBeauty?t._enableEffect():Promise.resolve()},disableVideoEffect:function(t){return t._releaseEffect?t._releaseEffect():Promise.resolve()},applyEffectInPlayer:function(t){t.videoEffect.enableBeauty&&t.videoEffect.canvas&&t._showEffectInLocalPlayer()},removeEffectFromLocalPlayer:function(t){t._removeEffectFromLocalPlayer()},replaceWithCanvasTrack:function(t){return t.videoEffect.enableBeauty?t._replaceWithCanvasTrack():Promise.resolve()},checkVideoEffectEnabled:function(t){return!!(t.videoEffect.enableBeauty&&t.videoEffect&&t.videoEffect.videoContextInited)&&(h.default.error("Operation not permitted: ".concat("VIDEO_EFFECT_ENABLED")),"VIDEO_EFFECT_ENABLED")}}},function(t,e){function n(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function s(t){n(a,i,o,s,c,"next",t)}function c(t){n(a,i,o,s,c,"throw",t)}s(void 0)}))}}},function(t,e,n){"use strict";var r=n(35),i=Object.prototype.toString;function o(t){return"[object Array]"===i.call(t)}function a(t){return void 0===t}function s(t){return null!==t&&"object"==typeof t}function c(t){return"[object Function]"===i.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===i.call(t)},isBuffer:function(t){return null!==t&&!a(t)&&null!==t.constructor&&!a(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:s,isUndefined:a,isDate:function(t){return"[object Date]"===i.call(t)},isFile:function(t){return"[object File]"===i.call(t)},isBlob:function(t){return"[object Blob]"===i.call(t)},isFunction:c,isStream:function(t){return s(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function t(){var e={};function n(n,r){"object"==typeof e[r]&&"object"==typeof n?e[r]=t(e[r],n):e[r]=n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return e},deepMerge:function t(){var e={};function n(n,r){"object"==typeof e[r]&&"object"==typeof n?e[r]=t(e[r],n):e[r]="object"==typeof n?t({},n):n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return e},extend:function(t,e,n){return u(e,(function(e,i){t[i]=n&&"function"==typeof e?r(e,n):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(7),i=n.n(r),o=n(8),a=n(0),s=n(5);function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u=new function(){var t=Object(o.b)();return t.devicesHistory={},t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},t.deviceReloadTimer=null,t._init=function(e,n){t.state=t.states.INITING,t.devicesHistory={},t._reloadDevicesInfo((function(){t.state=t.states.INITED,t.dispatchEvent({type:"inited"}),e&&e()}),(function(e){a.default.warning("Device Detection functionality cannot start properly."),t.state=t.states.UNINIT,n&&n(e)}))},t._enumerateDevices=function(t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return a.default.warning("enumerateDevices() not supported."),e&&e("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then((function(e){t&&setTimeout((function(){t(e)}),0)})).catch((function(t){e&&e(t)}))},t._reloadDevicesInfo=function(e,n){var r=[];t._enumerateDevices((function(n){var o=Date.now();for(var s in n.forEach((function(e){var n=t.devicesHistory[e.deviceId];if((n?n.state:t.deviceStates.INACTIVE)!=t.deviceStates.ACTIVE){var i=n||{initAt:o};i.device=e,i.state=t.deviceStates.ACTIVE,r.push(i),t.devicesHistory[e.deviceId]=i}t.devicesHistory[e.deviceId].lastReloadAt=o})),t.devicesHistory){var c=t.devicesHistory[s];c&&c.state==t.deviceStates.ACTIVE&&c.lastReloadAt!==o&&(c.state=t.deviceStates.INACTIVE,r.push(c)),c.lastReloadAt=o}t.state==t.states.INITED&&r.forEach((function(e){var n=i()({},e);switch(e.device.kind){case"audioinput":n.type="recordingDeviceChanged";break;case"audiooutput":n.type="playoutDeviceChanged";break;case"videoinput":n.type="cameraChanged";break;default:a.default.warning("Unknown device change",n),n.type="unknownDeviceChanged"}t.dispatchEvent(n)})),e&&e()}),n)},t.getDeviceById=function(e,n,r){t.getDevices((function(t){for(var i=0;i<t.length;i++){var o=t[i];if(o&&o.deviceId===e)return n&&n(o)}return r&&r()}))},t.searchDeviceNameById=function(e){var n=t.devicesHistory[e];return n?n.device.label||n.device.deviceId:null},t.getDevices=function(e,n){t._enumerateDevices(e,(function(t){n&&n(t.name+": "+t.message)}))},t.getVideoCameraIdByLabel=function(e,n,r){t.getCameras((function(t){var i,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;if(a.label===e)return n&&n(a.deviceId)}}catch(t){o.e(t)}finally{o.f()}return r&&r(s.default.NOT_FIND_DEVICE_BY_LABEL)}),r)},t.getRecordingDevices=function(e,n){return t._enumerateDevices((function(t){var n=t.filter((function(t){return"audioinput"==t.kind}));e&&e(n)}),(function(t){n&&n(t)}))},t.getPlayoutDevices=function(e,n){return t._enumerateDevices((function(t){var n=t.filter((function(t){return"audiooutput"==t.kind}));e&&e(n)}),(function(t){n&&n(t)}))},t.getCameras=function(e,n){return t._enumerateDevices((function(t){var n=t.filter((function(t){return"videoinput"==t.kind}));e&&e(n)}),(function(t){n&&n(t)}))},t._init((function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",(function(){t._reloadDevicesInfo()})),t.deviceReloadTimer=setInterval(t._reloadDevicesInfo,5e3)})),t}},function(t,e,n){"use strict";n.r(e),n.d(e,"_getReconnectCSTimer",(function(){return _})),n.d(e,"_setClientConnectionStateRecord",(function(){return S})),n.d(e,"getGatewayList",(function(){return C})),n.d(e,"getUserAccount",(function(){return R}));var r=n(11),i=n.n(r),o=n(13),a=n.n(o),s=n(17),c=n.n(s),u=n(3),l=(n(4),n(0)),d=n(14),h=n(1),f=n(5),p=function(t,e){var n=!1,r=0,i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,uid:t.uid,cname:t.cname,ts:Math.floor(Date.now()/1e3),version:u.VERSION,seq:0,requestId:1};Object(u.getParameter)("PROXY_CS").map((function(o){var a=(new Date).getTime();v("https://"+o+"/api/v1",i,(function(i,s){if(i)return l.default.debug("["+t.clientId+"] Request proxy server failed: ",i),r++,h.report.requestProxyAppCenter(t.sid,{lts:a,succ:!1,APAddr:o,workerManagerList:null,ec:JSON.stringify(i),response:JSON.stringify({err:i,res:s})}),void(r>=Object(u.getParameter)("PROXY_CS").length&&e&&e("Get proxy server failed: request all failed"));if(!n)if((s=JSON.parse(s)).json_body){var c=JSON.parse(s.json_body);if(l.default.debug("["+t.clientId+"] App return:",c.servers),200!==c.code)i="Get proxy server failed: response code ["+c.code+"], reason [ "+c.reason+"]",r++,l.default.debug("["+t.clientId+"] "+i),h.report.requestProxyAppCenter(t.sid,{lts:a,succ:!1,APAddr:o,workerManagerList:null,ec:i,response:JSON.stringify({err:i,res:s})}),r>=Object(u.getParameter)("PROXY_CS").length&&e&&e(i);else{n=!0;var d=g(c.servers);h.report.requestProxyAppCenter(t.sid,{lts:a,succ:!0,APAddr:o,workerManagerList:JSON.stringify(d),ec:null,response:JSON.stringify({res:s})}),e&&e(null,d)}}else l.default.debug("["+t.clientId+"] Get proxy server failed: no json_body"),h.report.requestProxyAppCenter(t.sid,{lts:a,succ:!1,APAddr:o,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:s})})}))}))},v=function(t,e,n){var r={service_name:"webrtc_proxy",json_body:JSON.stringify(e)};Object(d.post)(t,r,(function(t){n&&n(null,t)}),(function(t){n&&n(t)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})},m=function(t,e,n){var r=!1,i=0,o={command:"request",gatewayType:"http",appId:t.appId,cname:t.cname,uid:t.uid+"",sdkVersion:"2.3.1",sid:t.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:t.appId,cname:t.cname,uid:t.uid+"",sid:t.sid}};e.map((function(a){var s=(new Date).getTime();!function(t,e,n){Object(d.post)(t,e,(function(t){n&&n(null,t)}),(function(t){n&&n(t)}))}("https://"+a+":4000/v2/machine",o,(function(o,c){if(o)return l.default.debug("["+t.clientId+"] Request worker manager failed: ",o),i++,h.report.requestProxyWorkerManager(t.sid,{lts:s,succ:!1,workerManagerAddr:a,ec:JSON.stringify(o),response:JSON.stringify({res:c})}),void(i>=e.length&&n&&n("requeet worker manager server failed: request failed"));if(!r){if(!(c=JSON.parse(c)).serverResponse)return n&&n("requeet worker manager server failed: serverResponse is undefined");r=!0,h.report.requestProxyWorkerManager(t.sid,{lts:s,succ:!0,workerManagerAddr:a,ec:JSON.stringify(o),response:JSON.stringify({res:c})}),n&&n(null,{address:a,serverResponse:c.serverResponse})}}))}))},g=function(t){if(!t||[]instanceof Array==0)return[];var e=[];return t.forEach((function(t){var n;t.address&&t.tcp?(t.address.match(/^[\.\:\d]+$/)?n="".concat(t.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(l.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(t.address,". Used As Host instead")),n="".concat(t.address,":").concat(t.tcp)),e.push(n)):l.default.error("["+joinInfo.clientId+"] Invalid address format ",t)})),e},A=n(21),y=function(t,e,n,r){var i,o=Object(u.getParameter)("PROXY_CS"),a=0,s=!0;o.map((function(c){var p=Date.now();!function(t,e,n,r){var i=Object(u.getParameter)("AREA_SETTING").reduce((function(t,e,n){var r=Object(A.getAreaCodeByArea)(e);return r?0===n?r:"".concat(t,",").concat(r):t}),""),o={opid:133,flag:1048576,ts:+new Date,key:e.token,cname:e.cname,sid:e.sid,detail:{11:i,6:e.stringUid},uid:e.uid||0};t="https://".concat(t,"/api/v1"),Object(d.post)(t,o,(function(i){try{var o=JSON.parse(i);o.res&&(o=o.res);var a=o.code}catch(t){return l.default.error("[".concat(e.clientId,"] requestProxyServer failed with unexpected body ")),n("UNEXPECTED_ERROR")}var s;if(a)return s=new RegExp(/10102\d{2}$/).test(a)?"NO_SERVICE_AVAILABLE":f.APErrorCode[o.code]||a,l.default.error("[".concat(e.clientId,"] requestProxyServer failed: ").concat(s)),n(s);(!o.addresses||!o.addresses instanceof Array)&&n("UNEXPECTED_ERROR");var c=Object(u.getParameter)("GATEWAY_DOMAINS"),d=0;if(t.indexOf(c[1])>-1&&(d=1),0===o.addresses.length)return n("EMPTY_PROXY_LIST");var h=o.addresses.map((function(t){if(t.ip)return t.ip=r?"".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(c[d++%c.length]):"".concat(t.ip),t}));return n(null,h)}),(function(t,e){"timeout"===t.type?n("REQUEST_PROXY_SERVER_TIME_OUT"):n("REQUEST_PROXY_SERVER_FAILED")}),{"X-Packet-Service-Type":0,"X-Packet-URI":69})}(c,e,(function(r,u){var d=Date.now();try{h.report.joinWebProxyAP({lts:d,sid:e.sid,cname:e.cname,cid:e.cid,uid:e.uid,sucess:r?-1:1,elapse:d-p,eventType:t,apServerAddr:c,turnServerAddrList:JSON.stringify(u),errorCode:r||"0"})}catch(t){}r?(a++,l.default.error("[".concat(e.clientId,"] request ").concat(c," failed: ").concat(r)),r&&-1===f.JOIN_PROXY_RETRY_LIST.indexOf(r)&&(i=r),a===o.length&&(i||(i="RETRYABLE_ERROR"),n(i))):s&&(s=!1,n(null,u))}),r)}))},b=n(12),w={},E={},_=function(t){return w[t]},S=function(t,e){E[t]=e},T=function(t,e,n,r,i){var o=(new Date).getTime(),a=e,s="";e.multiIP&&e.multiIP.gateway_ip&&(s={vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]});var c=Object(u.getParameter)("AREA_SETTING").reduce((function(t,e,n){var r=Object(A.getAreaCodeByArea)(e);return r?0===n?r:"".concat(t,",").concat(r):t}),""),p={opid:133,flag:4096,ts:+new Date,key:e.token,cname:e.cname,sid:e.sid,detail:{6:e.stringUid,11:c},uid:e.uid||0};s&&(p.detail[5]=JSON.stringify(s)),Object(d.post)(t+"".concat(-1===t.indexOf("?")?"?":"&","action=wrtc_gateway"),p,(function(i){try{var s=JSON.parse(i);s.res&&(s=s.res);var c=s.code}catch(t){var d="requestChooseServer failed with unexpected body "+i;return l.default.error("["+a.clientId+"]",d),r(d)}if(c)return g=new RegExp(/10102\d{2}$/).test(c)?"NO_SERVICE_AVAILABLE":f.APErrorCode[s.code]||c,h.report.joinChooseServer(e.sid,{lts:o,succ:!1,csAddr:t,serverList:null,ec:g}),r("Get server node failed ["+g+"]",t,g);var p=[],v=Object(u.getParameter)("GATEWAY_DOMAINS"),m=0;if(t.indexOf(v[1])>-1&&(m=1),s.addresses.forEach((function(t){var e;t.ip&&t.port?(t.ip.match(/^[\.\:\d]+$/)?e="".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(v[m++%v.length],":").concat(t.port):(l.default.info("["+a.clientId+"] "+"Cannot recognized as IP address ".concat(t.ip,". Used As Host instead")),e="".concat(t.ip,":").concat(t.port)),p.push(e)):l.default.error("["+a.clientId+"] Invalid address format ",t)})),!p.length){l.default.error("["+a.clientId+"] Empty Address response",s);var g="EMPTY_ADDRESS_RESPONSE";return h.report.joinChooseServer(e.sid,{lts:o,succ:!1,csAddr:t,serverList:null,ec:g}),r("Get server node failed ["+g+"]",t,g)}var A={gateway_addr:p,uid:s.uid,cid:s.cid,vid:s.detail&&s.detail[8],res:s,uni_lbs_ip:s.detail};return n(A,t)}),(function(t,n){"timeout"===t.type?(h.report.joinChooseServer(e.sid,{lts:o,succ:!1,csAddr:n,serverList:null,ec:"timeout"}),r("Connect choose server timeout",n)):(h.report.joinChooseServer(e.sid,{lts:o,succ:!1,csAddr:n,serverList:null,ec:"server_wrong"}),r("Connect choose server error",n))}),{"X-Packet-Service-Type":0,"X-Packet-URI":69})},C=function(t,e,n){var r=!1,i=null,o=1,a=1,s=t.clientId,c=function e(a,c){if(!r){var d=[];!function(t,e,n){for(var r,i=(new Date).getTime(),o=!1,a=0,s=Object(u.getParameter)("WEBCS_DOMAIN"),c=Object(u.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),d=function(n,r){var a;try{a=n.res.detail[8]}catch(e){l.default.debug("["+t.clientId+"] get vid failed",e)}if(o)h.report.joinChooseServer(t.sid,{lts:i,succ:!0,csAddr:r,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null,vid:a},!1);else{if(clearTimeout(b),o=!0,t.proxyServer)for(var s=n.gateway_addr,c=0;c<s.length;c++){var u=s[c].split(":");n.gateway_addr[c]=t.proxyServer+"/ws/?h="+u[0]+"&p="+u[1]}e(n),h.report.joinChooseServer(t.sid,{lts:i,succ:!0,csAddr:r,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null,vid:a},!0)}},p=function(e,i,o){a++,l.default.error("["+t.clientId+"]",e,i,o),o&&-1===f.JOIN_CS_RETRY_LIST.indexOf(o)&&(r=o),a===s.length+c.length&&n(r)},v=0;v<s.length;++v){var m;if("string"==typeof s[v]){var g=s[v];m=t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1");var y=Object(A.getAreaCodeByWebCS)(g);l.default.debug("["+t.clientId+"] "+"Connect to choose_server: ".concat(m,", ").concat(y)),T(m,t,d,p)}else l.default.error("["+t.clientId+"] Invalid Host",s[v])}var b=setTimeout((function(){if(!o)for(var e=0;e<c.length;++e)if("string"==typeof c[e]){var n=c[e];m=t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(n+"/api/v1"):"https://".concat(n,"/api/v1");var r=Object(A.getAreaCodeByWebCS)(n);l.default.debug("["+t.clientId+"] "+"Connect to backup_choose_server: ".concat(m,", ").concat(r)),T(m,t,d,p)}else l.default.error("["+t.clientId+"] Invalid Host",c[e])}),1e3)}(t,(function(e){r=!0,d=e,clearTimeout(i),E[s]!==b.a.DISCONNECTED&&E[s]!==b.a.DISCONNECTING?c&&c(d,null):l.default.debug("[".concat(t.clientId,"] Request gateway list success when connection state is ").concat(E[s]))}),(function(r){if(r)return l.default.info("["+t.clientId+"] Join failed: "+r),void(n&&n(r));if(E[s]===b.a.DISCONNECTED||E[s]===b.a.DISCONNECTING)return l.default.debug("[".concat(t.clientId,"] Request gateway list falied when connection state is ").concat(E[s])),void(n&&n("OPERATION_ABORT"));l.default.debug("["+t.clientId+"] Request gateway list will be restart in "+o+"s"),i=setTimeout((function(){e(a,c)}),1e3*o),w[s]=i;var d=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");o=o>=d?d:2*o}))}},d=function n(){!function(t,e){p(t,(function(n,r){if(n)return e&&e(n);l.default.debug("["+t.clientId+"] getProxyServerList: ",r),m(t,r,e)}))}(t,(function(r,o){if(r){l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){n()}),1e3*a),w[s]=i;var d=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");a=a>=d?d:2*a}else{clearTimeout(i);var f=o.address;t.proxyServer=f;var p={mode:"manual",url:o.address,tcpport:o.serverResponse.tcpport||"3433",udpport:o.serverResponse.udpport||"3478",username:o.serverResponse.username||"test",credential:o.serverResponse.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};p.tcpport+="",p.udpport+="",t.turnServers=[],t.turnServers.push(p),h.report.setProxyServer(f),l.default.setProxyServer(f),c(f,e)}}))},v=function r(){y("proxy3",t,(function(o,d){if(o)return"RETRYABLE_ERROR"!==o?n&&n(o):(l.default.debug("["+t.clientId+"]",o),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){r()}),1e3*a),w[s]=i,void(a=a>=3600?3600:2*a));clearTimeout(i);var f=Object(u.getParameter)("NGINX");t.proxyServer=f,t.turnServers=[],d.map((function(e){var n={mode:"manual",url:e.ip,tcpport:"",udpport:e.port||"3478",username:e.username||"test",credential:e.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};n.tcpport+="",n.udpport+="",t.turnServers.push(n)})),h.report.setProxyServer(f),l.default.setProxyServer(f),c(f,e)}))};t.useProxyServer?1==t.proxyServerType?d():2==t.proxyServerType?function n(){!function(t,e){p(t,(function(n,r){return n?e&&e(n):(l.default.debug("["+t.clientId+"] getProxyServerList: ",r),e&&e(null,{address:r[0],serverResponse:{tcpport:"443",udpport:"3478",username:"test",password:"111111"}}))}))}(t,(function(r,o){if(r)return l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){n()}),1e3*a),w[s]=i,void(a=a>=3600?3600:2*a);clearTimeout(i);var d=Object(u.getParameter)("PROXY_SERVER_TYPE2");t.proxyServer=d;var f={mode:"manual",url:o.address,tcpport:o.serverResponse.tcpport||"3433",udpport:o.serverResponse.udpport||"3478",username:o.serverResponse.username||"test",credential:o.serverResponse.password||"111111",forceturn:!0};f.tcpport+="",f.udpport+="",t.turnServers=[],t.turnServers.push(f),h.report.setProxyServer(d),l.default.setProxyServer(d),c(d,e)}))}():3==t.proxyServerType?v():4==t.proxyServerType?y("proxy4",t,(function(r,o){if(r)return"RETRYABLE_ERROR"!==r?n&&n(r):(l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){v()}),1e3*a),w[s]=i,void(a=a>=3600?3600:2*a));clearTimeout(i);var d=Object(u.getParameter)("NGINX");t.proxyServer=d,t.turnServers=[],o.map((function(e){var n={mode:"manual",url:e.ip,tcpport:e.port||"443",udpport:"",username:e.username||"test",credential:e.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!1};n.tcpport+="",n.udpport+="",t.turnServers.push(n)})),h.report.setProxyServer(d),l.default.setProxyServer(d),c(d,e)})):5==t.proxyServerType?y("proxy5",t,(function(r,o){if(r)return"RETRYABLE_ERROR"!==r?n&&n(r):(l.default.debug("["+t.clientId+"]",r),l.default.debug("["+t.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){v()}),1e3*a),w[s]=i,void(a=a>=3600?3600:2*a));clearTimeout(i);var d=Object(u.getParameter)("NGINX");t.proxyServer=d,t.turnServers=[],o.map((function(e){var n={mode:"manual",url:e.ip,tcpport:e.port||"443",udpport:"",username:e.username||"test",credential:e.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!1,useTurns:!0};n.tcpport+="",n.udpport+="",t.turnServers.push(n)})),h.report.setProxyServer(d),l.default.setProxyServer(d),c(d,e)}),!0):d():c(null,e)},x=function(t,e,n,r,i){var o=Date.now();r=r||e.stringUid;var a={sid:e.sid,opid:10,appid:e.appId,string_uid:r};return new Promise((function(i,s){Object(d.post)(t+"".concat(-1===t.indexOf("?")?"?":"&","action=stringuid"),a,(function(c){try{var u=JSON.parse(c),d=u.code}catch(i){var p="requestUserAccount failed with unexpected body "+c;return l.default.error("["+e.clientId+"]",p),s({retryable:!0,info:p,url:t,error:"UNEXPECTED_ERROR"}),n&&n.dispatchEvent({type:"error",reason:"USER_ACCOUNT_BODY_NOT_JSON"}),void h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:t,stringUid:r,uid:null,extend:c,errorCode:"USER_ACCOUNT_BODY_NOT_JSON"})}if(d){var v=!1;return"INTERNAL_SERVER_ERROR"===(g=f.StringUidErrorCode[u.code%1e4]||"REQ_ACCOUNT_ERR_".concat(d))&&(v=!0),n&&n.dispatchEvent({type:"error",reason:g}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:g,extend:a}),s({retryable:v,info:p="Get String Uid Failed ["+g+"]",url:t,error:g})}var m=u.uid;if(!(m>0&&m<Math.pow(2,32))){l.default.error("["+e.clientId+"] "+"Invalid Uint Uid ".concat(r," => ").concat(m),u);var g="INVALID_UINT_UID_".concat(m);return n&&n.dispatchEvent({type:"error",reason:g}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:g,extend:a}),s({retryable:!0,error:g,info:"Get String Uid failed ["+g+"]",url:t})}i({uid:m,url:t}),h.report.reqUserAccount(a.sid,{lts:o,success:!0,serverAddress:t,stringUid:r,uid:m,errorCode:null,extend:a})}),(function(t,e){if("timeout"===t.type){var i="USER_ACCOUNT_TIMEOUT";n&&n.dispatchEvent({type:"error",reason:i}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:e,stringUid:r,uid:null,errorCode:i,extend:a}),s({retryable:!0,info:i,url:e,error:i})}else{var c="USER_ACCOUNT_SERVER_WRONG_".concat(t.type);n&&n.dispatchEvent({type:"error",reason:c}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:e,stringUid:r,uid:null,errorCode:c,extend:a}),s({retryable:!0,info:c,url:e,error:c})}}),{"X-Packet-Service-Type":0,"X-Packet-URI":72})}))},R=function(t,e,n){Date.now();var r,o=Object(u.getParameter)("ACCOUNT_REGISTER"),s=!1,d=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),h=null,f=null,p=new Promise(function(){var p=c()(a.a.mark((function c(p,v){var m,g,A;return a.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:h=p,f=v,r=0;case 3:if(!(r<Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){c.next=33;break}if(!s){c.next=6;break}return c.abrupt("return");case 6:return m=o[r%o.length],g=t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1"),c.prev=8,c.delegateYield(a.a.mark((function r(){var i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.proxyServer,r.next=3,x(g,t,e,n);case 3:if(i=r.sent,!s){r.next=6;break}return r.abrupt("return",{v:void 0});case 6:s=!0,setTimeout((function(){l.default.debug("Get UserAccount Successfully",i),h(i)}),0);case 8:case"end":return r.stop()}}),r)}))(),"t0",10);case 10:if(A=c.t0,"object"!==i()(A)){c.next=13;break}return c.abrupt("return",A.v);case 13:c.next=30;break;case 15:if(c.prev=15,c.t1=c.catch(8),!s){c.next=19;break}return c.abrupt("return");case 19:if(!c.t1.retryable){c.next=27;break}return(d=Math.ceil(d*Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(d=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),l.default.error("".concat(c.t1.info," ").concat(c.t1.url," Will Fetch User Account in ").concat(d/1e3," seconds")),c.next=25,new Promise((function(t){setTimeout(t,d)}));case 25:c.next=30;break;case 27:l.default.error("Get UserAccount Error: ".concat(c.t1.info," ").concat(c.t1.url),c.t1.error),s=!0,f(c.t1.error);case 30:r++,c.next=3;break;case 33:case"end":return c.stop()}}),c,null,[[8,15]])})));return function(t,e){return p.apply(this,arguments)}}());return p.cancel=function(){s||(s=!0,f({info:"Request Cancelled",retryable:!1}))},p.isFinished=function(){return s},p}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i,o,a=r(n(0));!function(t){t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL"}(i||(i={})),e.AREAS=i,function(t){t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL"}(o||(o={}));var s={ASIA:{CODE:o.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:o.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:o.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:o.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:o.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:o.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],NGINX:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:o.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],NGINX:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:o.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:o.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:o.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};e.AREA_DOMAIN_MAP=s,s.CHINA={CODE:o.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]},e.getAreaCodeByWebCS=function(t){for(var e=Object.keys(s),n=0;n<e.length;n++){var r=e[n],i=s[r];if(i.WEBCS_DOMAIN.includes(t)||i.WEBCS_DOMAIN_BACKUP_LIST.includes(t))return i.CODE===o.OVERSEA?o.ASIA+","+o.EUROPE+","+o.AFRICA+","+o.NORTH_AMERICA+","+o.SOUTH_AMERICA+","+o.OCEANIA:i.CODE}},e.getAreaCodeByArea=function(t){return t===i.OVERSEA?o.ASIA+","+o.EUROPE+","+o.AFRICA+","+o.NORTH_AMERICA+","+o.SOUTH_AMERICA+","+o.OCEANIA:o[t]},e.getAreaDomainConfig=function(t){var e={WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],NGINX:[]};return t.map((function(t){var n=s[t];if(n){var r=Object.keys(n);r?r.map((function(t){"CODE"!==t&&(e[t]=e[t].concat(n[t]))})):a.default.info(t+" is not exist")}else a.default.info(t+" is not exist")})),e}},function(t,e,n){"use strict";n.d(e,"a",(function(){return x})),n.d(e,"b",(function(){return R}));var r=n(7),i=n.n(r),o=n(4),a=n(8),s=function(t){var e=Object(a.b)(t);return e.url=".",e},c=n(0),u=n(15),l=n(5),d=n(3),h=n(1),f=0,p=function(t){var e=s({});e.id=t.id,e.playerId=f++,e.destroyed=!1,e.fit=t.options&&t.options.fit,"contain"!==e.fit&&"cover"!==e.fit&&(e.fit=null),e.url=t.url,e.stream=t.stream.stream,e.peerVideoReady=!1,e.isFreeze=!1,e.freezeTimeCounterList=[],e.freezeCount=0,e.lastFreezeCount=0,e.lastTimeupdateTime=0,e.elementID=t.elementID,e.setAudioOutput=function(t,n,r){var i=e.video||e.audio;return i?i.setSinkId?void i.setSinkId(t).then((function(){return c.default.debug("["+e.id+"] "+"video ".concat(e.id," setAudioOutput ").concat(t," SUCCESS")),i==e.video&&e.audio?e.audio.setSinkId(t):Promise.resolve()})).then((function(){return c.default.debug("["+e.id+"] "+"audio ".concat(e.id," setAudioOutput ").concat(t," SUCCESS")),n&&n()})).catch((function(t){return c.default.error("["+e.id+"] VideoPlayer.setAudioOutput",t),r&&r(t)})):(c.default.error("["+e.id+"] ",l.default.WEB_API_NOT_SUPPORTED),r&&r(l.default.WEB_API_NOT_SUPPORTED)):(c.default.error("["+e.id+"] ",l.default.PLAYER_NOT_FOUND),r&&r(l.default.PLAYER_NOT_FOUND))},e.destroy=function(){c.default.debug("[".concat(e.id,"] destroy ").concat(t.stream.local?"local":"remote"," Player ").concat(e.id)),Object(u.setSrcObject)(e.video,null),Object(u.setSrcObject)(e.audio,null),e.video.load(),e.audio.load(),e.video.pause(),e.freezeCheckInterval&&clearInterval(e.freezeCheckInterval),e.destroyed=!0,delete e.resizer,document.getElementById(e.div.id)&&e.parentNode.contains(e.div)&&e.parentNode.removeChild(e.div),["video","audio"].forEach((function(n){e[n];var r=a[n];clearTimeout(r.playDeferTimeout),r.formerMediaState=null;var i={playerId:e.playerId,stateId:r.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};a[n]=i;var o={type:"player-status-change",playerId:e.playerId,mediaType:n,status:i.status,reason:i.reason,isErrorState:!1,streamId:e.id};c.default.debug("[".concat(e.id,"] Media Player Status Change Triggered by destroy()"),o),t.stream.dispatchEvent(o),h.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:o,tag:"tracer"})()}))},e.div=document.createElement("div"),e.div.setAttribute("id","player_"+e.id),t.stream.video?e.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):e.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),e.video=document.createElement("video"),e.video.setAttribute("id","video"+e.id),t.stream.local&&!t.stream.screen?t.stream.mirror?e.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(e.fit||"cover",";")):e.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(e.fit||"cover",";")):t.stream.video?e.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(e.fit||"cover",";")):t.stream.screen?e.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(e.fit||"contain")):e.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(e.fit||"cover"));var n={autoplay:!0,muted:!!t.stream.local||!(!o.isSafari()&&"iOS"!==o.getBrowserOS())&&"video_element_muted",playsinline:!0,controls:!1,volume:null},r=i()({},n,t.options);!0!==r.muted||r.volume||(r.volume=0),e.video.setAttribute("autoplay",""),e.video.setAttribute("muted",""),e.video.muted=!0,e.video.autoplay=!0,r.playsinline&&e.video.setAttribute("playsinline",""),r.controls&&e.video.setAttribute("controls",""),r.contains&&(e.video.controls=!0),Number.isFinite(r.volume)&&(e.video.volume=r.volume),e.audio=document.createElement("audio"),e.audio.setAttribute("id","audio"+e.id),!0===r.muted&&e.audio.setAttribute("muted",""),!0===r.muted&&(e.audio.muted=!0),r.playsinline&&e.audio.setAttribute("playsinline",""),Number.isFinite(r.volume)&&(e.audio.volume=r.volume),void 0!==e.elementID?(document.getElementById(e.elementID).appendChild(e.div),e.container=document.getElementById(e.elementID)):(document.body.appendChild(e.div),e.container=document.body),e.parentNode=e.div.parentNode;var a={video:{playerId:e.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:e.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};e.mediaElemExists=function(t){for(var e=t,n=0;n<Object(d.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&e;n++)e=e.parentNode;return!!e};var p=function(t){return e.mediaElemExists(t)?t.paused?"paused":"play":"aborted"},v=function(t,e,n){var r=p(t),i=!0;return"paused"===r?("audio"===e&&!0===n.muted&&(i=!1),n.autoplay||(i=!1)):"play"===r?"video"===e?i=!1:!0===n.muted?t.muted&&(i=!1):t.muted||(i=!1):"aborted"===r&&(i=!1),i},m=function(n){var i,o=this;if(o===e.video?i="video":o===e.audio&&(i="audio"),i){if(n.type||c.default.error("[".concat(e.id,"] Unexpected evt"),n),"video"===i&&o.muted&&o.paused)return c.default.debug("[".concat(e.id,"] auto resume video element")),void o.play();var s=p(o);clearTimeout(a[i].playDeferTimeout),a[i].playDeferTimeout=setTimeout((function(){a[i].playDeferTimeout=null;var u=a[i],l=p(o);if(s===l){var d={playerId:e.playerId,stateId:u.stateId+1,playDeferTimeout:null,error:v(o,i,r),status:p(o),reason:n.type,updatedAt:Date.now()};if(u.status!==d.status){a[i]=d;var f={type:"player-status-change",playerId:e.playerId,mediaType:i,status:d.status,reason:d.reason,isErrorState:d.error,streamId:e.id};c.default.debug("[".concat(e.id,"] Media Player Status Change"),f),t.stream.dispatchEvent(f),h.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:f,tag:"tracer"})()}}else c.default.debug("[".concat(e.id,"] Status Change after event Triggered.")+"Stream ".concat(e.id," PlayerId ").concat(e.playerId," mediaType ").concat(i," Status ").concat(s,"=>").concat(l))}),Object(d.getParameter)("PLAYER_STATE_DEFER"))}else c.default.error("[".concat(e.id,"] Unknown media element"),o)};e.video.addEventListener("playing",(function(t){!function t(){e.video.videoWidth*e.video.videoHeight>4?c.default.debug("["+e.id+"] video dimensions:",e.video.videoWidth,e.video.videoHeight):setTimeout(t,50)}()}));var g=0,A=0,y=0;e.freezeCheckInterval=setInterval((function(){Date.now()-e.lastTimeupdateTime>500&&e.peerVideoReady?(e.isFreeze=!0,e.freezeCount+=1):e.isFreeze=!1}),500),e.video.addEventListener("playing",m),e.video.addEventListener("canplay",m),e.video.addEventListener("abort",m),e.video.addEventListener("onerror",m),e.video.addEventListener("suspend",m),e.video.addEventListener("stalled",m),e.video.addEventListener("pause",m),e.audio.addEventListener("playing",m),e.audio.addEventListener("canplay",m),e.audio.addEventListener("abort",m),e.audio.addEventListener("onerror",m),e.audio.addEventListener("suspend",m),e.audio.addEventListener("stalled",m),e.audio.addEventListener("pause",m);var b=e.audio,w="audio";if(t.stream.hasVideo()||t.stream.hasScreen())e.div.appendChild(e.video),e.div.appendChild(e.audio),o.isEdge()?e.video.srcObject=t.stream.stream:(Object(u.attachMediaStream)(e.video,t.stream.stream),Object(u.attachMediaStream)(e.audio,t.stream.stream)),e.video.addEventListener("timeupdate",(function(){var t=Date.now();if((g+=1)<10)e.lastTimeupdateTime=t;else for(t-e.lastTimeupdateTime>500&&(e.peerVideoReady?A+=t-e.lastTimeupdateTime:e.peerVideoReady=!0),y+=t-e.lastTimeupdateTime,e.lastTimeupdateTime=t;y>=6e3;)y-=6e3,e.freezeTimeCounterList.push(Math.min(6e3,A)),A-=6e3,A=Math.max(A,0)}));else{!1!==r.muted&&"video_element_muted"!==r.muted||(e.video.removeAttribute("muted"),e.video.muted=!1),e.video.removeAttribute("autoplay"),e.video.autoplay=!1,e.div.appendChild(e.video),b=e.video,w="video";var E=a.audio,_={playerId:e.playerId,stateId:E.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"audioonly",updatedAt:Date.now()};a.audio=_;var S={type:"player-status-change",playerId:e.playerId,mediaType:"audio",status:_.status,reason:_.reason,isErrorState:_.error,streamId:e.id};if(c.default.debug("[".concat(e.id,"] Media Player Status Change"),S),Promise.resolve().then((function(){return t.stream.dispatchEvent(S)})),h.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:S,tag:"tracer"})(),window.MediaStream&&(o.isSafari()||"iOS"===o.getBrowserOS())){var T=new MediaStream(t.stream.stream.getAudioTracks());Object(u.setSrcObject)(e.video,T)}else Object(u.setSrcObject)(e.video,t.stream.stream)}if(r.autoplay&&b){var C=b.play();C&&C.catch&&C.catch((function(n){if(!e.destroyed&&b){var i=a[w],o={playerId:e.playerId,stateId:i.stateId+1,playDeferTimeout:null,error:v(b,w,r),status:p(b),reason:"error",updatedAt:Date.now()};if(i.status!==o.status){c.default.debug("[".concat(e.id,"] Player ").concat(e.playerId," Status Changed Detected by promise error: ").concat(i.status,"=>").concat(o.status),n),a[w]=o;var s={type:"player-status-change",playerId:e.playerId,mediaType:w,status:o.status,reason:o.reason,isErrorState:o.error,streamId:e.id};c.default.debug("[".concat(e.id,"] Media Player Status Change"),s),t.stream.dispatchEvent(s),h.report.reportApiInvoke(t.stream.sid,{name:"Stream.playerStatusChange",options:s,tag:"tracer"})()}}}))}return e.setAudioVolume=function(t){var n=parseInt(t)/100;isFinite(n)&&(n<0?n=0:n>1&&(n=1),e.video&&(e.video.volume=n),e.audio&&(e.audio.volume=n))},e},v=n(23),m=n(10),g=n(6),A=n(19),y=n(2),b=n(25),w=n(16),E=n(11),_=n.n(E),S=function(t){Object(y.checkValidString)(t,"profileName"),-1===(t=t.toLowerCase()).indexOf("_")&&(t+="_1"),Object(y.checkValidEnum)(t,"profileName",Object.keys(d.SUPPORT_RESOLUTION_LIST));var e=d.SUPPORT_RESOLUTION_LIST[t];e||(t=Object(d.getParameter)("DEFAULT_PROFILE"),e=d.SUPPORT_RESOLUTION_LIST[t]);var n={profileName:t,video:{width:e[0],height:e[1]},attributes:{resolution:"".concat(e[0],"x").concat(e[1]),minFrameRate:e[2],maxFrameRate:e[3],minVideoBW:e[4],maxVideoBW:e[5]}};return e[2]&&(n.video.frameRate=e[2]),e[6]&&e[7]&&(n.screen={width:e[0],height:e[1],frameRate:{min:e[6],max:e[7]}}),n},T=function(t){return Object.keys(d.SUPPORT_RESOLUTION_LIST).filter((function(e){var n=d.SUPPORT_RESOLUTION_LIST[e],r=["width","height","frameRate"];for(var i in r){var o=r[i];if(t[o]&&n[i]){if("number"==typeof t[o].max&&t[o].max<n[i])return!1;if("number"==typeof t[o].min&&t[o].min>n[i])return!1}}return!0})).reverse()},C=function(t){var e=d.AUDIO_PROFILE_SETTINGS[t]||d.AUDIO_PROFILE_SETTINGS.default;return{highQuality:e[0],stereo:e[1],speech:e[2],lowQuality:e[3]}},x=function(t){var e=Object(a.b)();if(e.params=i()({},t),e.stream=t.stream,e.url=t.url,e.onClose=void 0,e.local=!1,e.videoSource=t.videoSource,e.audioSource=t.audioSource,t.video=!(!t.videoSource&&!t.video),e.video=t.video,t.audio=!(!t.audioSource&&!t.audio),e.audio=t.audio,e.screen=!!t.screen,e.screenAudio=!!t.screenAudio,e.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},e.videoSize=t.videoSize,e.player=void 0,e.audioLevelHelper=null,t.attributes=t.attributes||{},e.attributes=t.attributes,e.microphoneId=t.microphoneId,e.cameraId=t.cameraId,e.facingMode=t.facingMode,e.inSwitchDevice=!1,e.userMuteVideo=!1,e.userMuteAudio=!1,e.peerMuteVideo=!1,e.peerMuteAudio=!1,e.lowStream=null,e.videoWidth=0,e.videoHeight=0,e.streamId=t.streamID,e.userId=null,e.uintId=t.uintUID||null,e.mirror=!1!==t.mirror,e.DTX=t.audioProcessing&&t.audioProcessing.DTX,e.audioProcessing=t.audioProcessing,e.optimizationMode=t.optimizationMode,e.highQuality=!1,e.stereo=!1,e.speech=!1,e.screen||delete e.screen,!(void 0===e.videoSize||e.videoSize instanceof Array&&4===e.videoSize.length))throw Error("Invalid Video Size");function n(){var t={};e.getVideoTrack()===this?(c.default.debug("Video Track Ended"),t.type="videoTrackEnded",t.track=this):e.getAudioTrack()===this?(c.default.debug("Audio Track Ended"),t.type="audioTrackEnded",t.track=this):c.default.debug("Detached Track ended",this.kind,this.label,this),t.type&&e.dispatchEvent(t)}return e.videoSize=[640,480,640,480],void 0!==t.local&&!0!==t.local||(e.local=!0),e.initialized=!e.local,e._streamInitID=null,function(t){t.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},t._initSoundIfNotExists=function(e,n){t.audioMixing.sounds[e]||(t.audioMixing.sounds[e]={soundId:e,state:"IDLE",muted:t.userMuteAudio,filePath:n,volume:t.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},t._initSoundIfNotExists(-1),t.loadAudioBuffer=function(e,n,r){var i=h.report.reportApiInvoke(t.sid,{callback:r,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Object(y.checkValidString)(n,"url",1,1024,!1),Object(y.checkValidString)(e,"id",1,1024,!1);var o=function(e){c.default.error("[".concat(t.streamId,"] loadAudioBuffer Failed: ")+e),i(l.default.LOAD_AUDIO_FAILED)},a=new XMLHttpRequest;a.open("GET",n,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status>400)o("".concat(a.status," ").concat(a.statusText));else{var n=a.response;t.audioMixing.audioContextInited||t._initAudioContext(),t.audioMixing.ctx.decodeAudioData(n,(function(n){t.audioMixing.buffer[e]=n,i(null)}),(function(e){c.default.error("[".concat(t.streamId,"] decodeAudioData Failed: "),e),i(e)}))}},a.onerror=function(){return o("load error")},a.ontimeout=function(){return o("timeout")},a.send()},t.createAudioBufferSource=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(t.audioMixing.buffer[e.id]){var r=t.audioMixing.buffer[e.id],i=t.audioMixing.ctx.createBufferSource();i.buffer=r;var a=t.audioMixing.ctx.createGain();if(i.connect(a),a.connect(t.audioMixing.mediaStreamDest),i.gainNode=a,e.loop)i.loop=!0,i.start(0,e.playTime/1e3);else if(e.cycle>1)if(Object(o.isChrome)()){i.loop=!0;var s=e.cycle*r.duration*1e3-(e.playTime||0);i.start(0,e.playTime/1e3,s/1e3)}else c.default.warning("[".concat(t.streamId,"] Cycle Param is ignored by current browser")),i.start(0,e.playTime/1e3);else i.start(0,e.playTime/1e3);var u=t.audioMixing.sounds[e.soundId];return u.source=i,t._flushAudioMixingMuteStatus(),i.addEventListener("ended",(function(){i===u.source&&t.dispatchEvent({type:"audioSourceEnded",soundId:e.soundId,source:i,sound:u})})),n(),i}var l="AUDIOBUFFER_NOT_FOUND";return c.default.error("[".concat(t.streamId,"] "),l,e.id),n(!1),!1},t.on("audioSourceEnded",(function(e){var n=e.source,r=e.sound;r&&r.state===t.audioMixing.states.BUSY&&!r.pauseAt&&(r.state=t.audioMixing.states.IDLE,r.startAt=null,r.startOffset=null,r.resumeAt=null,r.resumeOffset=null,n.gainNode&&n.gainNode.disconnect&&n.gainNode.disconnect(),n.buffer=null,t.audioMixing.mediaStreamSource.connect(t.audioMixing.mediaStreamDest))})),t.clearAudioBufferSource=function(){t.audioBufferSource.forEach((function(t){t.stop()}))},t._isSoundExists=function(e){return!!t.audioMixing.sounds[e.soundId]||(c.default.error("SoundId not exists. #".concat(e.soundId)),!1)},t._initAudioContext=function(){if(t.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!t.stream)throw new Error("Failed to init audio context. Local Stream not initialized");t.audioMixing.ctx=Object(b.a)(),t.audioMixing.mediaStreamSource=t.audioMixing.ctx.createMediaStreamSource(t.stream),t.audioMixing.mediaStreamDest=t.audioMixing.ctx.createMediaStreamDestination(),t.audioMixing.mediaStreamSource.connect(t.audioMixing.mediaStreamDest);var e=t.stream.getVideoTracks()[0];if(e&&t.audioMixing.mediaStreamDest.stream.addTrack(e),t._originStream=t.stream,t._isAudioMuted()?(t._unmuteAudio(),t.stream=t.audioMixing.mediaStreamDest.stream,t._muteAudio()):t.stream=t.audioMixing.mediaStreamDest.stream,t.audioLevelHelper=null,t.pc&&t.pc.peerConnection&&t.pc.peerConnection){var n=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find((function(t){return t&&t.track&&"audio"==t.track.kind})),r=t.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];n&&n.replaceTrack&&r&&n.replaceTrack(r)}t.audioMixing.audioContextInited=!0},t._cleanupAudioMixing=function(){if(t.audioMixing.audioContextInited){for(var e in t.audioMixing.sounds){var n=t.audioMixing.sounds[e];n.state!==t.audioMixing.states.BUSY&&n.state!==t.audioMixing.states.PAUSED||t._stopOneEffect({soundId:e})}t.audioLevelHelper=null,t.audioMixing.audioContextInited=!1}},t._reloadInEarMonitoringMode=function(e){if(e){if(!t.audioMixing.inEarMonitoringModes[e])return c.default.error("[".concat(t.streamId,"] Invalid InEarMonitoringMode ").concat(e));t.audioMixing.inEarMonitoring=e}switch(t.audioMixing.audioContextInited||t._initAudioContext(),t.audioMixing.inEarMonitoring){case t.audioMixing.inEarMonitoringModes.FILE:t.audioMixing.mediaStreamSource.connectedToDestination&&(t.audioMixing.mediaStreamSource.disconnect(t.audioMixing.ctx.destination),t.audioMixing.mediaStreamSource.connectedToDestination=!1);case t.audioMixing.inEarMonitoringModes.ALL:for(var n in t.audioMixing.sounds){var r=t.audioMixing.sounds[n];r&&r.source&&!r.source.connectedToDestination&&(r.source.gainNode.connect(t.audioMixing.ctx.destination),r.source.connectedToDestination=!0)}}switch(t.audioMixing.inEarMonitoring){case t.audioMixing.inEarMonitoringModes.MICROPHONE:t.audioMixing.source.forEach((function(e){e.connectedToDestination&&(e.gainNode.disconnect(t.audioMixing.ctx.destination),e.connectedToDestination=!1)}));case t.audioMixing.inEarMonitoringModes.ALL:t.audioMixing.mediaStreamSource.connectedToDestination||(t.audioMixing.mediaStreamSource.connect(t.audioMixing.ctx.destination),t.audioMixing.mediaStreamSource.connectedToDestination=!0)}},t._startAudioMixingBufferSource=function(e){t.audioMixing.audioContextInited||t._initAudioContext();var n={soundId:e.soundId,id:e.filePath,loop:e.loop,cycle:e.cycle,playTime:e.playTime||0},r=e.replace,i=t.createAudioBufferSource(n);return i.sound=t.audioMixing.sounds[e.soundId],i?(i.addEventListener("ended",t._audioMixingFinishedListener,{once:!0}),t._reloadInEarMonitoringMode(),r&&t.audioMixing.mediaStreamSource.disconnect(t.audioMixing.mediaStreamDest),i):null},t._stopAudioMixingBufferSource=function(e){var n=t.audioMixing.sounds[e.soundId].source;return n?(n.removeEventListener("ended",t._audioMixingFinishedListener),t.audioMixing.mediaStreamSource.connect(t.audioMixing.mediaStreamDest),n.stop(),n.gainNode&&n.gainNode.disconnect&&n.gainNode.disconnect(),n.buffer=null,n):null},t._flushAudioMixingMuteStatus=function(e){for(var n in t.audioMixing.sounds){var r=t.audioMixing.sounds[n];r&&(void 0!==e&&(r.muted=!!e),r.source&&(r.muted?r.source.gainNode.gain.value=0:r.source.gainNode.gain.value=r.volume/100))}},t._handleAudioMixingInvalidStateError=function(e,n,r){var i=t.audioMixing.sounds[n.soundId],o=-1===n.soundId?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";c.default.error("[".concat(t.streamId,"] Cannot ").concat(e,": ").concat(o,", state is ").concat(i.state)),r&&r(o)},t._handleAudioMixingNoSourceError=function(e,n,r){t.audioMixing.sounds[n.soundId].state=t.audioMixing.states.IDLE;var i=-1===n.soundId?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";c.default.error("[".concat(t.streamId,"] Cannot ").concat(e,": ").concat(i)),r&&r(i)},t._getOneEffectStates=function(e){var n=t.audioMixing.sounds[e.soundId];return function(){return n?{state:n.state,startAt:n.startAt,resumeAt:n.resumeAt,pauseOffset:n.pauseOffset,pauseAt:n.pauseAt,resumeOffset:n.resumeOffset,stopAt:n.stopAt,duration:t._getOneEffectDuration(e),position:t._getOneEffectCurrentPosition(e)}:{}}},t._audioMixingFinishedListener=function(){var e=this.sound;e.state===t.audioMixing.states.IDLE&&t.audioMixing.buffer[e.options.filePath]&&!e.options.cacheResource&&(c.default.debug("Recycled buffer ".concat(e.options.filePath)),delete t.audioMixing.buffer[e.options.filePath]),-1===e.soundId&&t.dispatchEvent({type:"audioMixingFinished"})},t._playOneEffect=function(e,n){Object(y.checkValidObject)(e,"options");var r=e.soundId,i=(e.filePath,e.cacheResource);if(e.cycle,e.loop,e.playTime,e.replace,Object(o.isSafari)()&&Object(o.getBrowserVersion)()<12){var a="BROWSER_NOT_SUPPORT";return c.default.error("[".concat(t.streamId,"] Cannot _playOneEffect: "),a),n(a)}t.audioMixing.audioContextInited||t._initAudioContext(),t._initSoundIfNotExists(r);var s=t.audioMixing.sounds[r];if(s.state===t.audioMixing.states.IDLE){if(void 0!==e.cycle&&!e.cycle>0)return a="Invalid Parmeter cycle: "+e.cycle,c.default.error("[".concat(t.streamId,"] ").concat(r),a),n(a);if(Object(y.isEmpty)(i)&&(e.cacheResource=!0),s.state=t.audioMixing.states.STARTING,s.options=e,t.audioMixing.buffer[e.filePath]){var u=t._startAudioMixingBufferSource(e);if(u)return s.source=u,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=e.playTime||0,s.state=t.audioMixing.states.BUSY,t._flushAudioMixingMuteStatus(),n(null);s.state=t.audioMixing.states.IDLE;var l="CREATE_BUFFERSOURCE_FAILED";if(n)return n(l);c.default.error("[".concat(t.streamId,"] "),l)}else t.loadAudioBuffer(e.filePath,e.filePath,(function(r){if(r)s.state=t.audioMixing.states.IDLE,n?n(r):c.default.error("[".concat(t.streamId,"] "),r);else{var i=t._startAudioMixingBufferSource(e);if(i)return s.source=i,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=e.playTime||0,s.state=t.audioMixing.states.BUSY,t._flushAudioMixingMuteStatus(),n(null);if(s.state=t.audioMixing.states.IDLE,r="CREATE_BUFFERSOURCE_FAILED",n)return n(r);c.default.error("[".concat(t.streamId,"] "),r)}}))}else t._handleAudioMixingInvalidStateError("_playEffect",e,n)},t._stopOneEffect=function(e,n){var r=t.audioMixing.sounds[e.soundId];return t._isSoundExists(e)?r.state===t.audioMixing.states.BUSY||r.state===t.audioMixing.states.PAUSED?(t._stopAudioMixingBufferSource(e),r.stopAt=Date.now(),r.state=t.audioMixing.states.IDLE,t.audioMixing.buffer[r.options.filePath]&&!r.options.cacheResource&&(c.default.debug("Recycled buffer ".concat(r.options.filePath)),delete t.audioMixing.buffer[r.options.filePath]),void(n&&n(null))):void t._handleAudioMixingInvalidStateError("_stopOneEffect",e,n):n("SOUND_NOT_EXISTS")},t._pauseOneEffect=function(e,n){var r=t.audioMixing.sounds[e.soundId];if(r.state===t.audioMixing.states.BUSY)return t._stopAudioMixingBufferSource(e)?(r.pauseAt=Date.now(),r.state=t.audioMixing.states.PAUSED,r.resumeAt?r.pauseOffset=r.pauseAt-r.resumeAt+r.resumeOffset:r.pauseOffset=r.pauseAt-r.startAt+r.startOffset,n&&n(null)):void t._handleAudioMixingNoSourceError("_pauseOneEffect",e,n);t._handleAudioMixingInvalidStateError("_pauseOneEffect",e,n)},t._resumeOneEffect=function(e,n){var r=t.audioMixing.sounds[e.soundId];if(r.state===t.audioMixing.states.PAUSED){var i={soundId:e.soundId,filePath:r.options.filePath,cycle:r.options.cycle,loop:r.options.loop,playTime:r.pauseOffset,replace:r.options.replace},o=t._startAudioMixingBufferSource(i);if(!o){var a="CREATE_BUFFERSOURCE_FAILED";return n(a),void c.default.error("[".concat(t.streamId,"] "),a)}r.source=o,r.resumeAt=Date.now(),r.resumeOffset=r.pauseOffset,r.state=t.audioMixing.states.BUSY,r.pauseAt=null,r.pauseOffset=null,n(null)}else t._handleAudioMixingInvalidStateError("_resumeOneEffect",e,n)},t._getOneEffectDuration=function(e){var n=t.audioMixing.sounds[e.soundId];return n.options&&n.options.filePath&&t.audioMixing.buffer[n.options.filePath]?1e3*t.audioMixing.buffer[n.options.filePath].duration:null},t._getOneEffectCurrentPosition=function(e,n){var r=t.audioMixing.sounds[e.soundId];return r.state===t.audioMixing.states.PAUSED?r.pauseOffset%t._getOneEffectDuration(e):r.state===t.audioMixing.states.BUSY?r.resumeAt?(Date.now()-r.resumeAt+r.resumeOffset)%t._getOneEffectDuration(e):(Date.now()-r.startAt+r.startOffset)%t._getOneEffectDuration(e):void(n&&t._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",e))},t._setOneEffectPosition=function(e,n,r){var i=t.audioMixing.sounds[e.soundId];if(i.state===t.audioMixing.states.BUSY){if(!t._stopAudioMixingBufferSource(e))return void t._handleAudioMixingNoSourceError("_setOneEffectPosition",e,r);var o={soundId:e.soundId,filePath:i.options.filePath,loop:i.options.loop,cycle:i.options.cycle,playTime:n},a=t._startAudioMixingBufferSource(o);if(!a){var s="CREATE_BUFFERSOURCE_FAILED";return r&&r(s),void c.default.error("[".concat(t.streamId,"] "),s)}i.source=a,i.startAt=Date.now(),i.startOffset=n,i.resumeAt=null,i.resumeOffset=null,i.pauseOffset=null,i.pauseAt=null}else{if(i.state!==t.audioMixing.states.PAUSED)return void t._handleAudioMixingInvalidStateError("_setOneEffectPosition",e,r);i.pauseOffset=n}r&&r(null)},t.startAudioMixing=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:function(e){if(e)return n&&n(e);t.dispatchEvent({type:"audioMixingPlayed"}),n&&n(null)},getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:e});Object(y.checkValidObject)(e,"options");var o=e.filePath,a=e.cacheResource,s=e.cycle,c=e.loop,u=e.playTime,l=e.replace;Object(y.checkValidString)(o,"filePath",1,Object(d.getParameter)("FILEPATH_LENMAX"),!1),Object(y.checkValidNumber)(u,"playTime",0,1e8),!Object(y.isEmpty)(s)&&Object(y.checkValidNumber)(s,"cycle"),!Object(y.isEmpty)(c)&&Object(y.checkValidBoolean)(c,"loop"),!Object(y.isEmpty)(l)&&Object(y.checkValidBoolean)(l,"replace"),!Object(y.isEmpty)(a)&&Object(y.checkValidBoolean)(a,"cacheResource");var f=i()({soundId:-1},e);t._playOneEffect(f,r)},t.stopAudioMixing=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:e,getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});t._stopOneEffect({soundId:-1},n)},t.pauseAudioMixing=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:e,getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return t._pauseOneEffect({soundId:-1},n)},t.resumeAudioMixing=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:function(n,r){if(n)return e&&e(n);t.dispatchEvent({type:"audioMixingPlayed"}),e&&e(null)},getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});t._resumeOneEffect({soundId:-1},n)},t.adjustAudioMixingVolume=function(e){var n=h.report.reportApiInvoke(t.sid,{getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});Object(y.checkValidNumber)(e,"volume",0,100),t.audioMixing.sounds[-1].volume=e,t._flushAudioMixingMuteStatus(),n()},t.getAudioMixingDuration=function(){var e=h.report.reportApiInvoke(t.sid,{getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),n=t._getOneEffectDuration({soundId:-1});return e(null,n),n},t.getAudioMixingCurrentPosition=function(){var e=h.report.reportApiInvoke(t.sid,{getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),n=t._getOneEffectCurrentPosition({soundId:-1},!0);return e(null,n),n},t.setAudioMixingPosition=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:n,options:arguments,tag:"tracer",getStates:t._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});Object(y.checkValidNumber)(e,"position",0,1e8),t._setOneEffectPosition({soundId:-1},e,r)},t.playEffect=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:function(e){if(e)return n&&n(e);t.dispatchEvent({type:"effectPlayed"}),n&&n(null)},name:"Stream.playEffect",options:e});Object(y.checkValidObject)(e,"options");var i=e.soundId,o=e.filePath,a=e.cycle;Object(y.checkValidNumber)(i,"soundId",1,1e4),Object(y.checkValidString)(o,"filePath",0,Object(d.getParameter)("FILEPATH_LENMAX"),!1),!Object(y.isEmpty)(a)&&Object(y.checkValidNumber)(a,"cycle"),t._playOneEffect(e,r)},t.stopEffect=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:n,getStates:t._getOneEffectStates({soundId:e}),name:"Stream.stopEffect"});Object(y.checkValidNumber)(e,"soundId",1,1e4),t._stopOneEffect({soundId:e},r)},t.stopAllEffects=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:e,name:"Stream.stopAllEffect"}),r=!1,i=0,o=0,a=function(t){r||(t?(n(t),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in t.audioMixing.sounds){var c=t.audioMixing.sounds[s];-1!==c.soundId&&(c.state!==t.audioMixing.states.BUSY&&c.state!==t.audioMixing.states.PAUSED||(o++,t._stopOneEffect({soundId:s},a)))}o||n(null)},t.preloadEffect=function(e,n,r){var i=h.report.reportApiInvoke(t.sid,{callback:r,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});Object(y.checkValidNumber)(e,"soundId",1,1e4),Object(y.checkValidString)(n,"filePath",1,Object(d.getParameter)("FILEPATH_LENMAX"),!1),t._initSoundIfNotExists(e,n),t.audioMixing.buffer[n]?i(null):t.loadAudioBuffer(n,n,i)},t.unloadEffect=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});Object(y.checkValidNumber)(e,"soundId",1,1e4);var i=t.audioMixing.sounds[e];if(!i){var o="SOUND_NOT_EXISTS";return c.default.error(o,e),void r(o)}var a=i.options?i.options.filePath:i.filePath;if(a)delete t.audioMixing.buffer[a],delete t.audioMixing.sounds[e],r(null);else{var s="SOUND_BUFFER_NOT_FOUND";c.default.error(s,e),r(s)}},t.pauseEffect=function(e,n){var r=h.report.reportApiInvoke(t.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return t._pauseOneEffect({soundId:e},r)},t.pauseAllEffects=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:e,name:"Stream.pauseAllEffects"}),r=!1,i=0,o=0,a=function(t){r||(t?(n(t),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in t.audioMixing.sounds)"-1"!==s&&t.audioMixing.sounds[s].state===t.audioMixing.states.BUSY&&(o++,t._pauseOneEffect({soundId:s},a));o||n(null)},t.resumeEffect=function(e,n){Object(y.checkValidNumber)(e,"soundId",1,1e4);var r=h.report.reportApiInvoke(t.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return t._resumeOneEffect({soundId:e},r)},t.resumeAllEffects=function(e){var n=h.report.reportApiInvoke(t.sid,{callback:e,name:"Stream.resumeAllEffects"}),r=!1,i=0,o=0,a=function(t){r||(t?(n(t),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in t.audioMixing.sounds)"-1"!==s&&t.audioMixing.sounds[s].state===t.audioMixing.states.PAUSED&&(o++,t._resumeOneEffect({soundId:s},a));o||n(null)},t.getEffectsVolume=function(){var e=[];for(var n in t.audioMixing.sounds){var r=t.audioMixing.sounds[n];r&&"-1"!==n&&e.push({soundId:parseInt(n),volume:r.volume})}return e},t.setEffectsVolume=function(e,n){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:n});for(var i in Object(y.checkValidNumber)(e,"volume",0,100),t.audioMixing.defaultVolume=e,t.audioMixing.sounds){var o=t.audioMixing.sounds[i];"-1"!==i&&(o.volume=e)}t._flushAudioMixingMuteStatus(),r(null)},t.setVolumeOfEffect=function(e,n,r){var i=h.report.reportApiInvoke(t.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:r});Object(y.checkValidNumber)(e,"soundId",0,1e4),Object(y.checkValidNumber)(n,"volume",0,100),t._initSoundIfNotExists(e);var o=t.audioMixing.sounds[e];o.volume=n,t._flushAudioMixingMuteStatus(),i(null)}}(e),w.a.addVideoEffectCapability(e),function(t,e){t.videoConstraint={},e.cameraId&&(t.videoConstraint.deviceId={exact:e.cameraId}),e.facingMode&&(t.videoConstraint.facingMode=e.facingMode),t.videoSize&&(t.videoConstraint.width=t.videoSize[0],t.videoConstraint.height=t.videoSize[1]),Object(o.isLegacyChrome)()||(t.videoConstraint.frameRate=30),t.audioConstraint={},e.microphoneId&&(t.audioConstraint.deviceId={exact:e.microphoneId}),Object(o.isLegacyChrome)()||t.audioProcessing&&(void 0!==t.audioProcessing.AGC&&(Object(o.isFireFox)()?t.audioConstraint.autoGainControl=t.audioProcessing.AGC:Object(o.isChrome)()&&(t.audioConstraint.googAutoGainControl=t.audioProcessing.AGC,t.audioConstraint.googAutoGainControl2=t.audioProcessing.AGC)),void 0!==t.audioProcessing.AEC&&(t.audioConstraint.echoCancellation=t.audioProcessing.AEC),void 0!==t.audioProcessing.ANS&&(Object(o.isFireFox)()?t.audioConstraint.noiseSuppression=t.audioProcessing.ANS:Object(o.isChrome)()&&(t.audioConstraint.googNoiseSuppression=t.audioProcessing.ANS))),t.screenConstraint={},e.sourceId&&(t.screenConstraint.sourceId=e.sourceId),e.extensionId&&Object(o.isChrome)()?(t.screenConstraint.extensionId=e.extensionId,t.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:t.screenAttributes.width,maxHeight:t.screenAttributes.height,maxFrameRate:t.screenAttributes.maxFr,minFrameRate:t.screenAttributes.minFr}):(t.screenConstraint.mediaSource="screen",t.screenConstraint.width=t.screenAttributes.width,t.screenConstraint.height=t.screenAttributes.height,t.screenConstraint.frameRate={ideal:t.screenAttributes.maxFr,max:t.screenAttributes.maxFr}),e.mediaSource&&(t.screenConstraint.mediaSource=e.mediaSource),t.setVideoResolution=function(n){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(n instanceof Array)){var o=S(n+="");return o&&o.video?(t.videoConstraint=i()(t.videoConstraint,{width:{ideal:o.video.width},height:{ideal:o.video.height}}),e.attributes.resolution=o.attributes.resolution,(a=t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0])&&a.applyConstraints?(c.default.debug("setVideoResolution applyConstraints",t.videoConstraint),a.applyConstraints(t.videoConstraint).then(r).catch(r)):r(),!0):(r("NO_PROFILE_".concat(n)),!1)}var a,s=n[0],u=n[1];t.videoConstraint=i()(t.videoConstraint,{width:{ideal:s},height:{ideal:u}}),e.attributes.resolution="".concat(s,"x").concat(u),(a=t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0])&&a.applyConstraints?(c.default.debug("setVideoResolution applyConstraints",t.videoConstraint),w.a.disableVideoEffect(t).then((function(){return a.applyConstraints(t.videoConstraint).then(r).catch(r)})).then((function(){return w.a.restoreVideoEffect(t)}))):r()},t.setVideoFrameRate=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(o.isFireFox)())return n("FIREFOX_NOT_SUPPORTED"),!1;if("object"===_()(e)&&e instanceof Array&&e.length>1){t.videoConstraint=i()(t.videoConstraint,{frameRate:e[0]}),t.attributes.minFrameRate=e[0],t.attributes.maxFrameRate=e[1];var r=t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0];return r&&r.applyConstraints?(c.default.debug("setVideoFrameRate applyConstraints",t.videoConstraint),r.applyConstraints(t.videoConstraint).then(n).catch(n)):n(),!0}return n("INVALID_PARAM_".concat(JSON.stringify(e))),!1},t.setVideoBitRate=function(n){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return"object"===_()(n)&&n instanceof Array&&n.length>1?(e.attributes.minVideoBW=n[0],e.attributes.maxVideoBW=n[1],t.connectionSpec&&(t.connectionSpec.minVideoBW=n[0],t.connectionSpec.maxVideoBW=n[1]),t.pc&&t.pc.renegotiate&&t.pc.renegotiate(),r(),!0):(r("INVALID_PARAM_".concat(JSON.stringify(n))),!1)},t.setScreenBitRate=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return"object"===_()(e)&&e instanceof Array&&e.length>1?(t.screenAttributes.minVideoBW=e[0],t.screenAttributes.maxVideoBW=e[1],n(),!0):(n("INVALID_PARAM_".concat(JSON.stringify(e))),!1)},t.setScreenProfile=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Object(y.checkValidEnum)(e,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var r=S(e);return r&&r.screen?(t.screenConstraint.mandatory?(t.screenConstraint.mandatory.maxWidth=r.screen.width,t.screenConstraint.mandatory.maxHeight=r.screen.height,r.screen.frameRate&&r.screen.frameRate.min&&r.screen.frameRate.max&&(t.screenConstraint.mandatory.minFrameRate=r.screen.frameRate.min,t.screenConstraint.mandatory.maxFrameRate=r.screen.frameRate.max)):t.screenConstraint=i()(t.screenConstraint,r.screen),t.screenAttributes.width=r.screen.width,t.screenAttributes.height=r.screen.height,t.screenAttributes.minFr=r.screen.frameRate.min,t.screenAttributes.maxFr=r.screen.frameRate.max,n(),!0):(n("NO_SCREEN_PROFILE_".concat(JSON.stringify(e))),!1)},t.setVideoProfileCustom=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});t.setVideoResolution(e[0]),t.setVideoFrameRate([e[1],e[1]]),t.setVideoBitRate([e[2],e[2]]),n()},t.setVideoProfileCustomPlus=function(n){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});t.setVideoResolution([n.width,n.height]),e.attributes.resolution="".concat(n.width,"x").concat(n.height),t.setVideoFrameRate([n.framerate,n.framerate]),t.setVideoBitRate([n.bitrate,n.bitrate]),r()},t.setVideoProfile=function(n){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),a=S(n);if(!a){var s="Invalid Profile ".concat(n);throw new Error(s)}if(t.profile=n,a&&a.video){t.profile=a.profileName,t.videoConstraint=i()(t.videoConstraint,a.video),t.connectionSpec&&a.attributes.maxVideoBW&&(t.connectionSpec.minVideoBW=a.attributes.minVideoBW,t.connectionSpec.maxVideoBW=a.attributes.maxVideoBW),Object(o.isEdge)()&&(t.videoConstraint.frameRate.max=60),Object(o.isFireFox)()&&(t.videoConstraint.frameRate=30),e.attributes=i()(e.attributes,a.attributes),t.pc&&t.pc.renegotiate&&t.pc.renegotiate();var u=t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0];return u&&u.applyConstraints?(c.default.debug("setVideoProfile applyConstraints",t.videoConstraint),w.a.disableVideoEffect(t).then((function(){return u.applyConstraints(t.videoConstraint)})).then((function(){return w.a.restoreVideoEffect(t)})).then((function(e){return new Promise((function(n,i){r(e),setTimeout((function(){Object(m.vsResHack)(t.stream,(function(e,r){t.videoWidth=e,t.videoHeight=r,n()}),(function(e){c.default.warning("[".concat(t.streamId,"] vsResHack failed: "),e),i()}))}),2500)}))})).catch(r)):r(),!0}return r("INVALID_VIDEO_PROFILE_".concat(n)),!1},t.setAudioProfile=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Object(y.checkValidEnum)(e,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),t.audioProfile=e;var r=C(e);return t.highQuality=r.highQuality,t.stereo=r.stereo,t.speech=r.speech,t.lowQuality=r.lowQuality,t.stereo&&Object(o.isChrome)()&&(t.audioConstraint.googAutoGainControl=!1,t.audioConstraint.googAutoGainControl2=!1,t.audioConstraint.echoCancellation=!1,t.audioConstraint.googNoiseSuppression=!1),n(),!0},t.setVideoEncoderConfiguration=function(e){Object(y.checkValidObject)(e,"config");var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setVideoEncoderConfiguration",options:e,tag:"tracer"});e.resolution&&(Object(y.checkValidNumber)(e.resolution.width,"config.resolution.width"),Object(y.checkValidNumber)(e.resolution.height,"config.resolution.height"),t.setVideoResolution([e.resolution.width,e.resolution.height])),e.frameRate&&(Object(y.checkValidNumber)(e.frameRate.min,"config.frameRate.min"),Object(y.checkValidNumber)(e.frameRate.max,"config.frameRate.max"),t.setVideoFrameRate([e.frameRate.min,e.frameRate.max])),e.bitrate&&(Object(y.checkValidNumber)(e.bitrate.min,"config.bitrate.min",1,1e7),Object(y.checkValidNumber)(e.bitrate.max,"config.bitrate.max",1,1e7),t.setVideoBitRate([e.bitrate.min,e.bitrate.max])),n()},t.getSupportedProfile=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:e});if(!t.local){var r="ONLY_LOCAL_STREAM_SUPPORTED";return c.default.error(r),n(r)}if(!t.stream)return r="STREAM_NOT_INIT",c.default.error(r),n(r);if(!t.stream.getVideoTracks)return r="TRACK_NOT_SUPPORT",c.default.error(r),n(r);var i=t.stream.getVideoTracks()[0];if(!i)return r="NO_VIDEO_TRACK_FOUND",c.default.error(r),n(r);if(!i.getCapabilities)return r="GETCAPABILITY_NOT_SUPPORT",c.default.error(r),n(r);var o=i.getCapabilities(),a=T(o);return n(null,a)}}(e,t),e.getId=function(){return e.streamId},e.getUserId=function(){return e.userId},e.checkDualStreamEnabled=function(){return!(!Object(d.getParameter)("DUALSTREAM_OPERATION_CHECK")||!e.isDualStream)&&(c.default.error("Operation not permitted: ".concat("DUAL_STREAM_ENABLED")),"DUAL_STREAM_ENABLED")},e.setUserId=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});e.userId&&c.default.warning("[".concat(e.streamId,"] Stream.userId ").concat(e.userId," => ").concat(t)),e.userId=t,n()},e.getAttributes=function(){return t.screen?e.screenAttributes:t.attributes},e.hasAudio=function(){return!!e.audio},e.hasVideo=function(){return!!e.video},e.hasScreen=function(){return!!e.screen},e.hasScreenAudio=function(){return!!e.screenAudio},e.isVideoOn=function(){return(e.hasVideo()||e.hasScreen())&&!e.userMuteVideo},e.isAudioOn=function(){return e.hasAudio()&&!e.userMuteAudio},e.init=function(r,i){var o=h.report.reportApiInvoke(e.sid,{callback:function(t,e){if(t)return i&&i(t);r&&r(e)},name:"Stream.init",options:arguments,tag:"tracer"}),a=((new Date).getTime(),arguments[2]);if(void 0===a&&(a=2),!0===e.initialized)return o({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==e.local)return o({type:"warning",msg:"STREAM_NOT_LOCAL"});var s=Math.random().toString().slice(3);e._streamInitID=s,e.videoSource?e.videoName="videoSource":e.video&&(e.videoName=A.a.searchDeviceNameById(t.cameraId)||"default"),e.audioSource?e.audioName="audioSource":e.audio&&(e.audioName=A.a.searchDeviceNameById(t.microphoneId)||"default"),e.screen&&(e.screenName=t.extensionId||"default");try{if(t.audio||t.video||t.screen||t.screenAudio||t.videoSource||t.audioSource){c.default.debug("[".concat(e.streamId,"] Requested access to local media"));var u={streamId:e.streamId};t.videoSource?u.videoSource=t.videoSource:t.screen?u.screen=e.screenConstraint:t.video&&(u.video=e.videoConstraint),t.audioSource?u.audioSource=t.audioSource:t.screenAudio?u.screenAudio=t.screenAudio:t.audio&&(u.audio=e.audioConstraint),Object(v.b)(u,(function(r){if(u.screenAudio&&!r.getAudioTracks()[0]&&c.default.warning("[".concat(e.streamId,"] Audio sharing is not selected")),u.screen&&c.default.debug("[".concat(e.streamId,"] User has granted access to screen sharing")),(u.video||u.audio)&&c.default.debug("[".concat(e.streamId,"] User has granted access to local media")),null===e._streamInitID){r.getTracks().forEach((function(t){t.stop()}));var i={type:"error",msg:"STREAM_IS_CLOSED",info:"stream is closed and cannot be initialized"};return c.default.error(e.streamId,i.info),void o(i)}if(e._streamInitID!==s)return r.getTracks().forEach((function(t){t.stop()})),i={type:"error",msg:"ABORT_OTHER_INIT",info:"stream initialization is aborted because of another stream.init"},c.default.error(e.streamId,i.info),void o(i);e.dispatchEvent({type:"accessAllowed"}),e.stream=r,e.initialized=!0,e.reloadDeviceName(),e.hasVideo()&&Object(m.vsResHack)(r,(function(t,n){e.videoWidth=t,e.videoHeight=n}),(function(t){c.default.warning("[".concat(e.streamId,"] vsResHack failed: "),t)})),t.screen&&e.stream&&e.stream.getVideoTracks()[0]&&(e.stream.getVideoTracks()[0].onended=function(){e.dispatchEvent({type:"stopScreenSharing"})}),e.stream&&e.stream.getTracks&&e.stream.getTracks().forEach((function(r){r&&!r.onended&&(r.onended=n),"video"===r.kind&&t.optimizationMode&&(r.contentHint=t.optimizationMode,r.contentHint===t.optimizationMode&&c.default.debug("[".concat(e.streamId,"] set content hint to"),t.optimizationMode))})),o()}),(function(t){var n={type:"error",info:null};switch(t&&(n.msg=t.name||t.code||t,t.message&&(n.info=t.message),t.code&&(n.info?n.info+=". "+t.code:n.info=" "+t.code),t.constraint&&(n.info?n.info+=". Constraint: "+t.constraint:n.info="constraint: "+t.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(e.videoConstraint&&(delete e.videoConstraint.width,delete e.videoConstraint.height),a>0)return void setTimeout((function(){e.init((function(t){return o(t)}),o,a-1)}),1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":n.msg="PERMISSION_DENIED",e.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":e.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var r="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");c.default.error("[".concat(e.streamId,"] "),r),o(n)}))}else o({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(t){c.default.error("[".concat(e.streamId,"] Stream init: "),t),o({type:"error",msg:t.message||t})}},e.reloadDeviceName=function(){if(e.stream){if(e.stream.getVideoTracks){var t=e.stream.getVideoTracks()[0];t&&t.label&&(e.videoName=t.label)}if(e.stream.getAudioTracks){var n=e.stream.getAudioTracks()[0];n&&n.label&&(e.audioName=n.label)}}},e.close=function(){var t=h.report.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(c.default.debug("[".concat(e.streamId,"] Close stream with id"),e.streamId),e._originStream)try{e._originStream.getTracks().map((function(t){return t.stop()}))}catch(t){}if(void 0!==e.stream){var n=e.stream.getTracks();for(var r in n)n.hasOwnProperty(r)&&(n[r].stop(),n[r].onended=null);!e.isLowStream&&e.local?w.a.disableVideoEffect(e).then((function(){e.stream=void 0})):(e.stream&&e.stream.clean&&e.stream.clean(),e.stream=void 0)}if(e._originStream){for(var r in console.log("clear _originStream"),n=e._originStream.getTracks())n.hasOwnProperty(r)&&(n[r].stop(),n[r].onended=null,console.log("clear onended"));!e.isLowStream&&e.local?w.a.disableVideoEffect(e).then((function(){e._originStream=void 0})):(e._originStream&&e._originStream.clean&&e._originStream.clean(),e._originStream=void 0)}if(Object(o.isSafari)()&&e.pc&&e.pc.peerConnection&&e.pc.peerConnection.removeTrack&&e.pc.peerConnection.getSenders){var i=e.pc.peerConnection.getSenders();i.forEach((function(t){t&&(c.default.debug("[".concat(e.streamId,"] Remove Track"),t),e.pc.peerConnection.removeTrack(t))}))}e.local&&(e.initialized=!1),e._streamInitID=null,e._onAudioMute=void 0,e._onAudioUnmute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,e.lowStream&&e.lowStream.close(),t()},e.enableAudio=function(){var t,n=h.report.reportApiInvoke(e.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return c.default.deprecate("[".concat(e.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),e.userMuteAudio||c.default.warning("[".concat(e.streamId,"] User already enableAudio")),e.userMuteAudio=!1,n(null,t=!e.peerMuteAudio&&e._unmuteAudio()),t},e.disableAudio=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});c.default.deprecate("[".concat(e.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),e.userMuteAudio&&c.default.warning("[".concat(e.streamId,"] User already disableAudio")),e.userMuteAudio=!0;var n=e._muteAudio();return t(null,n),n},e.enableVideo=function(){var t,n=h.report.reportApiInvoke(e.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return c.default.deprecate("[".concat(e.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),e.userMuteVideo||c.default.warning("[".concat(e.streamId,"] User already enableVideo")),e.userMuteVideo=!1,e.lowStream&&(e.lowStream.userMuteVideo=!1),n(null,t=!e.peerMuteVideo&&e._unmuteVideo()),t},e.disableVideo=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});c.default.deprecate("[".concat(e.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),e.userMuteVideo&&c.default.warning("[".concat(e.streamId,"] User already disableVideo")),e.userMuteVideo=!0,e.lowStream&&(e.lowStream.userMuteVideo=!0);var n=e._muteVideo();return t(null,n),n},e.unmuteAudio=function(){var t,n=h.report.reportApiInvoke(e.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return e.userMuteAudio||c.default.warning("[".concat(e.streamId,"] User already unmuteAudio")),e.userMuteAudio=!1,n(null,t=!e.peerMuteAudio&&e._unmuteAudio()),t},e.muteAudio=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});e.userMuteAudio&&c.default.warning("[".concat(e.streamId,"] User already muteAudio")),e.userMuteAudio=!0;var n=e._muteAudio();return t(null,n),n},e.unmuteVideo=function(){var t,n=h.report.reportApiInvoke(e.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return e.userMuteVideo||c.default.warning("[".concat(e.streamId,"] User already unmuteVideo")),e.userMuteVideo=!1,e.lowStream&&(e.lowStream.userMuteVideo=!1),n(null,t=!e.peerMuteVideo&&e._unmuteVideo()),t},e.muteVideo=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});e.userMuteVideo&&c.default.warning("[".concat(e.streamId,"] User already muteVideo")),e.userMuteVideo=!0,e.lowStream&&(e.lowStream.userMuteVideo=!0);var n=e._muteVideo();return t(null,n),n},e._unmuteAudio=function(){return c.default.debug("[".concat(e.streamId,"] Unmuted audio stream with id "),e.streamId),e._flushAudioMixingMuteStatus(!1),!(!e.hasAudio()||!e.initialized||void 0===e.stream||!0===e.stream.getAudioTracks()[0].enabled||(e._onAudioUnmute&&e._onAudioUnmute(),e.pc&&(e.pc.isAudioMute=!1),e.stream.getAudioTracks()[0].enabled=!0,0))},e._isAudioMuted=function(){if(e.stream&&e.hasAudio()){var t=e.stream.getAudioTracks();return t.length>0&&!t[0].enabled}return!1},e._isVideoMuted=function(){if(e.stream&&e.hasVideo()){var t=e.stream.getVideoTracks();return t.length>0&&!t[0].enabled}return!1},e._muteAudio=function(){return c.default.debug("[".concat(e.streamId,"] Muted audio stream with id "),e.streamId),e._flushAudioMixingMuteStatus(!0),!!(e.hasAudio()&&e.initialized&&void 0!==e.stream&&e.stream.getAudioTracks()[0].enabled)&&(e._onAudioMute&&e._onAudioMute(),e.pc&&(e.pc.isAudioMute=!0),e.stream.getAudioTracks()[0].enabled=!1,e.sid&&h.report.audioSendingStopped(e.sid,{succ:!0,reason:"muteAudio"}),!0)},e._unmuteVideo=function(){return c.default.debug("[".concat(e.streamId,"] Unmuted video stream with id"),e.streamId),!(!e.initialized||void 0===e.stream||!e.stream.getVideoTracks().length||!0===e.stream.getVideoTracks()[0].enabled||(e._onVideoUnmute&&e._onVideoUnmute(),e.pc&&(e.pc.isVideoMute=!1),e.stream.getVideoTracks()[0].enabled=!0,e.lowStream&&e.lowStream._unmuteVideo(),0))},e._muteVideo=function(){return c.default.debug("[".concat(e.streamId,"] Muted video stream with id"),e.streamId),!!(e.initialized&&void 0!==e.stream&&e.stream.getVideoTracks().length&&e.stream.getVideoTracks()[0].enabled)&&(e._onVideoMute&&e._onVideoMute(),e.pc&&(e.pc.isVideoMute=!0),e.stream.getVideoTracks()[0].enabled=!1,e.lowStream&&e.lowStream._muteVideo(),e.sid&&h.report.videoSendingStopped(e.sid,{succ:!0,reason:"muteVideo"}),!0)},e.addTrack=function(r){var i=h.report.reportApiInvoke(e.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(e.pc&&e.pc.addTrack(r,e.stream),"audio"==r.kind){e._cleanupAudioMixing();var o=new MediaStream;e.userMuteAudio&&(r.enabled=!1),o.addTrack(r);var a=e.stream.getVideoTracks()[0];a&&o.addTrack(a),e.audio=!0,t.audio=!0,e.stream=o,e.audioLevelHelper=null,e.player&&e.player.video&&(e.player.video.srcObject=e.stream)}else e.userMuteVideo&&(r.enabled=!1),e.stream.addTrack(r),e.video=!0,t.video=!0;r.onended||(r.onended=n),i()},e.removeTrack=function(n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});e.pc&&e.pc.removeTrack(n,e.stream),e.stream.removeTrack(n),e._cleanupAudioMixing(),"audio"===n.kind?(e.audio=!1,t.audio=!1):(e.video=!1,t.video=!1),e.audioLevelHelper=null,"live"==n.readyState&&(n.stop(),c.default.debug("[".concat(e.streamId,"] Track ").concat(n.kind," Stopped"))),r()},e.setAudioOutput=function(t,n,r){var i=h.report.reportApiInvoke(e.sid,{callback:function(t,e){if(t)return r&&r(t);n&&n(e)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Object(y.isValidString)(t,1,255)?(e.audioOutput=t,e.player?void e.player.setAudioOutput(t,(function(){return i()}),i):i()):(c.default.error("[".concat(e.streamId,"] setAudioOutput Invalid Parameter"),t),i(l.default.INVALID_PARAMETER))},e.play=function(t,n,r){"function"==typeof n&&(r=n,n=null),c.default.debug("[".concat(e.streamId,"] play()."),t,n);var i=h.report.reportApiInvoke(e.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:r});if(Object(y.checkValidString)(t,"elementID"),Object(y.isEmpty)(n)||(Object(y.isEmpty)(n.fit)||Object(y.checkValidEnum)(n.fit,"fit",["cover","contain"]),Object(y.isEmpty)(n.muted)||Object(y.checkValidBoolean)(n.muted,"muted")),e.player)c.default.warning("[".concat(e.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),e.resume().then((function(){i(null)})).catch(i);else{e.elementID=t,e.playOptions=n,!e.local||e.video||e.screen?(e.player=new p({id:e.getId(),stream:e,elementID:t,options:n}),e.local&&w.a.applyEffectInPlayer(e)):e.hasAudio()&&(e.player=new p({id:e.getId(),stream:e,elementID:t,options:n}));var o={video:null,audio:null},a=function t(n){if(o[n.mediaType]=n,o.video&&o.audio)if(e.removeEventListener("player-status-change",t),o.video.isErrorState||o.audio.isErrorState){var r=o.video.isErrorState?o.video:o.audio;i({isErrorState:!0,status:r.status,reason:r.reason,video:o.video,audio:o.audio})}else"aborted"===o.video.status&&"aborted"===o.audio.status?i({status:"aborted",reason:"stop",video:o.video,audio:o.audio}):i(null)};e.on("player-status-change",a),e.audioOutput&&e.player.setAudioOutput(e.audioOutput),void 0!==e.audioLevel&&e.player.setAudioVolume(e.audioLevel),e._flushAudioMixingMuteStatus(!1)}},e.stop=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});c.default.debug("[".concat(e.streamId,"] Stop stream player with id "),e.streamId),e.player?(w.a.removeEffectFromLocalPlayer(e),e.player.destroy(),delete e.player):c.default.error("[".concat(e.streamId,"] Stream.stop(): Stream is not playing")),e._flushAudioMixingMuteStatus(!0),t()},e.isPlaying=function(){return!!e.player},e.isPaused=function(){return!!(e.player&&(e.player.video&&e.player.video.paused&&e.player.mediaElemExists(e.player.video)||e.player.audio&&e.player.audio.paused&&e.player.mediaElemExists(e.player.audio)))},e.resume=function(){var t,n;return e.player?(e.player.video&&e.player.video.play&&(t=e.player.video.play()),t=t||Promise.resolve(),e.player.audio&&e.player.audio.play&&(n=e.player.audio.play()),n=n||Promise.resolve(),Promise.all([t,n])):Promise.reject("NO_PLAYER_FOUND")},e.getVideoTrack=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(e.stream&&e.stream.getVideoTracks){var n=e.stream.getVideoTracks()[0];if(n)return c.default.info("[".concat(e.streamId,"] getVideoTrack"),n),t(),n}c.default.info("[".concat(e.streamId,"] getVideoTrack None")),t(null,"getVideoTrack None")},e.getAudioTrack=function(){var t=h.report.reportApiInvoke(e.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(e.stream&&e.stream.getAudioTracks){var n=e.stream.getAudioTracks()[0];if(n)return c.default.info("[".concat(e.streamId,"] getAudioTracks"),n),t(),n}c.default.info("[".concat(e.streamId,"] getAudioTracks None")),t(null,"getAudioTracks None")},e._hasVideoTracks=function(){return!!(e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0])},e._hasAudioTracks=function(){return!!(e.stream&&e.stream.getAudioTracks&&e.stream.getAudioTracks()[0])},e._replaceMediaStreamTrack=function(t,n,r){if(e.stream){if("video"==t.kind){if(o=e.stream.getVideoTracks()[0])return e.userMuteVideo&&(t.enabled=!1),e.stream.removeTrack(o),e.stream.addTrack(t),c.default.debug("[".concat(e.streamId,"] _replaceMediaStreamTrack ").concat(t.kind," SUCCESS")),"live"==o.readyState&&(o.stop(),c.default.debug("[".concat(e.streamId,"] Track ").concat(o.kind," Stopped"))),n&&n();var i="MEDIASTREAM_TRACK_NOT_FOUND";return c.default.error("[".concat(e.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(t.kind)),r(i)}if("audio"==t.kind){var o;if(o=e.stream.getAudioTracks()[0]){e.userMuteAudio&&(t.enabled=!1);var a=new MediaStream;a.addTrack(t);var s=e.stream&&e.stream.getVideoTracks()[0];return s&&a.addTrack(s),e.stream=a,e.audioLevelHelper=null,e.player&&e.player.video&&(e.player.video.srcObject=e.stream),c.default.debug("[".concat(e.streamId,"] _replaceMediaStreamTrack SUCCESS")),"live"==o.readyState&&(o.stop(),c.default.debug("[".concat(e.streamId,"] Track ").concat(o.kind," Stopped"))),n&&n()}return i="MEDIASTREAM_TRACK_NOT_FOUND",c.default.error("[".concat(e.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(t.kind)),r(i)}return i="INVALID_TRACK_TYPE",c.default.error("[".concat(e.streamId,"] _replaceMediaStreamTrack ").concat(i," ").concat(t.kind)),r&&r(i)}return i="NO_STREAM_FOUND",c.default.error("[".concat(e.streamId,"] _replaceMediaStreamTrack ").concat(i)),r&&r(i)},e.replaceTrack=function(t,r,i){var o=h.report.reportApiInvoke(e.sid,{callback:function(t,e){if(t)return i&&i(t);r&&r(e)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return t&&t.kind?(e._cleanupAudioMixing(),t.onended||(t.onended=n),e.pc&&e.pc.hasSender&&e.pc.hasSender(t.kind)?void e.pc.replaceTrack(t,(function(){return c.default.debug("[".concat(e.streamId,"] PeerConnection.replaceTrack ").concat(t.kind," SUCCESS")),e._replaceMediaStreamTrack(t,(function(t){return o(null,t)}),o)}),(function(n){return c.default.error("[".concat(e.streamId,"] PeerConnection.replaceTrack ").concat(t.kind," Failed ").concat(n)),o(n)})):e._replaceMediaStreamTrack(t,(function(t){return o(null,t)}),o)):o("INVALID_TRACK")},e.setAudioVolume=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});Object(y.checkValidNumber)(t,"level",0,100),e.audioLevel=t,e.player&&e.player.setAudioVolume(t),n()},e.getStats=function(t,n,r){var a=[];a.push(e._getPCStats(r)),a.push(new Promise((function(t){var n={};e.pc&&e.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&(Object(g.b)(n,"videoReceiveResolutionHeight",e.videoHeight),Object(g.b)(n,"videoReceiveResolutionWidth",e.videoWidth)):e.pc&&!e.pc.isSubscriber&&((Object(o.isSafari)()||Object(o.isFireFox)())&&(Object(g.b)(n,"videoSendResolutionHeight",e.videoHeight),Object(g.b)(n,"videoSendResolutionWidth",e.videoWidth)),(Object(o.isSafari)()||Object(o.isFireFox)())&&e.uplinkStats&&Object(g.b)(n,"videoSendPacketsLost",e.uplinkStats.uplink_cumulative_lost)),t(n)}))),a.push(new Promise((function(t){var n={};return e.traffic_stats&&e.pc&&e.pc.isSubscriber?(Object(g.b)(n,"accessDelay",e.traffic_stats.access_delay),Object(g.b)(n,"endToEndDelay",e.traffic_stats.e2e_delay),Object(g.b)(n,"videoReceiveDelay",e.traffic_stats.video_delay),Object(g.b)(n,"audioReceiveDelay",e.traffic_stats.audio_delay)):e.traffic_stats&&e.pc&&!e.pc.isSubscriber&&Object(g.b)(n,"accessDelay",e.traffic_stats.access_delay),t(n)}))),Promise.all(a).then((function(n){for(var r={},o=n.length-1;o>=0;o--){var a=n[o];i()(r,a)}t&&setTimeout(t.bind(e,r),0)})).catch((function(t){n&&setTimeout(n.bind(e,t),0)}))},e._getPCStats=function(t){return new Promise((function(n,r){if(!e.pc||"established"!==e.pc.state||!e.pc.getStats)return r("PEER_CONNECTION_NOT_ESTABLISHED");e.pc.getStats((function(t){if(!e.pc||"established"!==e.pc.state||!e.pc.getStats)return r("PEER_CONNECTION_STATE_CHANGE");var i=e.pc.isSubscriber?Object(g.c)(t):Object(g.a)(t);return n(i)}),t)})).then((function(t){return e.pc.isSubscriber?(Object(o.isFireFox)()||Object(o.isSafari)())&&(t.videoReceiveResolutionHeight&&"0"!==t.videoReceiveResolutionHeight||t.videoReceiveResolutionWidth&&"0"!==t.videoReceiveResolutionWidth||(Object(g.b)(t,"videoReceiveResolutionHeight",e.videoHeight),Object(g.b)(t,"videoReceiveResolutionWidth",e.videoWidth))):((Object(o.isSafari)()||Object(o.isFireFox)())&&(t.videoSendResolutionHeight&&"0"!==t.videoSendResolutionHeight||t.videoSendResolutionWidth&&"0"!==t.videoSendResolutionWidth||(Object(g.b)(t,"videoSendResolutionHeight",e.videoHeight),Object(g.b)(t,"videoSendResolutionWidth",e.videoWidth))),(Object(o.isSafari)()||Object(o.isFireFox)())&&e.uplinkStats&&Object(g.b)(t,"videoSendPacketsLost",e.uplinkStats.uplink_cumulative_lost)),Promise.resolve(t)}))},e.getAudioLevel=function(){if(e.audioLevelHelper)return e.audioLevelHelper.getAudioLevel();if(e.stream){if(0!==e.stream.getAudioTracks().length)return e.audioLevelHelper=new m.audioLevelHelper(e.stream),e.audioLevelHelper.getAudioLevel();c.default.warning("[".concat(e.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else c.default.warning("[".concat(e.streamId,"] can't get audioLevel beacuse no stream exist"))},e.setVideoProfile("480p_1"),e._switchVideoDevice=function(t,n,r){if(t===e.cameraId)return n&&n();var a={video:i()({},e.videoConstraint,{deviceId:{exact:t}}),audio:!1};c.default.debug("[".concat(e.streamId,"] ").concat(a)),Object(v.b)(a,(function(i){try{var a=function(){e.isPlaying()&&(e.stop(),e.elementID&&e.play(e.elementID,e.playOptions)),e.cameraId=t,e.videoConstraint.deviceId={exact:t},e.userMuteVideo&&(e.stream.getVideoTracks()[0].enabled=!1),w.a.restoreVideoEffect(e).then((function(){n&&n()}))};w.a.disableVideoEffect(e).then((function(){Object(o.isSafari)()?e.replaceTrack(i.getVideoTracks()[0],a,r):(e.removeTrack(e.stream.getVideoTracks()[0]),e.addTrack(i.getVideoTracks()[0]),a())}))}catch(t){return r&&r(t)}}),(function(t){return r&&r(t)}))},e._switchAudioDevice=function(t,n,r){if(t===e.microphoneId)return n&&n();var a={video:!1,audio:i()({},e.audioConstraint,{deviceId:{exact:t}})};c.default.debug("[".concat(e.streamId,"] "),a),Object(v.b)(a,(function(i){var a=function(){e._cleanupAudioMixing(),e.userMuteAudio&&(e.stream.getAudioTracks()[0].enabled=!1),e.isPlaying()&&(e.stop(),e.elementID&&e.play(e.elementID,e.playOptions)),e.microphoneId=t,e.audioConstraint.deviceId={exact:t},n&&n()};try{Object(o.isSafari)()?e.replaceTrack(i.getAudioTracks()[0],a,r):(e.removeTrack(e.stream.getAudioTracks()[0]),e.addTrack(i.getAudioTracks()[0]),a())}catch(t){return r&&r(t)}}),(function(t){return r&&r(t)}))},e.switchDevice=function(t,n,r,i){var o=h.report.reportApiInvoke(e.sid,{callback:function(t,e){if(t)return i&&i(t);r&&r(e)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Object(y.checkValidString)(n,"deviceId");var a=function(){return e.inSwitchDevice=!1,o()},s=function(t){e.inSwitchDevice=!1,c.default.error("[".concat(e.streamId,"] "),t),o(t)};if(e.inSwitchDevice)return o("Device switch is in process.");if(e.inSwitchDevice=!0,!e.local)return s("Only the local stream can switch the device.");if(e.screen&&"video"===t)return s("The device cannot be switched during screen-sharing.");if(!e.video&&"video"===t)return s("Video track not exist.");if(!e.audio&&"audio"===t)return s("Audio track not exist.");if(e.videoSource||e.audioSource)return s("The device cannot be switched when using videoSource or audioSource.");var u=!1;for(var l in e.audioMixing.sounds){var d=e.audioMixing.sounds[l];if(d.state!==e.audioMixing.states.IDLE){u=!0;break}}var f=e.audioMixing.audioContextInited;if(f&&u)return s("The device cannot be switched when using audio Mixing.");A.a.getDeviceById(n,(function(){if("video"===t)e._switchVideoDevice(n,a,s);else{if("audio"!==t)return s("Invalid type.");e._switchAudioDevice(n,a,s)}}),(function(){return s("The device does not exist.")}))},e},R=function(t){var e=h.report.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer",getStates:function(){return{audioTrackEnable:t&&t.audioSource?t.audioSource.enabled:null,videoTrackEnable:t&&t.videoSource?t.videoSource.enabled:null}}});Object(y.checkValidObject)(t,"StreamSpec");var n=t.streamID,r=t.audio,i=t.video,o=t.screen,a=t.screenAudio,s=(t.audioSource,t.videoSource,t.cameraId),u=t.facingMode,l=t.microphoneId,d=t.mirror,f=t.extensionId,p=t.mediaSource,v=t.audioProcessing,g=t.optimizationMode;if(!Object(y.isEmpty)(n)&&!Object(m.is32Uint)(n)&&!Object(y.isValidString)(n,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Object(y.checkValidBoolean)(r,"audio"),Object(y.checkValidBoolean)(i,"video"),Object(y.isEmpty)(o)||Object(y.checkValidBoolean)(o,"screen"),Object(y.isEmpty)(a)||Object(y.checkValidBoolean)(a,"screenAudio"),Object(y.isEmpty)(s)||Object(y.checkValidString)(s,"cameraId",0,255,!1),Object(y.isEmpty)(u)||Object(y.checkValidEnum)(u,"facingMode",["user","environment","left","right"]),Object(y.isEmpty)(l)||Object(y.checkValidString)(l,"microphoneId",0,255,!1),Object(y.isEmpty)(f)||Object(y.checkValidString)(f,"extensionId"),Object(y.isEmpty)(p)||Object(y.checkValidEnum)(p,"mediaSource",["screen","application","window"]),Object(y.isEmpty)(d)||Object(y.checkValidBoolean)(d,"mirror"),!Object(y.isEmpty)(v)){var A=v.AGC,b=v.AEC,w=v.ANS;Object(y.isEmpty)(A)||Object(y.checkValidBoolean)(A,"AGC"),Object(y.isEmpty)(b)||Object(y.checkValidBoolean)(b,"AEC"),Object(y.isEmpty)(w)||Object(y.checkValidBoolean)(w,"ANS")}Object(y.isEmpty)(g)||Object(y.checkValidEnum)(g,"optimizationMode",["detail","motion"]),c.default.debug("Create stream"),!0===a&&!0===r&&c.default.warning("Do not set both 'screenAudio' and 'audio' to true at the same time"),t.screen&&!g&&(t.optimizationMode="detail");var E=x(t);return e(),E}},function(t,e,n){"use strict";n.d(e,"a",(function(){return w})),n.d(e,"b",(function(){return E}));var r=n(4),i=n(7),o=n.n(i),a=n(13),s=n.n(a),c=n(17),u=n.n(c),l=n(0),d=n(15),h=n(3);function f(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var g=n(47),A=n.n(g),y=n(26),b=(n(5),103),w=function(t){var e={};if(e.clientId=t.clientId,t.session_id=b+=1,"undefined"==typeof window||!window.navigator)throw l.default.error("["+e.streamId+"]["+e.clientId+"]Publish/subscribe video/audio streams not supported yet"),new Error("NON_BROWSER_ENV_DETECTED");return null!==window.navigator.userAgent.match("Firefox")?(e.browser="mozilla",e=function(t){var e={},n=(mozRTCPeerConnection,mozRTCSessionDescription),r=!1;e.uid=t.uid,e.isVideoMute=t.isVideoMute,e.isAudioMute=t.isAudioMute,e.isSubscriber=t.isSubscriber,e.clientId=t.clientId,e.filterStatsCache=[],e.originStatsCache=[],e.lastTimeGetStats=null,e.pc_config={iceServers:[]},t.iceServers instanceof Array?t.iceServers.map((function(t){0===t.url.indexOf("stun:")&&e.pc_config.iceServers.push({url:t.url})})):(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map((function(t){"string"==typeof t&&""!==t&&e.pc_config.iceServers.push({url:t})})):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map((function(t){t.udpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(e.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(e.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.mediaConstraints={offerToReceiveAudio:t.audio,offerToReceiveVideo:t.video,mozDontOfferDataChannel:!0},e.roapSessionId=103,e.peerConnection=new d.RTCPeerConnection(e.pc_config),e.iceCandidateTimer=setTimeout((function(){e.iceCandidateTimer=null,l.default.debug("[".concat(e.clientId,"]Candidates collected: ").concat(e.iceCandidateCount)),e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),e.peerConnection.onicecandidate=function(t){var n,r,i,o;r=(n=e.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===r&&null===i&&null===o||void 0!==e.ice||!e.iceCandidateTimer||(clearTimeout(e.iceCandidateTimer),e.iceCandidateTimer=null,e.ice=0,e.moreIceComing=!1,e.markActionNeeded()),e.iceCandidateCount=e.iceCandidateCount+1},e.checkMLineReverseInSDP=function(t){return!(!~t.indexOf("m=audio")||!~t.indexOf("m=video"))&&t.indexOf("m=audio")>t.indexOf("m=video")},e.reverseMLineInSDP=function(t){var e=t.split("m=audio"),n=e[1].split("m=video"),r="m=video"+n[1],i="m=audio"+n[0];return e[0]+r+i},e.processSignalingMessage=function(r){var i,o=JSON.parse(r);e.incomingMessage=o,"new"===e.state?"OFFER"===o.messageType?(o.sdp=g(o.sdp),i={sdp:o.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+e.clientId+"]setRemoteDescription succeeded")}),(function(t){l.default.info("["+e.clientId+"]setRemoteDescription failed: "+t.name)})),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+o.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===o.messageType?(o.sdp=g(o.sdp),o.sdp=o.sdp.replace(/ generation 0/g,""),o.sdp=o.sdp.replace(/ udp /g," UDP "),-1!==o.sdp.indexOf("a=group:BUNDLE")?(o.sdp=o.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),i={sdp:o.sdp,type:"answer"},t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(e.client,"] remove screen share abs ext")),o.sdp=A(i.sdp)),e.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+e.clientId+"]setRemoteDescription succeeded")}),(function(t){l.default.info("["+e.clientId+"]setRemoteDescription failed: "+t)})),e.state="established"):"pr-answer"===o.messageType?(i={sdp:o.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+e.clientId+"]setRemoteDescription succeeded")}),(function(t){l.default.info("["+e.clientId+"]setRemoteDescription failed: "+t.name)}))):"offer"===o.messageType?e.error("Not written yet"):e.error("Illegal message for this state: "+o.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===o.messageType?(i={sdp:o.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+e.clientId+"]setRemoteDescription succeeded")}),(function(t){l.default.info("["+e.clientId+"]setRemoteDescription failed: "+t.name)})),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+o.messageType+" in state "+e.state))},e.setRtpSenderParameters=function(){var t=u()(s.a.mark((function t(n){var r,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.peerConnection.getSenders(),i=r.find((function(t){return"video"===t.track.kind}))){t.next=4;break}return t.abrupt("return");case 4:return(o=i.getParameters()).degradationPreference=n,t.prev=6,l.default.debug("[".concat(e.clientId,"] setParameters"),o),t.next=10,i.setParameters(o);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),l.default.debug("[".concat(e.clientId,"] setParameters failed, ignore"));case 15:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e){return t.apply(this,arguments)}}();var i={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},o={id:"",type:"",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},a={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},c={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},f=0,p=0,m=0;e.getVideoRelatedStats=function(t){e.peerConnection.getStats().then((function(n){var r,i=v(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(e.isSubscriber){if(("inbound-rtp"===o.type||"inboundrtp"===o.type)&&"video"===o.mediaType){if(!e.lastReport)return void(e.lastReport=o);t&&t({browser:"firefox",mediaType:"video",peerId:e.uid,isVideoMute:e.isVideoMute,frameRateReceived:Math.round(o.framerateMean)+"",frameRateDecoded:o.framesDecoded-e.lastReport.framesDecoded+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""}),e.lastReport=o}}else if(("outbound-rtp"===o.type||"outboundrtp"===o.type)&&"video"===o.mediaType){if(!e.lastReport)return void(e.lastReport=o);t&&t({mediaType:"video",isVideoMute:e.isVideoMute,frameRateInput:Math.round(o.framerateMean)+"",frameRateSent:o.framesEncoded-e.lastReport.framesEncoded+""}),e.lastReport=o}}}catch(t){i.e(t)}finally{i.f()}}))},e.getAudioRelatedStats=function(t){e.peerConnection.getStats().then((function(n){var r,i=v(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;e.isSubscriber&&("inbound-rtp"!==o.type&&"inboundrtp"!==o.type||"audio"!==o.mediaType||t&&t({browser:"firefox",mediaType:"audio",peerId:e.uid,isAudioMute:e.isAudioMute,frameDropped:o.packetsLost+"",frameReceived:o.packetsReceived+"",googJitterReceived:o.jitter+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""}))}}catch(t){i.e(t)}finally{i.f()}}))},e.getStatsRate=function(t){e.getStats((function(e){e.forEach((function(t){})),t(e)}))},e.getStats=function(t,n){n=(n=n||500)>500?500:n,e.lastTimeGetStats&&Date.now()-e.lastTimeGetStats<n?t&&t(e.filterStatsCache,e.originStatsCache):this._getStats((function(n,r){e.filterStatsCache=n,e.originStatsCache=r,e.lastTimeGetStats=Date.now(),t&&t(n,r)}))},e._getStats=function(n){e.peerConnection.getStats().then((function(r){var s,u=[],l=v(r.values());try{for(l.s();!(s=l.n()).done;){var d=s.value;u.push(d),"outbound-rtp"!==d.type&&"outboundrtp"!==d.type||"video"!==d.mediaType||-1!==d.id.indexOf("rtcp")||(o.id=d.id,o.type=d.type,o.mediaType=d.mediaType,o.bytesSent=d.bytesSent?d.bytesSent+"":"0",o.packetsSent=d.packetsSent?d.packetsSent+"":"0",o.googPlisReceived=d.pliCount?d.pliCount+"":"0",o.googNacksReceived=d.nackCount?d.nackCount+"":"0",o.googFirsReceived=d.firCount?d.firCount+"":"0",o.googFrameRateSent=d.framerateMean?Math.round(d.framerateMean)+"":"0"),"outbound-rtp"!==d.type&&"outboundrtp"!==d.type||"audio"!==d.mediaType||-1!==d.id.indexOf("rtcp")||(i.id=d.id,i.type=d.type,i.mediaType=d.mediaType,i.bytesSent=d.bytesSent?d.bytesSent+"":"0",i.packetsSent=d.packetsSent?d.packetsSent+"":"0",t.agoraStream.local&&(i.audioInputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==d.type&&"inboundrtp"!==d.type||"audio"!==d.mediaType||d.isRemote||-1!==d.id.indexOf("rtcp")||(a.id=d.id,a.type=d.type,a.mediaType=d.mediaType,a.bytesReceived=d.bytesReceived?d.bytesReceived+"":"0",a.packetsLost=d.packetsLost?d.packetsLost+"":"0",a.packetsReceived=d.packetsReceived?d.packetsReceived+"":"0",a.googJitterReceived=d.jitter?d.jitter+"":"0",t.agoraStream.local||(a.audioOutputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==d.type&&"inboundrtp"!==d.type||"video"!==d.mediaType||d.isRemote||-1!==d.id.indexOf("rtcp")||(c.id=d.id,c.type=d.type,c.mediaType=d.mediaType,c.bytesReceived=d.bytesReceived?d.bytesReceived+"":"0",c.googFrameRateReceived=d.framerateMean?Math.round(d.framerateMean)+"":"0",c.googFramesDecoded=d.framesDecoded?d.framesDecoded+"":"0",Date.now()-m>=1e3?(c.googFrameRateDecoded=(d.framesDecoded-f)/((Date.now()-m)/1e3),c.googFrameRateDecoded=Math.round(Math.max(0,c.googFrameRateDecoded)),m=Date.now(),p=c.googFrameRateDecoded,f=d.framesDecoded,c.googFrameRateDecoded=c.googFrameRateDecoded.toString()):c.googFrameRateDecoded=p.toString(),c.packetsLost=d.packetsLost?d.packetsLost+"":"0",c.packetsReceived=d.packetsReceived?d.packetsReceived+"":"0",c.googJitterBufferMs=d.jitter?d.jitter+"":"0",c.googNacksSent=d.nackCount?d.nackCount+"":"0",c.googPlisSent=d.pliCount?d.pliCount+"":"0",c.googFirsSent=d.firCount?d.firCount+"":"0"),-1!==d.id.indexOf("outbound_rtcp_video")&&(o.packetsLost=d.packetsLost?d.packetsLost+"":"0")}}catch(t){l.e(t)}finally{l.f()}var h=[o,i,a,c];h.push({id:"time",startTime:e.connectedTime,timestamp:new Date}),n(h,u)}),(function(t){l.default.error("["+e.clientId+"]"+t)}))},e.addStream=function(t){r=!0,e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater((function(){e.onstablestate()}))},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){if(e.actionNeeded){if("new"===e.state||"established"===e.state)r&&(e.mediaConstraints=void 0),e.peerConnection.createOffer((function(t){if(t.sdp=g(t.sdp),t.sdp=t.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),t.sdp!==e.prevOffer)return e.peerConnection.setLocalDescription(t),e.state="preparing-offer",void e.markActionNeeded();l.default.debug("["+e.clientId+"]Not sending a new offer")}),(function(t){l.default.debug("["+e.clientId+"]Ups! create offer failed ",t)}),e.mediaConstraints);else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,e.offerCandidates=e.prevOffer.match(/a=candidate.+\r\n/g)||[],e.offerCandidates.length||(l.default.warning("[".concat(e.clientId,"]No Ice Candidate generated")),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),e.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(e.clientId,"]None Ice Candidate not allowed"))),e.prevOffer=e.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer((function(t){if(e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted)e.markActionNeeded();else{var n=new Date;l.default.debug("["+e.clientId+"]"+n.getTime()+": Starting ICE in responder"),e.iceStarted=!0}}),(function(){l.default.debug("["+e.clientId+"]Ups! Something went wrong")}));else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;var t=e.peerConnection.localDescription.sdp;e.sendMessage("ANSWER",t),e.state="established"}else e.debug("Dazed and confused in state "+e.state+", stopping here");e.actionNeeded=!1}},e.sendMessage=function(t,n){var r={};r.messageType=t,r.sdp=n,"OFFER"===t?(r.offererSessionId=e.sessionId,r.answererSessionId=e.otherSessionId,r.seq=e.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=e.incomingMessage.offererSessionId,r.answererSessionId=e.sessionId,r.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(r))},e._getSender=function(t){if(e.peerConnection&&e.peerConnection.getSenders){var n=e.peerConnection.getSenders().find((function(e){return e.track.kind==t}));if(n)return n}return null},e.hasSender=function(t){return!!e._getSender(t)},e.replaceTrack=function(t,n,r){var i=e._getSender(t.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(t)}catch(t){return r&&r(t)}setTimeout((function(){return n&&n()}),50)},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.ontrack=function(t){e.onaddstream&&e.onaddstream(t,"ontrack")},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(e.connectedTime=new Date),e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)};var g=function(e){var n;if(t.video&&t.maxVideoBW&&(null==(n=e.match(/m=video.*\r\n/))&&(n=e.match(/m=video.*\n/)),n&&n.length>0)){var r=n[0]+"b=TIAS:"+1e3*t.maxVideoBW+"\r\n";e=e.replace(n[0],r)}return t.audio&&t.maxAudioBW&&(null==(n=e.match(/m=audio.*\r\n/))&&(n=e.match(/m=audio.*\n/)),n&&n.length>0)&&(r=n[0]+"b=TIAS:"+1e3*t.maxAudioBW+"\r\n",e=e.replace(n[0],r)),e},A=function(t){return(t=t.replace(/a=.*abs-send-time\r\n/g,"")).replace(/a=.*goog-remb\r\n/g,"")};return e.onaddstream=null,e.onremovestream=null,e.state="new",e.markActionNeeded(),e}(t)):"iOS"===r.getBrowserOS()||r.isSafari()?(l.default.debug("["+e.streamId+"]["+e.clientId+"]Safari"),(e=function(t){var e={},n=d.RTCPeerConnection;e.uid=t.uid,e.isVideoMute=t.isVideoMute,e.isAudioMute=t.isAudioMute,e.isSubscriber=t.isSubscriber,e.clientId=t.clientId,e.filterStatsCache=[],e.originStatsCache=[],e.lastTimeGetStats=null,e.pc_config={iceServers:[{urls:["stun:webcs.agora.io:3478","stun:stun.l.google.com:19302"]}],bundlePolicy:"max-bundle"},e.con={optional:[{DtlsSrtpKeyAgreement:!0}]},t.iceServers instanceof Array?e.pc_config.iceServers=t.iceServers:(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map((function(t){"string"==typeof t&&""!==t&&e.pc_config.iceServers.push({url:t})})):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map((function(t){t.udpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(e.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(e.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.mediaConstraints={mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}},e.roapSessionId=103;try{e.pc_config.sdpSemantics="plan-b",e.peerConnection=new n(e.pc_config,e.con)}catch(t){delete e.pc_config.sdpSemantics,e.peerConnection=new n(e.pc_config,e.con)}e.iceCandidateTimer=setTimeout((function(){e.iceCandidateTimer=null,e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),e.peerConnection.onicecandidate=function(t){var n,r,i,o;r=(n=e.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===e.iceCandidateCount&&(e.timeout=setTimeout((function(){e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded())}),1e3)),null===r&&null===i&&null===o||void 0!==e.ice||!e.iceCandidateTimer||(clearTimeout(e.iceCandidateTimer),e.iceCandidateTimer=null,e.ice=0,e.moreIceComing=!1,e.markActionNeeded()),e.iceCandidateCount=e.iceCandidateCount+1};var r=function(e){return t.screen&&(e=e.replace("a=x-google-flag:conference\r\n","")),e},i=function(n){var r,i;return(r=n.match(/m=video.*\r\n/))&&t.minVideoBW&&t.maxVideoBW&&(i=r[0]+"b=AS:"+t.maxVideoBW+"\r\n",n=n.replace(r[0],i),l.default.debug("["+e.clientId+"]Set Video Bitrate - min:"+t.minVideoBW+" max:"+t.maxVideoBW)),(r=n.match(/m=audio.*\r\n/))&&t.maxAudioBW&&(i=r[0]+"b=AS:"+t.maxAudioBW+"\r\n",n=n.replace(r[0],i)),n};e.processSignalingMessage=function(n){var o,a=JSON.parse(n);e.incomingMessage=a,"new"===e.state?"OFFER"===a.messageType?(o={sdp:a.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+a.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===a.messageType?((o={sdp:a.sdp,type:"answer"}).sdp=r(o.sdp),o.sdp=i(o.sdp),o.sdp=o.sdp.replace(/a=x-google-flag:conference\r\n/g,""),t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(e.client,"] remove screen share abs ext")),o.sdp=o.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),e.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),e.state="established"):"pr-answer"===a.messageType?(o={sdp:a.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(o))):"offer"===a.messageType?e.error("Not written yet"):e.error("Illegal message for this state: "+a.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===a.messageType?(o={sdp:a.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),e.state="offer-received",e.markActionNeeded()):"ANSWER"===a.messageType?((o={sdp:a.sdp,type:"answer"}).sdp=r(o.sdp),o.sdp=i(o.sdp),e.peerConnection.setRemoteDescription(new RTCSessionDescription(o))):e.error("Illegal message for this state: "+a.messageType+" in state "+e.state))},e.setRtpSenderParameters=function(){var t=u()(s.a.mark((function t(n){var r,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.peerConnection.getSenders(),i=r.find((function(t){return"video"===t.track.kind}))){t.next=4;break}return t.abrupt("return");case 4:return(o=i.getParameters()).degradationPreference=n,t.prev=6,l.default.debug("[".concat(e.clientId,"] setParameters"),o),t.next=10,i.setParameters(o);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),l.default.debug("[".concat(e.clientId,"] setParameters failed, ignore"));case 15:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e){return t.apply(this,arguments)}}();var o={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"",type:"",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},c={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},f={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},p={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},v=0,m=0,g=0;return e.isRemoteVideoStats=function(t){return!!(t.frameHeight&&t.frameWidth&&t.remoteSource)},e.getVideoRelatedStats=function(n){e.peerConnection.getStats().then((function(r){r.forEach((function(r){if(e.isSubscriber){var i={peerId:e.uid,mediaType:"video",isVideoMute:e.isVideoMute};if("track"===r.type&&(~r.id.indexOf("video")||~r.trackIdentifier.indexOf("v")||e.isRemoteVideoStats(r))){if(!e.lastReport)return void(e.lastReport=r);i.frameRateReceived=r.framesReceived-e.lastReport.framesReceived+"",i.frameRateDecoded=r.framesDecoded-e.lastReport.framesDecoded+"",e.lastReport=r}"inbound-rtp"===r.type&&~r.id.indexOf("Video")&&(i.bytesReceived=r.bytesReceived+"",i.packetsReceived=r.packetsReceived+"",i.packetsLost=r.packetsLost+""),n&&n(i)}else if("outbound-rtp"===r.type&&~r.id.indexOf("Video")){if(!e.lastReport)return void(e.lastReport=r);n&&n({mediaType:"video",isVideoMute:e.isVideoMute,frameRateInput:t.maxFrameRate+"",frameRateSent:r.framesEncoded-e.lastReport.framesEncoded+""}),e.lastReport=r}}))}))},e.getAudioRelatedStats=function(t){e.peerConnection.getStats().then((function(n){n.forEach((function(n){e.isSubscriber&&"inbound-rtp"===n.type&&~n.id.indexOf("Audio")&&t&&t({peerId:e.uid,mediaType:"audio",isAudioMute:e.isAudioMute,frameDropped:n.packetsLost+"",frameReceived:n.packetsReceived+"",googJitterReceived:n.jitter+"",bytesReceived:n.bytesReceived+"",packetsReceived:n.packetsReceived+"",packetsLost:n.packetsLost+""})}))}))},e.getStatsRate=function(t){e.getStats((function(e){e.forEach((function(t){"outbound-rtp"===t.type&&"video"===t.mediaType&&t.googFramesEncoded&&(t.googFrameRateSent=Math.ceil((t.googFramesEncoded-v)/3).toString(),v=t.googFramesEncoded),"inbound-rtp"===t.type&&-1!=t.id.indexOf("55543")&&(t.googFrameRateReceived&&(t.googFrameRateReceived=Math.ceil((t.googFrameReceived-g)/3).toString(),g=t.googFrameReceived),t.googFrameRateDecoded&&(t.googFrameRateDecoded=Math.ceil((t.googFramesDecoded-m)/3).toString(),m=t.googFramesDecoded))})),t(e)}))},e.getStats=function(t,n){n=(n=n||500)>500?500:n,e.lastTimeGetStats&&Date.now()-e.lastTimeGetStats<n?t&&t(e.filterStatsCache,e.originStatsCache):this._getStats((function(n,r){e.filterStatsCache=n,e.originStatsCache=r,e.lastTimeGetStats=Date.now(),t&&t(n,r)}))},e._getStats=function(n){var r=[];e.peerConnection.getStats().then((function(i){i.forEach((function(e){var n;r.push(e),"outbound-rtp"===e.type&&"audio"===e.mediaType&&(o.id=e.id,o.type=e.type,o.mediaType=e.mediaType,o.bytesSent=e.bytesSent?e.bytesSent+"":"0",o.packetsSent=e.packetsSent?e.packetsSent+"":"0",t.agoraStream.local&&(o.audioInputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"outbound-rtp"===e.type&&"video"===e.mediaType&&(a.id=e.id,a.type=e.type,a.mediaType=e.mediaType,a.bytesSent=e.bytesSent?e.bytesSent+"":"0",a.packetsSent=e.packetsSent?e.packetsSent+"":"0",a.googPlisReceived=e.pliCount?e.pliCount+"":"0",a.googNacksReceived=e.nackCount?e.nackCount+"":"0",a.googFirsReceived=e.firCount?e.firCount+"":"0",a.googFramesEncoded=e.framesEncoded?e.framesEncoded+"":"0",(n=i.get(e.trackId))&&(a.googFrameHeightSent=n.frameHeight&&n.frameHeight.toString(),a.googFrameWidthSent=n.frameWidth&&n.frameWidth.toString())),"inbound-rtp"!==e.type||-1==e.id.indexOf("44444")&&"audio"!==e.mediaType||(c.id=e.id,c.type=e.type,c.mediaType="audio",c.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",c.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",c.packetsLost=e.packetsLost?e.packetsLost+"":"0",c.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",c.googJitterReceived=e.jitter?e.jitter+"":"0",(n=i.get(e.trackId))&&(c.audioOutputLevel=n.audioLevel&&Math.round(32767*n.audioLevel).toString()),t.agoraStream.local||c.audioOutputLevel||(c.audioOutputLevel=Math.round(32767*t.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==e.type||-1==e.id.indexOf("55543")&&"video"!==e.mediaType||(f.id=e.id,f.type=e.type,f.mediaType="video",f.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",f.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",f.packetsLost=e.packetsLost?e.packetsLost+"":"0",f.googJitterBufferMs=e.jitter?e.jitter+"":"0",f.googNacksSent=e.nackCount?e.nackCount+"":"0",f.googPlisSent=e.pliCount?e.pliCount+"":"0",f.googFirsSent=e.firCount?e.firCount+"":"0",(n=i.get(e.trackId))&&(f.googFrameHeightReceived=n.frameHeight&&n.frameHeight.toString(),f.googFrameWidthReceived=n.frameWidth&&n.frameWidth.toString(),f.googFrameReceived=n.framesReceived&&n.framesReceived.toString(),f.googFramesDecoded=n.framesDecoded&&n.framesDecoded.toString())),"candidate-pair"===e.type&&(0==e.availableIncomingBitrate?p.googAvailableSendBandwidth=e.availableOutgoingBitrate+"":p.googAvailableReceiveBandwidth=e.availableIncomingBitrate+"")}));var s=[p,o,a,c,f];s.push({id:"time",startTime:e.connectedTime,timestamp:new Date}),n(s,r)})).catch((function(t){l.default.error("["+e.clientId+"] ",t)}))},e.addTrack=function(t,n){e.peerConnection.addTrack(t,n)},e.removeTrack=function(t,n){var r=e.peerConnection.getSenders().find((function(e){return e.track==t}));r.replaceTrack(null),e.peerConnection.removeTrack(r)},e.addStream=function(t){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?t.getTracks().forEach((function(n){return e.peerConnection.addTrack(n,t)})):e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater((function(){e.onstablestate()}))},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){var n;if(e.actionNeeded){if("new"===e.state||"established"===e.state)t.isSubscriber&&(e.peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.peerConnection.addTransceiver("video",{direction:"recvonly"})),e.peerConnection.createOffer(e.mediaConstraints).then((function(n){if(n.sdp=i(n.sdp),t.isSubscriber||(n.sdp=n.sdp.replace(/a=.*video-orientation\r\n/g,"")),n.sdp!==e.prevOffer)return e.peerConnection.setLocalDescription(n),e.state="preparing-offer",void e.markActionNeeded();l.default.debug("["+e.clientId+"]Not sending a new offer")})).catch((function(t){l.default.debug("["+e.clientId+"]peer connection create offer failed ",t)}));else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,e.offerCandidates=e.prevOffer.match(/a=candidate.+\r\n/g)||[],e.offerCandidates.length||(l.default.warning("[".concat(e.clientId,"]No Ice Candidate generated")),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),e.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(e.clientId,"]None Ice Candidate not allowed"))),e.prevOffer=e.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer((function(t){if(e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted)e.markActionNeeded();else{var n=new Date;l.default.debug("["+e.clientId+"]"+n.getTime()+": Starting ICE in responder"),e.iceStarted=!0}}),(function(t){l.default.debug("["+e.clientId+"]peer connection create answer failed ",t)}),e.mediaConstraints);else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;n=e.peerConnection.localDescription.sdp,e.sendMessage("ANSWER",n),e.state="established"}else e.debug("Dazed and confused in state "+e.state+", stopping here");e.actionNeeded=!1}},e.sendMessage=function(t,n){var r={};r.messageType=t,r.sdp=n,"OFFER"===t?(r.offererSessionId=e.sessionId,r.answererSessionId=e.otherSessionId,r.seq=e.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=e.incomingMessage.offererSessionId,r.answererSessionId=e.sessionId,r.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(r))},e._getSender=function(t){if(e.peerConnection&&e.peerConnection.getSenders){var n=e.peerConnection.getSenders().find((function(e){return e.track.kind==t}));if(n)return n}return null},e.hasSender=function(t){return!!e._getSender(t)},e.replaceTrack=function(t,n,r){var i=e._getSender(t.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(t)}catch(t){return r&&r(t)}setTimeout((function(){return n&&n()}),50)},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.ontrack=function(t){console.log("!!! ontrack, ",t.track.kind,t.track),e.onaddstream&&e.onaddstream(t,"ontrack")},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(e.connectedTime=new Date),e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},e.renegotiate=function(){void 0!==e.prevOffer&&e.peerConnection.createOffer().then((function(t){return t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),t.sdp=r(t.sdp),t.sdp=i(t.sdp),e.peerConnection.setLocalDescription(t)})).then((function(){e.onnegotiationneeded&&e.onnegotiationneeded(e.peerConnection.localDescription.sdp)})).catch((function(t){console.log("createOffer error: ",t)}))},e.peerConnection.onnegotiationneeded=e.renegotiate,e.onaddstream=null,e.onremovestream=null,e.state="new",e.markActionNeeded(),e}(t)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?e=new A.a(t):(e=function(t){var e={},n=d.RTCPeerConnection;e.uid=t.uid,e.isVideoMute=t.isVideoMute,e.isAudioMute=t.isAudioMute,e.isSubscriber=t.isSubscriber,e.clientId=t.clientId,e.filterStatsCache=[],e.originStatsCache=[],e.lastTimeGetStats=null,e.pc_config={iceServers:[{url:"stun:webcs.agora.io:3478"}]};var i={id:"outbound_audio_ssrc_send",type:"ssrc",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"outbound_video_ssrc_send",type:"ssrc",mediaType:"",googCodecName:t.codec?t.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},c={id:"inbound_audio_ssrc_recv",type:"ssrc",mediaType:"",googCodecName:"opus",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},p={id:"inbound_video_ssrc_recv",type:"ssrc",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesReceived:"0",googFramesDecoded:"0"},v={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"};e.con={optional:[{DtlsSrtpKeyAgreement:!0}]},t.iceServers instanceof Array?e.pc_config.iceServers=t.iceServers:(t.stunServerUrl&&(t.stunServerUrl instanceof Array?t.stunServerUrl.map((function(t){"string"==typeof t&&""!==t&&e.pc_config.iceServers.push({url:t})})):"string"==typeof t.stunServerUrl&&""!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl})),t.turnServers&&(t.turnServers instanceof Array?t.turnServers.map((function(t){t.udpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.udpport+"?transport=udp"}),"string"==typeof t.tcpport&&""!==t.tcpport&&e.pc_config.iceServers.push({username:t.username,credential:t.credential,credentialType:"password",urls:(t.useTurns?"turns:":"turn:")+t.url+":"+t.tcpport+"?transport=tcp"}),!0===t.forceturn&&(e.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(e.clientId,"] turnServers is not a array")))),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.mediaConstraints={mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}},e.roapSessionId=103;try{e.pc_config.sdpSemantics="plan-b",e.peerConnection=new n(e.pc_config,e.con)}catch(t){delete e.pc_config.sdpSemantics,e.peerConnection=new n(e.pc_config,e.con)}e.iceCandidateTimer=setTimeout((function(){e.iceCandidateTimer=null,l.default.debug("[".concat(e.clientId,"]Candidates collected: ").concat(e.iceCandidateCount)),e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),e.peerConnection.onicecandidate=function(t){var n,r,i,o;r=(n=e.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===r&&null===i&&null===o||void 0!==e.ice||!e.iceCandidateTimer||(clearTimeout(e.iceCandidateTimer),e.iceCandidateTimer=null,e.ice=0,e.moreIceComing=!1,e.markActionNeeded()),e.iceCandidateCount=e.iceCandidateCount+1};var m=function(t){return t.replace("a=x-google-flag:conference\r\n","")},g=function(n){var r,i;if((r=n.match(/m=video.*\r\n/))&&t.minVideoBW&&t.maxVideoBW){i=r[0]+"b=AS:"+t.maxVideoBW+"\r\n";var o=0,a=0;"h264"===t.codec?(o=n.search(/a=rtpmap:(\d+) H264\/90000\r\n/),a=n.search(/H264\/90000\r\n/)):"vp8"===t.codec?(o=n.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),a=n.search(/VP8\/90000\r\n/)):"vp9"===t.codec&&(o=n.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),a=n.search(/VP9\/90000\r\n/)),-1!==o&&-1!==a&&a-o>10&&(i=i+"a=fmtp:"+n.slice(o+9,a-1)+" x-google-min-bitrate="+t.minVideoBW+"\r\n"),n=n.replace(r[0],i),l.default.debug("["+e.clientId+"]Set Video Bitrate - min:"+t.minVideoBW+" max:"+t.maxVideoBW)}return(r=n.match(/m=audio.*\r\n/))&&t.maxAudioBW&&(i=r[0]+"b=AS:"+t.maxAudioBW+"\r\n",n=n.replace(r[0],i)),n};e.processSignalingMessage=function(n){var r,i=JSON.parse(n);e.incomingMessage=i,"new"===e.state?"OFFER"===i.messageType?(r={sdp:i.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(t){})),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+i.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===i.messageType?((r={sdp:i.sdp,type:"answer"}).sdp=m(r.sdp),r.sdp=g(r.sdp),t.screen&&"detail"===t.optimizationMode&&(l.default.debug("[".concat(e.client,"] remove screen share abs ext")),r.sdp=r.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),t.isSubscriber&&(r.sdp=r.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),e.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(t){})),e.state="established"):"pr-answer"===i.messageType?(r={sdp:i.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(t){}))):"offer"===i.messageType?e.error("Not written yet"):e.error("Illegal message for this state: "+i.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===i.messageType?(r={sdp:i.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(t){})),e.state="offer-received",e.markActionNeeded()):"ANSWER"===i.messageType?((r={sdp:i.sdp,type:"answer"}).sdp=m(r.sdp),r.sdp=g(r.sdp),e.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(t){}))):e.error("Illegal message for this state: "+i.messageType+" in state "+e.state))},e.setRtpSenderParameters=function(){var t=u()(s.a.mark((function t(n){var r,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.peerConnection.getSenders(),console.log("senders",r),i=r.find((function(t){return"video"===t.track.kind}))){t.next=5;break}return t.abrupt("return");case 5:return(o=i.getParameters()).degradationPreference=n,t.prev=7,l.default.debug("[".concat(e.clientId,"] setParameters"),o),t.next=11,i.setParameters(o);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(7),l.default.debug("[".concat(e.clientId,"] setParameters failed, ignore"));case 16:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e){return t.apply(this,arguments)}}();var A=0,y=0;return e.getVideoRelatedStats=function(t){e.getStats((function(n){n.forEach((function(n){if(e.isSubscriber){if("video"===n.mediaType&&n.id&&~n.id.indexOf("recv")){if(r.isChromeKernel()&&+r.getBrowserVersion()>=76){var i=+n.googFramesReceived-A,o=+n.googFramesDecoded-y;e._setStat(p,"googFrameRateReceived",i),e._setStat(p,"googFrameRateDecoded",o),e._setStat(p,"googFrameRateOutput",o),A=+n.googFramesReceived,y=+n.googFramesDecoded}t&&t({mediaType:"video",peerId:e.uid,isVideoMute:e.isVideoMute,frameRateReceived:n.googFrameRateReceived,frameRateDecoded:n.googFrameRateDecoded,bytesReceived:n.bytesReceived,packetsReceived:n.packetsReceived,packetsLost:n.packetsLost})}}else"video"===n.mediaType&&n.id&&~n.id.indexOf("send")&&t&&t({mediaType:"video",isVideoMute:e.isVideoMute,frameRateInput:n.googFrameRateInput,frameRateSent:n.googFrameRateSent,googRtt:n.googRtt})}))}))},e.getAudioRelatedStats=function(t){e.getStats((function(n){n.forEach((function(n){e.isSubscriber&&"audio"===n.mediaType&&n.id&&~n.id.indexOf("recv")&&t&&t({mediaType:"audio",peerId:e.uid,isAudioMute:e.isAudioMute,frameDropped:parseInt(n.googDecodingPLC)+parseInt(n.googDecodingPLCCNG)+"",frameReceived:n.googDecodingCTN,googJitterReceived:n.googJitterReceived,bytesReceived:n.bytesReceived,packetsReceived:n.packetsReceived,packetsLost:n.packetsLost})}))}))},e.getStatsRate=function(t){e.getStats((function(e){t(e)}))},e.getStats=function(t,n){n=(n=n||500)>500?500:n,e.lastTimeGetStats&&Date.now()-e.lastTimeGetStats<n?t&&t(e.filterStatsCache,e.originStatsCache):(e.lastTimeGetStats=Date.now(),this._getStats((function(n,r){e.filterStatsCache=n,e.originStatsCache=r,t&&t(n,r)})))},e._setStat=function(t,e,n){t.hasOwnProperty(e)&&(null!=n&&n!==1/0&&n==n||(n=0),t[e]=n+"")},e._processGetStatsAfterChrome76=function(t){var n=this;e.lastStats||(e.lastStats=new Map),e.peerConnection.getStats().then((function(r){var s,u=[],l=[],d=new Map,h=new Date,m=f(r.values());try{for(m.s();!(s=m.n()).done;){var g=s.value;"codec"!=g.type?"candidate-pair"!=g.type?("inbound-rtp"===g.type&&"video"===g.mediaType&&d.set("inbound-video",g),"inbound-rtp"===g.type&&"audio"===g.mediaType&&d.set("inbound-audio",g),"outbound-rtp"===g.type&&"audio"===g.mediaType&&d.set("outbound-audio",g),"outbound-rtp"===g.type&&"video"===g.mediaType&&d.set("outbound-video",g),"track"===g.type&&"video"===g.kind&&g.remoteSource&&d.set("remote-video-track",g),"track"===g.type&&"audio"===g.kind&&g.remoteSource&&d.set("remote-audio-track",g),"remote-inbound-rtp"===g.type&&"video"===g.mediaType&&d.set("remote-inbound-video",g),"remote-inbound-rtp"===g.type&&"audio"===g.mediaType&&d.set("remote-inbound-audio",g),"track"!==g.type||"video"!==g.kind||g.remoteSource||d.set("local-video-track",g),"track"!==g.type||"audio"!==g.kind||g.remoteSource||d.set("local-audio-track",g),"media-source"===g.type&&"video"===g.kind&&d.set("media-source-video",g),"media-source"===g.type&&"audio"===g.kind&&d.set("media-source-audio",g)):l.push(g):u.push(g)}}catch(t){m.e(t)}finally{m.f()}d.set("codec",u),d.set("candidatePairs",l),d.set("timestamp",+h);var A=null,y=null;if(p.timestamp=h,c.timestamp=h,i.timestamp=h,i.timestamp=h,v.timestamp=h,n.isSubscriber)(A=d.get("inbound-video"))&&(e._setStat(p,"id","inbound_video_ssrc_recv"),e._setStat(p,"mediaType",A.mediaType),e._setStat(p,"packetsLost",A.packetsLost),e._setStat(p,"googDecodeMs",null),e._setStat(p,"googMaxDecodeMs",null),e._setStat(p,"googRenderDelayMs",null),e._setStat(p,"googMinPlayoutDelayMs",null),e._setStat(p,"googNacksSent",A.nackCount),e._setStat(p,"googPlisSent",A.pliCount),e._setStat(p,"googFirsSent",A.firCount),e._setStat(p,"bytesReceived",A.bytesReceived),e._setStat(p,"packetsReceived",A.packetsReceived)),(A=d.get("inbound-audio"))&&(e._setStat(c,"id","inbound_audio_ssrc_recv"),e._setStat(c,"mediaType",A.mediaType),e._setStat(c,"bytesReceived",A.bytesReceived),e._setStat(c,"packetsLost",A.packetsLost),e._setStat(c,"packetsReceived",A.packetsReceived),e._setStat(c,"googAccelerateRate",A.removedSamplesForAcceleration),e._setStat(c,"googCurrentDelayMs",A.jitterBufferDelay),e._setStat(c,"googDecodingCNG",null),e._setStat(c,"googDecodingCTN",null),e._setStat(c,"googDecodingCTSG",null),e._setStat(c,"googDecodingNormal",null),e._setStat(c,"googDecodingPLC",null),e._setStat(c,"googDecodingPLCCNG",null),e._setStat(c,"googJitterReceived",A.jitter),e._setStat(c,"googPreferredJitterBufferMs",null),e._setStat(c,"googSecondaryDecodedRate",null)),(A=d.get("remote-video-track"))&&(e._setStat(p,"googTargetDelayMs",A.jitterBufferDelay),e._setStat(p,"googFrameWidthReceived",A.frameWidth),e._setStat(p,"googFrameHeightReceived",A.frameHeight),e._setStat(p,"googJitterBufferMs",A.jitterBufferDelay/A.jitterBufferEmittedCount*1e3),e._setStat(p,"googCurrentDelayMs",A.jitterBufferDelay),e._setStat(p,"googFramesDecoded",A.framesDecoded),e._setStat(p,"googFramesReceived",A.framesReceived)),(A=d.get("remote-audio-track"))&&(e._setStat(c,"audioOutputLevel",32767*A.audioLevel),e._setStat(c,"googJitterBufferMs",A.jitterBufferDelay/A.jitterBufferEmittedCount*1e3),e._setStat(c,"googExpandRate",A.concealedSamples),e._setStat(c,"googPreemptiveExpandRate",A.insertedSamplesForDeceleration),e._setStat(c,"googSpeechExpandRate",A.silentConcealedSamples));else{var b=e.lastStats.get("timestamp"),w=e.lastStats.get("outbound-video");if((A=d.get("outbound-audio"))&&(e._setStat(i,"id","outbound_audio_ssrc_send"),e._setStat(i,"mediaType",A.mediaType),e._setStat(i,"aecDivergentFilterFraction",null),e._setStat(i,"bytesSent",A.bytesSent),e._setStat(i,"packetsSent",A.packetsSent),y=A.transportId),A=d.get("outbound-video")){if(e._setStat(a,"id","outbound_video_ssrc_send"),e._setStat(a,"mediaType",A.mediaType),e._setStat(a,"bytesSent",A.bytesSent),e._setStat(a,"packetsSent",A.packetsSent),e._setStat(a,"googAdaptationChanges",A.qualityLimitationDurations),e._setStat(a,"googAvgEncodeMs",null),e._setStat(a,"googEncodeUsagePercent",null),y=A.transportId,A.totalEncodedBytesTarget&&w&&w.totalEncodedBytesTarget){var E=(A.totalEncodedBytesTarget-w.totalEncodedBytesTarget)/(+new Date-b);e._setStat(v,"googTargetEncBitrate",Math.floor(8*E*1e3))}if(A.retransmittedBytesSent&&w&&w.retransmittedBytesSent){var _=(A.retransmittedBytesSent-w.retransmittedBytesSent)/(+new Date-b);e._setStat(v,"googRetransmitBitrate",Math.floor(8*_*1e3))}if(A.bytesSent&&w&&w.bytesSent){var S=(A.bytesSent-w.bytesSent)/(+new Date-b);e._setStat(v,"googTransmitBitrate",Math.floor(8*S*1e3)),e._setStat(v,"googActualEncBitrate",Math.floor(8*S*1e3))}if(A.totalPacketSendDelay&&w&&w.totalPacketSendDelay){var T=(A.totalPacketSendDelay-w.totalPacketSendDelay)/(+new Date-b);e._setStat(v,"googBucketDelay",Math.floor(1e3*T))}}if((A=d.get("remote-inbound-video"))&&(e._setStat(a,"packetsLost",A.packetsLost),e._setStat(a,"googRtt",A.roundTripTime)),(A=d.get("local-video-track"))&&(e._setStat(a,"googFrameHeightSent",A.frameHeight),e._setStat(a,"googFrameWidthSent",A.frameWidth),void 0!==A.framesPerSecond&&e._setStat(a,"googFrameRateSent",A.framesPerSecond)),(A=d.get("local-audio-track"))&&(e._setStat(i,"googEchoCancellationReturnLoss",A.echoReturnLoss),e._setStat(i,"googEchoCancellationReturnLossEnhancement",A.echoReturnLossEnhancement)),(A=d.get("media-source-video"))&&(e._setStat(a,"googFrameHeightInput",A.height),e._setStat(a,"googFrameWidthInput",A.width),e._setStat(a,"googFrameRateInput",A.framesPerSecond)),(A=d.get("media-source-audio"))&&e._setStat(i,"audioInputLevel",32767*A.totalAudioEnergy),(A=d.get("inbound-video"))&&(e._setStat(a,"googFirsReceived",A.firCount),e._setStat(a,"googNacksReceived",A.nackCount),e._setStat(a,"googPlisReceived",A.pliCount)),y)d.get("candidatePairs").map((function(t){y==t.transportId&&e._setStat(v,"googAvailableSendBandwidth",t.availableOutgoingBitrate)}));else{var C=d.get("candidatePairs")[0];C&&e._setStat(v,"googAvailableSendBandwidth",C.availableOutgoingBitrate)}}e.lastStats=d;var x=[o()({},a),o()({},i),o()({},p),o()({},c),o()({},v)];x.push({id:"time",startTime:e.connectedTime,timestamp:new Date}),t(x)}))},e._processGetStatsBeforeChrome76=function(t){e.peerConnection.getStats((function(n){var r=[],s=[],u=null;Object.keys(n).forEach((function(t){var e=n[t];e&&(s.push(e),u=e.timestamp,"VideoBwe"===e.type?v=e:e.id.indexOf("_send")>-1&&"video"===e.mediaType?a=e:e.id.indexOf("_send")>-1&&"audio"===e.mediaType?i=e:e.id.indexOf("_recv")>-1&&"video"===e.mediaType?p=e:e.id.indexOf("_recv")>-1&&"audio"===e.mediaType&&(c=e))})),(r=[o()({},a),o()({},i),o()({},p),o()({},c),o()({},v)]).push({id:"time",startTime:e.connectedTime,timestamp:u||new Date}),t(r,s)}))},e._getStats=function(t){Object(h.getParameter)("CHROME_NEW_STATS")&&r.isChromeKernel()&&+r.getBrowserVersion()>=76?e._processGetStatsAfterChrome76(t):e._processGetStatsBeforeChrome76(t)},e.addTrack=function(t,n){e.peerConnection.addTrack(t,n)},e.removeTrack=function(t,n){e.peerConnection.removeTrack(e.peerConnection.getSenders().find((function(e){return e.track==t})))},e.addStream=function(t){e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater((function(){e.onstablestate()}))},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){var n;if(e.actionNeeded){if("new"===e.state||"established"===e.state)e.peerConnection.createOffer(e.mediaConstraints).then((function(n){return n?n.sdp!==e.prevOffer?(t.isSubscriber&&(n.sdp=n.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),e.peerConnection.setLocalDescription(n),e.state="preparing-offer",void e.markActionNeeded()):void l.default.debug("["+e.clientId+"]Not sending a new offer"):(l.default.debug("["+e.clientId+"]sessionDescription is null"),void e.onsignalingmessage(null))})).catch((function(t){l.default.debug("["+e.clientId+"]peer connection create offer failed ",t)}));else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,e.offerCandidates=e.prevOffer.match(/a=candidate.+\r\n/g)||[],e.offerCandidates.length||(l.default.warning("[".concat(e.clientId,"]No Ice Candidate generated")),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),e.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(e.clientId,"]None Ice Candidate not allowed"))),e.prevOffer=e.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer((function(t){if(e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted)e.markActionNeeded();else{var n=new Date;l.default.debug("["+e.clientId+"]"+n.getTime()+": Starting ICE in responder"),e.iceStarted=!0}}),(function(t){l.default.debug("["+e.clientId+"]peer connection create answer failed ",t)}),e.mediaConstraints);else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;n=e.peerConnection.localDescription.sdp,e.sendMessage("ANSWER",n),e.state="established"}else l.default.debug("[".concat(e.clientId,"] Dazed and confused in state ' + that.state + ', stopping here'"));e.actionNeeded=!1}},e.sendMessage=function(t,n){var r={};r.messageType=t,r.sdp=n,"OFFER"===t?(r.offererSessionId=e.sessionId,r.answererSessionId=e.otherSessionId,r.seq=e.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=e.incomingMessage.offererSessionId,r.answererSessionId=e.sessionId,r.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(r))},e._getSender=function(t){if(e.peerConnection&&e.peerConnection.getSenders){var n=e.peerConnection.getSenders().find((function(e){return e.track.kind==t}));if(n)return n}return null},e.hasSender=function(t){return!!e._getSender(t)},e.replaceTrack=function(t,n,r){var i=e._getSender(t.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(t)}catch(t){return r&&r(t)}setTimeout((function(){return n&&n()}),50)},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.ontrack=function(t){e.onaddstream&&(e.onaddstream(t,"ontrack"),e.peerConnection.onaddstream=null)},e.peerConnection.onaddstream=function(t){e.onaddstream&&(e.onaddstream(t,"onaddstream"),e.peerConnection.ontrack=null)},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(e.connectedTime=new Date),e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},e.renegotiate=function(){void 0!==e.prevOffer&&e.peerConnection.createOffer().then((function(t){return t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),t.sdp=m(t.sdp),t.sdp=g(t.sdp),e.peerConnection.setLocalDescription(t)})).then((function(){e.onnegotiationneeded&&e.onnegotiationneeded(e.peerConnection.localDescription.sdp)})).catch((function(t){console.log("createOffer error: ",t)}))},e.peerConnection.onnegotiationneeded=e.renegotiate,e.onaddstream=null,e.onremovestream=null,e.onnegotiationneeded=null,e.state="new",e.markActionNeeded(),e}(t)).browser="chrome-stable",e},E=function(t,e,n){var i={};i.config=t,i.streamId=t.streamId,delete t.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var o=0,a=1,s=!1,c=null,u=function(t){if(o++,c)if(c===t)l.default.debug("Using Video Source/ Audio Source");else{var n=c.getVideoTracks()[0],r=c.getAudioTracks()[0],i=t.getVideoTracks()[0],u=t.getAudioTracks()[0];i&&(n&&c.removeTrack(n),c.addTrack(i)),u&&(r&&c.removeTrack(r),c.addTrack(u))}else c=t;o!==a||s||(s=!0,setTimeout((function(){e(c)}),0))},d=function(t){l.default.error("Failed to GetUserMedia",t.name,t.code,t.message,t),o++,s||(s=!0,setTimeout((function(){n&&n(t)}),0))},h=function(){var e={video:t.video,audio:t.audio};if(l.default.debug("GetUserMedia",JSON.stringify(e)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(e).then(u).catch(d);else if("undefined"!=typeof navigator&&navigator.getMedia)navigator.getMedia(t,u,d);else{var r={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};l.default.error("["+i.streamId+"]"+r.message),n&&n(r)}};if((t.videoSource||t.audioSource)&&(c=new MediaStream,t.videoSource&&c.addTrack(t.videoSource),t.audioSource&&c.addTrack(t.audioSource)),t.video||t.audio||t.screen||t.screenAudio){if(!t.screen&&t.screenAudio)return n&&n({code:"Set screen to true before sharing the audio"});if(t.screen){if(y.a.isElectron())return t.screen.sourceId?y.a.getScreenStream(t.screen.sourceId,t.screen,(function(e,n){e?d(e):(t.audio&&(a++,h()),u(n))})):y.a.shareScreen(t.screen,(function(e,n){e?d(e):(t.audio&&(a++,h()),u(n))}));if(r.isFireFox()){if(l.default.debug("["+i.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(t.screen.mediaSource))return n&&n({code:"Invalid mediaSource, mediaSource should be one of [screen, window, application]"});navigator.getMedia({video:t.screen},(function(e){t.audio&&(a++,h()),u(e)}),d)}else if(r.isChromeKernel()&&t.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void n({code:"This browser does not support screen sharing"});l.default.debug("["+i.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(t.screen.extensionId,{getStream:!0},(function(e){void 0===e?(l.default.error("["+i.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),d({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(t.screen.mandatory.chromeMediaSourceId=e.streamId,navigator.getMedia({video:t.screen},(function(e){t.audio&&(a++,h()),u(e)}),d))}))}catch(t){return l.default.debug("["+i.streamId+"]AgoraRTC screensharing plugin is not accessible"),void n({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var f={};return"number"==typeof t.screen.width&&"number"==typeof t.screen.height?f.video={width:{ideal:t.screen.width},height:{ideal:t.screen.height}}:f.video={width:t.screen.width,height:t.screen.height},t.screen.frameRate&&t.screen.frameRate.min?f.video.frameRate={ideal:t.screen.frameRate.max,max:t.screen.frameRate.max}:f.video.frameRate=t.screen.frameRate,t.screenAudio&&(f.audio=t.screenAudio),l.default.debug("use getDisplayMedia, constraints:",f),window.navigator.mediaDevices.getDisplayMedia(f).then((function(e){!t.screenAudio&&t.audio&&(a++,h()),u(e)})).catch(d)}l.default.error("["+i.streamId+"]This browser does not support screenSharing"),n({code:"This browser does not support screen sharing"})}}else h()}else u(c)}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=function(){function t(t,e,n){void 0===e&&(e=""),this.name="AgoraRTCException",this.code=t,this.message="AgoraRTCError "+this.code+": "+e,this.data=n}return t.prototype.toString=function(){return this.data?this.message+" data: "+JSON.stringify(this.data):this.message},t.prototype.throw=function(){throw i.default.error(this.toString()),this},t}();e.AgoraRTCError=o,function(t){t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_SUPPORT="NOT_SUPPORT",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORT="OPERATION_ABORT",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",t.STREAM_IS_CLOSED="STREAM_IS_CLOSED",t.ABORT_OTHER_INIT="ABORT_OTHER_INIT",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",t.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",t.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.UID_CONFLICT="UID_CONFLICT",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",t.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(e.AgoraRTCErrorCode||(e.AgoraRTCErrorCode={}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(0),i=window.AudioContext||window.webkitAudioContext,o=n(3),a=o.getParameter,s=o.setParameter,c=function(){return a("AUDIO_CONTEXT")||(console.log("Creating Audio Context"),s("AUDIO_CONTEXT",function(){if(i){var t=new i;return window.ctx=t,new Promise((function(t){document.body?t():window.addEventListener("load",t)})).then((function(){var e=function e(){"suspended"==t.state?(r.default.debug("AudioContext is suspended, auto resume"),t.resume().then((function(){r.default.debug("AudioContext resume success"),document.body.removeEventListener("touchend",e,!0),document.body.removeEventListener("mousedown",e,!0)}))):(r.default.debug("AudioContext is running"),document.body.removeEventListener("touchend",e,!0),document.body.removeEventListener("mousedown",e,!0))};r.default.debug(">>> add event listener >>>>"),document.body.addEventListener("touchend",e,!0),document.body.addEventListener("mousedown",e,!0)})),t}throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}())),a("AUDIO_CONTEXT")};c()},function(t,e,n){"use strict";var r=n(1),i=null,o=function(){try{i=window.require("electron")}catch(t){}return i},a=function(t){var e=r.report.reportApiInvoke(null,{callback:t,name:"getScreenSources",options:arguments,tag:"tracer"}),n=o();if(!n)return e&&e("electron is null");try{var i=n.desktopCapturer.getSources({types:["window","screen"]})}catch(t){console.log(t)}i instanceof Promise?(console.log("electron.desktopCapturer.getSources return type is Promise"),i.then((function(t){return e&&e(null,t)})).catch((function(t){return e&&e(t)}))):i=n.desktopCapturer.getSources({types:["window","screen"]},(function(t,n){console.log("electron.desktopCapturer.getSources return type is callback"),e&&e(null,n)}))},s=function(t,e,n){var r=e.width;e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:e.height,maxWidth:r,maxFrameRate:e.frameRate&&e.frameRate.max,minFrameRate:e.frameRate&&e.frameRate.min}}},navigator.webkitGetUserMedia(e,(function(t){n&&n(null,t)}),(function(t){n&&n(t)}))};e.a={isElectron:function(){return!!o()},getElectronInstance:o,getScreenSources:a,getScreenStream:s,shareScreen:function(t,e){a((function(n,r){if(n)return e&&e(n);!function(t,e){var n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var r=document.createElement("div");r.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var i=document.createElement("div");i.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",i.setAttribute("style","height: 12%;");var o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");var s=document.createElement("button");s.innerHTML="cancel",s.setAttribute("style","width: 85px;"),s.onclick=function(){document.body.removeChild(c),e&&e("NotAllowedError")},a.appendChild(s),r.appendChild(i),r.appendChild(o),r.appendChild(a);var c=document.createElement("div");c.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),c.appendChild(n),c.appendChild(r),document.body.appendChild(c),t.map((function(t){if(t.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+t.thumbnail.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.name+"</span>",n.onclick=function(){document.body.removeChild(c),e&&e(null,t.id)},o.appendChild(n)}}))}(r,(function(n,r){if(n)return e&&e(n);s(r,t,e)}))}))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);!function(t){t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t.INJECT="inject_streaming"}(e.LiveStreamingServiceMode||(e.LiveStreamingServiceMode={})),e.DEFAULT_LIVE_STREAMING_TRANSCODING_USER={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},e.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},e.isLiveStreamingTranscodingConfig=function(t){return r.isEmpty(t.width)||r.checkValidNumber(t.width,"config.width",0),r.isEmpty(t.height)||r.checkValidNumber(t.height,"config.height",0),r.isEmpty(t.videoBitrate)||r.checkValidNumber(t.videoBitrate,"config.videoBitrate",1,1e6),r.isEmpty(t.videoFramerate)||r.checkValidNumber(t.videoFramerate,"config.videoFramerate"),r.isEmpty(t.lowLatency)||r.checkValidBoolean(t.lowLatency,"config.lowLatency"),r.isEmpty(t.audioSampleRate)||r.checkValidEnum(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),r.isEmpty(t.audioBitrate)||r.checkValidNumber(t.audioBitrate,"config.audioBitrate",1,128),r.isEmpty(t.audioChannels)||r.checkValidEnum(t.audioChannels,"config.audioChannels",[1,2,3,4,5]),r.isEmpty(t.videoGop)||r.checkValidNumber(t.videoGop,"config.videoGop"),r.isEmpty(t.videoCodecProfile)||r.checkValidEnum(t.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),r.isEmpty(t.userCount)||r.checkValidNumber(t.userCount,"config.userCount",0,17),r.isEmpty(t.backgroundColor)||r.checkValidNumber(t.backgroundColor,"config.backgroundColor",0,16777215),t.transcodingUsers&&!r.isEmpty(t.transcodingUsers)&&(r.checkValidArray(t.transcodingUsers,"config.transcodingUsers"),t.transcodingUsers.forEach((function(t,e){r.checkValidUID(t.uid),r.isEmpty(t.x)||r.checkValidNumber(t.x,"transcodingUser["+e+"].x",0,1e4),r.isEmpty(t.y)||r.checkValidNumber(t.y,"transcodingUser["+e+"].y",0,1e4),r.isEmpty(t.width)||r.checkValidNumber(t.width,"transcodingUser["+e+"].width",0,1e4),r.isEmpty(t.height)||r.checkValidNumber(t.height,"transcodingUser["+e+"].height",0,1e4),r.isEmpty(t.zOrder)||r.checkValidNumber(t.zOrder-1,"transcodingUser["+e+"].zOrder",0,100),r.isEmpty(t.alpha)||r.checkValidFloatNumber(t.alpha,"transcodingUser["+e+"].alpha",0,1)}))),t.images&&!r.isEmpty(t.images)&&(r.checkValidArray(t.images,"config.images"),t.images.forEach((function(t,e){r.checkValidString(t.url,"images["+e+"].url",1,1e3,!1),r.isEmpty(t.x)||r.checkValidNumber(t.x,"images["+e+"].x",0,1e4),r.isEmpty(t.y)||r.checkValidNumber(t.y,"images["+e+"].y",0,1e4),r.isEmpty(t.width)||r.checkValidNumber(t.width,"images["+e+"].width",0,1e4),r.isEmpty(t.height)||r.checkValidNumber(t.height,"images["+e+"].height",0,1e4),r.isEmpty(t.zOrder)||r.checkValidNumber(t.zOrder,"images["+e+"].zOrder",0,255),r.isEmpty(t.alpha)||r.checkValidFloatNumber(t.alpha,"images["+e+"].alpha",0,1)}))),!0},e.DEFAULT_TRANSCODING_CONFIG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFramerate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},e.isInjectStreamConfig=function(t){return r.isEmpty(t.audioVolume)||r.checkValidNumber(t.audioVolume,"config.audioVolume",0,1e3),r.isEmpty(t.audioBitrate)||r.checkValidNumber(t.audioBitrate,"config.audioBitrate",1,1e4),r.isEmpty(t.audioChannels)||r.checkValidEnum(t.audioChannels,"config.audioChannels",[1,2]),r.isEmpty(t.audioSampleRate)||r.checkValidEnum(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),r.isEmpty(t.width)||r.checkValidNumber(t.width,"config.width",0,1e4),r.isEmpty(t.height)||r.checkValidNumber(t.height,"config.height",0,1e4),r.isEmpty(t.videoBitrate)||r.checkValidNumber(t.videoBitrate,"config.videoBitrate",1,1e4),r.isEmpty(t.videoFramerate)||r.checkValidNumber(t.videoFramerate,"config.videoFramerate",1,1e4),r.isEmpty(t.videoGop)||r.checkValidNumber(t.videoGop,"config.videoGop",1,1e4),!0},e.DEFAULT_INJECT_CONFIG={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},function(t){t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.INJECT_STREAM_STATUS="@live_uap-inject-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(e.LiveStreamingUapSignalEvents||(e.LiveStreamingUapSignalEvents={})),function(t){t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(e.LiveStreamingInternalEvents||(e.LiveStreamingInternalEvents={})),function(t){t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE=505]="LIVE_STREAM_RESPONSE_INGNORE_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(e.LIVE_STREAM_ERROR_CODE||(e.LIVE_STREAM_ERROR_CODE={})),function(t){t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls"}(e.WebSocketManagerEvents||(e.WebSocketManagerEvents={}))},function(t,e,n){var r=n(54),i=n(55);t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||i(a)}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),c=a(n(34)),u=n(24),l=a(n(0)),d=n(1);function h(t){return new Promise((function(e){window.setTimeout(e,t)}))}function f(t,e){return new Promise((function(n,r){e.timeout=e.timeout||s.getParameter("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&(e.data=JSON.stringify(e.data)),e.headers=e.headers||{},e.headers["Content-Type"]="application/json",e.method="POST",e.url=t,c.default.request(e).then((function(t){n(t.data)})).catch((function(t){c.default.isCancel(t)?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT,"cancel token canceled")):"ECONNABORTED"===t.code?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_TIMEOUT,t.message)):t.response?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_RESPONSE_ERROR,t.response.status)):r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_ERROR,t.message))}))}))}function p(t,n,r,a){var s=this,c=Object.assign({},e.DEFAULT_RETRY_CONFIG,a),l=c.timeout,d=function(){return i(s,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,h(l)];case 1:return t.sent(),l*=c.timeoutFactor,l=Math.min(c.maxRetryTimeout,l),[2]}}))}))},f=!1,p=new Promise((function(e,a){return i(s,void 0,void 0,(function(){var i,s,l;return o(this,(function(o){switch(o.label){case 0:n=n||function(){return!1},r=r||function(){return!0},i=0,o.label=1;case 1:if(!(i<c.maxRetryCount))return[3,12];if(f)return[2,a(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT))];o.label=2;case 2:return o.trys.push([2,7,,11]),[4,t()];case 3:return s=o.sent(),n(s,i)?i+1===c.maxRetryCount?[2,e(s)]:[4,d()]:[3,5];case 4:return o.sent(),[3,6];case 5:return[2,e(s)];case 6:return[3,11];case 7:return l=o.sent(),r(l,i)?i+1===c.maxRetryCount?[2,a(l)]:[4,d()]:[3,9];case 8:return o.sent(),[3,10];case 9:return[2,a(l)];case 10:return[3,11];case 11:return i+=1,[3,1];case 12:return[2]}}))}))}));return p.cancel=function(){return f=!0},p}function v(t,e){return{addressList:t.servers.map((function(t,n){return"wss://"+t.address.replace(/\./g,"-")+".edge.agora.io:"+t.wss+"?serviceName="+encodeURIComponent(e)})),workerToken:t.workerToken,vid:t.vid}}e.wait=h,e.post=f,e.DEFAULT_RETRY_CONFIG={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},e.getRetryWaitTime=function(t,e){var n=e.timeout*Math.pow(e.timeoutFactor,t);return Math.min(e.maxRetryTimeout,n)},e.retryable=p,e.liveStreamingServerResponseToResult=v;var m=1;function g(t,n,a,c,h){var g=this;void 0===h&&(h=e.DEFAULT_RETRY_CONFIG),m+=1;var A,y,b={sid:a.sid,command:"convergeAllocateEdge",uid:"666",appId:a.appId,ts:Math.floor(Date.now()/1e3),seq:m,requestId:m,version:s.VERSION,cname:a.cname},w={service_name:n,json_body:JSON.stringify(b)},E=t[0];return p((function(){return i(g,void 0,void 0,(function(){var t,e,i,a,d;return o(this,(function(o){switch(o.label){case 0:return A=Date.now(),[4,f(E,{data:w,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}})];case 1:if(t=o.sent(),y=Date.now()-A,0!==t.code)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming ap error, code"+t.code,{retry:!0}),l.default.error(i.toString()),i;if(200!==(e=JSON.parse(t.json_body)).code)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center error, code: "+e.code+", reason: "+e.reason),l.default.error(i.toString()),i;if(!e.servers||0===e.servers.length)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center empty server"),l.default.error(i.toString()),i;if(a=v(e,n),s.getParameter("LIVE_STREAMING_ADDRESS"))try{d=JSON.parse(s.getParameter("LIVE_STREAMING_ADDRESS")),a.addressList=d}catch(t){a.addressList=[s.getParameter("LIVE_STREAMING_ADDRESS")]}return[2,r(r({},a),{responseTime:y})]}}))}))}),(function(e,r){return d.report.requestApWorkerEvent(a.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(e.addressList),firstSuccess:0===r,responseTime:y,serverIp:t[r%t.length]}),!1}),(function(e,r){return d.report.requestApWorkerEvent(a.sid,{success:!1,sc:e.data&&e.data.code||200,serviceName:n,responseTime:y,serverIp:t[r%t.length]}),!!(e.code!==u.AgoraRTCErrorCode.OPERATION_ABORT&&e.code!==u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE||e.data&&e.data.retry)&&(E=t[(r+1)%t.length],!0)}),h)}e.requestLiveStreamingWorkerManager=g,e.getLiveStreamingWorkerMangerResult=function(t,e,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:r=s.getParameter("UAP_AP").map((function(t){return e.proxyServer?"https://"+e.proxyServer+"/ap/?url="+t+"/api/v1?action=uap":"https://"+t+"/api/v1?action=uap"})),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,g(r,t,e,n)];case 2:return[2,o.sent()];case 3:throw i=o.sent(),d.report.requestApWorkerEvent(e.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:t,responseTime:i.data&&i.data.responseTime}),i;case 4:return[2]}}))}))}},function(t,e,n){var r=n(68),i=n(69),o=n(31),a=n(70);t.exports=function(t){return r(t)||i(t)||o(t)||a()}},function(t,e,n){var r=n(32);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(e,"__esModule",{value:!0});var i=n(24),o=function(){function t(){this._events={},this.addListener=this.on}return t.prototype.getListeners=function(t){return this._events[t]?this._events[t].map((function(t){return t.listener})):[]},t.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var n=this._events[t];-1===this._indexOfListener(n,e)&&n.push({listener:e,once:!1})},t.prototype.once=function(t,e){this._events[t]||(this._events[t]=[]);var n=this._events[t];-1===this._indexOfListener(n,e)&&n.push({listener:e,once:!0})},t.prototype.off=function(t,e){if(this._events[t]){var n=this._events[t],r=this._indexOfListener(n,e);-1!==r&&n.splice(r,1),0===this._events[t].length&&delete this._events[t]}},t.prototype.removeAllListeners=function(t){t?delete this._events[t]:this._events={}},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._events[t]||(this._events[t]=[]);for(var r=this._events[t].map((function(t){return t})),i=0;i<r.length;i+=1){var o=r[i];o.once&&this.off(t,o.listener),o.listener.apply(this,e||[])}},t.prototype._indexOfListener=function(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1},t}();function a(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var a=null,s=null;if(t.emit.apply(t,r([e],n,[function(t){a=t},function(t){s=t}])),null!==s)throw s;if(null===a)throw new i.AgoraRTCError(i.AgoraRTCErrorCode.UNEXPECTED_ERROR,"handler is not sync");return a}e.EventEmitter=o,e.emitAsPromise=function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return 0===t.getListeners(e).length?Promise.reject(new i.AgoraRTCError(i.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not emit promise")):new Promise((function(i,o){t.emit.apply(t,r([e],n,[i,o]))}))},e.emitAsInvokerNoResponse=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return 0===t.getListeners(e).length?null:a.apply(void 0,r([t,e],n))},e.emitAsInvoker=a},function(t,e,n){t.exports=n(74)},function(t,e,n){"use strict";t.exports=function(t,e){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.apply(e,n)}}},function(t,e,n){"use strict";var r=n(18);function i(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,n){if(!e)return t;var o;if(n)o=n(e);else if(r.isURLSearchParams(e))o=e.toString();else{var a=[];r.forEach(e,(function(t,e){null!=t&&(r.isArray(t)?e+="[]":t=[t],r.forEach(t,(function(t){r.isDate(t)?t=t.toISOString():r.isObject(t)&&(t=JSON.stringify(t)),a.push(i(e)+"="+i(t))})))})),o=a.join("&")}if(o){var s=t.indexOf("#");-1!==s&&(t=t.slice(0,s)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},function(t,e,n){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,n){"use strict";(function(e){var r=n(18),i=n(80),o={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var s,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==e&&"[object process]"===Object.prototype.toString.call(e))&&(s=n(39)),s),transformRequest:[function(t,e){return i(e,"Accept"),i(e,"Content-Type"),r.isFormData(t)||r.isArrayBuffer(t)||r.isBuffer(t)||r.isStream(t)||r.isFile(t)||r.isBlob(t)?t:r.isArrayBufferView(t)?t.buffer:r.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):r.isObject(t)?(a(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),r.forEach(["post","put","patch"],(function(t){c.headers[t]=r.merge(o)})),t.exports=c}).call(this,n(79))},function(t,e,n){"use strict";var r=n(18),i=n(81),o=n(36),a=n(83),s=n(86),c=n(87),u=n(40);t.exports=function(t){return new Promise((function(e,l){var d=t.data,h=t.headers;r.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(t.auth){var p=t.auth.username||"",v=t.auth.password||"";h.Authorization="Basic "+btoa(p+":"+v)}var m=a(t.baseURL,t.url);if(f.open(t.method.toUpperCase(),o(m,t.params,t.paramsSerializer),!0),f.timeout=t.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?s(f.getAllResponseHeaders()):null,r={data:t.responseType&&"text"!==t.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:t,request:f};i(e,l,r),f=null}},f.onabort=function(){f&&(l(u("Request aborted",t,"ECONNABORTED",f)),f=null)},f.onerror=function(){l(u("Network Error",t,null,f)),f=null},f.ontimeout=function(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),l(u(e,t,"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var g=n(88),A=(t.withCredentials||c(m))&&t.xsrfCookieName?g.read(t.xsrfCookieName):void 0;A&&(h[t.xsrfHeaderName]=A)}if("setRequestHeader"in f&&r.forEach(h,(function(t,e){void 0===d&&"content-type"===e.toLowerCase()?delete h[e]:f.setRequestHeader(e,t)})),r.isUndefined(t.withCredentials)||(f.withCredentials=!!t.withCredentials),t.responseType)try{f.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&f.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){f&&(f.abort(),l(t),f=null)})),void 0===d&&(d=null),f.send(d)}))}},function(t,e,n){"use strict";var r=n(82);t.exports=function(t,e,n,i,o){var a=new Error(t);return r(a,e,n,i,o)}},function(t,e,n){"use strict";var r=n(18);t.exports=function(t,e){e=e||{};var n={},i=["url","method","params","data"],o=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];r.forEach(i,(function(t){void 0!==e[t]&&(n[t]=e[t])})),r.forEach(o,(function(i){r.isObject(e[i])?n[i]=r.deepMerge(t[i],e[i]):void 0!==e[i]?n[i]=e[i]:r.isObject(t[i])?n[i]=r.deepMerge(t[i]):void 0!==t[i]&&(n[i]=t[i])})),r.forEach(a,(function(r){void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r])}));var s=i.concat(o).concat(a),c=Object.keys(e).filter((function(t){return-1===s.indexOf(t)}));return r.forEach(c,(function(r){void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r])})),n}},function(t,e,n){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=o(n(56)),c=a(n(60)),u=a(n(61)),l=o(n(0)),d=n(3),h=s.default.Root.fromJSON(u),f=function(){function t(){this.requestArray=[],this.retryBackoffCount=0,this.state=0}return t.prototype.setProxy=function(t){this.proxyServer=t},t.prototype.sendReportList=function(t,e){var n=this,r=this._dataConvert("ProtoRaws",{vid:e,sendTs:Math.round(Date.now()/1e3),payloads:t.map((function(t){return{id:c[t.type],msg:n._dataConvert(t.type,t.data)}}))});this.send(r)},t.prototype._dataConvert=function(t,e){var n;try{n=h.lookupType("protobuf."+t)}catch(e){l.default.error("[send-proto] invalid proto name "+t)}var r=n.create(e);return n.encode(r).finish()},t.prototype.send=function(t){0==this.state?this._send(t):this.requestArray.push(t)},t.prototype._send=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,4]),this.state=1,[4,this.request(t)];case 1:return e.sent(),this.retryBackoffCount=0,0!==this.requestArray.length?this._send(this.requestArray.shift()):this.state=0,[3,4];case 2:return e.sent(),[4,p(this.retryBackoffCount++<2?200:1e4)];case 3:return e.sent(),this._send(t),[3,4];case 4:return[2]}}))}))},t.prototype.request=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:e=this._getAddress(),n=this._getBackupAddress(),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._request(e,t)];case 2:return r.sent(),[3,5];case 3:return r.sent(),[4,this._request(n,t)];case 4:return r.sent(),[3,5];case 5:return[2]}}))}))},t.prototype._request=function(t,e){return this._post(t,e)},t.prototype._post=function(t,e){var n=this;return new Promise((function(r,i){var o=new XMLHttpRequest;o.timeout=d.getParameter("HTTP_CONNECT_TIMEOUT"),o.open("POST",t,!0),o.setRequestHeader("Content-type","application/octet-stream"),n.proxyServer||(o.setRequestHeader("Cache-Control","no-cache, no-store"),o.setRequestHeader("Pragma","no-cache"),o.setRequestHeader("Expires","0")),o.onload=function(t){r(o.responseText)},o.onerror=function(t){i(t)},o.ontimeout=function(t){i(t)},o.send(e)}))},t.prototype._getAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+d.getParameter("EVENT_REPORT_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+d.getParameter("EVENT_REPORT_DOMAIN")+":6443/events/proto-raws"},t.prototype._getBackupAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+d.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+d.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+":6443/events/proto-raws"},t}();e.default=f;var p=function(t){return new Promise((function(e){window.setTimeout(e,t)}))}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a,s=o(n(0)),c=n(15);!function(t){t.NEW="new",t.PREPARING_OFFER="preparing-offer",t.OFFER_SENT="offer-sent",t.ESTABLISHED="established",t.CLOSED="closed"}(a||(a={}));var u=function(){function t(t){this.candidate=null,this.state=a.NEW,this.config=t,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(t),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:this.config.codec.toUpperCase(),bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return t.prototype.addStream=function(t){this.peerConnection.addStream(t)},t.prototype.setRtpSenderParameters=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2]}))}))},t.prototype.setAnswer=function(t){var e=JSON.parse(t);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:e.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},t.prototype.close=function(){this.peerConnection.close()},t.prototype.getStats=function(t,e){if(void 0===e&&(e=500),e=e>500?500:e,Date.now()-this.lastTimeGetStats<e){var n=[];this.config.isSubscriber?(n.push(this.receiveVideoStats),n.push(this.receiveAudioStats)):(n.push(this.sendAudioStats),n.push(this.sendVideoStats)),n.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),t&&t(n)}else this._getStats(t)},t.prototype._getStats=function(t){var e=this,n=[];this.peerConnection.getStats(null).then((function(r){e.lastTimeGetStats=Date.now(),Object.keys(r).map((function(t){var n=r[t];e.config.isSubscriber?n.type&&"inboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(e.receiveAudioStats.id=n.id+"recv",e.receiveAudioStats.type=n.type+"",e.receiveAudioStats.mediaType=n.mediaType+"",e.receiveAudioStats.packetsReceived=n.packetsReceived+"",e.receiveAudioStats.bytesReceived=n.bytesReceived+"",e.receiveAudioStats.packetsLost=n.packetsLost+"",e.receiveAudioStats.googJitterReceived=n.jitter+""):n.type&&"inboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(e.receiveVideoStats.id=n.id+"recv",e.receiveVideoStats.type=n.type+"",e.receiveVideoStats.mediaType=n.mediaType+"",e.receiveVideoStats.packetsReceived=n.packetsReceived+"",e.receiveVideoStats.bytesReceived=n.bytesReceived+"",e.receiveVideoStats.packetsLost=n.packetsLost+"",e.receiveVideoStats.googJitterBufferMs=n.jitter+"",e.receiveVideoStats.googPlisSent=n.pliCount+"",e.receiveVideoStats.googFirsSent=n.firCount+"",e.receiveVideoStats.googNacksSent=n.nackCount+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("v")?(e.receiveVideoStats.googFrameHeightReceived=n.frameHeight+"",e.receiveVideoStats.googFrameWidthReceived=n.frameWidth+"",e.receiveVideoStats.googFrameRateDecoded=n.framesPerSecond+"",e.receiveVideoStats.googFrameRateOutput=n.framesPerSecond+"",e.receiveVideoStats.googFrameRateReceived=n.framesPerSecond+"",e.receiveVideoStats.googFramesDecoded=n.framesDecoded+"",e.receiveVideoStats.googFrameReceived=n.framesReceived+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("a")&&(e.receiveAudioStats.audioOutputLevel=n.audioLevel+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(e.sendAudioStats.id=n.id+"send",e.sendAudioStats.type=n.type+"",e.sendAudioStats.mediaType=n.mediaType+"",e.sendAudioStats.packetsSent=n.packetsSent+"",e.sendAudioStats.bytesSent=n.bytesSent+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(e.sendVideoStats.id=n.id+"send",e.sendVideoStats.type=n.type+"",e.sendVideoStats.mediaType=n.mediaType+"",e.sendVideoStats.packetsSent=n.packetsSent+"",e.sendVideoStats.bytesSent=n.bytesSent+"",e.sendVideoStats.googRtt=n.roundTripTime+"",e.sendVideoStats.googPlisReceived=n.pliCount+"",e.sendVideoStats.googFirsReceived=n.firCount+"",e.sendVideoStats.googNacksReceived=n.nackCount+""):!n.remoteSource&&n.type&&"track"===n.type&&n.framesSent&&0!==n.framesSent&&(e.sendVideoStats.googFrameHeightSent=n.frameHeight+"",e.sendVideoStats.googFrameHeightInput=n.frameHeight+"",e.sendVideoStats.googFrameWidthSent=n.frameWidth+"",e.sendVideoStats.googFrameWidthInput=n.frameWidth+"",e.sendVideoStats.googFramesEncoded=n.framesSent+"",e.sendVideoStats.googFrameRateSent=n.framesPerSecond+"")})),e.config.isSubscriber?(n.push(e.receiveVideoStats),n.push(e.receiveAudioStats)):(n.push(e.sendAudioStats),n.push(e.sendVideoStats)),n.push({id:"time",startTime:e.connectedTime,timestamp:Date.now()}),t&&t(n)}))},t.prototype.getStatsRate=function(t){this.getStats(t)},t.prototype.initPeecConnection=function(t){var e=t.stunServerUrl,n=t.turnServer,r=t.iceServers;return this.pcConfig={iceServers:[{urls:"stun:webcs.agora.io:3478"}]},r instanceof Array?this.pcConfig.iceServers=t.iceServers:e&&(e instanceof Array?e.map((function(t){"string"==typeof t&&""!==t&&this.pcConfig.iceServers.push({urls:t})})):"string"==typeof e&&""!==e&&this.pcConfig.iceServers.push({urls:e})),n&&(n instanceof Array?n.map((function(t){"string"==typeof t.url&&""!==t.url&&this.pcConfig.iceServers.push({username:t.username,credential:t.credential,url:t.url})})):"auto"!==n.mode&&"manual"!==n.mode||(n.udpport&&this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.udpport+"?transport=udp"}),"string"==typeof n.tcpport&&""!==n.tcpport&&this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.tcpport+"?transport=tcp"}),!0===n.forceturn&&(this.pcConfig.iceTransportPolicy="relay"))),new c.RTCPeerConnection(this.pcConfig)},t.prototype._ontrack=function(t){this.onaddstream&&this.onaddstream(t,"ontrack")},t.prototype._onaddstream=function(t){this.onaddstream&&this.onaddstream(t,"onaddstream")},t.prototype._oniceconnectionstatechange=function(t){"connected"===t.currentTarget.iceConnectionState&&(this.state=a.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},t.prototype._onicecandidate=function(t){!this.candidate&&t&&(this.candidate=t.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},t.prototype.setLocalSDP=function(t){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:t.sdp,type:"offer"})),this.state=a.PREPARING_OFFER,t},t.prototype.editLocalSDP=function(t){return t.sdp=this.setBandWidth(t.sdp),t.sdp=this.reviseOpus(t.sdp),t.sdp=this.addCandidate(t.sdp),t},t.prototype.setSendRecv=function(t){return(t=(t=t.replace(/a=recvonly\r\n/g,"a=sendrecv\r\n")).replace(/a=sendonly\r\n/g,"a=sendrecv\r\n")).replace(/a=inactive\r\n/g,"a=sendrecv\r\n")},t.prototype.setBandWidth=function(t){var e,n,r=this.config,i=r.codec,o=r.minVideoBW,a=r.maxVideoBW,c=r.maxAudioBW,u=r.clientId;if((e=t.match(/m=video.*\r\n/))&&o&&a){n=e[0]+"b=AS:"+a+"\r\n";var l=0,d=0;"h264"===i?(l=t.search(/a=rtpmap:(\d+) H264\/90000\r\n/),d=t.search(/H264\/90000\r\n/)):"vp8"===i?(l=t.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),d=t.search(/VP8\/90000\r\n/)):"vp9"===i&&(l=t.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),d=t.search(/VP9\/90000\r\n/)),-1!==l&&-1!==d&&d-l>10&&(n=n+"a=fmtp:"+t.slice(l+9,d-1)+" x-google-min-bitrate="+o+"\r\n"),t=t.replace(e[0],n),s.default.debug("["+u+"]Set Video Bitrate - min:"+o+" max:"+a)}return(e=t.match(/m=audio.*\r\n/))&&c&&(n=e[0]+"b=AS:"+c+"\r\n",t=t.replace(e[0],n)),t},t.prototype.reviseOpus=function(t){return(t=t.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},t.prototype.addCandidate=function(t){return t+"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"},t.prototype.sendOffer=function(t){this.config.callback(JSON.stringify({sdp:t.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=a.OFFER_SENT},t}();e.default=u},function(t,e,n){var r=n(63),i=n(64),o=n(31),a=n(65);t.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()}},function(t,e,n){var r,i,o;i=this,o=function(){"use strict";var t,e=this;function n(t){e.console&&(e.console.error?e.console.error(t):e.console.log&&e.console.log(t))}function r(t,e,r,i){var o=i||n,a=t.createShader(r);return t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(o("*** Error compiling shader '"+a+"':"+t.getShaderInfoLog(a)),t.deleteShader(a),null)}function i(t,e,r,i,o){var a=o||n,s=t.createProgram();return e.forEach((function(e){t.attachShader(s,e)})),r&&r.forEach((function(e,n){t.bindAttribLocation(s,i?i[n]:n,e)})),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?s:(a("Error in program linking:"+t.getProgramInfoLog(s)),t.deleteProgram(s),null)}(t=t||e)===t.top&&(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));var o,a=["VERTEX_SHADER","FRAGMENT_SHADER"];return!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(o=HTMLCanvasElement.prototype.getContext,function(){var t=arguments,e=t[0];return"webgl"===e&&((t=[].slice.call(arguments))[0]="experimental-webgl"),o.apply(this,t)})),{createProgram:i,createProgramFromSources:function(t,e,n,o,s){for(var c=[],u=0;u<e.length;++u)c.push(r(t,e[u],t[a[u]],s));return i(t,c,n,o,s)}}},void 0===(r=function(){return o.call(i)}.apply(e,[]))||(t.exports=r)},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(66),s=n(4),c=o(n(0));e.getSupportedCodec=function(t){return r(void 0,void 0,void 0,(function(){var e,n,r,o,l;return i(this,(function(i){switch(i.label){case 0:return e={video:[],audio:[]},"undefined"!=typeof window?[3,1]:(c.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{n=a.createRTCPeerConnection({iceServers:[]})}catch(t){return c.default.error("Failed to init RTCPeerConnection",t),[2,Promise.reject(t)]}return n?[3,2]:(c.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(e)]);case 2:return t&&t.stream?[3,7]:(r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},o=void 0,(s.isSafari()||s.isFireFox()||s.isWeChatBrowser())&&n.addTransceiver?(n.addTransceiver("audio"),n.addTransceiver("video"),[4,n.createOffer()]):[3,4]);case 3:return o=i.sent(),[3,6];case 4:return[4,new Promise((function(t,e){var i=setTimeout((function(){e("CREATEOFFER_TIMEOUT")}),3e3);n.createOffer((function(e){clearTimeout(i),t(e)}),(function(t){clearTimeout(i),e(t)}),r)}))];case 5:o=i.sent(),i.label=6;case 6:return n.close(),l=o.sdp,[2,u(l)];case 7:return t.stream.getTracks&&n.addTrack?t.stream.getTracks().forEach((function(e){n.addTrack(e,t.stream)})):n.addStream(t.stream),o=void 0,s.isSafari()||s.isFireFox()?[4,n.createOffer()]:[3,9];case 8:return o=i.sent(),[3,11];case 9:return[4,new Promise((function(t,e){n.createOffer(t,e)}))];case 10:o=i.sent(),i.label=11;case 11:return n.close(),l=o.sdp,[2,u(l)]}}))}))};var u=function(t){var e={video:[],audio:[]};return t.match(/ VP8/i)&&e.video.push("VP8"),t.match(/ VP9/i)&&e.video.push("VP9"),t.match(/ H264/i)&&e.video.push("H264"),t.match(/ opus/i)&&e.audio.push("OPUS"),Promise.resolve(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encryptAES=function(t,e){for(var n,r,i,o,a=t.length,s=(n=t,(new TextEncoder).encode(n)),c=function(t,e){if(0===e)return t;var n=new t.constructor(t.length+e),r=new t.constructor(e);return n.set(t,0),n.set(r,t.length),n}(s,(4-s.length%4)%4),u=(r=[a],i=new Uint32Array(c.buffer),(o=new Uint32Array(r.length+i.length)).set(r,0),o.set(i,r.length),o),l=0;l<u.length;l++)u[l]=u[l]^e,u[l]=~u[l];return function(t){for(var e="",n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}(new Uint8Array(u.buffer))}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(0)),s=n(71),c=n(24),u=n(1),l=n(27);e.addLiveStreamingCapability=function(t,e){var n=this,o=function(e){var n=e.type;if(!t.joinInfo)return new c.AgoraRTCError(c.AgoraRTCErrorCode.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();switch(n){case l.LiveStreamingServiceMode.INJECT:return t._injectStreamingClient||(t._injectStreamingClient=new s.AgoraRTCLiveStreamingClient(t.joinInfo),t._injectStreamingClient.onInjectStatusChange=function(e,n,r){t.gatewayClient.dispatchEvent({type:"streamInjectedStatus",url:r,status:e})}),t._injectStreamingClient;case l.LiveStreamingServiceMode.RAW:return t._liveRawStreamingClient||(t._liveRawStreamingClient=new s.AgoraRTCLiveStreamingClient(t.joinInfo),t._liveRawStreamingClient.setGatewayConnectionState(t.getConnectionState()),t.on("connection-state-change",(function(e){t._liveRawStreamingClient.setGatewayConnectionState(e.curState),"CONNECTING"===e.prevState&&"CONNECTED"===e.curState&&t._liveRawStreamingClient&&t._liveRawStreamingClient.resetAllTask()})),t._liveRawStreamingClient.onLiveStreamError=function(e,n){a.default.error("LIVE_STREAMING_ERROR",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:e,reason:n.code})},t._liveRawStreamingClient.onLiveStreamWarning=function(e,n){a.default.warning("LIVE_STREAMING_WARNING",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:e,reason:n.code})}),t._liveRawStreamingClient;case l.LiveStreamingServiceMode.TRANSCODE:return t._liveTranscodeStreamingClient||(t._liveTranscodeStreamingClient=new s.AgoraRTCLiveStreamingClient(t.joinInfo),t._liveTranscodeStreamingClient.setGatewayConnectionState(t.getConnectionState()),t.on("connection-state-change",(function(e){t._liveTranscodeStreamingClient.setGatewayConnectionState(e.curState),"CONNECTING"===e.prevState&&"CONNECTED"===e.curState&&t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.resetAllTask()})),t._liveTranscodeStreamingClient.onLiveStreamError=function(e,n){a.default.error("LIVE_STREAMING_ERROR",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:e,reason:n.code})},t._liveTranscodeStreamingClient.onLiveStreamWarning=function(e,n){a.default.warning("LIVE_STREAMING_WARNING",n.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:e,reason:n})}),t._liveTranscodeStreamingClient}};t.gatewayClient.addEventListener("join",(function(e){t._injectStreamingClient&&t._injectStreamingClient.resetAllTask()})),t.gatewayClient.addEventListener("stream-unpublished",(function(e){e.options&&0===e.options.streamType&&(t._liveRawStreamingClient&&t._liveRawStreamingClient.resetAllTask(),t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.resetAllTask())})),t.gatewayClient.addEventListener("stream-published",(function(t){})),t.startLiveStreaming=function(n,r){a.default.debug("startLiveStreaming");var i=u.report.reportApiInvoke(e.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});if(t.gatewayClient&&"audience"===t.gatewayClient.role){var o={code:403,reason:"AUDIENCE_STREAMING_FORBIDDEN"};throw i(o),o}var s=t._startLiveStreaming(n,r);return s.then((function(t){i(null,t)})).catch((function(e){a.default.error("LIVE_STREAMING_ERROR",e.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:e.code}),i(e)})),s},t._startLiveStreaming=function(s,u){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return u||("vp8"===e.codec&&a.default.warning("VP8 is not supported by raw_streaming. Subscriber side will suffer"),"vp9"===e.codec&&a.default.warning("VP9 is not supported by raw_streaming. Subscriber side will suffer"),"rtc"===e.mode&&a.default.warning("RTC mode is not supported by raw_streaming. Subscriber side will suffer")),(t._liveRawStreamingClient&&t._liveRawStreamingClient.haveUrl(s)||t._liveTranscodeStreamingClient&&t._liveTranscodeStreamingClient.haveUrl(s))&&new c.AgoraRTCError(c.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw(),n=u?l.LiveStreamingServiceMode.TRANSCODE:l.LiveStreamingServiceMode.RAW,[4,o({type:n}).startLiveStreamingTask(s,n)];case 1:return r.sent(),t.gatewayClient.dispatchEvent({type:"liveStreamingStarted",url:s}),[2]}}))}))},t.setLiveTranscoding=function(n){a.default.debug("setLiveTranscoding: "+JSON.stringify(n));var r=u.report.reportApiInvoke(e.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"}),i=o({type:l.LiveStreamingServiceMode.TRANSCODE});return i.setTranscodingConfig(n).then((function(){t.gatewayClient.dispatchEvent({type:"liveTranscodingUpdated"}),r(null)})).catch((function(e){a.default.error("SET_LIVE_TRANSCODING_ERROR",e.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",reason:e.code}),r(e)}))},t.stopLiveStreaming=function(n){var r=u.report.reportApiInvoke(e.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"}),i=t._stopLiveStreaming(n);return i.then((function(t){r(null,t)})).catch((function(e){a.default.error("STOP_LIVE_STREAMING_ERROR",e.toString()),t.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:e.code}),r(e)})),i},t._stopLiveStreaming=function(e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return a.default.debug("stopLiveStreaming: "+JSON.stringify(e)),n=[t._liveRawStreamingClient,t._liveTranscodeStreamingClient],[4,Promise.all(n.map((function(t){return t&&t.haveUrl(e)&&t.stopLiveStreamingTask(e)})))];case 1:return r.sent(),a.default.debug("stopLiveStreaming sucess: "+JSON.stringify(e)),t.gatewayClient.dispatchEvent({type:"liveStreamingStopped",url:e}),[2]}}))}))},t.addInjectStreamUrl=function(n,r){var i=u.report.reportApiInvoke(e.sessionId,{name:"Client.addInjectStreamUrl",options:[n,r],tag:"tracer"});if("audience"===t.gatewayClient.role){var o={code:403,reason:"AUDIENCE_INJECTING_FORBIDDEN"};throw i(o),o}var s=t._addInjectStreamUrl(n,r);return s.then((function(t){i(null,t)})).catch((function(t){a.default.error("ADD_INJECT_STREAM_ERROR",t.toString()),i(t)})),s},t._addInjectStreamUrl=function(t,e){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=o({type:l.LiveStreamingServiceMode.INJECT})).setInjectStreamConfig(e,0),[4,n.startLiveStreamingTask(t,l.LiveStreamingServiceMode.INJECT)];case 1:return r.sent(),[2]}}))}))},t.removeInjectStreamUrl=function(n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){return r=u.report.reportApiInvoke(e.sessionId,{name:"Client.removeInjectStreamUrl",options:[n],tag:"tracer"}),(o=t._removeInjectStreamUrl(n)).then((function(t){r(null,t)})).catch((function(t){a.default.error("REMOVE_INJECT_STREAM_ERROR",t.toString()),r(t)})),[2,o]}))}))},t._removeInjectStreamUrl=function(t){return r(n,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,o({type:l.LiveStreamingServiceMode.INJECT}).stopLiveStreamingTask(t)];case 1:return e.sent(),[2]}}))}))},t._terminateLiveStreaming=function(){return r(n,void 0,void 0,(function(){return i(this,(function(e){return[t._injectStreamingClient,t._liveRawStreamingClient,t._liveTranscodeStreamingClient].forEach((function(t){t&&t.terminate()})),[2]}))}))}}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(5)),o=r(n(0)),a=n(10);e.default=function(t,e){void 0===e&&(e={width:160,height:120,framerate:15});var n=e.width,r=e.height,s=e.framerate,c=t.stream;if(!c)throw i.default.INVALID_LOCAL_STREAM;if(!c.getVideoTracks()[0])throw i.default.HIGH_STREAM_NOT_VIDEO_TRACE;var u=c.getVideoTracks()[0];o.default.debug("Start getLowStream");var l=document.createElement("video"),d=document.createElement("canvas");l.setAttribute("style","display:none"),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("autoplay",""),l.autoplay=!0,l.setAttribute("playsinline",""),d.setAttribute("style","display:none"),d.setAttribute("width",n.toString()),d.setAttribute("height",r.toString());var h=d.getContext("2d");if(!h)throw new Error("not get canvas context");l.srcObject=c,document.body.append(l),document.body.append(d),l.play(),o.default.debug("Start render lowStream");var f=a.audioTimerLoop((function(){return function(){if(l.paused&&l.play(),l.videoHeight>2&&l.videoWidth>2){var e=l.videoWidth,n=l.videoHeight/e,r=d.width*n;Math.abs(r-d.height)>=2&&(o.default.debug("adjust low stream resolution",d.width+"x"+d.height+" -> "+d.width+"x"+r),d.height=r)}h.drawImage(l,0,0,d.width,d.height);var i=t.stream;if(i){var a=i.getVideoTracks()[0];u!==a&&(o.default.debug("adjust low stream track"),l.srcObject=i,u=a)}}()}),s),p=d.captureStream(s),v=p.getVideoTracks()[0];return v.requestFrame&&v.requestFrame(),p.clean=function(){o.default.debug("Start clean lowStream"),f(),(l||l.parentNode||l.parentNode.removeChild)&&l.parentNode.removeChild(l),(d||d.parentNode||d.parentNode.removeChild)&&d.parentNode.removeChild(d),o.default.debug("Clean lowStream")},p}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,i=n;return[i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]]].join("")}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
 * protobuf.js v6.10.0 (c) 2016, daniel wirtz
 * compiled wed, 15 jul 2020 23:34:13 utc
 * licensed under the bsd-3-clause license
 * see: https://github.com/dcodeio/protobuf.js for details
 */!function(undefined){"use strict";!function(t,e,n){var r=function n(r){var i=e[r];return i||t[r][0].call(i=e[r]={exports:{}},n,i,i.exports),i.exports}(16);r.util.global.protobuf=r,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(59)],(__WEBPACK_AMD_DEFINE_RESULT__=function(t){return t&&t.isLong&&(r.util.Long=t,r.configure()),r}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=r)}({1:[function(t,e,n){e.exports=function(t,e){for(var n=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(t){if(o)if(o=!1,t)a(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,a(t))}}))}},{}],2:[function(t,e,n){var r=n;r.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;r.encode=function(t,e,n){for(var r,o=null,a=[],s=0,c=0;e<n;){var u=t[e++];switch(c){case 0:a[s++]=i[u>>2],r=(3&u)<<4,c=1;break;case 1:a[s++]=i[r|u>>4],r=(15&u)<<2,c=2;break;case 2:a[s++]=i[r|u>>6],a[s++]=i[63&u],c=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=i[r],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},r.decode=function(t,e,n){for(var r,i=n,a=0,s=0;s<t.length;){var c=t.charCodeAt(s++);if(61===c&&a>1)break;if((c=o[c])===undefined)throw Error("invalid encoding");switch(a){case 0:r=c,a=1;break;case 1:e[n++]=r<<2|(48&c)>>4,r=c,a=2;break;case 2:e[n++]=(15&r)<<4|(60&c)>>2,r=c,a=3;break;case 3:e[n++]=(3&r)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-i},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},{}],3:[function(t,e,n){function r(t,e){"string"==typeof t&&(e=t,t=undefined);var n=[];function i(t){if("string"!=typeof t){var e=o();if(r.verbose&&console.log("codegen: "+e),e="return "+e,t){for(var a=Object.keys(t),s=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)s[u]=a[u],c[u]=t[a[u++]];return s[u]=e,Function.apply(null,s).apply(null,c)}return Function(e)()}for(var l=new Array(arguments.length-1),d=0;d<l.length;)l[d]=arguments[++d];if(d=0,t=t.replace(/%([%dfijs])/g,(function(t,e){var n=l[d++];switch(e){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"})),d!==l.length)throw Error("parameter count mismatch");return n.push(t),i}function o(r){return"function "+(r||e||"")+"("+(t&&t.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=o,i}e.exports=r,r.verbose=!1},{}],4:[function(t,e,n){function r(){this._listeners={}}e.exports=r,r.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},r.prototype.off=function(t,e){if(t===undefined)this._listeners={};else if(e===undefined)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},r.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this}},{}],5:[function(t,e,n){e.exports=o;var r=t(1),i=t(7)("fs");function o(t,e,n){return"function"==typeof e?(n=e,e={}):e||(e={}),n?!e.xhr&&i&&i.readFile?i.readFile(t,(function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?o.xhr(t,e,n):r?n(r):n(null,e.binary?i:i.toString("utf8"))})):o.xhr(t,e,n):r(o,this,t,e)}o.xhr=function(t,e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4!==r.readyState)return undefined;if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(e.binary){var t=r.response;if(!t){t=[];for(var i=0;i<r.responseText.length;++i)t.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(t):t)}return n(null,r.responseText)},e.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",t),r.send()}},{1:1,7:7}],6:[function(t,e,n){function r(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function s(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:o,t.writeFloatBE=r?o:i,t.readFloatLE=r?a:s,t.readFloatBE=r?s:a}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>34028234663852886e22)t((i<<31|2139095040)>>>0,n,r);else if(e<11754943508222875e-54)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2);t((i<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,o=r>>>23&255,a=8388607&r;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}t.writeFloatLE=e.bind(null,i),t.writeFloatBE=e.bind(null,o),t.readFloatLE=n.bind(null,a),t.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function s(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:o,t.writeDoubleBE=r?o:i,t.readDoubleLE=r?a:s,t.readDoubleBE=r?s:a}():function(){function e(t,e,n,r,i,o){var a=r<0?1:0;if(a&&(r=-r),0===r)t(0,i,o+e),t(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(r>17976931348623157e292)t(0,i,o+e),t((a<<31|2146435072)>>>0,i,o+n);else{var s;if(r<22250738585072014e-324)t((s=r/5e-324)>>>0,i,o+e),t((a<<31|s/4294967296)>>>0,i,o+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),t(4503599627370496*(s=r*Math.pow(2,-c))>>>0,i,o+e),t((a<<31|c+1023<<20|1048576*s&1048575)>>>0,i,o+n)}}}function n(t,e,n,r,i){var o=t(r,i+e),a=t(r,i+n),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}t.writeDoubleLE=e.bind(null,i,0,4),t.writeDoubleBE=e.bind(null,o,4,0),t.readDoubleLE=n.bind(null,a,0,4),t.readDoubleBE=n.bind(null,s,4,0)}(),t}function i(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function o(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function a(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function s(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}e.exports=r(r)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},{}],8:[function(t,e,n){var r=n,i=r.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},o=r.normalize=function(t){var e=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=i(t),r="";n&&(r=e.shift()+"/");for(var o=0;o<e.length;)".."===e[o]?o>0&&".."!==e[o-1]?e.splice(--o,2):n?e.splice(o,1):++o:"."===e[o]?e.splice(o,1):++o;return r+e.join("/")};r.resolve=function(t,e,n){return n||(e=o(e)),i(e)?e:(n||(t=o(t)),(t=t.replace(/(?:\/|^)[^/]+$/,"")).length?o(t+"/"+e):e)}},{}],9:[function(t,e,n){e.exports=function(t,e,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){if(n<1||n>i)return t(n);a+n>r&&(o=t(r),a=0);var s=e.call(o,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},{}],10:[function(t,e,n){var r=n;r.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)(n=t.charCodeAt(r))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},r.read=function(t,e,n){if(n-e<1)return"";for(var r,i=null,o=[],a=0;e<n;)(r=t[e++])<128?o[a++]=r:r>191&&r<224?o[a++]=(31&r)<<6|63&t[e++]:r>239&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(t,e,n){for(var r,i,o=n,a=0;a<t.length;++a)(r=t.charCodeAt(a))<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=t.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-o}},{}],11:[function(t,e,n){var r=n,i=t(14),o=t(33);function a(t,e,n,r){if(e.resolvedType)if(e.resolvedType instanceof i){t("switch(d%s){",r);for(var o=e.resolvedType.values,a=Object.keys(o),s=0;s<a.length;++s)e.repeated&&o[a[s]]===e.typeDefault&&t("default:"),t("case%j:",a[s])("case %i:",o[a[s]])("m%s=%j",r,o[a[s]])("break");t("}")}else t('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r);else{var c=!1;switch(e.type){case"double":case"float":t("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":t("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":t("m%s=d%s|0",r,r);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,c)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,c?"true":"");break;case"bytes":t('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":t("m%s=String(d%s)",r,r);break;case"bool":t("m%s=Boolean(d%s)",r,r)}}return t}function s(t,e,n,r){if(e.resolvedType)e.resolvedType instanceof i?t("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,n,r,r):t("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var o=!1;switch(e.type){case"double":case"float":t("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,o?"true":"",r);break;case"bytes":t("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:t("d%s=m%s",r,r)}}return t}r.fromObject=function(t){var e=t.fieldsArray,n=o.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!e.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<e.length;++r){var s=e[r].resolve(),c=o.safeProp(s.name);s.map?(n("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),a(n,s,r,c+"[ks[i]]")("}")("}")):s.repeated?(n("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),a(n,s,r,c+"[i]")("}")("}")):(s.resolvedType instanceof i||n("if(d%s!=null){",c),a(n,s,r,c),s.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(t){var e=t.fieldsArray.slice().sort(o.compareFieldsById);if(!e.length)return o.codegen()("return {}");for(var n=o.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],a=[],c=[],u=0;u<e.length;++u)e[u].partOf||(e[u].resolve().repeated?r:e[u].map?a:c).push(e[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",o.safeProp(r[u].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),u=0;u<a.length;++u)n("d%s={}",o.safeProp(a[u].name));n("}")}if(c.length){for(n("if(o.defaults){"),u=0;u<c.length;++u){var l=c[u],d=o.safeProp(l.name);if(l.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",d,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var h="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else n("d%s=%j",d,l.typeDefault)}n("}")}var f=!1;for(u=0;u<e.length;++u){l=e[u];var p=t._fieldsArray.indexOf(l);d=o.safeProp(l.name),l.map?(f||(f=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),s(n,l,p,d+"[ks2[j]]")("}")):l.repeated?(n("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),s(n,l,p,d+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",d,l.name),s(n,l,p,d),l.partOf&&n("if(o.oneofs)")("d%s=%j",o.safeProp(l.partOf.name),l.name)),n("}")}return n("return d")}},{14:14,33:33}],12:[function(t,e,n){e.exports=function(t){var e=o.codegen(["r","l"],t.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(t.fieldsArray.filter((function(t){return t.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");t.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var n=0;n<t.fieldsArray.length;++n){var s=t._fieldsArray[n].resolve(),c=s.resolvedType instanceof r?"int32":s.type,u="m"+o.safeProp(s.name);e("case %i:",s.id),s.map?(e("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),i.defaults[s.keyType]!==undefined?e("k=%j",i.defaults[s.keyType]):e("k=null"),i.defaults[c]!==undefined?e("value=%j",i.defaults[c]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",s.keyType)("case 2:"),i.basic[c]===undefined?e("value=types[%i].decode(r,r.uint32())",n):e("value=r.%s()",c),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),i.long[s.keyType]!==undefined?e('%s[typeof k==="object"?util.longToHash(k):k]=value',u):e("%s[k]=value",u)):s.repeated?(e("if(!(%s&&%s.length))",u,u)("%s=[]",u),i.packed[c]!==undefined&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),i.basic[c]===undefined?e(s.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):e("%s.push(r.%s())",u,c)):i.basic[c]===undefined?e(s.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):e("%s=r.%s()",u,c),e("break")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<t._fieldsArray.length;++n){var l=t._fieldsArray[n];l.required&&e("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",a(l))}return e("return m")};var r=t(14),i=t(32),o=t(33);function a(t){return"missing required '"+t.name+"'"}},{14:14,32:32,33:33}],13:[function(t,e,n){e.exports=function(t){for(var e,n=o.codegen(["m","w"],t.name+"$encode")("if(!w)")("w=Writer.create()"),s=t.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<s.length;++c){var u=s[c].resolve(),l=t._fieldsArray.indexOf(u),d=u.resolvedType instanceof r?"int32":u.type,h=i.basic[d];e="m"+o.safeProp(u.name),u.map?(n("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",e,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",e)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),h===undefined?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,e):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,e),n("}")("}")):u.repeated?(n("if(%s!=null&&%s.length){",e,e),u.packed&&i.packed[d]!==undefined?n("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",e)("w.%s(%s[i])",d,e)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",e),h===undefined?a(n,u,l,e+"[i]"):n("w.uint32(%i).%s(%s[i])",(u.id<<3|h)>>>0,d,e)),n("}")):(u.optional&&n("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",e,u.name),h===undefined?a(n,u,l,e):n("w.uint32(%i).%s(%s)",(u.id<<3|h)>>>0,d,e))}return n("return w")};var r=t(14),i=t(32),o=t(33);function a(t,e,n,r){return e.resolvedType.group?t("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):t("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(e.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(t,e,n){e.exports=a;var r=t(22);((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=t(21),o=t(33);function a(t,e,n,i,o){if(r.call(this,t,n),e&&"object"!=typeof e)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=o||{},this.reserved=undefined,e)for(var a=Object.keys(e),s=0;s<a.length;++s)"number"==typeof e[a[s]]&&(this.valuesById[this.values[a[s]]=e[a[s]]]=a[s])}a.fromJSON=function(t,e){var n=new a(t,e.values,e.options,e.comment,e.comments);return n.reserved=e.reserved,n},a.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"comment",e?this.comment:undefined,"comments",e?this.comments:undefined])},a.prototype.add=function(t,e,n){if(!o.isString(t))throw TypeError("name must be a string");if(!o.isInteger(e))throw TypeError("id must be an integer");if(this.values[t]!==undefined)throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(e))throw Error("id "+e+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(this.valuesById[e]!==undefined){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+e+" in "+this);this.values[t]=e}else this.valuesById[this.values[t]=e]=t;return this.comments[t]=n||null,this},a.prototype.remove=function(t){if(!o.isString(t))throw TypeError("name must be a string");var e=this.values[t];if(null==e)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[e],delete this.values[t],delete this.comments[t],this},a.prototype.isReservedId=function(t){return i.isReservedId(this.reserved,t)},a.prototype.isReservedName=function(t){return i.isReservedName(this.reserved,t)}},{21:21,22:22,33:33}],15:[function(t,e,n){e.exports=u;var r=t(22);((u.prototype=Object.create(r.prototype)).constructor=u).className="Field";var i,o=t(14),a=t(32),s=t(33),c=/^required|optional|repeated$/;function u(t,e,n,i,o,u,l){if(s.isObject(i)?(l=o,u=i,i=o=undefined):s.isObject(o)&&(l=u,u=o,o=undefined),r.call(this,t,u),!s.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!s.isString(n))throw TypeError("type must be a string");if(i!==undefined&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(o!==undefined&&!s.isString(o))throw TypeError("extend must be a string");this.rule=i&&"optional"!==i?i:undefined,this.type=n,this.id=e,this.extend=o||undefined,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&a.long[n]!==undefined,this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(t,e){return new u(t,e.id,e.type,e.rule,e.extend,e.options,e.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(t,e,n){return"packed"===t&&(this._packed=null),r.prototype.setOption.call(this,t,e,n)},u.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return s.toObject(["rule","optional"!==this.rule&&this.rule||undefined,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:undefined])},u.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=a.defaults[this.type])===undefined&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===undefined||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined)),this.long)this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var t;s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,t=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,t=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},u.d=function(t,e,n,r){return"function"==typeof e?e=s.decorateType(e).name:e&&"object"==typeof e&&(e=s.decorateEnum(e).name),function(i,o){s.decorateType(i.constructor).add(new u(o,t,e,n,{default:r}))}},u._configure=function(t){i=t}},{14:14,22:22,32:32,33:33}],16:[function(t,e,n){var r=e.exports=t(17);r.build="light",r.load=function(t,e,n){return"function"==typeof e?(n=e,e=new r.Root):e||(e=new r.Root),e.load(t,n)},r.loadSync=function(t,e){return e||(e=new r.Root),e.loadSync(t)},r.encoder=t(13),r.decoder=t(12),r.verifier=t(36),r.converter=t(11),r.ReflectionObject=t(22),r.Namespace=t(21),r.Root=t(26),r.Enum=t(14),r.Type=t(31),r.Field=t(15),r.OneOf=t(23),r.MapField=t(18),r.Service=t(30),r.Method=t(20),r.Message=t(19),r.wrappers=t(37),r.types=t(32),r.util=t(33),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(t,e,n){var r=n;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=t(38),r.BufferWriter=t(39),r.Reader=t(24),r.BufferReader=t(25),r.util=t(35),r.rpc=t(28),r.roots=t(27),r.configure=i,i()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(t,e,n){e.exports=a;var r=t(15);((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=t(32),o=t(33);function a(t,e,n,i,a,s){if(r.call(this,t,e,i,undefined,undefined,a,s),!o.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(t,e){return new a(t,e.id,e.keyType,e.type,e.options,e.comment)},a.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:undefined])},a.prototype.resolve=function(){if(this.resolved)return this;if(i.mapKey[this.keyType]===undefined)throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(t,e,n){return"function"==typeof n?n=o.decorateType(n).name:n&&"object"==typeof n&&(n=o.decorateEnum(n).name),function(r,i){o.decorateType(r.constructor).add(new a(i,t,e,n))}}},{15:15,32:32,33:33}],19:[function(t,e,n){e.exports=i;var r=t(35);function i(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)this[e[n]]=t[e[n]]}i.create=function(t){return this.$type.create(t)},i.encode=function(t,e){return this.$type.encode(t,e)},i.encodeDelimited=function(t,e){return this.$type.encodeDelimited(t,e)},i.decode=function(t){return this.$type.decode(t)},i.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},i.verify=function(t){return this.$type.verify(t)},i.fromObject=function(t){return this.$type.fromObject(t)},i.toObject=function(t,e){return this.$type.toObject(t,e)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},{35:35}],20:[function(t,e,n){e.exports=o;var r=t(22);((o.prototype=Object.create(r.prototype)).constructor=o).className="Method";var i=t(33);function o(t,e,n,o,a,s,c,u){if(i.isObject(a)?(c=a,a=s=undefined):i.isObject(s)&&(c=s,s=undefined),e!==undefined&&!i.isString(e))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");r.call(this,t,c),this.type=e||"rpc",this.requestType=n,this.requestStream=!!a||undefined,this.responseType=o,this.responseStream=!!s||undefined,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}o.fromJSON=function(t,e){return new o(t,e.type,e.requestType,e.responseType,e.requestStream,e.responseStream,e.options,e.comment)},o.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||undefined,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",e?this.comment:undefined])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(t,e,n){e.exports=l;var r=t(22);((l.prototype=Object.create(r.prototype)).constructor=l).className="Namespace";var i,o,a,s=t(15),c=t(33);function u(t,e){if(!t||!t.length)return undefined;for(var n={},r=0;r<t.length;++r)n[t[r].name]=t[r].toJSON(e);return n}function l(t,e){r.call(this,t,e),this.nested=undefined,this._nestedArray=null}function d(t){return t._nestedArray=null,t}l.fromJSON=function(t,e){return new l(t,e.options).addJSON(e.nested)},l.arrayToJSON=u,l.isReservedId=function(t,e){if(t)for(var n=0;n<t.length;++n)if("string"!=typeof t[n]&&t[n][0]<=e&&t[n][1]>e)return!0;return!1},l.isReservedName=function(t,e){if(t)for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=c.toArray(this.nested))}}),l.prototype.toJSON=function(t){return c.toObject(["options",this.options,"nested",u(this.nestedArray,t)])},l.prototype.addJSON=function(t){if(t)for(var e,n=Object.keys(t),r=0;r<n.length;++r)e=t[n[r]],this.add((e.fields!==undefined?i.fromJSON:e.values!==undefined?a.fromJSON:e.methods!==undefined?o.fromJSON:e.id!==undefined?s.fromJSON:l.fromJSON)(n[r],e));return this},l.prototype.get=function(t){return this.nested&&this.nested[t]||null},l.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof a)return this.nested[t].values;throw Error("no such enum: "+t)},l.prototype.add=function(t){if(!(t instanceof s&&t.extend!==undefined||t instanceof i||t instanceof a||t instanceof o||t instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var e=this.get(t.name);if(e){if(!(e instanceof l&&t instanceof l)||e instanceof i||e instanceof o)throw Error("duplicate name '"+t.name+"' in "+this);for(var n=e.nestedArray,r=0;r<n.length;++r)t.add(n[r]);this.remove(e),this.nested||(this.nested={}),t.setOptions(e.options,!0)}}else this.nested={};return this.nested[t.name]=t,t.onAdd(this),d(this)},l.prototype.remove=function(t){if(!(t instanceof r))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=undefined),t.onRemove(this),d(this)},l.prototype.define=function(t,e){if(c.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var n=this;t.length>0;){var r=t.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof l))throw Error("path conflicts with non-namespace objects")}else n.add(n=new l(r))}return e&&n.addJSON(e),n},l.prototype.resolveAll=function(){for(var t=this.nestedArray,e=0;e<t.length;)t[e]instanceof l?t[e++].resolveAll():t[e++].resolve();return this.resolve()},l.prototype.lookup=function(t,e,n){if("boolean"==typeof e?(n=e,e=undefined):e&&!Array.isArray(e)&&(e=[e]),c.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),e);var r=this.get(t[0]);if(r){if(1===t.length){if(!e||e.indexOf(r.constructor)>-1)return r}else if(r instanceof l&&(r=r.lookup(t.slice(1),e,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof l&&(r=this._nestedArray[i].lookup(t,e,!0)))return r;return null===this.parent||n?null:this.parent.lookup(t,e)},l.prototype.lookupType=function(t){var e=this.lookup(t,[i]);if(!e)throw Error("no such type: "+t);return e},l.prototype.lookupEnum=function(t){var e=this.lookup(t,[a]);if(!e)throw Error("no such Enum '"+t+"' in "+this);return e},l.prototype.lookupTypeOrEnum=function(t){var e=this.lookup(t,[i,a]);if(!e)throw Error("no such Type or Enum '"+t+"' in "+this);return e},l.prototype.lookupService=function(t){var e=this.lookup(t,[o]);if(!e)throw Error("no such Service '"+t+"' in "+this);return e},l._configure=function(t,e,n){i=t,o=e,a=n}},{15:15,22:22,33:33}],22:[function(t,e,n){e.exports=o,o.className="ReflectionObject";var r,i=t(33);function o(t,e){if(!i.isString(t))throw TypeError("name must be a string");if(e&&!i.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],e=this.parent;e;)t.unshift(e.name),e=e.parent;return t.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var e=t.root;e instanceof r&&e._handleAdd(this)},o.prototype.onRemove=function(t){var e=t.root;e instanceof r&&e._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},o.prototype.getOption=function(t){return this.options?this.options[t]:undefined},o.prototype.setOption=function(t,e,n){return n&&this.options&&this.options[t]!==undefined||((this.options||(this.options={}))[t]=e),this},o.prototype.setParsedOption=function(t,e,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var o=r.find((function(e){return Object.prototype.hasOwnProperty.call(e,t)}));if(o){var a=o[t];i.setProperty(a,n,e)}else(o={})[t]=i.setProperty({},n,e),r.push(o)}else{var s={};s[t]=e,r.push(s)}return this},o.prototype.setOptions=function(t,e){if(t)for(var n=Object.keys(t),r=0;r<n.length;++r)this.setOption(n[r],t[n[r]],e);return this},o.prototype.toString=function(){var t=this.constructor.className,e=this.fullName;return e.length?t+" "+e:t},o._configure=function(t){r=t}},{33:33}],23:[function(t,e,n){e.exports=a;var r=t(22);((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=t(15),o=t(33);function a(t,e,n,i){if(Array.isArray(e)||(n=e,e=undefined),r.call(this,t,n),e!==undefined&&!Array.isArray(e))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=i}function s(t){if(t.parent)for(var e=0;e<t.fieldsArray.length;++e)t.fieldsArray[e].parent||t.parent.add(t.fieldsArray[e])}a.fromJSON=function(t,e){return new a(t,e.oneof,e.options,e.comment)},a.prototype.toJSON=function(t){var e=!!t&&Boolean(t.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",e?this.comment:undefined])},a.prototype.add=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=this,s(this),this},a.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");var e=this.fieldsArray.indexOf(t);if(e<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(e,1),(e=this.oneof.indexOf(t.name))>-1&&this.oneof.splice(e,1),t.partOf=null,this},a.prototype.onAdd=function(t){r.prototype.onAdd.call(this,t);for(var e=0;e<this.oneof.length;++e){var n=t.get(this.oneof[e]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}s(this)},a.prototype.onRemove=function(t){for(var e,n=0;n<this.fieldsArray.length;++n)(e=this.fieldsArray[n]).parent&&e.parent.remove(e);r.prototype.onRemove.call(this,t)},a.d=function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;)t[e]=arguments[e++];return function(e,n){o.decorateType(e.constructor).add(new a(n,t)),Object.defineProperty(e,n,{get:o.oneOfGetter(t),set:o.oneOfSetter(t)})}}},{15:15,22:22,33:33}],24:[function(t,e,n){e.exports=c;var r,i=t(35),o=i.LongBits,a=i.utf8;function s(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function c(t){this.buf=t,this.pos=0,this.len=t.length}var u,l="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new c(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new c(t);throw Error("illegal buffer")},d=function(){return i.Buffer?function(t){return(c.create=function(t){return i.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function h(){var t=new o(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw s(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw s(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function f(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new o(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}c.create=d(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|f(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var t=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},c.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var t=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},c.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw s(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},c.prototype.string=function(){var t=this.bytes();return a.read(t,0,t.length)},c.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw s(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},c._configure=function(t){r=t,c.create=d(),r._configure();var e=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return p.call(this)[e](!0)},sfixed64:function(){return p.call(this)[e](!1)}})}},{35:35}],25:[function(t,e,n){e.exports=o;var r=t(24);(o.prototype=Object.create(r.prototype)).constructor=o;var i=t(35);function o(t){r.call(this,t)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},o._configure()},{24:24,35:35}],26:[function(t,e,n){e.exports=d;var r=t(21);((d.prototype=Object.create(r.prototype)).constructor=d).className="Root";var i,o,a,s=t(15),c=t(14),u=t(23),l=t(33);function d(t){r.call(this,"",t),this.deferred=[],this.files=[]}function h(){}d.fromJSON=function(t,e){return e||(e=new d),t.options&&e.setOptions(t.options),e.addJSON(t.nested)},d.prototype.resolvePath=l.path.resolve,d.prototype.fetch=l.fetch,d.prototype.load=function t(e,n,r){"function"==typeof n&&(r=n,n=undefined);var i=this;if(!r)return l.asPromise(t,i,e,n);var s=r===h;function c(t,e){if(r){var n=r;if(r=null,s)throw t;n(t,e)}}function u(t){var e=t.lastIndexOf("google/protobuf/");if(e>-1){var n=t.substring(e);if(n in a)return n}return null}function d(t,e){try{if(l.isString(e)&&"{"===e.charAt(0)&&(e=JSON.parse(e)),l.isString(e)){o.filename=t;var r,a=o(e,i,n),d=0;if(a.imports)for(;d<a.imports.length;++d)(r=u(a.imports[d])||i.resolvePath(t,a.imports[d]))&&f(r);if(a.weakImports)for(d=0;d<a.weakImports.length;++d)(r=u(a.weakImports[d])||i.resolvePath(t,a.weakImports[d]))&&f(r,!0)}else i.setOptions(e.options).addJSON(e.nested)}catch(t){c(t)}s||p||c(null,i)}function f(t,e){if(!(i.files.indexOf(t)>-1))if(i.files.push(t),t in a)s?d(t,a[t]):(++p,setTimeout((function(){--p,d(t,a[t])})));else if(s){var n;try{n=l.fs.readFileSync(t).toString("utf8")}catch(t){return void(e||c(t))}d(t,n)}else++p,i.fetch(t,(function(n,o){--p,r&&(n?e?p||c(null,i):c(n):d(t,o))}))}var p=0;l.isString(e)&&(e=[e]);for(var v,m=0;m<e.length;++m)(v=i.resolvePath("",e[m]))&&f(v);return s?i:(p||c(null,i),undefined)},d.prototype.loadSync=function(t,e){if(!l.isNode)throw Error("not supported");return this.load(t,e,h)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(t){return"'extend "+t.extend+"' in "+t.parent.fullName})).join(", "));return r.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(t,e){var n=e.parent.lookup(e.extend);if(n){var r=new s(e.fullName,e.id,e.type,e.rule,undefined,e.options);return r.declaringField=e,e.extensionField=r,n.add(r),!0}return!1}d.prototype._handleAdd=function(t){if(t instanceof s)t.extend===undefined||t.extensionField||p(0,t)||this.deferred.push(t);else if(t instanceof c)f.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof u)){if(t instanceof i)for(var e=0;e<this.deferred.length;)p(0,this.deferred[e])?this.deferred.splice(e,1):++e;for(var n=0;n<t.nestedArray.length;++n)this._handleAdd(t._nestedArray[n]);f.test(t.name)&&(t.parent[t.name]=t)}},d.prototype._handleRemove=function(t){if(t instanceof s){if(t.extend!==undefined)if(t.extensionField)t.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var e=this.deferred.indexOf(t);e>-1&&this.deferred.splice(e,1)}}else if(t instanceof c)f.test(t.name)&&delete t.parent[t.name];else if(t instanceof r){for(var n=0;n<t.nestedArray.length;++n)this._handleRemove(t._nestedArray[n]);f.test(t.name)&&delete t.parent[t.name]}},d._configure=function(t,e,n){i=t,o=e,a=n}},{14:14,15:15,21:21,23:23,33:33}],27:[function(t,e,n){e.exports={}},{}],28:[function(t,e,n){n.Service=t(29)},{29:29}],29:[function(t,e,n){e.exports=i;var r=t(35);function i(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function t(e,n,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return r.asPromise(t,s,e,n,i,o);if(!s.rpcImpl)return setTimeout((function(){a(Error("already ended"))}),0),undefined;try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(t,n){if(t)return s.emit("error",t,e),a(t);if(null===n)return s.end(!0),undefined;if(!(n instanceof i))try{n=i[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),a(t)}return s.emit("data",n,e),a(null,n)}))}catch(t){return s.emit("error",t,e),setTimeout((function(){a(t)}),0),undefined}},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(t,e,n){e.exports=s;var r=t(21);((s.prototype=Object.create(r.prototype)).constructor=s).className="Service";var i=t(20),o=t(33),a=t(28);function s(t,e){r.call(this,t,e),this.methods={},this._methodsArray=null}function c(t){return t._methodsArray=null,t}s.fromJSON=function(t,e){var n=new s(t,e.options);if(e.methods)for(var r=Object.keys(e.methods),o=0;o<r.length;++o)n.add(i.fromJSON(r[o],e.methods[r[o]]));return e.nested&&n.addJSON(e.nested),n.comment=e.comment,n},s.prototype.toJSON=function(t){var e=r.prototype.toJSON.call(this,t),n=!!t&&Boolean(t.keepComments);return o.toObject(["options",e&&e.options||undefined,"methods",r.arrayToJSON(this.methodsArray,t)||{},"nested",e&&e.nested||undefined,"comment",n?this.comment:undefined])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),s.prototype.get=function(t){return this.methods[t]||r.prototype.get.call(this,t)},s.prototype.resolveAll=function(){for(var t=this.methodsArray,e=0;e<t.length;++e)t[e].resolve();return r.prototype.resolve.call(this)},s.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof i?(this.methods[t.name]=t,t.parent=this,c(this)):r.prototype.add.call(this,t)},s.prototype.remove=function(t){if(t instanceof i){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,c(this)}return r.prototype.remove.call(this,t)},s.prototype.create=function(t,e,n){for(var r,i=new a.Service(t,e,n),s=0;s<this.methodsArray.length;++s){var c=o.lcFirst((r=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},{20:20,21:21,28:28,33:33}],31:[function(t,e,n){e.exports=A;var r=t(21);((A.prototype=Object.create(r.prototype)).constructor=A).className="Type";var i=t(14),o=t(23),a=t(15),s=t(18),c=t(30),u=t(19),l=t(24),d=t(38),h=t(33),f=t(13),p=t(12),v=t(36),m=t(11),g=t(37);function A(t,e){r.call(this,t,e),this.fields={},this.oneofs=undefined,this.extensions=undefined,this.reserved=undefined,this.group=undefined,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function y(t){return t._fieldsById=t._fieldsArray=t._oneofsArray=null,delete t.encode,delete t.decode,delete t.verify,t}Object.defineProperties(A.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var t=Object.keys(this.fields),e=0;e<t.length;++e){var n=this.fields[t[e]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=A.generateConstructor(this)())},set:function(t){var e=t.prototype;e instanceof u||((t.prototype=new u).constructor=t,h.merge(t.prototype,e)),t.$type=t.prototype.$type=this,h.merge(t,u,!0),this._ctor=t;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:h.oneOfGetter(this._oneofsArray[n].oneof),set:h.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(t.prototype,r)}}}),A.generateConstructor=function(t){for(var e,n=h.codegen(["p"],t.name),r=0;r<t.fieldsArray.length;++r)(e=t._fieldsArray[r]).map?n("this%s={}",h.safeProp(e.name)):e.repeated&&n("this%s=[]",h.safeProp(e.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},A.fromJSON=function(t,e){var n=new A(t,e.options);n.extensions=e.extensions,n.reserved=e.reserved;for(var u=Object.keys(e.fields),l=0;l<u.length;++l)n.add((void 0!==e.fields[u[l]].keyType?s.fromJSON:a.fromJSON)(u[l],e.fields[u[l]]));if(e.oneofs)for(u=Object.keys(e.oneofs),l=0;l<u.length;++l)n.add(o.fromJSON(u[l],e.oneofs[u[l]]));if(e.nested)for(u=Object.keys(e.nested),l=0;l<u.length;++l){var d=e.nested[u[l]];n.add((d.id!==undefined?a.fromJSON:d.fields!==undefined?A.fromJSON:d.values!==undefined?i.fromJSON:d.methods!==undefined?c.fromJSON:r.fromJSON)(u[l],d))}return e.extensions&&e.extensions.length&&(n.extensions=e.extensions),e.reserved&&e.reserved.length&&(n.reserved=e.reserved),e.group&&(n.group=!0),e.comment&&(n.comment=e.comment),n},A.prototype.toJSON=function(t){var e=r.prototype.toJSON.call(this,t),n=!!t&&Boolean(t.keepComments);return h.toObject(["options",e&&e.options||undefined,"oneofs",r.arrayToJSON(this.oneofsArray,t),"fields",r.arrayToJSON(this.fieldsArray.filter((function(t){return!t.declaringField})),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"group",this.group||undefined,"nested",e&&e.nested||undefined,"comment",n?this.comment:undefined])},A.prototype.resolveAll=function(){for(var t=this.fieldsArray,e=0;e<t.length;)t[e++].resolve();var n=this.oneofsArray;for(e=0;e<n.length;)n[e++].resolve();return r.prototype.resolveAll.call(this)},A.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},A.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof a&&t.extend===undefined){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=this,t.onAdd(this),y(this)}return t instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(this),y(this)):r.prototype.add.call(this,t)},A.prototype.remove=function(t){if(t instanceof a&&t.extend===undefined){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(this),y(this)}if(t instanceof o){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),y(this)}return r.prototype.remove.call(this,t)},A.prototype.isReservedId=function(t){return r.isReservedId(this.reserved,t)},A.prototype.isReservedName=function(t){return r.isReservedName(this.reserved,t)},A.prototype.create=function(t){return new this.ctor(t)},A.prototype.setup=function(){for(var t=this.fullName,e=[],n=0;n<this.fieldsArray.length;++n)e.push(this._fieldsArray[n].resolve().resolvedType);this.encode=f(this)({Writer:d,types:e,util:h}),this.decode=p(this)({Reader:l,types:e,util:h}),this.verify=v(this)({types:e,util:h}),this.fromObject=m.fromObject(this)({types:e,util:h}),this.toObject=m.toObject(this)({types:e,util:h});var r=g[t];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},A.prototype.encode=function(t,e){return this.setup().encode(t,e)},A.prototype.encodeDelimited=function(t,e){return this.encode(t,e&&e.len?e.fork():e).ldelim()},A.prototype.decode=function(t,e){return this.setup().decode(t,e)},A.prototype.decodeDelimited=function(t){return t instanceof l||(t=l.create(t)),this.decode(t,t.uint32())},A.prototype.verify=function(t){return this.setup().verify(t)},A.prototype.fromObject=function(t){return this.setup().fromObject(t)},A.prototype.toObject=function(t,e){return this.setup().toObject(t,e)},A.d=function(t){return function(e){h.decorateType(e,t)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(t,e,n){var r=n,i=t(33),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(t,e){var n=0,r={};for(e|=0;n<t.length;)r[o[n+e]]=t[n++];return r}r.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=a([0,0,0,1,1],7),r.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(t,e,n){var r,i,o=e.exports=t(35),a=t(27);o.codegen=t(3),o.fetch=t(5),o.path=t(8),o.fs=o.inquire("fs"),o.toArray=function(t){if(t){for(var e=Object.keys(t),n=new Array(e.length),r=0;r<e.length;)n[r]=t[e[r++]];return n}return[]},o.toObject=function(t){for(var e={},n=0;n<t.length;){var r=t[n++],i=t[n++];i!==undefined&&(e[r]=i)}return e};var s=/\\/g,c=/"/g;o.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},o.safeProp=function(t){return!/^[$\w_]+$/.test(t)||o.isReserved(t)?'["'+t.replace(s,"\\\\").replace(c,'\\"')+'"]':"."+t},o.ucFirst=function(t){return t.charAt(0).toUpperCase()+t.substring(1)};var u=/_([a-z])/g;o.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(u,(function(t,e){return e.toUpperCase()}))},o.compareFieldsById=function(t,e){return t.id-e.id},o.decorateType=function(e,n){if(e.$type)return n&&e.$type.name!==n&&(o.decorateRoot.remove(e.$type),e.$type.name=n,o.decorateRoot.add(e.$type)),e.$type;r||(r=t(31));var i=new r(n||e.name);return o.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var l=0;o.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=t(14));var n=new i("Enum"+l++,e);return o.decorateRoot.add(n),Object.defineProperty(e,"$type",{value:n,enumerable:!1}),n},o.setProperty=function(t,e,n){if("object"!=typeof t)throw TypeError("dst must be an object");if(!e)throw TypeError("path must be specified");return function t(e,n,r){var i=n.shift();if(n.length>0)e[i]=t(e[i]||{},n,r);else{var o=e[i];o&&(r=[].concat(o).concat(r)),e[i]=r}return e}(t,e=e.split("."),n)},Object.defineProperty(o,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(t(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(t,e,n){e.exports=i;var r=t(35);function i(t,e){this.lo=t>>>0,this.hi=e>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return o;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(t){if("number"==typeof t)return i.fromNumber(t);if(r.isString(t)){if(!r.Long)return i.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new i(t.low>>>0,t.high>>>0):o},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var s=String.prototype.charCodeAt;i.fromHash=function(t){return t===a?o:new i((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},{35:35}],35:[function(t,e,n){var r=n;function i(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)t[r[i]]!==undefined&&n||(t[r[i]]=e[r[i]]);return t}function o(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}r.asPromise=t(1),r.base64=t(2),r.EventEmitter=t(4),r.float=t(6),r.inquire=t(7),r.utf8=t(10),r.pool=t(9),r.LongBits=t(34),r.isNode=Boolean(void 0!==global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"==typeof t||t instanceof String},r.isObject=function(t){return t&&"object"==typeof t},r.isset=r.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"==typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){var n=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},r.merge=i,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&this[t[n]]!==undefined&&null!==this[t[n]])return t[n]}},r.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},r._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(t,e,n){e.exports=function(t){var e=i.codegen(["m"],t.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n={};t.oneofsArray.length&&e("var p={}");for(var r=0;r<t.fieldsArray.length;++r){var c=t._fieldsArray[r].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)e("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),s(e,c,"k[i]"),a(e,c,r,u+"[k[i]]")("}");else if(c.repeated)e("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(e,c,r,u+"[i]")("}");else{if(c.partOf){var l=i.safeProp(c.partOf.name);1===n[c.partOf.name]&&e("if(p%s===1)",l)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,e("p%s=1",l)}a(e,c,r,u)}c.optional&&e("}")}return e("return null")};var r=t(14),i=t(33);function o(t,e){return t.name+": "+e+(t.repeated&&"array"!==e?"[]":t.map&&"object"!==e?"{k:"+t.keyType+"}":"")+" expected"}function a(t,e,n,i){if(e.resolvedType)if(e.resolvedType instanceof r){t("switch(%s){",i)("default:")("return%j",o(e,"enum value"));for(var a=Object.keys(e.resolvedType.values),s=0;s<a.length;++s)t("case %i:",e.resolvedType.values[a[s]]);t("break")("}")}else t("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.isInteger(%s))",i)("return%j",o(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",o(e,"integer|Long"));break;case"float":case"double":t('if(typeof %s!=="number")',i)("return%j",o(e,"number"));break;case"bool":t('if(typeof %s!=="boolean")',i)("return%j",o(e,"boolean"));break;case"string":t("if(!util.isString(%s))",i)("return%j",o(e,"string"));break;case"bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",o(e,"buffer"))}return t}function s(t,e,n){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.key32Re.test(%s))",n)("return%j",o(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.key64Re.test(%s))",n)("return%j",o(e,"integer|Long key"));break;case"bool":t("if(!util.key2Re.test(%s))",n)("return%j",o(e,"boolean key"))}return t}},{14:14,33:33}],37:[function(t,e,n){var r=n,i=t(19);r[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var e=t["@type"].substring(t["@type"].lastIndexOf("/")+1),n=this.lookup(e);if(n){var r="."===t["@type"].charAt(0)?t["@type"].substr(1):t["@type"];return-1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(t)).finish()})}}return this.fromObject(t)},toObject:function(t,e){var n="",r="";if(e&&e.json&&t.type_url&&t.value){r=t.type_url.substring(t.type_url.lastIndexOf("/")+1),n=t.type_url.substring(0,t.type_url.lastIndexOf("/")+1);var o=this.lookup(r);o&&(t=o.decode(t.value))}if(!(t instanceof this.ctor)&&t instanceof i){var a=t.$type.toObject(t,e);return""===n&&(n="type.googleapis.com/"),r=n+("."===t.$type.fullName[0]?t.$type.fullName.substr(1):t.$type.fullName),a["@type"]=r,a}return this.toObject(t,e)}}},{19:19}],38:[function(t,e,n){e.exports=d;var r,i=t(35),o=i.LongBits,a=i.base64,s=i.utf8;function c(t,e,n){this.fn=t,this.len=e,this.next=undefined,this.val=n}function u(){}function l(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var h=function(){return i.Buffer?function(){return(d.create=function(){return new r})()}:function(){return new d}};function f(t,e,n){e[n]=255&t}function p(t,e){this.len=t,this.next=undefined,this.val=e}function v(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function m(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}d.create=h(),d.alloc=function(t){return new i.Array(t)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(t,e,n){return this.tail=this.tail.next=new c(t,e,n),this.len+=e,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},d.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new p((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},d.prototype.int32=function(t){return t<0?this._push(v,10,o.fromNumber(t)):this.uint32(t)},d.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},d.prototype.uint64=function(t){var e=o.from(t);return this._push(v,e.length(),e)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(t){var e=o.from(t).zzEncode();return this._push(v,e.length(),e)},d.prototype.bool=function(t){return this._push(f,1,t?1:0)},d.prototype.fixed32=function(t){return this._push(m,4,t>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(t){var e=o.from(t);return this._push(m,4,e.lo)._push(m,4,e.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(t){return this._push(i.float.writeFloatLE,4,t)},d.prototype.double=function(t){return this._push(i.float.writeDoubleLE,8,t)};var g=i.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};d.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(f,1,0);if(i.isString(t)){var n=d.alloc(e=a.length(t));a.decode(t,n,0),t=n}return this.uint32(e)._push(g,e,t)},d.prototype.string=function(t){var e=s.length(t);return e?this.uint32(e)._push(s.write,e,t):this._push(f,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},d.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},d._configure=function(t){r=t,d.create=h(),r._configure()}},{35:35}],39:[function(t,e,n){e.exports=o;var r=t(38);(o.prototype=Object.create(r.prototype)).constructor=o;var i=t(35);function o(){r.call(this)}function a(t,e,n){t.length<40?i.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]}},o.prototype.bytes=function(t){i.isString(t)&&(t=i._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(o.writeBytesBuffer,e,t),this},o.prototype.string=function(t){var e=i.Buffer.byteLength(t);return this.uint32(e),e&&this._push(a,e,t),this},o._configure()},{35:35,38:38}]},{})}()}).call(this,__webpack_require__(57),__webpack_require__(58)(module))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function r(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function i(t){return!0===(t&&t.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=i;var o={},a={};function s(t,e){var n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=a[t])?r:(n=u(t,(0|t)<0?-1:0,!0),i&&(a[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=o[t])?r:(n=u(t,t<0?-1:0,!1),i&&(o[t]=n),n)}function c(t,e){if(isNaN(t))return e?A:g;if(e){if(t<0)return A;if(t>=p)return _}else{if(t<=-v)return S;if(t+1>=v)return E}return t<0?c(-t,e).neg():u(t%f|0,t/f|0,e)}function u(t,e,n){return new r(t,e,n)}r.fromInt=s,r.fromNumber=c,r.fromBits=u;var l=Math.pow;function d(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return g;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return d(t.substring(1),e,n).neg();for(var i=c(l(n,8)),o=g,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),u=parseInt(t.substring(a,a+s),n);if(s<8){var h=c(l(n,s));o=o.mul(h).add(c(u))}else o=(o=o.mul(i)).add(c(u))}return o.unsigned=e,o}function h(t,e){return"number"==typeof t?c(t,e):"string"==typeof t?d(t,e):u(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}r.fromString=d,r.fromValue=h;var f=4294967296,p=f*f,v=p/2,m=s(1<<24),g=s(0);r.ZERO=g;var A=s(0,!0);r.UZERO=A;var y=s(1);r.ONE=y;var b=s(1,!0);r.UONE=b;var w=s(-1);r.NEG_ONE=w;var E=u(-1,2147483647,!1);r.MAX_VALUE=E;var _=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=_;var S=u(0,-2147483648,!1);r.MIN_VALUE=S;var T=r.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var e=c(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=c(l(t,6),this.unsigned),o=this,a="";;){var s=o.div(i),u=(o.sub(s.mul(i)).toInt()>>>0).toString(t);if((o=s).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return i(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(t){return this.comp(t)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return this.comp(t)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(t){if(i(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(y)},T.neg=T.negate,T.add=function(t){i(t)||(t=h(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,a=t.high>>>16,s=65535&t.high,c=t.low>>>16,l=0,d=0,f=0,p=0;return f+=(p+=o+(65535&t.low))>>>16,d+=(f+=r+c)>>>16,l+=(d+=n+s)>>>16,l+=e+a,u((f&=65535)<<16|(p&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},T.subtract=function(t){return i(t)||(t=h(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){if(this.isZero())return g;if(i(t)||(t=h(t)),n)return u(n.mul(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned);if(t.isZero())return g;if(this.eq(S))return t.isOdd()?S:g;if(t.eq(S))return this.isOdd()?S:g;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return c(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,o=this.low>>>16,a=65535&this.low,s=t.high>>>16,l=65535&t.high,d=t.low>>>16,f=65535&t.low,p=0,v=0,A=0,y=0;return A+=(y+=a*f)>>>16,v+=(A+=o*f)>>>16,A&=65535,v+=(A+=a*d)>>>16,p+=(v+=r*f)>>>16,v&=65535,p+=(v+=o*d)>>>16,v&=65535,p+=(v+=a*l)>>>16,p+=e*f+r*d+o*l+a*s,u((A&=65535)<<16|(y&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(t){if(i(t)||(t=h(t)),t.isZero())throw Error("division by zero");var e,r,o;if(n)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?u((this.unsigned?n.div_u:n.div_s)(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?A:g;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return A;if(t.gt(this.shru(1)))return b;o=A}else{if(this.eq(S))return t.eq(y)||t.eq(w)?S:t.eq(S)?y:(e=this.shr(1).div(t).shl(1)).eq(g)?t.isNegative()?y:w:(r=this.sub(t.mul(e)),o=e.add(r.div(t)));if(t.eq(S))return this.unsigned?A:g;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=g}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(e)/Math.LN2),s=a<=48?1:l(2,a-48),d=c(e),f=d.mul(t);f.isNegative()||f.gt(r);)f=(d=c(e-=s,this.unsigned)).mul(t);d.isZero()&&(d=y),o=o.add(d),r=r.sub(f)}return o},T.div=T.divide,T.modulo=function(t){return i(t)||(t=h(t)),n?u((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return u(~this.low,~this.high,this.unsigned)},T.and=function(t){return i(t)||(t=h(t)),u(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return i(t)||(t=h(t)),u(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return i(t)||(t=h(t)),u(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):u(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return i(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?u(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):u(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){if(i(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?u(this.low>>>t|e<<32-t,e>>>t,this.unsigned):u(32===t?e:e>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},T.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},r.fromBytes=function(t,e,n){return n?r.fromBytesLE(t,e):r.fromBytesBE(t,e)},r.fromBytesLE=function(t,e){return new r(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},r.fromBytesBE=function(t,e){return new r(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(t){t.exports=JSON.parse('{"PeerPublishStatus":408,"JoinChannelTimeout":407,"OnUpdateStream":356,"OnRemoveStream":355,"OnAddVideoStream":353,"OnAddAudioStream":352,"FirstAudioDecode":351,"FirstVideoDecode":350,"FirstAudioReceived":349,"FirstVideoReceived":348,"ReqUserAccount":196,"ApiInvoke":41,"RequestProxyWorkerManager":36,"RequestProxyAppCenter":35,"VideoSendingStopped":34,"AudioSendingStopped":33,"StreamSwitch":32,"FirstFrame":31,"Publish":30,"Subscribe":29,"JoinGateway":28,"JoinChooseServer":27,"Session":26,"APWorkerEvent":160,"WorkerEvent":156,"JoinWebProxyAP":700,"WebSocketQuit":671}')},function(t){t.exports=JSON.parse('{"nested":{"protobuf":{"nested":{"Session":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"version":{"type":"string","id":11},"browser":{"type":"string","id":12},"appid":{"type":"string","id":13},"mode":{"type":"string","id":14},"extend":{"type":"string","id":15},"process":{"type":"string","id":16},"build":{"type":"string","id":17},"ipv6":{"type":"string","id":18},"sourceHost":{"type":"string","id":19},"sourcePath":{"type":"string","id":20},"collectorHost":{"type":"string","id":21},"collectorName":{"type":"string","id":22}}},"JoinChooseServer":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"chooseServerAddr":{"type":"string","id":11},"chooseServerAddrList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14}}},"JoinGateway":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"gatewayAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"firstSuccess":{"type":"bool","id":14}}},"Subscribe":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"video":{"type":"bool","id":16},"audio":{"type":"bool","id":17},"subscribeRequestid":{"type":"int32","id":18},"p2pid":{"type":"int32","id":19}}},"Publish":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"videoName":{"type":"string","id":16},"audioName":{"type":"string","id":17},"screenName":{"type":"string","id":18},"video":{"type":"bool","id":19},"audio":{"type":"bool","id":20},"publishRequestid":{"type":"int32","id":21},"p2pid":{"type":"int32","id":22},"screenshare":{"type":"bool","id":23}}},"FirstFrame":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"extend":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"width":{"type":"int64","id":13},"height":{"type":"int64","id":14}}},"StreamSwitch":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"isDual":{"type":"bool","id":11}}},"AudioSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"VideoSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"RequestProxyAppCenter":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"APAddr":{"type":"string","id":11},"workerManagerList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"extend":{"type":"string","id":15},"response":{"type":"string","id":16}}},"RequestProxyWorkerManager":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"workerManagerAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"extend":{"type":"string","id":14},"response":{"type":"string","id":15}}},"ApiInvoke":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"apiName":{"type":"string","id":9},"errorCode":{"type":"string","id":10},"options":{"type":"string","id":11},"execElapse":{"type":"int64","id":12},"execStates":{"type":"string","id":13},"execResult":{"type":"string","id":14},"invokeId":{"type":"int64","id":15}}},"ReqUserAccount":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"serverAddress":{"type":"string","id":10},"stringUid":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"extend":{"type":"string","id":13}}},"FirstVideoReceived":{"fields":{"lts":{"type":"int64","id":1},"peer":{"type":"int64","id":2},"elapse":{"type":"int64","id":3},"sid":{"type":"string","id":4},"cname":{"type":"string","id":5},"cid":{"type":"int64","id":6},"uid":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstAudioReceived":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstVideoDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"videowidth":{"type":"int32","id":9},"videoheight":{"type":"int32","id":10},"subscribeRequestid":{"type":"int32","id":11},"p2pid":{"type":"int32","id":12},"subscribeElapse":{"type":"int64","id":13}}},"FirstAudioDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"OnAddAudioStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnAddVideoStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnRemoveStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnUpdateStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"audio":{"type":"bool","id":8},"video":{"type":"bool","id":9}}},"JoinChannelTimeout":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"timeout":{"type":"int32","id":7}}},"PeerPublishStatus":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"peer":{"type":"int64","id":6},"elapse":{"type":"int64","id":7},"peerPublishDuration":{"type":"int64","id":8},"joinChannelSuccessElapse":{"type":"int64","id":9},"subscribeElapse":{"type":"int64","id":10},"audiotag":{"type":"int32","id":11},"videotag":{"type":"int32","id":12},"screensharetag":{"type":"int32","id":13},"firsttimetag":{"type":"int32","id":14}}},"WebSocketQuit":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"succ":{"type":"int32","id":7},"errorCode":{"type":"string","id":8},"ip":{"type":"string","id":9}}},"Message":{"fields":{"id":{"type":"int64","id":1},"msg":{"type":"bytes","id":2}}},"ProtoRaws":{"fields":{"sendTs":{"type":"int64","id":1},"payloads":{"rule":"repeated","type":"Message","id":2},"vid":{"type":"int32","id":3}}},"APWorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"ec":{"type":"int32","id":10},"sc":{"type":"int32","id":11},"serverIp":{"type":"string","id":12},"firstSuccess":{"type":"bool","id":13},"responseTime":{"type":"int32","id":14},"serviceName":{"type":"string","id":15},"responseDetail":{"type":"string","id":16}}},"WorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"command":{"type":"string","id":10},"actionType":{"type":"string","id":11},"url":{"type":"string","id":12},"payload":{"type":"string","id":13},"serverCode":{"type":"int32","id":14},"code":{"type":"int32","id":15},"traceId":{"type":"string","id":16},"workerType":{"type":"int32","id":17},"responseTime":{"type":"int32","id":18},"requestId":{"type":"int64","id":19},"packIndex":{"type":"int32","id":20},"requestByUser":{"type":"bool","id":21},"tid":{"type":"string","id":22}}},"JoinWebProxyAP":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"sucess":{"type":"int32","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"apServerAddr":{"type":"string","id":10},"turnServerAddrList":{"type":"string","id":11},"errorCode":{"type":"string","id":12}}}}}}}')},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n,r){var i=e&&e.prototype instanceof l?e:l,o=Object.create(i.prototype),a=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=y(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var u={};function l(){}function d(){}function h(){}var f={};f[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(_([])));v&&v!==e&&n.call(v,i)&&(f=v);var m=h.prototype=l.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function A(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(d).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function y(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,y(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=m.constructor=h,h.constructor=d,h[a]=d.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(A.prototype),A.prototype[o]=function(){return this},t.AsyncIterator=A,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new A(s(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),m[a]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),w(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="object"==typeof window&&window.RTCPeerConnection,i="object"==typeof window&&window.webkitRTCPeerConnection,o="object"==typeof window&&window.mozRTCPeerConnection;e.createRTCPeerConnection=function(t){var e=r||i||o;return e?new e(t):null}},function(t,e,n){var r;
/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */!function(e){"use strict";function i(){}var o=i.prototype,a=e.EventEmitter;function s(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1}function c(t){return function(){return this[t].apply(this,arguments)}}o.getListeners=function(t){var e,n,r=this._getEvents();if(t instanceof RegExp)for(n in e={},r)r.hasOwnProperty(n)&&t.test(n)&&(e[n]=r[n]);else e=r[t]||(r[t]=[]);return e},o.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},o.getListenersAsObject=function(t){var e,n=this.getListeners(t);return n instanceof Array&&((e={})[t]=n),e||n},o.addListener=function(t,e){if(!function t(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&t(e.listener)}(e))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(t),i="object"==typeof e;for(n in r)r.hasOwnProperty(n)&&-1===s(r[n],e)&&r[n].push(i?e:{listener:e,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(t){return this.getListeners(t),this},o.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},o.removeListener=function(t,e){var n,r,i=this.getListenersAsObject(t);for(r in i)i.hasOwnProperty(r)&&-1!==(n=s(i[r],e))&&i[r].splice(n,1);return this},o.off=c("removeListener"),o.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},o.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},o.manipulateListeners=function(t,e,n){var r,i,o=t?this.removeListener:this.addListener,a=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(r=n.length;r--;)o.call(this,e,n[r]);else for(r in e)e.hasOwnProperty(r)&&(i=e[r])&&("function"==typeof i?o.call(this,r,i):a.call(this,r,i));return this},o.removeEvent=function(t){var e,n=typeof t,r=this._getEvents();if("string"===n)delete r[t];else if(t instanceof RegExp)for(e in r)r.hasOwnProperty(e)&&t.test(e)&&delete r[e];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(t,e){var n,r,i,o,a=this.getListenersAsObject(t);for(o in a)if(a.hasOwnProperty(o))for(n=a[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(t,r.listener),r.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,r.listener);return this},o.trigger=c("emitEvent"),o.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},o.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return e.EventEmitter=a,i},void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r)}("undefined"!=typeof window?window:this||{})},function(t,e,n){var r=n(32);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(72),c=n(27),u=n(91),l=n(20),d=n(24),h=n(29),f=a(n(0)),p=a(n(34)),v=function(){function t(t){this.retryTimeout=1e4,this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.taskMutex=new u.PromiseMutex("LS"),this.cancelToken=p.default.CancelToken.source(),this.injectConfig=r({},c.DEFAULT_INJECT_CONFIG),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Map,this.spec=t}return Object.defineProperty(t.prototype,"isNeedReset",{get:function(){for(var t=this,e=0,n=Array.from(this.streamingTasks.values());e<n.length;e++){var r=n[e];if(r.mode===c.LiveStreamingServiceMode.INJECT)return!0;if(r.mode===c.LiveStreamingServiceMode.TRANSCODE&&(this.transcodingConfig&&(this.transcodingConfig.userConfigs||this.transcodingConfig.transcodingUsers)||[]).find((function(e){return e.uid===t.spec.uid})))return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.setTranscodingConfig=function(t){return i(this,void 0,void 0,(function(){var e,n,i,a,s,u=this;return o(this,(function(o){switch(o.label){case 0:(e=r(r({},c.DEFAULT_TRANSCODING_CONFIG),t)).transcodingUsers||(e.transcodingUsers=e.userConfigs),66!==e.videoCodecProfile&&77!==e.videoCodecProfile&&100!==e.videoCodecProfile&&(f.default.debug("["+this.spec.clientId+"] set transcoding config, fix video codec profile: "+e.videoCodecProfile+" -> 100"),e.videoCodecProfile=100),e.transcodingUsers&&(e.transcodingUsers=e.transcodingUsers.map((function(t){return r(r(r({},c.DEFAULT_LIVE_STREAMING_TRANSCODING_USER),t),{zOrder:t.zOrder?t.zOrder+1:1})}))),e.images&&(e.images=e.images.map((function(t){return r(r({},c.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK),t)})));try{c.isLiveStreamingTranscodingConfig(e)}catch(t){throw t}return e.transcodingUsers&&(e.userConfigs=e.transcodingUsers.map((function(t){return r({},t)})),e.userCount=e.transcodingUsers.length,delete e.transcodingUsers),n=(e.userConfigs||[]).map((function(t){return"number"==typeof t.uid?Promise.resolve(t.uid):l.getUserAccount(u.spec,null,t.uid)})),[4,this.taskMutex.lock()];case 1:return i=o.sent(),[4,Promise.all(n)];case 2:if(o.sent().forEach((function(t,n){e.userConfigs&&e.userConfigs[n]&&(e.userConfigs[n].uid=t&&t.uid||t)})),this.transcodingConfig=e,!this.connection)return i(),[2];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(this.streamingTasks.values()).map((function(t){return t.taskId})).join("#")})];case 4:return a=o.sent(),i(),f.default.debug("["+this.spec.clientId+"] update live transcoding config success, code: "+a.code+", config:",JSON.stringify(this.transcodingConfig)),[3,6];case 5:if(s=o.sent(),i(),!s.data||!s.data.retry)throw s;return s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((function(t){f.default.warning("["+u.spec.clientId+"] live streaming receive error",s.toString(),"try to republish",t.url),u.startLiveStreamingTask(t.url,t.mode,s).then((function(){f.default.debug("["+u.spec.clientId+"] live streaming republish "+t.url+" success")})).catch((function(e){f.default.error("["+u.spec.clientId+"] live streaming republish failed",t.url,e.toString()),u.onLiveStreamError&&u.onLiveStreamError(t.url,e)}))})),[3,6];case 6:return[2]}}))}))},t.prototype.setInjectStreamConfig=function(t,e){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=e},t.prototype.startLiveStreamingTask=function(t,e,n){return i(this,void 0,void 0,(function(){var i,a,s,u,l,p,v,m,g=this;return o(this,(function(o){switch(o.label){case 0:return Array.from(this.streamingTasks.values()).find((function(t){return t.mode===c.LiveStreamingServiceMode.INJECT}))&&e===c.LiveStreamingServiceMode.INJECT?[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw()]:(i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:30},f.default.debug("["+this.spec.clientId+"] start live streaming "+t+", mode: "+e),[4,this.taskMutex.lock()]);case 1:if(a=o.sent(),!this.transcodingConfig&&e===c.LiveStreamingServiceMode.TRANSCODE)throw a(),new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(!this.connection&&n)return a(),[2];if(this.streamingTasks.get(t)&&!n)return a(),[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw()];if(!this.transcodingConfig&&e===c.LiveStreamingServiceMode.TRANSCODE)throw a(),new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");o.label=2;case 2:return o.trys.push([2,5,,6]),this.connection?[3,4]:(s=this,[4,this.connect(e)]);case 3:s.connection=o.sent(),o.label=4;case 4:return[3,6];case 5:throw u=o.sent(),a(),u;case 6:switch(e){case c.LiveStreamingServiceMode.TRANSCODE:i.transcodingConfig=r({},this.transcodingConfig);break;case c.LiveStreamingServiceMode.RAW:break;case c.LiveStreamingServiceMode.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,l=this.lastTaskId++,o.label=7;case 7:return o.trys.push([7,9,,14]),p=new Promise((function(e,r){h.wait(g.retryTimeout).then((function(){if(n)return r(n);var e=g.statusError.get(t);return e?(g.statusError.delete(t),r(e)):void 0}))})),[4,Promise.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:e===c.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!n,tid:l.toString()}),p])];case 8:return v=o.sent(),this.isStartingStreamingTask=!1,f.default.debug("["+this.spec.clientId+"] live streaming started, code: "+v.code),this.streamingTasks.set(t,{clientRequest:i,mode:e,url:t,taskId:l}),a(),[3,14];case 9:if(m=o.sent(),a(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||n)throw m;return m.data.changeAddress?[3,11]:[4,this.startLiveStreamingTask(t,e,m)];case 10:return[2,o.sent()];case 11:return this.connection.tryNextAddress(),[4,this.startLiveStreamingTask(t,e,m)];case 12:return[2,o.sent()];case 13:return[3,14];case 14:return[2]}}))}))},t.prototype.stopLiveStreamingTask=function(t){var e=this;return new Promise((function(n,r){var i=e.streamingTasks.get(t);if(!i||!e.connection)return new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var o=i.mode;i.abortTask=function(){f.default.debug("["+e.spec.clientId+"] stop live streaming success(worker exception)"),e.streamingTasks.delete(t),n()},f.default.debug("stop live streaming task request: "+JSON.stringify(t)),e.connection.request("request",{clientRequest:{command:o===c.LiveStreamingServiceMode.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:o===c.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!0,tid:(e.lastTaskId++).toString()}).then((function(r){f.default.debug("["+e.spec.clientId+"] stop live streaming success, code: "+r.code),e.streamingTasks.delete(t),0===e.streamingTasks.size&&o!==c.LiveStreamingServiceMode.INJECT&&(e.connection.close(),e.connection=void 0),n()})).catch(r)}))},t.prototype.controlInjectStream=function(t,e,n,r){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:if(!(i=this.streamingTasks.get(t))||!this.connection||i.mode!==c.LiveStreamingServiceMode.INJECT)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"can not find inject stream task to control");return[4,this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:e,audioVolume:n,position:r}})];case 1:return[2,o.sent().serverResponse]}}))}))},t.prototype.resetAllTask=function(){var t=this,e=Array.from(this.streamingTasks.values());this.terminate();for(var n=function(e){r.startLiveStreamingTask(e.url,e.mode).catch((function(n){t.onLiveStreamError&&t.onLiveStreamError(e.url,n)}))},r=this,i=0,o=e;i<o.length;i++)n(o[i])},t.prototype.setGatewayConnectionState=function(t){this.connection&&(this.connection.gatewayConnectionState=t)},t.prototype.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=p.default.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},t.prototype.connect=function(t){return i(this,void 0,void 0,(function(){var e,n=this;return o(this,(function(r){switch(r.label){case 0:if(this.connection)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"live streaming connection has already connected");return[4,h.getLiveStreamingWorkerMangerResult(t,this.spec,this.cancelToken.token)];case 1:return e=r.sent(),this.uapResponse=e,this.connection=new s.AgoraLiveStreamingUapSignal(e.workerToken,this.spec,t),this.connection.on(c.LiveStreamingUapSignalEvents.WARNING,(function(t,e){return n.onLiveStreamWarning&&n.onLiveStreamWarning(e,t)})),this.connection.on(c.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,(function(t){return n.handlePublishStreamServer(t)})),this.connection.on(c.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,(function(t){return n.handleInjectStreamServerStatus(t)})),this.connection.on(c.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS,(function(e,r){if(!n.connection)return r(new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not get new live streaming address list"));h.getLiveStreamingWorkerMangerResult(t,n.spec,n.cancelToken.token).then((function(t){n.uapResponse=t,e(t.addressList)})).catch(r)})),[4,this.connection.init(e.addressList)];case 2:return r.sent(),[2,this.connection]}}))}))},t.prototype.handlePublishStreamServer=function(t){var e=this,n=t.serverStatus&&t.serverStatus.url;if(!n)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"empty url",{code:t.code});var r=this.streamingTasks.get(n);switch(t.code){case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var i=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return f.default.error(i.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,i);if(!this.isStartingStreamingTask)return;this.statusError.set(n,i);case c.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case c.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(!this.connection||0===this.streamingTasks.size)return;this.connection.tryNextAddress();for(var o=Array.from(this.streamingTasks.values()),a=function(n){if(n.abortTask)return n.abortTask(),"continue";f.default.warning("["+s.spec.clientId+"] publish stream status code",t.code,"try to republish",n.url),s.startLiveStreamingTask(n.url,n.mode,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((function(){f.default.debug("["+e.spec.clientId+"] republish live stream success",n.url)})).catch((function(t){f.default.error(t.toString()),e.onLiveStreamError&&e.onLiveStreamError(n.url,t)}))},s=this,u=0,l=o;u<l.length;u++)a(l[u]);return}},t.prototype.handleInjectStreamServerStatus=function(t){var e=Number(t.uid),n=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,e,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,e,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,e,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,e,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,e,n),void this.streamingTasks.delete(n);default:return void f.default.debug("inject stream server status",t)}},t.prototype.haveUrl=function(t){return this.streamingTasks.has(t)||void 0},t}();e.AgoraRTCLiveStreamingClient=v},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(27),l=n(73),d=n(33),h=n(24),f=n(3),p=c(n(0)),v=n(1),m=n(29),g=function(t){function e(e,n,r){var i=t.call(this)||this;return i._gatewayConnectionState="CONNECTED",i.reconnectMode="retry",i.reqId=0,i.commandReqId=0,i.waitingResponseList=[],i.handleWebSocketOpen=function(){i.reconnectMode="retry",i.startPingPong()},i.handleWebSocketMessage=function(t){if(t.data){var e=JSON.parse(t.data);if(e.requestId)i.emit("@"+e.requestId,e);else if(i.serviceMode===u.LiveStreamingServiceMode.INJECT)i.emit(u.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,e);else{v.report.requestWorkerEvent(i.spec.sid,{actionType:"status",serverCode:e.code,workerType:i.serviceMode===u.LiveStreamingServiceMode.TRANSCODE?1:2});var n=e.serverStatus&&e.serverStatus.url;n&&i.waitingResponseList.includes(n)&&200===e.code&&i.emit(n),i.emit(u.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,e)}}},i.spec=n,i.token=e,i.serviceMode=r,i.websocket=new l.AgoraWebSocketManager("live-streaming"),i.websocket.on(u.WebSocketManagerEvents.CONNECTED,i.handleWebSocketOpen),i.websocket.on(u.WebSocketManagerEvents.ON_MESSAGE,i.handleWebSocketMessage),i.websocket.on(u.WebSocketManagerEvents.REQUEST_NEW_URLS,(function(t,e){d.emitAsPromise(i,u.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS).then(t).catch(e)})),i.websocket.on(u.WebSocketManagerEvents.RECONNECTING,(function(){i.websocket.reconnectMode=i.reconnectMode})),i}return i(e,t),Object.defineProperty(e.prototype,"gatewayConnectionState",{get:function(){return this._gatewayConnectionState},set:function(t){this._gatewayConnectionState=t,"CONNECTED"===t&&this.emit("gateway-connected",t)},enumerable:!0,configurable:!0}),e.prototype.init=function(t){return this.websocket.init(t)},e.prototype.request=function(t,e,n,r){return a(this,void 0,void 0,(function(){var i,a,c,l,d,p,g,A,y,b,w=this;return s(this,(function(s){switch(s.label){case 0:if(this.reqId+=1,i=this.reqId,"request"===t&&(this.commandReqId+=1),a=this.commandReqId,!i||!this.websocket)throw new h.AgoraRTCError(h.AgoraRTCErrorCode.UNEXPECTED_ERROR);if(c=f.VERSION,"closed"===this.websocket.state)throw new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_DISCONNECT);return l=function(){return new Promise((function(t,e){var n=function(){"CONNECTED"===w.gatewayConnectionState&&"connected"===w.websocket.state&&(w.off("gateway-connected",n),w.websocket.off(u.WebSocketManagerEvents.CONNECTED,n),t(void 0))};w.on("gateway-connected",n),w.websocket.once(u.WebSocketManagerEvents.CLOSED,(function(){return e(new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_ABORT))})),w.websocket.on(u.WebSocketManagerEvents.CONNECTED,n)}))},"connected"===this.websocket.state&&"CONNECTED"===this.gatewayConnectionState?[3,2]:[4,l()];case 1:s.sent(),s.label=2;case 2:d=Promise.race([new Promise((function(t,e){var n=function(){e(new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_ABORT))};w.websocket.once(u.WebSocketManagerEvents.RECONNECTING,n),w.websocket.once(u.WebSocketManagerEvents.CLOSED,n),w.once("@"+i,(function(e){t(e)}))})),m.wait(f.getParameter("LIVE_STREAMING_TIMEOUT")).then((function(){return!1}))]),(p=o({command:t,sdkVersion:c,seq:i,requestId:i,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},e)).clientRequest&&(p.clientRequest.workerToken=this.token),r&&v.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"request",payload:JSON.stringify(e.clientRequest),serverCode:0,code:0})),g=Date.now(),this.websocket.sendMessage(p),A=null,s.label=3;case 3:return s.trys.push([3,5,,8]),[4,d];case 4:return A=s.sent(),[3,8];case 5:if(y=s.sent(),"closed"===this.websocket.state)throw y;return[4,l()];case 6:return s.sent(),[4,this.request(t,e,n,r)];case 7:return[2,s.sent()];case 8:if(!1===A)throw b=new h.AgoraRTCError(h.AgoraRTCErrorCode.NETWORK_TIMEOUT,(e&&e.clientRequest&&e.clientRequest.command)+" timeout",{changeAddress:!0,retry:!0}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,b,r&&r.url||"unknown url"),r&&v.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"response",payload:"TIMEOUT",serverCode:0,success:0,responseTime:Date.now()-g})),b;return r&&v.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"response",payload:JSON.stringify(A.serverResponse),serverCode:A.code,success:200===A.code,responseTime:Date.now()-g})),200===A.code?[3,10]:[4,this.handleResponseError(A)];case 9:s.sent(),s.label=10;case 10:return[2,A]}}))}))},e.prototype.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},e.prototype.close=function(){var t="__VERSION__"===f.VERSION?"0.0.1":f.VERSION;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},e.prototype.handleResponseError=function(t){return a(this,void 0,void 0,(function(){var e,n,r,i,o=this;return s(this,(function(a){switch(p.default.debug("[live-streaming] receive response error "+t.code),t.code){case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return p.default.warning("live stream response already exists stream"),e=t.serverResponse.url,this.emit(u.LiveStreamingUapSignalEvents.WARNING,"live stream response already exists stream, code 454",e),this.waitingResponseList.includes(e)||this.waitingResponseList.push(e),[2,new Promise((function(n,r){o.once(e,(function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(e),1),n()})),setTimeout((function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(e),1),r(new h.AgoraRTCError(h.AgoraRTCErrorCode.TIMEOUT,"live stream timeout waiting 454",{code:t.code}))}),1e4)}))];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_BAD_STREAM:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return[2];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FREQUENT_REQUEST),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,t.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return[2];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return[2];if("UpdateTranscoding"===t.serverResponse.command||"ControlStream"===t.serverResponse.command)return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw()];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return r=t.serverResponse.url,this.waitingResponseList.includes(r)||this.waitingResponseList.push(r),i=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,i,r),[2,new Promise((function(t,e){o.once(r,(function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(r),1),t()})),setTimeout((function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(r),1),e(i)}),1e4)}))]}return[2]}))}))},e.prototype.startPingPong=function(){var t=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((function(){"connected"===t.websocket.state&&t.request("ping",{}).catch((function(){}))}),6e3)},e}(d.EventEmitter);e.AgoraLiveStreamingUapSignal=g},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=n(24),u=n(33),l=n(29),d=n(27),h=s(n(0)),f=function(t){function e(e){var n=t.call(this)||this;return n.connectionID=0,n.currentURLIndex=0,n.reconnectMode="tryNext",n._state="closed",n.retryConfig=l.DEFAULT_RETRY_CONFIG,n.reconnectCount=0,n.name=e,n}return i(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this.websocket?this.websocket.url:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){t!==this._state&&(this._state=t,"reconnecting"===this._state?this.emit(d.WebSocketManagerEvents.RECONNECTING,this.reconnectMode):"connected"===this._state?this.emit(d.WebSocketManagerEvents.CONNECTED):"closed"===this._state?this.emit(d.WebSocketManagerEvents.CLOSED):"failed"===this._state&&this.emit(d.WebSocketManagerEvents.FAILED))},enumerable:!0,configurable:!0}),e.prototype.init=function(t){var e=this;return new Promise((function(n,r){e.urls=t;var i=e.urls[e.currentURLIndex];e.state="connecting",e.createWebSocketConnection(i).then(n).catch(r),e.once(d.WebSocketManagerEvents.CLOSED,(function(){return r(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT))})),e.once(d.WebSocketManagerEvents.CONNECTED,(function(){return n()}))}))},e.prototype.close=function(t,e){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var n=this.websocket;e?setTimeout((function(){return n.close()}),500):n.close(),this.websocket=void 0}this.state=t?"failed":"closed"},e.prototype.reconnect=function(t){if(this.websocket){void 0!==t&&(this.reconnectMode=t);var e=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),e&&e.bind(this.websocket)({code:9999})}else h.default.warning("["+this.name+"] can not reconnect, no websocket")},e.prototype.sendMessage=function(t){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ABORT,"websocket is not ready");var e=JSON.stringify(t);try{this.websocket.send(e)}catch(t){throw new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ERR,"send websocket message error"+t.toString())}},e.prototype.createWebSocketConnection=function(t){return o(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){return this.connectionID+=1,e=this.connectionID,[2,new Promise((function(r,i){n.websocket&&(n.websocket.onclose=null,n.websocket.close()),h.default.debug("["+n.name+"] start connect, url: "+t);try{n.websocket=new WebSocket(t),n.websocket.binaryType="arraybuffer"}catch(t){var s=new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ERR,"init websocket failed! Error: "+t.toString());return h.default.error("["+n.name+"]"+s),void i(s)}l.wait(5e3).then((function(){e===n.connectionID&&n.websocket&&n.websocket.readyState!==WebSocket.OPEN&&n.websocket&&n.websocket.close()})),n.websocket.onopen=function(){h.default.debug("["+n.name+"] websockect opened:",t),n.reconnectMode="retry",n.state="connected",n.reconnectCount=0,r()},n.websocket.onclose=function(t){return o(n,void 0,void 0,(function(){var e,n;return a(this,(function(o){switch(o.label){case 0:return h.default.debug("["+this.name+"] websocket close "+(this.websocket&&this.websocket.url)+", code: "+t.code+", reason: "+t.reason+", current mode: "+this.reconnectMode),this.reconnectCount<this.retryConfig.maxRetryCount?("connected"===this.state&&(this.state="reconnecting"),e=u.emitAsInvokerNoResponse(this,d.WebSocketManagerEvents.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,[4,this.reconnectWithAction(e)]):[3,2];case 1:return n=o.sent(),"closed"===this.state?(h.default.debug("["+this.connectionID+"] ws is closed, no need to reconnect"),[2]):n?(r(),[3,3]):(i(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT,"websocket reconnect failed: "+t.code)),this.close(!0),[2]);case 2:i(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT,"websocket close: "+t.code)),this.close(),o.label=3;case 3:return[2]}}))}))},n.websocket.onmessage=function(t){n.emit(d.WebSocketManagerEvents.ON_MESSAGE,t)}}))]}))}))},e.prototype.reconnectWithAction=function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(a){switch(a.label){case 0:return!e&&this.reconnectCount>=this.retryConfig.maxRetryCount?[2,!1]:this.urls?"closed"===this.state?[2,!1]:(n=l.getRetryWaitTime(this.reconnectCount,this.retryConfig),h.default.debug("["+this.name+"] wait "+n+"ms to reconnect websocket, mode: "+t),[4,l.wait(n)]):[2,!1];case 1:if(a.sent(),"closed"===this.state)return[2,!1];this.reconnectCount+=1,a.label=2;case 2:return a.trys.push([2,12,,14]),"retry"!==t?[3,4]:(i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)]);case 3:return a.sent(),[3,11];case 4:return"tryNext"!==t?[3,8]:(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length?[4,this.reconnectWithAction("recover")]:[3,6]);case 5:return[2,a.sent()];case 6:return h.default.debug("["+this.name+"] websocket url length: "+this.urls.length+" current index: "+this.currentURLIndex),i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)];case 7:return a.sent(),[3,11];case 8:return"recover"!==t?[3,11]:(h.default.debug("["+this.name+"] request new urls"),r=this,[4,u.emitAsPromise(this,d.WebSocketManagerEvents.REQUEST_NEW_URLS)]);case 9:return r.urls=a.sent(),this.currentURLIndex=0,i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)];case 10:a.sent(),a.label=11;case 11:return[2,!0];case 12:return o=a.sent(),h.default.error("["+this.name+"] reconnect failed",o.toString()),[4,this.reconnectWithAction(t)];case 13:return[2,a.sent()];case 14:return[2]}}))}))},e}(u.EventEmitter);e.AgoraWebSocketManager=f},function(t,e,n){"use strict";var r=n(18),i=n(35),o=n(75),a=n(41);function s(t){var e=new o(t),n=i(o.prototype.request,e);return r.extend(n,o.prototype,e),r.extend(n,e),n}var c=s(n(38));c.Axios=o,c.create=function(t){return s(a(c.defaults,t))},c.Cancel=n(42),c.CancelToken=n(89),c.isCancel=n(37),c.all=function(t){return Promise.all(t)},c.spread=n(90),t.exports=c,t.exports.default=c},function(t,e,n){"use strict";var r=n(18),i=n(36),o=n(76),a=n(77),s=n(41);function c(t){this.defaults=t,this.interceptors={request:new o,response:new o}}c.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=s(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=[a,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)n=n.then(e.shift(),e.shift());return n},c.prototype.getUri=function(t){return t=s(this.defaults,t),i(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(t){c.prototype[t]=function(e,n){return this.request(r.merge(n||{},{method:t,url:e}))}})),r.forEach(["post","put","patch"],(function(t){c.prototype[t]=function(e,n,i){return this.request(r.merge(i||{},{method:t,url:e,data:n}))}})),t.exports=c},function(t,e,n){"use strict";var r=n(18);function i(){this.handlers=[]}i.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},i.prototype.forEach=function(t){r.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=i},function(t,e,n){"use strict";var r=n(18),i=n(78),o=n(37),a=n(38);function s(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return s(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||a.adapter)(t).then((function(e){return s(t),e.data=i(e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(s(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},function(t,e,n){"use strict";var r=n(18);t.exports=function(t,e,n){return r.forEach(n,(function(n){t=n(t,e)})),t}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var t=s(h);l=!0;for(var e=u.length;e;){for(c=u,u=[];++d<e;)c&&c[d].run();d=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";var r=n(18);t.exports=function(t,e){r.forEach(t,(function(n,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[r])}))}},function(t,e,n){"use strict";var r=n(40);t.exports=function(t,e,n){var i=n.config.validateStatus;!i||i(n.status)?t(n):e(r("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(t,e,n){"use strict";t.exports=function(t,e,n,r,i){return t.config=e,n&&(t.code=n),t.request=r,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}},function(t,e,n){"use strict";var r=n(84),i=n(85);t.exports=function(t,e){return t&&!r(e)?i(t,e):e}},function(t,e,n){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,n){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,n){"use strict";var r=n(18),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,n,o,a={};return t?(r.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=r.trim(t.substr(0,o)).toLowerCase(),n=r.trim(t.substr(o+1)),e){if(a[e]&&i.indexOf(e)>=0)return;a[e]="set-cookie"===e?(a[e]?a[e]:[]).concat([n]):a[e]?a[e]+", "+n:n}})),a):a}},function(t,e,n){"use strict";var r=n(18);t.exports=r.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(t){var r=t;return e&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=i(window.location.href),function(e){var n=r.isString(e)?i(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}},function(t,e,n){"use strict";var r=n(18);t.exports=r.isStandardBrowserEnv()?{write:function(t,e,n,i,o,a){var s=[];s.push(t+"="+encodeURIComponent(e)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,n){"use strict";var r=n(42);function i(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var n=this;t((function(t){n.reason||(n.reason=new r(t),e(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var t;return{token:new i((function(e){t=e})),cancel:t}},t.exports=i},function(t,e,n){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=1,a=function(){function t(t){this.lockingPromise=Promise.resolve(),this.locks=0,this.name="",this.lockId=o++,t&&(this.name=t),i.default.debug("[lock-"+this.name+"-"+this.lockId+"] is created.")}return Object.defineProperty(t.prototype,"isLocked",{get:function(){return this.locks>0},enumerable:!0,configurable:!0}),t.prototype.lock=function(){var t,e=this;this.locks+=1,i.default.debug("[lock-"+this.name+"-"+this.lockId+"] is locked, current queue "+this.locks+".");var n=new Promise((function(n){t=function(){e.locks-=1,i.default.debug("[lock-"+e.name+"-"+e.lockId+"] is not locked, current queue "+e.locks+"."),n()}})),r=this.lockingPromise.then((function(){return t}));return this.lockingPromise=this.lockingPromise.then((function(){return n})),r},t}();e.PromiseMutex=a},function(t,e,n){"use strict";n.r(e);var r=n(3),i=n(0),o=n(1),a=n(8),s=n(4),c=function(){};c.prototype.set=function(t,e){["BatteryLevel"].indexOf(t)>-1&&(this[t]=e)};var u=new function(){var t=Object(a.b)();return t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.batteryManager=null,t._init=function(e,n){t.state=t.states.INITING,navigator.getBattery?navigator.getBattery().then((function(n){t.batteryManager=n,e&&setTimeout((function(){e()}),0)})).catch((function(t){i.default.debug("navigator.getBattery is disabled",t),e&&e()})):(t.state=t.states.INITED,e&&e())},t._getBatteryStats=function(){var e={};return t.batteryManager&&t.batteryManager.level?e.BatteryLevel=Math.floor(100*t.batteryManager.level):e.BatteryLevel="UNSUPPORTED",e},t.getStats=function(e,n){var r=new c,i=t._getBatteryStats();i&&i.BatteryLevel&&r.set("BatteryLevel",i.BatteryLevel),e&&e(r)},t._init(),t},l=n(22),d=n(19),h=n(26),f=n(50),p=n(9),v=["live","rtc","web","interop","h264_interop","web-only"],m=["vp8","vp9","h264"],g=["aes-128-gcm","aes-256-gcm","aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb"],A=n(11),y=n.n(A),b=n(7),w=n.n(b),E=n(12),_=n(5),S=n(10),T=n(20),C=n(6),x=n(14),R={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},I={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},O=function(t){var e={remoteStreamStorage:{},localStreamStorage:{}};return e.gatewayClient=t,e.checkAudioOutputLevel=function(t){return!(t&&parseInt(t.audioRecvBytesDelta)>0&&parseInt(t.audioDecodingNormalDelta)>0&&0===parseInt(t.audioOutputLevel))},e.checkAudioIntputLevel=function(t){return!t||0!==parseInt(t.audioInputLevel)},e.checkFramerateInput=function(t,e){if(!t||!e.attributes)return!0;var n=parseInt(e.attributes.maxFrameRate),r=parseInt(t.googFrameRateInput);return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)},e.checkFramerateSent=function(t){return!(t&&parseInt(t.googFrameRateInput)>5&&parseInt(t.googFrameRateSent)<=1)},e.checkSendVideoBitrate=function(t){return!t||0!==parseInt(t.videoSendBytesDelta)},e.checkSendAudioBitrate=function(t){return!t||0!==parseInt(t.audioSendBytesDelta)},e.checkVideoDecode=function(t){return!t||0===parseInt(t.videoRecvBytesDelta)||0!==parseInt(t.googFrameRateDecoded)},e.checkAudioDecode=function(t){return!t||0===parseInt(t.audioRecvBytesDelta)||0!==parseInt(t.audioDecodingNormalDelta)},e.record=function(t,n,r,i,o){r[t]||(r[t]={isPrevNormal:!0,record:[]});var a=r[t],s=e["check"+t](n,o);if(a.record.push(s),a.record.length>=5){a.isCurNormal=-1!==a.record.indexOf(!0);var c=I[t];a.isPrevNormal&&!a.isCurNormal&&e.gatewayClient.dispatchEvent({type:"exception",code:c,msg:R[c],uid:i}),!a.isPrevNormal&&a.isCurNormal&&e.gatewayClient.dispatchEvent({type:"exception",code:c+2e3,msg:R[c+2e3],uid:i}),a.isPrevNormal=a.isCurNormal,a.record=[]}},e.setLocalStats=function(t){var n={};Object.keys(t).map((function(r){var i=t[r],o=e.gatewayClient.localStreams[parseInt(r)],a=e.localStreamStorage[r]||{};o&&o.hasVideo()&&(e.record("SendVideoBitrate",i.videoStats,a,r),e.record("FramerateInput",i.videoStats,a,r,o),e.record("FramerateSent",i.videoStats,a,r)),o&&o.hasAudio()&&(e.record("AudioIntputLevel",i.audioStats,a,r),e.record("SendAudioBitrate",i.audioStats,a,r)),n[r]=a})),e.localStreamStorage=n},e.setRemoteStats=function(n){var r={};Object.keys(n).map((function(i){var o=n[i],a=t.remoteStreams[i],s=e.remoteStreamStorage[i]||{};a&&a.hasVideo()&&a.isPlaying()&&e.record("VideoDecode",o.videoStats,s,i),a&&a.hasAudio()&&a.isPlaying()&&(e.record("AudioOutputLevel",o.audioStats,s,i),e.record("AudioDecode",o.audioStats,s,i)),r[i]=s})),e.remoteStreamStorage=r},e};function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var L=n(2),k=new function(){var t=Object(a.b)();return t.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},t.state=t.states.UNINIT,t.type=null,t.lastConnectedAt=null,t.lastDisconnectedAt=null,t.lastTypeChangedAt=null,t.networkChangeTimer=null,t._init=function(e,n){if(t.state=t.states.INITING,navigator.connection&&navigator.connection.addEventListener){var r=t._getNetworkInfo();t.type=r&&r.type,t.state=t.states.INITED,e&&e()}else t.state=t.states.UNINIT,n&&n("DO_NOT_SUPPORT")},t._getNetworkInfo=function(){return navigator.connection},t._reloadNetworkInfo=function(){var e=t._getNetworkInfo(),n=e&&e.type||"UNSUPPORTED",r=Date.now();if(n!==t.type){t.lastTypeChangedAt=r,"none"==n?t.lastDisconnectedAt=r:"none"==t.type&&(t.lastConnectedAt=r),t.type=n;var i={type:"networkTypeChanged",networkType:n};t.dispatchEvent(i)}},t.getStats=function(e,n){var r={},i=t._getNetworkInfo();i&&(r.NetworkType=i.type||"UNSUPPORTED"),setTimeout((function(){e(r)}),0)},t._init((function(){navigator.connection.addEventListener("change",(function(){t._reloadNetworkInfo()})),t.networkChangeTimer=setInterval((function(){t._reloadNetworkInfo()}),5e3)}),(function(t){})),t},B=n(52),N=n(16),P=n(53),U=n.n(P),D=n(21),F="host",H=function(t){var e={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServers:[],useProxyServer:!1,useLocalAccessPoint:!1};if(e.mode=t.mode,e.codec=t.codec,e.clientId=Object(S.generateSessionId)().slice(0,5),e.uintUid=null,e.customReportCount=0,t=w()({},t),e.aespassword=null,e.aesmode="none",e.hasPublished=!1,e.getSessionId=function(){return t.sessionId},e.startChannelMediaRelay=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return r&&r(t);r&&r()},name:"Client.startChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof p.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var a=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(L.isEmpty)(a))throw"srcChannelMediaInfo should not be empty";if(Object(L.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(S.is32Uint)(a.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(L.isValidChannelName)(a.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(a.token&&!Object(L.isValidToken)(a.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach((function(t){if(!Object(S.is32Uint)(t.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(L.isValidChannelName)(t.channelName))throw"Invalid channelName in destChannelMediaInfo";if(t.token&&!Object(L.isValidToken)(t.token))throw"Invalid token in destChannelMediaInfo"})),e.gatewayClient.state!==E.a.CONNECTED)throw"startChannelMediaRelay should be used after join";e.gatewayClient.startChannelMediaRelay(n).then((function(){i&&i()})).catch((function(t){i&&i(t)}))},e.updateChannelMediaRelay=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return r&&r(t);r&&r()},name:"Client.updateChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof p.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var a=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(L.isEmpty)(a))throw"srcChannelMediaInfo should not be empty";if(Object(L.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(S.is32Uint)(a.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(L.isValidChannelName)(a.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(a.token&&!Object(L.isValidToken)(a.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach((function(t){if(!Object(S.is32Uint)(t.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(L.isValidChannelName)(t.channelName))throw"Invalid channelName in destChannelMediaInfo";if(t.token&&!Object(L.isValidToken)(t.token))throw"Invalid token in destChannelMediaInfo"})),e.gatewayClient.state!==E.a.CONNECTED)throw"updateChannelMediaRelay should be used after join";e.gatewayClient.updateChannelMediaRelay(n).then((function(){i&&i()})).catch((function(t){i&&i(t)}))},e.stopChannelMediaRelay=function(n){var r=o.report.reportApiInvoke(t.sessionId,{callback:function(t){if(t)return n&&n(t);n&&n()},name:"Client.stopChannelMediaRelay",options:arguments,tag:"tracer"});e.gatewayClient.stopChannelMediaRelay().then((function(){r&&r()})).catch((function(t){r&&r(t)}))},e.getConnectionState=function(){var n=o.report.reportApiInvoke(t.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),r=E.a.connetionStateMap[e.gatewayClient.state];return n(),r},e.setClientRole=function(n,r){var a=o.report.reportApiInvoke(t.sessionId,{callback:r,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Object(L.checkValidEnum)(n,"setClientRole",[F,"audience"]),"rtc"===e.mode){var s="RTC mode can not use setClientRole";return i.default.warning("[".concat(e.clientId,"] ").concat(s)),a&&a(s)}e.gatewayClient&&e.gatewayClient.state===E.a.CONNECTED?("audience"===n&&(0===this.highStreamState?this._unpublish(this.highStream,(function(){a&&a(null,{role:n})}),(function(t){a&&a(t)})):e.gatewayClient.setClientRole("audience",a)),n===F&&e.gatewayClient.setClientRole(F,a)):(e.gatewayClient.role=n,a&&a(null,{role:n}))},e.getGatewayInfo=function(t){if(e.gatewayClient.state!==E.a.CONNECTED){var n="Client is not in connected state";return i.default.error("[".concat(e.clientId,"] ").concat(n)),void t(n)}e.gatewayClient.getGatewayInfo((function(e){t(null,e)}),t)},e.renewToken=function(n,r,a){var s=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return i.default.error("Failed to renew token ".concat(t),e),a&&a(t);r&&r(e)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Object(L.isValidToken)(n))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return e.gatewayClient?e.key?(e.key=n,void e.gatewayClient.renewToken(n,(function(t){return s(null,t)}),s)):(i.default.error("[".concat(e.clientId,"] renewToken should not be called before user join")),s(_.default.INVALID_OPERATION)):(i.default.error("[".concat(e.clientId,"] renewToken Failed. GatewayClient not Exist")),s(_.default.INVALID_OPERATION))},e.setLowStreamParameter=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});Object(L.checkValidObject)(n,"param");var a=n.width,s=n.height,c=n.framerate,u=n.bitrate;Object(L.isEmpty)(a)||Object(L.checkValidNumber)(a,"width"),Object(L.isEmpty)(s)||Object(L.checkValidNumber)(s,"height"),Object(L.isEmpty)(c)||Object(L.checkValidNumber)(c,"framerate"),Object(L.isEmpty)(u)||Object(L.checkValidNumber)(u,"bitrate",1,1e7),(!a&&s||a&&!s)&&i.default.warning("[".concat(e.clientId,"] The width and height parameters take effect only when both are set")),e.lowStreamParameter=n,r()},e.init=function(e,n,r){var i=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return r&&r(t);n&&n(e)},name:"Client.init",options:arguments,tag:"tracer"});Object(L.checkValidString)(e),Object(s.isChromeKernel)()&&Object(s.getChromeKernelVersion)()<=48?r?i(_.default.BAD_ENVIRONMENT):Object(S.popBanTip)():(t.appId=e,t.sessionId=Object(S.generateSessionId)(),i())},e.setTurnServer=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(e.gatewayClient&&e.gatewayClient.state!==E.a.DISCONNECTED)throw new Error("Set turn server before join channel");if(e.useProxyServer)throw new Error("You have already set the proxy");if(e.useLocalAccessPoint)throw new Error("You have already set the local proxy");n instanceof Array||(n=[n]);var a=[];n.map((function(t,n){Object(L.checkValidObject)(t,"turnServer");var r=t.turnServerURL,o=t.username,s=t.password,c=t.udpport,u=t.forceturn,l=t.tcpport;if(Object(L.checkValidString)(r,"turnServerURL"),Object(L.checkValidString)(o,"username"),Object(L.checkValidString)(s,"password"),Object(L.checkValidString)(c,"udpport"),0===parseInt(c))throw new Error("udpport should not be ".concat(c));Object(L.isEmpty)(u)||Object(L.checkValidBoolean)(u,"forceturn");var d={mode:"manual"};if(d.url=r,d.udpport=c,d.username=o,d.credential=s,d.forceturn=u||!1,!Object(L.isEmpty)(l)){if(Object(L.checkValidString)(l,"tcpport"),0===parseInt(l))throw new Error("tcpport should not be ".concat(l));d.tcpport=l,i.default.info("[".concat(e.clientId,"] Set turnserver[").concat(n,"] tcpurl. ").concat(d.url,":").concat(d.tcpport))}i.default.info("[".concat(e.clientId,"] Set turnserver[").concat(n,"] udpurl. ").concat(d.url,":").concat(d.udpport,",username: ").concat(d.username)),a.push(d)})),e.turnServers=a,r()},e.setProxyServer=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(e.gatewayClient&&e.gatewayClient.state!==E.a.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!n)throw new Error("Do not set the proxyServer parameter as empty");if(e.useProxyServer)throw new Error("You have already set the proxy");if(e.useLocalAccessPoint)throw new Error("You have already set the local proxy");Object(L.checkValidString)(n,"proxyServer"),e.proxyServer=n,o.report.setProxyServer(n),i.default.setProxyServer(n),r()},e.startProxyServer=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(e.gatewayClient&&e.gatewayClient.state!==E.a.DISCONNECTED)throw new Error("Start proxy server before join channel");if(e.proxyServer)throw new Error("You have already set the proxy");if(e.useLocalAccessPoint)throw new Error("You have already set the local proxy");e.useProxyServer=!0,e.proxyServerType=n||1,r()},e.stopProxyServer=function(){var n=o.report.reportApiInvoke(t.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(e.gatewayClient&&e.gatewayClient.state!==E.a.DISCONNECTED)throw new Error("Stop proxy server after leave channel");o.report.setProxyServer(),i.default.setProxyServer(),e.turnServers=[],e.proxyServer=null,e.useProxyServer=!1,e.proxyServerType=null,n()},e.setEncryptionSecret=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Object(L.checkValidString)(n,"password");var i=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");i.test(n)||console.warn("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer,\n      "),e.aespassword=n,r()},e.setEncryptionMode=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Object(L.checkValidString)(n,"encryptionMode"),-1===g.indexOf(n))throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb" | "sm4-128-ecb" | "aes-128-gcm" | "aes-256-gcm"');e.aesmode=n,r()},e.configPublisher=function(n){var r=o.report.reportApiInvoke(t.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});Object(L.checkValidObject)(n,"config");var i=n.width,a=n.height,s=n.framerate,c=n.bitrate,u=n.publisherUrl;Object(L.checkValidNumber)(i,"width"),Object(L.checkValidNumber)(a,"height"),Object(L.checkValidNumber)(s,"framerate"),Object(L.checkValidNumber)(c,"bitrate",1,1e7),u&&Object(L.checkValidString)(u,"publisherUrl"),e.gatewayClient.configPublisher(n),r()},e.enableDualStream=function(n,r){var a=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return r&&r(t);n&&n(e)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return"iOS"===Object(s.getBrowserOS)()?(o.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(_.default.IOS_NOT_SUPPORT)):Object(s.isWeChatBrowser)()?(o.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(_.default.WECHAT_NOT_SUPPORT)):(o.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),e.isDualStream=!0,e.highStream&&(e.highStream.isDualStream=!0),void(0===e.highStreamState?e._publishLowStream((function(t){return a(null,t)}),(function(t){i.default.warning("[".concat(e.clientId,"]"),t),a(_.default.ENABLE_DUALSTREAM_FAILED)})):1===e.highStreamState?a(_.default.STILL_ON_PUBLISHING):a(null)))},e.disableDualStream=function(n,r){var a=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return r&&r(t);n&&n(e)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});o.report.streamSwitch(t.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),e.isDualStream=!1,e.highStream&&(e.highStream.isDualStream=!1),0===e.highStreamState?e._unpublishLowStream((function(){e.highStream.lowStream=null,a()}),(function(t){i.default.warning("[".concat(e.clientId,"]"),t),a(_.default.DISABLE_DUALSTREAM_FAILED)})):1===e.highStreamState?a(_.default.STILL_ON_PUBLISHING):a()},e._getLowStream=function(t,n){e.lowStream?t(e.lowStream):e._createLowStream((function(n){e.lowStream=n,t(e.lowStream)}),n)},e._createLowStream=function(t,n){if(e.highStream&&e.highStream.stream){var r=w()({},e.highStream.params);if(r.streamID+=1,r.audio=!1,r.video)if(e.highStream.stream.getVideoTracks()[0]){var i=new l.a(r);i.isLowStream=!0,i.streamId=e.highStream.getId()+1;var o={};e.lowStreamParameter&&(o=w()({},e.lowStreamParameter)),o.width&&o.height||(o.width=160,o.height=120),o.framerate=o.framerate||15,o.bitrate=o.bitrate||50,i.setVideoProfileCustomPlus(o);try{var a=U()(e.highStream,{width:i.videoConstraint.width.ideal,height:i.videoConstraint.height.ideal,framerate:i.videoConstraint.frameRate});return i.stream=a,e.highStream.lowStream=i,e.highStream.userMuteVideo&&i.muteVideo(),t&&t(i)}catch(t){return n&&n(t)}}else n&&n(_.default.HIGH_STREAM_NOT_VIDEO_TRACE);else n&&n(_.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(_.default.HIGH_STREAM_NOT_VIDEO_TRACE)},e._publishLowStream=function(t,n){return 2!==e.lowStreamState?n&&n(_.default.LOW_STREAM_ALREADY_PUBLISHED):e.highStream&&e.highStream.hasScreen()?n&&n(_.default.SHARING_SCREEN_NOT_SUPPORT):void e._getLowStream((function(r){e.lowStreamState=1,e.gatewayClient.publish(r,{streamType:1},(function(){e.lowStreamState=0,t&&t()}),(function(t){1===e.lowStreamState&&(e.lowStreamState=2),i.default.debug("[".concat(e.clientId,"] publish low stream failed")),n&&n(t)}))}),n)},e._unpublishLowStream=function(t,n){if(0!==e.lowStreamState)return n&&n(_.default.LOW_STREAM_NOT_YET_PUBLISHED);e.lowStream&&(e.gatewayClient.unpublish(e.lowStream,{streamType:1},(function(){}),(function(t){i.default.debug("[".concat(e.clientId,"] unpublish low stream failed")),n&&n(t)})),e.lowStream.close(),e.lowStream=null,e.lowStreamState=2,t&&t())},e.join=function(n,r,a,s,c,u){s&&"function"==typeof s&&(u=c,c=s,s=null);var l=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return u&&u(t);c&&c(e)},name:"Client.join",options:arguments,tag:"tracer"});if(n&&!Object(L.isValidToken)(n))return i.default.warning("[".concat(e.clientId,"] Param channelKey should be string")),l(_.default.INVALID_PARAMETER);if(!Object(L.isValidChannelName)(r))return i.default.error("Invalid Channel Name ".concat(r)),i.default.warning("[".concat(e.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),l(_.default.INVALID_PARAMETER);if("string"==typeof r&&""===r)return i.default.warning("[".concat(e.clientId,"] Param channel should not be empty")),l(_.default.INVALID_PARAMETER);if(s&&!Object(L.isValidString)(s))return i.default.warning("[".concat(e.clientId,"] optionalInfo should be string")),l(_.default.INVALID_PARAMETER);if(a&&!Object(S.is32Uint)(a)&&!Object(L.isValidString)(a,1,255))return i.default.error("Invalid UID ".concat(a," ").concat(y()(a))),i.default.warning("[".concat(e.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is 32Uint")),l(_.default.INVALID_PARAMETER);if("string"==typeof a&&0==a.length)return i.default.warning("[".concat(e.clientId,"] String uid should not be empty")),l(_.default.INVALID_PARAMETER);if("string"==typeof a&&a.length>256)return i.default.warning("[".concat(e.clientId,"] Length of string uid should be less than 255")),l(_.default.INVALID_PARAMETER);e.highStream=null,e.lowStream=null,e.lowStreamParameter=null,e.isDualStream=!1,e.highStreamState=2,e.lowStreamState=2;var d=Date.now(),h=setTimeout((function(){if(1!=e.gatewayClient.hasJoined){i.default.debug("[".concat(e.clientId,"] The time to join the channel is greater than 5 seconds "));var n=Date.now();o.report.joinChannelTimeOut({lts:n,sid:t.sessionId,cname:r,cid:f&&f.cid,uid:f.uid||("string"==typeof a?void 0:a),elapse:n-d,timeout:5})}}),5e3),f={clientId:e.clientId,appId:t.appId,sid:t.sessionId,cname:r,uid:a,turnServers:e.turnServers.concat(),proxyServer:e.proxyServer,token:n||t.appId,useProxyServer:e.useProxyServer,useLocalAccessPoint:e.useLocalAccessPoint,proxyServerType:e.proxyServerType,optionalInfo:s};if("string"==typeof a&&(f.stringUid=a,e.uintUid?(f.uid=e.uintUid,delete e.uintUid):f.uid=0),e.aespassword&&"none"!==e.aesmode&&w()(f,{aespassword:e.aespassword,aesmode:e.aesmode}),o.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),cname:r,appid:t.appId,mode:t.mode,succ:!0}),e.onSuccess=function(t){clearTimeout(h),e.rtcStatsCollector.startNetworkQualityTimer(),e.onSuccess=null,l(null,t)},e.onFailure=function(t){return l(t)},e.channel=r,e.gatewayClient.state!==E.a.DISCONNECTED)return i.default.error("[".concat(e.clientId,"] Client already in connecting/connected state")),l(_.default.INVALID_OPERATION),void o.report.joinGateway(t.sessionId,{lts:Date.now(),succ:!1,ec:_.default.INVALID_OPERATION,addr:null});e.gatewayClient.state=E.a.CONNECTING;var p=function(o,a){i.default.info("[".concat(e.clientId,"] Joining channel: ").concat(r)),e.gatewayClient.dispatchEvent({type:"config-distribute",config:a,joinInfo:f}),e.key=n||t.appId,f.cid=o.cid,f.uid||(f.uid=o.uid),f.vid=o.vid,f.clientId=e.clientId,f.apResponse=o.res,o.uni_lbs_ip&&o.uni_lbs_ip[1]&&(f.uni_lbs_ip=o.uni_lbs_ip[1]),f.gatewayAddr=o.gateway_addr,e.joinInfo=f,e.gatewayClient.join(f,e.key,(function(t){i.default.info("[".concat(e.clientId,"] Join channel ").concat(r," success, join with uid: ").concat(t,".")),e.onSuccess=null,e.rtcStatsCollector.startNetworkQualityTimer(),l(null,t)}),(function(t){return l(t)}))};f.stringUid&&!f.uid?(e.userAccountReq&&!e.userAccountReq.isFinished()&&e.userAccountReq.cancel(),e.userAccountReq=Object(T.getUserAccount)(f,e.gatewayClient),e.userAccountReq.then((function(t){i.default.debug("getUserAccount Success ".concat(t.url," ").concat(f.stringUid," => ").concat(t.uid)),f.uid=t.uid,Object(T.getGatewayList)(f,p,(function(t){return l(t)}))})).catch((function(t){i.default.error("getUserAccount rejected",t),l(t)}))):Object(T.getGatewayList)(f,p,(function(t){return l(t)}))},e.renewChannelKey=function(n,r,a){var s=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return a&&a(t);r&&r(e)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Object(L.checkValidString)(n,"key",1,2047),void 0===e.key?(i.default.error("[".concat(e.clientId,"] renewChannelKey should not be called before user join")),s(_.default.INVALID_OPERATION)):(e.key=n,e.gatewayClient.joinInfo.token=n,e.gatewayClient.key=n,e.gatewayClient.recover(),s())},e.leave=function(n,a){e.gatewayClient.isFirstSuccess=!0,e.gatewayClient.hasInvokeLeave=!0;var s=!1,c=o.report.reportApiInvoke(t.sessionId,{callback:function(t,r){if(t)return a&&a(t);e.gatewayClient.reconnectingCS=!1,e.gatewayClient.state=E.a.DISCONNECTED,clearTimeout(Object(T._getReconnectCSTimer)(e.clientId)),e._renewSession(),e.rtcStatsCollector.clearNetworkQualityTimer(),n&&n(r)},name:"Client.leave",options:arguments,tag:"tracer"});i.default.info("[".concat(e.clientId,"] Leaving channel")),e.userAccountReq&&!e.userAccountReq.isFinished()&&(e.userAccountReq.cancel(),e.gatewayClient.state===E.a.CONNECTING&&(e.gatewayClient.state=E.a.DISCONNECTED)),e._terminateLiveStreaming(),e.gatewayClient.leave((function(t){s=!0,c(null,t)}),c),setTimeout((function(){s||(e.gatewayClient.socket&&(e.gatewayClient.socket.close(),e.gatewayClient.socket=null),e.gatewayClient.state=E.a.DISCONNECTED,c(null,"LEAVE_MSG_TIMEOUT"))}),Object(r.getParameter)("LEAVE_MSG_TIMEOUT"))},e._renewSession=function(){var n=Object(S.generateSessionId)();if(i.default.debug("renewSession ".concat(t.sessionId," => ").concat(n)),t.sessionId=n,e.gatewayClient.peerPublishDurationMap.clear(),e.joinInfo&&(e.joinInfo.sid=n),e.gatewayClient&&(e.gatewayClient.joinInfo&&(e.gatewayClient.joinInfo.sid=n),e.gatewayClient.localStreams))for(var r in e.gatewayClient.localStreams){var o=e.gatewayClient.localStreams[r];o&&(o.sid=n)}},e._publish=function(n,o,a,s){if(2!==e.highStreamState)return i.default.warning("[".concat(e.clientId,"] Can't publish stream when stream already publish ").concat(n.getId())),a&&a(_.default.STREAM_ALREADY_PUBLISHED);if(0===e.turnServers.length&&Object(r.getParameter)("FORCE_TURN")&&!Object(r.getParameter)("TURN_ENABLE_TCP")&&!Object(r.getParameter)("TURN_ENABLE_UDP"))throw new Error("force TURN With No TURN Configuration");i.default.info("[".concat(e.clientId,"] Publishing stream, uid ").concat(n.getId())),e.highStream=n,e.highStreamState=1,e.highStream.streamId=e.joinInfo.stringUid||e.joinInfo.uid,e.hasPublished=!1;var c=function(n,r,o){e.gatewayClient.publish(n,{streamType:0},(function(){n.sid=t.sessionId,e.highStreamState=0,i.default.info("[".concat(e.clientId,"] Publish success, uid: ").concat(n.getId())),e.highStream&&(e.highStream.isDualStream=e.isDualStream),e.isDualStream?e._publishLowStream((function(){r&&r()}),(function(t){i.default.warning("[".concat(e.clientId,"] "),t),N.a.replaceWithCanvasTrack(n).then((function(){r&&r()}))})):N.a.replaceWithCanvasTrack(n).then((function(){r&&r()}))}),o)};"audience"!==e.gatewayClient.role||"live"!==e.mode||s?c(n,o,a):e.gatewayClient.setClientRole(F,(function(t){if(t)return a&&a(t);c(n,o,a)}))},e._unpublish=function(t,n,r,o){if(0!==e.highStreamState)return i.default.warning("[".concat(e.clientId,"] Can't unpublish stream when stream not publish")),r&&r(_.default.STREAM_NOT_YET_PUBLISHED);i.default.info("[".concat(e.clientId,"] Unpublish stream, uid ").concat(t.getId()));var a=function(t,n,r){e.isDualStream&&e.lowStream&&e._unpublishLowStream(null,r),e.gatewayClient.unpublish(t,{streamType:0},(function(){e.highStreamState=2,i.default.info("[".concat(e.clientId,"] Unpublish stream success, uid: ").concat(t.getId())),e.gatewayClient.dispatchEvent({type:"stream-unpublished",stream:t}),n&&n()}),(function(n){i.default.info("[".concat(e.clientId,"] Unpublish stream fail, uid: ").concat(t.getId())),r&&r(n)}))};e.gatewayClient.role!==F||"live"!==e.mode||o?a(t,n,r):e.gatewayClient.setClientRole("audience",(function(e){if(e)return r&&r(e);a(t,n,r)}))},e.publish=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{callback:function(t,n){if(t)return 1===e.highStreamState&&"REQUEST_ABORT"!==t&&(e.highStreamState=2),r&&r(t)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});2===e.highStreamState?n._hasVideoTracks()||n._hasAudioTracks()?(e.gatewayClient.publishRequestId=Object(S.generateId)(),e._publish(n,(function(t){return i(null,t)}),(function(t){return i(t)}))):i(_.default.NO_TRACK_IN_STREAM):i(_.default.STREAM_ALREADY_PUBLISHED)},e.unpublish=function(n,r,i){var a=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return r&&r(t);i&&i(e)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});0===e.highStreamState?(e.gatewayClient.publishRequestId=null,e._unpublish(n,(function(t){return a(null,t)}),(function(t){return a(t)}))):a(_.default.STREAM_NOT_YET_PUBLISHED)},e.subscribe=function(n,r,a){var c=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return a&&a(t)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:r,onFailure:!!a}});"function"==typeof r&&(a=r,r=null),Object(L.checkValidObject)(n,"stream"),Object(L.isEmpty)(r)||(Object(L.checkValidObject)(r,"options"),Object(L.isEmpty)(r.video)||Object(L.checkValidBoolean)(r.video,"options.video"),Object(L.isEmpty)(r.audio)||Object(L.checkValidBoolean)(r.audio,"options.audio"));var u={video:!0,audio:!0};if(!Object(L.isEmpty)(r)){if(Object(s.isSafari)()&&(!r.video||!r.audio)){var l="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return i.default.error("[".concat(e.clientId,"] "),l),void c(l)}if(!Object(L.isEmpty)(r.video)&&!Object(L.isValidBoolean)(r.video)||!Object(L.isEmpty)(r.audio)&&!Object(L.isValidBoolean)(r.audio)||!1===r.audio&&!1===r.video)return l="INVALID_PARAMETER ".concat(JSON.stringify(r)),i.default.error("[".concat(e.clientId,"] "),l),void c(l)}n.subscribeOptions?(w()(n.subscribeOptions,u,r),e.gatewayClient.subscribeChange(n,(function(t){return c(null,t)}),c)):(e.gatewayClient.subscribeRequestId.set(n.getId(),Object(S.generateId)()),n.subscribeOptions=w()({},u,r),e.gatewayClient.subscribe(n,(function(t){return c(null,t)}),c))},e.unsubscribe=function(n,r){var a=o.report.reportApiInvoke(t.sessionId,{callback:function(t,e){if(t)return r&&r(t)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});i.default.info("[".concat(e.clientId,"] Unsubscribe stream, uid: ").concat(n.getId())),e.gatewayClient.subscribeRequestId.delete(n.getId()),e.gatewayClient.unsubscribe(n,(function(t){return a(null,t)}),a)},e.setRemoteVideoStreamType=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:r}});Object(L.checkValidEnum)(r,"streamType",[0,1]),e.gatewayClient.setRemoteVideoStreamType(n,r),i()},e.setStreamFallbackOption=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:r}});Object(L.checkValidEnum)(r,"fallbackType",[0,1,2]),e.gatewayClient.setStreamFallbackOption(n,r),i()},e.enableAudioVolumeIndicator=function(n,r){var a=o.report.reportApiInvoke(t.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});n=n||2e3,r=r||3,Object(L.checkValidNumber)(r,"smooth",1,100),Object(L.checkValidNumber)(n,"interval",50,1e5),e.audioVolumeIndication=e.audioVolumeIndication||{enabled:!0},e.audioVolumeIndication.interval=n,e.audioVolumeIndication.smooth=r,e.audioVolumeIndication={interval:n,smooth:r},i.default.info("[".concat(e.clientId,"] enableAudioVolumeIndicator interval ").concat(n," smooth ").concat(r)),e.gatewayClient.enableAudioVolumeIndicator(n,r),a()},e.getNetworkStats=function(t,n){return i.default.deprecate("[".concat(e.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),k.getStats(t,n)},e.getSystemStats=function(t,e){return u.getStats(t,e)},e.getRecordingDevices=function(t,e){return d.a.getRecordingDevices(t,e)},e.getPlayoutDevices=function(t,e){return d.a.getPlayoutDevices(t,e)},e.getCameras=function(t,e){return d.a.getCameras(t,e)},e.getRemoteAudioStats=function(t,n){return e.rtcStatsCollector.getRemoteAudioStats(t,n)},e.getLocalAudioStats=function(t,n){return e.rtcStatsCollector.getLocalAudioStats(t,n)},e.getRemoteVideoStats=function(t,n){return e.rtcStatsCollector.getRemoteVideoStats(t,n)},e.getLocalVideoStats=function(t,n){return e.rtcStatsCollector.getLocalVideoStats(t,n)},e._getRemoteVideoQualityStats=function(t,n){return e.rtcStatsCollector.getRemoteVideoQualityStats(t,n)},e._getRemoteAudioQualityStats=function(t,n){return e.rtcStatsCollector.getRemoteAudioQualityStats(t,n)},e.getTransportStats=function(t,n){return e.rtcStatsCollector.getTransportStats((function(e){return k.getStats((function(n){var r=w()({},e,n);t&&t(r)}),n)}),n)},e.getSessionStats=function(t,n){return e.rtcStatsCollector.getSessionStats(t,n)},e.onNetworkQuality=function(){return e.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},e.sendMetadata=function(n,r){var i=o.report.reportApiInvoke(t.sessionId,{name:"Client.sendMetadata",tag:"tracer",callback:function(t){if(t)return r&&r(t);r&&r()}});e.gatewayClient.sendMetadata(n,i)},e.sendCustomReportMessage=function(n,a,s,c,u,l){Object(r.getParameter)("CR")?e.customReportCount>Object(r.getParameter)("CRL")?l&&l("REPORT_LIMITED"):(e.gatewayClient.hasJoined||(i.default.WARNING("Should invoke Client.sendCustomReportMessage after join"),l&&l("REPORT_BEFORE_JOINED")),e.customReportTimer||(e.customReportTimer=setInterval((function(){e.customReportCount=0}),Object(r.getParameter)("CRI"))),Object(L.checkValidString)(n,"reportId",0,100,!1),Object(L.checkValidString)(a,"category",0,100,!1),Object(L.checkValidString)(s,"event",0,100,!1),Object(L.checkValidString)(c,"label",0,100,!1),Object(L.checkValidNumber)(u,"value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),e.customReportCount++,o.report.sendCustomReportMessage(t.sessionId,{reportId:n,category:a,event:s,label:c,value:u,lts:Date.now()},(function(t){t?l&&l("REPORT_FAILED"):l&&l()}))):l&&l("REPORT_FORBIDDEN")},e.setLocalAccessPoints=function(n,i){var a=o.report.reportApiInvoke(t.sessionId,{name:"Client.setLocalAccessPoints",tag:"tracer"});if(Object(L.checkValidArray)(n,"serverList"),Object(L.checkValidString)(i,"domain"),e.useProxyServer)throw new Error("You have already set the proxy");n=n.map((function(t){return"".concat(t.replace(/\./g,"-"),".").concat(i)})),e.useLocalAccessPoint=!0,Object(r.setParameter)("WEBCS_DOMAIN",n),Object(r.setParameter)("WEBCS_DOMAIN_BACKUP_LIST",n),Object(r.setParameter)("GATEWAY_DOMAINS",[i]),Object(r.setParameter)("EVENT_REPORT_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("LOG_UPLOAD_SERVER","".concat(n[Math.floor(Math.random()*n.length)],":6444")),a()},t.clientId=e.clientId,e.gatewayClient=Object(E.a)(t),e.listenerLoggerTimer=null,e.listenerLoggerCache=[],e.on=function(t,n){e.gatewayClient.on(t,n),e.listenerLoggerCache.push("".concat(t).concat(n.name?":"+n.name:"")),e.listenerLoggerTimer?clearTimeout(e.listenerLoggerTimer):i.default.info("[".concat(e.clientId,"] Adding event handler on ").concat(t)),e.listenerLoggerTimer=setTimeout((function(){e.listenerLoggerCache.length&&(e.listenerLoggerTimer=null,i.default.info("[".concat(e.clientId,"] Added event handler on ").concat(e.listenerLoggerCache.join(", "))),e.listenerLoggerCache=[])}),0)},e.off=function(t,n){i.default.info("remove event handler from [".concat(t,"]")),e.gatewayClient.removeEventListener(t,n)},e.rtcStatsCollector=function(t){var e=Object(a.b)();return e.gatewayClient=t,e.exceptionMonitor=new O(t),e.localStats={},e.remoteStats={},e.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},e.getRemoteAudioStats=function(t){var n=e.gatewayClient.traffic_stats,r={};for(var i in e.remoteStats){var o={},a=e.remoteStats[i];if(Object(C.b)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.audio_delay),Object(C.b)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),Object(C.b)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_audio_lost_ratio_400ms),Object(C.b)(o,"RecvLevel",a.audioStats&&a.audioStats.audioOutputLevel),Object(C.b)(o,"RecvBitrate",a.audioRecvBitrate),Object(C.b)(o,"CodecType",a.audioStats&&a.audioStats.googCodecName),Object(C.b)(o,"MuteState",a.audioDisabled),Object(C.b)(o,"TotalFreezeTime",a.audioStats&&a.audioStats.audioTotalFreezeTime),Object(C.b)(o,"TotalPlayDuration",a.audioStats&&a.audioStats.audioTotalPlayDuration),n&&n.peer_delay){var s=n.peer_delay.find((function(t){return t.peer_uid==i}));if(s){var c=s.peer_publish_audio_duration+(Date.now()-n.timestamp);Object(C.b)(o,"AudioPublishDuration",c)}else Object(C.b)(o,"AudioPublishDuration",-1)}r[i]=o}t&&t(r)},e.getLocalAudioStats=function(t){var n={};for(var r in e.localStats){var i={},o=e.localStats[r];Object(C.b)(i,"RecordingLevel",o.audioStats&&o.audioStats.audioInputLevel),Object(C.b)(i,"SendLevel",o.audioStats&&o.audioStats.totalAudioEnergy),Object(C.b)(i,"SamplingRate",o.audioStats&&o.audioStats.totalSamplesDuration),Object(C.b)(i,"SendBitrate",o.audioSendBitrate),Object(C.b)(i,"CodecType",o.audioStats&&o.audioStats.googCodecName),Object(C.b)(i,"MuteState",o.audioDisabled),Object(C.b)(i,"audioSendPacketsLost",o.audioStats&&o.audioStats.packetsLost);var a=e.gatewayClient.localStreams[r];a&&a.isPlaying()&&Object(C.b)(i,"MuteState",a.userMuteAudio?"1":"0"),n[r]=i}t&&t(n)},e.getRemoteVideoStats=function(t){var n=e.gatewayClient.traffic_stats,r={};for(var i in e.remoteStats){var o={},a=e.remoteStats[i];if(Object(C.b)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.video_delay),Object(C.b)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),Object(C.b)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_video_lost_ratio_400ms),Object(C.b)(o,"RecvBitrate",a.videoRecvBitrate),Object(C.b)(o,"RecvResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthReceived),Object(C.b)(o,"RecvResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightReceived),Object(C.b)(o,"RenderResolutionWidth",a.videoStats&&a.videoStats.renderRemoteWidth),Object(C.b)(o,"RenderResolutionHeight",a.videoStats&&a.videoStats.renderRemoteHeight),Object(C.b)(o,"RenderFrameRate",a.videoStats&&a.videoStats.googFrameRateOutput),Object(C.b)(o,"MuteState",a.videoDisabled),Object(C.b)(o,"TotalFreezeTime",a.videoStats&&a.videoStats.videoTotalFreezeTime),Object(C.b)(o,"TotalPlayDuration",a.videoStats&&a.videoStats.videoTotalPlayDuration),n&&n.peer_delay){var s=n.peer_delay.find((function(t){return t.peer_uid==i}));if(s){var c=s.peer_publish_video_duration+(Date.now()-n.timestamp);Object(C.b)(o,"VideoPublishDuration",c)}else Object(C.b)(o,"VideoPublishDuration",-1)}r[i]=o}t&&t(r)},e.getLocalVideoStats=function(t){var n={};for(var r in e.localStats){var i={},o=e.localStats[r];Object(C.b)(i,"TargetSendBitrate",o.videoTargetSendBitrate),Object(C.b)(i,"SendFrameRate",o.videoStats&&o.videoStats.googFrameRateSent),Object(C.b)(i,"SendBitrate",o.videoSendBitrate),Object(C.b)(i,"SendResolutionWidth",o.videoStats&&o.videoStats.googFrameWidthSent),Object(C.b)(i,"SendResolutionHeight",o.videoStats&&o.videoStats.googFrameHeightSent),Object(C.b)(i,"CaptureResolutionWidth",o.videoStats&&o.videoStats.googFrameWidthInput),Object(C.b)(i,"CaptureResolutionHeight",o.videoStats&&o.videoStats.googFrameHeightInput),Object(C.b)(i,"EncodeDelay",o.videoStats&&o.videoStats.googAvgEncodeMs),Object(C.b)(i,"MuteState",o.videoDisabled),Object(C.b)(i,"TotalFreezeTime",o.videoStats&&o.videoStats.videoTotalFreezeTime),Object(C.b)(i,"TotalDuration",o.videoStats&&o.videoStats.videoTotalPlayDuration),Object(C.b)(i,"CaptureFrameRate",o.videoStats&&o.videoStats.googFrameRateSent),Object(C.b)(i,"videoSendPacketsLost",o.videoStats&&o.videoStats.packetsLost),o.videoStats&&!o.videoStats.googFrameWidthInput&&Object(C.b)(i,"CaptureResolutionWidth",o.videoStats&&o.videoStats.renderLocalWidth),o.videoStats&&!o.videoStats.googFrameHeightInput&&Object(C.b)(i,"CaptureResolutionHeight",o.videoStats&&o.videoStats.renderLocalHeight),n[r]=i}t&&t(n)},e.getRemoteVideoQualityStats=function(t){var n={};for(var r in e.remoteStats){var i={},o=e.remoteStats[r];Object(C.b)(i,"videoReceiveDelay",o.videoStats&&o.videoStats.googCurrentDelayMs),Object(C.b)(i,"VideoFreezeRate",o.videoStats&&o.videoStats.videoFreezeRate),Object(C.b)(i,"FirstFrameTime",o.firstFrameTime),n[r]=i}t&&t(n)},e.getRemoteAudioQualityStats=function(t){var n={};for(var r in e.remoteStats){var i={},o=e.remoteStats[r];Object(C.b)(i,"audioReceiveDelay",o.audioStats&&o.audioStats.googCurrentDelayMs),Object(C.b)(i,"AudioFreezeRate",o.videoStats&&o.videoStats.videoFreezeRate),n[r]=i}t&&t(n)},e.getTransportStats=function(t){var n={},r={},i=e.gatewayClient.traffic_stats,o=i.peer_delay;if(Object(C.b)(n,"OutgoingAvailableBandwidth",e.gatewayClient.OutgoingAvailableBandwidth/1e3),Object(C.b)(n,"RTT",i&&2*i.access_delay),o){var a,s=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return M(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(t,e):void 0}}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(o);try{for(s.s();!(a=s.n()).done;){var c=a.value;c.downlink_estimate_bandwidth&&(r[c.peer_uid]=c.downlink_estimate_bandwidth/1e3+"")}}catch(t){s.e(t)}finally{s.f()}}n.IncomingAvailableBandwidth=r,t&&t(n)},e.getSessionStats=function(t){var n={},r=e.gatewayClient.traffic_stats,i=e.gatewayClient.socket,o=0,a=0;for(var s in e.remoteStats)(c=e.remoteStats[s])&&c.videoStats&&c.videoStats.videoRecvBytesDelta&&(a+=parseInt(c.videoStats.videoRecvBytesDelta)),c&&c.audioStats&&c.audioStats.audioRecvBytesDelta&&(a+=parseInt(c.audioStats.audioRecvBytesDelta));for(var s in e.localStats){var c;(c=e.localStats[s])&&c.videoStats&&c.videoStats.videoSendBytesDelta&&(o+=parseInt(c.videoStats.videoSendBytesDelta)),c&&c.audioStats&&c.audioStats.audioSendBytesDelta&&(o+=parseInt(c.audioStats.audioSendBytesDelta))}var u=o+e.session.WSSendBytesDelta+e.session.HTTPSendBytesDelta,l=a+e.session.WSRecvBytesDelta+e.session.HTTPRecvBytesDelta,d=e.session.sendBytes+Object(x.getHTTPSendBytes)(),h=e.session.recvBytes+Object(x.getHTTPRecvBytes)();e.gatewayClient.socket&&e.gatewayClient.socket.state===e.gatewayClient.CONNECTED&&(d+=i.getSendBytes(),h+=i.getRecvBytes());var f=1;r.peer_delay&&(f=r.peer_delay.length,f+=1),i?Object(C.b)(n,"Duration",i.getDuration()):Object(C.b)(n,"Duration",0),Object(C.b)(n,"UserCount",f),Object(C.b)(n,"SendBytes",d),Object(C.b)(n,"RecvBytes",h),Object(C.b)(n,"SendBitrate",8*u/1e3),Object(C.b)(n,"RecvBitrate",8*l/1e3),t&&t(n)},e.isLocalVideoFreeze=function(t,e){var n=0,r=0;if(!t||!e)return!1;if(Object(s.isChrome)()||Object(s.isOpera)())n=t.googFrameRateInput,r=t.googFrameRateSent;else if(Object(s.isSafari)())n=parseInt(t.framerateMean),r=parseInt(t.framesEncoded)-parseInt(e.framesEncoded);else{if(!Object(s.isFireFox)())return!1;n=parseInt(t.framerateMean),r=parseInt(t.framesEncoded)-parseInt(e.framesEncoded)}return n>5&&r<3},e.isRemoteVideoFreeze=function(t,e){var n=0,r=0;if(!t||!e)return!1;if(Object(s.isChrome)()||Object(s.isOpera)())n=t.googFrameRateReceived,r=t.googFrameRateDecoded;else if(Object(s.isSafari)())n=t.framerateMean,r=parseInt(t.framesDecoded)-parseInt(e.framesDecoded);else{if(!Object(s.isFireFox)())return!1;n=parseInt(t.framesReceived)-parseInt(e.framesReceived),r=parseInt(t.framesDecoded)-parseInt(e.framesDecoded)}return n>5&&n<10&&r<3||n>10&&n<20&&r<4||n>20&&r<5},e.isAudioFreeze=function(t){if(Object(s.isChrome)()&&t){if(t.googDecodingPLC&&t.googDecodingPLCCNG&&t.googDecodingCTN)return(parseInt(t.googDecodingPLC)+parseInt(t.googDecodingPLCCNG))/parseInt(t.googDecodingCTN)>.2}else if((Object(s.isSafari)()||Object(s.isFireFox)())&&t.packetsLost&&t.packetsReceived)return parseInt(t.packetsLost)/(parseInt(t.packetsLost)+parseInt(t.packetsReceived))>.2;return!1},e.isAudioDecodeFailed=function(t){return!!((Object(s.isChrome)()||Object(s.isOpera)())&&t&&parseInt(t.bytesReceived)>0&&0===parseInt(t.googDecodingNormal))},e.startNetworkQualityTimer=function(){e.clearNetworkQualityTimer(),e.networkQualityTimer=setInterval((function(){if(e.gatewayClient.state===E.a.CONNECTED&&navigator.onLine){var t=e.gatewayClient.traffic_stats;e.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:e.networkQualityTrans(t.uplink_network_quality),downlinkNetworkQuality:e.networkQualityTrans(t.downlink_network_quality)})}else e.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3)},e.clearNetworkQualityTimer=function(){e.networkQualityTimer&&clearInterval(e.networkQualityTimer)},e.networkQualityTrans=function(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0},e.getStatsTimer=setInterval((function(){var t=e.gatewayClient.traffic_stats,n=Date.now();e.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(e.localStats).length&&e.exceptionMonitor.setLocalStats(e.localStats),Object.keys(e.remoteStats).length&&e.exceptionMonitor.setRemoteStats(e.remoteStats);var r={};Object.keys(e.gatewayClient.remoteStreams).forEach((function(i){var o=e.gatewayClient.remoteStreams[i],a=e.remoteStats[i],s={id:i,updatedAt:n};r[i]=s,s.firstFrameTime=o.firstFrameTime,a?(s.audioTotalPlayDuration=a.audioTotalPlayDuration+1,s.audioTotalFreezeTime=a.audioTotalFreezeTime,s.isAudioFreeze=!1,s.isAudioDecodeFailed=!1,s.videoTotalPlayDuration=a.videoTotalPlayDuration+1,s.videoTotalFreezeTime=a.videoTotalFreezeTime,s.isVideoFreeze=!1):(s.audioTotalPlayDuration=1,s.audioTotalFreezeTime=0,s.videoTotalPlayDuration=1,s.videoTotalFreezeTime=0);var c=t&&t.peer_delay&&t.peer_delay.find((function(t){return t.peer_uid==i}));c&&(s.peer_delay=c),o&&(o.isPlaying()&&(s.audioDisabled=o.userMuteAudio||o.peerMuteAudio?"1":"0",s.videoDisabled=o.userMuteVideo||o.peerMuteVideo?"1":"0"),a&&a.peer_delay&&c&&a.peer_delay.stream_type!==c.stream_type&&e.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:i,streamType:c.stream_type}),o.pc&&"established"==o.pc.state&&o.pc.getStats((function(t){if(s.pcStats=t,s.audioStats=t.find((function(t){return"audio"==t.mediaType&&(t.id.indexOf("_recv")>-1||t.id.toLowerCase().indexOf("inbound")>-1)})),s.videoStats=t.find((function(t){return"video"==t.mediaType&&(t.id.indexOf("_recv")>-1||t.id.toLowerCase().indexOf("inbound")>-1)})),a&&a.audioStats&&s.audioStats){var n=parseInt(s.audioStats.bytesReceived)-parseInt(a.audioStats.bytesReceived),r=parseInt(s.audioStats.googDecodingNormal)-parseInt(a.audioStats.googDecodingNormal);if(s.audioStats.audioRecvBytesDelta=n,s.audioStats.audioDecodingNormalDelta=r,e.session.recvBytes+=n,isFinite(n)&&s.audioStats.timestamp){var i=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioRecvBitrate=Math.floor(8*n/i)}e.isAudioFreeze(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.audioTotalFreezeTime++,s.isAudioFreeze=!0),e.isAudioDecodeFailed(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.isAudioDecodeFailed=!0),s.audioStats.audioTotalFreezeTime=s.audioTotalFreezeTime,s.audioStats.audioTotalPlayDuration=s.audioTotalPlayDuration,s.audioStats.audioFreezeRate=Math.ceil(100*s.audioTotalFreezeTime/s.audioTotalPlayDuration)}if(a&&a.videoStats&&s.videoStats){var c=parseInt(s.videoStats.bytesReceived)-parseInt(a.videoStats.bytesReceived);s.videoStats.videoRecvBytesDelta=c,e.session.recvBytes+=c,isFinite(c)&&s.videoStats.timestamp&&(i=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoRecvBitrate=Math.floor(8*c/i)),e.isRemoteVideoFreeze(s.videoStats,a.videoStats)&&(s.videoTotalFreezeTime++,s.isVideoFreeze=!0),s.videoStats.videoTotalFreezeTime=s.videoTotalFreezeTime,s.videoStats.videoTotalPlayDuration=s.videoTotalPlayDuration,s.videoStats.videoFreezeRate=Math.ceil(100*s.videoTotalFreezeTime/s.videoTotalPlayDuration),o.player&&o.player.video&&o.player.video.videoWidth&&o.player.video.videoHeight?(s.videoStats.renderRemoteWidth=o.player.video.videoWidth,s.videoStats.renderRemoteHeight=o.player.video.videoHeight):(s.videoStats.renderRemoteWidth=o.videoWidth||s.videoStats.googFrameWidthReceived,s.videoStats.renderRemoteHeight=o.videoHeight||s.videoStats.googFrameHeightReceived)}})))})),e.remoteStats=r;var i={};if(Object.keys(e.gatewayClient.localStreams).forEach((function(t){var r=e.gatewayClient.localStreams[t],o=e.localStats[t],a={id:t,updatedAt:n};i[t]=a,o?(a.videoTotalPlayDuration=o.videoTotalPlayDuration+1,a.videoTotalFreezeTime=o.videoTotalFreezeTime,a.isVideoFreeze=!1):(a.videoTotalPlayDuration=1,a.videoTotalFreezeTime=0),r&&(r.isPlaying()&&(a.audioDisabled=r.userMuteAudio?"1":"0",a.videoDisabled=r.userMuteVideo?"1":"0"),r.video&&r.attributes.maxVideoBW?a.videoTargetSendBitrate=r.attributes.maxVideoBW:r.video&&r.screenAttributes&&(a.videoTargetSendBitrate=r.screenAttributes.maxVideoBW),r.pc&&"established"==r.pc.state&&r.pc.getStats((function(t){if(a.pcStats=t.reverse(),a.audioStats=t.find((function(t){return"audio"==t.mediaType&&(t.id.indexOf("_send")>-1||t.id.toLowerCase().indexOf("outbound")>-1)})),a.videoStats=t.find((function(t){return"video"==t.mediaType&&(t.id.indexOf("_send")>-1||t.id.toLowerCase().indexOf("outbound")>-1)})),a.audioStats&&o&&o.audioStats){var n=parseInt(a.audioStats.bytesSent)-parseInt(o.audioStats.bytesSent);if(a.audioStats.audioSendBytesDelta=n,e.session.sendBytes+=n,isFinite(n)&&a.audioStats.timestamp){var i=a.audioStats.timestamp.getTime()-o.audioStats.timestamp.getTime();a.audioSendBitrate=Math.floor(8*n/i)}}if(a.videoStats&&o&&o.videoStats){var s=parseInt(a.videoStats.bytesSent)-parseInt(o.videoStats.bytesSent);a.videoStats.videoSendBytesDelta=s,e.session.sendBytes+=s,isFinite(s)&&a.videoStats.timestamp&&(i=a.videoStats.timestamp.getTime()-o.videoStats.timestamp.getTime(),a.videoSendBitrate=Math.floor(8*s/i)),e.isLocalVideoFreeze(a.videoStats,o.videoStats)&&(a.videoTotalFreezeTime++,a.isVideoFreeze=!0),a.videoStats.videoTotalFreezeTime=a.videoTotalFreezeTime,a.videoStats.videoTotalPlayDuration=a.videoTotalPlayDuration,a.videoStats.videoFreezeRate=Math.ceil(100*a.videoTotalFreezeTime/a.videoTotalPlayDuration),a.videoStats.renderLocalWidth=r.videoWidth||a.videoStats.googFrameWidthSent,a.videoStats.renderLocalHeight=r.videoHeight||a.videoStats.googFrameHeightSent}})))})),e.localStats=i,e.session.HTTPSendBytesDelta=Object(x.getHTTPSendBytes)()-e.session.HTTPSendBytes,e.session.HTTPSendBytes=Object(x.getHTTPSendBytes)(),e.session.HTTPRecvBytesDelta=Object(x.getHTTPRecvBytes)()-e.session.HTTPRecvBytes,e.session.HTTPRecvBytes=Object(x.getHTTPRecvBytes)(),e.gatewayClient.socket&&e.gatewayClient.socket.state===e.gatewayClient.CONNECTED){var o=e.gatewayClient.socket;e.session.WSSendBytesDelta=o.getSendBytes()-e.session.WSSendBytes,e.session.WSSendBytes=o.getSendBytes(),e.session.WSRecvBytesDelta=o.getRecvBytes()-e.session.WSRecvBytes,e.session.WSRecvBytes=o.getRecvBytes()}}),1e3),e.gatewayClient.on("join",(function(){e.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}})),e}(e.gatewayClient),e.configDistributManager=function(t){var e={};return e.client=t,e.client.gatewayClient&&e.client.gatewayClient.on("config-distribute",(function(n){var a=n.joinInfo,s=n.config;if(s){Object(L.isEmpty)(s.uploadLog)||(Object(r.setParameter)("UPLOAD_LOG",s.uploadLog),o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:s.uploadLog}})()),Object(L.isEmpty)(s.dualStream)||(t.isDualStream=s.dualStream,o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"dualStream",value:s.dualStream}})()),Object(L.isEmpty)(s.streamFallbackOption)||e.client.gatewayClient&&e.client.gatewayClient.on("stream-subscribed",(function(t){var n=t.stream;n?(e.client.gatewayClient.setStreamFallbackOption(n,s.streamFallbackOption),o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:s.streamFallbackOption,streamId:n.getId()}})()):o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:s.streamFallbackOption,streamId:n.getId(),err:"invalid stream"}})()}));try{i.default.debug("[".concat(t.clientId,"] setParameter in distribution: ").concat(JSON.stringify(s))),Object.keys(s).map((function(t){return Object(r.setParameter)(t,s[t])}))}catch(e){i.default.debug("[".concat(t.clientId,"] setParameter in distribution failed: ").concat(JSON.stringify(s)))}}})),e}(e),Object(B.addLiveStreamingCapability)(e,t),t.areaCode){Object(r.setParameter)("AREA_SETTING",t.areaCode);var n=Object(D.getAreaDomainConfig)(t.areaCode);Object.keys(n).map((function(t){"LOG_UPLOAD_SERVER"==t||"EVENT_REPORT_DOMAIN"==t||"EVENT_REPORT_BACKUP_DOMAIN"==t||"NGINX"==t?Object(r.setParameter)(t,n[t][0]):Object(r.setParameter)(t,n[t])}))}return Object(L.isEmpty)(t.turnServer)||e.setTurnServer(t.turnServer),Object(L.isEmpty)(t.proxyServer)||e.setProxyServer(t.proxyServer),"live"===e.mode&&(e.gatewayClient.role="audience"),"rtc"===e.mode&&(e.gatewayClient.role=F),e.gatewayClient.on("onMultiIP",(function(t){e.gatewayClient.closeGateway(),e.gatewayClient.socket=void 0,e.gatewayClient.hasChangeBGPAddress=!0,e.joinInfo.multiIP=t.option,e.gatewayClient.state=E.a.CONNECTING;var n=function(t){i.default.info("[".concat(e.clientId,"] Joining channel: ").concat(e.channel)),e.joinInfo.cid=t.cid,e.joinInfo.uid||(e.joinInfo.uid=t.uid),e.joinInfo.uni_lbs_ip=t.uni_lbs_ip,e.joinInfo.gatewayAddr=t.gateway_addr,e.onSuccess?e.gatewayClient.join(e.joinInfo,e.key,(function(t){i.default.info("[".concat(e.clientId,"] Join channel ").concat(e.channel," success"));var n=e.onSuccess;e.onSuccess=null,e.onFailure=null,n(t)}),e.onFailure):(e.gatewayClient.joinInfo=w()({},e.joinInfo),e.gatewayClient.rejoin())};e.joinInfo.stringUid&&!e.joinInfo.uid?(e.userAccountReq&&!e.userAccountReq.isFinished()&&e.userAccountReq.cancel(),e.userAccountReq=Object(T.getUserAccount)(joinInfo,e.gatewayClient),e.userAccountReq.then((function(t){i.default.error("getUserAccount Success ".concat(t.url," ").concat(joinInfo.stringUid," => ").concat(t.uid)),e.joinInfo.uid=t.uid,Object(T.getGatewayList)(e.joinInfo,n,e.onFailure)})).catch((function(t){i.default.error("getUserAccount rejected",t),e.onFailure(t)}))):Object(T.getGatewayList)(e.joinInfo,n,e.onFailure)})),e.gatewayClient.on("rejoin-start",(function(){e._renewSession(),o.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),extend:{rejoin:!0},cname:e.channel,appid:t.appId,mode:t.mode,succ:!0})})),e.gatewayClient.on("recover",(function(){e._renewSession(),console.log("recover",t.sessionId),o.report.sessionInit(t.sessionId,{lts:(new Date).getTime(),extend:{recover:!0},cname:e.channel,appid:t.appId,mode:t.mode,succ:!0})})),e.gatewayClient.on("rejoin",(function(){var t=e.highStreamState;if(i.default.debug("[".concat(e.clientId,"] Client local stream preState: ").concat(t)),e.onSuccess){var n=e.onSuccess;e.onSuccess=null,e.onFailure=null,n(e.joinInfo.uid)}!e.highStream||0!==t&&1!==t||(i.default.info("[".concat(e.clientId,"] publish after rejoin")),e.highStreamState=2,e.lowStreamState=2,e.publish(e.highStream,(function(t){t&&i.default.info("[".concat(e.clientId,"] "),t)})))})),e.gatewayClient.on("streamPublished",(function(t){e.hasPublished||(e.hasPublished=!0,e.gatewayClient.dispatchEvent({type:"stream-published",stream:t.stream,proxy:t.proxy}))})),e.gatewayClient.on("pubP2PLost",(function(t){i.default.debug("[".concat(e.clientId,"] Start reconnect local peerConnection: ").concat(e.highStream.getId())),e.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:e.highStream.getId()}),1===e.highStreamState&&(e.highStreamState=0,e.lowStreamState=0),e._unpublish(e.highStream,(function(){e._publish(e.highStream,(function(){i.default.debug("[".concat(e.clientId,"] Reconnect local peerConnection success: ").concat(e.highStream.getId())),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.highStream.getId(),success:!0,reason:""})}),(function(t){i.default.debug("[".concat(e.clientId,"] Reconnect local peerConnection failed: ").concat(t)),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.highStream.getId(),success:!1,reason:t})}),!0)}),(function(t){i.default.debug("[".concat(e.clientId,"] Reconnect local peerConnection failed: ").concat(t)),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.highStream.getId(),success:!1,reason:t})}),!0)})),e.gatewayClient.on("subP2PLost",(function(t){i.default.debug("[".concat(e.clientId,"] Start reconnect remote peerConnection: ").concat(t.stream.getId()," ").concat(t.stream.subscribeOptions)),e.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:t.stream.getId()});var n=t.stream.subscribeOptions;console.log("Re-subscribe stream",n,t.stream),e.gatewayClient.unsubscribe(t.stream,(function(){t.stream.subscribeOptions=n,e.gatewayClient.subscribe(t.stream,(function(){i.default.debug("[".concat(e.clientId,"] Reconnect remote peerConnection success: ").concat(t.stream.getId())),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!0,reason:""})}),(function(n){i.default.debug("[".concat(e.clientId,"] Reconnect remote peerConnection failed: "),n),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!1,reason:n})}))}),(function(n){i.default.debug("[".concat(e.clientId,"] Reconnect remote peerConnection failed: "),n),e.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.stream.getId(),success:!1,reason:n})}))})),k.on("networkTypeChanged",(function(t){e.gatewayClient&&e.gatewayClient.dispatchEvent(t);var n=w()({},t,{type:"network-type-changed"});e.gatewayClient.dispatchEvent(n)})),d.a.on("recordingDeviceChanged",(function(t){e.gatewayClient&&e.gatewayClient.dispatchEvent(t);var n=w()({},t,{type:"recording-device-changed"});e.gatewayClient.dispatchEvent(n)})),d.a.on("playoutDeviceChanged",(function(t){e.gatewayClient&&e.gatewayClient.dispatchEvent(t);var n=w()({},t,{type:"playout-device-changed"});e.gatewayClient.dispatchEvent(n)})),d.a.on("cameraChanged",(function(t){e.gatewayClient&&e.gatewayClient.dispatchEvent(t);var n=w()({},t,{type:"camera-changed"});e.gatewayClient.dispatchEvent(n)})),e.gatewayClient.on("streamTypeChange",(function(n){var r=w()({},n,{type:"stream-type-changed"});e.gatewayClient.dispatchEvent(r),o.report.reportApiInvoke(t.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(n))})),e},j=function(t){switch(t){case"h264_interop":return"h264";default:return"vp8"}},V=function(t){return-1===v.indexOf(t.mode)?_.default.INVALID_CLIENT_MODE:-1===m.indexOf(t.codec)?_.default.INVALID_CLIENT_CODEC:"h264_interop"==t.mode&&"h264"!==t.codec&&_.default.CLIENT_MODE_CODEC_MISMATCH},G=function(t){switch(t.mode){case"interop":case"h264_interop":t.mode="live";break;case"web-only":t.mode="rtc"}},Q=d.a.getDevices,z=h.a.getScreenSources,q=JSON.parse(JSON.stringify(r.SUPPORT_RESOLUTION_LIST));e.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:{width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},createClient:function(t){var e=o.report.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(t=w()({},t||{})).codec||(t.codec=j(t.mode));var n=V(t);if(n)throw i.default.error("Invalid parameter setting MODE: ".concat(t.mode," CODEC: ").concat(t.codec," ERROR ").concat(n)),e(n),new Error(n);return i.default.info("Creating client, MODE: ".concat(t.mode," CODEC: ").concat(t.codec)),G(t),e(null,t),H(t)},createStream:l.b,Logger:i.default,report:o.report,getDevices:Q,getScreenSources:z,getParameter:r.getParameter,setParameter:r.setParameter,checkSystemRequirements:function(){var t=o.report.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket,a=!!e&&!!n&&!!r,c=!1;s.isChrome()&&s.getBrowserVersion()>=58&&"iOS"!==s.getBrowserOS()&&(c=!0),s.isFireFox()&&s.getBrowserVersion()>=56&&(c=!0),s.isOpera()&&s.getBrowserVersion()>=45&&(c=!0),s.isSafari()&&s.getBrowserVersion()>=11&&(c=!0),s.isEdge()&&(c=!0),(s.isWeChatBrowser()||s.isQQBrowser())&&"iOS"!==s.getBrowserOS()&&(c=!0),s.isSupportedPC()||s.isSupportedMobile()||(c=!1),i.default.debug(s.getBrowserInfo(),"isAPISupport: "+a+", isVendorAndVersionSupport: "+c);var u=a&&c;return t(null,u),u},getSupportedCodec:f.getSupportedCodec,ChannelMediaRelayConfiguration:p.ChannelMediaRelayConfiguration,VERSION:r.VERSION,BUILD:r.BUILD,PROFILE_TABLE:q,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2,AREAS:D.AREAS,AREA_VERSION:"global"}}]).default})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AgoraRTM=e()}(this,(function(){function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pd(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function K(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){function o(t){Pd(s,r,i,o,a,"next",t)}function a(t){Pd(s,r,i,o,a,"throw",t)}var s=t.apply(e,n);o(void 0)}))}}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function al(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ea(t,e,n){return e&&al(t.prototype,e),n&&al(t,n),t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ja(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bl(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ka(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qe(t,e)}function kd(t){return(kd=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qe(t,e){return(Qe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function cl(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ch(t,e,n){return(Ch=cl()?Reflect.construct:function(t,e,n){var r=[null];return r.push.apply(r,e),t=new(Function.bind.apply(t,r)),n&&Qe(t,n.prototype),t}).apply(null,arguments)}function Re(t){var e="function"==typeof Map?new Map:void 0;return(Re=function(t){function n(){return Ch(t,arguments,kd(this).constructor)}if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Qe(n,t)})(t)}function Se(t,e){if(null==t)return{};if(null==t)var n={};else{n={};var r,i=Object.keys(t);for(r=0;r<i.length;r++){var o=i[r];0<=e.indexOf(o)||(n[o]=t[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(t),o=0;o<r.length;o++)i=r[o],0<=e.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i]);return n}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function la(t){var e=cl();return function(){var r=kd(t);if(e){var i=kd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function Dh(t,e,n){return(Dh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kd(t)););if(t)return(e=Object.getOwnPropertyDescriptor(t,e)).get?e.get.call(n):e.value})(t,e,n||t)}function pa(t,e){var n=Array.isArray(t)?t:void 0;if(!n)if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){n=[];var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}else n=void 0;if(!(t=n||dl(t,e)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function I(t){var e=Array.isArray(t)?Eh(t):void 0;if(e||(e="undefined"!=typeof Symbol&&Symbol.iterator in Object(t)?Array.from(t):void 0),!(t=e||dl(t)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function dl(t,e){if(t){if("string"==typeof t)return Eh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Eh(t,e)}}function Eh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function da(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}function Xa(t){var e={exports:{}};return t(e,e.exports),e.exports}function el(t,e){var n,r=3>arguments.length?t:arguments[2];return qa(t)===r?t[e]:(n=Db.f(t,e))?P(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ea(n=Rb(t))?el(n,e,r):void 0}function Nr(t){var e=t.charCodeAt(0)<<24,n=0|Or(~e),r=0,i=0|t.length,o="";if(5>n&&i>=n){for(e=e<<n>>>24+n,r=1;r<n;r=r+1|0)e=e<<6|63&t.charCodeAt(r);65535>=e?o+=ld(e):1114111>=e?o+=ld(55296+((e=e-65536|0)>>10)|0,56320+(1023&e)|0):r=0}for(;r<i;r=r+1|0)o+="�";return o}function fl(){}function Pr(t){var e=0|t.charCodeAt(0);if(55296<=e&&56319>=e){var n=0|t.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return ld(239,191,189);if(65535<(e=(e-55296<<10)+n-56320+65536|0))return ld(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|63&e)}return 127>=e?t:2047>=e?ld(192|e>>>6,128|63&e):ld(224|e>>>12,128|e>>>6&63,128|63&e)}function gl(){}function aa(){aa.init.call(this)}function Zf(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+R(t))}function hl(t,e,n,r){Zf(n);var i=t._events;if(void 0===i)i=t._events=Object.create(null),t._eventsCount=0;else{void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events);var o=i[e]}return void 0===o?(i[e]=n,++t._eventsCount):("function"==typeof o?o=i[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===t._maxListeners?aa.defaultMaxListeners:t._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=o.length,console&&console.warn&&console.warn(n))),t}function Qr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function il(t,e,n){return t={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},(e=Qr.bind(t)).listener=n,t.wrapFn=e}function jl(t,e,n){if(void 0===(t=t._events))return[];if(void 0===(e=t[e]))return[];if("function"==typeof e)return n?[e.listener||e]:[e];if(n)for(n=Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];else n=kl(e,e.length);return n}function ll(t){var e=this._events;if(void 0!==e){if("function"==typeof(t=e[t]))return 1;if(void 0!==t)return t.length}return 0}function kl(t,e){for(var n=Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Rr(t){return t?I(t):Sr((function(){return[]}),(function(t,e){return t.push(e),t}))}function ml(t,e){var n,r,i,o;return w.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=nl(t)([Fh,Fh,function(t,e){return e}])[2],r=0;case 2:if(!(r<e.length)){a.next=17;break}if(i=e[r],!((o=n(Gh,i))instanceof $f)){a.next=11;break}if((o=Hh(o.deref()))===Gh){a.next=10;break}return a.next=10,o;case 10:return a.abrupt("return");case 11:if(o===Gh){a.next=14;break}return a.next=14,o;case 14:r++,a.next=2;break;case 17:case"end":return a.stop()}}),Tr)}function ag(t,e){return null!=e&&"function"==typeof e[Symbol.iterator]?ml(ag(t),e):function(e){var n=e[2];return Ur(e,(function(e,r){return n(e,t(r))}))}}function md(t){return"Object"===Object.prototype.toString.call(t).slice(8,-1)&&t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function nd(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Qd(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Rd(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Te(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new bg;++e<n;)this.add(t[e])}function Sd(t){this.size=(this.__data__=new cg(t)).size}function dg(t,e,n,r,i,o){var a,s=1&e,c=2&e,u=4&e;if(n&&(a=i?n(t,r,i,o):n(t)),void 0!==a)return a;if(!jb(t))return t;if(r=Ya(t)){if(a=Vr(t),!s)return Ih(t,a)}else{var l=Ue(t),d="[object Function]"==l||"[object GeneratorFunction]"==l;if(Ve(t))return ol(t,s);if("[object Object]"==l||"[object Arguments]"==l||d&&!i){if(a=c||d?{}:pl(t),!s)return c?Wr(t,Xr(a,t)):Yr(t,Zr(a,t))}else{if(!ra[l])return i?t:{};a=$r(t,l,s)}}if(o||(o=new Td),i=o.get(t))return i;o.set(t,a),as(t)?t.forEach((function(r){a.add(dg(r,e,n,r,t,o))})):bs(t)&&t.forEach((function(r,i){a.set(i,dg(r,e,n,i,t,o))})),c=u?c?ql:Jh:c?We:Rc;var h=r?void 0:c(t);return cs(h||t,(function(r,i){h&&(r=t[i=r]),rl(a,i,dg(r,e,n,i,t,o))})),a}function Kh(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=t.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Kh.Cache||bg),n}function sl(t){if("string"==typeof t)return t;if(Ya(t))return Ud(t,sl)+"";if(Vd(t))return tl?tl.call(t):"";var e=t+"";return"0"==e&&1/t==-ds?"-0":e}function Lh(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=es),i||(i=[]);++o<a;){var s=t[o];0<e&&n(s)?1<e?Lh(s,e-1,n,r,i):Mh(i,s):r||(i[i.length]=s)}return i}function Wd(t,e,n,r,i){if(t===e)e=!0;else if(null==t||null==e||!cc(t)&&!cc(e))e=t!=t&&e!=e;else t:{var o=Ya(t),a=Ya(e),s=o?"[object Array]":Ue(t),c=a?"[object Array]":Ue(e),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(a="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&Ve(t)){if(!Ve(e)){e=!1;break t}o=!0,u=!1}if(c&&!u)i||(i=new Td),e=o||Nh(t)?ul(t,e,n,r,Wd,i):fs(t,e,s,n,r,Wd,i);else{if(!(1&n)&&(o=u&&vl.call(t,"__wrapped__"),s=a&&vl.call(e,"__wrapped__"),o||s)){t=o?t.value():t,e=s?e.value():e,i||(i=new Td),e=Wd(t,e,n,r,i);break t}if(c)e:if(i||(i=new Td),o=1&n,s=Jh(t),a=s.length,c=Jh(e).length,a==c||o){for(c=a;c--;){var l=s[c];if(!(o?l in e:gs.call(e,l))){e=!1;break e}}if(u=i.get(t),l=i.get(e),u&&l)e=u==e&&l==t;else{u=!0,i.set(t,e),i.set(e,t);for(var d=o;++c<a;){var h=t[l=s[c]],f=e[l];if(r)var p=o?r(f,h,l,e,t,i):r(h,f,l,t,e,i);if(void 0===p?h!==f&&!Wd(h,f,n,r,i):!p){u=!1;break}d||(d="constructor"==l)}u&&!d&&(n=t.constructor)!=(r=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(t),i.delete(e),e=u}}else e=!1;else e=!1}}return e}function sa(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function kb(t){return!0===(t&&t.__isLong__)}function od(t,e){var n;if(e){if((e=0<=(t>>>=0)&&256>t)&&(n=wl[t]))return n;n=ta(t,0>(0|t)?-1:0,!0),e&&(wl[t]=n)}else{if((e=-128<=(t|=0)&&128>t)&&(n=xl[t]))return n;n=ta(t,0>t?-1:0,!1),e&&(xl[t]=n)}return n}function Eb(t,e){if(isNaN(t))return e?pd:Fb;if(e){if(0>t)return pd;if(t>=yl)return zl}else{if(t<=-Al)return lb;if(t+1>=Al)return Bl}return 0>t?Eb(-t,e).neg():ta(t%Xd|0,t/Xd|0,e)}function ta(t,e,n){return new sa(t,e,n)}function Oh(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return Fb;if("number"==typeof e?(n=e,e=!1):e=!!e,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=t.indexOf("-")))throw Error("interior hyphen");if(0===r)return Oh(t.substring(1),e,n).neg();r=Eb(eg(n,8));for(var i=Fb,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),s=parseInt(t.substring(o,o+a),n);8>a?(a=Eb(eg(n,a)),i=i.mul(a).add(Eb(s))):i=(i=i.mul(r)).add(Eb(s))}return i.unsigned=e,i}function Sb(t,e){return"number"==typeof t?Eb(t,e):"string"==typeof t?Oh(t,e):ta(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}function M(t,e){function n(){this.constructor=t}Ph(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Yd(t){return"function"==typeof t}function Zd(t){setTimeout((function(){throw t}),0)}function Qh(t){return null!==t&&"object"===R(t)}function Cl(t){return t.reduce((function(t,e){return t.concat(e instanceof Xe?e.errors:e)}),[])}function Rh(t){for(;t;){var e=t.destination,n=t.isStopped;if(t.closed||n)return!1;t=e&&e instanceof fa?e:null}return!0}function Sc(t){return t}function Sh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Dl(t)}function Dl(t){return 0===t.length?Sc:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}function El(t){if(t||(t=Gb.Promise||Promise),!t)throw Error("no Promise impl found");return t}function Fl(){return function(t){return t.lift(new hs(t))}}function Ye(t){return t?is(t):dc}function is(t){return new V((function(e){return t.schedule((function(){return e.complete()}))}))}function Tc(t){return t&&"function"==typeof t.schedule}function Th(t,e){return new V((function(n){var r=new Ka,i=0;return r.add(e.schedule((function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||r.add(this.schedule()))}))),r}))}function Ze(t,e){return e?Th(t,e):new V(Gl(t))}function mb(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Tc(e=t[t.length-1])?(t.pop(),Th(t,e)):Ze(t)}function ba(t,e){return new V(e?function(n){return e.schedule(js,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function js(t){t.subscriber.error(t.error)}function ks(t,e){return void 0===e&&(e=0),function(n){return n.lift(new ls(t,e))}}function Hl(t){return t in Uh&&(delete Uh[t],!0)}function ec(){}function Z(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ms(t,e))}}function Il(t,e,n){if(e){if(!Tc(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return Il(t,n).apply(void 0,r).pipe(Z((function(t){return Hb(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,o=this,a={context:o,subject:i,callbackFunc:t,scheduler:n};return new V((function(r){if(n)return n.schedule(ns,0,{args:e,subscriber:r,params:a});if(!i){i=new $e;try{t.apply(o,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.next(1>=t.length?t[0]:t),i.complete()}]))}catch(t){Rh(i)?i.error(t):console.warn(t)}}return i.subscribe(r)}))}}function ns(t){var e=this,n=t.args,r=t.subscriber,i=t.params;t=i.callbackFunc;var o=i.context,a=i.scheduler,s=i.subject;if(!s){s=i.subject=new $e,i=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.add(a.schedule(os,0,{value:1>=t.length?t[0]:t,subject:s}))};try{t.apply(o,n.concat([i]))}catch(t){s.error(t)}}this.add(s.subscribe(r))}function os(t){var e=t.subject;e.next(t.value),e.complete()}function Jl(t,e,n){if(e){if(!Tc(e))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return Jl(t,n).apply(void 0,r).pipe(Z((function(t){return Hb(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i={subject:void 0,args:e,callbackFunc:t,scheduler:n,context:this};return new V((function(r){var o=i.context,a=i.subject;if(n)return n.schedule(ps,0,{params:i,subscriber:r,context:o});if(!a){a=i.subject=new $e;try{t.apply(o,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(e=t.shift())?a.error(e):(a.next(1>=t.length?t[0]:t),a.complete())}]))}catch(t){Rh(a)?a.error(t):console.warn(t)}}return a.subscribe(r)}))}}function ps(t){var e=this,n=t.params,r=t.subscriber;t=t.context;var i=n.callbackFunc,o=n.args,a=n.scheduler,s=n.subject;if(!s){s=n.subject=new $e,n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(n=t.shift())?e.add(a.schedule(Kl,0,{err:n,subject:s})):e.add(a.schedule(qs,0,{value:1>=t.length?t[0]:t,subject:s}))};try{i.apply(t,o.concat([n]))}catch(t){this.add(a.schedule(Kl,0,{err:t,subject:s}))}}this.add(s.subscribe(r))}function qs(t){var e=t.subject;e.next(t.value),e.complete()}function Kl(t){t.subject.error(t.err)}function Ll(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}function Vh(t,e,n,r,i){if(void 0===i&&(i=new rs(t,n,r)),!i.closed)return e instanceof V?e.subscribe(i):af(e)(i)}function ss(t,e){return new V((function(n){var r=new Ka;return r.add(e.schedule((function(){var i=t[$d]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}function ts(t,e){return new V((function(n){var r=new Ka;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}function us(t,e){if(!t)throw Error("Iterable cannot be null");return new V((function(n){var r,i=new Ka;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[Uc](),i.add(e.schedule((function(){if(!n.closed){try{var t=r.next(),e=t.value,i=t.done}catch(t){return void n.error(t)}i?n.complete():(n.next(e),this.schedule())}})))}))),i}))}function Ml(t,e){if(null!=t){if(t&&"function"==typeof t[$d])return ss(t,e);if(Ll(t))return ts(t,e);if(Nl(t))return Th(t,e);if(t&&"function"==typeof t[Uc]||"string"==typeof t)return us(t,e)}throw new TypeError((null!==t&&R(t)||t)+" is not observable")}function Ib(t,e){return e?Ml(t,e):t instanceof V?t:new V(af(t))}function fc(t,e){if(!e.closed)return t instanceof V?t.subscribe(e):af(t)(e)}function eb(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(eb((function(n,r){return Ib(t(n,r)).pipe(Z((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new vs(t,n))})}function Wh(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),eb(Sc,t)}function Ol(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Wh(1)(mb.apply(void 0,t))}function qd(t){return new V((function(e){try{var n=t()}catch(t){return void e.error(t)}return(n?Ib(n):Ye()).subscribe(e)}))}function Pl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if(Hb(n))return fg(n,null);if(Qh(n)&&Object.getPrototypeOf(n)===Object.prototype)return fg((t=Object.keys(n)).map((function(t){return n[t]})),t)}if("function"==typeof t[t.length-1]){var r=t.pop();return fg(t=1===t.length&&Hb(t[0])?t[0]:t,null).pipe(Z((function(t){return r.apply(void 0,t)})))}return fg(t,null)}function fg(t,e){return new V((function(n){var r=t.length;if(0===r)n.complete();else for(var i=Array(r),o=0,a=0,s=function(s){var c=Ib(t[s]),u=!1;n.add(c.subscribe({next:function(t){u||(u=!0,a++),i[s]=t},error:function(t){return n.error(t)},complete:function(){++o!==r&&u||(a===r&&n.next(e?e.reduce((function(t,e,n){return t[e]=i[n],t}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c)}))}function fb(t,e,n,r){return Yd(n)&&(r=n,n=void 0),r?fb(t,e,n).pipe(Z((function(t){return Hb(t)?r.apply(void 0,t):r(t)}))):new V((function(r){Ql(t,e,(function(t){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(t)}),r,n)}))}function Ql(t,e,n,r,i){if(t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener){t.addEventListener(e,n,i);var o=function(){return t.removeEventListener(e,n,i)}}else if(t&&"function"==typeof t.on&&"function"==typeof t.off)t.on(e,n),o=function(){return t.off(e,n)};else if(t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener)t.addListener(e,n),o=function(){return t.removeListener(e,n)};else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var a=0,s=t.length;a<s;a++)Ql(t[a],e,n,r,i)}r.add(o)}function Rl(t,e,n){return n?Rl(t,e).pipe(Z((function(t){return Hb(t)?n.apply(void 0,t):n(t)}))):new V((function(n){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1===t.length?t[0]:t)};try{var i=t(r)}catch(t){return void n.error(t)}if(Yd(e))return function(){return e(r,i)}}))}function ws(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var r=void 0;try{r=n(t.state)}catch(t){return void e.error(t)}if(!r)return void e.complete();if(e.closed)return}try{var i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}}function Xh(t){return!Hb(t)&&0<=t-parseFloat(t)+1}function Sl(t,e){return void 0===t&&(t=0),void 0===e&&(e=Vc),(!Xh(t)||0>t)&&(t=0),e&&"function"==typeof e.schedule||(e=Vc),new V((function(n){return n.add(e.schedule(xs,t,{subscriber:n,counter:0,period:t})),n}))}function xs(t){var e=t.subscriber,n=t.counter;t=t.period,e.next(n),this.schedule({subscriber:e,counter:n+1,period:t},t)}function Tb(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];e=Number.POSITIVE_INFINITY;var n=null,r=t[t.length-1];return Tc(r)?(n=t.pop(),1<t.length&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof r&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof V?t[0]:Wh(e)(Ze(t,n))}function Yh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return dc;var n=t[0],r=t.slice(1);return 1===t.length&&Hb(n)?Yh.apply(void 0,n):new V((function(t){var e=function(){return t.add(Yh.apply(void 0,r).subscribe(t))};return Ib(n).subscribe({next:function(e){t.next(e)},error:e,complete:e})}))}function ys(t){var e=t.keys,n=t.index,r=t.subscriber,i=t.subscription;if(t=t.obj,!r.closed)if(n<e.length){var o=e[n];r.next([o,t[o]]),i.add(this.schedule({keys:e,index:n+1,subscriber:r,subscription:i,obj:t}))}else r.complete()}function zs(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}function nb(t,e){return function(n){return n.lift(new As(t,e))}}function ya(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!Hb(t[0]))return t[0];t=t[0]}return Ze(t,void 0).lift(new Bs)}function Cs(t){var e=t.start,n=t.index,r=t.subscriber;n>=t.count?r.complete():(r.next(e),r.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}function uc(t,e,n){void 0===t&&(t=0);var r=-1;return Xh(e)?r=1>Number(e)?1:Number(e):Tc(e)&&(n=e),Tc(n)||(n=Vc),new V((function(e){var i=Xh(t)?t:+t-n.now();return n.schedule(Ds,i,{index:0,period:r,subscriber:e})}))}function Ds(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}function Zh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"function"==typeof(e=t[t.length-1])&&t.pop(),Ze(t,void 0).lift(new Es(e))}function Ga(t){return function(e){var n=new Fs(t);return e=e.lift(n),n.caught=e}}function $h(t,e){return eb(t,e,1)}function Tl(t){return void 0===t&&(t=null),function(e){return e.lift(new Gs(t))}}function Wc(t,e){void 0===e&&(e=Vc);var n=t instanceof Date&&!isNaN(+t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new Hs(n,e))}}function Ul(t,e){return function(n){return n.lift(new Is(t,e))}}function rd(t){return void 0===t&&(t=Js),function(e){return e.lift(new Ks(t))}}function Js(){return new gg}function Pa(t){return function(e){return 0===t?Ye():e.lift(new Ls(t))}}function Vl(t,e){return e?function(n){return n.pipe(Vl((function(n,r){return Ib(t(n,r)).pipe(Z((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new Ms(t))}}function hg(t){return function(e){return e.lift(new Ns(t))}}function X(t,e){var n=2<=arguments.length;return function(r){return r.pipe(t?nb((function(e,n){return t(e,n,r)})):Sc,Pa(1),n?Tl(e):rd((function(){return new gg})))}}function Os(){return function(t){return t.lift(new Ps)}}function Wl(t){return function(e){return 0===t?Ye():e.lift(new Qs(t))}}function bf(t){return function(e){return e.lift(new Rs(t))}}function ig(t,e){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new Ss(t,e,n))}}function Xl(t,e){return 2<=arguments.length?function(n){return Sh(ig(t,e),Wl(1),Tl(e))(n)}:function(e){return Sh(ig((function(e,n,r){return t(e,n,r+1)})),Wl(1))(e)}}function Ts(t,e){return function(n){var r="function"==typeof t?t:function(){return t};if("function"==typeof e)return n.lift(new Us(r,e));var i=Object.create(n,Vs);return i.source=n,i.subjectFactory=r,i}}function ae(t){return function(e){return e.lift(new Ws(t,e))}}function Xs(){return new La}function be(){return function(t){return Fl()(Ts(Xs)(t))}}function Yl(t,e,n){var r=t&&"object"===R(t)?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n};return function(t){return t.lift(Ys(r))}}function Ys(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=t.windowTime)?Number.POSITIVE_INFINITY:r,a=t.refCount,s=t.scheduler,c=0,u=!1,l=!1;return function(t){if(c++,!e||u){u=!1;var r=(e=new ce(i,o,s)).subscribe(this);n=t.subscribe({next:function(t){e.next(t)},error:function(t){u=!0,e.error(t)},complete:function(){l=!0,n=void 0,e.complete()}})}else r=e.subscribe(this);this.add((function(){c--,r.unsubscribe(),n&&!l&&a&&0===c&&(n.unsubscribe(),e=n=void 0)}))}}function vc(t,e){return"function"==typeof e?function(n){return n.pipe(vc((function(n,r){return Ib(t(n,r)).pipe(Z((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new Zs(t))}}function ob(t){return function(e){return e.lift(new $s(t))}}function at(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new bt(t,e))}}function Y(t,e,n){return function(r){return r.lift(new ct(t,e,n))}}function dt(t,e,n){return void 0===e&&(e=Vc),void 0===n&&(n=et),function(r){return r.lift(new ft(t,e,n.leading,n.trailing))}}function gt(t){t.subscriber.clearThrottle()}function ht(t,e,n){return void 0===n&&(n=Vc),function(r){var i=t instanceof Date&&!isNaN(+t),o=i?+t-n.now():Math.abs(t);return r.lift(new it(o,i,e,n))}}function Za(t,e){return void 0===e&&(e=Vc),ht(t,ba(new pb),e)}function jt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new kt(t,n))}}function Zl(t,e,n,r,i){t!==e&&$l(e,(function(o,a){if(i||(i=new Td),jb(o)){o=i;var s=ai(t,a),c=ai(e,a),u=o.get(c);if(u)bi(t,a,u);else{var l=void 0===(u=r?r(s,c,a+"",t,e,o):void 0);if(l){var d=Ya(c),h=!d&&Ve(c),f=!d&&!h&&Nh(c);u=c,d||h||f?Ya(s)?u=s:cc(s)&&sd(s)?u=Ih(s):h?(l=!1,u=ol(c,!0)):f?(l=!1,u=am(c,!0)):u=[]:bm(c)||cf(c)?(u=s,cf(s)?u=de(s,We(s)):jb(s)&&!ci(s)||(u=pl(c))):l=!1}l&&(o.set(c,u),Zl(u,c,n,r,o),o.delete(c)),bi(t,a,u)}}else void 0===(s=r?r(ai(t,a),o,a+"",t,e,i):void 0)&&(s=o),bi(t,a,s)}),We)}function lt(t){var e=1,n=di;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?e=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(e=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=e||1;return function(e){return e.pipe(ig((function(e,i){var o=n.now(),a=o-t;if((e=e.filter((function(t){return t.until>a}))).length>=r){var s=e[e.length-1],c=e[0].until+t*Math.floor(e.length/r);e.push({delay:s.until<o?c-o:c-s.until,until:c,value:i})}else e.push({delay:0,until:o,value:i});return e}),[]),Z((function(t){return t[t.length-1]})),$h((function(t){var e=mb(t.value);return t.delay?e.pipe(Wc(t.delay,n)):e})))}}function mt(t,e){var n=(e=void 0===e?{protocols:cm,makeWebSocket:dm}:e).protocols,r=void 0===n?cm:n,i=void 0===(e=e.makeWebSocket)?dm:e;return new V((function(e){var n,o=new La,a=i(t,r),s=!1,c=!1,u=function(t){if(n)throw s=!0,t=Error("Web socket message factory function called more than once"),e.error(t),t;return n=t.subscribe((function(t){a.send(t)})),o};return a.onopen=function(){c?(s=!0,a.close()):e.next(u)},a.onmessage=function(t){o.next(t.data)},a.onerror=function(t){s=!0,e.error(Error(t.message))},a.onclose=function(t){s||(s=!0,c?(e.complete(),o.complete()):e.error(Error(1e3===t.code?"Normal closure":t.reason)))},function(){c=!0,n&&n.unsubscribe(),s||(s=!0,a.close())}}))}function jg(){this._listeners={}}function em(t){return"undefined"!=typeof Float32Array?function(){function e(t,e,n){o[0]=t,e[n]=a[0],e[n+1]=a[1],e[n+2]=a[2],e[n+3]=a[3]}function n(t,e,n){o[0]=t,e[n]=a[3],e[n+1]=a[2],e[n+2]=a[1],e[n+3]=a[0]}function r(t,e){return a[0]=t[e],a[1]=t[e+1],a[2]=t[e+2],a[3]=t[e+3],o[0]}function i(t,e){return a[3]=t[e],a[2]=t[e+1],a[1]=t[e+2],a[0]=t[e+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];t.writeFloatLE=s?e:n,t.writeFloatBE=s?n:e,t.readFloatLE=s?r:i,t.readFloatBE=s?i:r}():function(){function e(t,e,n,r){var i=0>e?1:0;if(i&&(e=-e),0===e)t(0<1/e?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(34028234663852886e22<e)t((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>e)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2);t((i<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(t,e,n){return n=t(e,n),t=2*(n>>31)+1,e=n>>>23&255,n&=8388607,255===e?n?NaN:1/0*t:0===e?1401298464324817e-60*t*n:t*Math.pow(2,e-150)*(n+8388608)}t.writeFloatLE=e.bind(null,fm),t.writeFloatBE=e.bind(null,gm),t.readFloatLE=n.bind(null,hm),t.readFloatBE=n.bind(null,im)}(),"undefined"!=typeof Float64Array?function(){function e(t,e,n){o[0]=t,e[n]=a[0],e[n+1]=a[1],e[n+2]=a[2],e[n+3]=a[3],e[n+4]=a[4],e[n+5]=a[5],e[n+6]=a[6],e[n+7]=a[7]}function n(t,e,n){o[0]=t,e[n]=a[7],e[n+1]=a[6],e[n+2]=a[5],e[n+3]=a[4],e[n+4]=a[3],e[n+5]=a[2],e[n+6]=a[1],e[n+7]=a[0]}function r(t,e){return a[0]=t[e],a[1]=t[e+1],a[2]=t[e+2],a[3]=t[e+3],a[4]=t[e+4],a[5]=t[e+5],a[6]=t[e+6],a[7]=t[e+7],o[0]}function i(t,e){return a[7]=t[e],a[6]=t[e+1],a[5]=t[e+2],a[4]=t[e+3],a[3]=t[e+4],a[2]=t[e+5],a[1]=t[e+6],a[0]=t[e+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];t.writeDoubleLE=s?e:n,t.writeDoubleBE=s?n:e,t.readDoubleLE=s?r:i,t.readDoubleBE=s?i:r}():function(){function e(t,e,n,r,i,o){var a=0>r?1:0;if(a&&(r=-r),0===r)t(0,i,o+e),t(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(17976931348623157e292<r)t(0,i,o+e),t((a<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)t((r/=5e-324)>>>0,i,o+e),t((a<<31|r/4294967296)>>>0,i,o+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),t(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,o+e),t((a<<31|s+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(t,e,n,r,i){return e=t(r,i+e),r=t(r,i+n),t=2*(r>>31)+1,e=4294967296*(1048575&r)+e,2047==(n=r>>>20&2047)?e?NaN:1/0*t:0===n?5e-324*t*e:t*Math.pow(2,n-1075)*(e+4503599627370496)}t.writeDoubleLE=e.bind(null,fm,0,4),t.writeDoubleBE=e.bind(null,gm,4,0),t.readDoubleLE=n.bind(null,hm,0,4),t.readDoubleBE=n.bind(null,im,4,0)}(),t}function fm(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function gm(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function hm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function im(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}function Ra(t,e){this.lo=t>>>0,this.hi=e>>>0}function df(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function ei(){}function nt(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function ha(){this.len=0,this.tail=this.head=new df(ei,0,0),this.states=null}function fi(t,e,n){e[n]=255&t}function gi(t,e){this.len=t,this.next=void 0,this.val=e}function hi(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)e[n++]=127&t.lo|128,t.lo>>>=7;e[n++]=t.lo}function ii(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function gc(){ji.call(this)}function ot(t,e,n){40>t.length?T.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}function Ub(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Ha(t){this.buf=t,this.pos=0,this.len=t.length}function ki(){var t=new jm(0,0),e=0;if(!(4<this.len-this.pos)){for(;3>e;++e){if(this.pos>=this.len)throw Ub(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;4>e;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return t;if(e=0,4<this.len-this.pos){for(;5>e;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return t}else for(;5>e;++e){if(this.pos>=this.len)throw Ub(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return t}throw Error("invalid varint encoding")}function kg(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function km(){if(this.pos+8>this.len)throw Ub(this,8);return new jm(kg(this.buf,this.pos+=4),kg(this.buf,this.pos+=4))}function td(t){li.call(this,t)}function ef(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");T.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!n}function ua(t){return"string"==typeof t&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(t)&&"null"!==t}function pt(t){try{var e=t.split(".").map((function(t){return Number(t)}))}catch(t){return!1}if(4!==e.length||0===e[0])return!1;for(t=0;t<e.length;t++){var n=e[t];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function lm(t,e){if(!Array.isArray(e)||0===e.length||32<e.length||e.some((function(t){return 0===t.length||32<t.length})))throw new L("arguments is not valid",Fa);if(!ua(t))throw new L("ID is invalid",Fa)}function ff(t){var e=t.attributes,n=t.attrSizeMap,r=t.maxAttrsCount,i=t.maxAttrValueSize;if(t=t.maxTotalSize,!md(e))throw new L("attributes must be an object",Fa);if(Object.keys(e).length>r)throw new gb("Exceed the limit of ".concat(r," attributes"),ee);if(0===Object.keys(e).length)throw new L("The attributes is an empty object",Fa);var o=0,a=0;for(e=Object.entries(e);a<e.length;a++){var s=pa(e[a],2),c=s[1];s=new Blob([s[0]]).size;var u=new Blob([c]).size;if(0===s||32<s)throw new L("Invalid attribute key",Fa);if(u>i)throw new gb("Invalid attribute value, over the limit of ".concat(i," bytes"),ee);if("string"!=typeof c||0===c.length)throw new L("Invalid attribute value",Fa);o+=s,o+=u}if(o>t)throw new gb("The attributes size overflow",ee);if(void 0!==n){if(Object.keys(n).length>r)throw new gb("Exceed the limit of ".concat(r," attributes"),ee);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(a=(e=pa(n[o],2))[1],0===(e=new Blob([e[0]]).size))throw new L("Invalid attribute key",Fa);if(a>i)throw new gb("Invalid attribute value, over the limit of ".concat(i," bytes"),ee);r+=e,r+=a}if(r>t)throw new gb("The attributes size overflow",ee)}}function mi(t,e){return Math.floor(Math.random()*(Math.floor(e)-Math.ceil(t)+1))+t}function lg(){var t=mi(0,4294967295),e=mi(1,4294967295);return new U(t,e,!0)}function Sa(t){return t.toString().padEnd(32,"0")}function mm(t,e){return new TypeError("Unexpected ".concat(t,": ").concat(e))}function nm(t,e){return t=t.split(".").map((function(t){return Number(t)})),e=e.split(".").map((function(t){return Number(t)})),Math.sqrt(1e3*Math.pow(t[0]-e[0],2)+100*Math.pow(t[1]-e[1],2)+10*Math.pow(t[2]-e[2],2)+1*Math.pow(t[3]-e[3],2))}function om(t){return t.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?t.toNumber():t.toString()}function pm(t,e){e="".concat(t).concat(e||"");var n=qm.get(e)||1;return qm.set(e,n+1),"".concat(t).concat(n)}function rm(t,e){var n="number"==typeof e?e:void 0!==e&&"string"!=typeof e?e.code:void 0;return e="number"!=typeof e&&"string"!=typeof e&&void 0!==e&&void 0!==e.serverCode?e.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==e?", server Code ".concat(e):""),t="string"==typeof t&&t?mg(t):Array.isArray(t)&&"string"==typeof t[0]&&t[0]?mg(sm.apply(void 0,[t[0]].concat(I(t.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(t)}function tm(t){return ni.apply(this,arguments)}function ni(){return(ni=K(w.mark((function t(e){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function um(t){return t instanceof Blob||"[object Blob]"===Object.prototype.toString.call(t)}function ng(t){var e=255&t,n=t>>8&255,r=t>>16&255;return"".concat(t>>24&255,".").concat(r,".").concat(n,".").concat(e)}function gf(t,e,n){return oi.apply(this,arguments)}function oi(){return(oi=K(w.mark((function t(e,n,r){var i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,E,_,S,T,C,x,R,I,O;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.body,o=n.headers,a=void 0===o?{}:o,s=n.timeout,c=void 0===s?1e4:s,u=n.signal,l=n.withCredentials,d=void 0!==l&&l,h=(r||{}).useBinaryResponse,f=void 0!==h&&h,(p=new XMLHttpRequest).open("POST",e,!0),p.responseType=f?"arraybuffer":"text",p.withCredentials=d,p.timeout=c,v=i instanceof FormData,m=i instanceof Uint8Array,!(1<(g=Object.keys(a).filter((function(t){return"content-type"===t.toLowerCase()}))).length)){t.next=14;break}throw new RangeError("multiple content-type");case 14:0===g.length&&(m?a["Content-Type"]="application/octet-stream":v||(a["Content-Type"]="application/json"));case 15:if("setRequestHeader"in p){t.next=46;break}return p.abort(),t.next=19,fetch(e,{body:v||m?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:a,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(A=t.sent,!(200<=(y=A.status)&&300>y||304===y)){t.next=31;break}if(!f){t.next=27;break}return t.next=25,A.arrayBuffer();case 25:return b=t.sent,t.abrupt("return",{status:y,responseData:b});case 27:return t.next=29,A.text();case 29:return E=t.sent,t.abrupt("return",{status:y,responseText:E});case 31:return _=new ca(["Post XHR failure, status %d",y]),t.prev=32,t.next=35,A.text();case 35:throw S=t.sent,_.statusCode=y,_.message=S||"Request failed, status ".concat(y),_;case 41:throw t.prev=41,t.t0=t.catch(32),_.statusCode=y,_.message="Request failed, status ".concat(y),_;case 46:if(0!==Object.keys(a).length)for(T=0,C=Object.entries(a);T<C.length;T++)x=pa(C[T],2),R=x[0],I=x[1],p.setRequestHeader(R,I);return void 0!==u&&(O=function t(){p.abort(),u.removeEventListener("abort",t)},u.addEventListener("abort",O)),v||m?p.send(i):p.send(JSON.stringify(i)),t.abrupt("return",new Promise((function(t,e){p.onload=function(){var n=p.status;if(200<=n&&300>n||304===n)t(f?{status:n,responseData:p.response}:{status:n,responseText:p.responseText});else{var r=new ca(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=p.response||"Request failed, status ".concat(p.status),e(r)}},p.ontimeout=function(t){e(new bb(["XHR request timed out after %d ms",c],{originalError:t}))},p.onerror=function(){var t=new ca(["Post XHR failure, status %d",p.status]);t.statusCode=p.status,t.message=p.response||"Request failed, status ".concat(p.status),e(t)},p.onabort=function(){try{e(new DOMException("The request aborted.","AbortError"))}catch(n){var t=Error("The request aborted.");t.name="AbortError",e(t)}}})));case 50:case"end":return t.stop()}}),t,null,[[32,41]])})))).apply(this,arguments)}function wm(t){return ui.apply(this,arguments)}function ui(){return(ui=K(w.mark((function t(e){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new Image).src=e,t.abrupt("return",new Promise((function(t,e){n.onload=function(){t({width:n.width,height:n.height})},n.onerror=e})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function st(t,e){return vi.apply(this,arguments)}function vi(){return(vi=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l,d,h;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.thumbnailHeight,i=void 0===r?0:r,o=e.thumbnailWidth,a=void 0===o?0:o,s=e.width,c=void 0===s?0:s,u=e.height,l=void 0===u?0:u,d=e.thumbnail,h=[],"number"==typeof i&&"number"==typeof a&&"number"==typeof c&&"number"==typeof l){t.next=5;break}throw new L("Invalid message params",jf);case 5:return 0>=c&&0>=l&&h.push(wm(xm(n)).then((function(t){c=t.width,l=t.height}))),0>=a&&0>=i&&void 0!==d&&h.push(wi(d).then(function(){var t=K(w.mark((function t(e){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wm(xm(e));case 2:n=t.sent,a=n.width,i=n.height;case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),t.next=9,Promise.all(h).catch((function(){}));case 9:return t.abrupt("return",{width:c,height:l,thumbnailWidth:a,thumbnailHeight:i});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ym(t,e){if(!md(t))throw new L("message object is not a plain object",e);if(void 0===t.messageType)if(t.rawMessage instanceof Uint8Array){if(t.messageType="RAW",void 0!==t.text)throw new L("Raw messages cannot have text property. Use description instead",e)}else{if("string"!=typeof t.text)throw new L("messageType is undefined",e);if(t.messageType="TEXT",void 0!==t.rawMessage)throw new L("Text messages cannot have rawMessage property",e)}}function pg(t){return xi.apply(this,arguments)}function xi(){return(xi=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,E,_;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.message,r=e.peerId,i=e.toPeer,o=e.session,a=e.errorCodes,s=e.diff,c=e.logger,u=e.options,void 0!==o){t.next=3;break}throw new H("The client is not logged in. Cannot do the operation",a.NOT_LOGGED_IN);case 3:if(l=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){t.next=11;break}if(d=n.text.split("_"),h=pa(d,3),f=h[0],p=h[1],void 0!==h[2]&&ua(p)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===f){t.next=10;break}throw new L("Message is not valid",ge);case 10:l=!0;case 11:if(v=Date.now(),m=o.messageSentTimes.length-1,!((g=o.messageSentTimes[m])&&g+3e3<v)){t.next=18;break}o.messageSentTimes=[v],t.next=29;break;case 18:A=m;case 19:if(!(0<=A)){t.next=28;break}if(!(o.messageSentTimes[A]+3e3<v)){t.next=23;break}return o.messageSentTimes=o.messageSentTimes.slice(A+1,m+1),t.abrupt("break",28);case 23:if(!(180<=m-A+1)){t.next=25;break}throw new gb("Message sent failed, exceeded the 180 message in 3 seconds",a.TOO_OFTEN);case 25:A--,t.next=19;break;case 28:o.messageSentTimes.push(v);case 29:t.t0=n.messageType,t.next="TEXT"===t.t0?32:"RAW"===t.t0?37:"FILE"===t.t0||"IMAGE"===t.t0?39:40;break;case 32:if(!l){t.next=36;break}return y=n.text.split("_"),b=pa(y,3),E=b[1],_=b[2],c.info("[rtm-API] EndCall message send api is called"),t.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:_,channelId:E,callId:"0"}));case 36:return t.abrupt("return",o.sendTextMessage(n.text,r,i,u,1e4-s));case 37:return void 0===n.description&&(n.description=""),t.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,u,1e4-s));case 39:return t.abrupt("return",o.sendMediaMessage(n.messageType,n,r,i,u,1e4-s));case 40:throw new L("Invalid message type",ge);case 41:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tt(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=t.replace(/(https?:\/\/)?(www.)?/i,"");return e||(n=n.split(".").slice(t.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function qg(t,e){function n(n){if(void 0===t)return t;if(!Array.isArray(n)&&!md(n))return n;if(Array.isArray(n))return qg(n,e);var r={},i=0;for(n=Object.entries(n);i<n.length;i++){var o=pa(n[i],2),a=o[1];r[o[0]]=null==a?a:qg(a,e)}return rg(r,e)}return 2<arguments.length&&(e=Array.prototype.slice.call(arguments).slice(1)),Array.isArray(t)?t.map(n):n(t)}function zm(t){return Object.getOwnPropertyNames(t).forEach((function(e){"object"==R(e=t[e])&&null!==e&&zm(e)})),Object.freeze(t)}function na(t){return new TextDecoder("utf-8").decode(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))}function sg(t){return(new TextEncoder).encode(t).length}function Am(){for(var t=0,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(e=0;e<n.length;e++)t+=n[e].length;for(t=new Uint8Array(t),r=e=0;r<n.length;r++){var i=n[r];t.set(i,e),e+=i.length}return t}function Bm(t,e,n){var r=t.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(t=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==e){r[i]=e+"="+encodeURIComponent(n);break}return i==r.length&&r.push(e+"="+encodeURIComponent(n)),t+"?"+r.join("&")}return t+"?"+e+"="+encodeURIComponent(n)}function wi(t){return new Promise((function(e,n){var r=new FileReader;r.onloadend=function(){var t=r.result||new ArrayBuffer(0);e(t)},r.onerror=n,r.readAsArrayBuffer(t)}))}function ut(t,e){t=t=[t],"string"==typeof(e=e||{})&&(e={type:e});try{var n=new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<t.length;r+=1)n.append(t[r]);n=n.getBlob(e.type)}return n}function Cm(t){var e=[];return function t(n){if(null===n||"object"!==R(n))return n;if(-1!==e.indexOf(n))return"[Circular]";if(e.push(n),"function"==typeof n.toJSON)try{var r=t(n.toJSON());return e.pop(),r}catch(t){return"[Throws: "+(t?t.message:"?")+"]"}return Array.isArray(n)?(r=n.map(t),e.pop(),r):(r=Object.keys(n).reduce((function(e,r){t:{if(vt.call(n,r))try{var i=n[r];break t}catch(t){i="[Throws: "+(t?t.message:"?")+"]";break t}i=n[r]}return e[r]=t(i),e}),{}),e.pop(),r)}(t)}function wt(t){if(!(100<(t=String(t)).length)&&(t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t))){var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e}}}function tg(t,e,n,r){return Math.round(t/n)+" "+r+(e>=1.5*n?"s":"")}function ia(t,e,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(t,e));var r=n.value;return n.value=function(){for(var t=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,e].concat(i));try{var a=r.apply(this,i)}catch(t){throw this.logError.apply(this,["".concat(void 0!==t.code?"Error Code ".concat(t.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),e].concat(i)),t.originalError&&this.logError(t.originalError),this.errorTracker(t),t}var s=Date.now();return K(w.mark((function n(){var r,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),t.logError.apply(t,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),e].concat(i)),n.t0.originalError&&t.logError(n.t0.originalError),t.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?t.resultTracker("%s promise resolves after %dms",e,Date.now()-s):t.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-s,r):"Object"!==Object.prototype.toString.call(r).slice(8,-1)||md(r)?t.resultTracker("%s result is %o",e,r):t.resultTracker("%s result is %s",e,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),a},n}function xt(t,e){var n="".concat(t,"Uri");if("number"!=typeof(n=yi[n])||0===n)throw new TypeError("Got Unknown URI Name");return e=new(t=Dm[t])(e),e=t.encode(e).finish(),new yt({uri:n,data:e})}function cb(t,e,n,r){return zi.apply(this,arguments)}function zi(){return(zi=K(w.mark((function t(e,n,r,i){var o,a;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.next=2;break;case 2:return o=zt[e].encode(n).finish(),a=function(){var t=K(w.mark((function t(n){var r,i,s=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(2<(r=1<s.length&&void 0!==s[1]?s[1]:0))){t.next=3;break}return t.abrupt("return");case 3:return i=Bm(i="https://".concat(n,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),i=Bm(i,"id",At[e].toString()),t.next=8,gf(i,{body:o,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(t){return a(n,r+1)}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.prev=4,t.next=7,a(r||"webcollector-rtm.agora.io");case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(4),t.next=13,a(i||"webcollector-rtm.agoraio.cn");case 13:case"end":return t.stop()}}),t,null,[[4,9]])})))).apply(this,arguments)}function db(t){return void 0===t?U.fromNumber(0):U.fromNumber(Date.now()-t)}function Bt(t){return btoa(String.fromCharCode.apply({},t.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map((function(t){return parseInt(t,16)})))).replace(/={1,2}$/,"")}function ug(t,e){return U.fromValue(t).eq(e)}function vg(t,e){var n=void 0===e?t.val:e,r=t.isBoolean;e=t.isNumber;var i=t.oneof,o=t.len;if(2!==[r,e,i].filter((function(t){return!t})).length)throw new TypeError("invalid field type");if(void 0!==n&&(t=!1,void 0!==i&&(i=null==i?[]:Em(i,Rc(i)),Ct(i,ug).length===i.length&&void 0!==Dt(i,(function(t){return ug(n,t)}))&&(t=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,e=void 0!==e&&n.toString(2).length<=o,!(t||r||e)))throw Error("invalid field value")}function Fm(t){return function(){var e=t();if(!e)throw new H("Client is not logged in. Cannot do the operation");return e}}var Ta="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},wg=function(t){return t&&t.Math==Math&&t},B=wg("object"==typeof globalThis&&globalThis)||wg("object"==typeof window&&window)||wg("object"==typeof self&&self)||wg("object"==typeof Ta&&Ta)||function(){return this}()||Function("return this")(),O=function(t){try{return!!t()}catch(t){return!0}},ja=!O((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Gm={}.propertyIsEnumerable,Hm=Object.getOwnPropertyDescriptor,kf=Hm&&!Gm.call({1:2},1)?function(t){return!!(t=Hm(this,t))&&t.enumerable}:Gm,Xc=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Et={}.toString,Vb=function(t){return Et.call(t).slice(8,-1)},Ft="".split,lf=O((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==Vb(t)?Ft.call(t,""):Object(t)}:Object,hb=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},rb=function(t){return lf(hb(t))},ea=function(t){return"object"==typeof t?null!==t:"function"==typeof t},hc=function(t,e){if(!ea(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!ea(r=n.call(t))||"function"==typeof(n=t.valueOf)&&!ea(r=n.call(t))||!e&&"function"==typeof(n=t.toString)&&!ea(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},Gt={}.hasOwnProperty,P=function(t,e){return Gt.call(t,e)},he=B.document,xg=ea(he)&&ea(he.createElement),Im=!ja&&!O((function(){return 7!=Object.defineProperty(xg?he.createElement("div"):{},"a",{get:function(){return 7}}).a})),Jm=Object.getOwnPropertyDescriptor,Db={f:ja?Jm:function(t,e){if(t=rb(t),e=hc(e,!0),Im)try{return Jm(t,e)}catch(t){}if(P(t,e))return Xc(!kf.call(t,e),t[e])}},qa=function(t){if(!ea(t))throw TypeError(String(t)+" is not an object");return t},Km=Object.defineProperty,Ma={f:ja?Km:function(t,e,n){if(qa(t),e=hc(e,!0),qa(n),Im)try{return Km(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},Ia=ja?function(t,e,n){return Ma.f(t,e,Xc(1,n))}:function(t,e,n){return t[e]=n,t},Ai=function(t,e){try{Ia(B,t,e)}catch(n){B[t]=e}return e},ud=B["__core-js_shared__"]||Ai("__core-js_shared__",{}),Ht=Function.toString;"function"!=typeof ud.inspectSource&&(ud.inspectSource=function(t){return Ht.call(t)});var Bi=ud.inspectSource,Lm=B.WeakMap,It="function"==typeof Lm&&/native code/.test(Bi(Lm)),vd=Xa((function(t){(t.exports=function(t,e){return ud[t]||(ud[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.9.0",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})})),Jt=0,Kt=Math.random(),ie=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++Jt+Kt).toString(36)},Mm=vd("keys"),yg=function(t){return Mm[t]||(Mm[t]=ie(t))},je={},Lt=B.WeakMap;if(It)var ke=ud.state||(ud.state=new Lt),Mt=ke.get,Nt=ke.has,Ot=ke.set,Ci=function(t,e){return e.facade=t,Ot.call(ke,t,e),e},zg=function(t){return Mt.call(ke,t)||{}},Di=function(t){return Nt.call(ke,t)};else{var mf=yg("state");je[mf]=!0,Ci=function(t,e){return e.facade=t,Ia(t,mf,e),e},zg=function(t){return P(t,mf)?t[mf]:{}},Di=function(t){return P(t,mf)}}var Ua={set:Ci,get:zg,has:Di,enforce:function(t){return Di(t)?zg(t):Ci(t,{})},getterFor:function(t){return function(e){var n;if(!ea(e)||(n=zg(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Va=Xa((function(t){var e=Ua.get,n=Ua.enforce,r=String(String).split("String");(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof e||P(i,"name")||Ia(i,"name",e);var c=n(i);c.source||(c.source=r.join("string"==typeof e?e:""))}t===B?s?t[e]=i:Ai(e,i):(a?!o&&t[e]&&(s=!0):delete t[e],s?t[e]=i:Ia(t,e,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||Bi(this)}))})),Nm=function(t){return"function"==typeof t?t:void 0},Wb=function(t,e){return 2>arguments.length?Nm(B[t])||Nm(B[t]):B[t]&&B[t][e]||B[t]&&B[t][e]},Pt=Math.ceil,Qt=Math.floor,ic=function(t){return isNaN(t=+t)?0:(0<t?Qt:Pt)(t)},Rt=Math.min,za=function(t){return 0<t?Rt(ic(t),9007199254740991):0},St=Math.max,Tt=Math.min,xb=function(t,e){return 0>(t=ic(t))?St(t+e,0):Tt(t,e)},Om=function(t){return function(e,n,r){e=rb(e);var i=za(e.length);if(r=xb(r,i),t&&n!=n){for(;i>r;)if((n=e[r++])!=n)return!0}else for(;i>r;r++)if((t||r in e)&&e[r]===n)return t||r||0;return!t&&-1}},Pm=Om(!0),Ei=Om(!1),Qm=function(t,e){t=rb(t);var n,r=0,i=[];for(n in t)!P(je,n)&&P(t,n)&&i.push(n);for(;e.length>r;)P(t,n=e[r++])&&(~Ei(i,n)||i.push(n));return i},Ag="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Ut=Ag.concat("length","prototype"),wd={f:Object.getOwnPropertyNames||function(t){return Qm(t,Ut)}},nf={f:Object.getOwnPropertySymbols},Rm=Wb("Reflect","ownKeys")||function(t){var e=wd.f(qa(t)),n=nf.f;return n?e.concat(n(t)):e},Sm=function(t,e){for(var n=Rm(e),r=Ma.f,i=Db.f,o=0;o<n.length;o++){var a=n[o];P(t,a)||r(t,a,i(e,a))}},Vt=/#|\.prototype\./,jc=function(t,e){return(t=Wt[Xt(t)])==Yt||t!=Zt&&("function"==typeof e?O(e):!!e)},Xt=jc.normalize=function(t){return String(t).replace(Vt,".").toLowerCase()},Wt=jc.data={},Zt=jc.NATIVE="N",Yt=jc.POLYFILL="P",$t=Db.f,N=function(t,e){var n,r,i,o=t.target,a=t.global,s=t.stat;if(r=a?B:s?B[o]||Ai(o,{}):(B[o]||{}).prototype)for(i in e){var c=e[i],u=t.noTargetGet?(n=$t(r,i))&&n.value:r[i];if(!(n=jc(a?i:o+(s?".":"#")+i,t.forced))&&void 0!==u){if(typeof c==typeof u)continue;Sm(c,u)}(t.sham||u&&u.sham)&&Ia(c,"sham",!0);try{Va(r,i,c,t)}catch(t){}}},le=function(t,e){var n=[][t];return!!n&&O((function(){n.call(null,e||function(){throw 1},1)}))},au=[].join,bu=lf!=Object,cu=le("join",",");N({target:"Array",proto:!0,forced:bu||!cu},{join:function(t){return au.call(rb(this),void 0===t?",":t)}}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(t){return t!=t}}),B.Number.isNaN;var wc=B.Promise,of=function(t,e,n){for(var r in e)Va(t,r,e[r],n);return t},xc=!!Object.getOwnPropertySymbols&&!O((function(){return!String(Symbol())})),Tm=xc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Bg=vd("wks"),pf=B.Symbol,du=Tm?pf:pf&&pf.withoutSetter||ie,oa=function(t){return P(Bg,t)||(xc&&P(pf,t)?Bg[t]=pf[t]:Bg[t]=du("Symbol."+t)),Bg[t]},eu=Ma.f,Um=oa("toStringTag"),yc=function(t,e,n){t&&!P(t=n?t:t.prototype,Um)&&eu(t,Um,{configurable:!0,value:e})},Vm=oa("species"),qf=function(t){t=Wb(t);var e=Ma.f;ja&&t&&!t[Vm]&&e(t,Vm,{configurable:!0,get:function(){return this}})},yb=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},zc=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},me={},fu=oa("iterator"),gu=Array.prototype,Fi=function(t){return void 0!==t&&(me.Array===t||gu[fu]===t)},ne=function(t,e,n){if(yb(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},hu=oa("toStringTag"),Wm={};Wm[hu]="z";var Gi="[object z]"===String(Wm),iu=oa("toStringTag"),ju="Arguments"==Vb(function(){return arguments}()),rf=Gi?Vb:function(t){var e;if(void 0===t)var n="Undefined";else{if(null===t)var r="Null";else{t:{var i=t=Object(t);try{r=i[iu];break t}catch(t){}r=void 0}r="string"==typeof(n=r)?n:ju?Vb(t):"Object"==(e=Vb(t))&&"function"==typeof t.callee?"Arguments":e}n=r}return n},ku=oa("iterator"),Hi=function(t){if(null!=t)return t[ku]||t["@@iterator"]||me[rf(t)]},Ii=function(t){var e=t.return;if(void 0!==e)return qa(e.call(t)).value},sf=function(t,e){this.stopped=t,this.result=e},Cg=function(t,e,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),a=!(!n||!n.INTERRUPTED),s=ne(e,n&&n.that,1+i+a),c=function(t){return u&&Ii(u),new sf(!0,t)};if(e=function(t){return i?(qa(t),a?s(t[0],t[1],c):s(t[0],t[1])):a?s(t,c):s(t)},o)var u=t;else{if("function"!=typeof(o=Hi(t)))throw TypeError("Target is not iterable");if(Fi(o)){for(o=0,n=za(t.length);n>o;o++)if((r=e(t[o]))&&r instanceof sf)return r;return new sf(!1)}u=o.call(t)}for(t=u.next;!(o=t.call(u)).done;){try{r=e(o.value)}catch(t){throw Ii(u),t}if("object"==typeof r&&r&&r instanceof sf)return r}return new sf(!1)},Xm=oa("iterator"),Ym=!1;try{var lu=0,Zm={next:function(){return{done:!!lu++}},return:function(){Ym=!0}};Zm[Xm]=function(){return this},Array.from(Zm,(function(){throw 2}))}catch(c){}var Dg=function(t,e){if(!e&&!Ym)return!1;var n=!1;try{(e={})[Xm]=function(){return{next:function(){return{done:n=!0}}}},t(e)}catch(t){}return n},mu=oa("species"),Yc=function(t,e){var n;return void 0===(t=qa(t).constructor)||null==(n=qa(t)[mu])?e:yb(n)},Ji=Wb("document","documentElement"),oe=Wb("navigator","userAgent")||"",$m=/(iphone|ipod|ipad).*applewebkit/i.test(oe),kc="process"==Vb(B.process),Eg=B.location,Ki=B.setImmediate,an=B.clearImmediate,nu=B.process,bn=B.MessageChannel,Li=B.Dispatch,Mi=0,tf={},Ni=function(t){if(tf.hasOwnProperty(t)){var e=tf[t];delete tf[t],e()}},Oi=function(t){return function(){Ni(t)}},cn=function(t){Ni(t.data)},dn=function(t){B.postMessage(t+"",Eg.protocol+"//"+Eg.host)};if(!Ki||!an)if(Ki=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return tf[++Mi]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},uf(Mi),Mi},an=function(t){delete tf[t]},kc)var uf=function(t){nu.nextTick(Oi(t))};else if(Li&&Li.now)uf=function(t){Li.now(Oi(t))};else if(bn&&!$m){var en=new bn,fn=en.port2;en.port1.onmessage=cn,uf=ne(fn.postMessage,fn,1)}else B.addEventListener&&"function"==typeof postMessage&&!B.importScripts&&Eg&&"file:"!==Eg.protocol&&!O(dn)?(uf=dn,B.addEventListener("message",cn,!1)):uf="onreadystatechange"in(xg?he.createElement("script"):{})?function(t){Ji.appendChild(xg?he.createElement("script"):{}).onreadystatechange=function(){Ji.removeChild(this),Ni(t)}}:function(t){setTimeout(Oi(t),0)};var Pi=Ki,ou=/web0s(?!.*chrome)/i.test(oe),pu=Db.f,gn=B.MutationObserver||B.WebKitMutationObserver,hn=B.document,jn=B.process,Qi=B.Promise,kn=pu(B,"queueMicrotask"),ln=kn&&kn.value,xd,vf;if(!ln){var Gg=function(){var t;for(kc&&(t=jn.domain)&&t.exit();xd;){var e=xd.fn;xd=xd.next;try{e()}catch(t){throw xd?Fg():vf=void 0,t}}vf=void 0,t&&t.enter()};if($m||kc||ou||!gn||!hn)if(Qi&&Qi.resolve)var mn=Qi.resolve(void 0),qu=mn.then,Fg=function(){qu.call(mn,Gg)};else Fg=kc?function(){jn.nextTick(Gg)}:function(){Pi.call(B,Gg)};else{var nn=!0,on=hn.createTextNode("");new gn(Gg).observe(on,{characterData:!0}),Fg=function(){on.data=nn=!nn}}}var pn=ln||function(t){t={fn:t,next:void 0},vf&&(vf.next=t),xd||(xd=t,Fg()),vf=t},ru=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=yb(e),this.reject=yb(n)},Ri={f:function(t){return new ru(t)}},Hg=function(t,e){return qa(t),ea(e)&&e.constructor===t?e:((0,(t=Ri.f(t)).resolve)(e),t.promise)},su=function(t,e){var n=B.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))},Si=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},qn=B.process,rn=qn&&qn.versions,sn=rn&&rn.v8;if(sn)var yd=sn.split("."),Ti=yd[0]+yd[1];else oe&&(yd=oe.match(/Edge\/(\d+)/),(!yd||74<=yd[1])&&(yd=oe.match(/Chrome\/(\d+)/))&&(Ti=yd[1]));var pe=Ti&&+Ti,tu=oa("species"),tn=Ua.get,uu=Ua.set,vu=Ua.getterFor("Promise"),sb=wc,un=B.TypeError,Ui=B.document,Vi=B.process,vn=Wb("fetch"),qe=Ri.f,wu=qe,xu=!!(Ui&&Ui.createEvent&&B.dispatchEvent),wn="function"==typeof PromiseRejectionEvent,wf=jc("Promise",(function(){if(Bi(sb)===String(sb)&&(66===pe||!kc&&!wn))return!0;if(51<=pe&&/native code/.test(sb))return!1;var t=sb.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[tu]=e,!(t.then((function(){}))instanceof e)})),yu=wf||!Dg((function(t){sb.all(t).catch((function(){}))})),xn=function(t){var e;return!(!ea(t)||"function"!=typeof(e=t.then))&&e},Wi=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;pn((function(){for(var r=t.value,i=1==t.state,o=0;n.length>o;){var a,s=n[o++],c=i?s.ok:s.fail,u=s.resolve,l=s.reject,d=s.domain;try{if(c){if(i||(2===t.rejection&&zu(t),t.rejection=1),!0===c)var h=r;else if(d&&d.enter(),h=c(r),d){d.exit();var f=!0}h===s.promise?l(un("Promise-chain cycle")):(a=xn(h))?a.call(h,u,l):u(h)}else l(r)}catch(t){d&&!f&&d.exit(),l(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&Au(t)}))}},yn=function(t,e,n){var r;if(xu){var i=Ui.createEvent("Event");i.promise=e,i.reason=n,i.initEvent(t,!1,!0),B.dispatchEvent(i)}else i={promise:e,reason:n};!wn&&(r=B["on"+t])?r(i):"unhandledrejection"===t&&su("Unhandled promise rejection",n)},Au=function(t){Pi.call(B,(function(){var e=t.facade,n=t.value;if(1!==t.rejection&&!t.parent){var r=Si((function(){kc?Vi.emit("unhandledRejection",n,e):yn("unhandledrejection",e,n)}));if(t.rejection=kc||1!==t.rejection&&!t.parent?2:1,r.error)throw r.value}}))},zu=function(t){Pi.call(B,(function(){var e=t.facade;kc?Vi.emit("rejectionHandled",e):yn("rejectionhandled",e,t.value)}))},re=function(t,e,n){return function(r){t(e,r,n)}},se=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Wi(t,!0))},Xi=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw un("Promise can't be resolved itself");var r=xn(e);r?pn((function(){var n={done:!1};try{r.call(e,re(Xi,n,t),re(se,n,t))}catch(e){se(n,e,t)}})):(t.value=e,t.state=1,Wi(t,!1))}catch(e){se({done:!1},e,t)}}};if(wf){sb=function(t){zc(this,sb,"Promise"),yb(t),Yi.call(this);var e=tn(this);try{t(re(Xi,e),re(se,e))}catch(t){se(e,t)}};var Yi=function(t){uu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};Yi.prototype=of(sb.prototype,{then:function(t,e){var n=vu(this),r=qe(Yc(this,sb));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=kc?Vi.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Wi(n,!1),r.promise},catch:function(t){return this.then(void 0,t)}});var Bu=function(){var t=new Yi,e=tn(t);this.promise=t,this.resolve=re(Xi,e),this.reject=re(se,e)};if(Ri.f=qe=function(t){return t===sb||t===Cu?new Bu(t):wu(t)},"function"==typeof wc){var Du=wc.prototype.then;Va(wc.prototype,"then",(function(t,e){var n=this;return new sb((function(t,e){Du.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof vn&&N({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Hg(sb,vn.apply(B,arguments))}})}}N({global:!0,wrap:!0,forced:wf},{Promise:sb}),yc(sb,"Promise",!1),qf("Promise");var Cu=Wb("Promise");N({target:"Promise",stat:!0,forced:wf},{reject:function(t){var e=qe(this);return e.reject.call(void 0,t),e.promise}}),N({target:"Promise",stat:!0,forced:wf},{resolve:function(t){return Hg(this,t)}}),N({target:"Promise",stat:!0,forced:yu},{all:function(t){var e=this,n=qe(e),r=n.resolve,i=n.reject,o=Si((function(){var n=yb(e.resolve),o=[],a=0,s=1;Cg(t,(function(t){var c=a++,u=!1;o.push(void 0),s++,n.call(e,t).then((function(t){u||(u=!0,o[c]=t,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(t){var e=this,n=qe(e),r=n.reject,i=Si((function(){var i=yb(e.resolve);Cg(t,(function(t){i.call(e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Eu=Gi?{}.toString:function(){return"[object "+rf(this)+"]"};Gi||Va(Object.prototype,"toString",Eu,{unsafe:!0});var zn=[].indexOf,An=!!zn&&0>1/[1].indexOf(1,-0),Fu=le("indexOf");N({target:"Array",proto:!0,forced:An||!Fu},{indexOf:function(t){return An?zn.apply(this,arguments)||0:Ei(this,t,1<arguments.length?arguments[1]:void 0)}});var Zi=function(){var t=qa(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},Ig=O((function(){var t=RegExp("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),Gu=O((function(){var t=RegExp("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),Jg=RegExp.prototype.exec,Hu=String.prototype.replace,Bn=Jg,$i=(c=/a/,a=/b*/g,Jg.call(c,"a"),Jg.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),Cn=Ig||Gu,aj=void 0!==/()??/.exec("")[1],c,a;($i||aj||Cn)&&(Bn=function(t){var e,n=Cn&&this.sticky,r=Zi.call(this),i=this.source,o=0,a=t;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),a=String(t).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==t[this.lastIndex-1])&&(i="(?: "+i+")",a=" "+a,o++);var s=new RegExp("^(?:"+i+")",r)}if(aj&&(s=new RegExp("^"+i+"$(?!\\s)",r)),$i)var c=this.lastIndex;var u=Jg.call(n?s:this,a);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:$i&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),aj&&u&&1<u.length&&Hu.call(u[0],s,(function(){for(e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(u[e]=void 0)})),u});var xf=Bn;N({target:"RegExp",proto:!0,forced:/./.exec!==xf},{exec:xf});var Iu=oa("species"),Ju=!O((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),Dn="$0"==="a".replace(/./,"$0"),En=oa("replace"),Fn=!!/./[En]&&""===/./[En]("a","$0"),Ku=!O((function(){var t=/(?:)/,e=t.exec;return t.exec=function(){return e.apply(this,arguments)},2!==(t="ab".split(t)).length||"a"!==t[0]||"b"!==t[1]})),Kg=function(t,e,n,r){var i=oa(t),o=!O((function(){var e={};return e[i]=function(){return 7},7!=""[t](e)})),a=o&&!O((function(){var e=!1,n=/a/;return"split"===t&&((n={constructor:{}}).constructor[Iu]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return e=!0,null},n[i](""),!e}));if(!o||!a||"replace"===t&&(!Ju||!Dn||Fn)||"split"===t&&!Ku){var s=/./[i],c=(n=n(i,""[t],(function(t,e,n,r,i){return e.exec===xf?o&&!i?{done:!0,value:s.call(e,n,r)}:{done:!0,value:t.call(n,e,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Dn,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Fn}))[1];Va(String.prototype,t,n[0]),Va(RegExp.prototype,i,2==e?function(t,e){return c.call(t,this,e)}:function(t){return c.call(t,this)})}r&&Ia(RegExp.prototype[i],"sham",!0)},Gn=function(t){return function(e,n){e=String(hb(e)),n=ic(n);var r,i=e.length;if(0>n||n>=i)return t?"":void 0;var o=e.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=e.charCodeAt(n+1))||57343<r?t?e.charAt(n):o:t?e.slice(n,n+2):r-56320+(o-55296<<10)+65536}};Gn(!1);var Hn=Gn(!0),bj=function(t,e,n){return e+(n?Hn(t,e).length:1)},Wa=function(t){return Object(hb(t))},Lu=Math.floor,Mu="".replace,Nu=/\$([$&'`]|\d\d?|<[^>]*>)/g,Ou=/\$([$&'`]|\d\d?)/g,Pu=function(t,e,n,r,i,o){var a=n+t.length,s=r.length,c=Ou;return void 0!==i&&(i=Wa(i),c=Nu),Mu.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,n);case"'":return e.slice(a);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>s)return 0===(u=Lu(u/10))?o:u<=s?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o}))},te=function(t,e){var n=t.exec;if("function"==typeof n){if("object"!=typeof(t=n.call(t,e)))throw TypeError("RegExp exec method returned something other than an Object or null");return t}if("RegExp"!==Vb(t))throw TypeError("RegExp#exec called on incompatible receiver");return xf.call(t,e)},Qu=Math.max,Ru=Math.min,Su=function(t){return void 0===t?t:String(t)};Kg("replace",2,(function(t,e,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=hb(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):e.call(String(i),n,r)},function(t,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var s=n(e,t,this,r);if(s.done)return s.value}var c=qa(t);t=String(this),(s="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var d=[];;){var h=te(c,t);if(null===h)break;if(d.push(h),!u)break;""===String(h[0])&&(c.lastIndex=bj(t,za(c.lastIndex),l))}for(l="",u=c=0;u<d.length;u++){h=d[u];for(var f=String(h[0]),p=Qu(Ru(ic(h.index),t.length),0),v=[],m=1;m<h.length;m++)v.push(Su(h[m]));h=h.groups,s?(v=[f].concat(v,p,t),void 0!==h&&v.push(h),h=String(r.apply(void 0,v))):h=Pu(f,t,p,v,h,r),p>=c&&(l+=t.slice(c,p)+h,c=p+f.length)}return l+t.slice(c)}]}));var zd=Array.isArray||function(t){return"Array"==Vb(t)},ue=function(t,e,n){(e=hc(e))in t?Ma.f(t,e,Xc(0,n)):t[e]=n},Tu=oa("species"),yf=function(t){return 51<=pe||!O((function(){var e=[];return(e.constructor={})[Tu]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Uu=yf("slice"),Vu=oa("species"),Wu=[].slice,Xu=Math.max;N({target:"Array",proto:!0,forced:!Uu},{slice:function(t,e){var n=rb(this),r=za(n.length);if(t=xb(t,r),e=xb(void 0===e?r:e,r),zd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!zd(i.prototype)?ea(i)&&null===(i=i[Vu])&&(i=void 0):i=void 0,i===Array||void 0===i)return Wu.call(n,t,e)}for(i=new(void 0===i?Array:i)(Xu(e-t,0)),r=0;t<e;t++,r++)t in n&&ue(i,r,n[t]);return i.length=r,i}});var In="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Jn=!O((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Kn=yg("IE_PROTO"),Yu=Object.prototype,Rb=Jn?Object.getPrototypeOf:function(t){return t=Wa(t),P(t,Kn)?t[Kn]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Yu:null},$a=Object.setPrototypeOf||("__proto__"in{}?function(){var t=!1,e={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(e,[]),t=e instanceof Array}catch(t){}return function(e,r){if(qa(e),!ea(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return t?n.call(e,r):e.__proto__=r,e}}():void 0),Zu=Ma.f,zf=B.Int8Array,cj=zf&&zf.prototype,Ln=B.Uint8ClampedArray,Mn=Ln&&Ln.prototype,Ac=zf&&Rb(zf),Xb=cj&&Rb(cj),Nn=Object.prototype,On=Nn.isPrototypeOf,Pn=oa("toStringTag"),dj=ie("TYPED_ARRAY_TAG"),Bc=In&&!!$a&&"Opera"!==rf(B.opera),Qn=!1,zb,lc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},$u={BigInt64Array:8,BigUint64Array:8},Lg=function(t){return!!ea(t)&&(t=rf(t),P(lc,t)||P($u,t))};for(zb in lc)B[zb]||(Bc=!1);if((!Bc||"function"!=typeof Ac||Ac===Function.prototype)&&(Ac=function(){throw TypeError("Incorrect invocation")},Bc))for(zb in lc)B[zb]&&$a(B[zb],Ac);if((!Bc||!Xb||Xb===Nn)&&(Xb=Ac.prototype,Bc))for(zb in lc)B[zb]&&$a(B[zb].prototype,Xb);if(Bc&&Rb(Mn)!==Xb&&$a(Mn,Xb),ja&&!P(Xb,Pn))for(zb in Qn=!0,Zu(Xb,Pn,{get:function(){return ea(this)?this[dj]:void 0}}),lc)B[zb]&&Ia(B[zb],dj,zb);var Af=Bc,Rn=Qn&&dj,Aa=function(t){if(Lg(t))return t;throw TypeError("Target is not a typed array")},ve=function(t){if($a){if(On.call(Ac,t))return t}else for(var e in lc)if(P(lc,zb)){var n=B[e];if(n&&(t===n||On.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},va=function(t,e,n){if(ja){if(n)for(var r in lc){var i=B[r];i&&P(i.prototype,t)&&delete i.prototype[t]}Xb[t]&&!n||Va(Xb,t,n?e:Bc&&cj[t]||e)}},Sn=function(t,e,n){var r,i;if(ja){if($a){if(n)for(r in lc)(i=B[r])&&P(i,t)&&delete i[t];if(Ac[t]&&!n)return;try{return Va(Ac,t,n?e:Bc&&zf[t]||e)}catch(t){}}for(r in lc)!(i=B[r])||i[t]&&!n||Va(i,t,e)}},Tn=Ac,Bf=Xb,av=B.ArrayBuffer,Ad=B.Int8Array,ej=!Af||!O((function(){Ad(1)}))||!O((function(){new Ad(-1)}))||!Dg((function(t){new Ad,new Ad(null),new Ad(1.5),new Ad(t)}),!0)||O((function(){return 1!==new Ad(new av(2),1,void 0).length})),we=function(t){if(void 0===t)return 0;t=ic(t);var e=za(t);if(t!==e)throw RangeError("Wrong length or index");return e},bv=Math.abs,Cc=Math.pow,cv=Math.floor,dv=Math.log,ev=Math.LN2,fj=function(t){var e=Wa(this),n=za(e.length),r=arguments.length,i=xb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:xb(r,n);n>i;)e[i++]=t;return e},fv=wd.f,gv=Ma.f,xe=Ua.get,Un=Ua.set,Yb=B.ArrayBuffer,Ab=Yb,Zb=B.DataView,Mg=Zb&&Zb.prototype,Vn=Object.prototype,Ng=B.RangeError,Wn=function(t,e,n){var r,i=Array(n),o=(1<<(n=8*n-e-1))-1,a=o>>1,s=23===e?Cc(2,-24)-Cc(2,-77):0,c=0>t||0===t&&0>1/t?1:0,u=0;if((t=bv(t))!=t||1/0===t){t=t!=t?1:0;var l=o}else l=cv(dv(t)/ev),1>t*(r=Cc(2,-l))&&(l--,r*=2),2<=(t=1<=l+a?t+s/r:t+s*Cc(2,1-a))*r&&(l++,r/=2),l+a>=o?(t=0,l=o):1<=l+a?(t=(t*r-1)*Cc(2,e),l+=a):(t=t*Cc(2,a-1)*Cc(2,e),l=0);for(;8<=e;i[u++]=255&t,t/=256,e-=8);for(l=l<<e|t,n+=e;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},Xn=function(t,e){var n=t.length,r=8*n-e-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var a=t[n--],s=127&a;for(a>>=7;0<r;s=256*s+t[n],n--,r-=8);var c=s&(1<<-r)-1;for(s>>=-r,r+=e;0<r;c=256*c+t[n],n--,r-=8);if(0===s)s=1-o;else{if(s===i)return c?NaN:a?-1/0:1/0;c+=Cc(2,e),s-=o}return(a?-1:1)*c*Cc(2,s-e)},Yn=function(t){return[255&t]},Zn=function(t){return[255&t,t>>8&255]},$n=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},ao=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},hv=function(t){return Wn(t,23,4)},iv=function(t){return Wn(t,52,8)},Og=function(t,e){gv(t.prototype,e,{get:function(){return xe(this)[e]}})},Zc=function(t,e,n,r){n=we(n);var i=xe(t);if(n+e>i.byteLength)throw Ng("Wrong index");return t=xe(i.buffer).bytes,n+=i.byteOffset,e=t.slice(n,n+e),r?e:e.reverse()},$c=function(t,e,n,r,i,o){n=we(n);var a=xe(t);if(n+e>a.byteLength)throw Ng("Wrong index");for(t=xe(a.buffer).bytes,n+=a.byteOffset,r=r(+i),i=0;i<e;i++)t[n+i]=r[o?i:e-i-1]};if(In){if(!O((function(){Yb(1)}))||!O((function(){new Yb(-1)}))||O((function(){return new Yb,new Yb(1.5),new Yb(NaN),"ArrayBuffer"!=Yb.name}))){Ab=function(t){return zc(this,Ab),new Yb(we(t))};for(var jv=Ab.prototype=Yb.prototype,bo=fv(Yb),co=0,gj;bo.length>co;)(gj=bo[co++])in Ab||Ia(Ab,gj,Yb[gj]);jv.constructor=Ab}$a&&Rb(Mg)!==Vn&&$a(Mg,Vn);var Pg=new Zb(new Ab(2)),eo=Mg.setInt8;Pg.setInt8(0,2147483648),Pg.setInt8(1,2147483649),!Pg.getInt8(0)&&Pg.getInt8(1)||of(Mg,{setInt8:function(t,e){eo.call(this,t,e<<24>>24)},setUint8:function(t,e){eo.call(this,t,e<<24>>24)}},{unsafe:!0})}else Ab=function(t){zc(this,Ab,"ArrayBuffer"),t=we(t),Un(this,{bytes:fj.call(Array(t),0),byteLength:t}),ja||(this.byteLength=t)},Zb=function(t,e,n){zc(this,Zb,"DataView"),zc(t,Ab,"DataView");var r=xe(t).byteLength;if(0>(e=ic(e))||e>r)throw Ng("Wrong offset");if(e+(n=void 0===n?r-e:za(n))>r)throw Ng("Wrong length");Un(this,{buffer:t,byteLength:n,byteOffset:e}),ja||(this.buffer=t,this.byteLength=n,this.byteOffset=e)},ja&&(Og(Ab,"byteLength"),Og(Zb,"buffer"),Og(Zb,"byteLength"),Og(Zb,"byteOffset")),of(Zb.prototype,{getInt8:function(t){return Zc(this,1,t)[0]<<24>>24},getUint8:function(t){return Zc(this,1,t)[0]},getInt16:function(t){var e=Zc(this,2,t,1<arguments.length?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Zc(this,2,t,1<arguments.length?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return ao(Zc(this,4,t,1<arguments.length?arguments[1]:void 0))},getUint32:function(t){return ao(Zc(this,4,t,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(t){return Xn(Zc(this,4,t,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(t){return Xn(Zc(this,8,t,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(t,e){$c(this,1,t,Yn,e)},setUint8:function(t,e){$c(this,1,t,Yn,e)},setInt16:function(t,e){$c(this,2,t,Zn,e,2<arguments.length?arguments[2]:void 0)},setUint16:function(t,e){$c(this,2,t,Zn,e,2<arguments.length?arguments[2]:void 0)},setInt32:function(t,e){$c(this,4,t,$n,e,2<arguments.length?arguments[2]:void 0)},setUint32:function(t,e){$c(this,4,t,$n,e,2<arguments.length?arguments[2]:void 0)},setFloat32:function(t,e){$c(this,4,t,hv,e,2<arguments.length?arguments[2]:void 0)},setFloat64:function(t,e){$c(this,8,t,iv,e,2<arguments.length?arguments[2]:void 0)}});yc(Ab,"ArrayBuffer"),yc(Zb,"DataView");var Cf={ArrayBuffer:Ab,DataView:Zb},Qg=function(t,e){if(0>(t=ic(t)))throw RangeError("The argument can't be less than 0");if(t%e)throw RangeError("Wrong offset");return t},Dc=Object.keys||function(t){return Qm(t,Ag)},kv=ja?Object.defineProperties:function(t,e){qa(t);for(var n,r=Dc(e),i=r.length,o=0;i>o;)Ma.f(t,n=r[o++],e[n]);return t},fo=yg("IE_PROTO"),hj=function(){},ij,Rg=function(){try{ij=document.domain&&new ActiveXObject("htmlfile")}catch(t){}if(ij){var t=ij;t.write("<script><\/script>"),t.close(),t=t.parentWindow.Object}else(t=xg?he.createElement("iframe"):{}).style.display="none",Ji.appendChild(t),t.src="javascript:",(t=t.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),t=t.F;for(Rg=t,t=Ag.length;t--;)delete Rg.prototype[Ag[t]];return Rg()};je[fo]=!0;var $b=Object.create||function(t,e){if(null!==t){hj.prototype=qa(t);var n=new hj;hj.prototype=null,n[fo]=t}else n=Rg();return void 0===e?n:kv(n,e)},jj=function(t){var e=Wa(t),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Hi(e);if(null!=o&&!Fi(o)){var a=o.call(e),s=a.next;for(e=[];!(o=s.call(a)).done;)e.push(o.value)}for(i&&2<n&&(r=ne(r,arguments[2],2)),o=za(e.length),a=new(ve(this))(o),n=0;o>n;n++)a[n]=i?r(e[n],n):e[n];return a},lv=oa("species"),kj=function(t,e){if(zd(t)){var n=t.constructor;"function"!=typeof n||n!==Array&&!zd(n.prototype)?ea(n)&&null===(n=n[lv])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===e?0:e)},go=[].push,ad=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=7==t,s=5==t||o;return function(c,u,l,d){var h=Wa(c),f=lf(h);u=ne(u,l,3),l=za(f.length);var p,v=0;for(d=d||kj,c=e?d(c,l):n||a?d(c,0):void 0;l>v;v++)if((s||v in f)&&(p=u(d=f[v],v,h),t))if(e)c[v]=p;else if(p)switch(t){case 3:return!0;case 5:return d;case 6:return v;case 2:go.call(c,d)}else switch(t){case 4:return!1;case 7:go.call(c,d)}return o?-1:r||i?i:c}},Bd=ad(0),ho=ad(1),io=ad(2),mv=ad(3),nv=ad(4),ov=ad(5),jo=ad(6);ad(7);var Sg=function(t,e,n){var r,i;return $a&&"function"==typeof(r=e.constructor)&&r!==n&&ea(i=r.prototype)&&i!==n.prototype&&$a(t,i),t},Df=Xa((function(t){var e=wd.f,n=Ua.get,r=Ua.set,i=Ma.f,o=Db.f,a=Math.round,s=B.RangeError,c=Cf.ArrayBuffer,u=Cf.DataView,l=function(t,e){var n=0,r=e.length;for(t=new(ve(t))(r);r>n;)t[n]=e[n++];return t},d=function(t,e){i(t,e,{get:function(){return n(this)[e]}})},h=function(t){var e;return t instanceof c||"ArrayBuffer"==(e=rf(t))||"SharedArrayBuffer"==e},f=function(t,e){return Lg(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},p=function(t,e){return f(t,e=hc(e,!0))?Xc(2,t[e]):o(t,e)},v=function(t,e,n){return!(f(t,e=hc(e,!0))&&ea(n)&&P(n,"value"))||P(n,"get")||P(n,"set")||n.configurable||P(n,"writable")&&!n.writable||P(n,"enumerable")&&!n.enumerable?i(t,e,n):(t[e]=n.value,t)};ja?(Af||(Db.f=p,Ma.f=v,d(Bf,"buffer"),d(Bf,"byteOffset"),d(Bf,"byteLength"),d(Bf,"length")),N({target:"Object",stat:!0,forced:!Af},{getOwnPropertyDescriptor:p,defineProperty:v}),t.exports=function(t,o,d){var f=t.match(/\d+$/)[0]/8,p=t+(d?"Clamped":"")+"Array",v="get"+t,m="set"+t,g=B[p],A=g;t=A&&A.prototype;var y={},b=function(t,e){i(t,e,{get:function(){var t=n(this);return t.view[v](e*f+t.byteOffset,!0)},set:function(t){var r=n(this);d&&(t=0>(t=a(t))?0:255<t?255:255&t),r.view[m](e*f+r.byteOffset,t,!0)},enumerable:!0})};Af?ej&&(A=o((function(t,e,n,r){return zc(t,A,p),Sg(ea(e)?h(e)?void 0!==r?new g(e,Qg(n,f),r):void 0!==n?new g(e,Qg(n,f)):new g(e):Lg(e)?l(A,e):jj.call(A,e):new g(we(e)),t,A)})),$a&&$a(A,Tn),Bd(e(g),(function(t){t in A||Ia(A,t,g[t])})),A.prototype=t):(A=o((function(t,e,n,i){zc(t,A,p);var o=0,a=0;if(ea(e)){if(!h(e))return Lg(e)?l(A,e):jj.call(A,e);var d=e;if(a=Qg(n,f),e=e.byteLength,void 0===i){if(e%f)throw s("Wrong length");if(0>(i=e-a))throw s("Wrong length")}else if((i=za(i)*f)+a>e)throw s("Wrong length");e=i/f}else e=we(e),d=new c(i=e*f);for(r(t,{buffer:d,byteOffset:a,byteLength:i,length:e,view:new u(d)});o<e;)b(t,o++)})),$a&&$a(A,Tn),t=A.prototype=$b(Bf)),t.constructor!==A&&Ia(t,"constructor",A),Rn&&Ia(t,Rn,p),y[p]=A,N({global:!0,forced:A!=g,sham:!Af},y),"BYTES_PER_ELEMENT"in A||Ia(A,"BYTES_PER_ELEMENT",f),"BYTES_PER_ELEMENT"in t||Ia(t,"BYTES_PER_ELEMENT",f),qf(p)}):t.exports=function(){}}));Df("Uint8",(function(t){return function(e,n,r){return t(this,e,n,r)}}));var pv=Math.min,qv=[].copyWithin||function(t,e){var n=Wa(this),r=za(n.length),i=xb(t,r),o=xb(e,r),a=2<arguments.length?arguments[2]:void 0;for(r=pv((void 0===a?r:xb(a,r))-o,r-i),a=1,o<i&&i<o+r&&(a=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=a,o+=a;return n};va("copyWithin",(function(t,e){return qv.call(Aa(this),t,e,2<arguments.length?arguments[2]:void 0)})),va("every",(function(t){return nv(Aa(this),t,1<arguments.length?arguments[1]:void 0)})),va("fill",(function(t){return fj.apply(Aa(this),arguments)})),va("filter",(function(t){var e=io(Aa(this),t,1<arguments.length?arguments[1]:void 0),n=Yc(this,this.constructor),r=0,i=e.length;for(n=new(ve(n))(i);i>r;)n[r]=e[r++];return n})),va("find",(function(t){return ov(Aa(this),t,1<arguments.length?arguments[1]:void 0)})),va("findIndex",(function(t){return jo(Aa(this),t,1<arguments.length?arguments[1]:void 0)})),va("forEach",(function(t){Bd(Aa(this),t,1<arguments.length?arguments[1]:void 0)})),va("includes",(function(t){return Pm(Aa(this),t,1<arguments.length?arguments[1]:void 0)})),va("indexOf",(function(t){return Ei(Aa(this),t,1<arguments.length?arguments[1]:void 0)}));var lj=oa("unscopables"),mj=Array.prototype;null==mj[lj]&&Ma.f(mj,lj,{configurable:!0,value:$b(null)});var ye=function(t){mj[lj][t]=!0},nj=oa("iterator"),ko=!1,rv=function(){return this},Cd;if([].keys){var lo=[].keys();if("next"in lo){var mo=Rb(Rb(lo));mo!==Object.prototype&&(Cd=mo)}else ko=!0}(null==Cd||O((function(){var t={};return Cd[nj].call(t)!==t})))&&(Cd={}),P(Cd,nj)||Ia(Cd,nj,rv);var Tg=Cd,sv=function(){return this},tv=function(t,e,n){return e+=" Iterator",t.prototype=$b(Tg,{next:Xc(1,n)}),yc(t,e,!1),me[e]=sv,t},Ug=ko,Ef=oa("iterator"),uv=function(){return this},oj=function(t,e,n,r,i,o,a){tv(n,e,r),r=function(t){if(t===i&&h)return h;if(!Ug&&t in l)return l[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}};var s,c=e+" Iterator",u=!1,l=t.prototype,d=l[Ef]||l["@@iterator"]||i&&l[i],h=!Ug&&d||r(i),f="Array"==e&&l.entries||d;if(f&&(t=Rb(f.call(new t)),Tg!==Object.prototype&&t.next&&(Rb(t)!==Tg&&($a?$a(t,Tg):"function"!=typeof t[Ef]&&Ia(t,Ef,uv)),yc(t,c,!0))),"values"==i&&d&&"values"!==d.name&&(u=!0,h=function(){return d.call(this)}),l[Ef]!==h&&Ia(l,Ef,h),me[e]=h,i){var p={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(a)for(s in p)!Ug&&!u&&s in l||Va(l,s,p[s]);else N({target:e,proto:!0,forced:Ug||u},p)}return p},vv=Ua.set,wv=Ua.getterFor("Array Iterator"),bd=oj(Array,"Array",(function(t,e){vv(this,{type:"Array Iterator",target:rb(t),index:0,kind:e})}),(function(){var t=wv(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");me.Arguments=me.Array,ye("keys"),ye("values"),ye("entries");var no=oa("iterator"),oo=B.Uint8Array,xv=bd.values,yv=bd.keys,zv=bd.entries,pj=oo&&oo.prototype[no],po=!!pj&&("values"==pj.name||null==pj.name),qo=function(){return xv.call(Aa(this))};va("entries",(function(){return zv.call(Aa(this))})),va("keys",(function(){return yv.call(Aa(this))})),va("values",qo,!po),va(no,qo,!po);var Av=[].join;va("join",(function(t){return Av.apply(Aa(this),arguments)}));var Bv=Math.min,qj=[].lastIndexOf,ro=!!qj&&0>1/[1].lastIndexOf(1,-0),Cv=le("lastIndexOf"),Dv=ro||!Cv?function(t){if(ro)return qj.apply(this,arguments)||0;var e=rb(this),n=za(e.length),r=n-1;for(1<arguments.length&&(r=Bv(r,ic(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in e&&e[r]===t)return r||0;return-1}:qj;va("lastIndexOf",(function(t){return Dv.apply(Aa(this),arguments)})),va("map",(function(t){return ho(Aa(this),t,1<arguments.length?arguments[1]:void 0,(function(t,e){return new(ve(Yc(t,t.constructor)))(e)}))}));var so=function(t){return function(e,n,r,i){yb(n),e=Wa(e);var o=lf(e),a=za(e.length),s=t?a-1:0,c=t?-1:1;if(2>r)for(;;){if(s in o){i=o[s],s+=c;break}if(s+=c,t?0>s:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;t?0<=s:a>s;s+=c)s in o&&(i=n(i,o[s],s,e));return i}},to=so(!1),Ev=so(!0);va("reduce",(function(t){return to(Aa(this),t,arguments.length,1<arguments.length?arguments[1]:void 0)})),va("reduceRight",(function(t){return Ev(Aa(this),t,arguments.length,1<arguments.length?arguments[1]:void 0)}));var Fv=Math.floor;va("reverse",(function(){for(var t,e=Aa(this).length,n=Fv(e/2),r=0;r<n;)t=this[r],this[r++]=this[--e],this[e]=t;return this}));var Gv=O((function(){new Int8Array(1).set({})}));va("set",(function(t){Aa(this);var e=Qg(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Wa(t),i=za(r.length),o=0;if(i+e>n)throw RangeError("Wrong length");for(;o<i;)this[e+o]=r[o++]}),Gv);var Hv=[].slice,Iv=O((function(){new Int8Array(1).slice()}));va("slice",(function(t,e){t=Hv.call(Aa(this),t,e);var n=Yc(this,this.constructor);e=0;var r=t.length;for(n=new(ve(n))(r);r>e;)n[e]=t[e++];return n}),Iv),va("some",(function(t){return mv(Aa(this),t,1<arguments.length?arguments[1]:void 0)}));var Jv=[].sort;va("sort",(function(t){return Jv.call(Aa(this),t)})),va("subarray",(function(t,e){var n=Aa(this),r=n.length;return t=xb(t,r),new(Yc(n,n.constructor))(n.buffer,n.byteOffset+t*n.BYTES_PER_ELEMENT,za((void 0===e?r:xb(e,r))-t))}));var Vg=B.Int8Array,uo=[].toLocaleString,Kv=[].slice,Lv=!!Vg&&O((function(){uo.call(new Vg(1))})),Mv=O((function(){return[1,2].toLocaleString()!=new Vg([1,2]).toLocaleString()}))||!O((function(){Vg.prototype.toLocaleString.call([1,2])}));va("toLocaleString",(function(){return uo.apply(Lv?Kv.call(Aa(this)):Aa(this),arguments)}),Mv);var vo=B.Uint8Array,Nv=vo&&vo.prototype||{},Wg=[].toString,Ov=[].join;O((function(){Wg.call({})}))&&(Wg=function(){return Ov.call(this)}),va("toString",Wg,Nv.toString!=Wg);var rj=Cf.ArrayBuffer,wo=Cf.DataView,xo=rj.prototype.slice,Pv=O((function(){return!new rj(2).slice(1,void 0).byteLength}));N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Pv},{slice:function(t,e){if(void 0!==xo&&void 0===e)return xo.call(qa(this),t);var n=qa(this).byteLength;t=xb(t,n),e=xb(void 0===e?n:e,n),n=new(Yc(this,rj))(za(e-t));for(var r=new wo(this),i=new wo(n),o=0;t<e;)i.setUint8(o++,r.getUint8(t++));return n}});var yo=Cf.ArrayBuffer;N({global:!0,forced:B.ArrayBuffer!==yo},{ArrayBuffer:yo}),qf("ArrayBuffer");var Qv=Ma.f,sj=Function.prototype,Rv=sj.toString,Sv=/^\s*function ([^ (]*)/;!ja||"name"in sj||Qv(sj,"name",{configurable:!0,get:function(){try{return Rv.call(this).match(Sv)[1]}catch(t){return""}}});var zo=RegExp.prototype,Ao=zo.toString,Tv=O((function(){return"/a/b"!=Ao.call({source:"a",flags:"b"})})),Uv="toString"!=Ao.name;(Tv||Uv)&&Va(RegExp.prototype,"toString",(function(){var t=qa(this),e=String(t.source),n=t.flags;return"/"+e+"/"+String(void 0===n&&t instanceof RegExp&&!("flags"in zo)?Zi.call(t):n)}),{unsafe:!0});var Vv=yf("splice"),Wv=Math.max,Xv=Math.min;N({target:"Array",proto:!0,forced:!Vv},{splice:function(t,e){var n,r,i=Wa(this),o=za(i.length),a=xb(t,o),s=arguments.length;if(0===s?s=n=0:1===s?(s=0,n=o-a):(s-=2,n=Xv(Wv(ic(e),0),o-a)),9007199254740991<o+s-n)throw TypeError("Maximum allowed length exceeded");var c=kj(i,n);for(r=0;r<n;r++){var u=a+r;u in i&&ue(c,r,i[u])}if(c.length=n,s<n){for(r=a;r<o-n;r++){var l=r+s;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+s;r--)delete i[r-1]}else if(s>n)for(r=o-n;r>a;r--)l=r+s-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<s;r++)i[r+a]=arguments[r+2];return i.length=o-n+s,c}});var Yv=yf("filter");N({target:"Array",proto:!0,forced:!Yv},{filter:function(t){return io(this,t,1<arguments.length?arguments[1]:void 0)}});var Zv=Ua.set,$v=Ua.getterFor("String Iterator");oj(String,"String",(function(t){Zv(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t=$v(this),e=t.string,n=t.index;return n>=e.length?{value:void 0,done:!0}:(e=Hn(e,n),t.index+=e.length,{value:e,done:!1})}));var tj={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},uj=oa("iterator"),Bo=oa("toStringTag"),vj=bd.values,Xg;for(Xg in tj){var Co=B[Xg],Ec=Co&&Co.prototype;if(Ec){if(Ec[uj]!==vj)try{Ia(Ec,uj,vj)}catch(c){Ec[uj]=vj}if(Ec[Bo]||Ia(Ec,Bo,Xg),tj[Xg])for(var ze in bd)if(Ec[ze]!==bd[ze])try{Ia(Ec,ze,bd[ze])}catch(c){Ec[ze]=bd[ze]}}}var Do=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};Kg("search",1,(function(t,e,n){return[function(e){var n=hb(this),r=null==e?void 0:e[t];return void 0!==r?r.call(e,n):new RegExp(e)[t](String(n))},function(t){var r=n(e,t,this);if(r.done)return r.value;t=qa(t);var i=String(this);return r=t.lastIndex,Do(r,0)||(t.lastIndex=0),i=te(t,i),Do(t.lastIndex,r)||(t.lastIndex=r),null===i?-1:i.index}]})),Xa((function(t){!function(e,n){t.exports?t.exports=n(e):n(e)}("undefined"!=typeof self?self:Ta,(function(t){function e(t){return btoa(t).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(t){return t=(t+="===").slice(0,-t.length%4),atob(t.replace(/-/g,"+").replace(/_/g,"/"))}function r(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function i(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),String.fromCharCode.apply(String,t)}function o(t){var e={name:(t.name||t||"").toUpperCase().replace("V","v")};switch(e.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":t.length&&(e.length=t.length);break;case"HMAC":t.hash&&(e.hash=o(t.hash)),t.length&&(e.length=t.length);break;case"RSAES-PKCS1-v1_5":t.publicExponent&&(e.publicExponent=new Uint8Array(t.publicExponent)),t.modulusLength&&(e.modulusLength=t.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":t.hash&&(e.hash=o(t.hash)),t.publicExponent&&(e.publicExponent=new Uint8Array(t.publicExponent)),t.modulusLength&&(e.modulusLength=t.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return e}function a(t){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[t.name][(t.hash||{}).name||t.length||""]}function s(t){(t instanceof ArrayBuffer||t instanceof Uint8Array)&&(t=JSON.parse(decodeURIComponent(escape(i(t)))));var e={kty:t.kty,alg:t.alg,ext:t.ext||t.extractable};switch(e.kty){case"oct":e.k=t.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in t&&(e[n]=t[n])}));break;default:throw new TypeError("Unsupported key type")}return e}function c(t){return t=s(t),b&&(t.extractable=t.ext,delete t.ext),r(unescape(encodeURIComponent(JSON.stringify(t)))).buffer}function u(t){var n=l(t),r=!1;switch(2<n.length&&(r=!0,n.shift()),t={ext:!0},n[0][0]){case"1.2.840.113549.1.1.1":var o="n e d p q dp dq qi".split(" ");for(n=l(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),t[o[r]]=e(i(n[r]));t.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return t}function l(t,e){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),e||(e={pos:0,end:t.length}),2>e.end-e.pos||e.end>t.length)throw new RangeError("Malformed DER");var n=t[e.pos++],r=t[e.pos++];if(128<=r){if(r&=127,e.end-e.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=t[e.pos++];r=o}if(e.end-e.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=t.subarray(e.pos,e.pos+=r);break;case 3:if(t[e.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(t.subarray(e.pos,e.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((t=btoa(i(t.subarray(e.pos,e.pos+=r))))in E))throw Error("Unsupported OBJECT ID "+t);n=E[t];break;case 48:for(n=[],r=e.pos+r;e.pos<r;)n.push(l(t,e));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function d(t,e){e||(e=[]);var n=e.length+2;if(e.push(0,0),t instanceof Uint8Array)for(var i=2,o=t.length,a=0;a<o;a++)e.push(t[a]);else if(t instanceof ArrayBuffer)for(i=4,o=t.byteLength,t=new Uint8Array(t),a=0;a<o;a++)e.push(t[a]);else if(null===t)i=5,o=0;else if("string"==typeof t&&t in _)for(i=6,o=(t=r(atob(_[t]))).length,a=0;a<o;a++)e.push(t[a]);else if(t instanceof Array){for(a=0;a<t.length;a++)d(t[a],e);i=48,o=e.length-n}else{if(!("object"===R(t)&&3===t.tag&&t.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+t);for(i=3,o=(t=new Uint8Array(t.value)).byteLength,e.push(0),a=0;a<o;a++)e.push(t[a]);o++}if(128<=o){for(a=o,o=4,e.splice(n,0,a>>24&255,a>>16&255,a>>8&255,255&a);1<o&&!(a>>24);)a<<=8,o--;4>o&&e.splice(n,4-o),o|=128}return e.splice(n-2,2,i,o),e}function h(t,e,n,r){Object.defineProperties(this,{_key:{value:t},type:{value:t.type,enumerable:!0},extractable:{value:void 0===n?t.extractable:n,enumerable:!0},algorithm:{value:void 0===e?t.algorithm:e,enumerable:!0},usages:{value:void 0===r?t.usages:r,enumerable:!0}})}function f(t){return"verify"===t||"encrypt"===t||"wrapKey"===t}function p(t){return"sign"===t||"decrypt"===t||"unwrapKey"===t}if("function"!=typeof Promise)throw"Promise support required";var v=t.crypto||t.msCrypto;if(v){var m=v.subtle||v.webkitSubtle;if(m){var g=t.Crypto||v.constructor||Object,A=t.SubtleCrypto||m.constructor||Object;t.CryptoKey||t.Key;var y=-1<t.navigator.userAgent.indexOf("Edge/"),b=!!t.msCrypto&&!y,w=!v.subtle&&!!v.webkitSubtle;if(b||w){var E={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},_={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(t){var e=m[t];m[t]=function(i,l,d){var g=[].slice.call(arguments);switch(t){case"generateKey":var A=o(i),y=l,E=d;break;case"importKey":A=o(d),y=g[3],E=g[4],"jwk"===i&&((l=s(l)).alg||(l.alg=a(A)),l.key_ops||(l.key_ops="oct"!==l.kty?"d"in l?E.filter(p):E.filter(f):E.slice()),g[1]=c(l));break;case"unwrapKey":A=g[4],y=g[5],E=g[6],g[2]=d._key}if("generateKey"===t&&"HMAC"===A.name&&A.hash)return A.length=A.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[A.hash.name],m.importKey("raw",v.getRandomValues(new Uint8Array(A.length+7>>3)),A,y,E);if(w&&"generateKey"===t&&"RSASSA-PKCS1-v1_5"===A.name&&(!A.modulusLength||2048<=A.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,m.generateKey(i,!0,["encrypt","decrypt"]).then((function(t){return Promise.all([m.exportKey("jwk",t.publicKey),m.exportKey("jwk",t.privateKey)])})).then((function(t){return t[0].alg=t[1].alg=a(A),t[0].key_ops=E.filter(f),t[1].key_ops=E.filter(p),Promise.all([m.importKey("jwk",t[0],A,!0,t[0].key_ops),m.importKey("jwk",t[1],A,y,t[1].key_ops)])})).then((function(t){return{publicKey:t[0],privateKey:t[1]}}));if((w||b&&"SHA-1"===(A.hash||{}).name)&&"importKey"===t&&"jwk"===i&&"HMAC"===A.name&&"oct"===l.kty)return m.importKey("raw",r(n(l.k)),d,g[3],g[4]);if(w&&"importKey"===t&&("spki"===i||"pkcs8"===i))return m.importKey("jwk",u(l),d,g[3],g[4]);if(b&&"unwrapKey"===t)return m.decrypt(g[3],d,l).then((function(t){return m.importKey(i,t,g[4],g[5],g[6])}));try{var _=e.apply(m,g)}catch(t){return Promise.reject(t)}return b&&(_=new Promise((function(t,e){_.onabort=_.onerror=function(t){e(t)},_.oncomplete=function(e){t(e.target.result)}}))),_=_.then((function(t){return"HMAC"!==A.name||A.length||(A.length=8*t.algorithm.length),0==A.name.search("RSA")&&(A.modulusLength||(A.modulusLength=(t.publicKey||t).algorithm.modulusLength),A.publicExponent||(A.publicExponent=(t.publicKey||t).algorithm.publicExponent)),t.publicKey&&t.privateKey?{publicKey:new h(t.publicKey,A,y,E.filter(f)),privateKey:new h(t.privateKey,A,y,E.filter(p))}:new h(t,A,y,E)}))}})),["exportKey","wrapKey"].forEach((function(t){var o=m[t];m[t]=function(c,u,l){var h=[].slice.call(arguments);switch(t){case"exportKey":h[1]=u._key;break;case"wrapKey":h[1]=u._key,h[2]=l._key}if((w||b&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===t&&"jwk"===c&&"HMAC"===u.algorithm.name&&(h[0]="raw"),!w||"exportKey"!==t||"spki"!==c&&"pkcs8"!==c||(h[0]="jwk"),b&&"wrapKey"===t)return m.exportKey(c,u).then((function(t){return"jwk"===c&&(t=r(unescape(encodeURIComponent(JSON.stringify(s(t)))))),m.encrypt(h[3],l,t)}));try{var v=o.apply(m,h)}catch(t){return Promise.reject(t)}return b&&(v=new Promise((function(t,e){v.onabort=v.onerror=function(t){e(t)},v.oncomplete=function(e){t(e.target.result)}}))),"exportKey"===t&&"jwk"===c&&(v=v.then((function(t){return(w||b&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:a(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:e(i(t))}:((t=s(t)).alg||(t.alg=a(u.algorithm)),t.key_ops||(t.key_ops="public"===u.type?u.usages.filter(f):"private"===u.type?u.usages.filter(p):u.usages.slice()),t)}))),!w||"exportKey"!==t||"spki"!==c&&"pkcs8"!==c||(v=v.then((function(t){var e=[["",null]],i=!1;switch((t=s(t)).kty){case"RSA":for(var o="n e d p q dp dq qi".split(" "),a=[],c=0;c<o.length&&o[c]in t;c++){var u=a[c]=r(n(t[o[c]]));128&u[0]&&(a[c]=new Uint8Array(u.length+1),a[c].set(u,1))}2<a.length&&(i=!0,a.unshift(new Uint8Array([0]))),e[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return e.push(new Uint8Array(d(a)).buffer),i?e.unshift(new Uint8Array([0])):e[1]={tag:3,value:e[1]},new Uint8Array(d(e)).buffer}))),v}})),["encrypt","decrypt","sign","verify"].forEach((function(t){var e=m[t];m[t]=function(n,r,i,a){if(b&&(!i.byteLength||a&&!a.byteLength))throw Error("Empy input is not allowed");var s=[].slice.call(arguments),c=o(n);!b||"sign"!==t&&"verify"!==t||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(s[0]={name:n}),b&&r.algorithm.hash&&(s[0].hash=s[0].hash||r.algorithm.hash),b&&"decrypt"===t&&"AES-GCM"===c.name&&(c=n.tagLength>>3,s[2]=(i.buffer||i).slice(0,i.byteLength-c),n.tag=(i.buffer||i).slice(i.byteLength-c)),s[1]=r._key;try{var u=e.apply(m,s)}catch(t){return Promise.reject(t)}return b&&(u=new Promise((function(e,n){u.onabort=u.onerror=function(t){n(t)},u.oncomplete=function(n){if(n=n.target.result,"encrypt"===t&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}e(n)}}))),u}})),b){var S=m.digest;m.digest=function(t,e){if(!e.byteLength)throw Error("Empy input is not allowed");try{var n=S.call(m,t,e)}catch(t){return Promise.reject(t)}return n=new Promise((function(t,e){n.onabort=n.onerror=function(t){e(t)},n.oncomplete=function(e){t(e.target.result)}}))},t.crypto=Object.create(v,{getRandomValues:{value:function(t){return v.getRandomValues(t)}},subtle:{value:m}}),t.CryptoKey=h}w&&(v.subtle=m,t.Crypto=g,t.SubtleCrypto=A,t.CryptoKey=h)}}}}))}));var aw=oa("match"),wj=function(t){var e;return ea(t)&&(void 0!==(e=t[aw])?!!e:"RegExp"==Vb(t))},bw=[].push,cw=Math.min,Ae=!O((function(){return!RegExp(4294967295,"y")}));Kg("split",2,(function(t,e,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(t,n){var r=String(hb(this));if(0==(n=void 0===n?4294967295:n>>>0))return[];if(void 0===t)return[r];if(!wj(t))return e.call(r,t,n);var i,o,a,s=[],c=0;for(t=new RegExp(t.source,(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":"")+"g");(i=xf.call(t,r))&&!((o=t.lastIndex)>c&&(s.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&bw.apply(s,i.slice(1)),a=i[0].length,c=o,s.length>=n));)t.lastIndex===i.index&&t.lastIndex++;return c===r.length?(a||!t.test(""))&&s.push(""):s.push(r.slice(c)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e;return[function(e,n){var i=hb(this),o=null==e?void 0:e[t];return void 0!==o?o.call(e,i,n):r.call(String(i),e,n)},function(t,i){var o=n(r,t,this,i,r!==e);if(o.done)return o.value;var a=qa(t);t=String(this);var s=Yc(a,RegExp);if(o=a.unicode,a=new s(Ae?a:"^(?:"+a.source+")",(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Ae?"y":"g")),0==(i=void 0===i?4294967295:i>>>0))return[];if(0===t.length)return null===te(a,t)?[t]:[];var c=0,u=0;for(s=[];u<t.length;){a.lastIndex=Ae?u:0;var l,d=te(a,Ae?t:t.slice(u));if(null===d||(l=cw(za(a.lastIndex+(Ae?0:u)),t.length))===c)u=bj(t,u,o);else{if(s.push(t.slice(c,u)),s.length===i)return s;for(c=1;c<=d.length-1;c++)if(s.push(d[c]),s.length===i)return s;u=c=l}}return s.push(t.slice(c)),s}]}),!Ae),function(t){t.console||(t.console={}),t=t.console;for(var e,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");e=r.pop();)t[e]||(t[e]={});for(;e=i.pop();)t[e]||(t[e]=n)}("undefined"==typeof window?Ta:window),N({target:"Object",stat:!0},{setPrototypeOf:$a});var dw=O((function(){Rb(1)}));N({target:"Object",stat:!0,forced:dw,sham:!Jn},{getPrototypeOf:function(t){return Rb(Wa(t))}});var Eo=[].slice,xj={},ew=Function.bind||function(t){var e=yb(this),n=Eo.call(arguments,1),r=function(){var i=n.concat(Eo.call(arguments));if(this instanceof r){var o=i.length;if(!(o in xj)){for(var a=[],s=0;s<o;s++)a[s]="a["+s+"]";xj[o]=Function("C,a","return new C("+a.join(",")+")")}i=xj[o](e,i)}else i=e.apply(t,i);return i};return ea(e.prototype)&&(r.prototype=e.prototype),r},yj=Wb("Reflect","construct"),Fo=O((function(){function t(){}return!(yj((function(){}),[],t)instanceof t)})),Go=!O((function(){yj((function(){}))})),Ho=Fo||Go;N({target:"Reflect",stat:!0,forced:Ho,sham:Ho},{construct:function(t,e){yb(t),qa(e);var n=3>arguments.length?t:yb(arguments[2]);if(Go&&!Fo)return yj(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}return(n=[null]).push.apply(n,e),new(ew.apply(t,n))}n=n.prototype,n=$b(ea(n)?n:Object.prototype);var r=Function.apply.call(t,n,e);return ea(r)?r:n}}),N({target:"Reflect",stat:!0},{get:el});var Io=Db.f,fw=O((function(){Io(1)}));N({target:"Object",stat:!0,forced:!ja||fw,sham:!ja},{getOwnPropertyDescriptor:function(t,e){return Io(rb(t),e)}});var Jo=wd.f,gw={}.toString,Ko="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],zj=function(t){if(Ko&&"[object Window]"==gw.call(t))try{var e=Jo(t)}catch(t){e=Ko.slice()}else e=Jo(rb(t));return e},Lo={f:oa},hw=Ma.f,Yg=function(t){var e=B.Symbol||(B.Symbol={});P(e,t)||hw(e,t,{value:Lo.f(t)})},tb=yg("hidden"),Mo=oa("toPrimitive"),iw=Ua.set,No=Ua.getterFor("Symbol"),Kb=Object.prototype,ub=B.Symbol,Ff=Wb("JSON","stringify"),Oo=Db.f,cd=Ma.f,Po=zj,jw=kf,Fc=vd("symbols"),Gf=vd("op-symbols"),Aj=vd("string-to-symbol-registry"),Bj=vd("symbol-to-string-registry"),kw=vd("wks"),Cj=B.QObject,Dj=!Cj||!Cj.prototype||!Cj.prototype.findChild,Ej=ja&&O((function(){return 7!=$b(cd({},"a",{get:function(){return cd(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=Oo(Kb,e);r&&delete Kb[e],cd(t,e,n),r&&t!==Kb&&cd(Kb,e,r)}:cd,Fj=function(t,e){var n=Fc[t]=$b(ub.prototype);return iw(n,{type:"Symbol",tag:t,description:e}),ja||(n.description=e),n},Gj=Tm?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof ub},Zg=function(t,e,n){return t===Kb&&Zg(Gf,e,n),qa(t),e=hc(e,!0),qa(n),P(Fc,e)?(n.enumerable?(P(t,tb)&&t[tb][e]&&(t[tb][e]=!1),n=$b(n,{enumerable:Xc(0,!1)})):(P(t,tb)||cd(t,tb,Xc(1,{})),t[tb][e]=!0),Ej(t,e,n)):cd(t,e,n)},Qo=function(t,e){qa(t);var n=rb(e);return e=Dc(n).concat(Hj(n)),Bd(e,(function(e){ja&&!Ij.call(n,e)||Zg(t,e,n[e])})),t},Ij=function(t){t=hc(t,!0);var e=jw.call(this,t);return!(this===Kb&&P(Fc,t)&&!P(Gf,t))&&(!(e||!P(this,t)||!P(Fc,t)||P(this,tb)&&this[tb][t])||e)},Ro=function(t,e){if(t=rb(t),e=hc(e,!0),t!==Kb||!P(Fc,e)||P(Gf,e)){var n=Oo(t,e);return!n||!P(Fc,e)||P(t,tb)&&t[tb][e]||(n.enumerable=!0),n}},So=function(t){t=Po(rb(t));var e=[];return Bd(t,(function(t){P(Fc,t)||P(je,t)||e.push(t)})),e},Hj=function(t){var e=t===Kb;t=Po(e?Gf:rb(t));var n=[];return Bd(t,(function(t){!P(Fc,t)||e&&!P(Kb,t)||n.push(Fc[t])})),n};if(xc||(ub=function(){if(this instanceof ub)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=ie(t),n=function(t){this===Kb&&n.call(Gf,t),P(this,tb)&&P(this[tb],e)&&(this[tb][e]=!1),Ej(this,e,Xc(1,t))};return ja&&Dj&&Ej(Kb,e,{configurable:!0,set:n}),Fj(e,t)},Va(ub.prototype,"toString",(function(){return No(this).tag})),Va(ub,"withoutSetter",(function(t){return Fj(ie(t),t)})),kf=Ij,Ma.f=Zg,Db.f=Ro,wd.f=zj=So,nf.f=Hj,Lo.f=function(t){return Fj(oa(t),t)},ja&&(cd(ub.prototype,"description",{configurable:!0,get:function(){return No(this).description}}),Va(Kb,"propertyIsEnumerable",Ij,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!xc,sham:!xc},{Symbol:ub}),Bd(Dc(kw),(function(t){Yg(t)})),N({target:"Symbol",stat:!0,forced:!xc},{for:function(t){if(t=String(t),P(Aj,t))return Aj[t];var e=ub(t);return Aj[t]=e,Bj[e]=t,e},keyFor:function(t){if(!Gj(t))throw TypeError(t+" is not a symbol");if(P(Bj,t))return Bj[t]},useSetter:function(){Dj=!0},useSimple:function(){Dj=!1}}),N({target:"Object",stat:!0,forced:!xc,sham:!ja},{create:function(t,e){return void 0===e?$b(t):Qo($b(t),e)},defineProperty:Zg,defineProperties:Qo,getOwnPropertyDescriptor:Ro}),N({target:"Object",stat:!0,forced:!xc},{getOwnPropertyNames:So,getOwnPropertySymbols:Hj}),N({target:"Object",stat:!0,forced:O((function(){nf.f(1)}))},{getOwnPropertySymbols:function(t){return nf.f(Wa(t))}}),Ff){var lw=!xc||O((function(){var t=ub();return"[null]"!=Ff([t])||"{}"!=Ff({a:t})||"{}"!=Ff(Object(t))}));N({target:"JSON",stat:!0,forced:lw},{stringify:function(t,e,n){for(var r,i=[t],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=e,(ea(e)||void 0!==t)&&!Gj(t))return zd(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Gj(e))return e}),i[1]=e,Ff.apply(null,i)}})}ub.prototype[Mo]||Ia(ub.prototype,Mo,ub.prototype.valueOf),yc(ub,"Symbol"),je[tb]=!0;var mw=Ma.f,Gc=B.Symbol;if(ja&&"function"==typeof Gc&&(!("description"in Gc.prototype)||void 0!==Gc().description)){var To={},Hf=function(){var t=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof Hf?new Gc(t):void 0===t?Gc():Gc(t);return""===t&&(To[e]=!0),e};Sm(Hf,Gc);var Jj=Hf.prototype=Gc.prototype;Jj.constructor=Hf;var nw=Jj.toString,ow="Symbol(test)"==String(Gc("test")),pw=/^Symbol\((.*)\)[^)]+$/;mw(Jj,"description",{configurable:!0,get:function(){var t=ea(this)?this.valueOf():this,e=nw.call(t);return P(To,t)?"":""===(t=ow?e.slice(7,-1):e.replace(pw,"$1"))?void 0:t}}),N({global:!0,forced:!0},{Symbol:Hf})}Yg("toStringTag"),yc(Math,"Math",!0),yc(B.JSON,"JSON",!0),function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););if(t)return(e=Object.getOwnPropertyDescriptor(t,e)).get?e.get.call(n):e.value})(t,e,n||t)}var c=function(){function e(){t(this,e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(e,[{key:"addEventListener",value:function(t,e,n){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push({callback:e,options:n})}},{key:"removeEventListener",value:function(t,e){if(t in this.listeners)for(var n=0,r=(t=this.listeners[t]).length;n<r;n++)if(t[n].callback===e){t.splice(n,1);break}}},{key:"dispatchEvent",value:function(t){if(t.type in this.listeners){for(var e=this.listeners[t.type].slice(),n=0,r=e.length;n<r;n++){var i=e[n];try{i.callback.call(this,t)}catch(t){Promise.resolve().then((function(){throw t}))}i.options&&i.options.once&&this.removeEventListener(t.type,i.callback)}return!t.defaultPrevented}}}]),e}(),u=function(e){function o(){t(this,o);var e=u.call(this);return e.listeners||c.call(a(e)),Object.defineProperty(a(e),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(a(e),"onabort",{value:null,writable:!0,configurable:!0}),e}r(o,e);var u=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n=i(t);if(e){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==R(n)&&"function"!=typeof n?a(this):n}}(o);return n(o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(t){"abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),s(i(o.prototype),"dispatchEvent",this).call(this,t)}}]),o}(c),l=function(){function e(){t(this,e),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return n(e,[{key:"abort",value:function(){try{var t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event")).initEvent("abort",!1,!1):(t=document.createEventObject()).type="abort":t={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(t)}},{key:"toString",value:function(){return"[object AbortController]"}}]),e}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(t){if(t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var e=!0}else e="function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController;e&&(t.AbortController=l,t.AbortSignal=u)}("undefined"!=typeof self?self:Ta)}();var qw=Math.floor,rw=Math.log,sw=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(t){return(t>>>=0)?31-qw(rw(t+.5)*sw):32}});var tw=Math.log,uw=Math.LN2,Or=Math.clz32||function(t){return 31-tw(t>>>0)/uw|0},ld=String.fromCharCode,Uo={}.toString,Kj=window.Uint8Array,Lj=Kj||Array,vw=Uo.call((window.ArrayBuffer||Lj).prototype),Mj;fl.prototype.decode=function(t){if(t=t&&t.buffer||t,Uo.call(t)!==vw)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var e="",n=0,r=0|(t=Kj?new Lj(t):t).length;n<r;n=n+32768|0)e+=ld.apply(0,t[Kj?"slice":"subarray"](n,n+32768|0));return e.replace(/[\xc0-\xff][\x80-\xbf]*/g,Nr)},window.TextDecoder||(window.TextDecoder=fl),gl.prototype.encode=function(t){for(var e=0|(t=void 0===t?"":(""+t).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,Pr)).length,n=new Lj(e),r=0;r<e;r=r+1|0)n[r]=t.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=gl),function(t){var e,n,r,i,o,a,s,c,u,l;!function(t){t.LOGIN="LOGIN",t.LOGIN_SUCCESS="LOGIN_SUCCESS",t.LOGIN_FAILURE="LOGIN_FAILURE",t.LOGIN_TIMEOUT="LOGIN_TIMEOUT",t.INTERRUPTED="INTERRUPTED",t.LOGOUT="LOGOUT",t.BANNED_BY_SERVER="BANNED_BY_SERVER",t.REMOTE_LOGIN="REMOTE_LOGIN"}(e||(e={})),t.ConnectionChangeReason=e,function(t){t.DISCONNECTED="DISCONNECTED",t.CONNECTING="CONNECTING",t.CONNECTED="CONNECTED",t.RECONNECTING="RECONNECTING",t.ABORTED="ABORTED"}(n||(n={})),t.ConnectionState=n,function(t){t.IDLE="IDLE",t.SENT_TO_REMOTE="SENT_TO_REMOTE",t.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",t.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",t.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",t.CANCELED="CANCELED",t.FAILURE="FAILURE"}(r||(r={})),t.LocalInvitationState=r,function(t){t.INVITATION_RECEIVED="INVITATION_RECEIVED",t.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",t.REFUSED="REFUSED",t.ACCEPTED="ACCEPTED",t.CANCELED="CANCELED",t.FAILURE="FAILURE"}(i||(i={})),t.RemoteInvitationState=i,function(t){t.UNKNOWN="UNKNOWN",t.PEER_NO_RESPONSE="PEER_NO_RESPONSE",t.INVITATION_EXPIRE="INVITATION_EXPIRE",t.PEER_OFFLINE="PEER_OFFLINE",t.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),t.LocalInvitationFailureReason=o,function(t){t.UNKNOWN="UNKNOWN",t.PEER_OFFLINE="PEER_OFFLINE",t.ACCEPT_FAILURE="ACCEPT_FAILURE",t.INVITATION_EXPIRE="INVITATION_EXPIRE"}(a||(a={})),t.RemoteInvitationFailureReason=a,function(t){t.ONLINE="ONLINE",t.UNREACHABLE="UNREACHABLE",t.OFFLINE="OFFLINE"}(s||(s={})),t.PeerOnlineState=s,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",t.PeerSubscriptionOption=c,function(t){t.TEXT="TEXT",t.RAW="RAW",t.IMAGE="IMAGE",t.FILE="FILE"}(u||(u={})),t.MessageType=u,function(t){t.CN="CN",t.NA="NA",t.EU="EU",t.AS="AS",t.JP="JP",t.IN="IN",t.GLOB="GLOB",t.OC="OC",t.SA="SA",t.AF="AF",t.OVS="OVS"}(l||(l={})),t.AreaCode=l}(Mj||(Mj={}));var S=Mj;N({target:"Array",proto:!0},{includes:function(t){return Pm(this,t,1<arguments.length?arguments[1]:void 0)}}),ye("includes");var Nj=function(t){if(wj(t))throw TypeError("The method doesn't accept regular expressions");return t},ww=oa("match"),Oj=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[ww]=!1,"/./"[t](e)}catch(t){}}return!1};N({target:"String",proto:!0,forced:!Oj("includes")},{includes:function(t){return!!~String(hb(this)).indexOf(Nj(t),1<arguments.length?arguments[1]:void 0)}});var xw=O((function(){Dc(1)}));N({target:"Object",stat:!0,forced:xw},{keys:function(t){return Dc(Wa(t))}});var dd={RECONNECTING_AP_INTERVAL:2e3,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};Yg("iterator"),Yg("asyncIterator");var Pj=le("forEach")?[].forEach:function(t){return Bd(this,t,1<arguments.length?arguments[1]:void 0)},Vo;for(Vo in tj){var Wo=B[Vo],$g=Wo&&Wo.prototype;if($g&&$g.forEach!==Pj)try{Ia($g,"forEach",Pj)}catch(c){$g.forEach=Pj}}var yw=[].reverse,Xo=[1,2];N({target:"Array",proto:!0,forced:String(Xo)===String(Xo.reverse())},{reverse:function(){return zd(this)&&(this.length=this.length),yw.call(this)}});var w=Xa((function(t){t=function(t){function e(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}function n(t,e,n,o){return e=Object.create((e&&e.prototype instanceof i?e:i).prototype),o=new h(o||[]),e._invoke=function(t,e,n){var i=E;return function(o,a){if(i===S)throw Error("Generator is already running");if(i===T){if("throw"===o)throw a;return p()}for(n.method=o,n.arg=a;;){if((o=n.delegate)&&(o=u(o,n))){if(o===C)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===E)throw i=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=S,"normal"===(o=r(t,e,n)).type){if(i=n.done?T:_,o.arg===C)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=T,n.method="throw",n.arg=o.arg)}}}(t,n,o),e}function r(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function o(){}function a(){}function s(t){["next","throw","return"].forEach((function(n){e(t,n,(function(t){return this._invoke(n,t)}))}))}function c(t,e){function n(i,o,a,s){if("throw"!==(i=r(t[i],t,o)).type){var c=i.arg;return(i=c.value)&&"object"===R(i)&&g.call(i,"__await")?e.resolve(i.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(i).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(i.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function u(t,e){var n=t.iterator[e.method];if(n===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,u(t,e),"throw"===e.method))return C;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}return"throw"===(n=r(n,t.iterator,e.arg)).type?(e.method="throw",e.arg=n.arg,e.delegate=null,C):(n=n.arg)?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,C):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,C)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function f(t){if(t){var e=t[y];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1;return(e=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e}).next=e}}return{next:p}}function p(){return{value:v,done:!0}}var v,m=Object.prototype,g=m.hasOwnProperty,A="function"==typeof Symbol?Symbol:{},y=A.iterator||"@@iterator",b=A.asyncIterator||"@@asyncIterator",w=A.toStringTag||"@@toStringTag";try{e({},"")}catch(t){e=function(t,e,n){return t[e]=n}}t.wrap=n;var E="suspendedStart",_="suspendedYield",S="executing",T="completed",C={};(A={})[y]=function(){return this};var x=Object.getPrototypeOf;(x=x&&x(x(f([]))))&&x!==m&&g.call(x,y)&&(A=x);var I=a.prototype=i.prototype=Object.create(A);return o.prototype=I.constructor=a,a.constructor=o,o.displayName=e(a,w,"GeneratorFunction"),t.isGeneratorFunction=function(t){return!!(t="function"==typeof t&&t.constructor)&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,e(t,w,"GeneratorFunction")),t.prototype=Object.create(I),t},t.awrap=function(t){return{__await:t}},s(c.prototype),c.prototype[b]=function(){return this},t.AsyncIterator=c,t.async=function(e,r,i,o,a){void 0===a&&(a=Promise);var s=new c(n(e,r,i,o),a);return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},s(I),e(I,w,"Generator"),I[y]=function(){return this},I.toString=function(){return"[object Generator]"},t.keys=function(t){var e,n=[];for(e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=f,h.prototype={constructor:h,reset:function(t){if(this.next=this.prev=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=t,n.arg=e,i?(this.method="next",this.next=i.finallyLoc,C):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),C},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),d(n),C}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){if("throw"===(t=n.completion).type){var r=t.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:f(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),C}},t}(t.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),Yo=!O((function(){return Object.isExtensible(Object.preventExtensions({}))})),Qj=Xa((function(t){var e=Ma.f,n=ie("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(t){e(t,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!ea(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!P(t,n)){if(!i(t))return"F";if(!e)return"E";o(t)}return t[n].objectID},getWeakData:function(t,e){if(!P(t,n)){if(!i(t))return!0;if(!e)return!1;o(t)}return t[n].weakData},onFreeze:function(t){return Yo&&a.REQUIRED&&i(t)&&!P(t,n)&&o(t),t}};je[n]=!0})),Zo=function(t,e,n){var r=-1!==t.indexOf("Map"),i=-1!==t.indexOf("Weak"),o=r?"set":"add",a=B[t],s=a&&a.prototype,c=a,u={},l=function(t){var e=s[t];Va(s,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!ea(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return i&&!ea(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!ea(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})};if(jc(t,"function"!=typeof a||!(i||s.forEach&&!O((function(){(new a).entries().next()})))))c=n.getConstructor(e,t,r,o),Qj.REQUIRED=!0;else if(jc(t,!0)){var d=new c,h=d[o](i?{}:-0,1)!=d,f=O((function(){d.has(1)})),p=Dg((function(t){new a(t)})),v=!i&&O((function(){for(var t=new a,e=5;e--;)t[o](e,e);return!t.has(-0)}));p||((c=e((function(e,n){return zc(e,c,t),e=Sg(new a,e,c),null!=n&&Cg(n,e[o],{that:e,AS_ENTRIES:r}),e}))).prototype=s,s.constructor=c),(f||v)&&(l("delete"),l("has"),r&&l("get")),(v||h)&&l(o),i&&s.clear&&delete s.clear}return u[t]=c,N({global:!0,forced:c!=a},u),yc(c,t),i||n.setStrong(c,t,r),c},zw=Ma.f,$o=Qj.fastKey,ap=Ua.set,Rj=Ua.getterFor,bp={getConstructor:function(t,e,n,r){var i=t((function(t,o){zc(t,i,e),ap(t,{type:e,index:$b(null),first:void 0,last:void 0,size:0}),ja||(t.size=0),null!=o&&Cg(o,t[r],{that:t,AS_ENTRIES:n})})),o=Rj(e),a=function(t,e,n){var r,i=o(t),a=s(t,e);return a?a.value=n:(i.last=a={index:r=$o(e,!0),key:e,value:n,previous:e=i.last,next:void 0,removed:!1},i.first||(i.first=a),e&&(e.next=a),ja?i.size++:t.size++,"F"!==r&&(i.index[r]=a)),t},s=function(t,e){t=o(t);var n=$o(e);if("F"!==n)return t.index[n];for(t=t.first;t;t=t.next)if(t.key==e)return t};return of(i.prototype,{clear:function(){for(var t=o(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,ja?t.size=0:this.size=0},delete:function(t){var e=o(this);if(t=s(this,t)){var n=t.next,r=t.previous;delete e.index[t.index],t.removed=!0,r&&(r.next=n),n&&(n.previous=r),e.first==t&&(e.first=n),e.last==t&&(e.last=r),ja?e.size--:this.size--}return!!t},forEach:function(t){for(var e,n=o(this),r=ne(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),of(i.prototype,n?{get:function(t){return(t=s(this,t))&&t.value},set:function(t,e){return a(this,0===t?0:t,e)}}:{add:function(t){return a(this,t=0===t?0:t,t)}}),ja&&zw(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(t,e,n){var r=e+" Iterator",i=Rj(e),o=Rj(r);oj(t,e,(function(t,e){ap(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),qf(e)}};Zo("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),bp);var Aw=yf("map");N({target:"Array",proto:!0,forced:!Aw},{map:function(t){return ho(this,t,1<arguments.length?arguments[1]:void 0)}});var Bw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,Cw=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Sj=function(t){return function(e){return e=String(hb(e)),1&t&&(e=e.replace(Bw,"")),2&t&&(e=e.replace(Cw,"")),e}};Sj(1),Sj(2);var Tj=Sj(3),ah=B.parseInt,Dw=/^[+-]?0[Xx]/,cp=8!==ah("\t\n\v\f\r                　\u2028\u2029\ufeff08")||22!==ah("\t\n\v\f\r                　\u2028\u2029\ufeff0x16")?function(t,e){return t=Tj(String(t)),ah(t,e>>>0||(Dw.test(t)?16:10))}:ah;N({global:!0,forced:parseInt!=cp},{parseInt:cp});var Ew=Math.floor,dp=function(t){return!ea(t)&&isFinite(t)&&Ew(t)===t},Fw=Math.abs;N({target:"Number",stat:!0},{isSafeInteger:function(t){return dp(t)&&9007199254740991>=Fw(t)}});var Gw=wd.f,Hw=Db.f,Iw=Ma.f,ed=B.Number,bh=ed.prototype,Jw="Number"==Vb($b(bh)),ep=function(t){var e,n=hc(t,!1);if("string"==typeof n&&2<n.length)if(43===(t=(n=Tj(n)).charCodeAt(0))||45===t){if(88===(t=n.charCodeAt(2))||120===t)return NaN}else if(48===t){switch(n.charCodeAt(1)){case 66:case 98:t=2;var r=49;break;case 79:case 111:t=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(e=0;e<i;e++){var o=n.charCodeAt(e);if(48>o||o>r)return NaN}return parseInt(n,t)}return+n};if(jc("Number",!ed(" 0o1")||!ed("0b1")||ed("+0x1"))){for(var Dd=function(t){var e=1>arguments.length?0:t,n=this;return n instanceof Dd&&(Jw?O((function(){bh.valueOf.call(n)})):"Number"!=Vb(n))?Sg(new ed(ep(e)),n,Dd):ep(e)},fp=ja?Gw(ed):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Uj=0,ch;fp.length>Uj;Uj++)P(ed,ch=fp[Uj])&&!P(Dd,ch)&&Iw(Dd,ch,Hw(ed,ch));Dd.prototype=bh,bh.constructor=Dd,Va(B,"Number",Dd)}var gp=oa("isConcatSpreadable"),Kw=51<=pe||!O((function(){var t=[];return t[gp]=!1,t.concat()[0]!==t})),Lw=yf("concat");N({target:"Array",proto:!0,forced:!Kw||!Lw},{concat:function(t){var e,n=Wa(this),r=kj(n,0),i=0,o=-1;for(e=arguments.length;o<e;o++){var a=-1===o?n:arguments[o],s=a;if(ea(s)){var c=s[gp];s=void 0!==c?!!c:zd(s)}else s=!1;if(s){if(9007199254740991<i+(c=za(a.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,i++)s in a&&ue(r,i,a[s])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");ue(r,i++,a)}}return r.length=i,r}});var Mw=!Dg((function(t){Array.from(t)}));N({target:"Array",stat:!0,forced:Mw},{from:function(t){var e,n=Wa(t),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,a=void 0!==o,s=Hi(n),c=0;if(a&&(o=ne(o,2<i?arguments[2]:void 0,2)),null==s||r==Array&&Fi(s)){var u=za(n.length);for(r=new r(u);u>c;c++)s=a?o(n[c],c):n[c],ue(r,c,s)}else for(i=(n=s.call(n)).next,r=new r;!(e=i.call(n)).done;c++){if(a){s=n;var l=o;e=[e.value,c];try{u=l(qa(e)[0],e[1])}catch(t){throw Ii(s),t}}else u=e.value;ue(r,c,s=u)}return r.length=c,r}});var Vj=Wb("Reflect","apply"),Nw=Function.apply,Ow=!O((function(){Vj((function(){}))}));N({target:"Reflect",stat:!0,forced:Ow},{apply:function(t,e,n){return yb(t),qa(n),Vj?Vj(t,e,n):Nw.call(t,e,n)}}),N({target:"Reflect",stat:!0},{ownKeys:Rm});var Pw=zj,Qw=O((function(){return!Object.getOwnPropertyNames(1)}));N({target:"Object",stat:!0,forced:Qw},{getOwnPropertyNames:Pw});var Be="object"===("undefined"==typeof Reflect?"undefined":R(Reflect))?Reflect:null,hp=Be&&"function"==typeof Be.apply?Be.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},Rw=Be&&"function"==typeof Be.ownKeys?Be.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},ip=Number.isNaN||function(t){return t!=t};aa.EventEmitter=aa,aa.prototype._events=void 0,aa.prototype._eventsCount=0,aa.prototype._maxListeners=void 0;var jp=10;Object.defineProperty(aa,"defaultMaxListeners",{enumerable:!0,get:function(){return jp},set:function(t){if("number"!=typeof t||0>t||ip(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");jp=t}}),aa.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},aa.prototype.setMaxListeners=function(t){if("number"!=typeof t||0>t||ip(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},aa.prototype.getMaxListeners=function(){return void 0===this._maxListeners?aa.defaultMaxListeners:this._maxListeners},aa.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);n="error"===t;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<e.length&&(i=e[0]),i instanceof Error)throw i;throw(e=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,e}if(void 0===(n=r[t]))return!1;if("function"==typeof n)hp(n,this,e);else for(r=kl(n,i=n.length),n=0;n<i;++n)hp(r[n],this,e);return!0},aa.prototype.addListener=function(t,e){return hl(this,t,e,!1)},aa.prototype.on=aa.prototype.addListener,aa.prototype.prependListener=function(t,e){return hl(this,t,e,!0)},aa.prototype.once=function(t,e){return Zf(e),this.on(t,il(this,t,e)),this},aa.prototype.prependOnceListener=function(t,e){return Zf(e),this.prependListener(t,il(this,t,e)),this},aa.prototype.removeListener=function(t,e){var n;Zf(e);var r=this._events;if(void 0===r)return this;var i=r[t];if(void 0===i)return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===e||i[n].listener===e){var a=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},aa.prototype.off=aa.prototype.removeListener,aa.prototype.removeAllListeners=function(t){var e=this._events;if(void 0===e)return this;if(void 0===e.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==e[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete e[t]),this;if(0===arguments.length){var n=Object.keys(e);for(e=0;e<n.length;++e){var r=n[e];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=e[t]))this.removeListener(t,n);else if(void 0!==n)for(e=n.length-1;0<=e;e--)this.removeListener(t,n[e]);return this},aa.prototype.listeners=function(t){return jl(this,t,!0)},aa.prototype.rawListeners=function(t){return jl(this,t,!1)},aa.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):ll.call(t,e)},aa.prototype.listenerCount=ll,aa.prototype.eventNames=function(){return 0<this._eventsCount?Rw(this._events):[]},aa.once=function(t,e){return new Promise((function(n,r){function i(){void 0!==o&&t.removeListener("error",o),n([].slice.call(arguments))}if("error"!==e){var o=function(n){t.removeListener(e,i),r(n)};t.once("error",o)}t.once(e,i)}))};var Ce=Object.assign,kp=Object.defineProperty,lp=!Ce||O((function(){if(ja&&1!==Ce({b:1},Ce(kp({},"a",{enumerable:!0,get:function(){kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Ce({},t)[n]||"abcdefghijklmnopqrst"!=Dc(Ce({},e)).join("")}))?function(t,e){for(var n=Wa(t),r=arguments.length,i=1,o=nf.f,a=kf;r>i;)for(var s,c=lf(arguments[i++]),u=o?Dc(c).concat(o(c)):Dc(c),l=u.length,d=0;l>d;)s=u[d++],(!ja||a.call(c,s))&&(n[s]=c[s]);return n}:Ce;N({target:"Object",stat:!0,forced:Object.assign!==lp},{assign:lp}),Zo("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),bp);var Sw=Math.log,Tw=Math.LN2;N({target:"Math",stat:!0},{log2:function(t){return Sw(t)/Tw}}),Df("Float32",(function(t){return function(e,n,r){return t(this,e,n,r)}})),Df("Float64",(function(t){return function(e,n,r){return t(this,e,n,r)}})),Df("Uint16",(function(t){return function(e,n,r){return t(this,e,n,r)}})),Df("Uint32",(function(t){return function(e,n,r){return t(this,e,n,r)}}));var Gh=Symbol(),Fh=function(){};t:{try{var mp="1"===process.env.UMBRELLA_ASSERTS;break t}catch(c){}mp=!1}var Uw=mp?function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"assertion failed";if("function"==typeof t&&!t()||!t)throw Error("function"==typeof e?e():e)}:Fh,Vw=Qj.onFreeze,Wj=Object.freeze,Ww=O((function(){Wj(1)}));N({target:"Object",stat:!0,forced:Ww,sham:!Yo},{freeze:function(t){return Wj&&ea(t)?Wj(Vw(t)):t}});var Xw=Ma.f,Yw=wd.f,Zw=Ua.set,$w=oa("match"),mc=B.RegExp,Xj=mc.prototype,If=/a/g,Yj=/a/g,Zj=new mc(If)!==If;if(ja&&jc("RegExp",!Zj||Ig||O((function(){return Yj[$w]=!1,mc(If)!=If||mc(Yj)==Yj||"/a/i"!=mc(If,"i")})))){for(var Hc=function(t,e){var n,r=this instanceof Hc,i=wj(t),o=void 0===e;return!r&&i&&t.constructor===Hc&&o||(Zj?i&&!o&&(t=t.source):t instanceof Hc&&(o&&(e=Zi.call(t)),t=t.source),Ig&&(n=!!e&&-1<e.indexOf("y"))&&(e=e.replace(/y/g,"")),t=Sg(Zj?new mc(t,e):mc(t,e),r?this:Xj,Hc),Ig&&n&&Zw(t,{sticky:n})),t},ax=function(t){t in Hc||Xw(Hc,t,{configurable:!0,get:function(){return mc[t]},set:function(e){mc[t]=e}})},np=Yw(mc),op=0;np.length>op;)ax(np[op++]);Xj.constructor=Hc,Hc.prototype=Xj,Va(B,"RegExp",Hc)}qf("RegExp");var ak=function(t,e){return t===e?0:null==t?null==e?0:-1:null==e?null==t?0:1:"function"==typeof t.compare?t.compare(e):"function"==typeof e.compare?-e.compare(t):t<e?-1:t>e?1:0},bk=[],pp=bk.sort,bx=O((function(){bk.sort(void 0)})),cx=O((function(){bk.sort(null)})),dx=le("sort");N({target:"Array",proto:!0,forced:bx||!cx||!dx},{sort:function(t){return void 0===t?pp.call(Wa(this)):pp.call(Wa(this),yb(t))}});var qp=Object.getPrototypeOf({}),Jf=function(t,e){var n;return t===e||(null==t?t==e:"function"===R(t.equiv)?t.equiv(e):null==e?t==e:"function"===R(e.equiv)?e.equiv(t):"string"!==R(t)&&"string"!==R(e)&&(null!=(n=Object.getPrototypeOf(t))&&n!==qp||null!=(n=Object.getPrototypeOf(e))&&n!==qp?"function"!==R(t)&&void 0!==t.length&&"function"!==R(e)&&void 0!==e.length?fx(t,e):t instanceof Set&&e instanceof Set?gx(t,e):t instanceof Map&&e instanceof Map?hx(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!=t&&e!=e:ex(t,e)))},fx=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Jf,r=t.length;if(r===e.length)for(;0<=--r&&n(t[r],e[r]););return 0>r},gx=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Jf;return t.size===e.size&&n(I(t.keys()).sort(),I(e.keys()).sort())},hx=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Jf;return t.size===e.size&&n(I(t).sort(),I(e).sort())},ex=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Jf;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!e.hasOwnProperty(r)||!n(t[r],e[r]))return!1;return!0},ix=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t){return void 0!==t?": "+t:""};return function(n){function r(n){return W(this,r),i.call(this,t(n)+e(n))}ka(r,n);var i=la(r);return r}(Re(Error))}((function(){return"illegal argument(s)"})),dh=function(t){throw new ix(t)},rp=1/4294967295,jx=function(){function t(){W(this,t)}return Ea(t,[{key:"float",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*rp*t}},{key:"norm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*rp-.5)*t}},{key:"minmax",value:function(t,e){return this.float()*(e-t)+t}}]),t}(),ck=Math.random,kx=new(function(t){function e(){return W(this,e),n.apply(this,arguments)}ka(e,t);var n=la(e);return Ea(e,[{key:"int",value:function(){return 4294967296*ck()>>>0}},{key:"float",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return ck()*t}},{key:"norm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(ck()-.5)*t}}]),e}(jx)),lx=le("reduce"),mx=!kc&&79<pe&&83>pe;N({target:"Array",proto:!0,forced:!lx||mx},{reduce:function(t){return to(this,t,arguments.length,1<arguments.length?arguments[1]:void 0)}});var nl=function(t){return null!=t&&"function"==typeof t.xform?t.xform():t},$f=function(){function t(e){W(this,t),this.value=e}return Ea(t,[{key:"deref",value:function(){return this.value}}]),t}(),Hh=function(t){return t instanceof $f?t.deref():t},Sr=function(t,e){return[t,function(t){return t},e]},nx=w.mark((function(t,e){var n,r,i,o,a,s;return w.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=nl(t)(Rr()),r=n[1],i=n[2],o=0;case 4:if(!(o<e.length)){c.next=15;break}if(a=e[o],!((s=i([],a))instanceof $f)){c.next=10;break}return c.delegateYield(Hh(r(s.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!s.length){c.next=12;break}return c.delegateYield(s,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(Hh(r([])),"t2",16);case 16:case"end":return c.stop()}}),nx)})),Tr=w.mark(ml),Ur=function(t,e){return[t[0],t[1],e]},sp=!0;"findIndex"in[]&&Array(1).findIndex((function(){sp=!1})),N({target:"Array",proto:!0,forced:sp},{findIndex:function(t){return jo(this,t,1<arguments.length?arguments[1]:void 0)}}),ye("findIndex"),N({target:"Array",proto:!0},{fill:fj}),ye("fill");var ox=function(){function t(e){W(this,t),this._length=0,e&&this.into(e)}return Ea(t,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new t(this)}},{key:"empty",value:function(){return new t}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var t,e=this.head;e;)t=e.next,delete e.value,delete e.prev,delete e.next,e=t;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(t){var e=this._length;if(e<t._length)return-1;if(e>t._length)return 1;if(0===e)return 0;e=this.head,t=t.head;for(var n=0;e&&0==n;)n=ak(e.value,t.value),e=e.next,t=t.next;return n}},{key:"equiv",value:function(e){if(!(e instanceof t||null!=e&&"function"!=typeof e&&void 0!==e.length)||this._length!==e.length)return!1;if(!this._length||this===e)return!0;for(var n=this.head,r=0;r<e.length;r++){if(!Jf(n.value,e[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:w.mark((function t(){var e;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.head;case 1:if(!e){t.next=7;break}return t.next=4,e.value;case 4:e=e.next,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))},{key:"seq",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(t>=e||0>t)){t=this.nthCell(t);var n=this.nthCell(e-1);return e=function t(e){return{first:function(){return e.value},next:function(){return e!==n&&e.next?t(e.next):void 0}}},t?e(t):void 0}}},{key:"cycle",value:w.mark((function t(){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this,"t0",2);case 2:t.next=0;break;case 4:case"end":return t.stop()}}),t,this)}))},{key:"$reduce",value:function(t,e){for(var n=this.head;n&&!(e instanceof $f);)e=t(e,n.value),n=n.next;return e}},{key:"drop",value:function(){var t=this.head;if(t)return(this.head=t.next)?delete this.head.prev:delete this.tail,this._length--,t.value}},{key:"cons",value:function(t){return t={value:t,next:this.head},this.head?this.head.prev=t:this.tail=t,this.head=t,this._length++,this}},{key:"insertBefore",value:function(t,e){return t||dh("cell is undefined"),e={value:e,next:t,prev:t.prev},t.prev?t.prev.next=e:this.head=e,t.prev=e,this._length++,this}},{key:"insertAfter",value:function(t,e){return t||dh("cell is undefined"),e={value:e,next:t.next,prev:t},t.next?t.next.prev=e:this.tail=e,t.next=e,this._length++,this}},{key:"insertBeforeNth",value:function(t,e){return 0>t&&(t+=this._length),0>=t?this.cons(e):(this.ensureIndex(t),this.insertBefore(this.nthCellUnsafe(t),e))}},{key:"insertAfterNth",value:function(t,e){return 0>t&&(t+=this._length),t>=this._length-1?this.push(e):(this.ensureIndex(t),this.insertAfter(this.nthCellUnsafe(t),e))}},{key:"insertSorted",value:function(t,e){e=e||ak;for(var n=this.head;n;){if(0>=e(t,n.value))return this.insertBefore(n,t);n=n.next}return this.push(t)}},{key:"find",value:function(t){for(var e=this.head;e;){if(e.value===t)return e;e=e.next}}},{key:"findWith",value:function(t){for(var e=this.head;e;){if(t(e.value))return e;e=e.next}}},{key:"concat",value:function(){for(var t=this.copy(),e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];for(e=0;e<n.length;e++)t.into(n[e]);return t}},{key:"into",value:function(t){for(var e=0;e<t.length;e++)this.push(t[e])}},{key:"slice",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;e=0>e?e+this._length:e,n=0>n?n+this._length:n,(0>e||0>n)&&dh("invalid indices: ${from} / ${to}");for(var r=new t,i=this.nthCell(e);i&&++e<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof e){0>e&&(e+=this._length),this.ensureIndex(e);var i=this.nthCellUnsafe(e)}else i=e;var o=new t;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,this._length--,this}},{key:"swap",value:function(t,e){if(t!==e){var n=t.value;t.value=e.value,e.value=n}return this}},{key:"push",value:function(t){return this.tail?(t={value:t,prev:this.tail},this.tail=this.tail.next=t,this._length++,this):this.cons(t)}},{key:"pop",value:function(){var t=this.tail;if(t)return(this.tail=t.prev)?delete this.tail.next:delete this.head,this._length--,t.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(t){return this.head?(this.head.value=t,this):this.cons(t)}},{key:"setTail",value:function(t){return this.tail?(this.tail.value=t,this):this.push(t)}},{key:"setNth",value:function(t,e){var n=this.nthCell(t);return!n&&dh("index out of bounds: ".concat(t)),n.value=e,this}},{key:"nth",value:function(t,e){return(t=this.nthCell(t))?t.value:e}},{key:"nthCell",value:function(t){if(0>t&&(t+=this._length),!(0>t||t>=this._length))return this.nthCellUnsafe(t)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var t=this.peek();return this.pop(),this.cons(t)}}},{key:"map",value:function(e){for(var n=new t,r=this.head;r;)n.push(e(r.value)),r=r.next;return n}},{key:"filter",value:function(e){for(var n=new t,r=this.head;r;)e(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(t,e){for(var n=this.head;n;)e=t(e,n.value),n=n.next;return e}},{key:"shuffle",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:kx;if(2>this._length)return this;for(t=null!=t?t:Math.ceil(1.5*Math.log2(this._length));0<t;t--)for(var n=this.head;n;){var r=n.next;.5>e.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ak;if(!this._length)return this;for(var e=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,a=0;a<e&&(o++,i=i.next);a++);for(a=e;0<o||0<a&&i;){if(0===o){var s=i;i=i.next,a--}else i&&0!==a?0>=t(n.value,i.value)?(s=n,n=n.next,o--):(s=i,i=i.next,a--):(s=n,n=n.next,o--);this.tail?this.tail.next=s:this.head=s,s.prev=this.tail,this.tail=s}n=i}if(this.tail.next=void 0,1>=r)return this;e*=2}}},{key:"reverse",value:function(){for(var t=this.head,e=this.tail,n=(this._length>>>1)+(1&this._length);t&&e&&0<n;){var r=t.value;t.value=e.value,e.value=r,t=t.next,e=e.prev,n--}return this}},{key:"asHead",value:function(t){return t===this.head||(this.remove(t),this.head.prev=t,t.next=this.head,t.prev=void 0,this.head=t,this._length++),this}},{key:"asTail",value:function(t){return t===this.tail||(this.remove(t),this.tail.next=t,t.prev=this.tail,t.next=void 0,this.tail=t,this._length++),this}},{key:"toString",value:function(){for(var t=[],e=this.head;e;)t.push(String(e.value)),e=e.next;return t.join(", ")}},{key:"toJSON",value:function(){return I(this)}},{key:"ensureIndex",value:function(t){Uw(0<=t&&t<this._length,"index out of range: ".concat(t))}},{key:"nthCellUnsafe",value:function(t){if(t<=this._length>>1)var e=this.head,n="next";else e=this.tail,n="prev",t=this._length-t-1;for(;0<t--&&e;)e=e[n];return e}}]),t}(),nc=function(){function t(e,n){W(this,t),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new ox,this._size=0,this.opts=n,e&&this.into(e)}return Ea(t,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return ag((function(t){return[t.k,t]}),this.items)}},{key:"keys",value:function(){return ag((function(t){return t.k}),this.items)}},{key:"values",value:function(){return ag((function(t){return t.v}),this.items)}},{key:"copy",value:function(){var t=this.empty();t.items=this.items.copy();for(var e=t.items.head;e;)t.map.set(e.value.k,e),e=e.next;return t}},{key:"empty",value:function(){return new t(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var t=this.opts.release;if(t){for(var e;e=this.items.drop();)t(e.k,e.v);return!0}return this.items.release()}},{key:"has",value:function(t){return this.map.has(t)}},{key:"get",value:function(t,e){return(t=this.map.get(t))?this.resetEntry(t):e}},{key:"set",value:function(t,e){var n=this.opts.ksize(t)+this.opts.vsize(e),r=this.map.get(t);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,t,e,n),e}},{key:"into",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(t,e){var n=this,r=this.map.get(t);return r?Promise.resolve(this.resetEntry(r)):e().then((function(e){return n.set(t,e)}))}},{key:"delete",value:function(t){return!!(t=this.map.get(t))&&(this.removeEntry(t),!0)}},{key:"resetEntry",value:function(t){return this.items.asTail(t),t.value.v}},{key:"ensureSize",value:function(){for(var t=this.opts.release,e=this.opts.maxsize,n=this.opts.maxlen;this._size>e||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),t&&t(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(t){var e=t.value;this.map.delete(e.k),this.items.remove(t),this.opts.release&&this.opts.release(e.k,e.v),this._size-=e.s}},{key:"doSetEntry",value:function(t,e,n,r){t?(t.value.v=n,t.value.s=r,this.items.asTail(t)):(this.items.push({k:e,v:n,s:r}),this.map.set(e,this.items.tail))}}]),t}(),px=function(t){function e(t,r){return W(this,e),r=Object.assign({ttl:36e5},r),n.call(this,t,r)}ka(e,t);var n=la(e);return Ea(e,[{key:"empty",value:function(){return new e(null,this.opts)}},{key:"has",value:function(t){return void 0!==this.get(t)}},{key:"get",value:function(t,e){if(t=this.map.get(t)){if(t.value.t>=Date.now())return this.resetEntry(t);this.removeEntry(t)}return e}},{key:"set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(t)+this.opts.vsize(e),i=this.map.get(t);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=e,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:t,v:e,s:r,t:n}),this.map.set(t,this.items.tail))),e}},{key:"getSet",value:function(t,e){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(t);return i?Promise.resolve(i):e().then((function(e){return n.set(t,e,r)}))}},{key:"prune",value:function(){for(var t=Date.now(),e=this.items.head;e;)e.value.t<t&&this.removeEntry(e),e=e.next}},{key:"ensureSize",value:function(){for(var t=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>t||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Dh(kd(e.prototype),"ensureSize",this).call(this)}}]),e}(nc),tp="object"==R(Ta)&&Ta&&Ta.Object===Object&&Ta,qx="object"==("undefined"==typeof self?"undefined":R(self))&&self&&self.Object===Object&&self,Bb=tp||qx||Function("return this")(),Lb=Bb.Symbol,up=Object.prototype,rx=up.hasOwnProperty,sx=up.toString,Kf=Lb?Lb.toStringTag:void 0,tx=Object.prototype.toString,vp=Lb?Lb.toStringTag:void 0,Ed=function(t){if(null==t)t=void 0===t?"[object Undefined]":"[object Null]";else if(vp&&vp in Object(t)){var e=rx.call(t,Kf),n=t[Kf];try{t[Kf]=void 0;var r=!0}catch(t){}var i=sx.call(t);r&&(e?t[Kf]=n:delete t[Kf]),t=i}else t=tx.call(t);return t},jb=function(t){var e=R(t);return null!=t&&("object"==e||"function"==e)},ci=function(t){return!!jb(t)&&("[object Function]"==(t=Ed(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)},dk=Bb["__core-js_shared__"],wp=function(){var t=/[^.]+$/.exec(dk&&dk.keys&&dk.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ux=Function.prototype.toString,Fd=function(t){if(null!=t){try{return ux.call(t)}catch(t){}return t+""}return""},vx=/^\[object .+?Constructor\]$/,wx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gd=function(t,e){return t=null==t?void 0:t[e],!jb(t)||wp&&wp in t||!(ci(t)?wx:vx).test(Fd(t))?void 0:t},Lf=Gd(Object,"create"),xx=Object.prototype.hasOwnProperty,yx=Object.prototype.hasOwnProperty;nd.prototype.clear=function(){this.__data__=Lf?Lf(null):{},this.size=0},nd.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},nd.prototype.get=function(t){var e=this.__data__;return Lf?"__lodash_hash_undefined__"===(t=e[t])?void 0:t:xx.call(e,t)?e[t]:void 0},nd.prototype.has=function(t){var e=this.__data__;return Lf?void 0!==e[t]:yx.call(e,t)},nd.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Lf&&void 0===e?"__lodash_hash_undefined__":e,this};var Mf=function(t,e){return t===e||t!=t&&e!=e},eh=function(t,e){for(var n=t.length;n--;)if(Mf(t[n][0],e))return n;return-1},zx=Array.prototype.splice;Qd.prototype.clear=function(){this.__data__=[],this.size=0},Qd.prototype.delete=function(t){var e=this.__data__;return!(0>(t=eh(e,t))||(t==e.length-1?e.pop():zx.call(e,t,1),--this.size,0))},Qd.prototype.get=function(t){var e=this.__data__;return 0>(t=eh(e,t))?void 0:e[t][1]},Qd.prototype.has=function(t){return-1<eh(this.__data__,t)},Qd.prototype.set=function(t,e){var n=this.__data__,r=eh(n,t);return 0>r?(++this.size,n.push([t,e])):n[r][1]=e,this};var cg=Qd,Nf=Gd(Bb,"Map"),fh=function(t,e){t=t.__data__;var n=R(e);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?t["string"==typeof e?"string":"hash"]:t.map};Rd.prototype.clear=function(){this.size=0,this.__data__={hash:new nd,map:new(Nf||cg),string:new nd}},Rd.prototype.delete=function(t){return t=fh(this,t).delete(t),this.size-=t?1:0,t},Rd.prototype.get=function(t){return fh(this,t).get(t)},Rd.prototype.has=function(t){return fh(this,t).has(t)},Rd.prototype.set=function(t,e){var n=fh(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var bg=Rd;Te.prototype.add=Te.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Te.prototype.has=function(t){return this.__data__.has(t)};var xp=function(t,e,n,r){var i=t.length;for(n+=r?1:-1;r?n--:++n<i;)if(e(t[n],n,t))return n;return-1},Ax=function(t){return t!=t},Bx=function(t,e){var n;if(n=!(null==t||!t.length)){if(e==e)t:{n=-1;for(var r=t.length;++n<r;)if(t[n]===e){t=n;break t}t=-1}else t=xp(t,Ax,0);n=-1<t}return n},Cx=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1},Dx=function(t,e){return t.has(e)},De=Gd(Bb,"Set"),Ex=function(){},ek=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Fx=1/0,Gx=De&&1/ek(new De([,-0]))[1]==Fx?function(t){return new De(t)}:Ex,fk=function(t,e,n){var r=-1,i=Bx,o=t.length,a=!0,s=[],c=s;if(n)a=!1,i=Cx;else if(200<=o){if(i=e?null:Gx(t))return ek(i);a=!1,i=Dx,c=new Te}else c=e?[]:s;t:for(;++r<o;){var u=t[r],l=e?e(u):u;if(u=n||0!==u?u:0,a&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue t;e&&c.push(l),s.push(u)}else i(c,l,n)||(c!==s&&c.push(l),s.push(u))}return s},yp=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Ud=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i};Sd.prototype.clear=function(){this.__data__=new cg,this.size=0},Sd.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},Sd.prototype.get=function(t){return this.__data__.get(t)},Sd.prototype.has=function(t){return this.__data__.has(t)},Sd.prototype.set=function(t,e){var n=this.__data__;if(n instanceof cg){var r=n.__data__;if(!Nf||199>r.length)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new bg(r)}return n.set(t,e),this.size=n.size,this};var Td=Sd,cs=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},gh=function(){try{var t=Gd(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Of=function(t,e,n){"__proto__"==e&&gh?gh(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Hx=Object.prototype.hasOwnProperty,rl=function(t,e,n){var r=t[e];Hx.call(t,e)&&Mf(r,n)&&(void 0!==n||e in t)||Of(t,e,n)},de=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=r?r(n[s],t[s],s,n,t):void 0;void 0===c&&(c=t[s]),i?Of(n,s,c):rl(n,s,c)}return n},cc=function(t){return null!=t&&"object"==R(t)},zp=function(t){return cc(t)&&"[object Arguments]"==Ed(t)},Ap=Object.prototype,Ix=Ap.hasOwnProperty,Jx=Ap.propertyIsEnumerable,cf=zp(function(){return arguments}())?zp:function(t){return cc(t)&&Ix.call(t,"callee")&&!Jx.call(t,"callee")},Ya=Array.isArray,Kx=function(){return!1},Ve=Xa((function(t,e){var n=(e=e&&!e.nodeType&&e)&&t&&!t.nodeType&&t;e=n&&n.exports===e?Bb.Buffer:void 0,t.exports=(e?e.isBuffer:void 0)||Kx})),Lx=/^(?:0|[1-9]\d*)$/,gk=function(t,e){var n=R(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Lx.test(t))&&-1<t&&0==t%1&&t<e},hk=function(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t},Ba={};Ba["[object Float32Array]"]=Ba["[object Float64Array]"]=Ba["[object Int8Array]"]=Ba["[object Int16Array]"]=Ba["[object Int32Array]"]=Ba["[object Uint8Array]"]=Ba["[object Uint8ClampedArray]"]=Ba["[object Uint16Array]"]=Ba["[object Uint32Array]"]=!0,Ba["[object Arguments]"]=Ba["[object Array]"]=Ba["[object ArrayBuffer]"]=Ba["[object Boolean]"]=Ba["[object DataView]"]=Ba["[object Date]"]=Ba["[object Error]"]=Ba["[object Function]"]=Ba["[object Map]"]=Ba["[object Number]"]=Ba["[object Object]"]=Ba["[object RegExp]"]=Ba["[object Set]"]=Ba["[object String]"]=Ba["[object WeakMap]"]=!1;var Mx=function(t){return cc(t)&&hk(t.length)&&!!Ba[Ed(t)]},hh=function(t){return function(e){return t(e)}},Ee=Xa((function(t,e){var n=e&&!e.nodeType&&e;n=(e=n&&t&&!t.nodeType&&t)&&e.exports===n&&tp.process;t:{try{var r=e&&e.require&&e.require("util").types;if(r){var i=r;break t}i=n&&n.binding&&n.binding("util");break t}catch(t){}i=void 0}t.exports=i})),Bp=Ee&&Ee.isTypedArray,Nh=Bp?hh(Bp):Mx,Nx=Object.prototype.hasOwnProperty,Cp=function(t,e){var n=Ya(t),r=!n&&cf(t),i=!n&&!r&&Ve(t),o=!n&&!r&&!i&&Nh(t);if(n=n||r||i||o){r=t.length;for(var a=String,s=-1,c=Array(r);++s<r;)c[s]=a(s);r=c}else r=[];for(var u in a=r.length,t)!e&&!Nx.call(t,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gk(u,a))||r.push(u);return r},Ox=Object.prototype,ik=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ox)},Dp=function(t,e){return function(n){return t(e(n))}},Px=Dp(Object.keys,Object),Qx=Object.prototype.hasOwnProperty,sd=function(t){return null!=t&&hk(t.length)&&!ci(t)},Rc=function(t){if(sd(t))t=Cp(t);else if(ik(t)){var e,n=[];for(e in Object(t))Qx.call(t,e)&&"constructor"!=e&&n.push(e);t=n}else t=Px(t);return t},Zr=function(t,e){return t&&de(e,Rc(e),t)},Rx=Object.prototype.hasOwnProperty,We=function(t){if(sd(t))t=Cp(t,!0);else if(jb(t)){var e=ik(t),n=[];for(r in t)("constructor"!=r||!e&&Rx.call(t,r))&&n.push(r);t=n}else{var r=[];if(null!=t)for(e in Object(t))r.push(e);t=r}return t},Xr=function(t,e){return t&&de(e,We(e),t)},ol=Xa((function(t,e){var n=(e=e&&!e.nodeType&&e)&&t&&!t.nodeType&&t,r=(e=n&&n.exports===e?Bb.Buffer:void 0)?e.allocUnsafe:void 0;t.exports=function(t,e){return e?t.slice():(e=t.length,e=r?r(e):new t.constructor(e),t.copy(e),e)}})),Ih=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Sx=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o},Ep=function(){return[]},Tx=Object.prototype.propertyIsEnumerable,Fp=Object.getOwnPropertySymbols,jk=Fp?function(t){return null==t?[]:(t=Object(t),Sx(Fp(t),(function(e){return Tx.call(t,e)})))}:Ep,Yr=function(t,e){return de(t,jk(t),e)},Mh=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},kk=Dp(Object.getPrototypeOf,Object),Gp=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Mh(e,jk(t)),t=kk(t);return e}:Ep,Wr=function(t,e){return de(t,Gp(t),e)},Hp=function(t,e,n){return e=e(t),Ya(t)?e:Mh(e,n(t))},Jh=function(t){return Hp(t,Rc,jk)},ql=function(t){return Hp(t,We,Gp)},lk=Gd(Bb,"DataView"),mk=Gd(Bb,"Promise"),nk=Gd(Bb,"WeakMap"),Ux=Fd(lk),Vx=Fd(Nf),Wx=Fd(mk),Xx=Fd(De),Yx=Fd(nk),Hd=Ed;(lk&&"[object DataView]"!=Hd(new lk(new ArrayBuffer(1)))||Nf&&"[object Map]"!=Hd(new Nf)||mk&&"[object Promise]"!=Hd(mk.resolve())||De&&"[object Set]"!=Hd(new De)||nk&&"[object WeakMap]"!=Hd(new nk))&&(Hd=function(t){var e=Ed(t);if(t=(t="[object Object]"==e?t.constructor:void 0)?Fd(t):"")switch(t){case Ux:return"[object DataView]";case Vx:return"[object Map]";case Wx:return"[object Promise]";case Xx:return"[object Set]";case Yx:return"[object WeakMap]"}return e});var Ue=Hd,Zx=Object.prototype.hasOwnProperty,Vr=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Zx.call(t,"index")&&(n.index=t.index,n.input=t.input),n},ih=Bb.Uint8Array,ok=function(t){var e=new t.constructor(t.byteLength);return new ih(e).set(new ih(t)),e},$x=/\w*$/,Ip=Lb?Lb.prototype:void 0,Jp=Ip?Ip.valueOf:void 0,am=function(t,e){return e=e?ok(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.length)},$r=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return ok(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return e=n?ok(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return am(t,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return(e=new t.constructor(t.source,$x.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new r;case"[object Symbol]":return Jp?Object(Jp.call(t)):{}}},Kp=Object.create,ay=function(){function t(){}return function(e){return jb(e)?Kp?Kp(e):(t.prototype=e,e=new t,t.prototype=void 0,e):{}}}(),pl=function(t){return"function"!=typeof t.constructor||ik(t)?{}:ay(kk(t))},by=function(t){return cc(t)&&"[object Map]"==Ue(t)},Lp=Ee&&Ee.isMap,bs=Lp?hh(Lp):by,cy=function(t){return cc(t)&&"[object Set]"==Ue(t)},Mp=Ee&&Ee.isSet,as=Mp?hh(Mp):cy,ra={};ra["[object Arguments]"]=ra["[object Array]"]=ra["[object ArrayBuffer]"]=ra["[object DataView]"]=ra["[object Boolean]"]=ra["[object Date]"]=ra["[object Float32Array]"]=ra["[object Float64Array]"]=ra["[object Int8Array]"]=ra["[object Int16Array]"]=ra["[object Int32Array]"]=ra["[object Map]"]=ra["[object Number]"]=ra["[object Object]"]=ra["[object RegExp]"]=ra["[object Set]"]=ra["[object String]"]=ra["[object Symbol]"]=ra["[object Uint8Array]"]=ra["[object Uint8ClampedArray]"]=ra["[object Uint16Array]"]=ra["[object Uint32Array]"]=!0,ra["[object Error]"]=ra["[object Function]"]=ra["[object WeakMap]"]=!1;var Vd=function(t){return"symbol"==R(t)||cc(t)&&"[object Symbol]"==Ed(t)},dy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ey=/^\w*$/,pk=function(t,e){if(Ya(t))return!1;var n=R(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Vd(t))||ey.test(t)||!dy.test(t)||null!=e&&t in Object(e)};Kh.Cache=bg;var fy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gy=/\\(\\)?/g,hy=function(t){var e=(t=Kh(t,(function(t){return 500===e.size&&e.clear(),t}))).cache;return t}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(fy,(function(t,n,r,i){e.push(r?i.replace(gy,"$1"):n||t)})),e})),ds=1/0,Np=Lb?Lb.prototype:void 0,tl=Np?Np.toString:void 0,jh=function(t,e){return Ya(t)?t:pk(t,e)?[t]:hy(null==t?"":sl(t))},iy=1/0,Pf=function(t){if("string"==typeof t||Vd(t))return t;var e=t+"";return"0"==e&&1/t==-iy?"-0":e},kh=function(t,e){for(var n=0,r=(e=jh(e,t)).length;null!=t&&n<r;)t=t[Pf(e[n++])];return n&&n==r?t:void 0},jy=function(t,e){if(!(2>(e=jh(e,t)).length)){var n=e,r=0,i=-1,o=-1,a=n.length;for(0>r&&(r=-r>a?0:a+r),0>(i=i>a?a:i)&&(i+=a),a=r>i?0:i-r>>>0,r>>>=0,i=Array(a);++o<a;)i[o]=n[o+r];t=kh(t,i)}return(n=null==t)||(n=null==e?0:e.length,n=delete t[Pf(n?e[n-1]:void 0)]),n},Op=Function.prototype.toString,ky=Object.prototype.hasOwnProperty,ly=Op.call(Object),bm=function(t){return!(!cc(t)||"[object Object]"!=Ed(t))&&(null===(t=kk(t))||"function"==typeof(t=ky.call(t,"constructor")&&t.constructor)&&t instanceof t&&Op.call(t)==ly)},my=function(t){return bm(t)?void 0:t},Pp=Lb?Lb.isConcatSpreadable:void 0,es=function(t){return Ya(t)||cf(t)||!!(Pp&&t&&t[Pp])},ny=function(t){return null!=t&&t.length?Lh(t,1):[]},oy=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Qp=Math.max,Rp=function(t,e,n){return e=Qp(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Qp(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];for(i=-1,o=Array(e+1);++i<e;)o[i]=r[i];return o[e]=n(a),oy(t,this,o)}},py=function(t){return function(){return t}},lh=function(t){return t},qy=Date.now,Sp=function(t){var e=0,n=0;return function(){var r=qy(),i=16-(r-n);if(n=r,0<i){if(800<=++e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(gh?function(t,e){return gh(t,"toString",{configurable:!0,enumerable:!1,value:py(e),writable:!0})}:lh),rg=function(t){return Sp(Rp(t,void 0,ny),t+"")}((function(t,e){var n={};if(null==t)return n;var r=!1;e=Ud(e,(function(e){return e=jh(e,t),r||(r=1<e.length),e})),de(t,ql(t),n),r&&(n=dg(n,7,my));for(var i=e.length;i--;)jy(n,e[i]);return n})),ry=function(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r},$l=function(t,e,n){for(var r=-1,i=Object(t),o=(n=n(t)).length;o--;){var a=n[++r];if(!1===e(i[a],a,i))break}return t},Tp=function(t,e){return t&&$l(t,e,Rc)},qk=function(t,e){return function(e,n){if(null==e)return e;if(!sd(e))return t(e,n);for(var r=e.length,i=-1,o=Object(e);++i<r&&!1!==n(o[i],i,o););return e}}(Tp),sy=function(t,e,n,r){return qk(t,(function(t,i,o){e(r,t,n(t),o)})),r},Up=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},ul=function(t,e,n,r,i,o){var a=1&n,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;c=o.get(t);var u=o.get(e);if(c&&u)return c==e&&u==t;c=-1,u=!0;var l=2&n?new Te:void 0;for(o.set(t,e),o.set(e,t);++c<s;){var d=t[c],h=e[c];if(r)var f=a?r(h,d,c,e,t,o):r(d,h,c,t,e,o);if(void 0!==f){if(f)continue;u=!1;break}if(l){if(!Up(e,(function(t,e){if(!l.has(e)&&(d===t||i(d,t,n,r,o)))return l.push(e)}))){u=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){u=!1;break}}return o.delete(t),o.delete(e),u},ty=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n},Vp=Lb?Lb.prototype:void 0,rk=Vp?Vp.valueOf:void 0,fs=function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!o(new ih(t),new ih(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Mf(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=ty;case"[object Set]":if(s||(s=ek),t.size!=e.size&&!(1&r))break;return(n=a.get(t))?n==e:(r|=2,a.set(t,e),e=ul(s(t),s(e),r,i,o,a),a.delete(t),e);case"[object Symbol]":if(rk)return rk.call(t)==rk.call(e)}return!1},gs=Object.prototype.hasOwnProperty,vl=Object.prototype.hasOwnProperty,uy=function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var c=(s=n[i])[0],u=t[c],l=s[1];if(a&&s[2]){if(void 0===u&&!(c in t))return!1}else{if(s=new Td,r)var d=r(u,l,c,t,e,s);if(void 0===d?!Wd(l,u,3,r,s):!d)return!1}}return!0},vy=function(t){for(var e=Rc(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,i==i&&!jb(i)]}return e},Wp=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}},wy=function(t){var e=vy(t);return 1==e.length&&e[0][2]?Wp(e[0][0],e[0][1]):function(n){return n===t||uy(n,t,e)}},xy=function(t,e){return pk(t)&&e==e&&!jb(e)?Wp(Pf(t),e):function(n){var r=null==n?void 0:kh(n,t);if(void 0===(r=void 0===r?void 0:r)&&r===e){if(r=null!=n){for(var i=-1,o=(r=jh(r=t,n)).length,a=!1;++i<o;){var s=Pf(r[i]);if(!(a=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}r=a||++i!=o?a:!!(o=null==n?0:n.length)&&hk(o)&&gk(s,o)&&(Ya(n)||cf(n))}s=r}else s=Wd(e,r,3);return s}},yy=function(t){return function(e){return null==e?void 0:e[t]}},zy=function(t){return function(e){return kh(e,t)}},Fe=function(t){return"function"==typeof t?t:null==t?lh:"object"==R(t)?Ya(t)?xy(t[0],t[1]):wy(t):pk(t)?yy(Pf(t)):zy(t)},sk=function(t,e){return function(e,n){return(Ya(e)?ry:sy)(e,t,Fe(n),{})}}((function(t,e,n){Of(t,n,e)})),oc=function(t,e){var n={};return e=Fe(e),Tp(t,(function(t,r,i){Of(n,r,e(t,r,i))})),n};N({target:"String",proto:!0,forced:O((function(){var t="".sub('"');return t!==t.toLowerCase()||3<t.split('"').length}))},{sub:function(){return"<sub>"+String(hb(this))+"</sub>"}});var U=sa,Mb=null;try{Mb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}sa.prototype.__isLong__,Object.defineProperty(sa.prototype,"__isLong__",{value:!0}),sa.isLong=kb;var xl={},wl={};sa.fromInt=od,sa.fromNumber=Eb,sa.fromBits=ta;var eg=Math.pow;sa.fromString=Oh,sa.fromValue=Sb;var Xd=4294967296,yl=Xd*Xd,Al=yl/2,Xp=od(16777216),Fb=od(0);sa.ZERO=Fb;var pd=od(0,!0);sa.UZERO=pd;var Ge=od(1);sa.ONE=Ge;var Yp=od(1,!0);sa.UONE=Yp;var tk=od(-1);sa.NEG_ONE=tk;var Bl=ta(-1,2147483647,!1);sa.MAX_VALUE=Bl;var zl=ta(-1,-1,!0);sa.MAX_UNSIGNED_VALUE=zl;var lb=ta(0,-2147483648,!1);sa.MIN_VALUE=lb;var E=sa.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*Xd+(this.low>>>0):this.high*Xd+(this.low>>>0)},E.toString=function(t){if(2>(t=t||10)||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(lb)){var e=Eb(t),n=this.div(e);return e=n.mul(e).sub(this),n.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}n=Eb(eg(t,6),this.unsigned),e=this;for(var r="";;){var i=e.div(n),o=(e.sub(i.mul(n)).toInt()>>>0).toString(t);if((e=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(lb)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&0>this.high},E.isPositive=function(){return this.unsigned||0<=this.high},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(t){return kb(t)||(t=Sb(t)),(this.unsigned===t.unsigned||1!=this.high>>>31||1!=t.high>>>31)&&this.high===t.high&&this.low===t.low},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(t){return 0>this.comp(t)},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return 0>=this.comp(t)},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(t){return 0<this.comp(t)},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return 0<=this.comp(t)},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(t){if(kb(t)||(t=Sb(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(lb)?lb:this.not().add(Ge)},E.neg=E.negate,E.add=function(t){kb(t)||(t=Sb(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=t.high>>>16,o=65535&t.high,a=t.low>>>16;return r=(a=((t=(65535&this.low)+(65535&t.low))>>>16)+(r+a))>>>16,ta((65535&a)<<16|65535&t,(e=((r+=n+o)>>>16)+(e+i)&65535)<<16|65535&r,this.unsigned)},E.subtract=function(t){return kb(t)||(t=Sb(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return Fb;if(kb(t)||(t=Sb(t)),Mb){var e=Mb.mul(this.low,this.high,t.low,t.high);return ta(e,Mb.get_high(),this.unsigned)}if(t.isZero())return Fb;if(this.eq(lb))return t.isOdd()?lb:Fb;if(t.eq(lb))return this.isOdd()?lb:Fb;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Xp)&&t.lt(Xp))return Eb(this.toNumber()*t.toNumber(),this.unsigned);e=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=t.high>>>16,a=65535&t.high,s=t.low>>>16,c=i*(t=65535&t.low),u=(c>>>16)+r*t,l=u>>>16;l+=(u=(65535&u)+i*s)>>>16;var d=(l+=n*t)>>>16;return ta((65535&u)<<16|65535&c,(d=(d+=(l=(65535&l)+r*s)>>>16)+((l=(65535&l)+i*a)>>>16)+(e*t+n*s+r*a+i*o)&65535)<<16|65535&l,this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(kb(t)||(t=Sb(t)),t.isZero())throw Error("division by zero");if(Mb)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?ta(t=(this.unsigned?Mb.div_u:Mb.div_s)(this.low,this.high,t.low,t.high),Mb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?pd:Fb;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return pd;if(t.gt(this.shru(1)))return Yp;var e=pd}else{if(this.eq(lb)){if(t.eq(Ge)||t.eq(tk))return lb;if(t.eq(lb))return Ge;var n=this.shr(1).div(t).shl(1);if(n.eq(Fb))return t.isNegative()?Ge:tk;var r=this.sub(t.mul(n));return n.add(r.div(t))}if(t.eq(lb))return this.unsigned?pd:Fb;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();e=Fb}for(r=this;r.gte(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:eg(2,i-48);for(var o=Eb(n),a=o.mul(t);a.isNegative()||a.gt(r);)a=(o=Eb(n-=i,this.unsigned)).mul(t);o.isZero()&&(o=Ge),e=e.add(o),r=r.sub(a)}return e},E.div=E.divide,E.modulo=function(t){return kb(t)||(t=Sb(t)),Mb?ta(t=(this.unsigned?Mb.rem_u:Mb.rem_s)(this.low,this.high,t.low,t.high),Mb.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return ta(~this.low,~this.high,this.unsigned)},E.and=function(t){return kb(t)||(t=Sb(t)),ta(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return kb(t)||(t=Sb(t)),ta(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return kb(t)||(t=Sb(t)),ta(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return kb(t)&&(t=t.toInt()),0==(t&=63)?this:32>t?ta(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):ta(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return kb(t)&&(t=t.toInt()),0==(t&=63)?this:32>t?ta(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):ta(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(kb(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return 32>t?ta(this.low>>>t|e<<32-t,e>>>t,this.unsigned):ta(32===t?e:e>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?ta(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:ta(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},sa.fromBytes=function(t,e,n){return n?sa.fromBytesLE(t,e):sa.fromBytesBE(t,e)},sa.fromBytesLE=function(t,e){return new sa(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},sa.fromBytesBE=function(t,e){return new sa(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var Ph=function(t,e){return(Ph=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},uk=!1,Gb={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):uk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),uk=t},get useDeprecatedSynchronousErrorHandling(){return uk}},mh={closed:!0,next:function(t){},error:function(t){if(Gb.useDeprecatedSynchronousErrorHandling)throw t;Zd(t)},complete:function(){}},Hb=Array.isArray||function(t){return t&&"number"==typeof t.length},Xe=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),Ka=function(){function t(t){this.closed=!1,this._subscriptions=this._parentOrParents=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){if(!this.closed){var e=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e instanceof t)e.remove(this);else if(null!==e)for(var o=0;o<e.length;++o)e[o].remove(this);if(Yd(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(t){var a=t instanceof Xe?Cl(t.errors):[t]}}if(Hb(i))for(o=-1,e=i.length;++o<e;)if(Qh(n=i[o]))try{n.unsubscribe()}catch(t){a=a||[],t instanceof Xe?a=a.concat(Cl(t.errors)):a.push(t)}if(a)throw new Xe(a)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(R(e)){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof t||(e=n,(n=new t)._subscriptions=[e]);break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}if(null===(e=n._parentOrParents))n._parentOrParents=this;else if(e instanceof t){if(e===this)return n;n._parentOrParents=[e,this]}else{if(-1!==e.indexOf(this))return n;e.push(this)}return null===(e=this._subscriptions)?this._subscriptions=[n]:e.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;e&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}(),nh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),fa=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=mh;break;case 1:if(!n){o.destination=mh;break}if("object"===R(n)){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new Zp(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new Zp(o,n,r,i)}return o}return M(e,t),e.prototype[nh]=function(){return this},e.create=function(t,n,r){return(t=new e(t,n,r)).syncErrorThrowable=!1,t},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=t,this},e}(Ka),Zp=function(t){function e(e,n,r,i){var o=t.call(this)||this;if(o._parentSubscriber=e,e=o,Yd(n))var a=n;else n&&(a=n.next,r=n.error,i=n.complete,n!==mh&&(Yd((e=Object.create(n)).unsubscribe)&&o.add(e.unsubscribe.bind(e)),e.unsubscribe=o.unsubscribe.bind(o)));return o._context=e,o._next=a,o._error=r,o._complete=i,o}return M(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;Gb.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=Gb.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?this.__tryOrSetError(e,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Zd(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Zd(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};Gb.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,n):this.__tryOrUnsub(n)}this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),Gb.useDeprecatedSynchronousErrorHandling)throw t;Zd(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!Gb.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{e.call(this._context,n)}catch(e){return Gb.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0):Zd(e),!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._parentSubscriber=this._context=null,t.unsubscribe()},e}(fa),$d="function"==typeof Symbol&&Symbol.observable||"@@observable",V=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator;t:{if(t){if(t instanceof fa)break t;if(t[nh]){t=t[nh]();break t}}t=t||e||n?new fa(t,e,n):new fa(mh)}if(r?t.add(r.call(t,this.source)):t.add(this.source||Gb.useDeprecatedSynchronousErrorHandling&&!t.syncErrorThrowable?this._subscribe(t):this._trySubscribe(t)),Gb.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable&&(t.syncErrorThrowable=!1,t.syncErrorThrown))throw t.syncErrorValue;return t},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){Gb.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),Rh(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=El(e))((function(e,r){var i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[$d]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:Dl(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=El(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}(),fd=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),$p=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return M(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;this.subject=null,!e||0===e.length||t.isStopped||t.closed||-1!==(t=e.indexOf(this.subscriber))&&e.splice(t,1)}},e}(Ka),aq=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return M(e,t),e}(fa),La=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return M(e,t),e.prototype[nh]=function(){return new aq(this)},e.prototype.lift=function(t){var e=new bq(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new fd;if(!this.isStopped){var e=this.observers,n=e.length;e=e.slice();for(var r=0;r<n;r++)e[r].next(t)}},e.prototype.error=function(t){if(this.closed)throw new fd;this.hasError=!0,this.thrownError=t,this.isStopped=!0;var e=this.observers,n=e.length;e=e.slice();for(var r=0;r<n;r++)e[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new fd;this.isStopped=!0;var t=this.observers,e=t.length;t=t.slice();for(var n=0;n<e;n++)t[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new fd;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new fd;return this.hasError?(t.error(this.thrownError),Ka.EMPTY):this.isStopped?(t.complete(),Ka.EMPTY):(this.observers.push(t),new $p(this,t))},e.prototype.asObservable=function(){var t=new V;return t.source=this,t},e.create=function(t,e){return new bq(t,e)},e}(V),bq=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return M(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):Ka.EMPTY},e}(La),hs=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;return n._refCount++,t=new Ay(t,n),e=e.subscribe(t),t.closed||(t.connection=n.connect()),e},t}(),Ay=function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}return M(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;0>=e?this.connection=null:(t._refCount=e-1,1<e?this.connection=null:(e=this.connection,t=t._connection,this.connection=null,!t||e&&t!==e||t.unsubscribe()))}else this.connection=null},e}(fa),cq=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return M(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new Ka).add(this.source.subscribe(new By(this.getSubject(),this))),t.closed&&(this._connection=null,t=Ka.EMPTY)),t},e.prototype.refCount=function(){return Fl()(this)},e}(V),Vs=function(){var t=cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),By=function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}return M(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(aq);!function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}M(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;0>=e?this.connection=null:(t._refCount=e-1,1<e?this.connection=null:(e=this.connection,t=t._connection,this.connection=null,!t||e&&t!==e||t.unsubscribe()))}else this.connection=null}}(fa),function(t){function e(e,n,r,i,o){return(e=t.call(this,e)||this).keySelector=n,e.elementSelector=r,e.durationSelector=i,e.subjectSelector=o,e.groups=null,e.attemptedToUnsubscribe=!1,e.count=0,e}M(e,t),e.prototype._next=function(t){try{var e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(e);if(this.elementSelector)try{var i=this.elementSelector(t)}catch(t){this.error(t)}else i=t;if(!r&&(r=this.subjectSelector?this.subjectSelector():new La,n.set(e,r),t=new vk(e,r,this),this.destination.next(t),this.durationSelector)){t=void 0;try{t=this.durationSelector(new vk(e,r))}catch(t){return void this.error(t)}this.add(t.subscribe(new Cy(e,r,this)))}r.closed||r.next(i)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))}}(fa);var Cy=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.key=e,i.group=n,i.parent=r,i}return M(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(fa),vk=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.groupSubject=n,i.refCountSubscription=r,i}return M(e,t),e.prototype._subscribe=function(t){var e=new Ka,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new Dy(n)),e.add(r.subscribe(t)),e},e}(V),Dy=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return M(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),--e.count,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(Ka),Ey=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return M(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new fd;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(La),Qf=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return M(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,t=this.id;var n=this.scheduler;return null!=t&&(this.id=this.recycleAsyncId(n,t,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(t=this._execute(t,e))?t:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e.prototype._execute=function(t,e){e=!1;var n=void 0;try{this.work(t)}catch(t){e=!0,n=!!t&&t||Error(t)}if(e)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return M(e,t),e.prototype.schedule=function(t,e){return this},e}(Ka)),Fy=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return M(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),0<n?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return 0<n||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(Qf),wk=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),Rf=function(t){function e(n,r){void 0===r&&(r=wk.now);var i=t.call(this,n,(function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return M(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(wk),oh=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e}(Rf))(Fy),dc=new V((function(t){return t.complete()})),Gl=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}},xk;!function(t){t.NEXT="N",t.ERROR="E",t.COMPLETE="C"}(xk||(xk={}));var He=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return mb(this.value);case"E":return ba(this.error);case"C":return Ye()}throw Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),ls=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new dq(t,this.scheduler,this.delay))},t}(),dq=function(t){function e(e,n,r){return void 0===r&&(r=0),(e=t.call(this,e)||this).scheduler=n,e.delay=r,e}return M(e,t),e.dispatch=function(t){t.notification.observe(t.destination),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new Gy(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(He.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(He.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(He.createComplete()),this.unsubscribe()},e}(fa),Gy=function(t,e){this.notification=t,this.destination=e},ce=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>e?1:e,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return M(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new Hy(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new fd;if(this.isStopped||this.hasError)var o=Ka.EMPTY;else this.observers.push(t),o=new $p(this,t);if(r&&t.add(t=new dq(t,r)),e)for(e=0;e<i&&!t.closed;e++)t.next(n[e]);else for(e=0;e<i&&!t.closed;e++)t.next(n[e].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o},e.prototype._getNow=function(){return(this.scheduler||oh).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),0<o&&r.splice(0,o),r},e}(La),Hy=function(t,e){this.time=t,this.value=e},$e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return M(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),Ka.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),Ka.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(La),Iy=1,Jy=Promise.resolve(),Uh={},eq={setImmediate:function(t){var e=Iy++;return Uh[e]=!0,Jy.then((function(){return Hl(e)&&t()})),e},clearImmediate:function(t){Hl(t)}},Ky=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return M(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&0<r?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=eq.setImmediate(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(eq.clearImmediate(n),e.scheduled=void 0)},e}(Qf),di=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(Rf))(Ky),Ly=di,yk=new Rf(Qf),Vc=yk,My=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return M(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&0<r?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(Qf),fq=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(Rf))(My),Ny=function(t){function e(e,n){void 0===e&&(e=gq),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this,e,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return M(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,r=this.maxFrames;(e=n[0])&&e.delay<=r&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(Rf),gq=function(t){function e(e,n,r){void 0===r&&(r=e.index+=1);var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.index=r,i.active=!0,i.index=e.index=r,i}return M(e,t),e.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return t.prototype.schedule.call(this,n,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},e.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),this.delay=t.frame+r,(t=t.actions).push(this),t.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(Qf),zk=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),gg=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}(),pb=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}(),ms=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Oy(t,this.project,this.thisArg))},t}(),Oy=function(t){function e(e,n,r){return(e=t.call(this,e)||this).project=n,e.count=0,e.thisArg=r||e,e}return M(e,t),e.prototype._next=function(t){try{var e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(fa),Ak=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(fa),rs=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return M(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(fa),Py=function(t){return function(e){return t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Zd),e}},Uc="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Qy=function(t){return function(e){for(var n=t[Uc]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e}},Ry=function(t){return function(e){var n=t[$d]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},Nl=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t},af=function(t){if(t&&"function"==typeof t[$d])return Ry(t);if(Nl(t))return Gl(t);if(Ll(t))return Py(t);if(t&&"function"==typeof t[Uc])return Qy(t);throw t=Qh(t)?"an invalid object":"'"+t+"'",new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},hq={},Ty=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Sy(t,this.resultSelector))},t}(),Sy=function(t){function e(e,n){return(e=t.call(this,e)||this).resultSelector=n,e.active=0,e.values=[],e.observables=[],e}return M(e,t),e.prototype._next=function(t){this.values.push(hq),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.toRespond=this.active=e;for(var n=0;n<e;n++)this.add(Vh(this,t[n],void 0,n))}},e.prototype.notifyComplete=function(t){0==--this.active&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=(t=this.values)[n];r=this.toRespond?r===hq?--this.toRespond:this.toRespond:0,t[n]=e,0===r&&(this.resultSelector?this._tryResultSelector(t):this.destination.next(t.slice()))},e.prototype._tryResultSelector=function(t){try{var e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Ak),pc=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return M(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(fa);!function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i}M(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(fa);var qc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(fa);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}M(e,t),e.prototype.notifyNext=function(t,e,n,r){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()}}(fa);var vs=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new Uy(t,this.project,this.concurrent))},t}(),Uy=function(t){function e(e,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(e=t.call(this,e)||this).project=n,e.concurrent=r,e.hasCompleted=!1,e.buffer=[],e.active=0,e.index=0,e}return M(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e=this.index++;try{var n=this.project(t,e)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(n)},e.prototype._innerSub=function(t){var e=new pc(this),n=this.destination;n.add(e),(t=fc(t,e))!==e&&n.add(t)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,0<t.length?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(qc),Bk=B.parseFloat,iq=-1/0!=1/Bk("\t\n\v\f\r                　\u2028\u2029\ufeff-0")?function(t){t=Tj(String(t));var e=Bk(t);return 0===e&&"-"==t.charAt(0)?-0:e}:Bk;N({global:!0,forced:parseFloat!=iq},{parseFloat:iq});var Ck=new V(ec),As=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Vy(t,this.predicate,this.thisArg))},t}(),Vy=function(t){function e(e,n,r){return(e=t.call(this,e)||this).predicate=n,e.thisArg=r,e.count=0,e}return M(e,t),e.prototype._next=function(t){try{var e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(fa),Bs=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Wy(t))},t}(),Wy=function(t){function e(e){return(e=t.call(this,e)||this).hasFirst=!1,e.observables=[],e.subscriptions=[],e}return M(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=Vh(this,t[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){for(this.hasFirst=!0,t=0;t<this.subscriptions.length;t++)if(t!==n){var r=this.subscriptions[t];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(e)},e}(Ak),Es=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Xy(t,this.resultSelector))},t}(),Xy=function(t){function e(e,n,r){return(e=t.call(this,e)||this).resultSelector=n,e.iterators=[],e.active=0,e.resultSelector="function"==typeof n?n:void 0,e}return M(e,t),e.prototype._next=function(t){var e=this.iterators;Hb(t)?e.push(new Yy(t)):"function"==typeof t[Uc]?e.push(new Zy(t[Uc]())):e.push(new $y(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0===e)this.destination.complete();else{this.active=e;for(var n=0;n<e;n++){var r=t[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++){var i=t[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,a=[];for(r=0;r<e;r++){var s=(i=t[r]).next();if(i.hasCompleted()&&(o=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),o&&n.complete()},e.prototype._tryresultSelector=function(t){try{var e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(fa),Zy=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return!(!t||!t.done)},t}(),Yy=function(){function t(t){this.array=t,this.length=this.index=0,this.length=t.length}return t.prototype[Uc]=function(){return this},t.prototype.next=function(t){t=this.index++;var e=this.array;return t<this.length?{value:e[t],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),$y=function(t){function e(e,n,r){return(e=t.call(this,e)||this).parent=n,e.observable=r,e.stillUnsubscribed=!0,e.buffer=[],e.isComplete=!1,e}return M(e,t),e.prototype[Uc]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return 0<this.buffer.length},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return fc(this.observable,new pc(this))},e}(qc),az=Object.freeze({__proto__:null,Observable:V,ConnectableObservable:cq,GroupedObservable:vk,observable:$d,Subject:La,BehaviorSubject:Ey,ReplaySubject:ce,AsyncSubject:$e,asap:Ly,asapScheduler:di,async:Vc,asyncScheduler:yk,queue:oh,queueScheduler:oh,animationFrame:fq,animationFrameScheduler:fq,VirtualTimeScheduler:Ny,VirtualAction:gq,Scheduler:wk,Subscription:Ka,Subscriber:fa,Notification:He,get NotificationKind(){return xk},pipe:Sh,noop:ec,identity:Sc,isObservable:function(t){return!!t&&(t instanceof V||"function"==typeof t.lift&&"function"==typeof t.subscribe)},ArgumentOutOfRangeError:zk,EmptyError:gg,ObjectUnsubscribedError:fd,UnsubscriptionError:Xe,TimeoutError:pb,bindCallback:Il,bindNodeCallback:Jl,combineLatest:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=e=void 0;return Tc(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Hb(t[0])&&(t=t[0]),Ze(t,n).lift(new Ty(e))},concat:Ol,defer:qd,empty:Ye,forkJoin:Pl,from:Ib,fromEvent:fb,fromEventPattern:Rl,generate:function(t,e,n,r,i){if(1==arguments.length){var o=t.initialState;e=t.condition,n=t.iterate;var a=t.resultSelector||Sc;i=t.scheduler}else void 0===r||Tc(r)?(o=t,a=Sc,i=r):(o=t,a=r);return new V((function(t){var r=o;if(i)return i.schedule(ws,0,{subscriber:t,iterate:n,condition:e,resultSelector:a,state:r});for(;;){if(e){var s=void 0;try{s=e(r)}catch(e){t.error(e);break}if(!s){t.complete();break}}s=void 0;try{s=a(r)}catch(e){t.error(e);break}if(t.next(s),t.closed)break;try{r=n(r)}catch(e){t.error(e);break}}}))},iif:function(t,e,n){return void 0===e&&(e=dc),void 0===n&&(n=dc),qd((function(){return t()?e:n}))},interval:Sl,merge:Tb,never:function(){return Ck},of:mb,onErrorResumeNext:Yh,pairs:function(t,e){return new V(e?function(n){var r=Object.keys(t),i=new Ka;return i.add(e.schedule(ys,0,{keys:r,index:0,subscriber:n,subscription:i,obj:t})),i}:function(e){for(var n=Object.keys(t),r=0;r<n.length&&!e.closed;r++){var i=n[r];t.hasOwnProperty(i)&&e.next([i,t[i]])}e.complete()})},partition:function(t,e,n){return[nb(e,n)(new V(af(t))),nb(zs(e,n))(new V(af(t)))]},race:ya,range:function(t,e,n){return void 0===t&&(t=0),new V((function(r){void 0===e&&(e=t,t=0);var i=0,o=t;if(n)return n.schedule(Cs,0,{index:i,count:e,start:t,subscriber:r});for(;;){if(i++>=e){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:ba,timer:uc,using:function(t,e){return new V((function(n){try{var r=t()}catch(t){return void n.error(t)}try{var i=e(r)}catch(t){return void n.error(t)}var o=(i?Ib(i):dc).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:Zh,scheduled:Ml,EMPTY:dc,NEVER:Ck,config:Gb}),Fs=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new bz(t,this.selector,this.caught))},t}(),bz=function(t){function e(e,n,r){return(e=t.call(this,e)||this).selector=n,e.caught=r,e}return M(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle(),e=new pc(this),this.add(e),(n=fc(n,e))!==e&&this.add(n)}},e}(qc),Gs=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new cz(t,this.defaultValue))},t}(),cz=function(t){function e(e,n){return(e=t.call(this,e)||this).defaultValue=n,e.isEmpty=!0,e}return M(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(fa),Hs=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new dz(t,this.delay,this.scheduler))},t}(),dz=function(t){function e(e,n,r){return(e=t.call(this,e)||this).delay=n,e.scheduler=r,e.queue=[],e.active=!1,e.errored=!1,e}return M(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(e=Math.max(0,n[0].time-r.now()),this.schedule(t,e)):(this.unsubscribe(),e.active=!1)},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler;t=new ez(e.now()+this.delay,t),this.queue.push(t),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(He.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(He.createComplete()),this.unsubscribe()},e}(fa),ez=function(t,e){this.time=t,this.notification=e},Is=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new fz(t,this.keySelector,this.flushes))},t}(),fz=function(t){function e(e,n,r){return(e=t.call(this,e)||this).keySelector=n,e.values=new Set,r&&e.add(fc(r,new pc(e))),e}return M(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e=this.destination;try{var n=this.keySelector(t)}catch(t){return void e.error(t)}this._finalizeNext(n,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(qc),Ks=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new gz(t,this.errorFactory))},t}(),gz=function(t){function e(e,n){return(e=t.call(this,e)||this).errorFactory=n,e.hasValue=!1,e}return M(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(fa),Ls=function(){function t(t){if(this.total=t,0>this.total)throw new zk}return t.prototype.call=function(t,e){return e.subscribe(new hz(t,this.total))},t}(),hz=function(t){function e(e,n){return(e=t.call(this,e)||this).total=n,e.count=0,e}return M(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(fa),Ms=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new iz(t,this.project))},t}(),iz=function(t){function e(e,n){return(e=t.call(this,e)||this).project=n,e.hasSubscription=!1,e.hasCompleted=!1,e.index=0,e}return M(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e=this.index++;try{var n=this.project(t,e)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(n)},e.prototype._innerSub=function(t){var e=new pc(this),n=this.destination;n.add(e),(t=fc(t,e))!==e&&n.add(t)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(qc),Ns=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new jz(t,this.callback))},t}(),jz=function(t){function e(e,n){return(e=t.call(this,e)||this).add(new Ka(n)),e}return M(e,t),e}(fa),Ps=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new kz(t))},t}(),kz=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),e.prototype._next=function(t){},e}(fa),Qs=function(){function t(t){if(this.total=t,0>this.total)throw new zk}return t.prototype.call=function(t,e){return e.subscribe(new lz(t,this.total))},t}(),lz=function(t){function e(e,n){return(e=t.call(this,e)||this).total=n,e.ring=[],e.count=0,e}return M(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(0<e)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=e++%n;t.next(r[o])}t.complete()},e}(fa),Rs=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new mz(t,this.value))},t}(),mz=function(t){function e(e,n){return(e=t.call(this,e)||this).value=n,e}return M(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(fa),Ss=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new nz(t,this.accumulator,this.seed,this.hasSeed))},t}(),nz=function(t){function e(e,n,r,i){return(e=t.call(this,e)||this).accumulator=n,e._seed=r,e.hasSeed=i,e.index=0,e}return M(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e=this.index++;try{var n=this.accumulator(this.seed,t,e)}catch(t){this.destination.error(t)}this.seed=n,this.destination.next(n)},e}(fa),Us=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory();return(t=n(r).subscribe(t)).add(e.subscribe(r)),t},t}(),Ws=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new oz(t,this.notifier,this.source))},t}(),oz=function(t){function e(e,n,r){return(e=t.call(this,e)||this).notifier=n,e.source=r,e}return M(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new La;try{r=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}i=fc(r,new pc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}(qc),Zs=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new pz(t,this.project))},t}(),pz=function(t){function e(e,n){return(e=t.call(this,e)||this).project=n,e.index=0,e}return M(e,t),e.prototype._next=function(t){var e=this.index++;try{var n=this.project(t,e)}catch(t){return void this.destination.error(t)}this._innerSub(n)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe(),e=new pc(this);var n=this.destination;n.add(e),this.innerSubscription=fc(t,e),this.innerSubscription!==e&&n.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(qc),$s=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){t=new qz(t);var n=fc(this.notifier,new pc(t));return n&&!t.seenValue?(t.add(n),e.subscribe(t)):t},t}(),qz=function(t){function e(e){return(e=t.call(this,e)||this).seenValue=!1,e}return M(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(qc),bt=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new rz(t,this.predicate,this.inclusive))},t}(),rz=function(t){function e(e,n,r){return(e=t.call(this,e)||this).predicate=n,e.inclusive=r,e.index=0,e}return M(e,t),e.prototype._next=function(t){var e=this.destination;try{var n=this.predicate(t,this.index++)}catch(t){return void e.error(t)}this.nextOrComplete(t,n)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;e?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(fa),ct=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new sz(t,this.nextOrObserver,this.error,this.complete))},t}(),sz=function(t){function e(e,n,r,i){return(e=t.call(this,e)||this)._tapNext=ec,e._tapError=ec,e._tapComplete=ec,e._tapError=r||ec,e._tapComplete=i||ec,Yd(n)?(e._context=e,e._tapNext=n):n&&(e._context=n,e._tapNext=n.next||ec,e._tapError=n.error||ec,e._tapComplete=n.complete||ec),e}return M(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(fa),et={leading:!0,trailing:!1};!function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.destination=e,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}M(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._sendValue;this._hasValue&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){(t=this.tryDurationSelector(t))&&this.add(this._throttled=fc(t,new pc(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()}}(qc);for(var ft=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new tz(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),tz=function(t){function e(e,n,r,i,o){return(e=t.call(this,e)||this).duration=n,e.scheduler=r,e.leading=i,e.trailing=o,e._hasTrailingValue=!1,e._trailingValue=null,e}return M(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(gt,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(fa),it=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new uz(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),uz=function(t){function e(e,n,r,i,o){return(e=t.call(this,e)||this).absoluteTimeout=n,e.waitFor=r,e.withObservable=i,e.scheduler=o,e.scheduleTimeout(),e}return M(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(fc(e,new pc(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},e}(qc),kt=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new vz(t,this.observables,this.project))},t}(),vz=function(t){function e(e,n,r){(e=t.call(this,e)||this).observables=n,e.project=r,e.toRespond=[],r=n.length,e.values=Array(r);for(var i=0;i<r;i++)e.toRespond.push(i);for(i=0;i<r;i++)e.add(Vh(e,n[i],void 0,i));return e}return M(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e,0<(t=this.toRespond).length&&-1!==(n=t.indexOf(n))&&t.splice(n,1)},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){0===this.toRespond.length&&(t=[t].concat(this.values),this.project?this._tryProject(t):this.destination.next(t))},e.prototype._tryProject=function(t){try{var e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Ak),jq=Xa((function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var n=new Uint8Array(16);t.exports=function(){return e(n),n}}else{var r=Array(16);t.exports=function(){for(var t,e=0;16>e;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}})),ab=[],ph=0;256>ph;++ph)ab[ph]=(ph+256).toString(16).substr(1);var kq=function(t,e){return e=e||0,[ab[t[e++]],ab[t[e++]],ab[t[e++]],ab[t[e++]],"-",ab[t[e++]],ab[t[e++]],"-",ab[t[e++]],ab[t[e++]],"-",ab[t[e++]],ab[t[e++]],"-",ab[t[e++]],ab[t[e++]],ab[t[e++]],ab[t[e++]],ab[t[e++]],ab[t[e++]]].join("")},Id=function(t,e,n){if(n=e&&n||0,"string"==typeof t&&(e="binary"===t?Array(16):null,t=null),(t=(t=t||{}).random||(t.rng||jq)())[6]=15&t[6]|64,t[8]=63&t[8]|128,e)for(var r=0;16>r;++r)e[n+r]=t[r];return e||kq(t)},Sf=Id(),Ic,gd,Dk,Ek,hd,Jd,ac,Ie,Nb,Fk,Jc,Kd,Kc,Lc,Mc,Je,Nc,Oc;!function(t){t[t.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",t[t.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",t[t.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",t[t.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",t[t.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",t[t.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",t[t.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Ic||(Ic={})),function(t){t[t.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",t[t.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",t[t.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",t[t.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",t[t.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",t[t.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(gd||(gd={})),function(t){t[t.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Dk||(Dk={})),function(t){t[t.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Ek||(Ek={})),function(t){t[t.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",t[t.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",t[t.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",t[t.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",t[t.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",t[t.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(hd||(hd={})),function(t){t[t.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",t[t.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",t[t.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",t[t.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",t[t.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Jd||(Jd={})),function(t){t[t.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",t[t.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",t[t.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",t[t.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",t[t.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",t[t.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",t[t.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",t[t.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",t[t.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",t[t.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",t[t.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ac||(ac={})),function(t){t[t.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",t[t.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",t[t.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",t[t.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(Ie||(Ie={})),function(t){t[t.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",t[t.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",t[t.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",t[t.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",t[t.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",t[t.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",t[t.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",t[t.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",t[t.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",t[t.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",t[t.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Nb||(Nb={})),function(t){t[t.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Fk||(Fk={})),function(t){t[t.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",t[t.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",t[t.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",t[t.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",t[t.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",t[t.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",t[t.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Jc||(Jc={})),function(t){t[t.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Kd||(Kd={})),function(t){t[t.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",t[t.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",t[t.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",t[t.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",t[t.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",t[t.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",t[t.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",t[t.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Kc||(Kc={})),function(t){t[t.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Lc||(Lc={})),function(t){t[t.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",t[t.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",t[t.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",t[t.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",t[t.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",t[t.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",t[t.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Mc||(Mc={})),function(t){t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Je||(Je={})),function(t){t[t.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",t[t.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",t[t.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",t[t.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",t[t.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",t[t.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",t[t.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Nc||(Nc={})),function(t){t[t.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",t[t.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",t[t.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",t[t.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",t[t.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",t[t.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",t[t.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Oc||(Oc={}));var Ob=Ic.ATTRIBUTE_OPERATION_ERR_FAILURE,Fa=Ic.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,ee=Ic.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Ic.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var lq=Ic.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Pb=Ic.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Qb=Ic.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,Tf=gd.CHANNEL_MESSAGE_ERR_FAILURE,Gk=gd.CHANNEL_MESSAGE_ERR_TIMEOUT,mq=gd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,qh=gd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;gd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var Uf=gd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,wz=Dk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,xz=Ek.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Lc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var nq=Lc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Lc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var oq=Lc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,yz=Lc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Lc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var zz=Lc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,Az=hd.GET_MEMBERS_ERR_FAILURE,Bz=hd.GET_MEMBERS_ERR_REJECTED;hd.GET_MEMBERS_ERR_TIMEOUT,hd.GET_MEMBERS_ERR_TOO_OFTEN;var Cz=hd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,Dz=hd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,rc=Jd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,Ez=Jd.INVITATION_API_CALL_ERR_NOT_STARTED,rh=Jd.INVITATION_API_CALL_ERR_ALREADY_END,pq=Jd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,Fz=Jd.INVITATION_API_CALL_ERR_ALREADY_SENT,qq=ac.JOIN_CHANNEL_ERR_FAILURE;ac.JOIN_CHANNEL_ERR_REJECTED;var Gz=ac.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,rq=ac.JOIN_CHANNEL_TIMEOUT,sq=ac.JOIN_CHANNEL_ERR_EXCEED_LIMIT,tq=ac.JOIN_CHANNEL_ERR_ALREADY_JOINED;ac.JOIN_CHANNEL_ERR_TOO_OFTEN;var uq=ac.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,vq=ac.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,wq=Ie.LEAVE_CHANNEL_ERR_FAILURE,xq=Ie.LEAVE_CHANNEL_ERR_REJECTED,Hz=Ie.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,Iz=Ie.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,yq=Nb.LOGIN_ERR_UNKNOWN,sh=Nb.LOGIN_ERR_REJECTED,th=Nb.LOGIN_ERR_INVALID_ARGUMENT,zq=Nb.LOGIN_ERR_INVALID_APP_ID,Aq=Nb.LOGIN_ERR_INVALID_TOKEN,uh=Nb.LOGIN_ERR_TOKEN_EXPIRED;Nb.LOGIN_ERR_NOT_AUTHORIZED;var Jz=Nb.LOGIN_ERR_ALREADY_LOGIN,Kz=Nb.LOGIN_ERR_TIMEOUT,Lz=Nb.LOGIN_ERR_TOO_OFTEN,Bq=Fk.LOGOUT_ERR_USER_NOT_LOGGED_IN,Cq=Jc.PEER_MESSAGE_ERR_FAILURE,Hk=Jc.PEER_MESSAGE_ERR_TIMEOUT,Dq=Jc.PEER_MESSAGE_ERR_TOO_OFTEN,Ik=Jc.PEER_MESSAGE_ERR_INVALID_USERID,ge=Jc.PEER_MESSAGE_ERR_INVALID_MESSAGE,Jk=Jc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,Mz=Jc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,Eq=Kd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Kd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var Nz=Kd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Kd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var Oz=Kd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,Pz=Kc.RENEW_TOKEN_ERR_FAILURE,Qz=Kc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Kc.RENEW_TOKEN_ERR_REJECTED,Kc.RENEW_TOKEN_ERR_TOO_OFTEN;var Rz=Kc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,Sz=Kc.RENEW_TOKEN_ERR_INVALID_TOKEN,Tz=Kc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,Fq=Mc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Vf=Mc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Mc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var Uz=Mc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Mc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var Gq=Mc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Kk=Mc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Je.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Je.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Je.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Je.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var Wf=Nc.UPLOAD_MEDIA_ERR_FAILURE,jf=Nc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,vh=Nc.UPLOAD_MEDIA_ERR_TIMEOUT,Vz=Nc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,Wz=Nc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,Hq=Nc.UPLOAD_MEDIA_ERR_INTERRUPTED,Xz=Nc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,Xf=Oc.DOWNLOAD_MEDIA_ERR_FAILURE,Lk=Oc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,Yz=Oc.DOWNLOAD_MEDIA_ERR_TIMEOUT,Zz=Oc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,$z=Oc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,Iq=Oc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,aA=Oc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,bA=function(t,e){var n;return qk(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n},wh=function(t,e,n){if(!jb(n))return!1;var r=R(e);return!!("number"==r?sd(n)&&gk(e,n.length):"string"==r&&e in n)&&Mf(n[e],t)},Mk=function(t,e,n){var r=Ya(t)?Up:bA;return n&&wh(t,e,n)&&(e=void 0),r(t,Fe(e))},cA=function(t,e){var n=-1,r=sd(t)?Array(t.length):[];return qk(t,(function(t,i,o){r[++n]=e(t,i,o)})),r},dA=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t},eA=function(t,e,n){e=e.length?Ud(e,(function(t){return Ya(t)?function(e){return kh(e,1===t.length?t[0]:t)}:t})):[lh];var r=-1;return e=Ud(e,hh(Fe)),t=cA(t,(function(t,n,i){return{criteria:Ud(e,(function(e){return e(t)})),index:++r,value:t}})),dA(t,(function(t,e){t:{for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){e:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,d=null===c,h=c==c,f=Vd(c),p=void 0!==u,v=null===u,m=u==u,g=Vd(u);if(!v&&!g&&!f&&c>u||f&&p&&m&&!v&&!g||d&&p&&m||!l&&m||!h){c=1;break e}if(!d&&!f&&!g&&c<u||g&&l&&h&&!d&&!f||v&&l&&h||!p&&h||!m){c=-1;break e}}c=0}if(c){t=r>=s?c:c*("desc"==n[r]?-1:1);break t}}t=t.index-e.index}return t}))},Jq=function(t,e){return Sp(Rp(t,e,lh),t+"")},Kq=Jq((function(t,e){if(null==t)return[];var n=e.length;return 1<n&&wh(t,e[0],e[1])?e=[]:2<n&&wh(e[0],e[1],e[2])&&(e=[e[0]]),eA(t,Lh(e,1),[])})),Lq=function(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}(az),Mq=Xa((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=[],r=function(t,e){return new WebSocket(t,e)};e.normalClosureMessage="Normal closure",e.default=function(t,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,a=void 0===o?n:o,s=void 0===(i=i.makeWebSocket)?r:i;return new Lq.Observable((function(n){var r,i=new Lq.Subject,o=s(t,a),c=!1,u=!1,l=function(t){if(r)throw c=!0,t=Error("Web socket message factory function called more than once"),n.error(t),t;return r=t.subscribe((function(t){o.send(t)})),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(t){i.next(t.data)},o.onerror=function(t){c=!0,n.error(Error(t.message))},o.onclose=function(t){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===t.code?e.normalClosureMessage:t.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(t){t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")&&t.default}(Mq);var bi=function(t,e,n){(void 0===n||Mf(t[e],n))&&(void 0!==n||e in t)||Of(t,e,n)},ai=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},fA=function(t){return Jq((function(e,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,a=2<i?n[2]:void 0;for(o=3<t.length&&"function"==typeof o?(i--,o):void 0,a&&wh(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),e=Object(e);++r<i;)(a=n[r])&&t(e,a,r,o);return e}))}((function(t,e,n,r){Zl(t,e,n,r)})),cm=[],dm=function(t,e){return new WebSocket(t,e)};N({target:"Number",stat:!0},{isInteger:dp}),Sn("from",jj,ej);var gA=function(t,e){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(t){if(o)if(o=!1,t)a(t);else{for(var e=Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,a(t))}}))},hA=Xa((function(t,e){e.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;1<--e%4&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};var n=Array(64),r=Array(123);for(t=0;64>t;)r[n[t]=26>t?t+65:52>t?t+71:62>t?t-4:t-59|43]=t++;e.encode=function(t,e,r){for(var i,o=null,a=[],s=0,c=0;e<r;){var u=t[e++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},e.decode=function(t,e,n){for(var i,o=n,a=0,s=0;s<t.length;){var c=t.charCodeAt(s++);if(61===c&&1<a)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(a){case 0:i=c,a=1;break;case 1:e[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:e[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:e[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-o},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}}));jg.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},jg.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else{t=this._listeners[t];for(var n=0;n<t.length;)t[n].fn===e?t.splice(n,1):++n}return this},jg.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this};var iA=em(em),jA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(t){}return null},kA=Xa((function(t,e){e.length=function(t){for(var e,n=0,r=0;r<t.length;++r)128>(e=t.charCodeAt(r))?n+=1:2048>e?n+=2:55296==(64512&e)&&56320==(64512&t.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},e.read=function(t,e,n){if(1>n-e)return"";for(var r,i=null,o=[],a=0;e<n;)128>(r=t[e++])?o[a++]=r:191<r&&224>r?o[a++]=(31&r)<<6|63&t[e++]:239<r&&365>r?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},e.write=function(t,e,n){for(var r,i,o=n,a=0;a<t.length;++a)128>(r=t.charCodeAt(a))?e[n++]=r:(2048>r?e[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=t.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,e[n++]=r>>18|240,e[n++]=r>>12&63|128):e[n++]=r>>12|224,e[n++]=r>>6&63|128),e[n++]=63&r|128);return n-o}})),lA=function(t,e,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){return 1>n||n>i?t(n):(a+n>r&&(o=t(r),a=0),n=e.call(o,a,a+=n),7&a&&(a=1+(7|a)),n)}},Ld=Ra.zero=new Ra(0,0);Ld.toNumber=function(){return 0},Ld.zzEncode=Ld.zzDecode=function(){return this},Ld.length=function(){return 1};var mA=Ra.zeroHash="\0\0\0\0\0\0\0\0";Ra.fromNumber=function(t){if(0===t)return Ld;var e=0>t;e&&(t=-t);var n=t>>>0;return t=(t-n)/4294967296>>>0,e&&(t=~t>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++t&&(t=0))),new Ra(n,t)},Ra.from=function(t){if("number"==typeof t)return Ra.fromNumber(t);if(T.isString(t)){if(!T.Long)return Ra.fromNumber(parseInt(t,10));t=T.Long.fromString(t)}return t.low||t.high?new Ra(t.low>>>0,t.high>>>0):Ld},Ra.prototype.toNumber=function(t){if(!t&&this.hi>>>31){t=1+~this.lo>>>0;var e=~this.hi>>>0;return t||(e=e+1>>>0),-(t+4294967296*e)}return this.lo+4294967296*this.hi},Ra.prototype.toLong=function(t){return T.Long?new T.Long(0|this.lo,0|this.hi,!!t):{low:0|this.lo,high:0|this.hi,unsigned:!!t}};var id=String.prototype.charCodeAt;Ra.fromHash=function(t){return t===mA?Ld:new Ra((id.call(t,0)|id.call(t,1)<<8|id.call(t,2)<<16|id.call(t,3)<<24)>>>0,(id.call(t,4)|id.call(t,5)<<8|id.call(t,6)<<16|id.call(t,7)<<24)>>>0)},Ra.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Ra.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},Ra.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},Ra.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?16384>t?128>t?1:2:2097152>t?3:4:16384>e?128>e?5:6:2097152>e?7:8:128>n?9:10};var T=Xa((function(t,e){function n(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function r(t){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}e.asPromise=gA,e.base64=hA,e.EventEmitter=jg,e.float=iA,e.inquire=jA,e.utf8=kA,e.pool=lA,e.LongBits=Ra,e.isNode=!!(void 0!==Ta&&Ta&&Ta.process&&Ta.process.versions&&Ta.process.versions.node),e.global=e.isNode&&Ta||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ta,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"===R(t)},e.isset=e.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==R(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,n){return t=e.LongBits.fromHash(t),e.Long?e.Long.fromBits(t.lo,t.hi,n):t.toNumber(!!n)},e.merge=n,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;-1<n;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},e.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}})),ji=ha,Nk,xh=T.LongBits,Nq=T.base64,Oq=T.utf8,Pq=function(){return T.Buffer?function(){return(ha.create=function(){return new Nk})()}:function(){return new ha}};ha.create=Pq(),ha.alloc=function(t){return new T.Array(t)},T.Array!==Array&&(ha.alloc=T.pool(ha.alloc,T.Array.prototype.subarray)),ha.prototype._push=function(t,e,n){return this.tail=this.tail.next=new df(t,e,n),this.len+=e,this},gi.prototype=Object.create(df.prototype),gi.prototype.fn=function(t,e,n){for(;127<t;)e[n++]=127&t|128,t>>>=7;e[n]=t},ha.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new gi(128>(t>>>=0)?1:16384>t?2:2097152>t?3:268435456>t?4:5,t)).len,this},ha.prototype.int32=function(t){return 0>t?this._push(hi,10,xh.fromNumber(t)):this.uint32(t)},ha.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},ha.prototype.uint64=function(t){return t=xh.from(t),this._push(hi,t.length(),t)},ha.prototype.int64=ha.prototype.uint64,ha.prototype.sint64=function(t){return t=xh.from(t).zzEncode(),this._push(hi,t.length(),t)},ha.prototype.bool=function(t){return this._push(fi,1,t?1:0)},ha.prototype.fixed32=function(t){return this._push(ii,4,t>>>0)},ha.prototype.sfixed32=ha.prototype.fixed32,ha.prototype.fixed64=function(t){return t=xh.from(t),this._push(ii,4,t.lo)._push(ii,4,t.hi)},ha.prototype.sfixed64=ha.prototype.fixed64,ha.prototype.float=function(t){return this._push(T.float.writeFloatLE,4,t)},ha.prototype.double=function(t){return this._push(T.float.writeDoubleLE,8,t)};var nA=T.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};ha.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(fi,1,0);if(T.isString(t)){var n=ha.alloc(e=Nq.length(t));Nq.decode(t,n,0),t=n}return this.uint32(e)._push(nA,e,t)},ha.prototype.string=function(t){var e=Oq.length(t);return e?this.uint32(e)._push(Oq.write,e,t):this._push(fi,1,0)},ha.prototype.fork=function(){return this.states=new nt(this),this.head=this.tail=new df(ei,0,0),this.len=0,this},ha.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new df(ei,0,0),this.len=0),this},ha.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},ha.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},ha._configure=function(t){Nk=t,ha.create=Pq(),Nk._configure()},(gc.prototype=Object.create(ji.prototype)).constructor=gc,gc._configure=function(){gc.alloc=T._Buffer_allocUnsafe,gc.writeBytesBuffer=T.Buffer&&T.Buffer.prototype instanceof Uint8Array&&"set"===T.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]}},gc.prototype.bytes=function(t){T.isString(t)&&(t=T._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(gc.writeBytesBuffer,e,t),this},gc.prototype.string=function(t){var e=T.Buffer.byteLength(t);return this.uint32(e),e&&this._push(ot,e,t),this},gc._configure();var li=Ha,Ok,jm=T.LongBits,oA=T.utf8,Qq="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Ha(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Ha(t);throw Error("illegal buffer")},Rq=function(){return T.Buffer?function(t){return(Ha.create=function(t){return T.Buffer.isBuffer(t)?new Ok(t):Qq(t)})(t)}:Qq};Ha.create=Rq(),Ha.prototype._slice=T.Array.prototype.subarray||T.Array.prototype.slice,Ha.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ub(this,10);return t}}(),Ha.prototype.int32=function(){return 0|this.uint32()},Ha.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},Ha.prototype.bool=function(){return 0!==this.uint32()},Ha.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ub(this,4);return kg(this.buf,this.pos+=4)},Ha.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ub(this,4);return 0|kg(this.buf,this.pos+=4)},Ha.prototype.float=function(){if(this.pos+4>this.len)throw Ub(this,4);var t=T.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Ha.prototype.double=function(){if(this.pos+8>this.len)throw Ub(this,4);var t=T.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Ha.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Ub(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},Ha.prototype.string=function(){var t=this.bytes();return oA.read(t,0,t.length)},Ha.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw Ub(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw Ub(this)}while(128&this.buf[this.pos++]);return this},Ha.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Ha._configure=function(t){Ok=t,Ha.create=Rq(),Ok._configure();var e=T.Long?"toLong":"toNumber";T.merge(Ha.prototype,{int64:function(){return ki.call(this)[e](!1)},uint64:function(){return ki.call(this)[e](!0)},sint64:function(){return ki.call(this).zzDecode()[e](!1)},fixed64:function(){return km.call(this)[e](!0)},sfixed64:function(){return km.call(this)[e](!1)}})},(td.prototype=Object.create(li.prototype)).constructor=td,td._configure=function(){T.Buffer&&(td.prototype._slice=T.Buffer.prototype.slice)},td.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},td._configure(),(ef.prototype=Object.create(T.EventEmitter.prototype)).constructor=ef,ef.prototype.rpcCall=function t(e,n,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return T.asPromise(t,a,e,n,r,i);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(t,n){if(t)return a.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",n,e),o(null,n)}a.end(!0)}))}catch(t){a.emit("error",t,e),setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},ef.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var pA=Xa((function(t,e){e.Service=ef})),qA={},bc=Xa((function(t,e){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=e;r.build="minimal",r.Writer=ji,r.BufferWriter=gc,r.Reader=li,r.BufferReader=td,r.util=T,r.rpc=pA,r.roots=qA,r.configure=n,n()}));bc.util.Long=U,bc.configure();var y=bc.Reader,J=bc.Writer,q=bc.util,t=bc.roots.default||(bc.roots.default={}),rA=t.URI=function(){var t={},e=Object.create(t);return e[t[0]="Unknown"]=0,e[t[1]="PingUri"]=1,e[t[2]="PongUri"]=2,e[t[11]="UserJoinUri"]=11,e[t[12]="UserRespUri"]=12,e[t[21]="UserQuitUri"]=21,e[t[22]="UserDropUri"]=22,e[t[31]="GroupEnterUri"]=31,e[t[32]="GroupLeaveUri"]=32,e[t[33]="GroupReplyUri"]=33,e[t[36]="GroupEnterNoticeUri"]=36,e[t[37]="GroupLeaveNoticeUri"]=37,e[t[38]="GroupEventNoticeUri"]=38,e[t[39]="GroupCountNoticeUri"]=39,e[t[41]="UserStatusListUri"]=41,e[t[42]="UserStatusResultUri"]=42,e[t[51]="GroupStatusListUri"]=51,e[t[52]="GroupStatusResultUri"]=52,e[t[55]="GroupAllUsersListUri"]=55,e[t[56]="GroupAllUsersResultUri"]=56,e[t[100]="MessageUri"]=100,e[t[101]="AckUri"]=101,e[t[115]="FileUploadIndexGetUri"]=115,e[t[116]="FileUploadIndexRetUri"]=116,e[t[117]="FileUploadIndexSetUri"]=117,e[t[118]="FileUploadIndexFinUri"]=118,e[t[119]="FileUploadIndexErrUri"]=119,e[t[125]="FileDownloadIndexGetUri"]=125,e[t[126]="FileDownloadIndexRetUri"]=126,e[t[127]="FileDownloadIndexErrUri"]=127,e[t[201]="UserJoinNoticeUri"]=201,e[t[202]="UserQuitNoticeUri"]=202,e[t[203]="UserWaitNoticeUri"]=203,e[t[301]="UserAttributeGetUri"]=301,e[t[302]="UserAttributeRetUri"]=302,e[t[303]="UserAttributeSetUri"]=303,e[t[304]="UserAttributeModUri"]=304,e[t[305]="UserAttributeDelUri"]=305,e[t[307]="UserAttributeRspUri"]=307,e[t[308]="UserAttributeErrUri"]=308,e[t[311]="UserAttributeKeysGetUri"]=311,e[t[312]="UserAttributeKeysRetUri"]=312,e[t[351]="GroupAttributeGetUri"]=351,e[t[352]="GroupAttributeRetUri"]=352,e[t[353]="GroupAttributeSetUri"]=353,e[t[354]="GroupAttributeModUri"]=354,e[t[355]="GroupAttributeDelUri"]=355,e[t[356]="GroupAttributeAltUri"]=356,e[t[357]="GroupAttributeRspUri"]=357,e[t[358]="GroupAttributeErrUri"]=358,e[t[361]="GroupAttributeKeysGetUri"]=361,e[t[362]="GroupAttributeKeysRetUri"]=362,e[t[401]="SubscribeUserStatusUri"]=401,e[t[402]="UnsubscribeUserStatusUri"]=402,e[t[499]="SubscribeResponseUri"]=499,e}(),yh=t.Wrapper=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(t,e){return e||(e=J.create()),null!=t.uri&&Object.hasOwnProperty.call(t,"uri")&&e.uint32(8).int32(t.uri),null!=t.data&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),sA=t.Ping=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(16).uint64(t.ms),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),tA=t.Pong=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(16).uint64(t.ms),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),uA=t.UserJoin=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.opt&&Object.hasOwnProperty.call(t,"opt")&&e.uint32(16).uint64(t.opt),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(24).uint64(t.instance),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(34).string(t.account),null!=t.ticket&&Object.hasOwnProperty.call(t,"ticket")&&e.uint32(42).string(t.ticket),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),vA=t.UserResp=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(24).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),wA=t.UserQuit=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.encode=function(t,e){return e||(e=J.create()),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),xA=t.UserDrop=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),yA=t.GroupEnter=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),zA=t.GroupLeave=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.account="",e.encode=function(t,e){return e||(e=J.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),AA=t.GroupReply=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(24).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),Sq=t.GroupLeaveNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(18).string(t.user),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(32).uint64(t.instance),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(40).uint32(t.size),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),Tq=t.GroupEnterNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(18).string(t.user),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(32).uint64(t.instance),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(40).uint32(t.size),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),Uq=t.Message=function(){function e(t){if(this.MiscMap={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){if(e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.dialogue&&Object.hasOwnProperty.call(t,"dialogue")&&e.uint32(16).uint64(t.dialogue),null!=t.sequence&&Object.hasOwnProperty.call(t,"sequence")&&e.uint32(24).uint64(t.sequence),null!=t.options&&Object.hasOwnProperty.call(t,"options")&&e.uint32(32).uint64(t.options),null!=t.src&&Object.hasOwnProperty.call(t,"src")&&e.uint32(42).string(t.src),null!=t.dst&&Object.hasOwnProperty.call(t,"dst")&&e.uint32(50).string(t.dst),null!=t.payload&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(58).bytes(t.payload),null!=t.MiscMap&&Object.hasOwnProperty.call(t,"MiscMap"))for(var n=Object.keys(t.MiscMap),r=0;r<n.length;++r)e.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(t.MiscMap[n[r]]).ldelim();return null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(72).uint64(t.ms),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r,i,o=new t.Message;e.pos<n;)switch(r=e.uint32(),r>>>3){case 1:o.instance=e.uint64();break;case 2:o.dialogue=e.uint64();break;case 3:o.sequence=e.uint64();break;case 4:o.options=e.uint64();break;case 5:o.src=e.string();break;case 6:o.dst=e.string();break;case 7:o.payload=e.bytes();break;case 8:o.MiscMap===q.emptyObject&&(o.MiscMap={});var a=e.uint32()+e.pos;for(r="",i=[];e.pos<a;){var s=e.uint32();switch(s>>>3){case 1:r=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&s)}}o.MiscMap[r]=i;break;case 9:o.ms=e.uint64();break;default:e.skipType(7&r)}return o},e}(),Vq=t.Ack=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.dialogue&&Object.hasOwnProperty.call(t,"dialogue")&&e.uint32(16).uint64(t.dialogue),null!=t.sequence&&Object.hasOwnProperty.call(t,"sequence")&&e.uint32(24).uint64(t.sequence),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(32).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),BA=t.FileUploadIndexGet=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.hash&&Object.hasOwnProperty.call(t,"hash")&&e.uint32(18).bytes(t.hash),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(24).uint32(t.size),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),CA=t.FileUploadIndexRet=function(){function e(t){if(this.servers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.unit&&Object.hasOwnProperty.call(t,"unit")&&e.uint32(16).uint32(t.unit),null!=t.servers&&t.servers.length){e.uint32(26).fork();for(var n=0;n<t.servers.length;++n)e.uint32(t.servers[n]);e.ldelim()}return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),DA=t.FileUploadIndexSet=function(){function e(t){if(this.servers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.hash&&Object.hasOwnProperty.call(t,"hash")&&e.uint32(18).bytes(t.hash),null!=t.unit&&Object.hasOwnProperty.call(t,"unit")&&e.uint32(24).uint32(t.unit),null!=t.servers&&t.servers.length){e.uint32(34).fork();for(var n=0;n<t.servers.length;++n)e.uint32(t.servers[n]);e.ldelim()}return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),EA=t.FileUploadIndexFin=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.zone&&Object.hasOwnProperty.call(t,"zone")&&e.uint32(16).uint32(t.zone),null!=t.unit&&Object.hasOwnProperty.call(t,"unit")&&e.uint32(24).uint32(t.unit),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),FA=t.FileUploadIndexErr=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),GA=t.FileDownloadIndexGet=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.zone&&Object.hasOwnProperty.call(t,"zone")&&e.uint32(16).uint32(t.zone),null!=t.hash&&Object.hasOwnProperty.call(t,"hash")&&e.uint32(26).bytes(t.hash),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(32).uint32(t.size),null!=t.unit&&Object.hasOwnProperty.call(t,"unit")&&e.uint32(40).uint32(t.unit),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),HA=t.FileDownloadIndexRet=function(){function e(t){if(this.servers=[],this.backups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.unit&&Object.hasOwnProperty.call(t,"unit")&&e.uint32(16).uint32(t.unit),null!=t.zone&&Object.hasOwnProperty.call(t,"zone")&&e.uint32(24).uint32(t.zone),null!=t.servers&&t.servers.length){e.uint32(34).fork();for(var n=0;n<t.servers.length;++n)e.uint32(t.servers[n]);e.ldelim()}if(null!=t.backups&&t.backups.length){for(e.uint32(42).fork(),n=0;n<t.backups.length;++n)e.uint32(t.backups[n]);e.ldelim()}return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),IA=t.FileDownloadIndexErr=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),JA=t.GroupAllUsersList=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.pageSize&&Object.hasOwnProperty.call(t,"pageSize")&&e.uint32(24).uint32(t.pageSize),null!=t.pageNumber&&Object.hasOwnProperty.call(t,"pageNumber")&&e.uint32(32).uint32(t.pageNumber),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),KA=t.GroupAllUsersResult=function(){function e(t){if(this.memberInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.ts&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).uint32(t.ts),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),LA=t.UserStatusList=function(){function e(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),MA=t.UserStatusResult=function(){function e(t){if(this.userInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.ts&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).uint32(t.ts),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),NA=t.UserAttributeGet=function(){function e(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),OA=t.UserAttributeRet=function(){function e(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),PA=t.UserAttributeSet=function(){function e(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),QA=t.UserAttributeMod=function(){function e(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),RA=t.UserAttributeDel=function(){function e(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),SA=t.UserAttributeErr=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),TA=t.UserAttributeKeysGet=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),UA=t.UserAttributeKeysRet=function(){function e(t){if(this.keys=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.keys&&t.keys.length)for(var n=0;n<t.keys.length;++n)e.uint32(18).string(t.keys[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),VA=t.UserAttributeRsp=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),WA=t.GroupStatusList=function(){function e(t){if(this.groups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.groups&&t.groups.length)for(var n=0;n<t.groups.length;++n)e.uint32(18).string(t.groups[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),XA=t.GroupStatusResult=function(){function e(t){if(this.groupInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(10).string(t.group),null!=t.memberCount&&Object.hasOwnProperty.call(t,"memberCount")&&e.uint32(16).uint32(t.memberCount),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),YA=t.GroupCountNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(32).uint32(t.size),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ZA=t.GroupAttributeGet=function(){function e(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),$A=t.GroupAttributeRet=function(){function e(t){if(this.attributeMaps=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),null!=t.origin&&Object.hasOwnProperty.call(t,"origin")&&e.uint32(26).string(t.origin),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(32).uint64(t.ms),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),aB=t.GroupAttributeSet=function(){function e(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),bB=t.GroupAttributeMod=function(){function e(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),cB=t.GroupAttributeDel=function(){function e(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.broadcast&&Object.hasOwnProperty.call(t,"broadcast")&&e.uint32(24).bool(t.broadcast),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(34).string(t.attributes[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),dB=t.GroupAttributeAlt=function(){function e(t){if(this.attributeMaps=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),null!=t.origin&&Object.hasOwnProperty.call(t,"origin")&&e.uint32(26).string(t.origin),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(32).uint64(t.ms),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),eB=t.GroupAttributeRsp=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),fB=t.GroupAttributeErr=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),gB=t.GroupAttributeKeysGet=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(t,e){return e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),hB=t.GroupAttributeKeysRet=function(){function e(t){if(this.keys=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.keys&&t.keys.length)for(var n=0;n<t.keys.length;++n)e.uint32(18).string(t.keys[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),iB=t.SubscribeUserStatus=function(){function e(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),jB=t.UnsubscribeUserStatus=function(){function e(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(t,e){if(e||(e=J.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),kB=t.UserJoinNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(t,e){return e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),lB=t.UserQuitNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(t,e){return e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),mB=t.UserWaitNotice=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(t,e){return e||(e=J.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),nB=t.SubscribeResponse=function(){function e(t){if(this.errors=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(e,n){if(n||(n=J.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(t,e){return e||(e=J.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},e.decode=function(e,n){e instanceof y||(e=y.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),oB=Object.freeze({__proto__:null,URI:rA,Wrapper:yh,Ping:sA,Pong:tA,UserJoin:uA,UserResp:vA,UserQuit:wA,UserDrop:xA,GroupEnter:yA,GroupLeave:zA,GroupReply:AA,GroupLeaveNotice:Sq,GroupEnterNotice:Tq,Message:Uq,Ack:Vq,FileUploadIndexGet:BA,FileUploadIndexRet:CA,FileUploadIndexSet:DA,FileUploadIndexFin:EA,FileUploadIndexErr:FA,FileDownloadIndexGet:GA,FileDownloadIndexRet:HA,FileDownloadIndexErr:IA,GroupAllUsersList:JA,GroupAllUsersResult:KA,UserStatusList:LA,UserStatusResult:MA,UserAttributeGet:NA,UserAttributeRet:OA,UserAttributeSet:PA,UserAttributeMod:QA,UserAttributeDel:RA,UserAttributeErr:SA,UserAttributeKeysGet:TA,UserAttributeKeysRet:UA,UserAttributeRsp:VA,GroupStatusList:WA,GroupStatusResult:XA,GroupCountNotice:YA,GroupAttributeGet:ZA,GroupAttributeRet:$A,GroupAttributeSet:aB,GroupAttributeMod:bB,GroupAttributeDel:cB,GroupAttributeAlt:dB,GroupAttributeRsp:eB,GroupAttributeErr:fB,GroupAttributeKeysGet:gB,GroupAttributeKeysRet:hB,SubscribeUserStatus:iB,UnsubscribeUserStatus:jB,UserJoinNotice:kB,UserQuitNotice:lB,UserWaitNotice:mB,SubscribeResponse:nB,default:t}),pB="".repeat||function(t){var e=String(hb(this)),n="";if(0>(t=ic(t))||1/0==t)throw RangeError("Wrong number of repetitions");for(;0<t;(t>>>=1)&&(e+=e))1&t&&(n+=e);return n},qB=Math.ceil,Wq=function(t){return function(e,n,r){var i=(e=String(hb(e))).length;return r=void 0===r?" ":String(r),(n=za(n))<=i||""==r?e:(n-=i,(i=pB.call(r,qB(n/r.length))).length>n&&(i=i.slice(0,n)),t?e+i:i+e)}},rB=Wq(!1),sB=Wq(!0),Xq=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(oe);N({target:"String",proto:!0,forced:Xq},{padEnd:function(t){return sB(this,t,1<arguments.length?arguments[1]:void 0)}}),N({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var tB=kf,Yq=function(t){return function(e){e=rb(e);for(var n,r=Dc(e),i=r.length,o=0,a=[];i>o;)n=r[o++],ja&&!tB.call(e,n)||a.push(t?[n,e[n]]:e[n]);return a}},uB=[Yq(!0),Yq(!1)][0];N({target:"Object",stat:!0},{entries:function(t){return uB(t)}});var vB=Db.f,Zq="".endsWith,wB=Math.min,$q=Oj("endsWith"),xB=!$q&&!!function(){var t=vB(String.prototype,"endsWith");return t&&!t.writable}();N({target:"String",proto:!0,forced:!xB&&!$q},{endsWith:function(t){var e=String(hb(this));Nj(t);var n=1<arguments.length?arguments[1]:void 0,r=za(e.length);return n=void 0===n?r:wB(za(n),r),r=String(t),Zq?Zq.call(e,r,n):e.slice(n-r.length,n)===r}}),Kg("match",1,(function(t,e,n){return[function(e){var n=hb(this),r=null==e?void 0:e[t];return void 0!==r?r.call(e,n):new RegExp(e)[t](String(n))},function(t){var r=n(e,t,this);if(r.done)return r.value;if(t=qa(t),r=String(this),!t.global)return te(t,r);var i=t.unicode;t.lastIndex=0;for(var o,a=[],s=0;null!==(o=te(t,r));)o=String(o[0]),a[s]=o,""===o&&(t.lastIndex=bj(r,za(t.lastIndex),i)),s++;return 0===s?null:a}]}));var yB=Db.f,ar="".startsWith,zB=Math.min,br=Oj("startsWith"),AB=!br&&!!function(){var t=yB(String.prototype,"startsWith");return t&&!t.writable}();N({target:"String",proto:!0,forced:!AB&&!br},{startsWith:function(t){var e=String(hb(this));Nj(t);var n=za(zB(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return ar?ar.call(e,r,n):e.slice(n,n+r.length)===r}});var sm=function(t){var e=/(%?)(%([jds]))/g,n=Array.prototype.slice.call(arguments,1);return n.length&&(t=t.replace(e,(function(t,e,r,i){switch(r=n.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return e?(n.unshift(r),t):r}))),n.length&&(t+=" "+n.join(" ")),""+t.replace(/%{2,2}/g,"%")},BB=/\s/,CB=function(t){for(var e=t.length;e--&&BB.test(t.charAt(e)););return e},DB=/^\s+/,cr=NaN,EB=/^[-+]0x[0-9a-f]+$/i,FB=/^0b[01]+$/i,GB=/^0o[0-7]+$/i,HB=parseInt,Pk=function(t){if("number"==typeof t)return t;if(Vd(t))return cr;if(jb(t)&&(t="function"==typeof t.valueOf?t.valueOf():t,t=jb(t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t?t.slice(0,CB(t)+1).replace(DB,""):t;var e=FB.test(t);return e||GB.test(t)?HB(t.slice(2),e?2:8):EB.test(t)?cr:+t},IB=Math.max,JB=Math.min,KB=function(t,e,n){function r(e){var n=c,r=u;return c=u=void 0,f=e,l=t.apply(r,n)}function i(t){var n=t-h;return t-=f,void 0===h||n>=e||0>n||v&&t>=g}function o(){var t=Bb.Date.now();if(i(t))return a(t);var n=setTimeout,r=t-f;t=e-(t-h),r=v?JB(t,g-r):t,d=n(o,r)}function a(t){return d=void 0,m&&c?r(t):(c=u=void 0,l)}function s(){var t=Bb.Date.now(),n=i(t);if(c=arguments,u=this,h=t,n){if(void 0===d)return f=t=h,d=setTimeout(o,e),p?r(t):l;if(v)return clearTimeout(d),d=setTimeout(o,e),r(h)}return void 0===d&&(d=setTimeout(o,e)),l}var c,u,l,d,h,f=0,p=!1,v=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");if(e=Pk(e)||0,jb(n)){p=!!n.leading;var g=(v="maxWait"in n)?IB(Pk(n.maxWait)||0,e):g;m="trailing"in n?!!n.trailing:m}return s.cancel=function(){void 0!==d&&clearTimeout(d),f=0,c=h=u=d=void 0},s.flush=function(){return void 0===d?l:a(Bb.Date.now())},s},sc=function(t){function e(t,i){return W(this,e),m(n(t=r.call(this,rm(t,i))),"originalError",void 0),m(n(t),"code",void 0),m(n(t),"serverCode",void 0),"number"==typeof i?t.code=i:"string"==typeof i?t.name=i:void 0!==i&&(i.originalError&&(t.originalError=i.originalError),void 0!==i.code&&(t.code=i.code),void 0!==i.serverCode&&(t.serverCode=i.serverCode)),t}ka(e,t);var r=la(e);return e}(Re(Error)),Da=function(t){function e(t,i){return W(this,e),m(n(t=r.call(this,rm(t,i))),"name","RtmInternalError"),m(n(t),"code",void 0),t.code=i,t}ka(e,t);var r=la(e);return e}(Re(Error)),zh=function(){return function(t){function e(t){W(this,e);var r=Object.keys(t);return n.call(this,t[r[0]],r[0])}ka(e,t);var n=la(e);return e}(Da)},Ca=zh(),bb=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),t}ka(e,t);var r=la(e);return e}(sc),L=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),t}ka(e,t);var r=la(e);return e}(sc),H=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),t}ka(e,t);var r=la(e);return e}(sc),Qk=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),t}ka(e,t);var r=la(e);return e}(sc),gb=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),t}ka(e,t);var r=la(e);return e}(sc),LB=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),t}ka(e,t);var r=la(e);return e}(sc),ca=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(t),"serverCode",void 0),m(n(t),"statusCode",void 0),t}ka(e,t);var r=la(e);return e}(sc),Ke=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(t),"serverCode",void 0),t}ka(e,t);var r=la(e);return e}(sc),Pc=function(t){function e(){W(this,e);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return m(n(t=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),t}ka(e,t);var r=la(e);return e}(sc),Na=function(t){return t instanceof bb||t instanceof pb},wa=function(t){return t instanceof sc},Md=function(t,e,n){return['Executing "%s.%s" timed out after %ds',t,e,n/1e3]},qm=new Map,MB=function(){var t=new Date;return"".concat(t.toISOString().split("T")[1].replace(/\..+/,""),".").concat(t.getMilliseconds())},Rk=Object.keys,dr=Object.entries.bind(Object),mg=function(t){return"string"==typeof t?t.endsWith(".")?t:"".concat(t,"."):t},xm=function(t){for(var e="",n=(t=new Uint8Array(t)).byteLength,r=-1;++r<n;)e+=String.fromCharCode(t[r]);return e=btoa(e),"data:;base64,".concat(e)},NB=O((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));N({target:"Date",proto:!0,forced:NB},{toJSON:function(t){t=Wa(this);var e=hc(t);return"number"!=typeof e||isFinite(e)?t.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var vt=Object.prototype.hasOwnProperty,er=function(t,e,n){return JSON.stringify(Cm(t),e,n)};er.ensureProperties=Cm;var OB=function(t,e){e=e||{};var n=R(t);if("string"===n&&0<t.length)return wt(t);if("number"===n&&isFinite(t))return t=e.long?864e5<=(e=Math.abs(t))?tg(t,e,864e5,"day"):36e5<=e?tg(t,e,36e5,"hour"):6e4<=e?tg(t,e,6e4,"minute"):1e3<=e?tg(t,e,1e3,"second"):t+" ms":864e5<=(e=Math.abs(t))?Math.round(t/864e5)+"d":36e5<=e?Math.round(t/36e5)+"h":6e4<=e?Math.round(t/6e4)+"m":1e3<=e?Math.round(t/1e3)+"s":t+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))},PB=function(t){function e(t){function r(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];if(r.enabled){t=Number(new Date),r.diff=t-(i||t),r.prev=i,i=r.curr=t,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(t,i){return"%%"===t?"%":(a++,"function"==typeof(i=e.formatters[i])&&(t=i.call(r,n[a]),n.splice(a,1),a--),t)})),e.formatArgs.call(r,n),(r.log||e.log).apply(r,n)}}var i,o=null;return r.namespace=t,r.useColors=e.useColors(),r.color=e.selectColor(t),r.extend=n,r.destroy=e.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?e.enabled(t):o},set:function(t){o=t}}),"function"==typeof e.init&&e.init(r),r}function n(t,n){return(t=e(this.namespace+(void 0===n?":":n)+t)).log=this.log,t}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){var t=[].concat(I(e.names.map(r)),I(e.skips.map(r).map((function(t){return"-"+t})))).join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.names=[],e.skips=[];var n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r=0;for(n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=OB,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((function(n){e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e},fr=Xa((function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)}},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){try{var t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var n=localStorage;break t}catch(t){}n=void 0}e.storage=n,e.destroy=function(){var t=!1;return function(){t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),e.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),e.log=console.debug||console.log||function(){},t.exports=PB(e),t.exports.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})),gr=fr("RTM:DEBUG"),Le;gr.enabled=!1,function(t){t[t.Uploading=0]="Uploading",t[t.Free=1]="Free"}(Le||(Le={}));var QB=function(){function t(e){W(this,t),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),this.processId=e.processId,this.sdkVersion=e.sdkVersion,this.uploadRequest=e.uploadRequest,this.uploadState=Le.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ea(t,[{key:"upload",value:function(t,e){this.LogCache.push(t),this.uploadState===Le.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost,e))}},{key:"postLog",value:function(t,e){var n=this;this.uploadState=Le.Uploading,setTimeout(K(w.mark((function r(){var i,o;return w.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i={sdk_version:n.sdkVersion,process_id:n.processId,payload:JSON.stringify(t)},r.prev=1,r.next=4,n.uploadRequest(i,e);case 4:r.next=11;break;case 6:return r.prev=6,r.t0=r.catch(1),o=2>n.uploadResendCount++?2e3:1e4,setTimeout((function(){return n.postLog(n.LogsToPost,e)}),o),r.abrupt("return");case 11:if(gr('The logs uploaded for "process-'.concat(Sf,'"')),0!==n.LogCache.length){r.next=15;break}return n.uploadState=Le.Free,r.abrupt("return");case 15:n.uploadResendCount=0,n.LogsToPost=40>n.LogCache.length?n.LogCache.splice(0,n.LogCache.length):n.LogCache.splice(0,40),n.postLog(n.LogsToPost,e);case 18:case"end":return r.stop()}}),r,null,[[1,6]])}))),Nd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),t}(),hr=function(){var t=K(w.mark((function t(e,n){var r,i,o,a=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(2<(r=2<a.length&&void 0!==a[2]?a[2]:0))){t.next=3;break}return t.abrupt("return");case 3:return i={withCredentials:!0,body:e,timeout:2e4},o="https://".concat(0<r?(null==n?void 0:n.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agoraio.cn":(null==n?void 0:n.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io","/upload/v1"),t.next=7,gf(o,i).catch((function(t){return hr(e,n,r+1)}));case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),RB=new QB({processId:"process-".concat(Sf),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.2-0-gcddbca54"),uploadRequest:hr}),ir="text payload rawMessage thumbnail token detail ticket attributeInfos".split(" "),jr=function(t){return"object"===R(t)?md(t)?qg(t,ir):t.constructor&&t.constructor.name:t},kr=function(t,e){return t instanceof Error?t.message:"string"!=typeof t?JSON.stringify(qg(t,ir)):(e=e.map((function(t){return t instanceof Error?t.message:"object"===R(t)?er(Array.isArray(t)?t.map(jr):jr(t)):t})),sm.apply(void 0,[t.replace(/%[%Oo]/g,(function(t){return"%%"===t?"%":"%o"===t||"%O"===t?"%s":t}))].concat(I(e))))},SB=1,lr=function(t,e,n){var r=fr(t);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(e.enableLogUpload){i=mg(n);var s=kr(i,o);RB.upload({log_item_id:"".concat(SB++),log_level:t,payload_str:"[".concat(MB(),"] ").concat(t," - ").concat(256<s.length?s.slice(0,256):s)},e._areaConfig)}switch(i=function(t){var e=s||kr(mg(n),o),i=dd.LOG_HANDLER;"function"==typeof i&&i({level:t,message:e}),r(e)},t){case"RTM:INFO":e.logFilter.info&&i("log");break;case"RTM:WARN":e.logFilter.warn&&i("warning");break;case"RTM:ERROR":e.logFilter.error&&i("error");break;case"RTM:TRACK":e.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":e.logFilter.debug&&i("debug");break;case"RTM:DEBUG":e.logFilter.debug&&i("debug")}}},Sk,mr=function(t){return function(e){var n=1===Sk||void 0===t?"":"Ins#".concat(t," ");return"".concat(n).concat(e)}},Tk=function(t,e,n){var r=mr(Sk);return lr("RTM:".concat(e),n,(function(e){return t(r(e))}))},vb=function(){return function(t){function e(t,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,e);var a=r.call(this);if(m(n(a),"logError",void 0),m(n(a),"invokeTracker",void 0),m(n(a),"resultTracker",void 0),m(n(a),"errorTracker",void 0),m(n(a),"eventTracker",void 0),m(n(a),"info",void 0),m(n(a),"warn",void 0),m(n(a),"log",void 0),m(n(a),"genLogger",void 0),m(n(a),"loggerId",void 0),m(n(a),"logger",void 0),m(n(a),"name",void 0),a.logger=t,a.name=i,a.loggerId=t.loggerId,a.info=t.info,a.warn=t.warn,a.logError=t.logError,a.genLogger=t.genLogger,a.log=t.genLogger("RTM:DEBUG","<".concat(i,"> ")),a.invokeTracker=t.genTracker("Invoke"),a.eventTracker=t.genTracker("Event"),a.resultTracker=t.genTracker("Result"),a.errorTracker=t.genTracker("Error"),o){var s=a.emit.bind(n(a));a.emit=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];t=e[0],n=e.slice(1),a.eventTracker.apply(a,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,t].concat(I(n)));try{s.apply(void 0,e)}catch(e){a.logError("Caught in the callback function of the event %s",t,e)}}}return a}ka(e,t);var r=la(e);return e}(aa)},TB=function(t){return Tk(console.log.bind(console),"INFO",t)},UB=function(t){return Tk(console.warn.bind(console),"WARN",t)},VB=function(t){return Tk(console.error.bind(console),"ERROR",t)},nr=function(t,e){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=mr(t),o=console.debug.bind(console),a=lr(n,e,(function(t){return o(i(t))}));return function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return a.apply(void 0,[r+t].concat(n))}}},WB=function(t,e){return function(n){return nr(t,e)("RTM:TRACK","[".concat(n,"] "))}},yi=t.URI,yt=yh,XB=Se(oB,["Wrapper"]),Dm=rg(XB,"URI"),YB=Math.floor,ZB=Math.random,or=function(t,e){var n=-1,r=t.length,i=r-1;for(e=void 0===e?r:e;++n<e;){r=n;var o=i;o=t[r+=YB(ZB()*(o-r+1))],t[r]=t[n],t[n]=o}return t.length=e,t},$B=function(t){return or(Ih(t))},Em=function(t,e){return Ud(e,(function(e){return t[e]}))},aC=function(t){return or(null==t?[]:Em(t,Rc(t)))},Ah=function(t){return(Ya(t)?$B:aC)(t)},Me={0:9591,1:9593},Ne=function(t){return"https://".concat(t,"/api/v1")},bC=mb.apply(void 0,I(Ah(["ap-web-1.agoraio.cn","ap-web-2.agoraio.cn"].map(Ne)))),cC=mb.apply(void 0,I(Ah(["ap-web-1.agora.io","ap-web-2.agora.io"].map(Ne)))),dC=mb.apply(void 0,I(Ah(["ap-web-3.agoraio.cn","ap-web-4.agoraio.cn"].map(Ne)))),eC=mb.apply(void 0,I(Ah(["ap-web-3.agora.io","ap-web-4.agora.io"].map(Ne)))),Uk=zh(),Vk=function(t){function e(t,i,o,a,s,c){W(this,e);var u=r.call(this,s,pm("Socket-",s.loggerId));if(m(n(u),"isActiveClose",!1),m(n(u),"loggedIn",!1),m(n(u),"useCnDomain",void 0),m(n(u),"receivedPacket",new La),m(n(u),"open$",void 0),m(n(u),"input$",new La),m(n(u),"userJoin$",new La),m(n(u),"attemptsSinceLastError",0),m(n(u),"message$",new La),m(n(u),"socket$",void 0),m(n(u),"toClose",new La),m(n(u),"toReconnect",new La),m(n(u),"sendLogger",void 0),m(n(u),"receiveLogger",void 0),m(n(u),"ip",void 0),m(n(u),"env",void 0),m(n(u),"ticket",void 0),m(n(u),"context",void 0),m(n(u),"getDomain",(function(){var t=u.useCnDomain?"agoraio.cn":"agora.io";return"".concat(u.ip.split(".").join("-"),".edge.").concat(t)})),m(n(u),"socketReconnector",(function(t){var e=function(t){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,t.message),uc(1500)};return t.pipe(Ga((function(t){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),ba(t)):u.isActiveClose?dc:(u.emit("reconnect"),u.useCnDomain=!u.useCnDomain,ba(t))})),ae((function(t){return t.pipe(vc(e))})))})),u.ip=t,u.env=i,u.ticket=o,u.context=a,u.useCnDomain="CN"===u.context.area,u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new Uk({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!pt(t))throw new Uk({IP_NOT_VALID:"The ip from ap is not valid"});void 0!==c&&(u.useCnDomain=c);var l=Me[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env);var d=Tb(u.input$,u.userJoin$.pipe(lt(2)),u.message$).pipe(Z((function(t){return yh.encode(t).finish()})));return t=Tb(mt("",{protocols:[],makeWebSocket:function(){var t=new WebSocket("wss://".concat(u.getDomain(),":").concat(l));return t.binaryType="arraybuffer",t}}),u.toReconnect),u.socket$=ya(t,Ck.pipe(Za(5e3),Ga((function(t){return Na(t)&&u.warn("socket open timed out"),ba(t)})))).pipe(Z((function(t){if(t instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),t;return t(d).pipe(Z((function(t){return yh.decode(new Uint8Array(t))})))})),u.socketReconnector),u.open$=u.socket$.pipe(Y((function(t){u.log("Websocket opened",u.name),t.subscribe((function(t){var e=t.data;t=yi[t.uri].slice(0,-3),e=Dm[t].decode(e);var n=fA({},rg(e,"toJSON"),(function(t,e){return e instanceof U?om(e):e})),r=!1;if((e instanceof Tq||e instanceof Sq)&&e.instance.lessThanOrEqual(4294967295)&&(r=!0),e instanceof Uq||e instanceof Vq){var i=e.instance,o=e.sequence;(e.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,t,n):("Pong"!==t&&u.receiveLogger("Env_%d: %s %o",u.env,t,n),u.receivedPacket.next([t,e]))}),(function(){}))})),bf(void 0),ob(u.toClose),be()),u}ka(e,t);var r=la(e);return Ea(e,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Me[this.env])}},{key:"sendPacket",value:function(t,e){if("Ping"!==t){var n=oc(e,(function(t){return t instanceof U?om(t):t}));this.sendLogger("Env_%d: %s %o",this.env,t,n)}e=xt(t,e),"UserJoin"===t?this.userJoin$.next(e):"Message"===t?this.message$.next(e):this.input$.next(e)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(t){var e=this;return this.receivedPacket.pipe(Y((function(t){var n=pa(t,2);t=n[0],n=n[1],"UserResp"===t&&(e.attemptsSinceLastError=0,e.loggedIn=!0),"UserDrop"===t&&e.emit("socketUserDrop",n)})),nb((function(e){return pa(e,1)[0]===t})),Z((function(t){return pa(t,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Uk({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),e}(vb()),Oa;N({target:"String",proto:!0,forced:Xq},{padStart:function(t){return rB(this,t,1<arguments.length?arguments[1]:void 0)}}),function(t){t.CN="CN",t.NA="NA",t.EU="EU",t.AS="AS",t.JP="JP",t.IN="IN",t.GLOBAL="GLOBAL",t.OC="OC",t.SA="SA",t.AF="AF",t.OVS="OVS"}(Oa||(Oa={}));var Yf=Ja({AS:{CODE:Oa.AS,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"]},NA:{CODE:Oa.NA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"]},EU:{CODE:Oa.EU,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"]},JP:{CODE:Oa.JP,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"]},IN:{CODE:Oa.IN,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"]},OVS:{CODE:Oa.OVS,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"]},GLOB:{CODE:Oa.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"]},OC:{CODE:Oa.OC,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"]},SA:{CODE:Oa.SA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"]},AF:{CODE:Oa.AF,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"]}},{CN:{CODE:Oa.CN,AP_DOMAINS:["ap-web-1.agoraio.cn","ap-web-2.agoraio.cn"],AP_BACKUP_DOMAINS:["ap-web-3.agoraio.cn","ap-web-4.agoraio.cn"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agoraio.cn"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-4.agoraio.cn"],LOG_UPLOAD_SERVER:["logservice-rtm.agoraio.cn"]}});Yf=zm(Yf);var fC=function(t){var e=new Set;if(0===(t=t.map((function(t){var n=Yf[t];if(void 0===n)throw new Da("invalid area key");return t=n.CODE,n=Se(n,["CODE"]),e.add(t),n}))).length)throw new Da("areas cannot be empty");return Ja({CODES:e},t.reduce((function(t,e){for(var n=0,r=dr(t);n<r.length;n++){var i=pa(r[n],2),o=i[0];i=i[1],t[o]=Array.from(new Set([].concat(I(e[o]),I(i))))}return t})))},gC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},pr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},hC=[100,101,102],qr=function(t){function e(t,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,e);var a=r.call(this,i,"AccessPoint");m(n(a),"getApEdgeInfo$",void 0),m(n(a),"getApEdgeInfoEndFirst$",void 0),m(n(a),"apFinish$",new La),m(n(a),"usedUrl",[]),m(n(a),"failedAreas",new Set),m(n(a),"cnDomainUsed",!1),m(n(a),"backupCnDomainUsed",!1),m(n(a),"genUrl",(function(){return void 0===a.context.areaConfig?Zh(bC,cC).pipe($h((function(t){return mb.apply(void 0,I(t))}))):mb.apply(void 0,I(a.context.areaConfig.AP_DOMAINS.map(Ne)))})),m(n(a),"genBackupUrl",(function(){return void 0===a.context.areaConfig?Zh(dC,eC).pipe($h((function(t){return mb.apply(void 0,I(t))}))):mb.apply(void 0,I(a.context.areaConfig.AP_BACKUP_DOMAINS.map(Ne)))})),m(n(a),"getUrl$",(function(t){return a.genUrl().pipe(nb((function(t){return!(a.cnDomainUsed&&t.includes("agoraio.cn")||(t.includes("agoraio.cn")&&(a.cnDomainUsed=!0),Mk(a.usedUrl,(function(e){return t[15]===e}))))})),Y((function(t){void 0===a.context.areaConfig&&a.usedUrl.push(t[15])})),Pa(t?dd.RECONNECTING_AP_NUM:2),rd((function(){return e.runOutOfUrlSymbol})),Ga((function(t,n){return a.cnDomainUsed=!1,t===e.runOutOfUrlSymbol?(a.usedUrl=[],n):ba(t)})))})),m(n(a),"getBackupUrl$",(function(t){return a.genBackupUrl().pipe(nb((function(t){return!(a.backupCnDomainUsed&&t.includes("agoraio.cn")||(t.includes("agoraio.cn")&&(a.backupCnDomainUsed=!0),Mk(a.usedUrl,(function(e){return t[15]===e}))))})),Y((function(t){void 0===a.context.areaConfig&&a.usedUrl.push(t[15])})),Pa(t?dd.RECONNECTING_AP_NUM:2),rd((function(){return e.runOutOfUrlSymbol})),Ga((function(t,n){return a.backupCnDomainUsed=!1,t===e.runOutOfUrlSymbol?(a.usedUrl=[],n):ba(t)})))})),m(n(a),"context",void 0),m(n(a),"fetchAp",(function(t,e){var n=pm("AP-",a.loggerId);a.log("The AccessPoint requests %s(%s)",t,n);var r=new AbortController;return a.apFinish$.pipe(Pa(1)).subscribe((function(){return r.abort()})),qd(K(w.mark((function i(){var o;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=mi(0,Number.MAX_SAFE_INTEGER),a.log("The %s request uid param is %d",n,o),i.abrupt("return",gf(t,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:1,key:e||a.context.key,cname:a.context.uid,detail:Ja({},void 0===a.context.areaConfig?{11:"GLOBAL"}:{11:I(a.context.areaConfig.CODES).join(",")}),uid:o,sid:a.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(e){return"AbortError"!==e.name&&(a.logError(e),a.warn("The AP server %s request failure",t)),dc})),eb(function(){var e=K(w.mark((function e(r){var i,o,s,c,u,l,d,h,f,p,v,m,g,A,y,b,E,_,S,T,C,x,R;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.responseText,o=JSON.parse(i),a.log("The %s response is %o",n,o),c=(s=o).code,u=s.addresses,l=s.detail,0===c){e.next=51;break}if(d=c,!(4<c.toString().length)){e.next=16;break}if(h=c.toString().padStart(8,"0"),f=parseInt(h.slice(0,4),10),p=parseInt(h.slice(4,8),10),201!==f){e.next=14;break}d=p,e.next=16;break;case 14:if(101!==f||hC.includes(p)){e.next=16;break}return e.abrupt("return",ba(Error("service is currently unavailable")));case 16:if(v=d.toString(),Object.keys(pr).includes(v)){e.next=22;break}return(m=new ca(["Login is rejected by the server. The response code is %d",c],sh)).serverCode=d,e.abrupt("return",ba(m));case 22:g=pr[v],A=gC[g],e.t0=g,e.next="INVALID_APP_ID"===e.t0||"APP_ID_NO_ACTIVATED"===e.t0?27:"INVALID_USER_ID"===e.t0?30:"TOKEN_EXPIRED"===e.t0||"TOKEN_TIMEOUT"===e.t0?33:"NO_AUTHORIZED"===e.t0||"INVALID_TOKEN_UID"===e.t0||"DYNAMIC_KEY_NOT_ENABLED"===e.t0||"DYNAMIC_ENABLED_BUT_STATIC_KEY"===e.t0?36:"CANNOT_MEET_AREA_DEMAND"===e.t0?39:"FORBIDDEN_REGION"===e.t0?47:50;break;case 27:return(y=new Ke(A,zq)).serverCode=c,e.abrupt("return",ba(y));case 30:return(b=new Ke(A,th)).serverCode=c,e.abrupt("return",ba(b));case 33:return(E=new Ke(A,uh)).serverCode=c,e.abrupt("return",ba(E));case 36:return(_=new Ke(A,Aq)).serverCode=c,e.abrupt("return",ba(_));case 39:t:{var w=t,O=Rk(Yf);w=tt(w);for(var M=0;M<O.length;M++){var k=Yf[O[M]];if(null!=k&&k.AP_DOMAINS.includes(w)||null!=k&&k.AP_BACKUP_DOMAINS.includes(w)){S=k.CODE===Oa.OVS?"".concat(Oa.AS,",").concat(Oa.EU,",").concat(Oa.AF,",").concat(Oa.NA,",").concat(Oa.SA,",").concat(Oa.OC):k.CODE;break t}}S="GLOBAL,CN"}if(a.failedAreas.add(S),T=void 0===a.context.areaConfig?2:a.context.areaConfig.CODES.size,a.failedAreas.size!==T){e.next=46;break}return(C=new L(A,sh)).serverCode=c,e.abrupt("return",ba(C));case 46:return e.abrupt("break",51);case 47:return(x=new ca(A,sh)).serverCode=c,e.abrupt("return",ba(x));case 50:return e.abrupt("return",ba(mm("ApResErrType",g)));case 51:return R=u,a.context.area=null==l?void 0:l[9],e.abrupt("return",mb.apply(void 0,I(R).concat([oh])));case 56:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wh(),nb((function(t){return void 0!==t&&"string"==typeof t.ip&&"string"==typeof t.ticket})))})),a.context=t;var s=0;return a.getApEdgeInfoEndFirst$=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return uc(0,t||o?dd.RECONNECTING_AP_INTERVAL:2e3).pipe(Pa(1),Y((function(){s+=1})),eb((function(){return 2>=s?a.getUrl$(t||o):a.getBackupUrl$(t||o)})),eb((function(t){return a.fetchAp(t)})),Za(1e4),Ga((function(t){return t instanceof pb&&a.warn("AP request timeout"),ba(t)})),Ul((function(t){return t.ip})),hg((function(){s=0,a.failedAreas.clear()})),ob(a.apFinish$))},a.getApEdgeInfo$=function(t){return uc(0,t||o?dd.RECONNECTING_AP_INTERVAL:2e3).pipe(Pa(4),Y((function(){s+=1})),eb((function(){return 2>=s?a.getUrl$(t||o):a.getBackupUrl$(t||o)})),eb((function(t){return a.fetchAp(t)})),Za(1e4),Ga((function(t){return t instanceof pb&&a.warn("AP request timeout"),ba(t)})),Ul((function(t){return t.ip})),hg((function(){s=0,a.failedAreas.clear()})),ob(a.apFinish$))},a}ka(e,t);var r=la(e);return e}(vb());m(qr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var rr=zh(),sr=function(t){function e(t,i,o){W(this,e);var a=r.call(this,i,"Connection");m(n(a),"apClient",void 0),m(n(a),"lastOpenSockets",[new ce(1),new ce(1)]),m(n(a),"curOpenSockets",[void 0,void 0]),m(n(a),"ipIterator",0),m(n(a),"firstEnv",.5<=Math.random()?1:0),m(n(a),"firstSocketOpener",void 0),m(n(a),"secondSocketOpener",void 0),m(n(a),"firstOpenKeeperSubject",new La),m(n(a),"secondOpenKeeperSubject",new La),m(n(a),"edgeInfoReplayed",void 0),m(n(a),"firstEnvOpenSocket",void 0),m(n(a),"firstOpenKeeperSub",void 0),m(n(a),"secondOpenKeeperSub",void 0),m(n(a),"context",void 0),m(n(a),"logger",void 0),a.context=t,a.logger=i,a.apClient=new qr(a.context,i),a.apClient.apFinish$.subscribe((function(){a.log("Ap client fetch finished")}));var s,c=[];return a.edgeInfoReplayed=a.apClient.getApEdgeInfo$(o).pipe(nb((function(t){return void 0!==t&&"string"==typeof t.ip&&"string"==typeof t.ticket})),rd((function(){return new rr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ae((function(t){return t.pipe(Y((function(t){if(wa(t))throw t})),Wc(o?Nd.getParameter("RECONNECTING_AP_INTERVAL"):750),ob(uc(7e3)))})),nb((function(t){return!Mk(c,t)})),Y((function(t){c.push(t),a.log("An edge info got %o",t)})),Y({error:function(t){a.emit("connectionInitFailure",t)}}),Yl()),a.firstEnvOpenSocket=a.edgeInfoReplayed.pipe(eb((function(t){if(void 0===t)return ba(Error("Invalid edge info"));var e=new Vk(t.ip,a.firstEnv,t.ticket,a.context,i,s);return a.firstEnv=1===a.firstEnv?0:1,e.on("connectionFailure",(function(){return a.onSocketConnectionFailure(e)})),s=!e.useCnDomain,e.open$.pipe(bf(e))})),Y((function(t){a.log("The websocket of ENV_%d opened to %s:%d",t.env,t.ip,Me[t.env]),a.curOpenSockets[t.env]=t,a.lastOpenSockets[t.env].next(t),a.firstEnv=t.env,a.openSecondSocket(t.env,t.ip,t.useCnDomain)})),Pa(1),be()),a.firstSocketOpener=a.firstEnvOpenSocket.pipe(eb((function(t){return t.open$.pipe(Y((function(){a.log("The websocket of first ENV_%d re-opened to %s:%d",t.env,t.ip,Me[t.env]),a.curOpenSockets[t.env]=t,a.lastOpenSockets[t.env].next(t)})))}))),t=a.firstOpenKeeperSubject.pipe(vc(Sc)),a.firstOpenKeeperSub=t.subscribe({error:a.logError}),a}ka(e,t);var r=la(e);return Ea(e,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(t,e){if(![0,1].includes(t))throw new Ca({INVALID_ENV:"The env argument is not 0 or 1"});var n=t===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[t];this.curOpenSockets[t]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),e)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),e)}},{key:"waitClosing",value:function(t){var e=this;return t.isActiveClose=!0,t.open$.pipe(Os(),Ga((function(t){return t.message===Mq.normalClosureMessage?dc:ba(t)})),Za(5e3),Ga((function(n){return n instanceof pb?(e.warn("Force closing the ENV_%d connection",t.env),dc):ba(n)})))}},{key:"onSocketConnectionFailure",value:function(t){var e=[0,1].filter((function(e){return e!==t.env}))[0];(e=this.curOpenSockets[e])&&e.loggedIn?this.reopenSocketWithApRequest(t.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(t,e,n){var r=this,i=1===t?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(Xl((function(t,e){return[].concat(I(t),[e])}),[]),Z((function(t){return Kq(t,(function(t){return nm(e,t.ip)})).slice(-1)[0]})),Pa(1),eb((function(t){if(void 0===t)return ba(Error("Invalid edge info"));var e=new Vk(t.ip,i,t.ticket,r.context,r.logger,n);return e.on("connectionFailure",(function(){return r.onSocketConnectionFailure(e)})),e.open$.pipe(Y((function(){r.lastOpenSockets[i].next(e),r.curOpenSockets[i]=e})))})),be()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(vc(Sc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(t){var e=this,n=[0,1].filter((function(e){return e!==t}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(nb((function(t){return void 0!==t&&"string"==typeof t.ip&&"string"==typeof t.ticket})),rd((function(){return new rr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ae((function(t){return t.pipe(Y((function(t){if(t.code===uh)e.emit("tokenExpired"),e.apClient.apFinish$.next(void 0);else if(wa(t))throw t})),Wc(Nd.getParameter("RECONNECTING_AP_INTERVAL")),ob(uc(7e3)))})),Y((function(t){e.log("An edge info got %o",t)}))).pipe(Xl((function(t,e){return[].concat(I(t),[e])}),[]),Z((function(t){return(t=Kq(t,(function(t){return nm(i,t.ip)}))).length-1>=e.ipIterator?t.slice(-e.ipIterator++-1)[0]:(e.ipIterator=0,t.slice(-1)[0])})),rd(),eb((function(n){if(void 0===n)return ba(Error("Invalid edge info"));var i=new Vk(n.ip,t,n.ticket,e.context,e.logger,r);return i.on("connectionFailure",(function(){return e.onSocketConnectionFailure(i)})),r=!i.useCnDomain,i.open$.pipe(bf(i))})),Y((function(n){e.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,Me[n.env]),e.curOpenSockets[t]=n,e.lastOpenSockets[t].next(n)})),eb((function(n){return n.open$.pipe(Y((function(){e.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,Me[n.env]),e.curOpenSockets[t]=n,e.lastOpenSockets[t].next(n)})))})),be()),t===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),e}(vb()),Qc=bc.Writer,ma=bc.util,tc=bc.roots.default||(bc.roots.default={}),iC=tc.Session=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.appId="",t.prototype.ver="",t.prototype.buildno=0,t.prototype.installId="",t.prototype.os=0,t.prototype.did="",t.prototype.index=null,t.prototype.token="",t.prototype.version=0,t.prototype.subVersion=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.appId&&Object.hasOwnProperty.call(t,"appId")&&e.uint32(42).string(t.appId),null!=t.ver&&Object.hasOwnProperty.call(t,"ver")&&e.uint32(50).string(t.ver),null!=t.buildno&&Object.hasOwnProperty.call(t,"buildno")&&e.uint32(56).int32(t.buildno),null!=t.installId&&Object.hasOwnProperty.call(t,"installId")&&e.uint32(66).string(t.installId),null!=t.os&&Object.hasOwnProperty.call(t,"os")&&e.uint32(128).int32(t.os),null!=t.did&&Object.hasOwnProperty.call(t,"did")&&e.uint32(138).string(t.did),null!=t.index&&Object.hasOwnProperty.call(t,"index")&&tc.Session.CommonIndex.encode(t.index,e.uint32(162).fork()).ldelim(),null!=t.token&&Object.hasOwnProperty.call(t,"token")&&e.uint32(170).string(t.token),null!=t.version&&Object.hasOwnProperty.call(t,"version")&&e.uint32(176).int32(t.version),null!=t.subVersion&&Object.hasOwnProperty.call(t,"subVersion")&&e.uint32(184).int32(t.subVersion),e},t.CommonIndex=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.index1="",t.prototype.index2="",t.prototype.index3="",t.encode=function(t,e){return e||(e=Qc.create()),null!=t.index1&&Object.hasOwnProperty.call(t,"index1")&&e.uint32(10).string(t.index1),null!=t.index2&&Object.hasOwnProperty.call(t,"index2")&&e.uint32(18).string(t.index2),null!=t.index3&&Object.hasOwnProperty.call(t,"index3")&&e.uint32(26).string(t.index3),e},t}(),t}(),jC=tc.Link=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.ec=0,t.prototype.sc=0,t.prototype.destServerIp="",t.prototype.ackedServerIp="",t.prototype.responseTime=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.ec&&Object.hasOwnProperty.call(t,"ec")&&e.uint32(40).int32(t.ec),null!=t.sc&&Object.hasOwnProperty.call(t,"sc")&&e.uint32(48).int32(t.sc),null!=t.destServerIp&&Object.hasOwnProperty.call(t,"destServerIp")&&e.uint32(58).string(t.destServerIp),null!=t.ackedServerIp&&Object.hasOwnProperty.call(t,"ackedServerIp")&&e.uint32(66).string(t.ackedServerIp),null!=t.responseTime&&Object.hasOwnProperty.call(t,"responseTime")&&e.uint32(72).int32(t.responseTime),e},t}(),kC=tc.Logout=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),e},t}(),lC=tc.KickedOff=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.linkId=0,t.prototype.code=0,t.prototype.server="",t.prototype.serverCode=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.linkId&&Object.hasOwnProperty.call(t,"linkId")&&e.uint32(48).int32(t.linkId),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(56).int32(t.code),null!=t.server&&Object.hasOwnProperty.call(t,"server")&&e.uint32(66).string(t.server),null!=t.serverCode&&Object.hasOwnProperty.call(t,"serverCode")&&e.uint32(72).int32(t.serverCode),e},t}(),mC=tc.ChnJoin=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),e},t}(),nC=tc.ChnJoinRes=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.prototype.serverErrCode=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),null!=t.serverErrCode&&Object.hasOwnProperty.call(t,"serverErrCode")&&e.uint32(64).int32(t.serverErrCode),e},t}(),oC=tc.ChnLeave=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),e},t}(),pC=tc.ConnectionStateChange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.elapse=ma.Long?ma.Long.fromBits(0,0,!1):0,t.prototype.oldState=0,t.prototype.newState=0,t.prototype.reason=0,t.prototype.reconnId=0,t.encode=function(t,e){return e||(e=Qc.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.oldState&&Object.hasOwnProperty.call(t,"oldState")&&e.uint32(40).int32(t.oldState),null!=t.newState&&Object.hasOwnProperty.call(t,"newState")&&e.uint32(48).int32(t.newState),null!=t.reason&&Object.hasOwnProperty.call(t,"reason")&&e.uint32(56).int32(t.reason),null!=t.reconnId&&Object.hasOwnProperty.call(t,"reconnId")&&e.uint32(64).int32(t.reconnId),e},t}(),zt=Object.freeze({__proto__:null,Session:iC,Link:jC,Logout:kC,KickedOff:lC,ChnJoin:mC,ChnJoinRes:nC,ChnLeave:oC,ConnectionStateChange:pC,default:tc}),At=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),qC=function(t){function e(t,i){return W(this,e),m(n(i=r.call(this,i,"Context")),"_token",void 0),m(n(i),"areaConfig",void 0),m(n(i),"_uid",void 0),m(n(i),"_sid",void 0),m(n(i),"_area",void 0),m(n(i),"appId",void 0),i.appId=t,i}ka(e,t);var r=la(e);return Ea(e,[{key:"token",set:function(t){this._token="string"==typeof t&&t?t:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Da("Cannot get illegal uid")},set:function(t){if(this.log("The user ID is set to %s",t),!ua(t))throw new Da;this._uid=t}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Da("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Da("Cannot get illegal sid")},set:function(t){if(this.log("sid is set to %s",t),"string"!=typeof t||!t)throw new Da;this._sid=t}},{key:"area",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Da("Cannot get illegal area")},set:function(t){this.log("area is set to %s",t),"string"==typeof t&&t?this._area=t:this.warn("set area failed")}},{key:"setAreaConfig",value:function(t){if(0===t.CODES.size)throw new Da("Cannot set illegal areas");this.log("areas set to %s",I(t.CODES).join(", ")),this.areaConfig=t}}]),e}(vb()),rC=!!wc&&O((function(){wc.prototype.finally.call({then:function(){}},(function(){}))}));N({target:"Promise",proto:!0,real:!0,forced:rC},{finally:function(t){var e=Yc(this,Wb("Promise")),n="function"==typeof t;return this.then(n?function(n){return Hg(e,t()).then((function(){return n}))}:t,n?function(n){return Hg(e,t()).then((function(){throw n}))}:t)}}),"function"!=typeof wc||wc.prototype.finally||Va(wc.prototype,"finally",Wb("Promise").prototype.finally);var sC=function(){var t=K(w.mark((function t(e){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,crypto.subtle.digest("SHA-256",e);case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),tr=function(t){return Array.from(t).map((function(t){return t.toString(16).padStart(2,"0")})).join("")},tC=function(t){if("string"!=typeof t)throw new TypeError("Expected input to be a string");if(0!=t.length%2)throw new RangeError("Expected string to be an even number of characters");for(var e=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substring(n,n+2),16);return e},ur=function(t){return btoa(String.fromCharCode.apply(String,I(t))).replace(/={1,2}$/,"")},vr=function(){var t=K(w.mark((function t(e){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,crypto.subtle.digest("SHA-1",e);case 3:n=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),n=sha1.arrayBuffer(e);case 9:return t.abrupt("return",ur(new Uint8Array(n)));case 10:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}(),wr=function(t,e,n,r){r[e]=!0,n.has(t)?n.get(t).add(e):n.set(t,new Set([e]))},uC=function(t){switch(t){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},xr=function(t){function e(t,i,o,a){W(this,e);var s=r.call(this,o,"ChunkDownloadManager");if(m(n(s),"abortController",new AbortController),m(n(s),"downloadedSize",0),m(n(s),"successCount",0),m(n(s),"timer",void 0),m(n(s),"chunks",[]),m(n(s),"retUnit",void 0),m(n(s),"singleThread",!1),m(n(s),"initialized",!1),m(n(s),"ee",void 0),m(n(s),"chunkCount",void 0),m(n(s),"aborted",!1),m(n(s),"serverToIndices",new Map),m(n(s),"backupToIndices",new Map),m(n(s),"indexToBackupServers",[]),m(n(s),"busyBackupServers",new Map),m(n(s),"downloadingChunks",new Set),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=t,s.transHandler=i,s.ee=void 0===a?new aa:a,o=t.size,t=t.unit,0===o)throw new Da("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s.chunkCount=Math.ceil(o/(32768*t)),s}ka(e,t);var r=la(e);return Ea(e,[{key:"setInfoByResponse",value:function(t){var e=this,n=t.serverList,r=t.backupList;if(t=t.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Da("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach((function(t,n){return t.forEach((function(t){return wr(t,n,e.serverToIndices,i)}))})),r.forEach((function(t,n){return t.forEach((function(t){return wr(t,n,e.backupToIndices,i)}))})),i.some((function(){return!1})))throw new ca("Not enough servers to download",Xf);this.indexToBackupServers=r.map((function(t){return new Set(t)})),this.retUnit=t}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new ca("not enough servers to download",Xf))}},{key:"updateProgress",value:function(t){var e=this,n=this.downloadedSize+t;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Pc("Invalid download size",Xf))):(this.downloadedSize=n,void 0!==this.timer&&0!==t&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout((function(){e.ee.emit("timedOut"),e.abortController.abort()}),12e4)),this.initialized&&0===t||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var t=0,e=0,n=this.chunks;e<n.length;e++)t+=n[e].byteLength;if(t!==this.metaInfo.size)throw new Da("invalid chunks total size");t=new Uint8Array(t),n=e=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];t.set(new Uint8Array(i),e),e+=i.byteLength}return e=Array.from(t.subarray(0,4)).map((function(t){return t.toString(16)})).join("").toUpperCase(),ut(t.buffer,uC(e))}},{key:"getDownloadUrl",value:function(t){var e=this.metaInfo.isAreaCN?"agoraio.cn":"agora.io";return"https://".concat(ng(t).split(".").join("-"),".edge.").concat(e,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var t=K(w.mark((function t(e){var n,r=this,i=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],t.next=3,Promise.all(Array.from(e.entries()).map((function(t){return t=pa(t,2),r.postDownloadRequest(t[0],Array.from(t[1]),n).catch((function(t){404===t.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==t.name&&(Na(t)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",t.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",t),r.abortController.abort()))}))})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var t=K(w.mark((function t(e,n,r){var i,o,a,s,c,u,l,d,h,f=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h=function(){return(h=K(w.mark((function t(o){var a,h,f,p,v,m,g,A,y;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0!==o||0!==e){t.next=5;break}throw new Da("Invalid serverIp");case 5:a=void 0===o?l.getDownloadUrl(e):o;case 6:return l.downloadingChunks.add(i),t.next=9,u(a);case 9:return h=t.sent,f=h.responseData,l.downloadingChunks.delete(i),t.abrupt("return",f);case 15:if(t.prev=15,t.t0=t.catch(0),l.downloadingChunks.delete(i),n.unshift(i),l.metaInfo.isAreaCN=!1,"AbortError"!==t.t0.name){t.next=22;break}throw t.t0;case 22:if(!Na(t.t0)){t.next=25;break}throw t.t0.index=i,t.t0;case 25:if(p=s,s+=1,!(2>p)){t.next=30;break}return t.t0 instanceof Da||l.warn("%o, %d download failed, retrying",t.t0,i),t.abrupt("return",d());case 30:if(504!==t.t0.statusCode){t.next=34;break}throw(v=new bb("download server timed out",{originalError:t.t0,serverCode:504})).index=i,v;case 34:if(!r||2!==p||0===c[0]){t.next=45;break}return t.t0 instanceof Da||l.warn("%d download failed, using backup: %d, %o",i,c[0],t.t0),t.next=38,l.busyBackupServers.get(c[0]);case 38:return m=d(l.getDownloadUrl(c[0])),l.busyBackupServers.set(c[0],m),t.next=42,m;case 42:return g=t.sent,l.busyBackupServers.delete(c[0]),t.abrupt("return",g);case 45:if(!(r&&2<p&&void 0!==c[1]&&0!==c[1])){t.next=56;break}return l.warn("%d download failed, using backup 1: %d",i,c[1]),t.next=49,l.busyBackupServers.get(c[1]);case 49:return A=d(l.getDownloadUrl(c[1])),l.busyBackupServers.set(c[1],A),t.next=53,A;case 53:return y=t.sent,l.busyBackupServers.delete(c[1]),t.abrupt("return",y);case 56:throw t.t0.index=i,t.t0;case 58:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)},d=function(t){return h.apply(this,arguments)},!this.aborted){t.next=4;break}throw new Da("download already aborted");case 4:if(void 0!==(i=n.shift())){t.next=8;break}return this.log("%s download finished",e),t.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){t.next=10;break}return t.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){t.next=13;break}return this.log("%s already downloading, return",i),t.abrupt("return");case 13:if(void 0===this.chunks[i]){t.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),t.next=18,this.postDownloadRequest(e,n,r);case 18:return t.abrupt("return");case 19:return o=new FormData,a={hash:Bt(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},o.append("parameter",JSON.stringify(a)),s=0,c=Array.from(this.indexToBackupServers[i]),u=function(t){return gf(t,{body:o,signal:f.abortController.signal,timeout:f.singleThread?12e4:3e4},{useBinaryResponse:!0})},l=this,t.next=28,d().then((function(t){return void 0!==f.chunks[i]?f.log("chunk %d download duplicated",i):(f.chunks[i]=t,f.log("chunk %d downloaded",i),f.successCount+=1,f.updateProgress(f.chunks[i].byteLength)),f.successCount===f.chunkCount&&(f.log("chunks all download"),f.ee.emit("finished")),f.singleThread?(f.downloadChunks(),Promise.resolve()):f.postDownloadRequest(e,n,r)}));case 28:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),e}(vb()),yr=function(t){function e(t,i,o,a){W(this,e);var s=r.call(this,o,"ChunkUploadManager");if(m(n(s),"chunkCount",0),m(n(s),"chunks",[]),m(n(s),"uploadedChunks",[]),m(n(s),"totalFailures",0),m(n(s),"timer",void 0),m(n(s),"initState","uninitialized"),m(n(s),"ee",void 0),m(n(s),"unit",0),m(n(s),"uploadedSize",0),m(n(s),"singleThread",!1),m(n(s),"abortController",new AbortController),m(n(s),"servers",[]),m(n(s),"aborted",!1),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=t,s.transHandler=i,s.ee=void 0===a?new aa:a,0===t.file.length)throw new L("file not found or is empty",jf);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s}ka(e,t);var r=la(e);return Ea(e,[{key:"initChunks",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){t.next=2;break}throw new Da("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=e,n=this.sliceFile(e,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(t,e){var n=(t=pa(e[t],2))[0],i=t[1];t=vr(i).then((function(t){s.chunks[n]={payload:i,sha1:t,uploadedTo:void 0,index:n,processed:!1}})),r.push(t)},o=0,a=Array.from(n.entries());o<a.length;o++)i(o,a);return t.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var t=this;if(!this.aborted){for(var e=this.chunks.filter((function(t){return!t.processed})),n=function(n){var r=e[n],i=t.servers.filter((function(t){return!t.isUploading})).sort((function(t,e){return t.successCount-e.successCount})).sort((function(t,e){return t.failureCount-e.failureCount}))[0];if(void 0===i||1<i.failureCount)return t.log("Upload server not available, waiting"),t.ee.emit("serverUsedUp"),tm(1e3).then((function(){t.totalFailures>2*t.chunkCount&&t.ee.emit("error"),t.totalFailures+=1,void 0!==i&&(i.failureCount=0),t.uploadToServers()})).catch((function(){})),"break";r.processed=!0,i.isUploading=!0,t.log("uploading chunk %d to server %s",r.index,ng(i.ip));var o=t.getUploadUrl(i.ip);return K(w.mark((function e(){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.postChunk(r.payload,o,r.index);case 3:n=t.chunks.findIndex((function(t){return t===r})),r.uploadedTo=i.ip,t.chunks.splice(n,1),t.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,t.updateProgress(r.payload.byteLength),t.log("upload chunk %d successfully",r.index),e.next=31;break;case 13:if(e.prev=13,e.t0=e.catch(0),i.isUploading=!1,r.processed=!1,504!==e.t0.statusCode&&!Na(e.t0)){e.next=27;break}if(t.singleThread){e.next=24;break}return t.warn("%d upload timed out after %d, retrying use single thread",r.index,t.singleThread?12e4:3e4),t.abortController.abort(),t.singleThread=!0,t.ee.emit("multiTimeOut"),e.abrupt("return");case 24:return t.ee.emit("timedOut"),t.abortController.abort(),e.abrupt("return");case 27:return t.metaInfo.isAreaCN=!1,i.failureCount+=1,e.next=31,tm(1e3);case 31:t.uploadedChunks.length===t.chunkCount?(t.log("chunks uploaded"),t.ee.emit("finished")):(t.singleThread||1===t.chunks.filter((function(t){return!t.processed})).length)&&t.uploadToServers();case 32:case"end":return e.stop()}}),e,null,[[0,13]])})))(),t.singleThread?"break":void 0},r=0;r<e.length&&"break"!==n(r);r++);0===e.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var t=!0,e=[],n=this.uploadedChunks.sort((function(t,e){return t.index-e.index})),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){t=!1;break}e.push(i)}if(!t)throw new Da("some chunks not uploaded, cannot get upload server ips");return e}},{key:"addServers",value:function(t){var e=this;t.forEach((function(t){var n=e.servers.findIndex((function(e){return e.ip===t}));-1!==n?e.servers[n].failureCount=0:(e.log("server %s added",ng(t)),e.servers.push({successCount:0,isUploading:!1,ip:t,failureCount:0}))}))}},{key:"updateProgress",value:function(t){var e=this,n=void 0!==t?this.uploadedSize+t:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Pc("Invalid upload size",Wf))):(this.uploadedSize=n,void 0!==this.timer&&0!==t&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==t&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout((function(){e.ee.emit("timedOut"),e.abortController.abort()}),12e4)),"initialized"===this.initState&&0===t||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(t,e){var n=0,r=[],i=e.length;for(t*=32768;n<i;)r.push(e.slice(n,n+t)),n+=t;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var t=K(w.mark((function t(e,n,r){var i,o,a,s,c,u,l;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.aborted){t.next=2;break}throw new Da("upload already aborted");case 2:if(void 0!==this.unit){t.next=4;break}throw new Da("unit is undefined");case 4:return i=this.metaInfo,o=i.ticket,a=i.instance,s=i.loginOpt,c=i.hashStr,t.t0=r,t.t1=c,t.next=9,vr(e);case 9:return t.t2=t.sent,t.t3=this.unit,t.t4=o,t.t5=a,t.t6=s,u={index:t.t0,hash:t.t1,sha1:t.t2,unit:t.t3,ticket:t.t4,instance:t.t5,loginOpt:t.t6},(l=new FormData).append("parameter",JSON.stringify(u)),l.append("payload",new Blob([e])),t.next=20,gf(n,{headers:{Accept:"application/json"},body:l,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===t.sent.status){t.next=24;break}throw new ca("uploading chunk ".concat(r," failed"));case 24:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(t){var e=this.metaInfo.isAreaCN?"agoraio.cn":"agora.io";return"https://".concat(ng(t).split(".").join("-"),".edge.").concat(e,":9601/api/v1/chuck/upload")}}]),e}(vb()),zr=function(t){function e(t){W(this,e);var i=r.call(this,t,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",(function(t){if(t===S.ConnectionState.ABORTED||t===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),t=0;for(var e=Array.from(i.mediaTasks.entries());t<e.length;t++){var n=pa(e[t],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else t===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():t===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")})),i}ka(e,t);var r=la(e);return Ea(e,[{key:"setAuthInfo",value:function(t){this.authInfo=t}},{key:"waitMediaTask",value:function(t){var e=this;return new Promise((function(n,r){e.taskFinishers[t]={resolve:n,reject:r},e.isProcessing||e.processMediaTask()})).finally((function(){void 0!==e.ongoingTask&&void 0!==e.ongoingTask.manager.timer&&clearTimeout(e.ongoingTask.manager.timer),delete e.taskFinishers[t],0!==e.mediaTasks.size?e.processMediaTask():e.isProcessing=!1}))}},{key:"addUploadTask",value:function(t,n,r,i){var o=t.file;if(t=t.hash,void 0===this.authInfo)throw new Da("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new gb("Upload media failed, exceed max pending jobs",Wz);return i=new yr({hashStr:ur(t),file:o,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),isAreaCN:this.authInfo.isAreaCN},i,this.logger),o=Id(),this.mediaTasks.set(o,{type:"UPLOAD",manager:i,hash:t,setter:r,fetcher:n,taskId:o}),o}},{key:"addDownloadTask",value:function(t,n,r){var i=t.hashHexStr,o=t.size,a=t.unit;if(t=t.zone,void 0===this.authInfo)throw new Da("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new gb("Download media failed, exceed max pending jobs",$z);return r=new xr({hashHexStr:i,ticket:this.authInfo.ticket,isAreaCN:this.authInfo.isAreaCN,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:o,zone:t,unit:a},r,this.logger),i=Id(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=e.manager,r&&(i=new xr(o.metaInfo,o.transHandler,this.logger,o.ee)),a=e.fetcher,t.next=7,a();case 7:if(s=t.sent,c=s.serverList,u=s.backupList,l=s.unit,!r||l===o.retUnit){t.next=13;break}throw new ca("download unit is different, reject to continue",Xf);case 13:r&&(e.manager=i,i.downloadedSize=o.downloadedSize,i.successCount=o.successCount,i.timer=o.timer,i.chunks=o.chunks,i.initialized=o.initialized,i.singleThread=o.singleThread,i.updateProgress(0)),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(e,n,!0).catch((function(t){n.reject(t)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(e,n,!0).catch((function(t){n.reject(t)}))})),i.ee.once("error",(function(t){i.ee.removeAllListeners(),n.reject(new ca(["download file file, index %d",t.index],{code:Xf,originalError:t}))})),i.ee.once("notExist",(function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new ca("download file not found",Zz))})),i.ee.once("timedOut",(function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new bb("download timed out",Yz))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new Qk("Downloading canceled",Iq))}),{once:!0}),i.ee.once("finished",(function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})})),i.setInfoByResponse({serverList:c,backupList:u,unit:l}),i.downloadChunks();case 23:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(t,e){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=t.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=t),new Promise((function(i,o){n.doDownloadTaskImpl(t,e,r).then(i).catch(o)}))}},{key:"doUploadTaskImpl",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=e.manager,r&&(i=new yr(o.metaInfo,o.transHandler,this.logger,o.ee)),a=e.fetcher,s=new La,u=new Promise((function(t,u){var l=a(),d=l.ret,h=l.err,f=l.timeout;l.fin.pipe(ob(s)).subscribe({next:function(t){n.resolve({type:"UPLOAD",retUnit:t.unit,zone:t.zone})},complete:function(){t({hasExist:!0}),s.next(),s.complete()}}),d.pipe(ob(s),eb(function(){var t=K(w.mark((function t(a){var s,u;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=a.servers,u=a.unit,r&&o.unit!==u?n.reject(new ca("upload unit is different, reject to continue",Wf)):r&&(e.manager=i,i.chunkCount=o.chunkCount,i.chunks=o.chunks,i.totalFailures=o.totalFailures,i.uploadedChunks=o.uploadedChunks,i.timer=o.timer,i.initState=o.initState,i.unit=o.unit,i.uploadedSize=o.uploadedSize,i.singleThread=o.singleThread,i.updateProgress(0)),i.addServers(s),"uninitialized"!==i.initState){t.next=7;break}return c=i.initChunks(u),t.next=7,c;case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())).subscribe({complete:function(){return t({hasExist:!1})},error:u}),l=function(e){"uninitialized"!==i.initState&&c?t(c.then((function(){return{hasExist:!1}}))):u(e)},h.pipe(ob(s)).subscribe({error:l}),f.pipe(ob(s)).subscribe({error:l})})),t.next=9,u;case 9:if(!t.sent.hasExist){t.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),t.abrupt("return");case 15:s.next(),s.complete(),this.log("chunks initialization promise resolved"),l=fb(i.ee,"serverUsedUp").pipe(at((function(){return i.chunkCount!==i.uploadedChunks.length})),dt(5e3,void 0,{leading:!1}),Vl((function(){return a().ret}))).subscribe((function(t){i.addServers(t.servers)})),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doUploadTask(e,n,!0).catch((function(t){n.reject(t)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doUploadTask(e,n,!0).catch((function(t){n.reject(t)}))})),i.ee.once("timedOut",(function(){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new bb("upload timed out",vh))})),i.ee.once("error",(function(t){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(t||new ca("upload error",Wf))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new Qk("Uploading canceled",Hq))}),{once:!0}),i.ee.once("finished",K(w.mark((function t(){var r,o,a;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l.unsubscribe(),t.next=3,e.setter(i.unit,i.getUploadServerIPs());case 3:r=t.sent,o=r.zone,a=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:a,zone:o});case 8:case"end":return t.stop()}}),t)})))),i.uploadToServers();case 26:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"doUploadTask",value:function(t,e){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=t.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=t),new Promise((function(i,o){n.doUploadTaskImpl(t,e,r).then(i).catch(o)}))}},{key:"processMediaTask",value:function(){var t=K(w.mark((function t(){var e,n,r;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.mediaTasks.size){t.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,e=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[e])){t.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(e))){t.next=10;break}throw new Da("task invalid");case 10:if("UPLOAD"!==r.type){t.next=15;break}return t.next=13,this.doUploadTask(r,n).catch((function(t){r.manager.ee.removeAllListeners(),n.reject(t)}));case 13:t.next=18;break;case 15:if("DOWNLOAD"!==r.type){t.next=18;break}return t.next=18,this.doDownloadTask(r,n).catch((function(t){r.manager.ee.removeAllListeners(),n.reject(t)}));case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"cancelTask",value:function(t){var e="DOWNLOAD"===t.type?Iq:Hq;t.manager.ee.removeAllListeners(),t.manager.abortController.abort(),void 0!==this.taskFinishers[t.taskId]&&this.taskFinishers[t.taskId].reject(new Qk("User logged out or kicked off, media task canceled",e))}}]),e}(vb());m(zr,"MAX_PENDING_TASK_COUNT",9),Sn("of",(function(){for(var t=0,e=arguments.length,n=new(ve(this))(e);e>t;)n[t]=arguments[t++];return n}),ej);var Ar=1/0,vC=Math.max,Dt=function(t,e,n){var r=Object(t);if(!sd(t)){var i=Fe(e);t=Rc(t),e=function(t){return i(r[t],t,r)}}return-1<(e=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=Pk(n))===Ar||n===-Ar?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=vC(r+n,0)),xp(t,Fe(e),n)}(t,e,n))?r[i?t[e]:e]:void 0},Ct=function(t,e){return t&&t.length?fk(t,void 0,"function"==typeof e?e:void 0):[]},Br=function(){function t(){W(this,t),m(this,"size",0),m(this,"fields",new Map)}return Ea(t,[{key:"define",value:function(t,e,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");vg(e={val:0,isNumber:"number"===e,isBoolean:"boolean"===e,oneof:"number"===e||"boolean"===e?void 0:e,len:n}),this.fields.set(t,e)}},{key:"set",value:function(t,e){if(!(t=this.fields.get(t)))throw Error("field not found");var n=t.oneof;if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(e=n[e]))throw Error("field type not found")}vg(t,e),t.val=e}},{key:"toNumber",value:function(){for(var t=0,e=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=pa(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(t+=U.fromValue(i).shiftLeft(e).toNumber(),e+=o)}return t}},{key:"toLong",value:function(){for(var t=U.fromNumber(0,!0),e=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=pa(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(t=U.fromValue(i).shiftLeft(e).add(t),e+=o)}return t}},{key:"assert",value:function(t,e){function n(t){if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(t=i[t]))throw Error("field type not found")}return vg(r,t),ug(t,r.val)}var r=this.fields.get(t);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(e))return n(e);if(1===e.length)return n(e[0]);if(e.every((function(t){return"string"==typeof t}))&&void 0!==i)return e.some((function(t){return n(t)}));throw Error("invalid valueTypes")}},{key:"from",value:function(t){t=U.fromValue(t);for(var e=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=pa(r[n],2)[1],o=i.len,a=U.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(e);vg(i,a=t.and(a).shiftRightUnsigned(e)),i.val=a,e+=o}}},{key:"typeOf",value:function(t){if(void 0!==(t=this.fields.get(t))){var e=t.oneof;if(t=t.val,void 0!==e){var n=0;for(e=Object.entries(e);n<e.length;n++){var r=pa(e[n],2),i=r[0];if(ug(t,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),t}(),Cr=function(t){function e(t){W(this,e);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",5),r.set("Subversion",301),r.set("Rejoin",t),r}ka(e,t);var n=la(e);return e}(Br),wC=Ja(Ja(Ja(Ja({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),Dr={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},xC=Ja(Ja({},wC),Dr),yC={Uncompressed:0,Zlib:1},Od=function(t){function e(t){W(this,e);var r=n.call(this);if(r.define("MessageType",xC,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",yC,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof t||U.isLong(t))r.from(t);else if(void 0!==t){var i=0;for(t=dr(t);i<t.length;i++){var o=pa(t[i],2);r.set(o[0],o[1])}}return r}ka(e,t);var n=la(e);return Ea(e,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(t){var e=this;return void 0!==t?this.assert("MessageType",t):Rk(Dr).some((function(t){return e.assert("MessageType",t)}))}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),e}(Br),zC=function(t){function e(t){return W(this,e),m(n(t=r.call(this,t,"ChatManager")),"dialogueLru",new px(void 0,{maxlen:1e4,ttl:1e4})),t}ka(e,t);var r=la(e);return Ea(e,[{key:"getChatInfo",value:function(t){var e=this.dialogueLru.get(t);if(this.dialogueLru.prune(),e){var n=e.dialogue,r={dialogue:n,sequence:e=e.sequence.add(1)};return this.dialogueLru.set(t,{dialogue:n,sequence:e}),r}return n={dialogue:lg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(t,n),n}}]),e}(vb()),u={};"object"==("undefined"==typeof module?"undefined":R(module))&&(module.exports=u),u.parse=function(t,e){var n,r=u.bin.readUshort,i=u.bin.readUint,o={};for(n=(t=new Uint8Array(t)).length-4;101010256!=i(t,n);)n--;var a=r(t,n=n+4+4);r(t,n+=2),i(t,n+=2),n=i(t,n+=4);for(var s=0;s<a;s++){i(t,n),n+=4,n+=4,n+=4,i(t,n+=4);var c=i(t,n+=4),l=i(t,n+=4),d=r(t,n+=4),h=r(t,n+2),f=r(t,n+4);n+=6;var p=i(t,n+=8);n+=4,n+=d+h+f,u._readLocal(t,p,o,c,l,e)}return o},u._readLocal=function(t,e,n,r,i,o){var a=u.bin.readUshort,s=u.bin.readUint;s(t,e),a(t,e+=4),a(t,e+=2);var c=a(t,e+=2);s(t,e+=2),s(t,e+=4),s=a(t,e=e+4+8);var l=a(t,e+=2);if(e+=2,a=u.bin.readUTF8(t,e,s),e=e+s+l,o)n[a]={size:i,csize:r};else if(t=new Uint8Array(t.buffer,e),0==c)n[a]=new Uint8Array(t.buffer.slice(e,e+r));else{if(8!=c)throw"unknown compression method: "+c;e=new Uint8Array(i),u.inflateRaw(t,e),n[a]=e}},u.inflateRaw=function(t,e){return u.F.inflate(t,e)},u.inflate=function(t,e){return t[0],t[1],u.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-2),e)},u.deflate=function(t,e){null==e&&(e={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*t.length));return r[n]=120,r[n+1]=156,n=u.F.deflateRaw(t,r,n+2,e.level),t=u.adler(t,0,t.length),r[n+0]=t>>>24&255,r[n+1]=t>>>16&255,r[n+2]=t>>>8&255,r[n+3]=t>>>0&255,new Uint8Array(r.buffer,0,n+4)},u.deflateRaw=function(t,e){null==e&&(e={level:6});var n=new Uint8Array(50+Math.floor(1.1*t.length)),r=u.F.deflateRaw(t,n,r,e.level);return new Uint8Array(n.buffer,0,r)},u.encode=function(t,e){null==e&&(e=!1);var n,r=0,i=u.bin.writeUint,o=u.bin.writeUshort,a={};for(n in t){var s=!u._noNeed(n)&&!e,c=t[n],l=u.crc.crc(c,0,c.length);a[n]={cpr:s,usize:c.length,crc:l,file:s?u.deflateRaw(c):c}}for(n in a)r+=a[n].file.length+30+46+2*u.bin.sizeUTF8(n);for(n in t=new Uint8Array(r+22),e=0,c=[],a)l=a[n],c.push(e),e=u._writeHeader(t,e,n,l,0);for(n in r=0,s=e,a)l=a[n],c.push(e),e=u._writeHeader(t,e,n,l,1,c[r++]);return a=e-s,i(t,e,101010256),o(t,e=e+4+4,r),o(t,e+=2,r),i(t,e+=2,a),i(t,e+4,s),t.buffer},u._noNeed=function(t){return t=t.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(t)},u._writeHeader=function(t,e,n,r,i,o){var a=u.bin.writeUint,s=u.bin.writeUshort,c=r.file;return a(t,e,0==i?67324752:33639248),e+=4,1==i&&(e+=2),s(t,e,20),s(t,e+=2,0),s(t,e+=2,r.cpr?8:0),a(t,e+=2,0),a(t,e+=4,r.crc),a(t,e+=4,c.length),a(t,e+=4,r.usize),s(t,e+=4,u.bin.sizeUTF8(n)),s(t,e+=2,0),e+=2,1==i&&(a(t,e=e+2+2+6,o),e+=4),e+=n=u.bin.writeUTF8(t,e,n),0==i&&(t.set(c,e),e+=c.length),e},u.crc={table:function(){for(var t=new Uint32Array(256),e=0;256>e;e++){for(var n=e,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t}(),update:function(t,e,n,r){for(var i=0;i<r;i++)t=u.crc.table[255&(t^e[n+i])]^t>>>8;return t},crc:function(t,e,n){return 4294967295^u.crc.update(4294967295,t,e,n)}},u.adler=function(t,e,n){var r=1,i=0,o=e;for(e+=n;o<e;){for(n=Math.min(o+5552,e);o<n;)i+=r+=t[o++];r%=65521,i%=65521}return i<<16|r},u.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,n){t[e]=255&n,t[e+1]=n>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,n){t[e]=255&n,t[e+1]=n>>8&255,t[e+2]=n>>16&255,t[e+3]=n>>24&255},readASCII:function(t,e,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r},writeASCII:function(t,e,n){for(var r=0;r<n.length;r++)t[e+r]=n.charCodeAt(r)},pad:function(t){return 2>t.length?"0"+t:t},readUTF8:function(t,e,n){for(var r,i="",o=0;o<n;o++)i+="%"+u.bin.pad(t[e+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return u.bin.readASCII(t,e,n)}return r},writeUTF8:function(t,e,n){for(var r=n.length,i=0,o=0;o<r;o++){var a=n.charCodeAt(o);if(0==(4294967168&a))t[e+i]=a,i++;else if(0==(4294965248&a))t[e+i]=192|a>>6,t[e+i+1]=128|a>>0&63,i+=2;else if(0==(4294901760&a))t[e+i]=224|a>>12,t[e+i+1]=128|a>>6&63,t[e+i+2]=128|a>>0&63,i+=3;else{if(0!=(4292870144&a))throw"e";t[e+i]=240|a>>18,t[e+i+1]=128|a>>12&63,t[e+i+2]=128|a>>6&63,t[e+i+3]=128|a>>0&63,i+=4}}return i},sizeUTF8:function(t){for(var e=t.length,n=0,r=0;r<e;r++){var i=t.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},u.F={},u.F.deflateRaw=function(t,e,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=u.F.U,a=u.F._goodIndex;u.F._hash;var s=u.F._putsE,c=0;n<<=3;var l=0,d=t.length;if(0==r){for(;c<d;){var h=Math.min(65535,d-c);s(e,n,c+h==d?1:0),n=u.F._copyExact(t,c,h,e,n+8),c+=h}return n>>>3}s=o.lits,r=o.strt;var f=o.prev,p=0,v=0,m=0,g=0,A=0;for(2<d&&(r[A=u.F._hash(t,0)]=0),c=0;c<d;c++){if(h=A,c+1<d-2){A=u.F._hash(t,c+1);var y=c+1&32767;f[y]=r[A],r[A]=y}if(l<=c){if((14e3<p||26697<v)&&100<d-c&&(l<c&&(s[p]=c-l,p+=2,l=c),n=u.F._writeBlock(c==d-1||l==d?1:0,s,p,g,t,m,c-m,e,n),p=v=g=0,m=c),y=0,c<d-2&&(y=u.F._bestMatch(t,c,f,h,Math.min(i[2],d-c),i[3])),0!=y){h=y>>>16,y&=65535;var b=a(h,o.of0);o.lhst[257+b]++;var w=a(y,o.df0);o.dhst[w]++,g+=o.exb[b]+o.dxb[w],s[p]=h<<23|c-l,s[p+1]=y<<16|b<<8|w,p+=2,l=c+h}else o.lhst[t[c]]++;v++}}for(m==c&&0!=t.length||(l<c&&(s[p]=c-l,p+=2),n=u.F._writeBlock(1,s,p,g,t,m,c-m,e,n));0!=(7&n);)n++;return n>>>3},u.F._bestMatch=function(t,e,n,r,i,o){var a=32767&e,s=n[a],c=a-s+32768&32767;if(s==a||r!=u.F._hash(t,e-c))return 0;for(var l=r=0,d=Math.min(32767,e);c<=d&&0!=--o&&s!=a;){if((0==r||t[e+r]==t[e+r-c])&&(a=u.F._howLong(t,e,c))>r){if(l=c,(r=a)>=i)break;c+2<a&&(a=c+2);for(var h=0,f=0;f<a-2;f++){var p=e-c+f+32768&32767,v=p-n[p]+32768&32767;v>h&&(h=v,s=p)}}c+=(a=s)-(s=n[a])+32768&32767}return r<<16|l},u.F._howLong=function(t,e,n){if(t[e]!=t[e-n]||t[e+1]!=t[e+1-n]||t[e+2]!=t[e+2-n])return 0;var r=e,i=Math.min(t.length,e+258);for(e+=3;e<i&&t[e]==t[e-n];)e++;return e-r},u.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},u.saved=0,u.F._writeBlock=function(t,e,n,r,i,o,a,s,c){var l=u.F.U,d=u.F._putsF,h=u.F._putsE;l.lhst[256]++;var f=u.F.getTrees(),p=f[0],v=f[1],m=f[2],g=f[3],A=f[4],y=f[5],b=f[6];f=f[7];var w=32+(0==(c+3&7)?0:8-(c+3&7))+(a<<3),E=r+u.F.contSize(l.fltree,l.lhst)+u.F.contSize(l.fdtree,l.dhst);r=r+u.F.contSize(l.ltree,l.lhst)+u.F.contSize(l.dtree,l.dhst),r+=14+3*y+u.F.contSize(l.itree,l.ihst)+(2*l.ihst[16]+3*l.ihst[17]+7*l.ihst[18]);for(var _=0;286>_;_++)l.lhst[_]=0;for(_=0;30>_;_++)l.dhst[_]=0;for(_=0;19>_;_++)l.ihst[_]=0;if(w=w<E&&w<r?0:E<r?1:2,d(s,c,t),d(s,c+1,w),c+=3,0==w){for(;0!=(7&c);)c++;c=u.F._copyExact(i,o,a,s,c)}else{if(1==w)var S=l.fltree,T=l.fdtree;if(2==w){for(u.F.makeCodes(l.ltree,p),u.F.revCodes(l.ltree,p),u.F.makeCodes(l.dtree,v),u.F.revCodes(l.dtree,v),u.F.makeCodes(l.itree,m),u.F.revCodes(l.itree,m),S=l.ltree,T=l.dtree,h(s,c,g-257),h(s,c+=5,A-1),h(s,c+=5,y-4),c+=4,t=0;t<y;t++)h(s,c+3*t,l.itree[1+(l.ordr[t]<<1)]);c=u.F._codeTiny(b,l.itree,s,c+3*y),c=u.F._codeTiny(f,l.itree,s,c)}for(y=0;y<n;y+=2){for(b=(t=e[y])>>>23,t=o+(8388607&t);o<t;)c=u.F._writeLit(i[o++],S,s,c);0!=b&&(t=(p=e[y+1])>>16,a=p>>8&255,p&=255,h(s,c=u.F._writeLit(257+a,S,s,c),b-l.of0[a]),c+=l.exb[a],d(s,c=u.F._writeLit(p,T,s,c),t-l.df0[p]),c+=l.dxb[p],o+=b)}c=u.F._writeLit(256,S,s,c)}return c},u.F._copyExact=function(t,e,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(t.buffer,e,n),o),i+(n+4<<3)},u.F.getTrees=function(){for(var t=u.F.U,e=u.F._hufTree(t.lhst,t.ltree,15),n=u.F._hufTree(t.dhst,t.dtree,15),r=[],i=u.F._lenCodes(t.ltree,r),o=[],a=u.F._lenCodes(t.dtree,o),s=0;s<r.length;s+=2)t.ihst[r[s]]++;for(s=0;s<o.length;s+=2)t.ihst[o[s]]++;s=u.F._hufTree(t.ihst,t.itree,7);for(var c=19;4<c&&0==t.itree[1+(t.ordr[c-1]<<1)];)c--;return[e,n,s,i,a,c,r,o]},u.F.getSecond=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(t[n+1]);return e},u.F.nonZero=function(t){for(var e="",n=0;n<t.length;n+=2)0!=t[n+1]&&(e+=(n>>1)+",");return e},u.F.contSize=function(t,e){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[1+(r<<1)];return n},u.F._codeTiny=function(t,e,n,r){for(var i=0;i<t.length;i+=2){var o=t[i],a=t[i+1];r=u.F._writeLit(o,e,n,r);var s=16==o?2:17==o?3:7;15<o&&(u.F._putsE(n,r,a,s),r+=s)}return r},u.F._lenCodes=function(t,e){for(var n=t.length;2!=n&&0==t[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=t[r+1],o=r+3<n?t[r+3]:-1,a=r+5<n?t[r+5]:-1,s=0==r?-1:t[r-1];if(0==i&&o==i&&a==i){for(o=r+5;o+2<n&&t[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?e.push(17,i-3):e.push(18,i-11),r+=2*i-2}else if(i==s&&o==i&&a==i){for(o=r+5;o+2<n&&t[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),e.push(16,i-3),r+=2*i-2}else e.push(i,0)}return n>>>1},u.F._hufTree=function(t,e,n){var r=[],i=t.length,o=e.length,a=0;for(a=0;a<o;a+=2)e[a]=0,e[a+1]=0;for(a=0;a<i;a++)0!=t[a]&&r.push({lit:a,f:t[a]});if(t=r.length,i=r.slice(0),0==t)return 0;if(1==t)return e[1+((n=r[0].lit)<<1)]=1,e[1+((0==n?1:0)<<1)]=1;r.sort((function(t,e){return t.f-e.f})),a=r[0],o=r[1];var s=0,c=1,l=2;for(r[0]={lit:-1,f:a.f+o.f,l:a,r:o,d:0};c!=t-1;)a=s!=c&&(l==t||r[s].f<r[l].f)?r[s++]:r[l++],o=s!=c&&(l==t||r[s].f<r[l].f)?r[s++]:r[l++],r[c++]={lit:-1,f:a.f+o.f,l:a,r:o};for((r=u.F.setDepth(r[c-1],0))>n&&(u.F.restrictDepth(i,n,r),r=n),a=0;a<t;a++)e[1+(i[a].lit<<1)]=i[a].d;return r},u.F.setDepth=function(t,e){return-1!=t.lit?t.d=e:Math.max(u.F.setDepth(t.l,e+1),u.F.setDepth(t.r,e+1))},u.F.restrictDepth=function(t,e,n){var r=0,i=1<<n-e,o=0;for(t.sort((function(t,e){return e.d==t.d?t.f-e.f:e.d-t.d})),r=0;r<t.length&&t[r].d>e;r++){var a=t[r].d;t[r].d=e,o+=i-(1<<n-a)}for(o>>>=n-e;0<o;)(a=t[r].d)<e?(t[r].d++,o-=1<<e-a-1):r++;for(;0<=r;r--)t[r].d==e&&0>o&&(t[r].d--,o++);0!=o&&console.log("debt left")},u.F._goodIndex=function(t,e){var n=0;return e[16|n]<=t&&(n|=16),e[8|n]<=t&&(n|=8),e[4|n]<=t&&(n|=4),e[2|n]<=t&&(n|=2),e[1|n]<=t&&(n|=1),n},u.F._writeLit=function(t,e,n,r){return u.F._putsF(n,r,e[t<<1]),r+e[1+(t<<1)]},u.F.inflate=function(t,e){var n=Uint8Array;if(3==t[0]&&0==t[1])return e||new n(0);var r=u.F,i=r._bitsF,o=r._bitsE,a=r._decodeTiny,s=r.makeCodes,c=r.codes2map,l=r._get17,d=r.U,h=null==e;h&&(e=new n(t.length>>>2<<3));for(var f,p,v,m,g=0,A=0,y=p=0,b=0;0==g;)if(g=i(t,b,1),f=i(t,b+1,2),b+=3,0==f)0!=(7&b)&&(b+=8-(7&b)),f=t[(b=4+(b>>>3))-4]|t[b-3]<<8,h&&(e=u.F._check(e,y+f)),e.set(new n(t.buffer,t.byteOffset+b,f),y),b=b+f<<3,y+=f;else{if(h&&(e=u.F._check(e,y+131072)),1==f&&(v=d.flmap,m=d.fdmap,A=511,p=31),2==f){for(p=o(t,b,5)+257,f=o(t,b+5,5)+1,v=o(t,b+10,4)+4,b+=14,m=0;38>m;m+=2)d.itree[m]=0,d.itree[m+1]=0;for(A=1,m=0;m<v;m++){var w=o(t,b+3*m,3);d.itree[1+(d.ordr[m]<<1)]=w,w>A&&(A=w)}b+=3*v,s(d.itree,A),c(d.itree,A,d.imap),v=d.lmap,m=d.dmap,b=a(d.imap,(1<<A)-1,p+f,t,b,d.ttree),A=(1<<(w=r._copyOut(d.ttree,0,p,d.ltree)))-1,p=(1<<(f=r._copyOut(d.ttree,p,f,d.dtree)))-1,s(d.ltree,w),c(d.ltree,w,v),s(d.dtree,f),c(d.dtree,f,m)}for(;;)if(b+=15&(f=v[l(t,b)&A]),0==(w=f>>>4)>>>8)e[y++]=w;else{if(256==w)break;f=y+w-254,264<w&&(f=y+((w=d.ldef[w-257])>>>3)+o(t,b,7&w),b+=7&w),b+=15&(w=m[l(t,b)&p]);var E=((w=d.ddef[w>>>4])>>>4)+i(t,b,15&w);for(b+=15&w,h&&(e=u.F._check(e,y+131072));y<f;)e[y]=e[y++-E],e[y]=e[y++-E],e[y]=e[y++-E],e[y]=e[y++-E];y=f}}return e.length==y?e:e.slice(0,y)},u.F._check=function(t,e){var n=t.length;return e<=n?t:((e=new Uint8Array(Math.max(n<<1,e))).set(t,0),e)},u.F._decodeTiny=function(t,e,n,r,i,o){for(var a=u.F._bitsE,s=u.F._get17,c=0;c<n;){var l=t[s(r,i)&e];i+=15&l;var d=l>>>4;if(15>=d)o[c]=d,c++;else{var h=l=0;for(16==d?(h=3+a(r,i,2),i+=2,l=o[c-1]):17==d?(h=3+a(r,i,3),i+=3):18==d&&(h=11+a(r,i,7),i+=7),d=c+h;c<d;)o[c]=l,c++}}return i},u.F._copyOut=function(t,e,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=t[o+e];r[o<<1]=0,r[1+(o<<1)]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},u.F.makeCodes=function(t,e){var n,r,i=u.F.U,o=t.length,a=i.bl_count;for(n=0;n<=e;n++)a[n]=0;for(n=1;n<o;n+=2)a[t[n]]++;for(i=i.next_code,n=0,a[0]=0,r=1;r<=e;r++)n=n+a[r-1]<<1,i[r]=n;for(e=0;e<o;e+=2)0!=(a=t[e+1])&&(t[e]=i[a],i[a]++)},u.F.codes2map=function(t,e,n){for(var r=t.length,i=u.F.U.rev15,o=0;o<r;o+=2)if(0!=t[o+1]){var a=t[o+1],s=o>>1<<4|a,c=e-a;for(c=(a=t[o]<<c)+(1<<c);a!=c;)n[i[a]>>>15-e]=s,a++}},u.F.revCodes=function(t,e){for(var n=u.F.U.rev15,r=15-e,i=0;i<t.length;i+=2)t[i]=n[t[i]<<e-t[i+1]]>>>r},u.F._putsE=function(t,e,n){n<<=7&e,t[e>>>=3]|=n,t[e+1]|=n>>>8},u.F._putsF=function(t,e,n){n<<=7&e,t[e>>>=3]|=n,t[e+1]|=n>>>8,t[e+2]|=n>>>16},u.F._bitsE=function(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<n)-1},u.F._bitsF=function(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<n)-1},u.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},u.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},u.F.U=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(65536),prev:new t(32768)}}(),function(){function t(t,e,n){for(;0!=e--;)t.push(0,n)}for(var e=u.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)e.ldef[n]=e.of0[n]<<3|e.exb[n],e.ddef[n]=e.df0[n]<<4|e.dxb[n];t(e.fltree,144,8),t(e.fltree,112,9),t(e.fltree,24,7),t(e.fltree,8,8),u.F.makeCodes(e.fltree,9),u.F.codes2map(e.fltree,9,e.flmap),u.F.revCodes(e.fltree,9),t(e.fdtree,32,5),u.F.makeCodes(e.fdtree,5),u.F.codes2map(e.fdtree,5,e.fdmap),u.F.revCodes(e.fdtree,5),t(e.itree,19,0),t(e.ltree,286,0),t(e.dtree,30,0),t(e.ttree,320,0)}();var Wk=u.inflate,Er=u.deflate,Fr=function(t){function e(t,i,o,a){W(this,e);var s=r.call(this,a,"Session");return m(n(s),"chatManager",void 0),m(n(s),"joinedChannels",new Set),m(n(s),"msgDedupLru",new nc(void 0,{maxlen:200})),m(n(s),"startTime",Date.now()),m(n(s),"seq",U.fromNumber(1,!0)),m(n(s),"userJoinOptions",new Cr(!1)),m(n(s),"seqSentStatuses",[!1,!1]),m(n(s),"dialogueSequenceLru",new nc(void 0,{maxlen:1e4})),m(n(s),"loggedOut",!1),m(n(s),"messageSentTimes",[]),m(n(s),"curLoginSockets",[void 0,void 0]),m(n(s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(s),"lastLoginSockets",[new ce(1),new ce(1)]),m(n(s),"dialPendingMsgSubjectMaps",[new Map,new Map]),m(n(s),"context",void 0),m(n(s),"connection",void 0),m(n(s),"instanceId",void 0),m(n(s),"registerSocketsFailureListener",(function(){s.connection.once("socketsFailure",(function(){s.log("socketsFailure, creating a new connection"),qd((function(){return s.connection.removeAllListeners(),s.connection=new sr(s.context,s.logger,!0),s.loginHandler(6e3,!0)})).pipe(ae((function(t){return t.pipe(Wc(Nd.getParameter("RECONNECTING_AP_INTERVAL")))})),ob(s.connection.apClient.apFinish$)).subscribe((function(){s.log("new connection connected")}))})),0===s.connection.listenerCount("tokenExpired")&&s.connection.on("tokenExpired",(function(){s.emit("tokenExpired")}))})),s.context=t,s.connection=i,s.instanceId=o,s.chatManager=new zC(a),s.log("The instanceId is %s",s.instanceId.toString()),s}ka(e,t);var r=la(e);return Ea(e,[{key:"fetchFileUploadIndexGet",value:function(t){var n=t.hash,r=t.size;if(0===(t=this.getLoginSockets()).length)throw new H("Client is not logged in");var i=this.incGetSeq();return t.forEach((function(t){t.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})})),{ret:ya.apply(void 0,I(t.map((function(t){return t.fromReceived("FileUploadIndexRet").pipe(X((function(t){return i.eq(t.seq)})))})))),fin:ya.apply(void 0,I(t.map((function(t){return t.fromReceived("FileUploadIndexFin").pipe(X((function(t){return i.eq(t.seq)})))})))),err:Tb.apply(void 0,I(t.map((function(t){return t.fromReceived("FileUploadIndexErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){throw new ca(["The media message upload failure, code %d",t.code],Wf)})))})))),timeout:e.genTimeoutError(vh)}}},{key:"requestFileUploadIndexSet",value:function(t){var n=t.hash,r=t.unit,i=t.servers;if(0===(t=this.getLoginSockets()).length)throw new H("Client is not logged in");var o=this.incGetSeq();return t.forEach((function(t){t.sendPacket("FileUploadIndexSet",{seq:o,servers:i,hash:n,unit:r})})),ya.apply(void 0,[e.genTimeoutError(vh)].concat(I(t.map((function(t){return t.fromReceived("FileUploadIndexErr").pipe(X((function(t){return o.eq(t.seq)})),Z((function(t){throw new ca(["FileUploadIndexSet failure, code %d",t.code],Wf)})))}))),I(t.map((function(t){return t.fromReceived("FileUploadIndexFin").pipe(X((function(t){return o.eq(t.seq)})))})))))}},{key:"requestFileDownloadIndexGet",value:function(t){var n=t.size,r=t.zone,i=t.unit,o=t.hash,a=this.getLoginSockets();if(0===a.length)throw new H("Client is not logged in");var s=this.incGetSeq();return a.forEach((function(t){t.sendPacket("FileDownloadIndexGet",{seq:s,size:n,zone:r,unit:i,hash:o})})),t=ya.apply(void 0,I(a.map((function(t){return t.fromReceived("FileDownloadIndexRet").pipe(X((function(t){return s.eq(t.seq)})))})))).pipe(Z((function(t){var e=t.backups,n=t.servers;return t=Se(t,["backups","servers"]),Ja({backupList:e.map((function(t){return[t]})),serverList:n.map((function(t){return[t]}))},t)})),Wc(500)),a=Pl(a.map((function(t){return t.fromReceived("FileDownloadIndexRet").pipe(X((function(t){return s.eq(t.seq)})))}))),ya(t,a.pipe(Z((function(t){return t.reduce((function(t,e){var n=t.backupList,r=t.serverList;t=e.backups;var i=e.servers;return e=Se(e,["backups","servers"]),Ja({backupList:t.map((function(t,e){return[t].concat(I(void 0!==n&&Array.isArray(n[e])?n[e]:[]))})),serverList:i.map((function(t,e){return[t].concat(I(void 0!==n&&Array.isArray(r[e])?r[e]:[]))}))},e)}),{})}))),e.genTimeoutError(vh))}},{key:"loginHandler",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e4,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new H("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(e,r){var o=t.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),t.loginSocketSubs[r].login=e.pipe(Y((function(e){var o,a;t.curLoginSockets[r]=e;var s=Date.now();cb("Link",{ackedServerIp:e.address,destServerIp:e.ip,ec:0,sc:0,elapse:db(t.startTime),lts:U.fromNumber(s),responseTime:i-s,sid:Sa(t.instanceId),userId:t.context.uid},null===(o=t.context.areaConfig)||void 0===o?void 0:o.EVENT_REPORT_DOMAIN[0],null===(a=t.context.areaConfig)||void 0===a?void 0:a.EVENT_REPORT_BACKUP_DOMAIN[0]),t.emit("userJoined",e.env),n&&t.connection.apClient.apFinish$.next(void 0)}))).subscribe(t.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Tb.apply(void 0,I(r).concat([fb(this.connection,"connectionInitFailure").pipe(Y((function(t){if(wa(t)||Na(t))throw t;throw new ca("Login failure",{code:yq,originalError:t})})))])).pipe(Pa(1),Za(e),Ga((function(e){return e instanceof pb&&t.warn("Client login timeout"),e&&e.code===uh&&(t.connection.emit("tokenExpired"),t.connection.apClient.apFinish$.next(void 0)),t.clearSockets(0,n),ba(e)})),Y((function(){n||t.registerSocketsFailureListener()})),hg((function(){n||t.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:function(){var t=K(w.mark((function t(){var e,n,r,i=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),e=this.getLoginSockets(),n=e.map((function(t){return t.sendPacket("UserQuit",{}),i.connection.waitClosing(t)})),this.clearSockets(5e3),r=e.map((function(t){return t.env})),[0,1].filter((function(t){return!r.includes(t)})).forEach((function(t){i.connection.closeSocket(t,0)})),t.abrupt("return",Tb.apply(void 0,I(n)).toPromise());case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.getLoginSockets().length){t.next=2;break}throw new H("Client is not logged in. Cannot join the channel",uq);case 2:return r=fb(this,"channelLeft").pipe(nb((function(t){return t===e})),Pa(1)),i=this.incGetSeq(),(o=this.lastLoginSockets.map((function(t){return t.pipe(vc((function(t,e){0!==e&&a.incSeqIfNeeded(t.env);var r=0===e?i:a.seq;return t.sendPacket("GroupEnter",{account:n,seq:r}),t.fromReceived("GroupReply").pipe(X((function(t){return r.eq(t.seq)})),Y((function(t){if(0!==(t=t.code))throw new ca(["Channel join failure. The response code is %d",t],qq)})))})),ob(r),be())}))).forEach((function(t,n){var r=function(){return a.loginSocketSubs[n].channels.delete(e.channelId)};a.loginSocketSubs[n].channels.set(e.channelId,t.subscribe({error:r,complete:r}))})),t.next=8,Tb.apply(void 0,I(o)).pipe(Pa(1),Za(1e4),Ga((function(t){return t instanceof pb&&a.warn("Channel join timeout"),ba(t)}))).toPromise();case 8:this.joinedChannels.add(e);case 9:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(t,e){this.emit("channelLeft",t),this.joinedChannels.delete(t),this.getLoginSockets().forEach((function(t){t.sendPacket("GroupLeave",{account:e})}))}},{key:"requestChannelMemberList",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in. Cannot get the channel members",Bz);var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupAllUsersList",{group:t,pageNumber:0,pageSize:200,seq:r})})),ya.apply(void 0,[e.genTimeoutError(oq)].concat(I(n.map((function(e){return e.fromReceived("GroupAllUsersResult").pipe(X((function(e){var n=e.seq;return e.group===t&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserStatusList",{users:t,seq:r})})),ya.apply(void 0,[e.genTimeoutError(Nz)].concat(I(n.map((function(t){return t.fromReceived("UserStatusResult").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(t,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new H("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(e,i){void 0!==n&&i!==n||e.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(t).map((function(t){return{key:(t=pa(t,2))[0],value:t[1]}})),seq:o})})),ya.apply(void 0,I(i.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return o.eq(t.seq)})),Z((function(t){throw new ca(["The user attributes set failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(i.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(X((function(t){return o.eq(t.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(t,n,r){var i=this.getLoginSockets();if(0===i.length)throw new H("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(e){e.sendPacket("GroupAttributeSet",{broadcast:r,group:t,attributeInfos:Object.entries(n).map((function(t){return{key:(t=pa(t,2))[0],value:t[1]}})),seq:o})})),ya.apply(void 0,I(i.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return o.eq(t.seq)})),Z((function(t){throw new ca(["The group attributes set failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(i.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(X((function(t){return o.eq(t.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(t){var n=this,r=this.getLoginSockets();if(0===r.length)throw new H("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(e){e.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(t).map((function(t){return{key:(t=pa(t,2))[0],value:t[1]}})),seq:i})})),ya.apply(void 0,I(r.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){throw new ca(["The user attributes add or update failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(r.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(X((function(t){return i.eq(t.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(t,n,r){var i=this.getLoginSockets();if(0===i.length)throw new H("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(e){e.sendPacket("GroupAttributeMod",{broadcast:r,group:t,attributeInfos:Object.entries(n).map((function(t){return{key:(t=pa(t,2))[0],value:t[1]}})),seq:o})})),ya.apply(void 0,I(i.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return o.eq(t.seq)})),Z((function(t){throw new ca(["The group attributes add or update failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(i.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(X((function(t){return o.eq(t.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(t){var n=this,r=this.getLoginSockets();if(0===r.length)throw new H("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(e){e.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:t,seq:i})})),ya.apply(void 0,I(r.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){throw new ca(["The user attributes delete failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(r.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(X((function(t){return i.eq(t.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(t,n,r){var i=this.getLoginSockets();if(0===i.length)throw new H("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(e){e.sendPacket("GroupAttributeDel",{group:t,broadcast:r,attributes:n,seq:o})})),ya.apply(void 0,I(i.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return o.eq(t.seq)})),Z((function(t){throw new ca(["The channel attributes delete failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(i.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(X((function(t){return o.eq(t.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var t=this,n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserAttributeSet",{account:t.context.uid,seq:r,attributeInfos:[]})})),ya.apply(void 0,I(n.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return r.eq(t.seq)})),Z((function(t){throw new ca(["The user attributes clear failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(n.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(t,n){var r=this.getLoginSockets();if(0===r.length)throw new H("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(e){e.sendPacket("GroupAttributeSet",{group:t,seq:i,attributeInfos:[],broadcast:n})})),ya.apply(void 0,I(r.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){throw new ca(["The channel attributes clear failure, code %d",t.code],Ob)})))}))).concat([e.genTimeoutError(Pb)],I(r.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(X((function(t){return i.eq(t.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(t,n){var r=this.getLoginSockets();if(0===r.length)throw new H("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(e){e.sendPacket("UserAttributeGet",{account:t,seq:i,attributes:n})})),ya.apply(void 0,[e.genTimeoutError(Pb)].concat(I(r.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){if(10008===(t=t.code))throw new ca("The user requested is not online",lq);throw new Pc(["User attribute operation unknown error code: %d",t],Ob)})))}))),I(r.map((function(t){return t.fromReceived("UserAttributeRet").pipe(X((function(t){return i.eq(t.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(t,n){var r=this.getLoginSockets();if(0===r.length)throw new H("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(e){e.sendPacket("GroupAttributeGet",{group:t,seq:i,attributes:n})})),ya.apply(void 0,[e.genTimeoutError(Pb)].concat(I(r.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return i.eq(t.seq)})),Z((function(t){throw new ca(["The channel attributes get failure, code %d",t.code],Ob)})))}))),I(r.map((function(t){return t.fromReceived("GroupAttributeRet").pipe(X((function(t){return i.eq(t.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserAttributeKeysGet",{account:t,seq:r})})),ya.apply(void 0,[e.genTimeoutError(Pb)].concat(I(n.map((function(t){return t.fromReceived("UserAttributeErr").pipe(X((function(t){return r.eq(t.seq)})),Z((function(t){if(10008===(t=t.code))throw new ca("The user requested is not online",lq);throw new Pc(["User attribute operation unknown error code: %d",t],Ob)})))}))),I(n.map((function(t){return t.fromReceived("UserAttributeKeysRet").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupAttributeKeysGet",{group:t,seq:r})})),ya.apply(void 0,[e.genTimeoutError(Pb)].concat(I(n.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(X((function(t){return r.eq(t.seq)})),Z((function(t){throw new Pc(["Channel attribute operation unknown error code: %d",t.code],Ob)})))}))),I(n.map((function(t){return t.fromReceived("GroupAttributeKeysRet").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupStatusList",{groups:t,seq:r})})),ya.apply(void 0,[e.genTimeoutError(oq)].concat(I(n.map((function(t){return t.fromReceived("GroupStatusResult").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new H("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(e){e.sendPacket("SubscribeUserStatus",{seq:r,users:t})})),ya.apply(void 0,[e.genTimeoutError(Uz)].concat(I(n.map((function(t){return t.fromReceived("SubscribeResponse").pipe(X((function(t){return r.eq(t.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(t){var e=this.getLoginSockets();if(0===e.length)throw new H("Client is not logged in");var n=this.incGetSeq();e.forEach((function(e){e.sendPacket("UnsubscribeUserStatus",{seq:n,users:t})}))}},{key:"sendInvitationMessage",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h,f,p=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.peerId,r=e.callId,i=e.extra,o=e.isAcceptAck,a=e.channelId,s=e.type,c={callId:r},void 0===o){t.next=6;break}if("CallAccept"===s){t.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=a,("CallInvite"===s||"CallCancel"===s||"CallReject"===s||"CallAccept"===s&&!1===o)&&void 0!==i&&(c.extra=i),u=lg(),this.log("The sent invitation body is %o",c),l=function(t){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:u,instance:p.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new Od({IterationNumber:t,MessageType:s}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:p.context.uid}},t.next=14,Ib(this.sendMessageToRetry(l,!0)).pipe(Za(1e4),Ga((function(t){return t instanceof pb&&p.warn("Send invitation timeout"),ba(t)}))).toPromise();case 14:return d=t.sent,h=d.code,f=d.retryTimes,t.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==f});case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var t=K(w.mark((function t(e,n,r,i,o,a){var s,c,u,l,d,h,f,p,v,g,A,y,b,E,_,S,T,C,x,R,I,O,M,k,B,N,P,D,F,H=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=n.width,u=void 0===c?0:c,l=n.height,d=void 0===l?0:l,h=n.fileName,f=void 0===h?"":h,p=n.description,v=void 0===p?"":p,g=n.thumbnail,A=void 0===g?new Blob:g,y=n.thumbnailHeight,b=void 0===y?0:y,E=n.thumbnailWidth,_=void 0===E?0:E,S=n.size,T=void 0===S?0:S,C=n.mediaId,x=o.enableOfflineMessaging,R=o.enableHistoricalMessaging,ua(r)){t.next=4;break}throw new L("The send message arguments are not valid",i?Ik:Tf);case 4:if(!(32768<new Blob([f,A,v]).size)){t.next=6;break}throw new L("The size of message overflowed ",i?ge:qh);case 6:return I=this.chatManager.getChatInfo(r),O=I.dialogue,M=I.sequence,k=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(k,"-").concat(O,"#").concat(M,'"'),i?" peer":" channel",r),m(s={},"media_description",v),m(s,"media_width",u),m(s,"media_height",d),m(s,"media_thumbnailwidth",_),m(s,"media_thumbnailheight",b),m(s,"media_size",T),m(s,"media_id",C),m(s,"media_filename",f),B=oc(s,(function(t){return(new TextEncoder).encode(t.toString())})),t.t0=Uint8Array,t.next=14,wi(A);case 14:return t.t1=t.sent,B.media_thumbnail=new t.t0(t.t1),N=i&&"IMAGE"===e?"PeerImageMessage":i&&"FILE"===e?"PeerFileMessage":i||"IMAGE"!==e?"ChannelFileMessage":"ChannelImageMessage",P=function(t){return{MiscMap:B,sequence:M,dialogue:O,instance:k,dst:r,ms:U.fromNumber(Date.now(),!0),options:new Od({IterationNumber:t,CompressionMethod:"Uncompressed",MessageType:N,ToCache:x,ToArchive:R}).toLong(),payload:new Uint8Array,src:H.context.uid}},t.next=20,Ib(this.sendMessageToRetry(P,!0)).pipe(Za(void 0===a?1e4:a),Ga((function(t){return t instanceof pb&&H.warn("Send message timeout"),ba(t)}))).toPromise();case 20:if(D=t.sent,2!==(F=D.code)){t.next=24;break}throw new ca("The peer does not support this type of message",Mz);case 24:return t.abrupt("return",{hasPeerReceived:0===F});case 25:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,o,a){return t.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var t=K(w.mark((function t(e,n,r,i,o,a){var s,c,u,l,d,h,f,p,v,m,g=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=o.enableOfflineMessaging,c=o.enableHistoricalMessaging,ua(r)&&e instanceof Uint8Array&&"string"==typeof n){t.next=3;break}throw new L("The send message arguments are not valid",i?Ik:Tf);case 3:if(!(32768<e.byteLength+new Blob([n]).size)){t.next=5;break}throw new gb("The message size is over the 32KB limit",i?ge:qh);case 5:return u=!Nd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=e.byteLength,l=this.chatManager.getChatInfo(r),d=l.dialogue,h=l.sequence,f=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(f,"-").concat(d,"#").concat(h,'"'),u?" compressed":"",i?"peer":"channel",r),p=function(t){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:h,dialogue:d,instance:f,dst:r,ms:U.fromNumber(Date.now(),!0),options:new Od({IterationNumber:t,CompressionMethod:u?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:s,ToArchive:c}).toLong(),payload:u?Er(e):e,src:g.context.uid}},t.next=12,Ib(this.sendMessageToRetry(p,!0)).pipe(Za(void 0===a?1e4:a),Ga((function(t){return t instanceof pb&&g.warn("Send message timeout"),ba(t)}))).toPromise();case 12:return v=t.sent,m=v.code,t.abrupt("return",{hasPeerReceived:0===m});case 15:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,o,a){return t.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var t=K(w.mark((function t(e,n,r,i,o){var a,s,c,u,l,d,h,f,p,v,m,g=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=i.enableOfflineMessaging,s=i.enableHistoricalMessaging,ua(n)){t.next=3;break}throw new L("The send message arguments are not valid",r?Ik:Tf);case 3:if(!(32768<new Blob([e]).size)){t.next=5;break}throw new gb("The message size is over the 32KB limit",r?ge:qh);case 5:return c=!Nd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([e]).size,u=this.chatManager.getChatInfo(n),l=u.dialogue,d=u.sequence,h=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(h,"-").concat(l,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",n),f=(new TextEncoder).encode(e),p=function(t){return{MiscMap:{},sequence:d,dialogue:l,instance:h,dst:n,ms:U.fromNumber(Date.now(),!0),options:new Od({IterationNumber:t,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:a,ToArchive:s}).toLong(),payload:c?Er(f):f,src:g.context.uid}},t.next=13,Ib(this.sendMessageToRetry(p,!0)).pipe(Za(void 0===o?1e4:o),Ga((function(t){return t instanceof pb&&g.warn("Send message timeout"),ba(t)}))).toPromise();case 13:return v=t.sent,m=v.code,t.abrupt("return",{hasPeerReceived:0===m});case 16:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(t,e){Object.entries(this.loginSocketSubs[t]).forEach((function(t){var n=(t=pa(t,2))[1];"channels"===t[0]&&e||(Array.isArray(n)||n instanceof Map?n.forEach((function(t){return t.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[t]={channels:e?this.loginSocketSubs[t].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l,d,h=this,f=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=2<f.length&&void 0!==f[2]?f[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){t.next=5;break}throw Error("no logged-in sockets");case 5:return o=e(r),i.forEach((function(t){t.sendPacket("Message",o)})),a=o.dialogue,s=o.sequence,c=o.instance,u=i.map((function(t){return t.fromReceived("Ack").pipe(nb((function(t){return a.eq(t.dialogue)&&s.eq(t.sequence)&&c.eq(t.instance)})))})),t.prev=9,t.next=12,Tb.apply(void 0,I(u)).pipe(Za(6e3),Ga((function(t){return Na(t)&&h.warn("Message send timeout, retry times %d",r),ba(t)})),Pa(1)).toPromise();case 12:return l=t.sent,d=l.code,this.log("The message has been acked, %o",{code:d}),t.abrupt("return",{code:d,retryTimes:r});case 18:if(t.prev=18,t.t0=t.catch(9),!(t.t0 instanceof pb&&n)){t.next=22;break}return t.abrupt("return",this.sendMessageToRetry(e,!1,r+1));case 22:throw t.t0;case 23:case"end":return t.stop()}}),t,this,[[9,18]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var t=this;this.lastLoginSockets.map((function(e){return e.pipe(vc((function(e){return uc(0,1e3).pipe(Y((function(){t.incSeqIfNeeded(e.env),e.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:t.seq})})))})))})).forEach((function(e,n){var r=t.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),t.loginSocketSubs[n].keepAlive=e.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var t=this;this.lastLoginSockets.map((function(t){return t.pipe(vc((function(t){var e,n=!1,r=t.userJoin$.pipe(Y((function(){n=!0}))),i=t.input$.pipe(Y((function(t){"Ping"!==yi[t.uri].slice(0,-3)&&(n=!1)})));return Tb(uc(5e3,4500).pipe(jt(t.receivedPacket),Y((function(r){r=pa(r,2),r=pa(r[1],2)[1],e!==r||n||t.forceReconnect(),e=r}))),r,i)})))})).forEach((function(e,n){var r=t.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),t.loginSocketSubs[n].keepAliveReconnector=e.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var t=this;this.lastLoginSockets.map((function(e){return e.pipe(vc((function(e){return Tb(fb(e,"reconnect").pipe(Y(t.onSocketReconnect(e))),e.fromReceived("Message").pipe(Y(t.onMessage(e))),e.fromReceived("GroupEnterNotice").pipe(Y(t.onGroupEnterNotice())),e.fromReceived("GroupLeaveNotice").pipe(Y(t.onGroupLeaveNotice())),e.fromReceived("GroupCountNotice").pipe(Y(t.onGroupCountNotice())),e.fromReceived("GroupAttributeAlt").pipe(Y(t.onGroupAttributeAlt())),e.fromReceived("UserJoinNotice").pipe(Y(t.onUserNotice(S.PeerOnlineState.ONLINE))),e.fromReceived("UserQuitNotice").pipe(Y(t.onUserNotice(S.PeerOnlineState.OFFLINE))),e.fromReceived("UserWaitNotice").pipe(Y(t.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(bf(void 0))})))})).forEach((function(e,n){t.loginSocketSubs[n].receivers.push(e.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(t,e,n){var r=this;return Ol(qd((function(){r.userJoinOptions=new Cr(e),t.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:t.ticket})})),t.fromReceived("UserResp").pipe(X((function(t){return n.eq(t.seq)})),Y((function(e){if(0!==(e=e.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new ca(["Login failure. The response code from the RTM service is %d",e],sh);r.log("ENV_%d logged in",t.env)})),bf(t),Za(5e3))).pipe(nb((function(t){return void 0!==t})),Ga((function(t){return t instanceof pb&&r.warn("Login response timeout, rejoin: %s",e),ba(t)})))}},{key:"getSocketLoginObservables",value:function(t,e){var n=this;return t.map((function(t){return t.pipe(Y((function(t){0===t.listenerCount("socketUserDrop")&&t.on("socketUserDrop",(function(e){return n.onUserDrop(e,t)}))})),vc((function(t,r){return n.incSeqIfNeeded(t.env),n.requestSocketLogin(t,0!==r,0===r?e:n.seq)})),be())}))}},{key:"incSeqIfNeeded",value:function(t){if(![0,1].includes(t))throw new Ca({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[t]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[t]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var t=this.curLoginSockets,e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(t,n){var r=t.options,i=t.payload,o=t.src,a=t.dst,s=t.instance,c=t.dialogue,u=t.sequence,l=t.ms,d=t.MiscMap;this.dialogueSequenceLru.set(c.toString(),u),s="".concat(s,"-").concat(c,"#").concat(u),this.msgDedupLru.has(s)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,s):(this.msgDedupLru.set(s,void 0),n=new Od(r),this.lastLoginSockets.forEach(function(){var n=K(w.mark((function n(r){var i;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Pa(1)).toPromise();case 2:i=n.sent,e.sendMessageAck(t,i);case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(a=na(r?Wk(Am(i,Uint8Array.of(0,0,0,0))):i),a=JSON.parse(a),this.log("The received invitation body is %o",a),this.emit("invitationMessage",{body:a,type:n.getInvitationType(),peerId:o,serverReceivedTs:l.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=na(r?Wk(Am(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a%s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",o,a,s),d?(o={text:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",o)):this.emit("channelTextMessage",{channelId:a,memberId:o,text:i,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":na(d),i=r?Wk(i):i,this.info("Received a%s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",o,a,s),c?(o={desc:d,raw:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",o)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:a,memberId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",o,a,s),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:o,channelId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(t){var e=this;return function(){var n=[0,1].filter((function(e){return e!==t.env}))[0];(n=e.connection.curOpenSockets[n])&&!n.loggedIn&&e.emit("connectionLost")}}},{key:"onUserDrop",value:function(t,e){var n,r;t=t.code,cb("KickedOff",{code:0,elapse:db(this.startTime),linkId:parseInt(e.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:e.address,serverCode:t,sid:Sa(this.instanceId),userId:this.context.uid},null===(n=this.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_DOMAIN[0],null===(r=this.context.areaConfig)||void 0===r?void 0:r.EVENT_REPORT_BACKUP_DOMAIN[0]),10006===t||10001===t?this.warn("Login too often and kicked off, reconnect and login"):10009===t?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=lg(),this.context.sid=Sa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(t)&&(this.emit("userDrop",t),this.clearSockets())}},{key:"clearSockets",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){t.cleanLoginSubs(r,n),t.connection.closeSocket(r,e)}))}},{key:"onMessage",value:function(t){var e=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,a=n.options;if(n.src===e.context.uid)e.log("The message is from the local account, ignored");else{var s=r.toString(),c=e.dialPendingMsgSubjectMaps[t.env].get(s);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),e.log("Env_%d: The dialogue has pending messages, next: %s",t.env,r);else{var u=e.dialogueSequenceLru.get(s);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)e.emitMessage(n,t.env);else{if(u){if(o.lte(u))return;e.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",t.env,r)}else e.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",t.env,r);o=new La,e.dialPendingMsgSubjectMaps[t.env].set(s,o);var l=o.pipe(ks(yk),ig((function(t,e){return[].concat(I(t),[e])}),[]),Z((function(t){return t.sort((function(t,e){return t=t.sequence,e=e.sequence,t.eq(e)?0:t.gt(e)?1:-1}))})),Yl(1));a=!(a=new Od(a)).isFromCache()&&!a.isBufferedMessage(),l.pipe(ob(uc(a?750:1500)),X((function(t){if(2>t.length)return!1;for(var e=void 0===u?U.fromNumber(1,!0):u.add(1),n=0;n<t.length;e=e.add(1),n++)if(!t[n].sequence.eq(e))return!1;return!0})),hg((function(){e.dialPendingMsgSubjectMaps[t.env].delete(s)}))).subscribe((function(n){n.forEach((function(n){e.emitMessage(n,t.env),e.log("Env_%d: The message queue has fully ordered, emitting: %s",t.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof gg&&l.pipe(Pa(1)).subscribe((function(n){return n.forEach((function(n){e.log("Env_%d: The message pending queue expired, emitting: %s",t.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),e.emitMessage(n,t.env)}))}))})),o.next(n)}}}}}},{key:"onGroupEnterNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,memberId:e.user,type:"MemberJoined",size:e.size})}}},{key:"onGroupLeaveNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,memberId:e.user,type:"MemberLeft",size:e.size})}}},{key:"onGroupCountNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,type:"MemberCountUpdated",size:e.size})}}},{key:"onGroupAttributeAlt",value:function(){var t=this;return function(e){var n=e.group;e=Se(e,["group"]),t.emit("channelAttributesUpdated",Ja({channelId:n},e))}}},{key:"onUserNotice",value:function(t){var e=this;return function(n){e.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:t})}}}],[{key:"sendMessageAck",value:function(t,e){var n=new Od(t.options);(n.isInvitation()||n.isPeerMessage())&&e.sendPacket("Ack",{code:0,dialogue:t.dialogue,instance:t.instance,sequence:t.sequence})}}]),e}(vb());m(Fr,"genTimeoutError",(function(t,e){return mb(void 0).pipe(Wc(void 0===e?1e4:e),Z((function(){throw new bb(["Request timed out after %ds",void 0===e?1e4:e],t)})))}));var Gr,Xk,Yk=0,Zk=0;Id.v1=function(t,e,n){n=e&&n||0;var r=e||[],i=(t=t||{}).node||Gr,o=void 0!==t.clockseq?t.clockseq:Xk;if(null==i||null==o){var a=jq();null==i&&(i=Gr=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=Xk=16383&(a[6]<<8|a[7]))}a=void 0!==t.msecs?t.msecs:(new Date).getTime();var s=void 0!==t.nsecs?t.nsecs:Zk+1,c=a-Yk+(s-Zk)/1e4;if(0>c&&void 0===t.clockseq&&(o=o+1&16383),(0>c||a>Yk)&&void 0===t.nsecs&&(s=0),1e4<=s)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(Yk=a,Zk=s,Xk=o,t=(1e4*(268435455&(a+=122192928e5))+s)%4294967296,r[n++]=t>>>24&255,r[n++]=t>>>16&255,r[n++]=t>>>8&255,r[n++]=255&t,t=a/4294967296*1e4&268435455,r[n++]=t>>>8&255,r[n++]=255&t,r[n++]=t>>>24&15|16,r[n++]=t>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return e||kq(r)},Id.v4=Id;var $k=zh(),jd,Hr,Oe=S.LocalInvitationFailureReason,xa=S.LocalInvitationState,AC=(Hr=function(t){function e(t,i,o){W(this,e);var a=r.call(this,o,"RtmLocalInvitation",!0);return m(n(a),"state",xa.IDLE),m(n(a),"localInvitationEnd$",ya(fb(n(a),"LocalInvitationAccepted"),fb(n(a),"LocalInvitationRefused"),fb(n(a),"LocalInvitationFailure"),fb(n(a),"LocalInvitationCanceled")).pipe(Pa(1))),m(n(a),"callId",Id.v4()),m(n(a),"_content",""),m(n(a),"_channelId",""),m(n(a),"_response",""),m(n(a),"calleeId",void 0),m(n(a),"logger",void 0),m(n(a),"getSession",void 0),a.calleeId=t,a.getSession=i,a.logger=o,a}ka(e,t);var r=la(e);return Ea(e,[{key:"channelId",get:function(){return this._channelId},set:function(t){this.state!==xa.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=t)}},{key:"content",get:function(){return this._content},set:function(t){this.log("set content for %s",this.callId),this._content=t}},{key:"response",get:function(){return this._response},set:function(t){throw new L('Cannot set the "response" of the LocalInvitation instance.',rc)}},{key:"send",value:function(){var t,e=this;if(this.state===xa.SENT_TO_REMOTE||this.state===xa.RECEIVED_BY_REMOTE)throw new H("The local invitation send failure. The call invitation has already been sent.",Fz);if(this.isLocalInvitationEnd())throw new H("The local invitation send failure. The call invitation has ended.",rh);if(0<this._channelId.length&&!ua(this._channelId))throw new L("Illegal invitation channel ID",rc);if(!ua(this.calleeId))throw new L("Illegal invitation callee user ID",rc);if(8192<sg(this._content))throw new L('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',rc);this.state=xa.SENT_TO_REMOTE,qd(K(w.mark((function n(){var r,i,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getSession().sendInvitationMessage({peerId:e.calleeId,callId:e.callId,extra:e._content,type:"CallInvite",channelId:e._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!e.isLocalInvitationEnd()){n.next=7;break}throw new bb("send invitation timeout");case 7:if(e.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw t=new $k({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw t=new $k({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(ae((function(t){return t.pipe(Y((function(t){if(!(t instanceof $k))throw t})),Wc(2e3))})),Za(3e4),Ga((function(t){return Na(t)&&e.warn("local invitation ack timed out"),ba(t)})),ob(this.localInvitationEnd$)).subscribe({next:function(){e.state===xa.RECEIVED_BY_REMOTE?e.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):e.state!==xa.SENT_TO_REMOTE?e.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(e.info("The peer received the local invitation %s.",e.callId),e.state=xa.RECEIVED_BY_REMOTE,e.emit("LocalInvitationReceivedByPeer"),e.localInvitationEnd$.pipe(Za(6e4),Ga((function(t){return Na(t)&&e.warn("local invitation expired"),ba(t)}))).subscribe({error:function(){e.state=xa.FAILURE,e.emit("LocalInvitationFailure",Oe.INVITATION_EXPIRE)}}))},error:function(n){e.isLocalInvitationEnd()?e.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(e.state=xa.FAILURE,Na(n)&&t?"PEER_NOT_ONLINE"===t.code?e.emit("LocalInvitationFailure",Oe.PEER_OFFLINE):"RESENT_AND_OFFLINE"===t.code&&e.emit("LocalInvitationFailure",Oe.PEER_NO_RESPONSE):Na(n)?e.emit("LocalInvitationFailure",Oe.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?e.emit("LocalInvitationFailure",Oe.NOT_LOGGEDIN):e.emit("LocalInvitationFailure",Oe.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new H("The local invitation cancel failure",rh);if(this.state===xa.IDLE)throw new H("The local invitation has not been sent",Ez);if(8192<sg(this._content))throw new L('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',rc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=xa.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(t){if(this.isLocalInvitationEnd()&&this.state!==xa.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===xa.IDLE)throw new H("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===xa.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===xa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=xa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=xa.ACCEPTED_BY_REMOTE,this._response=t,this.emit("LocalInvitationAccepted",t))}}},{key:"onRefuseReceived",value:function(t){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===xa.IDLE)throw new H("the local have not sent the invitation, how can remote refuse it?");this.state===xa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=xa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=t,this.state=xa.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",t)}}},{key:"isLocalInvitationEnd",value:function(){return[xa.CANCELED,xa.FAILURE,xa.ACCEPTED_BY_REMOTE,xa.REFUSED_BY_REMOTE].includes(this.state)}}]),e}(vb()),jd=Hr,da(jd.prototype,"send",[ia],Object.getOwnPropertyDescriptor(jd.prototype,"send"),jd.prototype),da(jd.prototype,"cancel",[ia],Object.getOwnPropertyDescriptor(jd.prototype,"cancel"),jd.prototype),jd),Bh=S.RemoteInvitationFailureReason,ib=S.RemoteInvitationState,BC=function(t){function e(t){var i=t.invitationChannel,o=t.extraContent,a=t.callId,s=t.callerId,c=t.logger;t=t.getSession,W(this,e);var u=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(u),"state",ib.INVITATION_RECEIVED),m(n(u),"remoteInvitationEnd$",ya(fb(n(u),"RemoteInvitationCanceled"),fb(n(u),"RemoteInvitationRefused"),fb(n(u),"RemoteInvitationAccepted"),fb(n(u),"RemoteInvitationFailure")).pipe(Pa(1))),m(n(u),"callerId",void 0),m(n(u),"callId",void 0),m(n(u),"_getSession",void 0),m(n(u),"logger",void 0),m(n(u),"_content",void 0),m(n(u),"_channelId",void 0),m(n(u),"_response",""),u._channelId=i,u._content=o,u.callId=a,u.callerId=s,u._getSession=t,u.logger=c,u.remoteInvitationEnd$.pipe(Za(6e4),Ga((function(t){return Na(t)&&u.warn("Remote invitation expired"),ba(t)}))).subscribe({error:function(){u.state=ib.FAILURE,u.emit("RemoteInvitationFailure",Bh.INVITATION_EXPIRE)}}),u}ka(e,t);var r=la(e);return Ea(e,[{key:"channelId",get:function(){return this._channelId},set:function(t){throw new L('Cannot set the "response" of the RemoteInvitation instance.',rc)}},{key:"content",get:function(){return this._content},set:function(t){throw new L('Cannot set the "content" of the RemoteInvitation instance.',rc)}},{key:"response",get:function(){return this._response},set:function(t){this._response=t}},{key:"accept",value:function(){var t,e=this;if(this.isRemoteInvitationEnd())throw new H("The local invitation has ended. Cannot accept.",rh);if(this.state===ib.ACCEPT_SENT_TO_LOCAL)throw new H("The remote invitation is accepting. Cannot do the operation.",pq);if(8192<sg(this._response))throw new L('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',rc);this.state=ib.ACCEPT_SENT_TO_LOCAL,Tb(Sl(1e3).pipe(eb((function(){return qd(K(w.mark((function t(){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._getSession().sendInvitationMessage({peerId:e.callerId,callId:e.callId,extra:e.response,type:"CallAccept",isAcceptAck:!1,channelId:e.channelId}));case 1:case"end":return t.stop()}}),t)}))))})),nb((function(e){return t=e.hasPeerReceived})),Pa(1)),fb(this,"RemoteInvitationAccepted")).pipe(Za(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(n){if(e.logError(n),e.state=ib.FAILURE,Na(n))switch(t){case void 0:case!0:return void e.emit("RemoteInvitationFailure",Bh.ACCEPT_FAILURE);case!1:return void e.emit("RemoteInvitationFailure",Bh.PEER_OFFLINE)}e.emit("RemoteInvitationFailure",Bh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===ib.ACCEPT_SENT_TO_LOCAL)throw new H("The remote invitation is accepting. Cannot do the operation.",pq);if(this.isRemoteInvitationEnd())throw new H("The invitation is end. Cannot refuse",rh);if(8192<sg(this._response))throw new L('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',rc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=ib.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(t){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===ib.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=t,this.state=ib.CANCELED,this.emit("RemoteInvitationCanceled",t))}},{key:"onAcceptAckReceived",value:function(){this.state!==ib.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=ib.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[ib.ACCEPTED,ib.REFUSED,ib.CANCELED,ib.FAILURE].includes(this.state)}}]),e}(vb()),CC=function(t){function e(t,i){W(this,e);var o=r.call(this,i,"InvitationManager");return m(n(o),"getSession",void 0),m(n(o),"invitationDispatcher",new aa.EventEmitter),m(n(o),"outgoingLocalInvitations",new Map),m(n(o),"receivedRemoteInvitations",new nc(void 0,{maxlen:1e4})),m(n(o),"logger",void 0),o.getSession=Fm(t),o.logger=i,o.invitationDispatcher.on("remoteInvitationToManager",(function(t){var e=t.callId,n=t.extra,r=t.callerId;t=t.channelId,o.receivedRemoteInvitations.has(e)||((n=new BC({callerId:r,callId:e,getSession:o.getSession,logger:i,extraContent:n,invitationChannel:t})).remoteInvitationEnd$.subscribe((function(){o.receivedRemoteInvitations.delete(e)})),o.receivedRemoteInvitations.set(e,n),o.emit("remoteInvitationInstance",n))})),o.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(t){(t=o.receivedRemoteInvitations.get(t.callId))&&t.onAcceptAckReceived()})),o.invitationDispatcher.on("cancelToRemoteInvitation",(function(t){var e=t.extra;(t=o.receivedRemoteInvitations.get(t.callId))&&t.onCancelReceived(e)})),o.invitationDispatcher.on("acceptToLocalInvitation",(function(t){var e=t.extra;(t=o.outgoingLocalInvitations.get(t.callId))&&t.onAcceptReceived(e)})),o.invitationDispatcher.on("refuseToLocalInvitation",(function(t){var e=t.extra;(t=o.outgoingLocalInvitations.get(t.callId))&&t.onRefuseReceived(e)})),o}ka(e,t);var r=la(e);return Ea(e,[{key:"invitationMessageHandler",value:function(t){var e=t.body,n=e.callId,r=e.extra;r=void 0===r?"":r;var i=e.type,o=void 0===(e=e.channel)?"":e,a=t.type;switch(e=t.peerId,t=t.serverReceivedTs,a){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:e,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:e,properties:{serverReceivedTs:t,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw mm("invitationType",a)}}},{key:"genLocalInvitation",value:function(t){var e=this,n=new AC(t,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){e.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),e}(vb()),DC=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return jb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),KB(t,e,{leading:r,maxWait:e,trailing:i})},wb,Ir,Pe;!function(t){t[t.JOINED=0]="JOINED",t[t.LEFT=1]="LEFT"}(Pe||(Pe={}));var Jr=S.ConnectionState,EC=(Ir=function(t){function e(t,i,o,a){W(this,e);var s=r.call(this,a,"RtmChannel",!0);return m(n(s),"onMemberCountUpdated",DC((function(t){t!==s.memberCount&&(s.memberCount=t,s.emit("MemberCountUpdated",t))}),1e3)),m(n(s),"getSession",void 0),m(n(s),"memberCount",0),m(n(s),"memberJoinedLru",new nc(void 0,{maxlen:1e4})),m(n(s),"memberLeftLru",new nc(void 0,{maxlen:1e4})),m(n(s),"memberJoinStateLru",new nc(void 0,{maxlen:1e4})),m(n(s),"attributesSeqLru",new nc(void 0,{maxlen:1e4})),m(n(s),"channelId",void 0),m(n(s),"client",void 0),m(n(s),"onAttributesUpdated",(function(t){var e=t.channelId,n=t.attributeMaps,r=t.seq;t=t.instance.toString();var i=s.attributesSeqLru.get(t);if((!i||r.greaterThan(i))&&(s.attributesSeqLru.set(t,r),e===s.channelId)){for(e={},r=0;r<n.length;r++){var o=n[r];t=o.key,i=o.ms;var a=o.value;if(o=o.origin,"string"!=typeof t||!U.isLong(i)||"string"!=typeof a||!ua(o))break;e[t]={value:a,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}s.emit("AttributesUpdated",e)}})),m(n(s),"onChannelTextMessage",(function(t){var e=t.memberId,n=t.text,r=t.properties;t.channelId===s.channelId&&s.emit("ChannelMessage",{text:n,messageType:S.MessageType.TEXT},e,r)})),m(n(s),"onChannelMediaMessage",(function(t){var e=t.memberId,n=t.properties,r=t.details,i=t.messageType;t.channelId===s.channelId&&("FILE"===i?s.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(na(r.media_size),10),description:na(r.media_description),fileName:na(r.media_filename),mediaId:na(r.media_id),thumbnail:new Blob([r.media_thumbnail])},e,n):"IMAGE"===i&&s.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(na(r.media_size),10),description:na(r.media_description),fileName:na(r.media_filename),mediaId:na(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(na(r.media_height),10),width:parseInt(na(r.media_width),10),thumbnailHeight:parseInt(na(r.media_thumbnailheight),10),thumbnailWidth:parseInt(na(r.media_thumbnailwidth),10)},e,n))})),m(n(s),"onChannelRawMessage",(function(t){var e=t.desc,n=t.raw,r=t.memberId,i=t.properties;t.channelId===s.channelId&&s.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:n,description:e},r,i)})),m(n(s),"onMemberNotice",(function(t){var e=t.memberId,n=t.type,r=t.size;if(t.channelId===s.channelId){var i=t.instance.toString();t=t.seq.toString();var o={MemberLeft:s.memberLeftLru,MemberJoined:s.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+t))return void s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,t,s.channelId,e);if(o.set(i+t,void 0),"string"!=typeof e)return;if(e!==s.getSession().context.uid){if((i=s.memberJoinStateLru.get(e))===Pe.JOINED&&"MemberJoined"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,t,s.channelId,e);if(i===Pe.LEFT&&"MemberLeft"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,t,s.channelId,e)}s.memberJoinStateLru.set(e,"MemberJoined"===n?Pe.JOINED:Pe.LEFT)}s.info("Channel %s - %s, memberId: %s",n,s.channelId,"MemberCountUpdated"===n?"[unknown]":e),i=e===s.getSession().context.uid,"MemberLeft"===n&&ua(e)||"MemberJoined"===n&&ua(e)?(i||s.emit(n,e),s.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&s.onMemberCountUpdated(r)}})),s.getSession=Fm(i),s.channelId=t,s.client=o,s.info("A channel created, id %s",t),s}ka(e,t);var r=la(e);return Ea(e,[{key:"join",value:function(){var t=K(w.mark((function t(){var e,n,r,i,o,a,s,c,u,l,d,h,f;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ua(this.channelId)){t.next=2;break}throw new L(["The %s in the arguments is invalid","channelId"],Gz);case 2:t.prev=2,e=this.getSession(),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(2),new H("The client is not logged in. Cannot do the operation",uq);case 9:if(!e.joinedChannels.has(this)){t.next=12;break}throw cb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:e.context.uid,elapse:db(e.startTime),errCode:tq,sid:Sa(e.instanceId)},null===(n=e.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_DOMAIN[0],null===(r=e.context.areaConfig)||void 0===r?void 0:r.EVENT_REPORT_BACKUP_DOMAIN[0]),new H("The channel has joined. Cannot rejoin",tq);case 12:if(t.prev=12,this.log("Joining the channel %s",this.channelId),!this.hasOtherChannelJoined()){t.next=17;break}throw cb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:e.context.uid,elapse:db(e.startTime),errCode:vq,sid:Sa(e.instanceId)},null===(c=e.context.areaConfig)||void 0===c?void 0:c.EVENT_REPORT_DOMAIN[0],null===(u=e.context.areaConfig)||void 0===u?void 0:u.EVENT_REPORT_BACKUP_DOMAIN[0]),new H("A channel of the same channel ID has already joined. Cannot rejoin",vq);case 17:if(20!==e.joinedChannels.size){t.next=20;break}throw cb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:e.context.uid,elapse:db(e.startTime),errCode:sq,sid:Sa(e.instanceId)},null===(l=e.context.areaConfig)||void 0===l?void 0:l.EVENT_REPORT_DOMAIN[0],null===(d=e.context.areaConfig)||void 0===d?void 0:d.EVENT_REPORT_BACKUP_DOMAIN[0]),new gb("The joined channels has exceeded the limit of 20",sq);case 20:return cb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:e.context.uid,elapse:db(e.startTime),errCode:0,sid:Sa(e.instanceId)},null===(i=e.context.areaConfig)||void 0===i?void 0:i.EVENT_REPORT_DOMAIN[0],null===(o=e.context.areaConfig)||void 0===o?void 0:o.EVENT_REPORT_BACKUP_DOMAIN[0]),t.next=23,e.requestChannelJoin(this,this.channelId);case 23:cb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:db(e.startTime),errCode:0,sid:Sa(e.instanceId),serverErrCode:0,userId:e.context.uid},null===(a=e.context.areaConfig)||void 0===a?void 0:a.EVENT_REPORT_DOMAIN[0],null===(s=e.context.areaConfig)||void 0===s?void 0:s.EVENT_REPORT_BACKUP_DOMAIN[0]),this.info("The channel %s joined successfully",this.channelId),e.on("channelTextMessage",this.onChannelTextMessage),e.on("channelRawMessage",this.onChannelRawMessage),e.on("channelMediaMessage",this.onChannelMediaMessage),e.on("memberNotice",this.onMemberNotice),e.on("channelAttributesUpdated",this.onAttributesUpdated),t.next=41;break;case 32:if(t.prev=32,t.t1=t.catch(12),this.logError(t.t1),!wa(t.t1)){t.next=37;break}throw t.t1;case 37:if(!Na(t.t1)){t.next=40;break}throw cb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:db(e.startTime),errCode:rq,sid:Sa(e.instanceId),serverErrCode:0,userId:e.context.uid},null===(h=e.context.areaConfig)||void 0===h?void 0:h.EVENT_REPORT_DOMAIN[0],null===(f=e.context.areaConfig)||void 0===f?void 0:f.EVENT_REPORT_BACKUP_DOMAIN[0]),new bb(["Join channel %s timed out",this.channelId],rq);case 40:throw new Pc(["The channel %s join failure",this.channelId],{code:qq,originalError:t.t1});case 41:case"end":return t.stop()}}),t,this,[[2,6],[12,32]])})));return function(){return t.apply(this,arguments)}}()},{key:"leave",value:function(){var t=K(w.mark((function t(){var e,n,r,i,o,a,s;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=this.getSession(),t.next=7;break;case 4:throw t.prev=4,t.t0=t.catch(0),new H("The client is not logged in. Cannot do the operation",Iz);case 7:if(r.joinedChannels.has(this)){t.next=9;break}throw new H("The channel does not join. Cannot do the operation",Hz);case 9:t.prev=9,r.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,r.removeListener("channelTextMessage",this.onChannelTextMessage),r.removeListener("channelRawMessage",this.onChannelRawMessage),r.removeListener("channelMediaMessage",this.onChannelMediaMessage),r.removeListener("memberNotice",this.onMemberNotice),r.removeListener("channelAttributesUpdated",this.onAttributesUpdated),t.next=32;break;case 23:if(t.prev=23,t.t1=t.catch(9),this.logError(t.t1),!wa(t.t1)){t.next=30;break}throw void 0===t.t1.code&&(t.t1.code=xq),cb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:db(r.startTime),errCode:xq,sid:Sa(r.instanceId),userId:r.context.uid},null===(a=r.context.areaConfig)||void 0===a?void 0:a.EVENT_REPORT_DOMAIN[0],null===(s=r.context.areaConfig)||void 0===s?void 0:s.EVENT_REPORT_BACKUP_DOMAIN[0]),t.t1;case 30:throw cb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:db(r.startTime),errCode:wq,sid:Sa(r.instanceId),userId:r.context.uid},null===(i=r.context.areaConfig)||void 0===i?void 0:i.EVENT_REPORT_DOMAIN[0],null===(o=r.context.areaConfig)||void 0===o?void 0:o.EVENT_REPORT_BACKUP_DOMAIN[0]),new Pc("The channel leave failure",{code:wq,originalError:t.t1});case 32:cb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:db(r.startTime),errCode:0,sid:Sa(r.instanceId),userId:r.context.uid},null===(e=r.context.areaConfig)||void 0===e?void 0:e.EVENT_REPORT_DOMAIN[0],null===(n=r.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_BACKUP_DOMAIN[0]);case 33:case"end":return t.stop()}}),t,this,[[0,4],[9,23]])})));return function(){return t.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s=this,c=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=1<c.length&&void 0!==c[1]?c[1]:{},r=n.enableHistoricalMessaging,i=void 0!==r&&r,ym(e,qh),t.prev=2,o=this.getSession(),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(2),new H("The client is not logged in. Cannot do the operation",Uf);case 9:if(o.joinedChannels.has(this)){t.next=11;break}throw new H("The channel does not join. Cannot do the operation",Uf);case 11:if(this.client.connectionState!==Jr.RECONNECTING){t.next=16;break}return a=Date.now(),t.next=15,new Promise((function(t,n){var r=function(){var r=K(w.mark((function r(){var c;return w.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=Date.now()-a,r.prev=1,r.next=4,pg({message:e,peerId:s.channelId,toPeer:!1,session:s.getSession(),errorCodes:{NOT_LOGGED_IN:Uf,TOO_OFTEN:mq},diff:c,logger:s.logger,options:{enableHistoricalMessaging:i,enableOfflineMessaging:!1}});case 4:t(),r.next=12;break;case 7:r.prev=7,r.t0=r.catch(1),Na(r.t0)&&n(new bb(Md(s.name,"sendMessageToPeer",1e4),Gk)),wa(r.t0)&&n(r.t0),n(new ca("Channel message send failure",{code:Tf,originalError:r.t0}));case 12:return r.prev=12,clearTimeout(o),r.finish(12);case 15:case"end":return r.stop()}}),r,null,[[1,7,12,15]])})));return function(){return r.apply(this,arguments)}}();s.client.internalEmitter.once("RECONNECTED",r);var o=setTimeout((function(){s.client.internalEmitter.off("RECONNECTED",r),n(new bb(Md(s.name,"sendMessageToPeer",1e4),Gk))}),9e3)}));case 15:return t.abrupt("return");case 16:if(this.client.connectionState===Jr.CONNECTED){t.next=18;break}throw new H("The client is not logged in. Cannot do the operation",Uf);case 18:return t.prev=18,t.next=21,pg({message:e,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:Uf,TOO_OFTEN:mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:i,enableOfflineMessaging:!1}});case 21:t.next=31;break;case 23:if(t.prev=23,t.t1=t.catch(18),!Na(t.t1)){t.next=27;break}throw new bb(Md(this.name,"sendMessage",1e4),Gk);case 27:if(!wa(t.t1)){t.next=30;break}throw this.logError(t.t1),t.t1;case 30:throw new Pc("The channel message send failure",Tf);case 31:case"end":return t.stop()}}),t,this,[[2,6],[18,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getMembers",value:function(){var t=K(w.mark((function t(){var e,n,r;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,t.prev=1,e=this.getSession(),t.next=8;break;case 5:throw t.prev=5,t.t0=t.catch(1),new H("The client is not logged in. Cannot do the operation",Dz);case 8:if(e.joinedChannels.has(this)){t.next=10;break}throw new H("The channel does not join. Cannot do the operation",Cz);case 10:return n=this.getSession().requestChannelMemberList(this.channelId),t.next=13,n.pipe(Z((function(t){return t.memberInfos.map((function(t){return t.account}))}))).toPromise();case 13:return r=t.sent,this.info("Channel %s - get members success, %o",this.channelId,r),t.abrupt("return",r);case 18:if(t.prev=18,t.t1=t.catch(0),!wa(t.t1)){t.next=23;break}throw this.logError(t.t1),t.t1;case 23:throw new Pc("The channel members get failure",Az);case 24:case"end":return t.stop()}}),t,this,[[0,18],[1,5]])})));return function(){return t.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var t=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some((function(e){return e.channelId===t.channelId}))}}]),e}(vb()),wb=Ir,da(wb.prototype,"join",[ia],Object.getOwnPropertyDescriptor(wb.prototype,"join"),wb.prototype),da(wb.prototype,"leave",[ia],Object.getOwnPropertyDescriptor(wb.prototype,"leave"),wb.prototype),da(wb.prototype,"sendMessage",[ia],Object.getOwnPropertyDescriptor(wb.prototype,"sendMessage"),wb.prototype),da(wb.prototype,"getMembers",[ia],Object.getOwnPropertyDescriptor(wb.prototype,"getMembers"),wb.prototype),wb),C,Kr,Cb=S.ConnectionChangeReason,Q=S.ConnectionState,Lr={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},FC={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},GC=(Kr=function(t){function e(t,i,o,a,s){W(this,e);var c=r.call(this,i,"RtmClient",!0);return m(n(c),"connectionState",Q.DISCONNECTED),m(n(c),"internalEmitter",new aa),m(n(c),"context",void 0),m(n(c),"attributes",{}),m(n(c),"loginPromise",void 0),m(n(c),"attributeDrafts",new Set),m(n(c),"session",void 0),m(n(c),"lastLoginTime",void 0),m(n(c),"reconnId",0),m(n(c),"channelAttributesCacheLru",new nc(void 0,{maxlen:1e4})),m(n(c),"invitationManager",void 0),m(n(c),"subscribedPeerStatusCache",{}),m(n(c),"peerStatusSeqLru",new nc(void 0,{maxlen:1e4})),m(n(c),"peerUnreachableTimers",{}),m(n(c),"mediaTaskManager",void 0),m(n(c),"config",void 0),m(n(c),"setParameters",void 0),m(n(c),"updateConfig",void 0),m(n(c),"userDropHandler",(function(t){if(c.connectionState!==Q.ABORTED)switch(t){case 11:c.logError("Kicked off by remote session"),c.onConnectionStateChanged(Q.ABORTED,Cb.REMOTE_LOGIN);break;case 14:case 15:case 16:c.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[t])),c.onConnectionStateChanged(Q.ABORTED,Cb.BANNED_BY_SERVER);break;default:c.logError("User kicked off for unknown code: ".concat(t)),c.onConnectionStateChanged(Q.ABORTED,Cb.INTERRUPTED)}})),c.context=new qC(t,i),c.mediaTaskManager=new zr(i),c.config=o,c.internalEmitter.setMaxListeners(512),c.setParameters=a.bind(n(c)),c.updateConfig=a.bind(n(c)),void 0!==s&&c.context.setAreaConfig(s),c.invitationManager=new CC((function(){return c.session}),i),c.invitationManager.on("remoteInvitationInstance",(function(t){c.emit("RemoteInvitationReceived",t)})),c}ka(e,t);var r=la(e);return Ea(e,[{key:"renewToken",value:function(){var t=K(w.mark((function t(e){var n,r,i,o=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&0!==e.length){t.next=2;break}throw new L("Invalid argument",Qz);case 2:if(this.connectionState!==Q.ABORTED){t.next=5;break}return t.next=5,new Promise((function(){}));case 5:if(this.connectionState===Q.CONNECTED||this.connectionState===Q.RECONNECTING){t.next=7;break}throw new H("The client is not logged in",Tz);case 7:if(void 0!==this.session){t.next=9;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return t.prev=9,n=this.context.token,this.context.token=e,t.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(rd((function(){return Error("No available edge address to connect")})),ae((function(t){return t.pipe(Y((function(t){if(wa(t))throw t})),Wc(1500),Pa(4))})),Pa(1),Za(1e4),Ga((function(t){return Na(t)&&o.warn("renewToken timed out"),ba(t)}))).toPromise();case 14:r=t.sent,i=r.ticket,t.next=27;break;case 18:if(t.prev=18,t.t0=t.catch(9),this.context.token=n,t.t0.code!==zq&&t.t0.code!==Aq){t.next=23;break}throw new Ke("Invalid token",Sz);case 23:if(t.t0.code!==uh){t.next=25;break}throw new Ke("The token expired",Rz);case 25:if(!Na(t.t0)){t.next=27;break}throw new bb("Renew token timed out",Pz);case 27:this.session.curLoginSockets.filter((function(t){return void 0!==t})).forEach((function(t){return t.ticket=i}));case 28:case"end":return t.stop()}}),t,this,[[9,18]])})));return function(e){return t.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var t=K(w.mark((function t(e){var n,r,i=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Oz);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(e)||0===e.length||e.some((function(t){return!ua(t)}))||256<e.length)){t.next=6;break}throw new L("invalid arguments",Eq);case 6:return t.next=8,this.session.requestPeersOnlineStatus(e).toPromise();case 8:return n=t.sent,r=oc(sk(n.userInfos,"account"),(function(t){return!!t.ts})),Object.keys(r).forEach((function(t){if(t in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[t]!==S.PeerOnlineState.UNREACHABLE){var e=r[t]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",m({},t,e)),i.subscribedPeerStatusCache[t]=e}})),t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",zz);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&e.every((function(t){return"string"==typeof t}))&&0!==e.length){t.next=6;break}throw new L("Invalid arguments: channelIds",nq);case 6:if(!(32<e.length)){t.next=8;break}throw new L("getChannelMemberCount exceed limit of 32 channelIds",yz);case 8:n=0;case 9:if(!(n<e.length)){t.next=16;break}if(ua(r=e[n])){t.next=13;break}throw new L(["getChannelMemberCount channel id %s is invalid",r],nq);case 13:n++,t.next=9;break;case 16:return t.next=18,this.session.requestGetChannelMemberCount(e).toPromise();case 18:for(i=t.sent,o=i.groupInfos,a={},s=function(t){var e=(t=o[t]).group,n=t.memberCount;ua(e)&&"number"==typeof n&&(u.session.joinedChannels.forEach((function(t){t.channelId===e&&t.onMemberCountUpdated(n)})),a[e]=n)},c=0;c<o.length;c++)s(c);return t.abrupt("return",a);case 24:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var t=K(w.mark((function t(e){var n,r;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ff({attributes:e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Q.CONNECTED){t.next=3;break}throw new H("The client is not logged in",Qb);case 3:if(void 0!==this.session){t.next=5;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(e).toPromise(),r={attribute:e,promise:n},this.attributeDrafts.add(r),t.prev=8,t.next=11,n;case 11:this.attributes=e,t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(8),!wa(t.t0)){t.next=18;break}throw t.t0;case 18:throw new L("arguments is not valid",Fa);case 19:return t.prev=19,this.attributeDrafts.delete(r),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[8,14,19,22]])})));return function(e){return t.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=2<c.length&&void 0!==c[2]?c[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,ff({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Q.CONNECTED){t.next=4;break}throw new H("The client is not logged in",Qb);case 4:if(void 0!==this.session){t.next=6;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return a=this.session.requestSetChannelAttributes(e,n,o).toPromise(),t.prev=7,t.next=10,a;case 10:s=oc(n,(function(t){return new Blob([t]).size})),this.channelAttributesCacheLru.set(e,s),t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(7),!wa(t.t0)){t.next=18;break}throw t.t0;case 18:throw new L("arguments is not valid",Fa);case 19:case"end":return t.stop()}}),t,this,[[7,14]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var t=K(w.mark((function t(e){var n,r,i;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ja(Ja({},this.attributes),e),ff({attributes:e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ff({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Q.CONNECTED){t.next=5;break}throw new H("The client is not logged in",Qb);case 5:if(void 0!==this.session){t.next=7;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(e).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),t.prev=10,t.next=13,r;case 13:this.attributes=n,t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(10),!wa(t.t0)){t.next=20;break}throw t.t0;case 20:throw new L("arguments is not valid",Eq);case 21:return t.prev=21,this.attributeDrafts.delete(i),t.finish(21);case 24:case"end":return t.stop()}}),t,this,[[10,16,21,24]])})));return function(e){return t.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,a=this.channelAttributesCacheLru.get(e,{}),s=oc(n,(function(t){return new Blob([t]).size})),c=Ja(Ja({},a),s),ff({attributes:n,attrSizeMap:c,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Q.CONNECTED){t.next=7;break}throw new H("The client is not logged in",Qb);case 7:if(void 0!==this.session){t.next=9;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return u=this.session.requestAddOrUpdateChannelAttributes(e,n,o).toPromise(),t.prev=10,t.next=13,u;case 13:this.channelAttributesCacheLru.set(e,c),t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(10),!wa(t.t0)){t.next=20;break}throw t.t0;case 20:throw new L("arguments is not valid",Fa);case 21:case"end":return t.stop()}}),t,this,[[10,16]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var t=K(w.mark((function t(e){var n,r,i,o;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&0!==e.length&&!e.some((function(t){return 0===t.length}))){t.next=2;break}throw new H("arguments is not valid",Fa);case 2:if(this.connectionState===Q.CONNECTED){t.next=4;break}throw new H("The client is not logged in",Qb);case 4:if(void 0!==this.session){t.next=6;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(e).toPromise(),r={attribute:rg(this.attributes,e),promise:n},this.attributeDrafts.add(r),t.prev=9,t.next=12,n;case 12:for(i=0;i<e.length;i++)o=e[i],delete this.attributes[o];t.next=20;break;case 15:if(t.prev=15,t.t0=t.catch(9),!wa(t.t0)){t.next=19;break}throw t.t0;case 19:throw new L("arguments is not valid",Fa);case 20:return t.prev=20,this.attributeDrafts.delete(r),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[9,15,20,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,Array.isArray(n)&&0!==n.length&&ua(e)&&!n.some((function(t){return 0===t.length||512<t.length}))){t.next=3;break}throw new H("arguments is not valid",Fa);case 3:if(this.connectionState===Q.CONNECTED){t.next=5;break}throw new H("The client is not logged in",Qb);case 5:if(void 0!==this.session){t.next=7;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a=this.session.requestDeleteChannelAttributesByKeys(e,n,o).toPromise(),t.prev=8,t.next=11,a;case 11:if(s=this.channelAttributesCacheLru.get(e))for(c=0;c<n.length;c++)u=n[c],delete s[u];t.next=20;break;case 15:if(t.prev=15,t.t0=t.catch(8),!wa(t.t0)){t.next=19;break}throw t.t0;case 19:throw new L("arguments is not valid",Fa);case 20:case"end":return t.stop()}}),t,this,[[8,15]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var t=K(w.mark((function t(){var e,n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Qb);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:e},this.attributeDrafts.add(n),t.prev=7,t.next=10,e;case 10:this.attributes={},t.next=18;break;case 13:if(t.prev=13,t.t0=t.catch(7),!wa(t.t0)){t.next=17;break}throw t.t0;case 17:throw new L("arguments is not valid",Fa);case 18:return t.prev=18,this.attributeDrafts.delete(n),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[7,13,18,21]])})));return function(){return t.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<a.length&&void 0!==a[1]?a[1]:{},r=n.enableNotificationToChannelMembers,i=void 0!==r&&r,this.connectionState===Q.CONNECTED){t.next=3;break}throw new H("The client is not logged in",Qb);case 3:if(void 0!==this.session){t.next=5;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return o=this.session.requestClearChannelAttributes(e,i).toPromise(),t.prev=6,t.next=9,o;case 9:this.channelAttributesCacheLru.delete(e),t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(6),!wa(t.t0)){t.next=16;break}throw t.t0;case 16:throw new L("arguments is not valid",Fa);case 17:case"end":return t.stop()}}),t,this,[[6,12]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var t=K(w.mark((function t(e){var n,r,i;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ua(e)){t.next=2;break}throw new L("Not a valid user ID",Fa);case 2:if(this.connectionState===Q.CONNECTED){t.next=4;break}throw new H("The client is not logged in",Qb);case 4:if(void 0!==this.session){t.next=6;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return t.prev=6,t.next=9,this.session.requestGetUserAttributeKeys(e).toPromise();case 9:return n=t.sent,r=n.keys,t.next=13,this.session.requestGetUserAttributesByKeys(e,r.slice(0,512)).toPromise();case 13:i=t.sent,t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(6),!wa(t.t0)){t.next=20;break}throw t.t0;case 20:throw new L("arguments is not valid",Fa);case 21:return t.abrupt("return",yp(i.attributeInfos.map((function(t){return[t.key,t.value]}))));case 22:case"end":return t.stop()}}),t,this,[[6,16]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ua(e)){t.next=2;break}throw new L("Not a valid channel ID",Fa);case 2:if(this.connectionState===Q.CONNECTED){t.next=4;break}throw new H("The client is not logged in",Qb);case 4:if(void 0!==this.session){t.next=6;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return t.prev=6,t.next=9,this.session.requestGetChannelAttributesKeys(e).toPromise();case 9:return n=t.sent,r=n.keys,t.next=13,this.session.requestGetChannelAttributesByKeys(e,r).toPromise();case 13:i=t.sent,o=i.attributeMaps,t.next=22;break;case 17:if(t.prev=17,t.t0=t.catch(6),!wa(t.t0)){t.next=21;break}throw t.t0;case 21:throw new L("arguments is not valid",Fa);case 22:a={},s=0;case 24:if(!(s<o.length)){t.next=32;break}if(c=o[s],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&ua(h)){t.next=28;break}return t.abrupt("break",32);case 28:a[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 29:s++,t.next=24;break;case 32:return this.channelAttributesCacheLru.set(e,oc(a,(function(t){return new Blob([t.value]).size}))),t.abrupt("return",a);case 34:case"end":return t.stop()}}),t,this,[[6,17]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u,l,d,h;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Qb);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return lm(e,n),t.prev=5,t.next=8,this.session.requestGetChannelAttributesByKeys(e,n).toPromise();case 8:r=t.sent,i=r.attributeMaps,t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(5),!wa(t.t0)){t.next=16;break}throw t.t0;case 16:throw new L("arguments is not valid",Fa);case 17:o={},a=this.channelAttributesCacheLru.get(e,{}),s=0;case 20:if(!(s<i.length)){t.next=29;break}if(c=i[s],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&ua(h)){t.next=24;break}return t.abrupt("break",29);case 24:a[u]=new Blob([d]).size,o[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 26:s++,t.next=20;break;case 29:return this.channelAttributesCacheLru.set(e,a),t.abrupt("return",o);case 31:case"end":return t.stop()}}),t,this,[[5,12]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var t=K(w.mark((function t(e,n){var r;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Qb);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return lm(e,n),t.prev=5,t.next=8,this.session.requestGetUserAttributesByKeys(e,n).toPromise();case 8:r=t.sent,t.next=16;break;case 11:if(t.prev=11,t.t0=t.catch(5),!wa(t.t0)){t.next=15;break}throw t.t0;case 15:throw new L("arguments is not valid",Fa);case 16:return t.abrupt("return",yp(r.attributeInfos.map((function(t){return[t.key,t.value]}))));case 17:case"end":return t.stop()}}),t,this,[[5,11]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"login",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=lg(),o=e.token,e.token===this.context.appId&&(o=void 0),cb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:db(this.session&&this.session.startTime),index:{index1:e.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.config.enableLogUpload)},installId:Sf,lts:U.fromNumber(Date.now()),os:7,sid:Sa(i),token:o||"",userId:e.uid,ver:"1.4.2",buildno:801,subVersion:301,version:5},null===(n=this.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_DOMAIN[0],null===(r=this.context.areaConfig)||void 0===r?void 0:r.EVENT_REPORT_BACKUP_DOMAIN[0]),md(e)&&ua(e.uid)){t.next=6;break}throw new L("not a valid user id",th);case 6:if("string"!=typeof o||!o){t.next=10;break}this.context.token=o,t.next=12;break;case 10:if("string"==typeof o||null==o){t.next=12;break}throw new L('The "token" is not a valid string.',th);case 12:return a=Date.now(),this.context.sid=Sa(i),this.loginPromise=this.loginImpl({uid:e.uid,instanceId:i}),this.info("RTM Client logging in as ".concat(e.uid)),t.prev=16,t.next=19,this.loginPromise;case 19:t.next=26;break;case 21:throw t.prev=21,t.t0=t.catch(16),wa(t.t0)&&cb("Link",{ackedServerIp:"",destServerIp:"",ec:t.t0.code||1,sc:t.t0.serverCode,elapse:db(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-a,sid:Sa(i),userId:e.uid},null===(s=this.context.areaConfig)||void 0===s?void 0:s.EVENT_REPORT_DOMAIN[0],null===(c=this.context.areaConfig)||void 0===c?void 0:c.EVENT_REPORT_BACKUP_DOMAIN[0]),this.context.token=void 0,t.t0;case 26:return t.prev=26,this.loginPromise=void 0,t.finish(26);case 29:case"end":return t.stop()}}),t,this,[[16,21,26,29]])})));return function(e){return t.apply(this,arguments)}}()},{key:"logout",value:function(){var t=K(w.mark((function t(){var e,n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.loginPromise){t.next=3;break}return t.next=3,this.loginPromise;case 3:if(this.connectionState!==Q.DISCONNECTED){t.next=6;break}throw this.logError("Already in logout state"),new H("Logout failure. The client has already been logged out",Bq);case 6:if(this.connectionState!==Q.ABORTED){t.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGOUT),t.abrupt("return");case 10:if(void 0!==this.session){t.next=13;break}return this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGOUT),t.abrupt("return");case 13:return cb("Logout",{elapse:db(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Sa(this.session.instanceId),userId:this.context.uid},null===(e=this.context.areaConfig)||void 0===e?void 0:e.EVENT_REPORT_DOMAIN[0],null===(n=this.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_BACKUP_DOMAIN[0]),t.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGOUT),this.log("Log out success");case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var t,e,n=this;if(this.connectionState===Q.DISCONNECTED)throw this.logError("Already in logout state"),new H("Logout failure. The client has already been logged out",Bq);this.connectionState===Q.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(cb("Logout",{elapse:db(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Sa(this.session.instanceId),userId:this.context.uid},null===(t=this.context.areaConfig)||void 0===t?void 0:t.EVENT_REPORT_DOMAIN[0],null===(e=this.context.areaConfig)||void 0===e?void 0:e.EVENT_REPORT_BACKUP_DOMAIN[0]),this.session.logoutHandler().then((function(){n.log("Log out success")}))),this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var t=K(w.mark((function t(e,n){var r,i,o,a,s,c,u=this,l=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableOfflineMessaging,o=void 0!==i&&i,a=r.enableHistoricalMessaging,s=void 0!==a&&a,ym(e,ge),this.connectionState!==Q.RECONNECTING){t.next=5;break}return c=Date.now(),t.abrupt("return",new Promise((function(t,r){var i=function(){var i=K(w.mark((function i(){var l;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==u.session){i.next=2;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return l=Date.now()-c,i.prev=3,i.t0=t,i.next=7,pg({message:e,peerId:n,toPeer:!0,session:u.session,errorCodes:{NOT_LOGGED_IN:Jk,TOO_OFTEN:Dq},diff:l,logger:u.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Na(i.t2)&&r(new bb(Md(u.name,"sendMessageToPeer",1e4),Hk)),wa(i.t2)&&r(i.t2),r(new ca("Peer-to-peer message send failure",{code:Cq,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(a),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[3,11,16,19]])})));return function(){return i.apply(this,arguments)}}();u.internalEmitter.once("RECONNECTED",i);var a=setTimeout((function(){u.internalEmitter.off("RECONNECTED",i),r(new bb(Md(u.name,"sendMessageToPeer",1e4),Hk))}),9e3)})));case 5:if(this.connectionState===Q.CONNECTED){t.next=7;break}throw new H("Failed to send the peer-to-peer message. The client is not logged in",Jk);case 7:if(void 0!==this.session){t.next=9;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return t.prev=9,t.next=12,pg({message:e,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Jk,TOO_OFTEN:Dq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 12:return t.abrupt("return",t.sent);case 15:if(t.prev=15,t.t0=t.catch(9),!Na(t.t0)){t.next=19;break}throw new bb(Md(this.name,"sendMessageToPeer",1e4),Hk);case 19:if(!wa(t.t0)){t.next=21;break}throw t.t0;case 21:throw new ca("Peer-to-peer message send failure",{code:Cq,originalError:t.t0});case 22:case"end":return t.stop()}}),t,this,[[9,15]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"createChannel",value:function(t){var e=this;if(!ua(t))throw new L(["The %s in the arguments is invalid",Object.keys({channelId:t})[0]],wz);return new EC(t,(function(){return e.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(t){if(!ua(t))throw new L(["The %s in the arguments is invalid",Object.keys({calleeId:t})[0]],rc);return this.invitationManager.genLocalInvitation(t)}},{key:"subscribePeersOnlineStatus",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h,f,p,v=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Kk);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&0!==e.length){t.next=6;break}throw new L("Invalid arguments: peerIds",Vf);case 6:n=0;case 7:if(!(n<e.length)){t.next=14;break}if(ua(r=e[n])){t.next=11;break}throw new L(["subscribePeersOnlineStatus peer id %s is invalid",r],Vf);case 11:n++,t.next=7;break;case 14:if(!(512<(i=e&&e.length?fk(e):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){t.next=17;break}throw new gb("Subscribed peers overflows",Gq);case 17:return t.next=19,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 19:o=t.sent,a=o.errors,s=[],c=[],u=0;case 24:if(!(u<a.length)){t.next=32;break}if(l=a[u],d=l.code,"string"==typeof(h=l.account)){t.next=28;break}throw new ca("Returned account is invalid",Fq);case 28:0!==d&&s.push(h);case 29:u++,t.next=24;break;case 32:for(f=0;f<i.length;f++)p=i[f],s.includes(p)||(c.push(p),this.subscribedPeerStatusCache[p]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(Z((function(t){return oc(sk(t.userInfos,"account"),(function(t){return!!t.ts}))}))).subscribe((function(t){t=oc(t,(function(t,e){return t=t?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,v.subscribedPeerStatusCache[e]=t})),v.emit("PeersOnlineStatusChanged",t)})),0===s.length){t.next=36;break}throw new ca("Subscription failed",Fq);case 36:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Kk);case 2:if(void 0!==this.session){t.next=4;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&0!==e.length){t.next=6;break}throw new L("Invalid arguments: peerIds",Vf);case 6:n=0;case 7:if(!(n<e.length)){t.next=14;break}if(ua(r=e[n])){t.next=11;break}throw new L(["subscribePeersOnlineStatus peer id %s is invalid",r],Vf);case 11:n++,t.next=7;break;case 14:if(!(512<e.length)){t.next=16;break}throw new gb("Unsubscribed peers overflows",Gq);case 16:for(i=e&&e.length?fk(e):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)a=i[o],delete this.subscribedPeerStatusCache[a];case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var t=K(w.mark((function t(e){return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===Q.CONNECTED){t.next=2;break}throw new H("The client is not logged in",Kk);case 2:if(e!==S.PeerSubscriptionOption.ONLINE_STATUS){t.next=4;break}return t.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new L("Subscription option not supported",Vf);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createMessage",value:function(t){return"IMAGE"===t.messageType?Ja({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},t):"FILE"===t.messageType?Ja({fileName:"",description:"",thumbnail:new Blob,size:0},t):t}},{key:"downloadMedia",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h,f,p,v,m=this,g=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<g.length&&void 0!==g[1]?g[1]:{},"string"==typeof e){t.next=3;break}throw new L("invalid mediaId format",Lk);case 3:if(t.prev=3,r=e.split("z"),i=pa(r,3),o=i[0],a=i[1],s=i[2],c=o.slice(1,65),u=tC(c),l=parseInt(o.slice(65),10),d=parseInt(a,10),h=parseInt(s,10),!(Number.isNaN(l)||Number.isNaN(d)||Number.isNaN(h))){t.next=12;break}throw new L("Invalid mediaId content",Lk);case 12:t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(3),!wa(t.t0)){t.next=18;break}throw t.t0;case 18:throw new L("parse mediaId failure",{code:Lk,originalError:t.t0});case 19:if(this.connectionState===Q.CONNECTED){t.next=21;break}throw new H("The client is not logged in, cannot download",aA);case 21:if(void 0!==this.session){t.next=23;break}throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return f=this.mediaTaskManager.addDownloadTask({unit:d,zone:l,hashHexStr:c,size:h},(function(){if(void 0===m.session)throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});return m.session.requestFileDownloadIndexGet({hash:u,zone:l,unit:d,size:h}).toPromise()}),n),t.next=26,this.mediaTaskManager.waitMediaTask(f);case 26:return p=t.sent,v=p.payload,t.abrupt("return",v);case 29:case"end":return t.stop()}}),t,this,[[3,14]])})));return function(e){return t.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,E,_,S,T,C,x=this,R=arguments;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<R.length&&void 0!==R[1]?R[1]:{},r=2<R.length&&void 0!==R[2]?R[2]:{},md(n)){t.next=4;break}throw new L("Invalid params",jf);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,o=n.messageType,a=void 0===o?i?"IMAGE":"FILE":o,s=n.description,c=void 0===s?"":s,u=n.fileName,l=void 0===u?"":u,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof l&&(um(d)||void 0===d)&&um(e)){t.next=8;break}throw new L("Invalid message params type",jf);case 8:if(!i||"FILE"!==a){t.next=10;break}throw new L("Invalid message params, unexpected field in RtmFileMessage",jf);case 10:if(!(33554432<(h=e.size))){t.next=13;break}throw new gb("The payload size overflow 32 MB",Vz);case 13:return t.next=15,wi(e);case 15:return f=t.sent,t.next=18,sC(f);case 18:if(p=t.sent,this.connectionState===Q.CONNECTED){t.next=21;break}throw new H("The client is not logged in",Xz);case 21:if("IMAGE"!==a){t.next=29;break}return t.next=24,st(n,f);case 24:v=t.sent,m=v.height,g=v.width,A=v.thumbnailWidth,y=v.thumbnailHeight;case 29:return b=this.mediaTaskManager.addUploadTask({file:new Uint8Array(f),hash:p},(function(){if(void 0===x.session)throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});return x.session.fetchFileUploadIndexGet({hash:p,size:h})}),(function(t,e){if(void 0===x.session)throw new Ca({SESSION_NOT_FOUND:"Failed to get session of the client"});return x.session.requestFileUploadIndexSet({hash:p,unit:t,servers:e}).toPromise()}),r),t.next=32,this.mediaTaskManager.waitMediaTask(b);case 32:if(E=t.sent,_=E.zone,S=E.retUnit,"IMAGE"!==a){t.next=38;break}return T={height:m,width:g,fileName:l,size:h,description:c,thumbnail:d,messageType:a,thumbnailWidth:A,thumbnailHeight:y,mediaId:"0".concat(tr(p)).concat(_,"z").concat(S,"z").concat(h,"z").concat(m,"z").concat(g)},t.abrupt("return",T);case 38:return C={fileName:l,size:h,description:c,mediaId:"0".concat(tr(p)).concat(_,"z").concat(S,"z").concat(h),thumbnail:d,messageType:a},t.abrupt("return",C);case 40:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var t=K(w.mark((function t(e){var n,r,i,o,a=this;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,r=e.instanceId,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){t.next=4;break}throw new LB(["The frequency of login exceeded the limit of %d queries per second",2],Lz);case 4:if(this.connectionState===Q.DISCONNECTED){t.next=6;break}throw new H("The SDK is either logging in or has logged in the Agora RTM system",Jz);case 6:t.prev=6,this.context.uid=n,t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(6),new L(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],th);case 13:return this.onConnectionStateChanged(Q.CONNECTING,Cb.LOGIN),this.session=i=new Fr(this.context,new sr(this.context,this.logger,!1),r,this.logger),o=function(){a.connectionState===Q.CONNECTED&&(a.onConnectionStateChanged(Q.RECONNECTING,Cb.INTERRUPTED),a.session)&&a.session.once("userJoined",(function(){a.onConnectionStateChanged(Q.CONNECTED,Cb.LOGIN_SUCCESS)}))},i.on("connectionLost",o),i.on("tokenExpired",(function(){a.emit("TokenExpired")})),i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(t){a.emit("MessageFromPeer",{text:t.text,messageType:S.MessageType.TEXT},t.peerId,t.properties)})),this.session.on("peerMediaMessage",(function(t){var e=t.peerId,n=t.properties,r=t.messageType;t=t.details,"FILE"===r?a.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(na(t.media_size),10),description:na(t.media_description),fileName:na(t.media_filename),mediaId:na(t.media_id),thumbnail:new Blob([t.media_thumbnail])},e,n):"IMAGE"===r&&a.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(na(t.media_size),10),description:na(t.media_description),fileName:na(t.media_filename),mediaId:na(t.media_id),thumbnail:new Blob([t.media_thumbnail]),height:parseInt(na(t.media_height),10),width:parseInt(na(t.media_width),10),thumbnailHeight:parseInt(na(t.media_thumbnailheight),10),thumbnailWidth:parseInt(na(t.media_thumbnailwidth),10)},e,n)})),this.session.on("peerRawMessage",(function(t){a.emit("MessageFromPeer",{rawMessage:t.raw,description:t.desc,messageType:S.MessageType.RAW},t.peerId,t.properties)})),i.on("instanceChanged",(function(t){return r=t})),i.on("peerOnlineStatusChanged",(function(t){var e=t.instance.toString()+t.state,n=a.peerStatusSeqLru.get(e);!n||t.seq.greaterThan(n)?(a.peerStatusSeqLru.set(e,t.seq),t.state!==a.subscribedPeerStatusCache[t.peerId]?a.emit("PeersOnlineStatusChanged",m({},t.peerId,t.state)):a.log("peer status for %s not changed, previous %s",t.peerId,t.state),a.subscribedPeerStatusCache[t.peerId]=t.state,clearTimeout(a.peerUnreachableTimers[e]),t.state===S.PeerOnlineState.UNREACHABLE&&(a.peerUnreachableTimers[e]=setTimeout((function(){a.subscribedPeerStatusCache[t.peerId]===S.PeerOnlineState.UNREACHABLE&&(a.subscribedPeerStatusCache[t.peerId]=S.PeerOnlineState.ONLINE,a.emit("PeersOnlineStatusChanged",m({},t.peerId,S.PeerOnlineState.ONLINE)))}),3e4))):a.log("peerOnlineStatusChanged dedup for %s, %d",e,t.seq.toNumber())})),i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),i.on("channelAttributesUpdated",(function(t){var e=t.channelId;t=t.attributeMaps;for(var n={},r=0;r<t.length;r++){var i=t[r],o=i.key,s=i.ms,c=i.value;if(i=i.origin,"string"!=typeof o||!U.isLong(s)||"string"!=typeof c||!ua(i))break;n[o]=new Blob([c]).size}a.channelAttributesCacheLru.set(e,n)})),i.on("userJoined",(function(t){if(0!==Object.keys(a.attributes).length){if(void 0===a.session)return;a.session.requestSetLocalUserAttributes(a.attributes,t).toPromise()}if(0!==a.attributeDrafts.size)for(var e=function(e,n){var r=(e=n[e]).attribute;e.promise.then((function(){void 0!==a.session&&a.session.requestSetLocalUserAttributes(r,t).toPromise()}))},n=0,r=Array.from(a.attributeDrafts);n<r.length;n++)e(n,r);0!==Object.keys(a.subscribedPeerStatusCache).length&&i.requestSubscribePeersOnlineStatus(Object.keys(a.subscribedPeerStatusCache))})),this.lastLoginTime=Date.now(),t.prev=29,t.next=32,i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:i.connection.curOpenSockets.filter((function(t){return void 0!==t}))[0].ticket,instance:i.instanceId,isAreaCN:"CN"===this.context.area,loginOpt:i.userJoinOptions.toLong()}),t.next=44;break;case 35:if(t.prev=35,t.t1=t.catch(29),!Na(t.t1)){t.next=40;break}throw this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGIN_TIMEOUT),new bb(Md(this.name,"login",1e4),Kz);case 40:if(this.onConnectionStateChanged(Q.DISCONNECTED,Cb.LOGIN_FAILURE),!wa(t.t1)){t.next=43;break}throw t.t1;case 43:throw new ca("Login failure",{code:yq,originalError:t.t1});case 44:this.onConnectionStateChanged(Q.CONNECTED,Cb.LOGIN_SUCCESS);case 45:case"end":return t.stop()}}),t,this,[[6,10],[29,35]])})));return function(e){return t.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(t,e){var n,r,i=this;t===Q.RECONNECTING&&(this.reconnId+=1),cb("ConnectionStateChange",{elapse:db(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:Lr[t],oldState:Lr[this.connectionState],reason:FC[e],sid:Sa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null===(n=this.context.areaConfig)||void 0===n?void 0:n.EVENT_REPORT_DOMAIN[0],null===(r=this.context.areaConfig)||void 0===r?void 0:r.EVENT_REPORT_BACKUP_DOMAIN[0]),this.connectionState===Q.RECONNECTING&&t===Q.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Z((function(t){return oc(sk(t.userInfos,"account"),(function(t){return!!t.ts}))}))).subscribe((function(t){t=oc(t,(function(t,e){return t=t?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,i.subscribedPeerStatusCache[e]=t})),i.emit("PeersOnlineStatusChanged",t)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=t,t!==Q.ABORTED&&t!==Q.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",t),this.emit("ConnectionStateChanged",t,e)}}]),e}(vb()),C=Kr,da(C.prototype,"renewToken",[ia],Object.getOwnPropertyDescriptor(C.prototype,"renewToken"),C.prototype),da(C.prototype,"queryPeersOnlineStatus",[ia],Object.getOwnPropertyDescriptor(C.prototype,"queryPeersOnlineStatus"),C.prototype),da(C.prototype,"getChannelMemberCount",[ia],Object.getOwnPropertyDescriptor(C.prototype,"getChannelMemberCount"),C.prototype),da(C.prototype,"setLocalUserAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"setLocalUserAttributes"),C.prototype),da(C.prototype,"setChannelAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"setChannelAttributes"),C.prototype),da(C.prototype,"addOrUpdateLocalUserAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"addOrUpdateLocalUserAttributes"),C.prototype),da(C.prototype,"addOrUpdateChannelAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"addOrUpdateChannelAttributes"),C.prototype),da(C.prototype,"deleteLocalUserAttributesByKeys",[ia],Object.getOwnPropertyDescriptor(C.prototype,"deleteLocalUserAttributesByKeys"),C.prototype),da(C.prototype,"deleteChannelAttributesByKeys",[ia],Object.getOwnPropertyDescriptor(C.prototype,"deleteChannelAttributesByKeys"),C.prototype),da(C.prototype,"clearLocalUserAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"clearLocalUserAttributes"),C.prototype),da(C.prototype,"clearChannelAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"clearChannelAttributes"),C.prototype),da(C.prototype,"getUserAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"getUserAttributes"),C.prototype),da(C.prototype,"getChannelAttributes",[ia],Object.getOwnPropertyDescriptor(C.prototype,"getChannelAttributes"),C.prototype),da(C.prototype,"getChannelAttributesByKeys",[ia],Object.getOwnPropertyDescriptor(C.prototype,"getChannelAttributesByKeys"),C.prototype),da(C.prototype,"getUserAttributesByKeys",[ia],Object.getOwnPropertyDescriptor(C.prototype,"getUserAttributesByKeys"),C.prototype),da(C.prototype,"login",[ia],Object.getOwnPropertyDescriptor(C.prototype,"login"),C.prototype),da(C.prototype,"logout",[ia],Object.getOwnPropertyDescriptor(C.prototype,"logout"),C.prototype),da(C.prototype,"logoutSync",[ia],Object.getOwnPropertyDescriptor(C.prototype,"logoutSync"),C.prototype),da(C.prototype,"sendMessageToPeer",[ia],Object.getOwnPropertyDescriptor(C.prototype,"sendMessageToPeer"),C.prototype),da(C.prototype,"createChannel",[ia],Object.getOwnPropertyDescriptor(C.prototype,"createChannel"),C.prototype),da(C.prototype,"createLocalInvitation",[ia],Object.getOwnPropertyDescriptor(C.prototype,"createLocalInvitation"),C.prototype),da(C.prototype,"subscribePeersOnlineStatus",[ia],Object.getOwnPropertyDescriptor(C.prototype,"subscribePeersOnlineStatus"),C.prototype),da(C.prototype,"unsubscribePeersOnlineStatus",[ia],Object.getOwnPropertyDescriptor(C.prototype,"unsubscribePeersOnlineStatus"),C.prototype),da(C.prototype,"queryPeersBySubscriptionOption",[ia],Object.getOwnPropertyDescriptor(C.prototype,"queryPeersBySubscriptionOption"),C.prototype),da(C.prototype,"createMessage",[ia],Object.getOwnPropertyDescriptor(C.prototype,"createMessage"),C.prototype),da(C.prototype,"downloadMedia",[ia],Object.getOwnPropertyDescriptor(C.prototype,"downloadMedia"),C.prototype),da(C.prototype,"createMediaMessageByUploading",[ia],Object.getOwnPropertyDescriptor(C.prototype,"createMediaMessageByUploading"),C.prototype),C),Mr={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},Nd=Ja(Ja({createInstance:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e.enableLogUpload;n=void 0!==n&&n;var r=void 0===(e=e.logFilter)?Mr.LOG_FILTER_INFO:e;if(e=2<arguments.length?arguments[2]:void 0,!/^[\dA-Za-z]{32}$/.test(t))throw new L(["The %s in the arguments is invalid",Object.keys({appId:t})[0]],xz);var i={enableLogUpload:n,logFilter:r};if(null!=e){var o=fC(e);i._areaConfig=o}n=Sk=Ta.__global_unique_id__=(Ta.__global_unique_id__||0)+1,r=TB(i);var a=UB(i),s=VB(i),c=WB(n,i),u=nr(n,i),l=u("RTM:DEBUG","<Entry> ");return r("The Agora RTM Web SDK version is %s","1.4.2"),void 0!==e&&r("RTM areas are set to %s",e.join(", ")),l("Creating an RtmClient instance"),l('The Git commit ID is "'.concat("v1.4.2-0-gcddbca54",'"')),r("The process ID is %s",Sf),r("The build is %s","v1.4.2-0-gcddbca54"),l("NODE_ENV is %s","production"),new GC(t,{genLogger:u,genTracker:c,info:r,warn:a,logError:s,loggerId:n},i,(function(t){for(var e=0,n=Rk(t);e<n.length;e++){var r=n[e];try{var o=t[r];null!=o&&(i[r]=o)}catch(t){throw new L(["The %s in the arguments is invalid",r],void 0)}}}),o)},BUILD:"v1.4.2-0-gcddbca54",VERSION:"1.4.2",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:Sf,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},Mr),{},{setParameter:function(t,e){Object.keys(dd).includes(t)&&(dd[t]=e)},getParameter:function(t){return dd[t]}});return Nd})),"undefined"!=typeof window&&function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hls=e():t.Hls=e()}(this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),c=i?i+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},u.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},u.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;case 4:l[u].fn.call(l[u].context,e,n,r);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},u.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},u.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return c(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||c(this,o);else{for(var s=0,u=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&c(this,e)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,t.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){var r,i,o,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var r=s.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):e;var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var c=i.exec(a.path);a.netLoc=c[1],a.path=c[2]}a.netLoc&&!a.path&&(a.path="/");var u={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(u.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var l=a.path,d=l.substring(0,l.lastIndexOf("/")+1)+o.path;u.path=s.normalizePath(d)}else u.path=a.path,o.params||(u.params=a.params,o.query||(u.query=a.query));return null===u.path&&(u.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(u)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(o,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){function r(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,e,r){var s={};s[r]=[];var c=e.toString(),u=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return s;for(var l,d=u[1],h=new RegExp("(\\\\n|\\W)"+a(d)+o,"g");l=h.exec(c);)"dll-reference"!==l[3]&&s[r].push(l[3]);for(h=new RegExp("\\("+a(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");l=h.exec(c);)t[l[2]]||(s[r].push(l[1]),t[l[2]]=n(l[1]).m),s[l[2]]=s[l[2]]||[],s[l[2]].push(l[4]);for(var f,p=Object.keys(s),v=0;v<p.length;v++)for(var m=0;m<s[p[v]].length;m++)f=s[p[v]][m],isNaN(1*f)||(s[p[v]][m]=1*s[p[v]][m]);return s}function c(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var i={main:n.m},o=e.all?{main:Object.keys(i.main)}:function(t,e){for(var n={main:[e]},r={main:[]},i={main:{}};c(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var u=o[a],l=n[u].pop();if(i[u]=i[u]||{},!i[u][l]&&t[u][l]){i[u][l]=!0,r[u]=r[u]||[],r[u].push(l);for(var d=s(t,t[u][l],u),h=Object.keys(d),f=0;f<h.length;f++)n[h[f]]=n[h[f]]||[],n[h[f]]=n[h[f]].concat(d[h[f]])}}return r}(i,t),a="";Object.keys(o).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;o[t][e];)e++;o[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([a],{type:"text/javascript"});if(e.bare)return u;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),d=new window.Worker(l);return d.objectURL=l,d}},"./src/crypt/decrypter.js":
/*!********************************************!*\
  !*** ./src/crypt/decrypter.js + 3 modules ***!
  \********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(t,e,n){"use strict";n.r(e);var r=function(){function t(t,e){this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),i=function(){function t(t,e){this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();var o=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),n=new Uint32Array(4),r=0;r<4;r++)n[r]=e.getUint32(4*r);return n},e.initTable=function(){var t=this.sBox,e=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,c=s[0],u=s[1],l=s[2],d=s[3],h=new Uint32Array(256),f=0,p=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99,t[f]=m,e[m]=f;var g=h[f],A=h[g],y=h[A],b=257*h[m]^16843008*m;r[f]=b<<24|b>>>8,i[f]=b<<16|b>>>16,o[f]=b<<8|b>>>24,a[f]=b,b=16843009*y^65537*A^257*g^16843008*f,c[m]=b<<24|b>>>8,u[m]=b<<16|b>>>16,l[m]=b<<8|b>>>24,d[m]=b,f?(f=g^h[h[h[y^g]]],p^=h[h[p]]):f=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,r=0;r<e.length&&n;)n=e[r]===this.key[r],r++;if(!n){this.key=e;var i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,a,s,c,u=this.ksRows=4*(i+6+1),l=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,p=this.invSubMix,v=p[0],m=p[1],g=p[2],A=p[3];for(o=0;o<u;o++)o<i?s=l[o]=e[o]:(c=s,o%i==0?(c=h[(c=c<<8|c>>>24)>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c],c^=f[o/i|0]<<24):i>6&&o%i==4&&(c=h[c>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c]),l[o]=s=(l[o-i]^c)>>>0);for(a=0;a<u;a++)o=u-a,c=3&a?l[o]:l[o-4],d[a]=a<4||o<=4?c:v[h[c>>>24]]^m[h[c>>>16&255]]^g[h[c>>>8&255]]^A[h[255&c]],d[a]=d[a]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,n,r){for(var i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w=this.keySize+6,E=this.invKeySchedule,_=this.invSBox,S=this.invSubMix,T=S[0],C=S[1],x=S[2],R=S[3],I=this.uint8ArrayToUint32Array_(n),O=I[0],M=I[1],L=I[2],k=I[3],B=new Int32Array(t),N=new Int32Array(B.length),P=this.networkToHostOrderSwap;e<B.length;){for(h=P(B[e]),f=P(B[e+1]),p=P(B[e+2]),v=P(B[e+3]),c=h^E[0],u=v^E[1],l=p^E[2],d=f^E[3],m=4,g=1;g<w;g++)i=T[c>>>24]^C[u>>16&255]^x[l>>8&255]^R[255&d]^E[m],o=T[u>>>24]^C[l>>16&255]^x[d>>8&255]^R[255&c]^E[m+1],a=T[l>>>24]^C[d>>16&255]^x[c>>8&255]^R[255&u]^E[m+2],s=T[d>>>24]^C[c>>16&255]^x[u>>8&255]^R[255&l]^E[m+3],c=i,u=o,l=a,d=s,m+=4;i=_[c>>>24]<<24^_[u>>16&255]<<16^_[l>>8&255]<<8^_[255&d]^E[m],o=_[u>>>24]<<24^_[l>>16&255]<<16^_[d>>8&255]<<8^_[255&c]^E[m+1],a=_[l>>>24]<<24^_[d>>16&255]<<16^_[c>>8&255]<<8^_[255&u]^E[m+2],s=_[d>>>24]<<24^_[c>>16&255]<<16^_[u>>8&255]<<8^_[255&l]^E[m+3],m+=3,N[e]=P(i^O),N[e+1]=P(s^M),N[e+2]=P(a^L),N[e+3]=P(o^k),O=h,M=f,L=p,k=v,e+=4}return r?(A=N.buffer,y=A.byteLength,(b=y&&new DataView(A).getUint8(y-1))?A.slice(0,y-b):A):N.buffer},e.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),a=n("./src/errors.ts"),s=n("./src/utils/logger.js"),c=n("./src/events.js"),u=n("./src/utils/get-self-scope.js"),l=Object(u.getSelfScope)(),d=function(){function t(t,e,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=t,this.config=e,this.removePKCS7Padding=i,i)try{var o=l.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}var e=t.prototype;return e.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.decrypt=function(t,e,n,a){var c=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(s.logger.log("JS AES decrypt"),this.logEnabled=!1);var u=this.decryptor;u||(this.decryptor=u=new o),u.expandKey(e),a(u.decrypt(t,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(s.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new i(l,e)),this.fastAesKey.expandKey().then((function(i){new r(l,n).decrypt(t,i).catch((function(r){c.onWebCryptoError(r,t,e,n,a)})).then((function(t){a(t)}))})).catch((function(r){c.onWebCryptoError(r,t,e,n,a)}))}},e.onWebCryptoError=function(t,e,n,r,i){this.config.enableSoftwareAES?(s.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,n,r,i)):(s.logger.error("decrypting error : "+t.message),this.observer.trigger(c.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},e.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.default=d},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 12 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(t,e,n){"use strict";n.r(e);var r=n("./src/events.js"),i=n("./src/errors.ts"),o=n("./src/crypt/decrypter.js"),a=n("./src/polyfills/number.js"),s=n("./src/utils/logger.js"),c=n("./src/utils/get-self-scope.js");function u(t,e){return 255===t[e]&&240==(246&t[e+1])}function l(t,e){return 1&t[e+1]?7:9}function d(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function h(t,e){return!!(e+1<t.length&&u(t,e))}function f(t,e){if(h(t,e)){var n=l(t,e);if(e+n>=t.length)return!1;var r=d(t,e);if(r<=n)return!1;var i=e+r;if(i===t.length||i+1<t.length&&u(t,i))return!0}return!1}function p(t,e,n,o,a){if(!t.samplerate){var c=function(t,e,n,o){var a,c,u,l,d,h=navigator.userAgent.toLowerCase(),f=o,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(a=1+((192&e[n+2])>>>6),!((c=(60&e[n+2])>>>2)>p.length-1))return l=(1&e[n+2])<<2,l|=(192&e[n+3])>>>6,s.logger.log("manifest codec:"+o+",ADTS data:type:"+a+",sampleingIndex:"+c+"["+p[c]+"Hz],channelConfig:"+l),/firefox/i.test(h)?c>=6?(a=5,d=new Array(4),u=c-3):(a=2,d=new Array(2),u=c):-1!==h.indexOf("android")?(a=2,d=new Array(2),u=c):(a=5,d=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&c>=6?u=c-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(c>=6&&1===l||/vivaldi/i.test(h))||!o&&1===l)&&(a=2,d=new Array(2)),u=c)),d[0]=a<<3,d[0]|=(14&c)>>1,d[1]|=(1&c)<<7,d[1]|=l<<3,5===a&&(d[1]|=(14&u)>>1,d[2]=(1&u)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:p[c],channelCount:l,codec:"mp4a.40."+a,manifestCodec:f};t.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+c})}(e,n,o,a);t.config=c.config,t.samplerate=c.samplerate,t.channelCount=c.channelCount,t.codec=c.codec,t.manifestCodec=c.manifestCodec,s.logger.log("parsed codec:"+t.codec+",rate:"+c.samplerate+",nb channel:"+c.channelCount)}}function v(t){return 9216e4/t}function m(t,e,n,r,i){var o=function(t,e,n,r,i){var o,a,s=t.length;if(o=l(t,e),a=d(t,e),(a-=o)>0&&e+o+a<=s)return{headerLength:o,frameLength:a,stamp:n+r*i}}(e,n,r,i,v(t.samplerate));if(o){var a=o.stamp,s=o.headerLength,c=o.frameLength,u={unit:e.subarray(n+s,n+s+c),pts:a,dts:a};return t.samples.push(u),{sample:u,length:c+s}}}var g=n("./src/demux/id3.js"),A=function(){function t(t,e,n){this.observer=t,this.config=n,this.remuxer=e}var e=t.prototype;return e.resetInitSegment=function(t,e,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:r,inputTimeScale:9e4}},e.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=(g.default.getID3Data(t,0)||[]).length,n=t.length;e<n;e++)if(f(t,e))return s.logger.log("ADTS sync word found !"),!0;return!1},e.append=function(t,e,n,r){for(var i=this._audioTrack,o=g.default.getID3Data(t,0)||[],c=g.default.getTimeStamp(o),u=Object(a.isFiniteNumber)(c)?90*c:9e4*e,l=0,d=u,f=t.length,v=o.length,A=[{pts:d,dts:d,data:o}];v<f-1;)if(h(t,v)&&v+5<f){p(i,this.observer,t,v,i.manifestCodec);var y=m(i,t,v,u,l);if(!y){s.logger.log("Unable to parse AAC frame");break}v+=y.length,d=y.sample.pts,l++}else g.default.isHeader(t,v)?(o=g.default.getID3Data(t,v),A.push({pts:d,dts:d,data:o}),v+=o.length):v++;this.remuxer.remux(i,{samples:[]},{samples:A,inputTimeScale:9e4},{samples:[]},e,n,r)},e.destroy=function(){},t}(),y=n("./src/demux/mp4demuxer.js"),b={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,n,r,i){if(!(n+24>e.length)){var o=this.parseHeader(e,n);if(o&&n+o.frameLength<=e.length){var a=r+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:e.subarray(n,n+o.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=o.channelCount,t.samplerate=o.sampleRate,t.samples.push(s),{sample:s,length:o.frameLength}}}},parseHeader:function(t,e){var n=t[e+1]>>3&3,r=t[e+1]>>1&3,i=t[e+2]>>4&15,o=t[e+2]>>2&3,a=t[e+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==o){var s=3===n?3-r:3===r?3:4,c=1e3*b.BitratesMap[14*s+i-1],u=3===n?0:2===n?1:2,l=b.SamplingRateMap[3*u+o],d=t[e+3]>>6==3?1:2,h=b.SamplesCoefficients[n][r],f=b.BytesInSlot[r],p=8*h*f;return{sampleRate:l,channelCount:d,frameLength:parseInt(h*c/l+a,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var n=this.parseHeader(t,e),r=4;n&&n.frameLength&&(r=n.frameLength);var i=e+r;if(i===t.length||i+1<t.length&&this.isHeaderPattern(t,i))return!0}return!1}},w=b,E=function(){function t(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,r=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");r.set(t.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;return t>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?n<<e|this.readBits(e):n},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){var e,n=8,r=8;for(e=0;e<t;e++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},e.readSPS=function(){var t,e,n,r,i,o,a,s=0,c=0,u=0,l=0,d=this.readUByte.bind(this),h=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),v=this.skipBits.bind(this),m=this.skipEG.bind(this),g=this.skipUEG.bind(this),A=this.skipScalingList.bind(this);if(d(),t=d(),h(5),v(3),d(),g(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var y=f();if(3===y&&v(1),g(),g(),v(1),p())for(o=3!==y?8:12,a=0;a<o;a++)p()&&A(a<6?16:64)}g();var b=f();if(0===b)f();else if(1===b)for(v(1),m(),m(),e=f(),a=0;a<e;a++)m();g(),v(1),n=f(),r=f(),0===(i=h(1))&&v(1),v(1),p()&&(s=f(),c=f(),u=f(),l=f());var w=[1,1];if(p()&&p())switch(d()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:w=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(n+1)-2*s-2*c),height:(2-i)*(r+1)*16-(i?2:4)*(u+l),pixelRatio:w}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),_=function(){function t(t,e,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new o.default(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},e.decryptAacSample=function(t,e,n,r){var i=t[e].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,(function(o){o=new Uint8Array(o),i.set(o,16),r||s.decryptAacSamples(t,e+1,n)}))},e.decryptAacSamples=function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,e,n,r),!r)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),r=0,i=32;i<=t.length-16;i+=160,r+=16)n.set(t.subarray(i,i+16),r);return n},e.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var n=0,r=32;r<=t.length-16;r+=160,n+=16)t.set(e.subarray(n,n+16),r);return t},e.decryptAvcSample=function(t,e,n,r,i,o){var a=this.discardEPB(i.data),s=this.getAvcEncryptedData(a),c=this;this.decryptBuffer(s.buffer,(function(s){i.data=c.getAvcDecryptedUnit(a,s),o||c.decryptAvcSamples(t,e,n+1,r)}))},e.decryptAvcSamples=function(t,e,n,r){for(;;e++,n=0){if(e>=t.length)return void r();for(var i=t[e].units;!(n>=i.length);n++){var o=i[n];if(!(o.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,n,r,o,a),!a)return}}}},t}(),S={video:1,audio:2,id3:3,text:4},T=function(){function t(t,e,n,r){this.observer=t,this.config=n,this.typeSupported=r,this.remuxer=e,this.sampleAes=null,this.pmtUnknownTypes={}}var e=t.prototype;return e.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new _(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var n=t._syncOffset(e);return!(n<0)&&(n&&s.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),n=0;n<e;){if(71===t[n]&&71===t[n+188]&&71===t[n+376])return n;n++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:S[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},e.resetInitSegment=function(e,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=t.createTrack("video",i),this._audioTrack=t.createTrack("audio",i),this._id3Track=t.createTrack("id3",i),this._txtTrack=t.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},e.resetTimeStamp=function(){},e.append=function(e,n,o,a){var c,u,l,d,h,f=e.length,p=!1;this.pmtUnknownTypes={},this.contiguous=o;var v=this.pmtParsed,m=this._avcTrack,g=this._audioTrack,A=this._id3Track,y=m.pid,b=g.pid,w=A.pid,E=this._pmtId,_=m.pesData,S=g.pesData,T=A.pesData,C=this._parsePAT,x=this._parsePMT.bind(this),R=this._parsePES,I=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),M=this._parseMPEGPES.bind(this),L=this._parseID3PES.bind(this),k=t._syncOffset(e);for(f-=(f+k)%188,c=k;c<f;c+=188)if(71===e[c]){if(u=!!(64&e[c+1]),l=((31&e[c+1])<<8)+e[c+2],(48&e[c+3])>>4>1){if((d=c+5+e[c+4])===c+188)continue}else d=c+4;switch(l){case y:u&&(_&&(h=R(_))&&I(h,!1),_={data:[],size:0}),_&&(_.data.push(e.subarray(d,c+188)),_.size+=c+188-d);break;case b:u&&(S&&(h=R(S))&&(g.isAAC?O(h):M(h)),S={data:[],size:0}),S&&(S.data.push(e.subarray(d,c+188)),S.size+=c+188-d);break;case w:u&&(T&&(h=R(T))&&L(h),T={data:[],size:0}),T&&(T.data.push(e.subarray(d,c+188)),T.size+=c+188-d);break;case 0:u&&(d+=e[d]+1),E=this._pmtId=C(e,d);break;case E:u&&(d+=e[d]+1);var B=x(e,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(y=B.avc)>0&&(m.pid=y),(b=B.audio)>0&&(g.pid=b,g.isAAC=B.isAAC),(w=B.id3)>0&&(A.pid=w),p&&!v&&(s.logger.log("reparse from beginning"),p=!1,c=k-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});_&&(h=R(_))?(I(h,!0),m.pesData=null):m.pesData=_,S&&(h=R(S))?(g.isAAC?O(h):M(h),g.pesData=null):(S&&S.size&&s.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=S),T&&(h=R(T))?(L(h),A.pesData=null):A.pesData=T,null==this.sampleAes?this.remuxer.remux(g,m,A,this._txtTrack,n,o,a):this.decryptAndRemux(g,m,A,this._txtTrack,n,o,a)},e.decryptAndRemux=function(t,e,n,r,i,o,a){if(t.samples&&t.isAAC){var s=this;this.sampleAes.decryptAacSamples(t.samples,0,(function(){s.decryptAndRemuxAvc(t,e,n,r,i,o,a)}))}else this.decryptAndRemuxAvc(t,e,n,r,i,o,a)},e.decryptAndRemuxAvc=function(t,e,n,r,i,o,a){if(e.samples){var s=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,(function(){s.remuxer.remux(t,e,n,r,i,o,a)}))}else this.remuxer.remux(t,e,n,r,i,o,a)},e.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},e._trackUnknownPmt=function(t,e,n){var r=this.pmtUnknownTypes[t]||0;return 0===r&&(this.pmtUnknownTypes[t]=0,e.call(s.logger,n)),this.pmtUnknownTypes[t]++,r},e._parsePMT=function(t,e,n,r){var i,o,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<i;){switch(o=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!r){this._trackUnknownPmt(t[e],s.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!r){this._trackUnknownPmt(t[e],s.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:n?-1===a.audio&&(a.audio=o,a.isAAC=!1):this._trackUnknownPmt(t[e],s.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(t[e],s.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(t[e],s.logger.log,"Unknown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return a},e._parsePES=function(t){var e,n,r,i,o,a,c,u,l=0,d=t.data;if(!t||0===t.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(1===((e=d[0])[0]<<16)+(e[1]<<8)+e[2]){if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;if(192&(n=e[7])&&(a=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&n?a-(c=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(s.logger.warn(Math.round((a-c)/9e4)+"s delta between PTS and DTS, align them"),a=c):c=a),u=(i=e[8])+9,t.size<=u)return null;t.size-=u,o=new Uint8Array(t.size);for(var f=0,p=d.length;f<p;f++){var v=(e=d[f]).byteLength;if(u){if(u>v){u-=v;continue}e=e.subarray(u),v-=u,u=0}o.set(e,l),l+=v}return r&&(r-=i+3),{data:o,pts:a,dts:c,len:r}}return null},e.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var n=e.samples,r=n.length;if(isNaN(t.pts)){if(!r)return void e.dropped++;var i=n[r-1];t.pts=i.pts,t.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(r||this.contiguous)?(t.id=r,n.push(t)):e.dropped++}t.debug.length&&s.logger.log(t.pts+"/"+t.dts+":"+t.debug)},e._parseAVCPES=function(t,e){var n,r,i,o=this,a=this._avcTrack,s=this._parseAVCNALu(t.data),c=this.avcSample,u=!1,l=this.pushAccesUnit.bind(this),d=function(t,e,n,r){return{key:t,pts:e,dts:n,units:[],debug:r}};t.data=null,c&&s.length&&!a.audFound&&(l(c,a),c=this.avcSample=d(!1,t.pts,t.dts,"")),s.forEach((function(e){switch(e.type){case 1:r=!0,c||(c=o.avcSample=d(!0,t.pts,t.dts,"")),c.frame=!0;var s=e.data;if(u&&s.length>4){var h=new E(s).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(c.key=!0)}break;case 5:r=!0,c||(c=o.avcSample=d(!0,t.pts,t.dts,"")),c.key=!0,c.frame=!0;break;case 6:r=!0,(n=new E(o.discardEPB(e.data))).readUByte();for(var f=0,p=0,v=!1,m=0;!v&&n.bytesAvailable>1;){f=0;do{f+=m=n.readUByte()}while(255===m);p=0;do{p+=m=n.readUByte()}while(255===m);if(4===f&&0!==n.bytesAvailable){if(v=!0,181===n.readUByte())if(49===n.readUShort())if(1195456820===n.readUInt())if(3===n.readUByte()){var A=n.readUByte(),y=31&A,b=[A,n.readUByte()];for(i=0;i<y;i++)b.push(n.readUByte()),b.push(n.readUByte()),b.push(n.readUByte());o._insertSampleInOrder(o._txtTrack.samples,{type:3,pts:t.pts,bytes:b})}}else if(5===f&&0!==n.bytesAvailable){if(v=!0,p>16){var w=[];for(i=0;i<16;i++)w.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||w.push("-");var _=p-16,S=new Uint8Array(_);for(i=0;i<_;i++)S[i]=n.readUByte();o._insertSampleInOrder(o._txtTrack.samples,{pts:t.pts,payloadType:f,uuid:w.join(""),userDataBytes:S,userData:Object(g.utf8ArrayToStr)(S.buffer)})}}else if(p<n.bytesAvailable)for(i=0;i<p;i++)n.readUByte()}break;case 7:if(r=!0,u=!0,!a.sps){var T=(n=new E(e.data)).readSPS();a.width=T.width,a.height=T.height,a.pixelRatio=T.pixelRatio,a.sps=[e.data],a.duration=o._duration;var C=e.data.subarray(1,4),x="avc1.";for(i=0;i<3;i++){var R=C[i].toString(16);R.length<2&&(R="0"+R),x+=R}a.codec=x}break;case 8:r=!0,a.pps||(a.pps=[e.data]);break;case 9:r=!1,a.audFound=!0,c&&l(c,a),c=o.avcSample=d(!1,t.pts,t.dts,"");break;case 12:r=!1;break;default:r=!1,c&&(c.debug+="unknown NAL "+e.type+" ")}c&&r&&c.units.push(e)})),e&&c&&(l(c,a),this.avcSample=null)},e._insertSampleInOrder=function(t,e){var n=t.length;if(n>0){if(e.pts>=t[n-1].pts)t.push(e);else for(var r=n-1;r>=0;r--)if(e.pts<t[r].pts){t.splice(r,0,e);break}}else t.push(e)},e._getLastNalUnit=function(){var t,e=this.avcSample;if(!e||0===e.units.length){var n=this._avcTrack.samples;e=n[n.length-1]}if(e){var r=e.units;t=r[r.length-1]}return t},e._parseAVCNALu=function(t){var e,n,r,i,o=0,a=t.byteLength,s=this._avcTrack,c=s.naluState||0,u=c,l=[],d=-1;for(-1===c&&(d=0,i=31&t[0],c=0,o=1);o<a;)if(e=t[o++],c)if(1!==c)if(e)if(1===e){if(d>=0)r={data:t.subarray(d,o-c-1),type:i},l.push(r);else{var h=this._getLastNalUnit();if(h&&(u&&o<=4-u&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-u)),(n=o-c-1)>0)){var f=new Uint8Array(h.data.byteLength+n);f.set(h.data,0),f.set(t.subarray(0,n),h.data.byteLength),h.data=f}}o<a?(d=o,i=31&t[o],c=0):c=-1}else c=0;else c=3;else c=e?0:2;else c=e?0:1;if(d>=0&&c>=0&&(r={data:t.subarray(d,a),type:i,state:c},l.push(r)),0===l.length){var p=this._getLastNalUnit();if(p){var v=new Uint8Array(p.data.byteLength+t.byteLength);v.set(p.data,0),v.set(t,p.data.byteLength),p.data=v}}return s.naluState=c,l},e.discardEPB=function(t){for(var e,n,r=t.byteLength,i=[],o=1;o<r-2;)0===t[o]&&0===t[o+1]&&3===t[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return t;e=r-i.length,n=new Uint8Array(e);var a=0;for(o=0;o<e;a++,o++)a===i[0]&&(a++,i.shift()),n[o]=t[a];return n},e._parseAACPES=function(t){var e,n,o,a,c,u,l,d=this._audioTrack,f=t.data,g=t.pts,A=this.aacOverFlow,y=this.aacLastPTS;if(A){var b=new Uint8Array(A.byteLength+f.byteLength);b.set(A,0),b.set(f,A.byteLength),f=b}for(o=0,c=f.length;o<c-1&&!h(f,o);o++);if(o&&(o<c-1?(u="AAC PES did not start with ADTS header,offset:"+o,l=!1):(u="no ADTS header found in AAC PES",l=!0),s.logger.warn("parsing error:"+u),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:l,reason:u}),l))return;if(p(d,this.observer,f,o,this.audioCodec),n=0,e=v(d.samplerate),A&&y){var w=y+e;Math.abs(w-g)>1&&(s.logger.log("AAC: align PTS for overlapping frames by "+Math.round((w-g)/90)),g=w)}for(;o<c;){if(h(f,o)){if(o+5<c){var E=m(d,f,o,g,n);if(E){o+=E.length,a=E.sample.pts,n++;continue}}break}o++}A=o<c?f.subarray(o,c):null,this.aacOverFlow=A,this.aacLastPTS=a},e._parseMPEGPES=function(t){for(var e=t.data,n=e.length,r=0,i=0,o=t.pts;i<n;)if(w.isHeader(e,i)){var a=w.appendFrame(this._audioTrack,e,i,o,r);if(!a)break;i+=a.length,r++}else i++},e._parseID3PES=function(t){this._id3Track.samples.push(t)},t}(),C=function(){function t(t,e,n){this.observer=t,this.config=n,this.remuxer=e}var e=t.prototype;return e.resetInitSegment=function(t,e,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:r,inputTimeScale:9e4}},e.resetTimeStamp=function(){},t.probe=function(t){var e,n,r=g.default.getID3Data(t,0);if(r&&void 0!==g.default.getTimeStamp(r))for(e=r.length,n=Math.min(t.length-1,e+100);e<n;e++)if(w.probe(t,e))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},e.append=function(t,e,n,r){for(var i=g.default.getID3Data(t,0)||[],o=g.default.getTimeStamp(i),a=void 0!==o?90*o:9e4*e,s=i.length,c=t.length,u=0,l=0,d=this._audioTrack,h=[{pts:a,dts:a,data:i}];s<c;)if(w.isHeader(t,s)){var f=w.appendFrame(d,t,s,a,u);if(!f)break;s+=f.length,l=f.sample.pts,u++}else g.default.isHeader(t,s)?(i=g.default.getID3Data(t,s),h.push({pts:l,dts:l,data:i}),s+=i.length):s++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},e,n,r)},e.destroy=function(){},t}(),x=function(){function t(){}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),R=Math.pow(2,32)-1,I=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=o,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,c,a,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,i))},t.box=function(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,o=i;i--;)r+=n[i].byteLength;for((e=new Uint8Array(r))[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=255&r,e.set(t,4),i=0,r=8;i<o;i++)e.set(n[i],r),r+=n[i].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,n){n*=e;var r=Math.floor(n/(R+1)),i=Math.floor(n%(R+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))},t.moov=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))},t.mvex=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))},t.mvhd=function(e,n){n*=e;var r=Math.floor(n/(R+1)),i=Math.floor(n%(R+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(e){var n,r,i=e.samples||[],o=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,o)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var n,r,i,o=[],a=[];for(n=0;n<e.sps.length;n++)i=(r=e.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)i=(r=e.pps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=t.box(t.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|e.sps.length].concat(o).concat([e.pps.length]).concat(a))),c=e.width,u=e.height,l=e.pixelRatio[0],d=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,d>>24,d>>16&255,d>>8&255,255&d])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var n=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var n=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var n=e.id,r=e.duration*e.timescale,i=e.width,o=e.height,a=Math.floor(r/(R+1)),s=Math.floor(r%(R+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))},t.traf=function(e,n){var r=t.sdtp(e),i=e.id,o=Math.floor(n/(R+1)),a=Math.floor(n%(R+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(e,r.length+16+20+8+16+8+8),r)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,n){var r,i,o,a,s,c,u=e.samples||[],l=u.length,d=12+16*l,h=new Uint8Array(d);for(n+=8+d,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<l;r++)o=(i=u[r]).duration,a=i.size,s=i.flags,c=i.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*r);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var n,r=t.moov(e);return(n=new Uint8Array(t.FTYP.byteLength+r.byteLength)).set(t.FTYP),n.set(r,t.FTYP.byteLength),n},t}();function O(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=t*e*n;return r?Math.round(i):i}function M(t,e){return void 0===e&&(e=!1),O(t,1e3,1/9e4,e)}function L(t,e){return void 0===e&&(e=1),O(t,9e4,1/e)}var k=L(10),B=L(.2),N=null;function P(t,e){var n;if(void 0===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}var U,D=function(){function t(t,e,n,r){if(this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===N){var i=navigator.userAgent.match(/Chrome\/(\d+)/i);N=i?parseInt(i[1]):0}}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},e.resetInitSegment=function(){this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,n=t.reduce((function(t,n){var r=n.pts-t;return r<-4294967296?(e=!0,t):r>0?t:n.pts}),t[0].pts);return e&&s.logger.debug("PTS rollover detected"),n},e.remux=function(t,e,n,i,o,a,c){if(this.ISGenerated||this.generateIS(t,e,o),this.ISGenerated){var u=t.samples.length,l=e.samples.length,d=o,h=o;if(u&&l){var f=this.getVideoStartPts(e.samples),p=(t.samples[0].pts-f)/e.inputTimeScale;d+=Math.max(0,p),h+=Math.max(0,-p)}if(u){t.timescale||(s.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,o));var v,m=this.remuxAudio(t,d,a,c);if(l)m&&(v=m.endPTS-m.startPTS),e.timescale||(s.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,o)),this.remuxVideo(e,h,a,v)}else if(l){var g=this.remuxVideo(e,h,a,0,c);g&&t.codec&&this.remuxEmptyAudio(t,d,a,g)}}n.samples.length&&this.remuxID3(n,o),i.samples.length&&this.remuxText(i,o),this.observer.trigger(r.default.FRAG_PARSED)},e.generateIS=function(t,e,n){var o,a,c=this.observer,u=t.samples,l=e.samples,d=this.typeSupported,h="audio/mp4",f={},p={tracks:f},v=void 0===this._initPTS;if(v&&(o=a=1/0),t.config&&u.length&&(t.timescale=t.samplerate,s.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(d.mpeg?(h="audio/mpeg",t.codec=""):d.mp3&&(t.codec="mp3")),f.audio={container:h,codec:t.codec,initSegment:!t.isAAC&&d.mpeg?new Uint8Array:I.initSegment([t]),metadata:{channelCount:t.channelCount}},v&&(o=a=u[0].pts-Math.round(t.inputTimeScale*n))),e.sps&&e.pps&&l.length){var m=e.inputTimeScale;if(e.timescale=m,f.video={container:"video/mp4",codec:e.codec,initSegment:I.initSegment([e]),metadata:{width:e.width,height:e.height}},v){var g=this.getVideoStartPts(l),A=Math.round(m*n);a=Math.min(a,l[0].dts-A),o=Math.min(o,g-A),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o})}}else v&&f.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o});Object.keys(f).length?(c.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,v&&(this._initPTS=o,this._initDTS=a)):c.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.remuxVideo=function(t,e,n,o){var a,c,u,l,d,h=t.timescale,f=t.samples,p=[],v=f.length,m=this._initPTS,g=8,A=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,b=0,w=!1,E=this.nextAvcDts;if(0!==v){if(!n)E=e*h-(f[0].pts-P(f[0].dts,f[0].pts));for(var _=0;_<v;_++){var S=f[_];S.pts=P(S.pts-m,E),S.dts=P(S.dts-m,E),S.dts>S.pts&&(b=Math.max(Math.min(b,S.pts-S.dts),-1*B)),S.dts<f[_>0?_-1:_].dts&&(w=!0)}w&&f.sort((function(t,e){var n=t.dts-e.dts,r=t.pts-e.pts;return n||r||t.id-e.id})),l=f[0].dts,d=f[v-1].dts;var T=Math.round((d-l)/(v-1));if(b<0){if(b<-2*T){s.logger.warn("PTS < DTS detected in video samples, offsetting DTS to PTS "+M(-T,!0)+" ms");for(var C=0;C<v;C++)f[C].dts=f[C].pts-T}else{s.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+M(b,!0)+" ms to overcome this issue");for(var x=0;x<v;x++)f[x].dts=f[x].dts+b}l=f[0].dts,d=f[v-1].dts}if(n){var R=l-E,O=R>T;if(O||R<-1){O?s.logger.warn("AVC: "+M(R,!0)+" ms ("+R+"dts) hole between fragments detected, filling it"):s.logger.warn("AVC: "+M(-R,!0)+" ms ("+R+"dts) overlapping between fragments detected"),l=E;var L=f[0].pts-R;f[0].dts=l,f[0].pts=L,s.logger.log("Video: First PTS/DTS adjusted: "+M(L,!0)+"/"+M(l,!0)+", delta: "+M(R,!0)+" ms")}}N&&N<75&&(l=Math.max(0,l));for(var k=0,U=0,D=0;D<v;D++){for(var F=f[D],H=F.units,j=H.length,V=0,G=0;G<j;G++)V+=H[G].data.length;U+=V,k+=j,F.length=V,F.dts=Math.max(F.dts,l),F.pts=Math.max(F.pts,F.dts,0),A=Math.min(F.pts,A),y=Math.max(F.pts,y)}d=f[v-1].dts;var Q=U+4*k+8;try{c=new Uint8Array(Q)}catch(t){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating video mdat "+Q})}var z=new DataView(c.buffer);z.setUint32(0,Q),c.set(I.types.mdat,4);for(var q=0;q<v;q++){for(var W,K=f[q],X=K.units,J=0,Y=0,$=X.length;Y<$;Y++){var Z=X[Y],tt=Z.data,et=Z.data.byteLength;z.setUint32(g,et),g+=4,c.set(tt,g),g+=et,J+=4+et}if(q<v-1)a=f[q+1].dts-K.dts;else{var nt=this.config,rt=K.dts-f[q>0?q-1:q].dts;if(nt.stretchShortVideoTrack){var it=nt.maxBufferHole,ot=Math.floor(it*h),at=(o?A+o*h:this.nextAudioPts)-K.pts;at>ot?((a=at-rt)<0&&(a=rt),s.logger.log("It is approximately "+M(at,!1)+" ms to the next segment; using duration "+M(a,!1)+" ms for the last video frame.")):a=rt}else a=rt}W=Math.round(K.pts-K.dts),p.push({size:J,duration:a,cts:W,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:K.key?2:1,isNonSync:K.key?0:1}})}this.nextAvcDts=d+a;var st=t.dropped;if(t.nbNalu=0,t.dropped=0,p.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ct=p[0].flags;ct.dependsOn=2,ct.isNonSync=0}t.samples=p,u=I.moof(t.sequenceNumber++,l,t),t.samples=[];var ut={data1:u,data2:c,startPTS:A/h,endPTS:(y+a)/h,startDTS:l/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:p.length,dropped:st};return this.observer.trigger(r.default.FRAG_PARSING_DATA,ut),ut}},e.remuxAudio=function(t,e,n,o){var a,c,u,l,d,h,f=t.inputTimeScale,p=t.timescale,v=f/p,m=(t.isAAC?1024:1152)*v,g=this._initPTS,A=!t.isAAC&&this.typeSupported.mpeg,y=A?0:8,b=t.samples,w=[],E=this.nextAudioPts;if(n|=b.length&&E&&(o&&Math.abs(e-E/f)<.1||Math.abs(b[0].pts-E-g)<20*m),b.forEach((function(t){t.pts=t.dts=P(t.pts-g,e*f)})),0!==(b=b.filter((function(t){return t.pts>=0}))).length){if(n||(E=o?Math.max(0,e*f):b[0].pts),t.isAAC)for(var _=this.config.maxAudioFramesDrift,S=0,T=E;S<b.length;){var C=b[S],R=C.pts,O=R-T;if(O<=-_*m)n||S>0?(s.logger.warn("Dropping 1 audio frame @ "+M(T,!0)/1e3+"s due to "+M(O,!0)+" ms overlap."),b.splice(S,1)):(s.logger.warn("Audio frame @ "+M(R,!0)/1e3+"s overlaps nextAudioPts by "+M(O,!0)+" ms."),T=R+m,S++);else if(O>=_*m&&O<k&&T){var L=Math.round(O/m);s.logger.warn("Injecting "+L+" audio frames @ "+M(T,!0)/1e3+"s due to "+M(O,!0)+" ms gap.");for(var B=0;B<L;B++){var N=Math.max(T,0);(c=x.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),c=C.unit.subarray()),b.splice(S,0,{unit:c,pts:N,dts:N}),T+=m,S++}C.pts=C.dts=T,T+=m,S++}else Math.abs(O),C.pts=C.dts=T,T+=m,S++}for(var U=b.length,D=0;U--;)D+=b[U].unit.byteLength;for(var F=0,H=b.length;F<H;F++){var j=b[F],V=j.unit,G=j.pts;if(void 0!==h&&a)a.duration=Math.round((G-h)/v);else{var Q=G-E,z=0;if(n&&t.isAAC&&Q){if(Q>0&&Q<k)z=Math.round((G-E)/m),s.logger.log(M(Q,!0)+" ms hole between AAC samples detected,filling it"),z>0&&((c=x.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(c=V.subarray()),D+=z*c.length);else if(Q<-12){s.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+M(E,!0)+" ms / "+M(G,!0)+" ms / "+M(-Q,!0)+" ms"),D-=V.byteLength;continue}G=E}if(d=G,!(D>0))return;D+=y;try{u=new Uint8Array(D)}catch(t){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating audio mdat "+D})}A||(new DataView(u.buffer).setUint32(0,D),u.set(I.types.mdat,4));for(var q=0;q<z;q++)(c=x.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),c=V.subarray()),u.set(c,y),y+=c.byteLength,a={size:c.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},w.push(a)}u.set(V,y);var W=V.byteLength;y+=W,a={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},w.push(a),h=G}var K=0;if((U=w.length)>=2&&(K=w[U-2].duration,a.duration=K),U){this.nextAudioPts=E=h+v*K,t.samples=w,l=A?new Uint8Array:I.moof(t.sequenceNumber++,d/v,t),t.samples=[];var X=d/f,J=E/f,Y={data1:l,data2:u,startPTS:X,endPTS:J,startDTS:X,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Y),Y}return null}},e.remuxEmptyAudio=function(t,e,n,r){var i=t.inputTimeScale,o=i/(t.samplerate?t.samplerate:i),a=this.nextAudioPts,c=(void 0!==a?a:r.startDTS*i)+this._initDTS,u=r.endDTS*i+this._initDTS,l=1024*o,d=Math.ceil((u-c)/l),h=x.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(s.logger.warn("remux empty Audio"),h){for(var f=[],p=0;p<d;p++){var v=c+p*l;f.push({unit:h,pts:v,dts:v})}t.samples=f,this.remuxAudio(t,e,n)}else s.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.remuxID3=function(t,e){var n=t.samples.length;if(n){for(var i=t.inputTimeScale,o=this._initPTS,a=this._initDTS,s=0;s<n;s++){var c=t.samples[s];c.pts=P(c.pts-o,e*i)/i,c.dts=P(c.dts-a,e*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:t.samples}),t.samples=[]}},e.remuxText=function(t,e){var n=t.samples.length,i=t.inputTimeScale,o=this._initPTS;if(n){for(var a=0;a<n;a++){var s=t.samples[a];s.pts=P(s.pts-o,e*i)/i}t.samples.sort((function(t,e){return t.pts-e.pts})),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},t}(),F=function(){function t(t){this.observer=t}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.remux=function(t,e,n,i,o,a,s,c){var u=this.observer,l="";t&&(l+="audio"),e&&(l+="video"),u.trigger(r.default.FRAG_PARSING_DATA,{data1:c,startPTS:o,startDTS:o,type:l,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),u.trigger(r.default.FRAG_PARSED)},t}(),H=Object(c.getSelfScope)();try{U=H.performance.now.bind(H.performance)}catch(t){s.logger.debug("Unable to use Performance API on this environment"),U=H.Date.now}var j=function(){function t(t,e,n,r){this.observer=t,this.typeSupported=e,this.config=n,this.vendor=r}var e=t.prototype;return e.destroy=function(){var t=this.demuxer;t&&t.destroy()},e.push=function(t,e,n,i,a,s,c,u,l,d,h,f){var p=this;if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var v=this.decrypter;null==v&&(v=this.decrypter=new o.default(this.observer,this.config));var m=U();v.decrypt(t,e.key.buffer,e.iv.buffer,(function(t){var o=U();p.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:o}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),i,a,s,c,u,l,d,h,f)}))}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),i,a,s,c,u,l,d,h,f)},e.pushDecrypted=function(t,e,n,o,a,s,c,u,l,d,h,f){var p=this.demuxer,v=this.remuxer;if(!p||c||u){for(var m,g=this.observer,b=this.typeSupported,w=this.config,E=[{demux:T,remux:D},{demux:y.default,remux:F},{demux:A,remux:D},{demux:C,remux:D}],_=0,S=E.length;_<S&&!(m=E[_]).demux.probe(t);_++);if(!m)return void g.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});v&&v instanceof m.remux||(v=new m.remux(g,w,b,this.vendor)),p&&p instanceof m.demux||(p=new m.demux(g,v,w,b),this.probe=m.demux.probe),this.demuxer=p,this.remuxer=v}(c||u)&&(p.resetInitSegment(n,o,a,d),v.resetInitSegment()),c&&(p.resetTimeStamp(f),v.resetTimeStamp(f)),"function"==typeof p.setDecryptData&&p.setDecryptData(e),p.append(t,s,l,h)},t}();e.default=j},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(t,e,n){"use strict";n.r(e);var r=n(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),i=n(/*! ../events */"./src/events.js"),o=n(/*! ../utils/logger */"./src/utils/logger.js"),a=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");e.default=function(t){var e=new a.EventEmitter;e.trigger=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t,t].concat(r))},e.off=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.removeListener.apply(e,[t].concat(r))};var n=function(e,n){t.postMessage({event:e,data:n})};t.addEventListener("message",(function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);t.demuxer=new r.default(e,a.typeSupported,s,a.vendor),Object(o.enableLogs)(s.debug),n("init",null);break;case"demux":t.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}})),e.on(i.default.FRAG_DECRYPTED,n),e.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),e.on(i.default.FRAG_PARSED,n),e.on(i.default.ERROR,n),e.on(i.default.FRAG_PARSING_METADATA,n),e.on(i.default.FRAG_PARSING_USERDATA,n),e.on(i.default.INIT_PTS_FOUND,n),e.on(i.default.FRAG_PARSING_DATA,(function(e,n){var r=[],i={event:e,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),t.postMessage(i,r)}))}},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(t,e,n){"use strict";n.r(e),n.d(e,"utf8ArrayToStr",(function(){return s}));var r,i=n(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),o=function(){function t(){}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,n){for(var r=n,i=0;t.isHeader(e,n);){i+=10,i+=t._readSize(e,n+6),t.isFooter(e,n+10)&&(i+=10),n+=i}if(i>0)return e.subarray(r,r+i)},t._readSize=function(t,e){var n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3]},t.getTimeStamp=function(e){for(var n=t.getID3Frames(e),r=0;r<n.length;r++){var i=n[r];if(t.isTimeStampFrame(i))return t._readTimeStamp(i)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var n=String.fromCharCode(e[0],e[1],e[2],e[3]),r=t._readSize(e,4);return{type:n,size:r,data:e.subarray(10,10+r)}},t.getID3Frames=function(e){for(var n=0,r=[];t.isHeader(e,n);){for(var i=t._readSize(e,n+6),o=(n+=10)+i;n+8<o;){var a=t._getFrameData(e.subarray(n)),s=t._decodeFrame(a);s&&r.push(s),n+=a.size+10}t.isFooter(e,n)&&(n+=10)}return r},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),n=1&e[3],r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var n=t._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(n.length+1));return{key:e.type,info:n,data:r.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var n=1,r=t._utf8ArrayToStr(e.data.subarray(n),!0);n+=r.length+1;var i=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:r,data:i}}var o=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:o}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var n=1,r=t._utf8ArrayToStr(e.data.subarray(n),!0);n+=r.length+1;var i=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:r,data:i}}var o=t._utf8ArrayToStr(e.data);return{key:e.type,data:o}},t._utf8ArrayToStr=function(t,e){void 0===e&&(e=!1);var n=a();if(n){var r=n.decode(t);if(e){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var o,s,c,u=t.length,l="",d=0;d<u;){if(0===(o=t[d++])&&e)return l;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(o);break;case 12:case 13:s=t[d++],l+=String.fromCharCode((31&o)<<6|63&s);break;case 14:s=t[d++],c=t[d++],l+=String.fromCharCode((15&o)<<12|(63&s)<<6|(63&c)<<0)}}return l},t}();function a(){var t=Object(i.getSelfScope)();return r||void 0===t.TextDecoder||(r=new t.TextDecoder("utf-8")),r}var s=o._utf8ArrayToStr;e.default=o},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(t,e,n){"use strict";n.r(e);var r=n(/*! ../utils/logger */"./src/utils/logger.js"),i=n(/*! ../events */"./src/events.js"),o=Math.pow(2,32)-1,a=function(){function t(t,e){this.observer=t,this.remuxer=e}var e=t.prototype;return e.resetTimeStamp=function(t){this.initPTS=t},e.resetInitSegment=function(e,n,r,o){if(e&&e.byteLength){var a=this.initData=t.parseInitSegment(e);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:o?e:null}:(a.audio&&(s.audio={container:"audio/mp4",codec:n,initSegment:o?e:null}),a.video&&(s.video={container:"video/mp4",codec:r,initSegment:o?e:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<8|t[e+1];return n<0?65536+n:n},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return n<0?4294967296+n:n},t.writeUint32=function(t,e,n){t.data&&(e+=t.start,t=t.data),t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},t.findBox=function(e,n){var r,i,o,a,s,c,u=[];if(e.data?(s=e.start,o=e.end,e=e.data):(s=0,o=e.byteLength),!n.length)return null;for(r=s;r<o;)c=(i=t.readUint32(e,r))>1?r+i:o,t.bin2str(e.subarray(r+4,r+8))===n[0]&&(1===n.length?u.push({data:e,start:r+8,end:c}):(a=t.findBox({data:e,start:r+8,end:c},n.slice(1))).length&&(u=u.concat(a))),r=c;return u},t.parseSegmentIndex=function(e){var n,r=t.findBox(e,["moov"])[0],i=r?r.end:null,o=0,a=t.findBox(e,["sidx"]);if(!a||!a[0])return null;n=[];var s=(a=a[0]).data[0];o=0===s?8:16;var c=t.readUint32(a,o);o+=4;o+=0===s?8:16,o+=2;var u=a.end+0,l=t.readUint16(a,o);o+=2;for(var d=0;d<l;d++){var h=o,f=t.readUint32(a,h);h+=4;var p=2147483647&f;if(1===(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var v=t.readUint32(a,h);h+=4,n.push({referenceSize:p,subsegmentDuration:v,info:{duration:v/c,start:u,end:u+p-1}}),u+=p,o=h+=4}return{earliestPresentationTime:0,timescale:c,version:s,referencesCount:l,references:n,moovEndOffset:i}},t.parseInitSegment=function(e){var n=[];return t.findBox(e,["moov","trak"]).forEach((function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var o=i.data[i.start],a=0===o?12:20,s=t.readUint32(i,a),c=t.findBox(e,["mdia","mdhd"])[0];if(c){a=0===(o=c.data[c.start])?12:20;var u=t.readUint32(c,a),l=t.findBox(e,["mdia","hdlr"])[0];if(l){var d={soun:"audio",vide:"video"}[t.bin2str(l.data.subarray(l.start+8,l.start+12))];if(d){var h=t.findBox(e,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var f=t.bin2str(h.data.subarray(h.start+12,h.start+16));r.logger.log("MP4Demuxer:"+d+":"+f+" found")}n[s]={timescale:u,type:d},n[d]={timescale:u,id:s}}}}}})),n},t.getStartDTS=function(e,n){var r,i,o;return r=t.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map((function(n){return t.findBox(n,["tfhd"]).map((function(r){var i,o;return i=t.readUint32(r,4),o=e[i].timescale||9e4,t.findBox(n,["tfdt"]).map((function(e){var n,r;return n=e.data[e.start],r=t.readUint32(e,4),1===n&&(r*=Math.pow(2,32),r+=t.readUint32(e,8)),r}))[0]/o}))}))),o=Math.min.apply(null,i),isFinite(o)?o:0},t.offsetStartDTS=function(e,n,r){t.findBox(n,["moof","traf"]).map((function(n){return t.findBox(n,["tfhd"]).map((function(i){var a=t.readUint32(i,4),s=e[a].timescale||9e4;t.findBox(n,["tfdt"]).map((function(e){var n=e.data[e.start],i=t.readUint32(e,4);if(0===n)t.writeUint32(e,4,i-r*s);else{i*=Math.pow(2,32),i+=t.readUint32(e,8),i-=r*s,i=Math.max(i,0);var a=Math.floor(i/(o+1)),c=Math.floor(i%(o+1));t.writeUint32(e,4,a),t.writeUint32(e,8,c)}}))}))}))},e.append=function(e,n,r,o){var a=this.initData;a||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),a=this.initData);var s,c=this.initPTS;if(void 0===c){var u=t.getStartDTS(a,e);this.initPTS=c=u-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:c})}t.offsetStartDTS(a,e,c),s=t.getStartDTS(a,e),this.remuxer.remux(a.audio,a.video,null,null,s,r,o,e)},e.destroy=function(){},t}();e.default=a},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(t,e,n){"use strict";var r,i;n.r(e),n.d(e,"ErrorTypes",(function(){return r})),n.d(e,"ErrorDetails",(function(){return i})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(r||(r={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(t,e,n){"use strict";n.r(e);e.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":
/*!*********************************!*\
  !*** ./src/hls.ts + 50 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return cn}));var r={};n.r(r),n.d(r,"newCue",(function(){return fe}));var i,o,a=n("./node_modules/url-toolkit/src/url-toolkit.js"),s=n("./src/errors.ts"),c=n("./src/polyfills/number.js"),u=n("./src/events.js"),l=n("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function t(t){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=t,this.onEvent=this.onEvent.bind(this);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){},e.onHandlerDestroyed=function(){},e.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},e.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(t){if(d[t])throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)}),this)},e.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(t){this.hls.off(t,this.onEvent)}),this)},e.onEvent=function(t,e){this.onEventGeneric(t,e)},e.onEventGeneric=function(t,e){try{(function(t,e){var n="on"+t.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,e)}).call(this,t,e).call()}catch(e){l.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}();!function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(o||(o={}));var f=n("./src/demux/mp4demuxer.js");function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var v,m=function(){function t(t,e){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=t,this.reluri=e}var e,n,r;return e=t,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(a.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(e.prototype,n),r&&p(e,r),t}();function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.AUDIO="audio",t.VIDEO="video"}(v||(v={}));var A=function(){function t(){var t;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((t={})[v.AUDIO]=!1,t[v.VIDEO]=!1,t),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var e,n,r,i=t.prototype;return i.setByteRange=function(t,e){var n=t.split("@",2),r=[];1===n.length?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},i.addElementaryStream=function(t){this._elementaryStreams[t]=!0},i.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},i.createInitializationVector=function(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e},i.setDecryptDataFromLevelKey=function(t,e){var n=t;return(null==t?void 0:t.method)&&t.uri&&!t.iv&&((n=new m(t.baseuri,t.reluri)).method=t.method,n.iv=this.createInitializationVector(e)),n},e=t,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&l.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(c.isFiniteNumber)(this.programDateTime))return null;var t=Object(c.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&g(e.prototype,n),r&&g(e,r),t}();function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var b=function(){function t(t){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}var e,n,r;return e=t,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(c.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&y(e.prototype,n),r&&y(e,r),t}(),w=/^(\d+)x(\d+)$/,E=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,_=function(){function t(e){for(var n in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(n)&&(this[n]=e[n])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)n[r]=parseInt(e.slice(2*r,2*r+2),16);return n}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.enumeratedString=function(t){return this[t]},e.decimalResolution=function(t){var e=w.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,n={};for(E.lastIndex=0;null!==(e=E.exec(t));){var r=e[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[e[1]]=r}return n},t}(),S={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function T(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var C=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,x=/#EXT-X-MEDIA:(.*)/g,R=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),I=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,O=/\.(mp4|m4s|m4v|m4a)$/i,M=function(){function t(){}return t.findGroup=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}},t.convertAVC1ToAVCOTI=function(t){var e,n=t.split(".");return n.length>2?(e=n.shift()+".",e+=parseInt(n.shift()).toString(16),e+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):e=t,e},t.resolve=function(t,e){return a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,n){var r,i=[],o={},a=!1;function s(t,e){["video","audio"].forEach((function(n){var r=t.filter((function(t){return function(t,e){var n=S[e];return!!n&&!0===n[t.slice(0,4)]}(t,n)}));if(r.length){var i=r.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[n+"Codec"]=i.length>0?i[0]:r[0],t=t.filter((function(t){return-1===r.indexOf(t)}))}})),e.unknownCodecs=t}for(C.lastIndex=0;null!=(r=C.exec(e));)if(r[1]){var c={},u=c.attrs=new _(r[1]);c.url=t.resolve(r[2],n);var l=u.decimalResolution("RESOLUTION");l&&(c.width=l.width,c.height=l.height),c.bitrate=u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),c.name=u.NAME,s([].concat((u.CODECS||"").split(/[ ,]+/)),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=t.convertAVC1ToAVCOTI(c.videoCodec)),i.push(c)}else if(r[3]){var d=new _(r[3]);d["DATA-ID"]&&(a=!0,o[d["DATA-ID"]]=d)}return{levels:i,sessionData:a?o:null}},t.parseMasterPlaylistMedia=function(e,n,r,i){var o;void 0===i&&(i=[]);var a=[],s=0;for(x.lastIndex=0;null!==(o=x.exec(e));){var c=new _(o[1]);if(c.TYPE===r){var u={attrs:c,id:s++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE,type:r,default:"YES"===c.DEFAULT,autoselect:"YES"===c.AUTOSELECT,forced:"YES"===c.FORCED,lang:c.LANGUAGE};if(c.URI&&(u.url=t.resolve(c.URI,n)),i.length){var l=t.findGroup(i,u.groupId);u.audioCodec=l?l.codec:i[0].codec}a.push(u)}}return a},t.parseLevelPlaylist=function(t,e,n,r,i){var o,a,s,u=0,d=0,h=new b(e),f=0,p=null,v=new A,g=null;for(R.lastIndex=0;null!==(o=R.exec(t));){var y=o[1];if(y){v.duration=parseFloat(y);var w=(" "+o[2]).slice(1);v.title=w||null,v.tagList.push(w?["INF",y,w]:["INF",y])}else if(o[3]){if(Object(c.isFiniteNumber)(v.duration)){var E=u++;v.type=r,v.start=d,s&&(v.levelkey=s),v.sn=E,v.level=n,v.cc=f,v.urlId=i,v.baseurl=e,v.relurl=(" "+o[3]).slice(1),L(v,p),h.fragments.push(v),p=v,d+=v.duration,v=new A}}else if(o[4]){var S=(" "+o[4]).slice(1);p?v.setByteRange(S,p):v.setByteRange(S)}else if(o[5])v.rawProgramDateTime=(" "+o[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),null===g&&(g=h.fragments.length);else{if(!(o=o[0].match(I))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(a=1;a<o.length&&void 0===o[a];a++);var T=(" "+o[a+1]).slice(1),C=(" "+o[a+2]).slice(1);switch(o[a]){case"#":v.tagList.push(C?[T,C]:[T]);break;case"PLAYLIST-TYPE":h.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":u=h.startSN=parseInt(T);break;case"TARGETDURATION":h.targetduration=parseFloat(T);break;case"VERSION":h.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":f++,v.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(T);break;case"KEY":var x=new _(T),M=x.enumeratedString("METHOD"),k=x.URI,B=x.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(x.KEYFORMAT||"identity")){l.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}M&&(s=new m(e,k),k&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(M)>=0&&(s.method=M,s.key=null,s.iv=B));break;case"START":var N=new _(T).decimalFloatingPoint("TIME-OFFSET");Object(c.isFiniteNumber)(N)&&(h.startTimeOffset=N);break;case"MAP":var P=new _(T);v.relurl=P.URI,P.BYTERANGE&&v.setByteRange(P.BYTERANGE),v.baseurl=e,v.level=n,v.type=r,v.sn="initSegment",h.initSegment=v,(v=new A).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+o)}}}return(v=p)&&!v.relurl&&(h.fragments.pop(),d-=v.duration),h.totalduration=d,h.averagetargetduration=d/h.fragments.length,h.endSN=u-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=f,!h.initSegment&&h.fragments.length&&h.fragments.every((function(t){return O.test(t.relurl)}))&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(v=new A).relurl=h.fragments[0].relurl,v.baseurl=e,v.level=n,v.type=r,v.sn="initSegment",h.initSegment=v,h.needSidxRanges=!0),g&&function(t,e){for(var n=t[e],r=e-1;r>=0;r--){var i=t[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(h.fragments,g),h},t}();function L(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):(null==e?void 0:e.programDateTime)&&(t.programDateTime=e.endProgramDateTime),Object(c.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}var k=window.performance,B=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.canHaveQualityLevels=function(t){return t!==i.AUDIO_TRACK&&t!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(t){switch(t.type){case i.AUDIO_TRACK:return o.AUDIO;case i.SUBTITLE_TRACK:return o.SUBTITLE;default:return o.MAIN}},r.getResponseUrl=function(t,e){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n};var a=r.prototype;return a.createInternalLoader=function(t){var e=this.hls.config,n=e.pLoader,r=e.loader,i=new(n||r)(e);return t.loader=i,this.loaders[t.type]=i,i},a.getInternalLoader=function(t){return this.loaders[t.type]},a.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},a.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},a.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},a.onManifestLoading=function(t){this.load({url:t.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},a.onLevelLoading=function(t){this.load({url:t.url,type:i.LEVEL,level:t.level,id:t.id,responseType:"text"})},a.onAudioTrackLoading=function(t){this.load({url:t.url,type:i.AUDIO_TRACK,level:null,id:t.id,responseType:"text"})},a.onSubtitleTrackLoading=function(t){this.load({url:t.url,type:i.SUBTITLE_TRACK,level:null,id:t.id,responseType:"text"})},a.load=function(t){var e=this.hls.config;l.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n,r,o,a,s=this.getInternalLoader(t);if(s){var c=s.context;if(c&&c.url===t.url)return l.logger.trace("playlist request ongoing"),!1;l.logger.warn("aborting previous loader for type: "+t.type),s.abort()}switch(t.type){case i.MANIFEST:n=e.manifestLoadingMaxRetry,r=e.manifestLoadingTimeOut,o=e.manifestLoadingRetryDelay,a=e.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,a=0,o=0,r=e.levelLoadingTimeOut;break;default:n=e.levelLoadingMaxRetry,r=e.levelLoadingTimeOut,o=e.levelLoadingRetryDelay,a=e.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(t);var u={timeout:r,maxRetry:n,retryDelay:o,maxRetryDelay:a},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return l.logger.debug("Calling internal loader delegate for URL: "+t.url),s.load(t,u,d),!0},a.loadsuccess=function(t,e,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(t,n),void this._handlePlaylistLoaded(t,e,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof t.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=t.data;e.tload=k.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,n,r):this._handleMasterPlaylist(t,e,n,r):this._handleManifestParsingError(t,n,"no EXTM3U delimiter",r)},a.loaderror=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!1,t)},a.loadtimeout=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!0)},a._handleMasterPlaylist=function(t,e,n,i){var o=this.hls,a=t.data,s=r.getResponseUrl(t,n),c=M.parseMasterPlaylist(a,s),d=c.levels,h=c.sessionData;if(d.length){var f=d.map((function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}})),p=M.parseMasterPlaylistMedia(a,s,"AUDIO",f),v=M.parseMasterPlaylistMedia(a,s,"SUBTITLES"),m=M.parseMasterPlaylistMedia(a,s,"CLOSED-CAPTIONS");if(p.length){var g=!1;p.forEach((function(t){t.url||(g=!0)})),!1===g&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(l.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}o.trigger(u.default.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:v,captions:m,url:s,stats:e,networkDetails:i,sessionData:h})}else this._handleManifestParsingError(t,n,"no level found in manifest",i)},a._handleTrackOrLevelPlaylist=function(t,e,n,o){var a=this.hls,l=n.id,d=n.level,h=n.type,f=r.getResponseUrl(t,n),p=Object(c.isFiniteNumber)(l)?l:0,v=Object(c.isFiniteNumber)(d)?d:p,m=r.mapContextToLevelType(n),g=M.parseLevelPlaylist(t.data,f,v,m,p);if(g.tload=e.tload,g.fragments.length){if(h===i.MANIFEST){var A={url:f,details:g};a.trigger(u.default.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:f,stats:e,networkDetails:o,sessionData:null})}if(e.tparsed=k.now(),g.needSidxRanges){var y=g.initSegment.url;this.load({url:y,isSidxRequest:!0,type:h,level:d,levelDetails:g,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=g,this._handlePlaylistLoaded(t,e,n,o)}else a.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},a._handleSidxRequest=function(t,e){if("string"==typeof t.data)throw new Error("sidx request must be made with responseType of array buffer");var n=f.default.parseSegmentIndex(new Uint8Array(t.data));if(n){var r=n.references,i=e.levelDetails;r.forEach((function(t,e){var n=t.info;if(i){var r=i.fragments[e];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},a._handleManifestParsingError=function(t,e,n,r){this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:n,networkDetails:r})},a._handleNetworkError=function(t,e,n,r){var o,a;void 0===n&&(n=!1),void 0===r&&(r=null),l.logger.info("A network error occured while loading a "+t.type+"-type playlist");var c=this.getInternalLoader(t);switch(t.type){case i.MANIFEST:o=n?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case i.LEVEL:o=n?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case i.AUDIO_TRACK:o=n?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}c&&(c.abort(),this.resetInternalLoader(t.type));var d={type:s.ErrorTypes.NETWORK_ERROR,details:o,fatal:a,url:t.url,loader:c,context:t,networkDetails:e};r&&(d.response=r),this.hls.trigger(u.default.ERROR,d)},a._handlePlaylistLoaded=function(t,e,n,o){var a=n.type,s=n.level,c=n.id,l=n.levelDetails;if(l&&l.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:l,level:s||0,id:c||0,stats:e,networkDetails:o});else switch(a){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:l,id:c,stats:e,networkDetails:o});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:l,id:c,stats:e,networkDetails:o})}else this._handleManifestParsingError(t,n,"invalid target duration",o)},r}(h);var N=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.FRAG_LOADING)||this).loaders={},n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){var e=this.loaders;for(var n in e){var r=e[n];r&&r.destroy()}this.loaders={},t.prototype.destroy.call(this)},i.onFragLoading=function(t){var e=t.frag,n=e.type,r=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;e.loaded=0;var s,u,d,h=r[n];h&&(l.logger.warn("abort previous fragment loader for type: "+n),h.abort()),h=r[n]=e.loader=i.fLoader?new o(i):new a(i),s={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var f=e.byteRangeStartOffset,p=e.byteRangeEndOffset;Object(c.isFiniteNumber)(f)&&Object(c.isFiniteNumber)(p)&&(s.rangeStart=f,s.rangeEnd=p),u={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(s,u,d)},i.loadsuccess=function(t,e,n,r){void 0===r&&(r=null);var i=t.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:o,stats:e,networkDetails:r})},i.loaderror=function(t,e,n){void 0===n&&(n=null);var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:n})},i.loadtimeout=function(t,e,n){void 0===n&&(n=null);var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:n})},i.loadprogress=function(t,e,n,r){void 0===r&&(r=null);var i=e.frag;i.loaded=t.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:t,networkDetails:r})},r}(h);var P=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var e in this.loaders){var n=this.loaders[e];n&&n.destroy()}this.loaders={},t.prototype.destroy.call(this)},i.onKeyLoading=function(t){var e=t.frag,n=e.type,r=this.loaders[n];if(e.decryptdata){var i=e.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;if(r&&(l.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void l.logger.warn("key uri is falsy");e.loader=this.loaders[n]=new o.loader(o),this.decrypturl=i,this.decryptkey=null;var a={url:i,frag:e,responseType:"arraybuffer"},s={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.loader.load(a,s,c)}else this.decryptkey&&(e.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:e}))}else l.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(t,e,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(u.default.KEY_LOADED,{frag:r})):l.logger.error("after key load, decryptdata unset")},i.loaderror=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},i.loadtimeout=function(t,e){var n=e.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(h);var U="NOT_LOADED",D="APPENDING",F="PARTIAL",H="OK",j=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=e.config,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),t.prototype.destroy.call(this)},i.getBufferedFrag=function(t,e){var n=this.fragments,r=Object.keys(n).filter((function(r){var i=n[r];if(i.body.type!==e)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=t&&t<=o.endPTS}));if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(t,e){var n=this;Object.keys(this.fragments).forEach((function(r){var i=n.fragments[r];if(i&&i.buffered){var o=i.range[t];if(o)for(var a=o.time,s=0;s<a.length;s++){var c=a[s];if(!n.isTimeBuffered(c.startPTS,c.endPTS,e)){n.removeFragment(i.body);break}}}}))},i.detectPartialFragments=function(t){var e=this,n=this.getFragmentKey(t),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(t.hasElementaryStream(n)){var i=e.timeRanges[n];r.range[n]=e.getBufferedTimes(t.startPTS,t.endPTS,i)}})))},i.getBufferedTimes=function(t,e,n){for(var r,i,o=[],a=!1,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,t>=r&&e<=i){o.push({startPTS:Math.max(t,n.start(s)),endPTS:Math.min(e,n.end(s))});break}if(t<i&&e>r)o.push({startPTS:Math.max(t,n.start(s)),endPTS:Math.min(e,n.end(s))}),a=!0;else if(e<=r)break}return{time:o,partial:a}},i.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},i.getPartialFragment=function(t){var e,n,r,i=this,o=null,a=0;return Object.keys(this.fragments).forEach((function(s){var c=i.fragments[s];i.isPartial(c)&&(n=c.body.startPTS-i.bufferPadding,r=c.body.endPTS+i.bufferPadding,t>=n&&t<=r&&(e=Math.min(t-n,r-t),a<=e&&(o=c.body,a=e)))})),o},i.getState=function(t){var e=this.getFragmentKey(t),n=this.fragments[e],r=U;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?F:H:D),r},i.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},i.isTimeBuffered=function(t,e,n){for(var r,i,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,t>=r&&e<=i)return!0;if(e<=r)return!1}return!1},i.onFragLoaded=function(t){var e=t.frag;Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach((function(t){var n=e.timeRanges[t];e.detectEvictedFragments(t,n)}))},i.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},i.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},i.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(h),V={search:function(t,e){for(var n=0,r=t.length-1,i=null,o=null;n<=r;){var a=e(o=t[i=(n+r)/2|0]);if(a>0)n=i+1;else{if(!(a<0))return o;r=i-1}}return null}},G=function(){function t(){}return t.isBuffered=function(t,e){try{if(t)for(var n=t.buffered,r=0;r<n.length;r++)if(e>=n.start(r)&&e<=n.end(r))return!0}catch(t){}return!1},t.bufferInfo=function(t,e,n){try{if(t){var r,i=t.buffered,o=[];for(r=0;r<i.length;r++)o.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(o,e,n)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,n){t.sort((function(t,e){var n=t.start-e.start;return n||e.end-t.end}));var r=[];if(n)for(var i=0;i<t.length;i++){var o=r.length;if(o){var a=r[o-1].end;t[i].start-a<n?t[i].end>a&&(r[o-1].end=t[i].end):r.push(t[i])}else r.push(t[i])}else r=t;for(var s,c=0,u=e,l=e,d=0;d<r.length;d++){var h=r[d].start,f=r[d].end;if(e+n>=h&&e<f)u=h,c=(l=f)-e;else if(e+n<h){s=h;break}}return{len:c,start:u,end:l,nextStart:s}},t}(),Q=n("./node_modules/eventemitter3/index.js"),z=n("./node_modules/webworkify-webpack/index.js"),q=n("./src/demux/demuxer-inline.js");function W(){return window.MediaSource||window.WebKitMediaSource}var K=n("./src/utils/get-self-scope.js");var X=function(t){var e,n;function r(){return t.apply(this,arguments)||this}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.prototype.trigger=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.emit.apply(this,[t,t].concat(n))},r}(Q.EventEmitter),J=Object(K.getSelfScope)(),Y=W()||{isTypeSupported:function(){return!1}},$=function(){function t(t,e){var n=this;this.hls=t,this.id=e;var r=this.observer=new X,i=t.config,o=function(e,r){(r=r||{}).frag=n.frag,r.id=n.id,t.trigger(e,r)};r.on(u.default.FRAG_DECRYPTED,o),r.on(u.default.FRAG_PARSING_INIT_SEGMENT,o),r.on(u.default.FRAG_PARSING_DATA,o),r.on(u.default.FRAG_PARSED,o),r.on(u.default.ERROR,o),r.on(u.default.FRAG_PARSING_METADATA,o),r.on(u.default.FRAG_PARSING_USERDATA,o),r.on(u.default.INIT_PTS_FOUND,o);var a={mp4:Y.isTypeSupported("video/mp4"),mpeg:Y.isTypeSupported("audio/mpeg"),mp3:Y.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var d;l.logger.log("demuxing in webworker");try{d=this.w=z(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(e){t.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:a,vendor:c,id:e,config:JSON.stringify(i)})}catch(t){l.logger.warn("Error in worker:",t),l.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&J.URL.revokeObjectURL(d.objectURL),this.demuxer=new q.default(r,a,i,c),this.w=void 0}}else this.demuxer=new q.default(r,a,i,c)}var e=t.prototype;return e.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},e.push=function(t,e,n,r,i,o,a,s){var u=this.w,d=Object(c.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,h=i.decryptdata,f=this.frag,p=!(f&&i.cc===f.cc),v=!(f&&i.level===f.level),m=f&&i.sn===f.sn+1,g=!v&&m;if(p&&l.logger.log(this.id+":discontinuity detected"),v&&l.logger.log(this.id+":switch detected"),this.frag=i,u)u.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:e,audioCodec:n,videoCodec:r,timeOffset:d,discontinuity:p,trackSwitch:v,contiguous:g,duration:o,accurateTimeOffset:a,defaultInitPTS:s},t instanceof ArrayBuffer?[t]:[]);else{var A=this.demuxer;A&&A.push(t,h,e,n,r,d,p,v,g,o,a,s)}},e.onWorkerMessage=function(t){var e=t.data,n=this.hls;switch(e.event){case"init":J.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}},t}();function Z(t,e,n){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function tt(t,e,n){var r=t[e],i=t[n],o=i.startPTS;if(Object(c.isFiniteNumber)(o))n>e?(r.duration=o-r.start,r.duration<0&&l.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&l.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"));else if(n>e){var a=r.cc===i.cc;i.start=r.start+(a&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else i.start=Math.max(r.start-i.duration,0)}function et(t,e,n,r,i,o){var a=n,s=r;if(Object(c.isFiniteNumber)(e.startPTS)){var u=Math.abs(e.startPTS-n);Object(c.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(u,e.deltaPTS):e.deltaPTS=u,a=Math.max(n,e.startPTS),n=Math.min(n,e.startPTS),s=Math.min(r,e.endPTS),r=Math.max(r,e.endPTS),i=Math.min(i,e.startDTS),o=Math.max(o,e.endDTS)}var l=n-e.start;e.start=e.startPTS=n,e.maxStartPTS=a,e.endPTS=r,e.minEndPTS=s,e.startDTS=i,e.endDTS=o,e.duration=r-n;var d,h,f,p=e.sn;if(!t||p<t.startSN||p>t.endSN)return 0;for(d=p-t.startSN,(h=t.fragments)[d]=e,f=d;f>0;f--)tt(h,f,f-1);for(f=d;f<h.length-1;f++)tt(h,f,f+1);return t.PTSKnown=!0,l}function nt(t,e){e.initSegment&&t.initSegment&&(e.initSegment=t.initSegment);var n,r=0;if(rt(t,e,(function(t,i){r=t.cc-i.cc,Object(c.isFiniteNumber)(t.startPTS)&&(i.start=i.startPTS=t.startPTS,i.endPTS=t.endPTS,i.duration=t.duration,i.backtracked=t.backtracked,i.dropped=t.dropped,n=i),e.PTSKnown=!0})),e.PTSKnown){if(r){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=e.fragments,o=0;o<i.length;o++)i[o].cc+=r}n?et(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(t,e){var n=e.startSN-t.startSN,r=t.fragments,i=e.fragments;if(n<0||n>r.length)return;for(var o=0;o<i.length;o++)i[o].start+=r[n].start}(t,e),e.PTSKnown=t.PTSKnown}}function rt(t,e,n){if(t&&e)for(var r=Math.max(t.startSN,e.startSN)-e.startSN,i=Math.min(t.endSN,e.endSN)-e.startSN,o=e.startSN-t.startSN,a=r;a<=i;a++){var s=t.fragments[o+a],c=e.fragments[a];if(!s||!c)break;n(s,c,a)}}function it(t,e,n){var r=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),i=r/2;return t&&e.endSN===t.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var ot={toString:function(t){for(var e="",n=t.length,r=0;r<n;r++)e+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return e}};function at(t,e){e.fragments.forEach((function(e){if(e){var n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}})),e.PTSKnown=!0}function st(t,e,n){!function(t,e,n){if(function(t,e,n){var r=!1;return e&&e.details&&n&&(n.endCC>n.startCC||t&&t.cc<n.startCC)&&(r=!0),r}(t,n,e)){var r=function(t,e){var n=t.fragments,r=e.fragments;if(r.length&&n.length){var i=function(t,e){for(var n=null,r=0;r<t.length;r+=1){var i=t[r];if(i&&i.cc===e){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;l.logger.log("No frag in previous level to align on")}else l.logger.log("No fragments to align")}(n.details,e);r&&(l.logger.log("Adjusting PTS using last level due to CC increase within current level"),at(r.start,e))}}(t,n,e),!n.PTSKnown&&e&&function(t,e){if(e&&e.fragments.length){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;var n=e.fragments[0].programDateTime,r=(t.fragments[0].programDateTime-n)/1e3+e.fragments[0].start;Object(c.isFiniteNumber)(r)&&(l.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),at(r,t))}}(n,e.details)}function ct(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!Object(c.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<t.length;++r){var i=t[r];if(dt(e,n,i))return i}return null}function ut(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;if(t?i=e[t.sn-e[0].sn+1]:0===n&&0===e[0].start&&(i=e[0]),i&&0===lt(n,r,i))return i;var o=V.search(e,lt.bind(null,n,r));return o||i}function lt(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0);var r=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function dt(t,e,n){var r=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>t}var ht=function(){function t(t,e,n,r){this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var e=t.prototype;return e.poll=function(t){var e=this.config,n=this.media,r=this.stalled,i=n.currentTime,o=n.seeking,a=this.seeking&&!o,s=!this.seeking&&o;if(this.seeking=o,i===t){if((s||a)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var c=G.bufferInfo(n,i,0),u=c.len>0,d=c.nextStart||0;if(u||d){if(o){var h=c.len>2,f=!d||d-i>2&&!this.fragmentTracker.getPartialFragment(i);if(h||f)return;this.moved=!1}if(!this.moved&&this.stalled){var p=Math.max(d,c.start||0)-i;if(p>0&&p<=2)return void this._trySkipBufferHole(null)}var v=self.performance.now();if(null!==r){var m=v-r;!o&&m>=250&&this._reportStall(c.len);var g=G.bufferInfo(n,i,e.maxBufferHole);this._tryFixBufferStall(g,m)}else this.stalled=v}}}else if(this.moved=!0,null!==r){if(this.stallReported){var A=self.performance.now()-r;l.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},e._tryFixBufferStall=function(t,e){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);if(o&&this._trySkipBufferHole(o))return;t.len>n.maxBufferHole&&e>1e3*n.highBufferWatchdogPeriod&&(l.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,n=this.hls,r=this.media,i=r.currentTime,o=0,a=0;a<r.buffered.length;a++){var c=r.buffered.start(a);if(i+e.maxBufferHole>=o&&i<c){var d=Math.max(c+.05,r.currentTime+.1);return l.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+d),this.moved=!0,this.stalled=null,r.currentTime=d,t&&n.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+d,frag:t}),d}o=r.buffered.end(a)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<t.nudgeMaxRetry){var o=r+i*t.nudgeOffset;l.logger.warn("Nudging 'currentTime' from "+r+" to "+o),n.currentTime=o,e.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else l.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}();function ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var pt=function(t){var e,n;function r(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(n=t.call.apply(t,[this,e].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(ft(n)),n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(h);var vt="STOPPED",mt="STARTING",gt="IDLE",At="PAUSED",yt="KEY_LOADING",bt="FRAG_LOADING",wt="FRAG_LOADING_WAITING_RETRY",Et="WAITING_TRACK",_t="PARSING",St="PARSED",Tt="BUFFER_FLUSHING",Ct="ENDED",xt="ERROR",Rt="WAITING_INIT_PTS",It="WAITING_LEVEL",Ot=function(t){var e,n;function r(){return t.apply(this,arguments)||this}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=vt},i._streamEnded=function(t,e){var n=this.fragCurrent,r=this.fragmentTracker;if(!e.live&&n&&!n.backtracked&&n.sn===e.endSN&&!t.nextStart){var i=r.getState(n);return i===F||i===H}return!1},i.onMediaSeeking=function(){var t=this.config,e=this.media,n=this.mediaBuffer,r=this.state,i=e?e.currentTime:null,o=G.bufferInfo(n||e,i,this.config.maxBufferHole);if(l.logger.log("media seeking to "+(Object(c.isFiniteNumber)(i)?i.toFixed(3):i)),r===bt){var a=this.fragCurrent;if(0===o.len&&a){var s=t.maxFragLookUpTolerance,u=a.start-s,d=a.start+a.duration+s;i<u||i>d?(a.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=gt):l.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===Ct&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=gt);e&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=vt,this.fragmentTracker=null},i.computeLivePosition=function(t,e){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-n)},r}(pt);function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Lt,kt=function(t){var e,n;function r(e,n){var r;return(r=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=e.config,r.audioCodecSwap=!1,r._state=vt,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,a,d,h=r.prototype;return h.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}e>0&&-1===t&&(l.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=gt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=vt},h.stopLoad=function(){this.forceStartLoad=!1,t.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case Tt:this.fragLoadError=0;break;case gt:this._doTickIdle();break;case It:var t=this.levels[this.level];t&&t.details&&(this.state=gt);break;case wt:var e=window.performance.now(),n=this.retryDate;(!n||e>=n||this.media&&this.media.seeking)&&(l.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=gt)}this._checkBuffer(),this._checkFragmentChanged()},h._doTickIdle=function(){var t=this.hls,e=t.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&e.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=t.nextLoadLevel,o=this.levels[i];if(o){var a,s=o.bitrate;a=s?Math.max(8*e.maxBufferSize/s,e.maxBufferLength):e.maxBufferLength,a=Math.min(a,e.maxMaxBufferLength);var c=r<e.maxBufferHole?Math.max(2,e.maxBufferHole):e.maxBufferHole,d=G.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,c),h=d.len;if(!(h>=a)){l.logger.trace("buffer length of "+h.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=i;var f=o.details;if(!f||f.live&&this.levelLastLoaded!==i)this.state=It;else{if(this._streamEnded(d,f)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(u.default.BUFFER_EOS,p),void(this.state=Ct)}this._fetchPayloadOrEos(r,d,f)}}}}},h._fetchPayloadOrEos=function(t,e,n){var r=this.fragPrevious,i=(this.level,n.fragments),o=i.length;if(0!==o){var a,s=i[0].start,c=i[o-1].start+i[o-1].duration,u=e.end;if(n.initSegment&&!n.initSegment.data)a=n.initSegment;else if(n.live){var d=this.config.initialLiveManifestSize;if(o<d)return void l.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+d);if(null===(a=this._ensureFragmentAtLivePoint(n,u,s,c,r,i)))return}else u<s&&(a=i[0]);a||(a=this._findFragment(s,r,o,i,u,c,n)),a&&(a.encrypted?this._loadKey(a,n):this._loadFragment(a,n,t,u))}},h._ensureFragmentAtLivePoint=function(t,e,n,r,i,o){var a,s=this.hls.config,u=this.media,d=1/0;if(void 0!==s.liveMaxLatencyDuration?d=s.liveMaxLatencyDuration:Object(c.isFiniteNumber)(s.liveMaxLatencyDurationCount)&&(d=s.liveMaxLatencyDurationCount*t.targetduration),e<Math.max(n-s.maxFragLookUpTolerance,r-d)){var h=this.liveSyncPosition=this.computeLivePosition(n,t);e=h,u&&!u.paused&&u.readyState&&u.duration>h&&h>u.currentTime&&(l.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),u.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>r&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown&&i)if(t.hasProgramDateTime)l.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=ct(o,i.endProgramDateTime,s.maxFragLookUpTolerance);else{var f=i.sn+1;if(f>=t.startSN&&f<=t.endSN){var p=o[f-t.startSN];i.cc===p.cc&&(a=p,l.logger.log("live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=V.search(o,(function(t){return i.cc-t.cc})))&&l.logger.log("live playlist, switching playlist, load frag with same CC: "+a.sn)}return a},h._findFragment=function(t,e,n,r,i,o,a){var s,c=this.hls.config;i<o?s=ut(e,r,i,i>o-c.maxFragLookUpTolerance?0:c.maxFragLookUpTolerance):s=r[n-1];if(s){var u=s.sn-a.startSN,d=e&&s.level===e.level,h=r[u-1],f=r[u+1];if(e&&s.sn===e.sn)if(d&&!s.backtracked)if(s.sn<a.endSN){var p=e.deltaPTS;p&&p>c.maxBufferHole&&e.dropped&&u?(s=h,l.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(s=f,this.fragmentTracker.getState(s)!==H&&l.logger.log("Re-loading fragment with SN: "+s.sn))}else s=null;else s.backtracked&&(f&&f.backtracked?(l.logger.warn("Already backtracked from fragment "+f.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+f.sn),s=f):(l.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,h?(s=h).backtracked=!0:u&&(s=null)))}return s},h._loadKey=function(t,e){l.logger.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level),this.state=yt,this.hls.trigger(u.default.KEY_LOADING,{frag:t})},h._loadFragment=function(t,e,n,r){var i=this.fragmentTracker.getState(t);this.fragCurrent=t,"initSegment"!==t.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||i===U||i===F?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,l.logger.log("Loading "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new $(this.hls,"main")),this.state=bt):i===D&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},h.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,o.MAIN)},h.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},h._checkFragmentChanged=function(){var t,e,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((e=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),G.isBuffered(n,e)?t=this.getBufferedFrag(e):G.isBuffered(n,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var r=t;if(r!==this.fragPlaying){this.hls.trigger(u.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},h.immediateLevelSwitch=function(){if(l.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t,e=this.media;e?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,t.currentTime>0&&G.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},h.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,n=this.getBufferedFrag(t.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),t.paused)e=0;else{var r=this.hls.nextLoadLevel,i=this.levels[r],o=this.fragLastKbps;e=o&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*o)+1:0}var a=this.getBufferedFrag(t.currentTime+e);if(a){var s=this.followingBufferedFrag(a);if(s){var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null;var u=Math.max(a.endPTS,s.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,s.duration));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},h.flushMainBuffer=function(t,e){this.state=Tt;var n={startOffset:t,endOffset:e};this.altAudio&&(n.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,n)},h.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new ht(n,e,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach((function(t){t.details&&t.details.fragments.forEach((function(t){t.backtracked=void 0}))})),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},h.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(c.isFiniteNumber)(e)&&l.logger.log("media seeked to "+e.toFixed(3)),this.tick()},h.onManifestLoading=function(){l.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},h.onManifestParsed=function(t){var e,n=!1,r=!1;t.levels.forEach((function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(n=!0),-1!==e.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&l.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=t.altAudio,this.levels=t.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},h.onLevelLoaded=function(t){var e=t.details,n=t.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],o=e.totalduration,a=0;if(l.logger.log("level "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+o),e.live){var s=i.details;s&&e.fragments.length>0?(nt(s,e),a=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,s),e.PTSKnown&&Object(c.isFiniteNumber)(a)?l.logger.log("live playlist sliding:"+a.toFixed(3)):(l.logger.log("live playlist - outdated PTS, unknown sliding"),st(this.fragPrevious,r,e))):(l.logger.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,st(this.fragPrevious,r,e))}else e.PTSKnown=!1;if(i.details=e,this.levelLastLoaded=n,this.hls.trigger(u.default.LEVEL_UPDATED,{details:e,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=e.startTimeOffset;Object(c.isFiniteNumber)(d)?(d<0&&(l.logger.log("negative start time offset "+d+", count from end of last fragment"),d=a+o+d),l.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):e.live?(this.startPosition=this.computeLivePosition(a,e),l.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===It&&(this.state=gt),this.tick()},h.onKeyLoaded=function(){this.state===yt&&(this.state=gt,this.tick())},h.onFragLoaded=function(t){var e=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,o=t.frag;if(this.state===bt&&e&&"main"===o.type&&o.level===e.level&&o.sn===e.sn){var a=t.stats,s=r[e.level],c=s.details;if(this.bitrateTest=!1,this.stats=a,l.logger.log("Loaded "+e.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e.level),o.bitrateTest&&n.nextLoadLevel)this.state=gt,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:a,frag:e,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=gt,a.tparsed=a.tbuffered=window.performance.now(),c.initSegment.data=t.payload,n.trigger(u.default.FRAG_BUFFERED,{stats:a,frag:e,id:"main"}),this.tick();else{l.logger.log("Parsing "+e.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e.level+", cc "+e.cc),this.state=_t,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var d=!(i&&i.seeking)&&(c.PTSKnown||!c.live),h=c.initSegment?c.initSegment.data:[],f=this._getAudioCodec(s);(this.demuxer=this.demuxer||new $(this.hls,"main")).push(t.payload,h,f,s.videoCodec,e,c.totalduration,d)}}this.fragLoadError=0},h.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===_t){var r,i,o=t.tracks;if(this.audioOnly=o.audio&&!o.video,this.altAudio&&!this.audioOnly&&delete o.audio,i=o.audio){var a=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===s.indexOf("firefox")&&(a="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(a="mp4a.40.2",l.logger.log("Android: force audio codec to "+a)),i.levelCodec=a,i.id=t.id}for(r in(i=o.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=t.id),this.hls.trigger(u.default.BUFFER_CODECS,o),o){i=o[r],l.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var c=i.initSegment;c&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:r,data:c,parent:"main",content:"initSegment"}))}this.tick()}},h.onFragParsingData=function(t){var e=this,n=this.fragCurrent,r=t.frag;if(n&&"main"===t.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==t.type||!this.altAudio)&&this.state===_t){var i=this.levels[this.level],o=n;if(Object(c.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),!0===t.hasAudio&&o.addElementaryStream(v.AUDIO),!0===t.hasVideo&&o.addElementaryStream(v.VIDEO),l.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(o.dropped=t.dropped,o.dropped)if(o.backtracked)l.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return l.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=gt,this.fragPrevious=o,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();l.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var s=et(i.details,o,t.startPTS,t.endPTS,t.startDTS,t.endDTS),d=this.hls;d.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach((function(n){n&&n.length&&e.state===_t&&(e.appended=!0,e.pendingBuffering=!0,d.trigger(u.default.BUFFER_APPENDING,{type:t.type,data:n,parent:"main",content:"data"}))})),this.tick()}},h.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===_t&&(this.stats.tparsed=window.performance.now(),this.state=St,this._checkAppendedParsed())},h.onAudioTrackSwitching=function(t){var e=this.altAudio,n=!!t.url,r=t.id;if(!n){if(this.mediaBuffer!==this.media){l.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(l.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=gt}var o=this.hls;e&&o.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:r})}},h.onAudioTrackSwitched=function(t){var e=t.id,n=!!this.hls.audioTracks[e].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(l.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},h.onBufferCreated=function(t){var e,n,r=t.tracks,i=!1;for(var o in r){var a=r[o];"main"===a.id?(n=o,e=a,"video"===o&&(this.videoBuffer=r[o].buffer)):i=!0}i&&e?(l.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},h.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==_t&&e!==St||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},h._checkAppendedParsed=function(){if(!(this.state!==St||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;l.logger.log("main buffered : "+ot.toString(e.buffered)),this.fragPrevious=t;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.state=gt}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},h.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var n=!!this.media&&G.isBuffered(this.media,this.media.currentTime)&&G.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);l.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=wt}else l.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=xt;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==xt&&(t.fatal?(this.state=xt,l.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==It||(this.state=gt));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==_t&&this.state!==St||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=gt):(l.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},h._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,l.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},h._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},h.onFragLoadEmergencyAborted=function(){this.state=gt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},h.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;if(t){var e=this.audioOnly?v.AUDIO:v.VIDEO;this.fragmentTracker.detectEvictedFragments(e,t.buffered)}this.state=gt,this.fragPrevious=null},h.onLevelsUpdated=function(t){this.levels=t.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h._seekToStartPos=function(){var t=this.media,e=t.currentTime,n=this.startPosition;if(e!==n&&n>=0){if(t.seeking)return void l.logger.log("could not seek to "+n+", already seeking at "+e);var r=(t.buffered.length?t.buffered.start(0):0)-n;r>0&&r<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),l.logger.log("seek to target start position "+n+" from current time "+e+". ready state "+t.readyState),t.currentTime=n}},h._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},i=r,(a=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,l.logger.log("main stream-controller: "+e+"->"+t),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}])&&Mt(i.prototype,a),d&&Mt(i,d),r}(Ot);function Bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Nt=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,Lt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,c=r.prototype;return c.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},c.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},c.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach((function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)})),null!==this.timer&&this.loadLevel()},c.stopLoad=function(){this.canload=!1},c.onManifestLoaded=function(t){var e,n=[],r=[],i={},o=null,a=!1,c=!1;if(t.levels.forEach((function(t){var e=t.attrs;t.loadError=0,t.fragmentError=!1,a=a||!!t.videoCodec,c=c||!!t.audioCodec,Lt&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(o=i[t.bitrate])?o.url.push(t.url):(t.url=[t.url],t.urlId=0,i[t.bitrate]=t,n.push(t)),e&&(e.AUDIO&&Z(o||t,"audio",e.AUDIO),e.SUBTITLES&&Z(o||t,"text",e.SUBTITLES))})),a&&c&&(n=n.filter((function(t){return!!t.videoCodec}))),n=n.filter((function(t){var e=t.audioCodec,n=t.videoCodec;return(!e||T(e,"audio"))&&(!n||T(n,"video"))})),t.audioTracks&&(r=t.audioTracks.filter((function(t){return!t.audioCodec||T(t.audioCodec,"audio")}))).forEach((function(t,e){t.id=e})),n.length>0){e=n[0].bitrate,n.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===e){this._firstLevel=d,l.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+e);break}var h=c&&!a;this.hls.trigger(u.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:t.stats,audio:c,video:a,altAudio:!h&&r.some((function(t){return!!t.url}))})}else this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},c.setLevelInternal=function(t){var e=this._levels,n=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){l.logger.log("switching to level "+t),this.currentLevelIndex=t;var r=e[t];r.level=t,n.trigger(u.default.LEVEL_SWITCHING,r)}var i=e[t],o=i.details;if(!o||o.live){var a=i.urlId;n.trigger(u.default.LEVEL_LOADING,{url:i.url[a],level:t,id:a})}}else n.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},c.onError=function(t){if(t.fatal)t.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var e,n=!1,r=!1;switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:e=t.frag.level,r=!0;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=t.context.level,n=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:e=t.level,n=!0}void 0!==e&&this.recoverLevel(t,e,n,r)}},c.recoverLevel=function(t,e,n,r){var i,o,a,s=this,c=this.hls.config,u=t.details,d=this._levels[e];if(d.loadError++,d.fragmentError=r,n){if(!(this.levelRetryCount+1<=c.levelLoadingMaxRetry))return l.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);o=Math.min(Math.pow(2,this.levelRetryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return s.loadLevel()}),o),t.levelRetry=!0,this.levelRetryCount++,l.logger.warn("level controller, "+u+", retry in "+o+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=d.url.length)>1&&d.loadError<i?(d.urlId=(d.urlId+1)%i,d.details=void 0,l.logger.warn("level controller, "+u+" for level "+e+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(a=0===e?this._levels.length-1:e-1,l.logger.warn("level controller, "+u+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):r&&(l.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},c.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var n=this._levels[e.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},c.onLevelLoaded=function(t){var e=this,n=t.level,r=t.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var o=it(i.details,r,t.stats.trequest);l.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout((function(){return e.loadLevel()}),o)}else this.clearTimer()}},c.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===e){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},c.loadLevel=function(){if(l.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"==typeof t&&t.url.length>0){var e=this.currentLevelIndex,n=t.urlId,r=t.url[n];l.logger.log("Attempt loading level index "+e+" with URL-id "+n),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:e,id:n})}}},c.removeLevel=function(t,e){var n=this.levels.filter((function(n,r){return r!==t||n.url.length>1&&void 0!==e&&(n.url=n.url.filter((function(t,n){return n!==e})),n.urlId=0,!0)})).map((function(t,e){var n=t.details;return n&&n.fragments&&n.fragments.forEach((function(t){t.level=e})),t}));this._levels=n,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:n})},i=r,(o=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&Bt(i.prototype,o),a&&Bt(i,a),r}(h),Pt=n("./src/demux/id3.js");function Ut(t,e){var n;try{n=new Event("addtrack")}catch(t){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function Dt(t){if(null==t?void 0:t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}var Ft=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(t){this.media=t.media,this.media},i.onMediaDetaching=function(){Dt(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(t){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return Ut(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(t){var e=t.frag,n=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var o=Pt.default.getID3Frames(n[i].data);if(o){var a=Math.max(n[i].pts,0),s=i<n.length-1?n[i+1].pts:e.endPTS;s||(s=e.start+e.duration),s-a<=0&&(s=a+.25);for(var c=0;c<o.length;c++){var u=o[c];if(!Pt.default.isTimeStampFrame(u)){var l=new r(a,s,"");l.value=u,this.id3Track.addCue(l)}}}}},i.onLiveBackBufferReached=function(t){var e=t.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(t,e){if(e<t[0].endTime)return t[0];if(e>t[t.length-1].endTime)return t[t.length-1];for(var n=0,r=t.length-1;n<=r;){var i=Math.floor((r+n)/2);if(e<t[i].endTime)r=i-1;else{if(!(e>t[i].endTime))return t[i];n=i+1}}return t[n].endTime-e<e-t[r].endTime?t[n]:t[r]}(n.cues,e);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(h);var Ht=function(){function t(t){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}var e=t.prototype;return e.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}(),jt=function(){function t(t,e,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=t,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ht(e),this.fast_=new Ht(n)}var e=t.prototype;return e.sample=function(t,e){var n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();function Vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Gt=window.performance,Qt=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=e,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n)),n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,d=r.prototype;return d.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},d.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,o=i.config,a=e.level;i.levels[a].details.live?(n=o.abrEwmaFastLive,r=o.abrEwmaSlowLive):(n=o.abrEwmaFastVoD,r=o.abrEwmaSlowVoD),this._bwEstimator=new jt(i,r,n,o.abrEwmaDefaultEstimate)}},d._abandonRulesCheck=function(){var t=this.hls,e=t.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(e&&i&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&n.autoLevel&&n.level){var o=Gt.now()-i.trequest,a=Math.abs(e.playbackRate);if(o>500*n.duration/a){var s=t.levels,c=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/o),d=s[n.level];if(!d)return;var h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,f=i.total?i.total:Math.max(i.loaded,Math.round(n.duration*h/8)),p=e.currentTime,v=(f-i.loaded)/c,m=(G.bufferInfo(e,p,t.config.maxBufferHole).end-p)/a;if(m<2*n.duration/a&&v>m){var g,A,y=t.minAutoLevel;for(A=n.level-1;A>y;A--){var b=s[A].realBitrate?Math.max(s[A].realBitrate,s[A].bitrate):s[A].bitrate;if(n.duration*b/(6.4*c)<m)break}g<v&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+A+":fragLoadedDelay["+A+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+g.toFixed(1)+"<"+v.toFixed(1)+":"+m.toFixed(1)),t.nextLoadLevel=A,this._bwEstimator.sample(o,i.loaded),r.abort(),this.clearTimer(),t.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}},d.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&Object(c.isFiniteNumber)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[e.level],r=(n.loaded?n.loaded.bytes:0)+t.stats.loaded,i=(n.loaded?n.loaded.duration:0)+t.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(t.frag.bitrateTest){var o=t.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(t)}}},d.onFragBuffered=function(t){var e=t.stats,n=t.frag;if(!0!==e.aborted&&"main"===n.type&&Object(c.isFiniteNumber)(n.sn)&&(!n.bitrateTest||e.tload===e.tbuffered)){var r=e.tparsed-e.trequest;l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(r,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},d.onError=function(t){switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},d.clearTimer=function(){clearInterval(this.timer),this.timer=null},d._findBestLevel=function(t,e,n,r,i,o,a,s,c){for(var u=i;u>=r;u--){var d=c[u];if(d){var h=d.details,f=h?h.totalduration/h.fragments.length:e,p=!!h&&h.live,v=void 0;v=u<=t?a*n:s*n;var m=c[u].realBitrate?Math.max(c[u].realBitrate,c[u].bitrate):c[u].bitrate,g=m*f/v;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(v)+"/"+m+"/"+f+"/"+o+"/"+g),v>m&&(!g||p&&!this.bitrateTestDelay||g<o))return u}}return-1},i=r,(o=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var n=this._nextABRAutoLevel;return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,n=t.levels,r=t.config,i=t.minAutoLevel,o=t.media,a=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,c=o?o.currentTime:0,u=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,h=(G.bufferInfo(o,c,r.maxBufferHole).end-c)/u,f=this._findBestLevel(a,s,d,i,e,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(f>=0)return f;l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,v=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===h){var g=this.bitrateTestDelay;g&&(p=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,l.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),v=m=1)}return f=this._findBestLevel(a,s,d,i,e,h+p,v,m,n),Math.max(f,0)}}])&&Vt(i.prototype,o),a&&Vt(i,a),r}(h);var zt=W(),qt=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){l.logger.log("media source opened"),n.hls.trigger(u.default.MEDIA_ATTACHED,{media:n.media});var t=n.mediaSource;t&&t.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){l.logger.log("media source closed")},n._onMediaSourceEnded=function(){l.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var t=n.sourceBuffer.audio;l.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+n.audioTimestampOffset),t.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var e=n.parent,r=n.segments.reduce((function(t,n){return n.parent===e?t+1:t}),0),i={},o=n.sourceBuffer;for(var a in o){var s=o[a];if(!s)throw Error("handling source buffer update end error: source buffer for "+a+" uninitilized and unable to update buffered TimeRanges.");i[a]=s.buffered}n.hls.trigger(u.default.BUFFER_APPENDED,{parent:e,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(t){l.logger.error("sourceBuffer error:",t),n.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=e.config,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(t){var e=t.type,n=this.tracks.audio;if("audio"===e&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-t.start)>.1){var i=r.updating;try{r.abort()}catch(t){l.logger.warn("can not abort audio buffer: "+t)}i?this.audioTimestampOffset=t.start:(l.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+t.start),r.timestampOffset=t.start)}}},i.onManifestParsed=function(t){var e=2;(t.audio&&!t.video||!t.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(t){var e=this.media=t.media;if(e&&zt){var n=this.mediaSource=new zt;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),e.src=window.URL.createObjectURL(n),this._objectUrl=e.src}},i.onMediaDetaching=function(){l.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){l.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.pendingTracks,n=Object.keys(e).length;(n&&!t||2===n)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var n=t[e];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(t){var e=this;Object.keys(this.sourceBuffer).length||(Object.keys(t).forEach((function(n){e.pendingTracks[n]=t[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(t){var e=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in t)if(!e[r]){var i=t[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var o=i.levelCodec||i.codec,a=i.container+";codecs="+o;l.logger.log("creating sourceBuffer("+a+")");try{var c=e[r]=n.addSourceBuffer(a);c.addEventListener("updateend",this._onSBUpdateEnd),c.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:c,codec:o,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(t){l.logger.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:a})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},i.onBufferEos=function(t){for(var e in this.sourceBuffer)if(!t.type||t.type===e){var n=this.sourceBuffer[e];n&&!n.ended&&(n.ended=!0,l.logger.log(e+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var n in t){var r=t[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(t){t.type?this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}):(this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"video"}),this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var t=this.config.liveBackBufferLength;if(isFinite(t)&&!(t<0))if(this.media)for(var e=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=e-Math.max(t,this._levelTargetDuration),o=r.length-1;o>=0;o--){var a=r[o],s=n[a];if(s){var c=s.buffered;c.length>0&&i>c.start(0)&&this.removeBufferRange(a,s,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else l.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var t,e=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(c.isFiniteNumber)(t))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(e+=i.buffered.length)}}catch(t){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(u.default.BUFFER_FLUSHED)}},i.doAppending=function(){var t=this.config,e=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var o=r[i.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void n.unshift(i);o.ended=!1,this.parent=i.parent,o.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){l.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var a={type:s.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],a.details=s.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,a.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.appendErrorMaxRetry&&(l.logger.log("fail "+t.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],a.fatal=!0)),e.trigger(u.default.ERROR,a)}}}},i.flushBuffer=function(t,e,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),l.logger.log("flushBuffer,pos/start/end: "+i+"/"+t+"/"+e),this.flushBufferCounter>=this.appended)return l.logger.warn("abort flushing too many retries"),!0;var o=r[n];if(o){if(o.ended=!1,o.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,o,t,e))return this.flushBufferCounter++,!1}return l.logger.log("buffer flushed"),!0},i.removeBufferRange=function(t,e,n,r){try{for(var i=0;i<e.buffered.length;i++){var o=e.buffered.start(i),a=e.buffered.end(i),s=Math.max(o,n),c=Math.min(a,r);if(Math.min(c,a)-s>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),l.logger.log("sb remove "+t+" ["+s+","+c+"], of ["+o+","+a+"], pos:"+u),e.remove(s,c),!0}}}catch(t){l.logger.warn("removeBufferRange failed",t)}return!1},r}(h);function Wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Kt=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},s.onFpsDropLevelCapping=function(t){r.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},s.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},s.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onLevelsUpdated=function(t){this.levels=t.levels},s.onMediaDetaching=function(){this.stopCapping()},s.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},s.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return r.isLevelAllowed(i,e.restrictedLevels)&&i<=t}));return this.clientRect=null,r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e},r.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},r.getMaxLevelByMediaSize=function(t,e,n){if(!t||t&&!t.length)return-1;for(var r,i,o=t.length-1,a=0;a<t.length;a+=1){var s=t[a];if((s.width>=e||s.height>=n)&&(r=s,!(i=t[a+1])||r.width!==i.width||r.height!==i.height)){o=a;break}}return o},i=r,a=[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}],(o=[{key:"mediaWidth",get:function(){return this.getDimensions().width*r.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*r.contentScaleFactor}}])&&Wt(i.prototype,o),a&&Wt(i,a),r}(h);var Xt=window.performance,Jt=function(t){var e,n;function r(e){return t.call(this,e,u.default.MEDIA_ATTACHING)||this}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},i.checkFPS=function(t,e,n){var r=Xt.now();if(e){if(this.lastTime){var i=r-this.lastTime,o=n-this.lastDroppedFrames,a=e-this.lastDecodedFrames,s=1e3*o/i,c=this.hls;if(c.trigger(u.default.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),s>0&&o>c.config.fpsDroppedMonitoringThreshold*a){var d=c.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=d)&&(d-=1,c.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,c.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},i.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},r}(h),Yt=function(){function t(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}var e=t.prototype;return e.destroy=function(){this.abort(),this.loader=null},e.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.load=function(t,e,n){this.context=t,this.config=e,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t,e=this.context;t=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(t,e.url)}catch(n){t.open("GET",e.url,!0),r(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(n){return void this.callbacks.onError({code:t.status,text:n.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},e.readystatechange=function(t){var e=t.currentTarget,n=e.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),4===n){var a=e.status;if(a>=200&&a<300){var s,c;r.tload=Math.max(r.tfirst,window.performance.now()),c="arraybuffer"===i.responseType?(s=e.response).byteLength:(s=e.responseText).length,r.loaded=r.total=c;var u={url:e.responseURL,data:s};this.callbacks.onSuccess(u,r,i,e)}else r.retry>=o.maxRetry||a>=400&&a<499?(l.logger.error(a+" while loading "+i.url),this.callbacks.onError({code:a,text:e.statusText},i,e)):(l.logger.warn(a+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},e.loadtimeout=function(){l.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.loadprogress=function(t){var e=t.currentTarget,n=this.stats;n.loaded=t.loaded,t.lengthComputable&&(n.total=t.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,e)},t}();function $t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Zt=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,c=r.prototype;return c.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},c.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},c.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)l.logger.warn("Invalid audio track id:",t.id);else{if(l.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},c.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},c.onLevelLoaded=function(t){this._selectAudioGroup(t.level)},c.onError=function(t){t.type===s.ErrorTypes.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(l.logger.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},c._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)l.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)l.logger.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];l.logger.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var n=e.url,r=e.type,i=e.id;this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(e)}},c.doTick=function(){this._updateTrack(this._trackId)},c._selectAudioGroup=function(t){var e=this.hls.levels[t];if(e&&e.audioGroupIds){var n=e.audioGroupIds[e.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},c._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=e.filter((function(t){return t.default}));i.length?e=i:l.logger.warn("No default audio tracks defined")}var o=!1,a=function(){e.forEach((function(e){o||t.audioGroupId&&e.groupId!==t.audioGroupId||r&&r!==e.name||(t._setAudioTrack(e.id),o=!0)}))};a(),o||(r=null,a()),o||(l.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},c._needsTrackLoading=function(t){var e=t.details,n=t.url;return!(e&&!e.live)&&!!n},c._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,n=t.id;l.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:e,id:n})}},c._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,l.logger.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},c._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],n=e.name,r=e.language,i=e.groupId;l.logger.warn("Loading failed on audio track id: "+t+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var o=t,a=0;a<this.tracks.length;a++){if(!this.trackIdBlacklist[a])if(this.tracks[a].name===n){o=a;break}}o!==t?(l.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):l.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(o=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}])&&$t(i.prototype,o),a&&$t(i,a),r}(pt);function te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ee=window.performance,ne=function(t){var e,n;function r(e,n){var r;return(r=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=e.config,r.audioCodecSwap=!1,r._state=vt,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,d=r.prototype;return d.onInitPtsFound=function(t){var e=t.id,n=t.frag.cc,r=t.initPTS;"main"===e&&(this.initPTS[n]=r,this.videoTrackCC=n,l.logger.log("InitPTS for cc: "+n+" found from main: "+r),this.state===Rt&&this.tick())},d.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(l.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=gt):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=mt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=vt},d.doTick=function(){var t,e,n,r=this.hls,i=r.config;switch(this.state){case xt:case At:case Tt:break;case mt:this.state=Et,this.loadedmetadata=!1;break;case gt:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var a=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,d=t<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,h=G.bufferInfo(a,t,d),f=G.bufferInfo(s,t,d),p=h.len,v=h.end,m=this.fragPrevious,g=Math.min(i.maxBufferLength,i.maxMaxBufferLength),A=Math.max(g,f.len),y=this.audioSwitch,b=this.trackId;if((p<A||y)&&b<o.length){if(void 0===(n=o[b].details)){this.state=Et;break}if(!y&&this._streamEnded(h,n))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=Ct);var w,E=n.fragments,_=E.length,S=E[0].start,T=E[_-1].start+E[_-1].duration;if(y)if(n.live&&!n.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),v=0;else if(v=t,n.PTSKnown&&t<S){if(!(h.end>S||h.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=S+.05}if(n.initSegment&&!n.initSegment.data)w=n.initSegment;else if(v<=S){if(w=E[0],null!==this.videoTrackCC&&w.cc!==this.videoTrackCC&&(w=function(t,e){return V.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}(E,this.videoTrackCC)),n.live&&w.loadIdx&&w.loadIdx===this.fragLoadIdx){var C=h.nextStart?h.nextStart:S;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(C+.05)),void(this.media.currentTime=C+.05)}}else{var x,R=i.maxFragLookUpTolerance,I=m?E[m.sn-E[0].sn+1]:void 0;v<T?(v>T-R&&(R=0),x=I&&!lt(v,R,I)?I:V.search(E,(function(t){return lt(v,R,t)}))):x=E[_-1],x&&(w=x,S=x.start,m&&w.level===m.level&&w.sn===m.sn&&(w.sn<n.endSN?(w=E[w.sn+1-n.startSN],this.fragmentTracker.getState(w)!==H&&l.logger.log("SN just loaded, load next one: "+w.sn)):w=null))}w&&(w.encrypted?(l.logger.log("Loading key for "+w.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+b),this.state=yt,r.trigger(u.default.KEY_LOADING,{frag:w})):(this.fragCurrent=w,(y||this.fragmentTracker.getState(w)===U)&&(l.logger.log("Loading "+w.sn+", cc: "+w.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+b+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+t+", bufferEnd: "+v.toFixed(3)),"initSegment"!==w.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(w.sn)&&(this.nextLoadPosition=w.start+w.duration),r.trigger(u.default.FRAG_LOADING,{frag:w}),this.state=bt)))}break;case Et:(e=this.tracks[this.trackId])&&e.details&&(this.state=gt);break;case wt:var O=ee.now(),M=this.retryDate,L=(a=this.media)&&a.seeking;(!M||O>=M||L)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=gt);break;case Rt:var k=this.waitingFragment;if(k){var B=k.frag.cc;if(void 0!==this.initPTS[B])this.waitingFragment=null,this.state=bt,this.onFragLoaded(k);else if(this.videoTrackCC!==this.waitingVideoCC)l.logger.log("Waiting fragment cc ("+B+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var N=G.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole);lt(N.end,i.maxFragLookUpTolerance,k.frag)<0&&(l.logger.log("Waiting fragment cc ("+B+") @ "+k.frag.start+" cancelled because another fragment at "+N.end+" is needed"),this.clearWaitingFragment())}}else this.state=gt}},d.clearWaitingFragment=function(){var t=this.waitingFragment;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=gt)},d.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},d.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onAudioTracksUpdated=function(t){l.logger.log("audio tracks updated"),this.tracks=t.audioTracks},d.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=At,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=gt),this.tick()},d.onAudioTrackLoaded=function(t){var e=t.details,n=t.id,r=this.tracks[n],i=e.totalduration,o=0;if(l.logger.log("track "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+i),e.live){var a=r.details;a&&e.fragments.length>0?(nt(a,e),o=e.fragments[0].start,e.PTSKnown?l.logger.log("live audio playlist sliding:"+o.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(r.details=e,!this.startFragRequested){if(-1===this.startPosition){var s=e.startTimeOffset;Object(c.isFiniteNumber)(s)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):e.live?(this.startPosition=this.computeLivePosition(o,e),l.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===Et&&(this.state=gt),this.tick()},d.onKeyLoaded=function(){this.state===yt&&(this.state=gt,this.tick())},d.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag;if(this.state===bt&&e&&"audio"===n.type&&n.level===e.level&&n.sn===e.sn){var r=this.tracks[this.trackId],i=r.details,o=i.totalduration,a=e.level,s=e.sn,c=e.cc,d=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",h=this.stats=t.stats;if("initSegment"===s)this.state=gt,h.tparsed=h.tbuffered=ee.now(),i.initSegment.data=t.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:h,frag:e,id:"audio"}),this.tick();else{this.state=_t,this.appended=!1,this.demuxer||(this.demuxer=new $(this.hls,"audio"));var f=this.initPTS[c],p=i.initSegment?i.initSegment.data:[];if(void 0!==f){this.pendingBuffering=!0,l.logger.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a);this.demuxer.push(t.payload,p,d,null,e,o,!1,f)}else l.logger.log("Unknown video PTS for cc "+c+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.waitingFragment=t,this.waitingVideoCC=this.videoTrackCC,this.state=Rt}}this.fragLoadError=0},d.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===_t){var r,i=t.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=t.id,this.hls.trigger(u.default.BUFFER_CODECS,i),l.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var o=r.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,a))}this.tick()}}},d.onFragParsingData=function(t){var e=this,n=this.fragCurrent,r=t.frag;if(n&&"audio"===t.id&&"audio"===t.type&&r.sn===n.sn&&r.level===n.level&&this.state===_t){var i=this.trackId,o=this.tracks[i],a=this.hls;Object(c.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),n.addElementaryStream(v.AUDIO),l.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),et(o.details,n,t.startPTS,t.endPTS);var d=this.media,h=!1;if(this.audioSwitch)if(d&&d.readyState){var f=d.currentTime;l.logger.log("switching audio track : currentTime:"+f),f>=t.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=Tt,a.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h=!0,this.audioSwitch=!1,a.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,a.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i});var p=this.pendingData;if(!p)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach((function(e){e&&e.length&&p.push({type:t.type,data:e,parent:"audio",content:"data"})})),!h&&p.length&&(p.forEach((function(t){e.state===_t&&(e.pendingBuffering=!0,e.hls.trigger(u.default.BUFFER_APPENDING,t))})),this.pendingData=[],this.appended=!0)),this.tick()}},d.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===_t&&(this.stats.tparsed=ee.now(),this.state=St,this._checkAppendedParsed())},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},d.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==_t&&e!==St||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},d._checkAppendedParsed=function(){if(!(this.state!==St||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,n=this.hls;if(t){this.fragPrevious=t,e.tbuffered=ee.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&l.logger.log("audio buffered : "+ot.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=gt}this.tick()}},d.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=t.frag;if(n&&"audio"!==n.type)break;if(!t.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var o=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);l.logger.warn("AudioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=ee.now()+o,this.state=wt}else l.logger.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=xt}break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==xt&&(this.state=t.fatal?xt:gt,l.logger.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===_t||this.state===St)){var a=this.mediaBuffer,c=this.media.currentTime;if(a&&G.isBuffered(a,c)&&G.isBuffered(a,c+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=gt}else l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Tt,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},d.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach((function(e){t.hls.trigger(u.default.BUFFER_APPENDING,e)})),this.appended=!0,this.pendingData=[],this.state=St):(this.state=gt,this.fragPrevious=null,this.tick())},i=r,(o=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,l.logger.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}])&&te(i.prototype,o),a&&te(i,a),r}(Ot),re=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var t={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(t){return"string"==typeof t&&(!!e[t.toLowerCase()]&&t.toLowerCase())}function r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function i(e,i,o){var a=this,s={enumerable:!0};a.hasBeenReset=!1;var c="",u=!1,l=e,d=i,h=o,f=null,p="",v=!0,m="auto",g="start",A=50,y="middle",b=50,w="middle";Object.defineProperty(a,"id",r({},s,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(a,"pauseOnExit",r({},s,{get:function(){return u},set:function(t){u=!!t}})),Object.defineProperty(a,"startTime",r({},s,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",r({},s,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",r({},s,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",r({},s,{get:function(){return f},set:function(t){f=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",r({},s,{get:function(){return p},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",r({},s,{get:function(){return v},set:function(t){v=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",r({},s,{get:function(){return m},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",r({},s,{get:function(){return g},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",r({},s,{get:function(){return A},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");A=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",r({},s,{get:function(){return y},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",r({},s,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",r({},s,{get:function(){return w},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");w=e,this.hasBeenReset=!0}})),a.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),ie=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};function oe(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new ie,this.regionList=[]}function ae(){this.values=Object.create(null)}function se(t,e,n,r){var i=r?t.split(r):[t];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(n);if(2===a.length)e(a[0],a[1])}}ae.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,n){for(var r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var ce=new re(0,0,0),ue="middle"===ce.align?"middle":"center";function le(t,e,n){var r=t;function i(){var e=function(t){function e(t,e,n,r){return 3600*(0|t)+60*(0|e)+(0|n)+(0|r)/1e3}var n=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?e(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?e(n[1],n[2],0,n[4]):e(0,n[1],n[2],n[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function o(){t=t.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.substr(3),o(),e.endTime=i(),o(),function(t,e){var r=new ae;se(t,(function(t,e){switch(t){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===e){r.set(t,n[i].region);break}break;case"vertical":r.alt(t,e,["rl","lr"]);break;case"line":var o=e.split(","),a=o[0];r.integer(t,a),r.percent(t,a)&&r.set("snapToLines",!1),r.alt(t,a,["auto"]),2===o.length&&r.alt("lineAlign",o[1],["start",ue,"end"]);break;case"position":o=e.split(","),r.percent(t,o[0]),2===o.length&&r.alt("positionAlign",o[1],["start",ue,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,e);break;case"align":r.alt(t,e,["start",ue,"end","left","right"])}}),/:/,/\s/),e.region=r.get("region",null),e.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===ce.line&&(i=-1),e.line=i,e.lineAlign=r.get("lineAlign","start"),e.snapToLines=r.get("snapToLines",!0),e.size=r.get("size",100),e.align=r.get("align",ue);var o=r.get("position","auto");"auto"===o&&50===ce.position&&(o="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=o}(t,e)}function de(t){return t.replace(/<br(?: \/)?>/gi,"\n")}oe.prototype={parse:function(t){var e=this;function n(){var t=e.buffer,n=0;for(t=de(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var r=t.substr(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.substr(n),r}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var r;if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var o=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:r=n(),e.state){case"HEADER":/:/.test(r)?se(r,(function(t,e){}),/:/):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new re(0,0,""),e.state="CUE",-1===r.indexOf("--\x3e")){e.cue.id=r;continue}case"CUE":try{le(r,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(o=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+="\n"),e.cue.text+=r;continue;case"BADCUE":r||(e.state="ID");continue}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var he=oe;function fe(t,e,n,r){for(var i,o,a,s,c,u=[],l=window.VTTCue||TextTrackCue,d=0;d<r.rows.length;d++)if(a=!0,s=0,c="",!(i=r.rows[d]).isEmpty()){for(var h=0;h<i.chars.length;h++)i.chars[h].uchar.match(/\s/)&&a?s++:(c+=i.chars[h].uchar,a=!1);i.cueStartTime=e,e===n&&(n+=1e-4),o=new l(e,n,de(c.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?o.line=d+1:o.line=d>7?d-2:d+1,o.align="left",o.position=Math.max(0,Math.min(100,s/32*100)),u.push(o),t&&t.addCue(o)}return u}var pe,ve={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},me=function(t){var e=t;return ve.hasOwnProperty(t)&&(e=ve[t]),String.fromCharCode(e)},ge=15,Ae=100,ye={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},be={17:2,18:4,21:6,22:8,23:10,19:13,20:15},we={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ee={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_e=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(pe||(pe={}));var Se=function(){function t(){this.time=null,this.verboseLevel=pe.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&l.logger.log(this.time+" ["+t+"] "+e)},t}(),Te=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},Ce=function(){function t(t,e,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var r=e[n];t.hasOwnProperty(r)&&(this[r]=t[r])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),xe=function(){function t(t,e,n,r,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Ce(e,n,r,i,o)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),Re=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<Ae;e++)this.chars.push(new xe);this.logger=t,this.pos=0,this.currPenState=new Ce}var e=t.prototype;return e.equals=function(t){for(var e=!0,n=0;n<Ae;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<Ae;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<Ae;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(pe.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ae&&(this.logger.log(pe.DEBUG,"Too large cursor position "+this.pos),this.pos=Ae)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=me(t);this.pos>=Ae?this.logger.log(pe.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<Ae;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,n=0;n<Ae;n++){var r=this.chars[n].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),Ie=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<ge;e++)this.rows.push(new Re(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<ge;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,n=0;n<ge;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<ge;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<ge;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(pe.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(pe.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<ge;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime,a=this.logger.time;if(o&&null!==a&&o<a)for(var s=0;s<this.nrRollUpRows;s++)this.rows[e-this.nrRollUpRows+s+1].copy(i.rows[r+s])}}this.currRow=e;var c=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,l=Math.max(u-1,0);c.setCursor(t.indent),t.color=c.chars[l].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)},e.setBkgData=function(t){this.logger.log(pe.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(pe.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(pe.INFO,"Rolling up")}else this.logger.log(pe.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],n="",r=-1,i=0;i<ge;i++){var o=this.rows[i].getTextString();o&&(r=i+1,t?e.push("Row "+r+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},e.getTextAndFormat=function(){return this.rows},t}(),Oe=function(){function t(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Ie(n),this.nonDisplayedMemory=new Ie(n),this.lastOutputScreen=new Ie(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(pe.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(pe.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(pe.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(pe.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(pe.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(pe.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(pe.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(pe.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(pe.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(pe.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(pe.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(pe.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(pe.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(pe.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(pe.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(pe.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(pe.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(pe.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}();function Me(t,e,n){n.a=t,n.b=e}function Le(t,e,n){return n.a===t&&n.b===e}var ke=function(){function t(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Se;this.channels=[null,new Oe(t,e,r),new Oe(t+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var n,r,i,o=!1;this.logger.time=t;for(var a=0;a<e.length;a+=2)if(r=127&e[a],i=127&e[a+1],0!==r||0!==i){if(this.logger.log(pe.DATA,"["+Te([e[a],e[a+1]])+"] -> ("+Te([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(o=this.parseChars(r,i))){var s=this.currentChannel;if(s&&s>0)this.channels[s].insertChars(o);else this.logger.log(pe.WARNING,"No channel found yet. TEXT-MODE?")}n||o||this.logger.log(pe.WARNING,"Couldn't parse cleaned data "+Te([r,i])+" orig: "+Te([e[a],e[a+1]]))}},e.parseCmd=function(t,e){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=33&&e<=35))return!1;if(Le(t,e,n))return Me(null,null,n),this.logger.log(pe.DEBUG,"Repeated command ("+Te([t,e])+") is dropped"),!0;var r=20===t||21===t||23===t?1:2,i=this.channels[r];return 20===t||21===t||28===t||29===t?32===e?i.ccRCL():33===e?i.ccBS():34===e?i.ccAOF():35===e?i.ccAON():36===e?i.ccDER():37===e?i.ccRU(2):38===e?i.ccRU(3):39===e?i.ccRU(4):40===e?i.ccFON():41===e?i.ccRDC():42===e?i.ccTR():43===e?i.ccRTD():44===e?i.ccEDM():45===e?i.ccCR():46===e?i.ccENM():47===e&&i.ccEOC():i.ccTO(e-32),Me(t,e,n),this.currentChannel=r,!0},e.parseMidrow=function(t,e){var n=0;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(pe.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(e),this.logger.log(pe.DEBUG,"MIDROW ("+Te([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var n,r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((16===t||24===t)&&e>=64&&e<=95))return!1;if(Le(t,e,r))return Me(null,null,r),!0;var i=t<=23?1:2;n=e>=64&&e<=95?1===i?ye[t]:we[t]:1===i?be[t]:Ee[t];var o=this.channels[i];return!!o&&(o.setPAC(this.interpretPAC(n,e)),Me(t,e,r),this.currentChannel=i,!0)},e.interpretPAC=function(t,e){var n=e,r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},e.parseChars=function(t,e){var n,r=null,i=null;if(t>=25?(n=2,i=t-8):(n=1,i=t),i>=17&&i<=19){var o=e;o=17===i?e+80:18===i?e+112:e+144,this.logger.log(pe.INFO,"Special char '"+me(o)+"' in channel "+n),r=[o]}else t>=32&&t<=127&&(r=0===e?[t]:[t,e]);if(r){var a=Te(r);this.logger.log(pe.DEBUG,"Char codes =  "+a.join(",")),Me(t,e,this.cmdHistory)}return r},e.parseBackgroundAttributes=function(t,e){var n;if(!((16===t||24===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=45&&e<=47))return!1;var r={};16===t||24===t?(n=Math.floor((e-32)/2),r.background=_e[n],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));var i=t<=23?1:2;return this.channels[i].setBkgData(r),Me(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e];n&&n.cueSplitAtTime(t)}},t}(),Be=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[]},t}(),Ne=function(t,e,n){return t.substr(n||0,e.length)===e},Pe=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()},Ue={parse:function(t,e,n,r,i,o){var a,s=Object(Pt.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",l=0,d=0,h=0,f=[],p=!0,v=!1,m=new he;m.oncue=function(t){var e=n[r],i=n.ccOffset;e&&e.new&&(void 0!==d?i=n.ccOffset=e.start:function(t,e,n){var r=t[e],i=t[r.prevCC];if(!i||!i.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)t.ccOffset+=r.start-i.start,r.new=!1,i=t[(r=i).prevCC];t.presentationOffset=n}(n,r,h)),h&&(i=h-n.presentationOffset),v&&(t.startTime+=i-d,t.endTime+=i-d),t.id=Pe(t.startTime.toString())+Pe(t.endTime.toString())+Pe(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&f.push(t)},m.onparsingerror=function(t){a=t},m.onflush=function(){a&&o?o(a):i(f)},s.forEach((function(t){if(p){if(Ne(t,"X-TIMESTAMP-MAP=")){p=!1,v=!0,t.substr(16).split(",").forEach((function(t){Ne(t,"LOCAL:")?u=t.substr(6):Ne(t,"MPEGTS:")&&(l=parseInt(t.substr(7)))}));try{e+(9e4*n[r].start||0)<0&&(e+=8589934592),l-=e,d=function(t){var e=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),r=parseInt(t.substr(-9,2)),i=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(c.isFiniteNumber)(e)&&Object(c.isFiniteNumber)(n)&&Object(c.isFiniteNumber)(r)&&Object(c.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*n,e+=6e4*r,e+36e5*i}(u)/1e3,h=l/9e4}catch(t){v=!1,a=t}return}""===t&&(p=!1)}m.parse(t+"\n")})),m.flush()}};function De(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fe(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}var He=function(t){var e,n;function r(e){var n;if((n=t.call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=e,n.config=e.config,n.Cues=e.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var r=new Be(De(n),"textTrack1"),i=new Be(De(n),"textTrack2"),o=new Be(De(n),"textTrack3"),a=new Be(De(n),"textTrack4");n.cea608Parser1=new ke(1,r,i),n.cea608Parser2=new ke(3,o,a)}return n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.addCues=function(t,e,n,r,i){for(var o,a,s,c,l=!1,d=i.length;d--;){var h=i[d],f=(o=h[0],a=h[1],s=e,c=n,Math.min(a,c)-Math.max(o,s));if(f>=0&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],n),l=!0,f/(n-e)>.5))return}if(l||i.push([e,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],e,n,r);else{var p=this.Cues.newCue(null,e,n,r);this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:p,track:t})}},i.onInitPtsFound=function(t){var e=this,n=t.frag,r=t.id,i=t.initPTS,o=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),o.length&&(this.unparsedVttFrags=[],o.forEach((function(t){e.onFragLoaded(t)})))},i.getExistingTrack=function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var r=e.textTracks[n];if(r[t])return r}return null},i.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},i.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,n=this.captionsTracks,r=this.media,i=e[t],o=i.label,a=i.languageCode,s=this.getExistingTrack(t);if(s)n[t]=s,Dt(n[t]),Ut(n[t],r);else{var c=this.createTextTrack("captions",o,a);c&&(c[t]=!0,n[t]=c)}}},i.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(t,e,n){var r=this.media;if(r)return r.addTextTrack(t,e,n)},i.destroy=function(){t.prototype.destroy.call(this)},i.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},i.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){Dt(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)Dt(e[n])}},i.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=t.subtitles||[],r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=t.subtitles||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,n){var r;if(n<i.length){for(var o=null,a=0;a<i.length;a++)if(Fe(i[a],t)){o=i[a];break}o&&(r=o)}r||(r=e.createTextTrack("subtitles",t.name,t.lang)),t.default?r.mode=e.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",e.textTracks.push(r)}))}else if(!r&&this.tracks&&this.tracks.length){var o=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(t){var n=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(n){var r="textTrack"+n[1],i=e.captionsProperties[r];i&&(i.label=t.name,t.lang&&(i.languageCode=t.lang),i.media=t)}}))},i.onFragLoaded=function(t){var e=t.frag,n=t.payload,r=this.cea608Parser1,i=this.cea608Parser2,o=this.initPTS,a=this.lastSn,s=this.unparsedVttFrags;if("main"===e.type){var l=e.sn;e.sn!==a+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=l}else if("subtitle"===e.type)if(n.byteLength){if(!Object(c.isFiniteNumber)(o[e.cc]))return s.push(t),void(o.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e}));var d=e.decryptdata;null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(e,n)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},i._parseVTTs=function(t,e){var n=this,r=this.hls,i=this.prevCC,o=this.textTracks,a=this.vttCCs;a[t.cc]||(a[t.cc]={start:t.start,prevCC:i,new:!0},this.prevCC=t.cc),Ue.parse(e,this.initPTS[t.cc],a,t.cc,(function(e){if(n.config.renderTextTracksNatively){var i=o[t.level];if("disabled"===i.mode)return void r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});e.forEach((function(t){if(!i.cues.getCueById(t.id))try{if(i.addCue(t),!i.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(n){l.logger.debug("Failed occurred on adding cues: "+n);var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,i.addCue(e)}}))}else{var a=n.tracks[t.level].default?"default":"subtitles"+t.level;r.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:e,track:a})}r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){l.logger.log("Failed to parse VTT cue: "+e),r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}))},i.onFragDecrypted=function(t){var e=t.frag,n=t.payload;if("subtitle"===e.type){if(!Object(c.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(t);this._parseVTTs(e,n)}},i.onFragParsingUserdata=function(t){var e=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&e&&n)for(var r=0;r<t.samples.length;r++){var i=t.samples[r].bytes;if(i){var o=this.extractCea608Data(i);e.addData(t.samples[r].pts,o[0]),n.addData(t.samples[r].pts,o[1])}}},i.extractCea608Data=function(t){for(var e=31&t[0],n=2,r=[[],[]],i=0;i<e;i++){var o=t[n++],a=127&t[n++],s=127&t[n++],c=3&o;0===a&&0===s||0!=(4&o)&&(0!==c&&1!==c||(r[c].push(a),r[c].push(s)))}return r},r}(h);function je(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ve(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];"subtitles"===r.kind&&r.label&&e.push(t[n])}return e}var Ge=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,s=r.prototype;return s.destroy=function(){h.prototype.destroy.call(this)},s.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(Object(c.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){e.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(c.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Ve(this.media.textTracks).forEach((function(t){Dt(t)})),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(t){var e=this,n=t.subtitles||[];this.tracks=n,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)}))},s.onSubtitleTrackLoaded=function(t){var e=this,n=t.id,r=t.details,i=this.trackId,o=this.tracks,a=o[i];if(n>=o.length||n!==i||!a||this.stopped)this._clearReloadTimer();else if(l.logger.log("subtitle track "+n+" loaded"),r.live){var s=it(a.details,r,t.stats.trequest);l.logger.log("Reloading live subtitle playlist in "+s+"ms"),this.timer=setTimeout((function(){e._loadCurrentTrack()}),s)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var t=this.trackId,e=this.tracks,n=this.hls,r=e[t];t<0||!r||r.details&&!r.details.live||(l.logger.log("Loading subtitle track "+t),n.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:t}))},s._toggleTrackModes=function(t){var e=this.media,n=this.subtitleDisplay,r=this.trackId;if(e){var i=Ve(e.textTracks);if(-1===t)[].slice.call(i).forEach((function(t){t.mode="disabled"}));else{var o=i[r];o&&(o.mode="disabled")}var a=i[t];a&&(a.mode=n?"showing":"hidden")}},s._setSubtitleTrackInternal=function(t){var e=this.hls,n=this.tracks;!Object(c.isFiniteNumber)(t)||t<-1||t>=n.length||(this.trackId=t,l.logger.log("Switching to subtitle track "+t),e.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Ve(this.media.textTracks),n=0;n<e.length;n++)if("hidden"===e[n].mode)t=n;else if("showing"===e[n].mode){t=n;break}this.subtitleTrack=t}},i=r,(o=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))}}])&&je(i.prototype,o),a&&je(i,a),r}(h),Qe=n("./src/crypt/decrypter.js");var ze,qe=window.performance,We=function(t){var e,n;function r(e,n){var r;return(r=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=e.config,r.state=vt,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new Qe.default(e,e.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r)),r}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i=r.prototype;return i.onSubtitleFragProcessed=function(t){var e=t.frag,n=t.success;if(this.fragPrevious=e,this.state=gt,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,o=e.start,a=0;a<r.length;a++)if(o>=r[a].start&&o<=r[a].end){i=r[a];break}var s=e.start+e.duration;i?i.end=s:(i={start:o,end:s},r.push(i))}}},i.onMediaAttached=function(t){var e=t.media;this.media=e,e.addEventListener("seeking",this._onMediaSeeking),this.state=gt},i.onMediaDetaching=function(){var t=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]})),this.media=null,this.state=vt)},i.onError=function(t){var e=t.frag;e&&"subtitle"===e.type&&(this.state=gt)},i.onSubtitleTracksUpdated=function(t){var e=this;l.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=t.subtitleTracks,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]}))},i.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var e=this.tracks[this.currentTrackId];e&&e.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(t){var e=t.id,n=t.details,r=this.currentTrackId,i=this.tracks,o=i[r];e>=i.length||e!==r||!o||(n.live&&function(t,e,n){void 0===n&&(n=0);var r=-1;rt(t,e,(function(t,e,n){e.start=t.start,r=n}));var i=e.fragments;if(r<0)i.forEach((function(t){t.start+=n}));else for(var o=r+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration}(o.details,n,this.lastAVStart),o.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===yt&&(this.state=gt)},i.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag.decryptdata,r=t.frag,i=this.hls;if(this.state===bt&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var o=qe.now();this.decrypter.decrypt(t.payload,n.key.buffer,n.iv.buffer,(function(t){var e=qe.now();i.trigger(u.default.FRAG_DECRYPTED,{frag:r,payload:t,stats:{tstart:o,tdecrypt:e}})}))}},i.onLevelUpdated=function(t){var e=t.details.fragments;this.lastAVStart=e.length?e[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case gt:var t=this.config,e=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[e]||!i[e].details)break;var o,a=t.maxBufferHole,s=t.maxFragLookUpTolerance,c=Math.min(t.maxBufferLength,t.maxMaxBufferLength),d=G.bufferedInfo(this._getBuffered(),r.currentTime,a),h=d.end,f=d.len,p=i[e].details,v=p.fragments,m=v.length,g=v[m-1].start+v[m-1].duration;if(f>c)return;var A=this.fragPrevious;h<g?(A&&p.hasProgramDateTime&&(o=ct(v,A.endProgramDateTime,s)),o||(o=ut(A,v,h,s))):o=v[m-1],o&&o.encrypted?(l.logger.log("Loading key for "+o.sn),this.state=yt,this.hls.trigger(u.default.KEY_LOADING,{frag:o})):o&&n.getState(o)===U&&(this.fragCurrent=o,this.state=bt,this.hls.trigger(u.default.FRAG_LOADING,{frag:o}))}else this.state=gt},i.stopLoad=function(){this.lastAVStart=0,t.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){this.fragPrevious=null},r}(Ot);!function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(ze||(ze={}));var Ke="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Je=function(t){var e,n;function r(e){var n;return(n=t.call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(t){if(l.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!n.mediaKeysPromise)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var e=function(e){n._media&&(n._attemptSetMediaKeys(e),n._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};n.mediaKeysPromise.then(e).catch(e)},n._config=e.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=e.config.drmSystemOptions,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var i,o,a,c=r.prototype;return c.getLicenseServerUrl=function(t){switch(t){case ze.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},c._attemptKeySystemAccess=function(t,e,n){var r=this,i=function(t,e,n,r){switch(t){case ze.WIDEVINE:return function(t,e,n){var r={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})})),e.forEach((function(t){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})})),[r]}(e,n,r);default:throw new Error("Unknown key-system: "+t)}}(t,e,n,this._drmSystemOptions);l.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(t,i);this.mediaKeysPromise=o.then((function(e){return r._onMediaKeySystemAccessObtained(t,e)})),o.catch((function(e){l.logger.error('Failed to obtain key-system "'+t+'" access:',e)}))},c._onMediaKeySystemAccessObtained=function(t,e){var n=this;l.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return r.mediaKeys=e,l.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),e}));return i.catch((function(t){l.logger.error("Failed to create media-keys:",t)})),i},c._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},c._onNewMediaKeySession=function(t){var e=this;l.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(n){e._onKeySessionMessage(t,n.message)}),!1)},c._onKeySessionMessage=function(t,e){l.logger.log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){l.logger.log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e)}))},c._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(t,e){var n=this,r=this._mediaKeysList[0];if(!r)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)l.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return l.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return l.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});l.logger.log('Generating key-session request for "'+t+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(t,e).then((function(){l.logger.debug("Key-session generation succeeded")})).catch((function(t){l.logger.error("Error generating key-session request:",t),n.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},c._createLicenseXhr=function(t,e,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,t)}catch(e){r.open("POST",t,!0),i(r,t)}r.readyState||r.open("POST",t,!0)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,n),r},c._onLicenseRequestReadyStageChange=function(t,e,n,r){switch(t.readyState){case 4:if(200===t.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),"arraybuffer"!==t.responseType&&l.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(t.response);else{if(l.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;l.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}}},c._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case ze.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},c._requestLicense=function(t,e){l.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,t,e);l.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(n,t);i.send(o)}catch(t){l.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(t){if(this._emeEnabled){var e=t.media;this._media=e,e.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},c.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map((function(t){return t.audioCodec})),n=t.levels.map((function(t){return t.videoCodec}));this._attemptKeySystemAccess(ze.WIDEVINE,e,n)}},i=r,(o=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Xe(i.prototype,o),a&&Xe(i,a),r}(h);function Ye(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $e(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ye(Object(n),!0).forEach((function(e){Ze(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ze(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var tn=$e($e({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Yt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Qt,bufferController:qt,capLevelController:Kt,fpsController:Jt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ke,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:We,subtitleTrackController:Ge,timelineController:He,audioStreamController:ne,audioTrackController:Zt,emeController:Je});function en(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?en(Object(n),!0).forEach((function(e){rn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function rn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function on(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function an(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sn(t,e,n){return e&&an(t.prototype,e),n&&an(t,n),t}var cn=function(t){var e,n;function r(e){var n;void 0===e&&(e={}),(n=t.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=nn(nn({},i),e);var o=on(n).config;if(void 0!==o.liveMaxLatencyDurationCount&&o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==o.liveMaxLatencyDuration&&(void 0===o.liveSyncDuration||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(l.enableLogs)(o.debug),n._autoLevelCapping=-1;var a=n.abrController=new o.abrController(on(n)),s=new o.bufferController(on(n)),c=n.capLevelController=new o.capLevelController(on(n)),u=new o.fpsController(on(n)),d=new B(on(n)),h=new N(on(n)),f=new P(on(n)),p=new Ft(on(n)),v=n.levelController=new Nt(on(n)),m=new j(on(n)),g=[v,n.streamController=new kt(on(n),m)],A=o.audioStreamController;A&&g.push(new A(on(n),m)),n.networkControllers=g;var y=[d,h,f,a,s,c,u,p,m];if(A=o.audioTrackController){var b=new A(on(n));n.audioTrackController=b,y.push(b)}if(A=o.subtitleTrackController){var w=new A(on(n));n.subtitleTrackController=w,g.push(w)}if(A=o.emeController){var E=new A(on(n));n.emeController=E,y.push(E)}return(A=o.subtitleStreamController)&&g.push(new A(on(n),m)),(A=o.timelineController)&&y.push(new A(on(n))),n.coreComponents=y,n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r.isSupported=function(){return function(){var t=W();if(!t)return!1;var e=self.SourceBuffer||self.WebKitSourceBuffer,n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!n&&!!r}()},sn(r,null,[{key:"version",get:function(){return"0.14.12"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:tn},set:function(t){r.defaultConfig=t}}]);var i=r.prototype;return i.destroy=function(){l.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(t){t.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(t){l.logger.log("attachMedia"),this.media=t,this.trigger(u.default.MEDIA_ATTACHING,{media:t})},i.detachMedia=function(){l.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(t){t=a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),l.logger.log("loadSource:"+t),this.url=t,this.trigger(u.default.MANIFEST_LOADING,{url:t})},i.startLoad=function(t){void 0===t&&(t=-1),l.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},i.stopLoad=function(){l.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},i.swapAudioCodec=function(){l.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){l.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),t&&this.attachMedia(t)},i.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},sn(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){l.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){l.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){l.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){l.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){l.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){l.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"bandwidthEstimate",get:function(){var t=this.abrController._bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,n=t?t.length:0,r=0;r<n;r++){if((t[r].realBitrate?Math.max(t[r].realBitrate,t[r].bitrate):t[r].bitrate)>e)return r}return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),r}(X);cn.defaultConfig=void 0},"./src/polyfills/number.js":
/*!*********************************!*\
  !*** ./src/polyfills/number.js ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(t,e,n){"use strict";n.r(e),n.d(e,"isFiniteNumber",(function(){return r})),n.d(e,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(t,e,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(e),n.d(e,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(t,e,n){"use strict";n.r(e),n.d(e,"enableLogs",(function(){return l})),n.d(e,"logger",(function(){return d}));var r=n(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function i(){}var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=o;function s(t,e){return e="["+t+"] > "+e}var c=Object(r.getSelfScope)();function u(t){var e=c.console[t];return e?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=s(t,r[0])),e.apply(c.console,r)}:i}var l=function(t){if(c.console&&!0===t||"object"==typeof t){!function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach((function(e){a[e]=t[e]?t[e].bind(t):u(e)}))}(t,"debug","log","info","warn","error");try{a.log()}catch(t){a=o}}else a=o},d=a}}).default})),
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],e):e(t.rxjs={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function i(t){return"function"==typeof t}var o=!1,a={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=t},get useDeprecatedSynchronousErrorHandling(){return o}};function s(t){setTimeout((function(){throw t}),0)}var c={closed:!0,next:function(t){},error:function(t){if(a.useDeprecatedSynchronousErrorHandling)throw t;s(t)},complete:function(){}},u=Array.isArray||function(t){return t&&"number"==typeof t.length};function l(t){return null!==t&&"object"==typeof t}var d=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,r=n._parentOrParents,o=n._ctorUnsubscribe,a=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var c=0;c<r.length;++c){r[c].remove(this)}if(i(a)){o&&(this._unsubscribe=void 0);try{a.call(this)}catch(t){e=t instanceof d?f(t.errors):[t]}}if(u(s)){c=-1;for(var h=s.length;++c<h;){var p=s[c];if(l(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof d?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new d(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof d?e.errors:e)}),[])}var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),v=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=c;break;case 1:if(!n){o.destination=c;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new m(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new m(o,n,r,i)}return o}return n(e,t),e.prototype[p]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(h),m=function(t){function e(e,n,r,o){var a,s=t.call(this)||this;s._parentSubscriber=e;var u=s;return i(n)?a=n:n&&(a=n.next,r=n.error,o=n.complete,n!==c&&(i((u=Object.create(n)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=a,s._error=r,s._complete=o,s}return n(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):s(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;s(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),a.useDeprecatedSynchronousErrorHandling)throw t;s(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return a.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(s(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(v);function g(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof v?r:null}return!0}var A="function"==typeof Symbol&&Symbol.observable||"@@observable";function y(t){return t}function b(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return w(t)}function w(t){return 0===t.length?y:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var E=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof v)return t;if(t[p])return t[p]()}return t||e||n?new v(t,e,n):new v(c)}(t,e,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||a.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),a.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),g(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=_(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[A]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:w(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=_(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function _(t){if(t||(t=a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var S=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),T=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return n(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(h),C=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return n(e,t),e}(v),x=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return n(e,t),e.prototype[p]=function(){return new C(this)},e.prototype.lift=function(t){var e=new R(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new S;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new S;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new T(this,t))},e.prototype.asObservable=function(){var t=new E;return t.source=this,t},e.create=function(t,e){return new R(t,e)},e}(E),R=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return n(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},e}(x);function I(){return function(t){return t.lift(new M(t))}}var O,M=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new L(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),L=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return n(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(v),k=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return n(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new h).add(this.source.subscribe(new N(this.getSubject(),this))),t.closed&&(this._connection=null,t=h.EMPTY)),t},e.prototype.refCount=function(){return I()(this)},e}(E),B={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(O=k.prototype)._subscribe},_isComplete:{value:O._isComplete,writable:!0},getSubject:{value:O.getSubject},connect:{value:O.connect},refCount:{value:O.refCount}},N=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return n(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(C);!function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}n(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}(v);var P=function(){function t(t,e,n,r){this.keySelector=t,this.elementSelector=e,this.durationSelector=n,this.subjectSelector=r}return t.prototype.call=function(t,e){return e.subscribe(new U(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),U=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;return a.keySelector=n,a.elementSelector=r,a.durationSelector=i,a.subjectSelector=o,a.groups=null,a.attemptedToUnsubscribe=!1,a.count=0,a}return n(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new x,n.set(e,i);var o=new F(e,i,this);if(this.destination.next(o),this.durationSelector){var a=void 0;try{a=this.durationSelector(new F(e,i))}catch(t){return void this.error(t)}this.add(a.subscribe(new D(e,i,this)))}}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},e}(v),D=function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.key=e,i.group=n,i.parent=r,i}return n(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(v),F=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.groupSubject=n,i.refCountSubscription=r,i}return n(e,t),e.prototype._subscribe=function(t){var e=new h,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new H(n)),e.add(r.subscribe(t)),e},e}(E),H=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return n(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(h),j=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(x),V=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return n(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return n(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(h)),G=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return n(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(V),Q=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),z=function(t){function e(n,r){void 0===r&&(r=Q.now);var i=t.call(this,n,(function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return n(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(Q),q=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(z))(G),W=q,K=new E((function(t){return t.complete()}));function X(t){return t?function(t){return new E((function(e){return t.schedule((function(){return e.complete()}))}))}(t):K}function J(t){return t&&"function"==typeof t.schedule}var Y,$=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}};function Z(t,e){return new E((function(n){var r=new h,i=0;return r.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function tt(t,e){return e?Z(t,e):new E($(t))}function et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return J(n)?(t.pop(),Z(t,n)):tt(t)}function nt(t,e){return new E(e?function(n){return e.schedule(rt,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function rt(t){var e=t.error;t.subscriber.error(e)}(Y=t.NotificationKind||(t.NotificationKind={})).NEXT="N",Y.ERROR="E",Y.COMPLETE="C";var it=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return et(this.value);case"E":return nt(this.error);case"C":return X()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();var ot=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new at(t,this.scheduler,this.delay))},t}(),at=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return n(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new st(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(it.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(it.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(it.createComplete()),this.unsubscribe()},e}(v),st=function(t,e){this.notification=t,this.destination=e},ct=function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return n(e,t),e.prototype.nextInfiniteTimeWindow=function(e){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift(),t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this._events.push(new ut(this._getNow(),e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new S;if(this.isStopped||this.hasError?e=h.EMPTY:(this.observers.push(t),e=new T(this,t)),i&&t.add(t=new at(t,i)),n)for(var a=0;a<o&&!t.closed;a++)t.next(r[a]);else for(a=0;a<o&&!t.closed;a++)t.next(r[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||W).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r},e}(x),ut=function(t,e){this.time=t,this.value=e},lt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return n(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),h.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),h.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(x),dt=1,ht=Promise.resolve(),ft={};function pt(t){return t in ft&&(delete ft[t],!0)}var vt=function(t){var e=dt++;return ft[e]=!0,ht.then((function(){return pt(e)&&t()})),e},mt=function(t){pt(t)},gt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return n(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=vt(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(mt(n),e.scheduled=void 0)},e}(V),At=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(z))(gt),yt=At,bt=new z(V),wt=bt,Et=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return n(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(V),_t=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(z))(Et),St=_t,Tt=function(t){function e(e,n){void 0===e&&(e=Ct),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this,e,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return n(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,r=this.maxFrames;(e=n[0])&&e.delay<=r&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(z),Ct=function(t){function e(e,n,r){void 0===r&&(r=e.index+=1);var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.index=r,i.active=!0,i.index=e.index=r,i}return n(e,t),e.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return t.prototype.schedule.call(this,n,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},e.prototype.requestAsyncId=function(t,n,r){void 0===r&&(r=0),this.delay=t.frame+r;var i=t.actions;return i.push(this),i.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){void 0===n&&(n=0)},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(V);function xt(){}var Rt=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),It=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}(),Ot=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}();function Mt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Lt(t,e))}}var Lt=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new kt(t,this.project,this.thisArg))},t}(),kt=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return n(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(v);function Bt(t){var e=this,n=t.args,r=t.subscriber,i=t.params,o=i.callbackFunc,a=i.context,s=i.scheduler,c=i.subject;if(!c){c=i.subject=new lt;try{o.apply(a,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length<=1?t[0]:t;e.add(s.schedule(Nt,0,{value:r,subject:c}))}]))}catch(t){c.error(t)}}this.add(c.subscribe(r))}function Nt(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function Pt(t){var e=this,n=t.params,r=t.subscriber,i=t.context,o=n.callbackFunc,a=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new lt;try{o.apply(i,a.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.shift();if(r)e.add(s.schedule(Dt,0,{err:r,subject:c}));else{var i=t.length<=1?t[0]:t;e.add(s.schedule(Ut,0,{value:i,subject:c}))}}]))}catch(t){this.add(s.schedule(Dt,0,{err:t,subject:c}))}}this.add(c.subscribe(r))}function Ut(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function Dt(t){var e=t.err;t.subject.error(e)}var Ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(v),Ht=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return n(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(v);var jt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Vt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Gt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var Qt=function(t){if(t&&"function"==typeof t[A])return r=t,function(t){var e=r[A]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(Vt(t))return $(t);if(Gt(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,s),t};if(t&&"function"==typeof t[jt])return e=t,function(t){for(var n=e[jt]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,r,i=l(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function zt(t,e,n,r,i){if(void 0===i&&(i=new Ht(t,n,r)),!i.closed)return e instanceof E?e.subscribe(i):Qt(e)(i)}var qt={};var Wt=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Kt(t,this.resultSelector))},t}(),Kt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return n(e,t),e.prototype._next=function(t){this.values.push(qt),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(zt(this,r,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var r=this.values,i=r[n],o=this.toRespond?i===qt?--this.toRespond:this.toRespond:0;r[n]=e,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Ft);function Xt(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[A]}(t))return function(t,e){return new E((function(n){var r=new h;return r.add(e.schedule((function(){var i=t[A]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if(Gt(t))return function(t,e){return new E((function(n){var r=new h;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if(Vt(t))return Z(t,e);if(function(t){return t&&"function"==typeof t[jt]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new E((function(n){var r,i=new h;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[jt](),i.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function Jt(t,e){return e?Xt(t,e):t instanceof E?t:new E(Qt(t))}var Yt=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return n(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(v),$t=(function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i}n(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(v),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(v));!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.notifyNext=function(t,e,n,r){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()}}(v);function Zt(t,e){if(!e.closed)return t instanceof E?t.subscribe(e):Qt(t)(e)}function te(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(te((function(n,r){return Jt(t(n,r)).pipe(Mt((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new ee(t,n))})}var ee=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new ne(t,this.project,this.concurrent))},t}(),ne=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return n(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new Yt(this),n=this.destination;n.add(e);var r=Zt(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}($t),re=te;function ie(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),te(y,t)}function oe(){return ie(1)}function ae(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oe()(et.apply(void 0,t))}function se(t){return new E((function(e){var n;try{n=t()}catch(t){return void e.error(t)}return(n?Jt(n):X()).subscribe(e)}))}function ce(t,e){return new E((function(n){var r=t.length;if(0!==r)for(var i=new Array(r),o=0,a=0,s=function(s){var c=Jt(t[s]),u=!1;n.add(c.subscribe({next:function(t){u||(u=!0,a++),i[s]=t},error:function(t){return n.error(t)},complete:function(){++o!==r&&u||(a===r&&n.next(e?e.reduce((function(t,e,n){return t[e]=i[n],t}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c);else n.complete()}))}function ue(t,e,n,r,i){var o;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var a=t;t.addEventListener(e,n,i),o=function(){return a.removeEventListener(e,n,i)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var s=t;t.on(e,n),o=function(){return s.off(e,n)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var c=t;t.addListener(e,n),o=function(){return c.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var u=0,l=t.length;u<l;u++)ue(t[u],e,n,r,i)}r.add(o)}function le(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var r=void 0;try{r=n(t.state)}catch(t){return void e.error(t)}if(!r)return void e.complete();if(e.closed)return}var i;try{i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}}function de(t){return!u(t)&&t-parseFloat(t)+1>=0}function he(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}function fe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,r=null,i=t[t.length-1];return J(i)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof i&&(n=t.pop()),null===r&&1===t.length&&t[0]instanceof E?t[0]:ie(n)(tt(t,r))}var pe=new E(xt);function ve(t){var e=t.keys,n=t.index,r=t.subscriber,i=t.subscription,o=t.obj;if(!r.closed)if(n<e.length){var a=e[n];r.next([a,o[a]]),i.add(this.schedule({keys:e,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}function me(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}function ge(t,e){return function(n){return n.lift(new Ae(t,e))}}var Ae=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ye(t,this.predicate,this.thisArg))},t}(),ye=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return n(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(v);function be(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!u(t[0]))return t[0];t=t[0]}return tt(t,void 0).lift(new we)}var we=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Ee(t))},t}(),Ee=function(t){function e(e){var n=t.call(this,e)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return n(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=zt(this,t[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(e)},e}(Ft);function _e(t){var e=t.start,n=t.index,r=t.count,i=t.subscriber;n>=r?i.complete():(i.next(e),i.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}function Se(t,e,n){void 0===t&&(t=0);var r=-1;return de(e)?r=Number(e)<1?1:Number(e):J(e)&&(n=e),J(n)||(n=wt),new E((function(e){var i=de(t)?t:+t-n.now();return n.schedule(Te,i,{index:0,period:r,subscriber:e})}))}function Te(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}function Ce(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),tt(t,void 0).lift(new xe(n))}var xe=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Re(t,this.resultSelector))},t}(),Re=function(t){function e(e,n,r){void 0===r&&(r=Object.create(null));var i=t.call(this,e)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return n(e,t),e.prototype._next=function(t){var e=this.iterators;u(t)?e.push(new Oe(t)):"function"==typeof t[jt]?e.push(new Ie(t[jt]())):e.push(new Me(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var r=t[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe());else this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++){if("function"==typeof(a=t[r]).hasValue&&!a.hasValue())return}var i=!1,o=[];for(r=0;r<e;r++){var a,s=(a=t[r]).next();if(a.hasCompleted()&&(i=!0),s.done)return void n.complete();o.push(s.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(v),Ie=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},t}(),Oe=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[jt]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),Me=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return n(e,t),e.prototype[jt]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return Zt(this.observable,new Yt(this))},e}($t);function Le(t){return function(e){return e.lift(new ke(t))}}var ke=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Be(t,this.durationSelector))},t}(),Be=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var n=Zt(e,new Yt(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this,e=t.value,n=t.hasValue,r=t.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))},e.prototype.notifyNext=function(){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}($t);var Ne=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new Pe(t,this.closingNotifier))},t}(),Pe=function(t){function e(e,n){var r=t.call(this,e)||this;return r.buffer=[],r.add(Zt(n,new Yt(r))),r}return n(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(){var t=this.buffer;this.buffer=[],this.destination.next(t)},e}($t);var Ue=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?Fe:De}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),De=function(t){function e(e,n){var r=t.call(this,e)||this;return r.bufferSize=n,r.buffer=[],r}return n(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}(v),Fe=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return n(e,t),e.prototype._next=function(t){var e=this,n=e.bufferSize,r=e.startBufferEvery,i=e.buffers,o=e.count;this.count++,o%r==0&&i.push([]);for(var a=i.length;a--;){var s=i[a];s.push(t),s.length===n&&(i.splice(a,1),this.destination.next(s))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var r=e.shift();r.length>0&&n.next(r)}t.prototype._complete.call(this)},e}(v);var He=function(){function t(t,e,n,r){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new Ve(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),je=function(){this.buffer=[]},Ve=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;a.bufferTimeSpan=n,a.bufferCreationInterval=r,a.maxBufferSize=i,a.scheduler=o,a.contexts=[];var s=a.openContext();if(a.timespanOnly=null==r||r<0,a.timespanOnly){var c={subscriber:a,context:s,bufferTimeSpan:n};a.add(s.closeAction=o.schedule(Ge,n,c))}else{var u={subscriber:a,context:s},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:a,scheduler:o};a.add(s.closeAction=o.schedule(ze,n,u)),a.add(o.schedule(Qe,r,l))}return a}return n(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],a=o.buffer;a.push(t),a.length==this.maxBufferSize&&(e=o)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var r=e.shift();n.next(r.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:t,bufferTimeSpan:n};this.add(t.closeAction=this.scheduler.schedule(Ge,n,r))}},e.prototype.openContext=function(){var t=new je;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)},e}(v);function Ge(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function Qe(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,r=t.subscriber,i=t.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(ze,n,{subscriber:r,context:o})),this.schedule(t,e))}function ze(t){var e=t.subscriber,n=t.context;e.closeContext(n)}var qe=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new We(t,this.openings,this.closingSelector))},t}(),We=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.closingSelector=r,i.contexts=[],i.add(zt(i,n)),i}return n(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,r=0;r<n;r++)e[r].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.buffer,r=t.subscription;this.destination.next(n),e.splice(e.indexOf(t),1),this.remove(r),r.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new h,r={buffer:[],subscription:n};e.push(r);var i=zt(this,t,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},e}(Ft);var Ke=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Xe(t,this.closingSelector))},t}(),Xe=function(t){function e(e,n){var r=t.call(this,e)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return n(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},e.prototype.notifyNext=function(){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{e=(0,this.closingSelector)()}catch(t){return this.error(t)}t=new h,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(Zt(e,new Yt(this))),this.subscribing=!1},e}($t);var Je=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new Ye(t,this.selector,this.caught))},t}(),Ye=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.selector=n,i.caught=r,i}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var r=new Yt(this);this.add(r);var i=Zt(n,r);i!==r&&this.add(i)}},e}($t);function $e(t,e){return te(t,e,1)}var Ze=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new tn(t,this.predicate,this.source))},t}(),tn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return n(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},e}(v);var en=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new nn(t,this.durationSelector))},t}(),nn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=Zt(e,new Yt(this)))&&!n.closed&&this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,t.prototype._next.call(this,e)}},e}($t);var rn=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new on(t,this.dueTime,this.scheduler))},t}(),on=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return n(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(an,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(v);function an(t){t.debouncedNext()}function sn(t){return void 0===t&&(t=null),function(e){return e.lift(new cn(t))}}var cn=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new un(t,this.defaultValue))},t}(),un=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return n(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(v);function ln(t){return t instanceof Date&&!isNaN(+t)}var dn=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new hn(t,this.delay,this.scheduler))},t}(),hn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return n(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new fn(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(it.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(it.createComplete()),this.unsubscribe()},e}(v),fn=function(t,e){this.time=t,this.notification=e};var pn=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new vn(t,this.delayDurationSelector))},t}(),vn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return n(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=zt(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(Ft),mn=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subscriptionDelay=n,r}return n(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new gn(t,this.source))},e}(E),gn=function(t){function e(e,n){var r=t.call(this)||this;return r.parent=e,r.source=n,r.sourceSubscribed=!1,r}return n(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(v);var An=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new yn(t))},t}(),yn=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._next=function(t){t.observe(this.destination)},e}(v);var bn=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new wn(t,this.keySelector,this.flushes))},t}(),wn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=n,i.values=new Set,r&&i.add(Zt(r,new Yt(i))),i}return n(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}($t);function En(t,e){return function(n){return n.lift(new _n(t,e))}}var _n=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Sn(t,this.compare,this.keySelector))},t}(),Sn=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return n(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))},e}(v);function Tn(t){return void 0===t&&(t=Rn),function(e){return e.lift(new Cn(t))}}var Cn=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new xn(t,this.errorFactory))},t}(),xn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.errorFactory=n,r.hasValue=!1,r}return n(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(v);function Rn(){return new It}function In(t){return function(e){return 0===t?X():e.lift(new On(t))}}var On=function(){function t(t){if(this.total=t,this.total<0)throw new Rt}return t.prototype.call=function(t,e){return e.subscribe(new Mn(t,this.total))},t}(),Mn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return n(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(v);var Ln=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new kn(t,this.predicate,this.thisArg,this.source))},t}(),kn=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return n(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(v);var Bn=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Nn(t))},t}(),Nn=function(t){function e(e){var n=t.call(this,e)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return n(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(Zt(t,new Yt(this))))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}($t);var Pn=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Un(t,this.project))},t}(),Un=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return n(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new Yt(this),n=this.destination;n.add(e);var r=Zt(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}($t);var Dn=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new Fn(t,this.project,this.concurrent,this.scheduler))},t}(),Fn=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return n(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,r=t.value,i=t.index;e.subscribeToProjection(n,r,i)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(t);try{var i=(0,this.project)(t,r);if(this.scheduler){var o={subscriber:this,result:i,value:t,index:r};this.destination.add(this.scheduler.schedule(e.dispatch,0,o))}else this.subscribeToProjection(i,t,r)}catch(t){n.error(t)}}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add(Zt(t,new Yt(this)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this._next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}($t);var Hn=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new jn(t,this.callback))},t}(),jn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new h(n)),r}return n(e,t),e}(v);var Vn=function(){function t(t,e,n,r){this.predicate=t,this.source=e,this.yieldIndex=n,this.thisArg=r}return t.prototype.call=function(t,e){return e.subscribe(new Gn(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},t}(),Gn=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;return a.predicate=n,a.source=r,a.yieldIndex=i,a.thisArg=o,a.index=0,a}return n(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,r=this.index++;try{e.call(n||this,t,r,this.source)&&this.notifyComplete(this.yieldIndex?r:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},e}(v);var Qn=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new zn(t))},t}(),zn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._next=function(t){},e}(v);var qn=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Wn(t))},t}(),Wn=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(v);function Kn(t){return function(e){return 0===t?X():e.lift(new Xn(t))}}var Xn=function(){function t(t){if(this.total=t,this.total<0)throw new Rt}return t.prototype.call=function(t,e){return e.subscribe(new Jn(t,this.total))},t}(),Jn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return n(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=e++%n;t.next(r[o])}t.complete()},e}(v);var Yn=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new $n(t,this.value))},t}(),$n=function(t){function e(e,n){var r=t.call(this,e)||this;return r.value=n,r}return n(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(v);var Zn=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new tr(t))},t}(),tr=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._next=function(t){this.destination.next(it.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(it.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(it.createComplete()),t.complete()},e}(v);function er(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new nr(t,e,n))}}var nr=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new rr(t,this.accumulator,this.seed,this.hasSeed))},t}(),rr=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return n(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(v);function ir(t,e){return arguments.length>=2?function(n){return b(er(t,e),Kn(1),sn(e))(n)}:function(e){return b(er((function(e,n,r){return t(e,n,r+1)})),Kn(1))(e)}}var or=function(){function t(t,e,n){this.accumulator=t,this.seed=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new ar(t,this.accumulator,this.seed,this.concurrent))},t}(),ar=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return n(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,t,e)}catch(t){return n.error(t)}this.active++,this._innerSub(r)}else this.buffer.push(t)},e.prototype._innerSub=function(t){var e=new Yt(this),n=this.destination;n.add(e);var r=Zt(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},e.prototype.notifyNext=function(t){var e=this.destination;this.acc=t,this.hasValue=!0,e.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e}($t);function sr(t,e){return function(n){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new cr(r,e));var i=Object.create(n,B);return i.source=n,i.subjectFactory=r,i}}var cr=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(t);return i.add(e.subscribe(r)),i},t}();var ur=function(){function t(t){this.nextSources=t}return t.prototype.call=function(t,e){return e.subscribe(new lr(t,this.nextSources))},t}(),lr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.nextSources=n,r}return n(e,t),e.prototype.notifyError=function(){this.subscribeToNextSource()},e.prototype.notifyComplete=function(){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},e.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new Yt(this),n=this.destination;n.add(e);var r=Zt(t,e);r!==e&&n.add(r)}else this.destination.complete()},e}($t);var dr=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new hr(t))},t}(),hr=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return n(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(v);function fr(t,e){return function(n){for(var r=n,i=0;i<e;i++){var o=null!=r?r[t[i]]:void 0;if(void 0===o)return;r=o}return r}}var pr=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new vr(t,this.count,this.source))},t}(),vr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return n(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}},e}(v);var mr=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new gr(t,this.notifier,e))},t}(),gr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return n(e,t),e.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=e,this},e.prototype.subscribeToRetries=function(){var e;this.notifications=new x;try{e=(0,this.notifier)(this.notifications)}catch(e){return t.prototype.complete.call(this)}this.retries=e,this.retriesSubscription=Zt(e,new Yt(this))},e}($t);var Ar=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new yr(t,this.count,this.source))},t}(),yr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(v);var br=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new wr(t,this.notifier,this.source))},t}(),wr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new x;try{r=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}i=Zt(r,new Yt(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}($t);var Er=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new _r(t),r=e.subscribe(n);return r.add(Zt(this.notifier,new Yt(n))),r},t}(),_r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}return n(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}($t);var Sr=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Tr(t,this.period,this.scheduler))},t}(),Tr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Cr,n,{subscriber:i,period:n})),i}return n(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(v);function Cr(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}var xr=function(){function t(t,e){this.compareTo=t,this.comparator=e}return t.prototype.call=function(t,e){return e.subscribe(new Rr(t,this.compareTo,this.comparator))},t}(),Rr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Ir(e,i))),i}return n(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},e.prototype.checkValues=function(){for(var t=this,e=t._a,n=t._b,r=t.comparator;e.length>0&&n.length>0;){var i=e.shift(),o=n.shift(),a=!1;try{a=r?r(i,o):i===o}catch(t){this.destination.error(t)}a||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},e}(v),Ir=function(t){function e(e,n){var r=t.call(this,e)||this;return r.parent=n,r}return n(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},e}(v);function Or(){return new x}var Mr=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new Lr(t,this.predicate,this.source))},t}(),Lr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return n(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new It)},e}(v);var kr=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new Br(t,this.total))},t}(),Br=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return n(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(v);var Nr=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new Rt}return t.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new v(t)):e.subscribe(new Pr(t,this._skipCount))},t}(),Pr=function(t){function e(e,n){var r=t.call(this,e)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return n(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var r=n%e,i=this._ring,o=i[r];i[r]=t,this.destination.next(o)}},e}(v);var Ur=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new Dr(t,this.notifier))},t}(),Dr=function(t){function e(e,n){var r=t.call(this,e)||this;r.hasValue=!1;var i=new Yt(r);r.add(i),r.innerSubscription=i;var o=Zt(n,i);return o!==i&&(r.add(o),r.innerSubscription=o),r}return n(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},e.prototype.notifyComplete=function(){},e}($t);var Fr=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new Hr(t,this.predicate))},t}(),Hr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return n(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},e}(v);var jr=function(t){function e(e,n,r){void 0===n&&(n=0),void 0===r&&(r=yt);var i=t.call(this)||this;return i.source=e,i.delayTime=n,i.scheduler=r,(!de(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=yt),i}return n(e,t),e.create=function(t,n,r){return void 0===n&&(n=0),void 0===r&&(r=yt),new e(t,n,r)},e.dispatch=function(t){var e=t.source,n=t.subscriber;return this.add(e.subscribe(n))},e.prototype._subscribe=function(t){var n=this.delayTime,r=this.source;return this.scheduler.schedule(e.dispatch,n,{source:r,subscriber:t})},e}(E);var Vr=function(){function t(t,e){this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return new jr(e,this.delay,this.scheduler).subscribe(t)},t}();function Gr(t,e){return"function"==typeof e?function(n){return n.pipe(Gr((function(n,r){return Jt(t(n,r)).pipe(Mt((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new Qr(t))}}var Qr=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new zr(t,this.project))},t}(),zr=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return n(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new Yt(this),r=this.destination;r.add(n),this.innerSubscription=Zt(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}($t);var qr=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new Wr(t),r=Zt(this.notifier,new Yt(n));return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n},t}(),Wr=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return n(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}($t);var Kr=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new Xr(t,this.predicate,this.inclusive))},t}(),Xr=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return n(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(v);var Jr=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new Yr(t,this.nextOrObserver,this.error,this.complete))},t}(),Yr=function(t){function e(e,n,r,o){var a=t.call(this,e)||this;return a._tapNext=xt,a._tapError=xt,a._tapComplete=xt,a._tapError=r||xt,a._tapComplete=o||xt,i(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||xt,a._tapError=n.error||xt,a._tapComplete=n.complete||xt),a}return n(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(v),$r={leading:!0,trailing:!1};var Zr=function(){function t(t,e,n){this.durationSelector=t,this.leading=e,this.trailing=n}return t.prototype.call=function(t,e){return e.subscribe(new ti(t,this.durationSelector,this.leading,this.trailing))},t}(),ti=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.destination=e,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return n(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=Zt(e,new Yt(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()},e}($t);var ei=function(){function t(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}return t.prototype.call=function(t,e){return e.subscribe(new ni(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),ni=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;return a.duration=n,a.scheduler=r,a.leading=i,a.trailing=o,a._hasTrailingValue=!1,a._trailingValue=null,a}return n(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(ri,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(v);function ri(t){t.subscriber.clearThrottle()}var ii=function(t,e){this.value=t,this.interval=e};function oi(t,e,n){return void 0===n&&(n=wt),function(r){var i=ln(t),o=i?+t-n.now():Math.abs(t);return r.lift(new ai(o,i,e,n))}}var ai=function(){function t(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new si(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),si=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;return a.absoluteTimeout=n,a.waitFor=r,a.withObservable=i,a.scheduler=o,a.scheduleTimeout(),a}return n(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(Zt(e,new Yt(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}($t);var ci=function(t,e){this.value=t,this.timestamp=e};function ui(t,e,n){return 0===n?[e]:(t.push(e),t)}var li=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var n=new di(t),r=e.subscribe(n);return r.closed||n.add(Zt(this.windowBoundaries,new Yt(n))),r},t}(),di=function(t){function e(e){var n=t.call(this,e)||this;return n.window=new x,e.next(n.window),n}return n(e,t),e.prototype.notifyNext=function(){this.openWindow()},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new x;e.next(n)},e}($t);var hi=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new fi(t,this.windowSize,this.startWindowEvery))},t}(),fi=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.destination=e,i.windowSize=n,i.startWindowEvery=r,i.windows=[new x],i.count=0,e.next(i.windows[0]),i}return n(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(t);var s=this.count-r+1;if(s>=0&&s%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var c=new x;i.push(c),n.next(c)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null},e}(v);var pi=function(){function t(t,e,n,r){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=n,this.scheduler=r}return t.prototype.call=function(t,e){return e.subscribe(new mi(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},t}(),vi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return n(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(x),mi=function(t){function e(e,n,r,i,o){var a=t.call(this,e)||this;a.destination=e,a.windowTimeSpan=n,a.windowCreationInterval=r,a.maxWindowSize=i,a.scheduler=o,a.windows=[];var s=a.openWindow();if(null!==r&&r>=0){var c={subscriber:a,window:s,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:a,scheduler:o};a.add(o.schedule(yi,n,c)),a.add(o.schedule(Ai,r,u))}else{var l={subscriber:a,window:s,windowTimeSpan:n};a.add(o.schedule(gi,n,l))}return a}return n(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,r=0;r<n;r++){var i=e[r];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new vi;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},e}(v);function gi(t){var e=t.subscriber,n=t.windowTimeSpan,r=t.window;r&&e.closeWindow(r),t.window=e.openWindow(),this.schedule(t,n)}function Ai(t){var e=t.windowTimeSpan,n=t.subscriber,r=t.scheduler,i=t.windowCreationInterval,o=n.openWindow(),a=this,s={action:a,subscription:null},c={subscriber:n,window:o,context:s};s.subscription=r.schedule(yi,e,c),a.add(s.subscription),a.schedule(t,i)}function yi(t){var e=t.subscriber,n=t.window,r=t.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),e.closeWindow(n)}var bi=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new wi(t,this.openings,this.closingSelector))},t}(),wi=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=zt(i,n,n)),i}return n(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,r=0;r<n;r++)e[r].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(e),o.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,r=-1;++r<n;){var i=e[r];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var r=t[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,r,i){if(t===this.openings){var o=void 0;try{o=(0,this.closingSelector)(e)}catch(t){return this.error(t)}var a=new x,s=new h,c={window:a,subscription:s};this.contexts.push(c);var u=zt(this,o,c);u.closed?this.closeWindow(this.contexts.length-1):(u.context=c,s.add(u)),this.destination.next(a)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],r=n.window,i=n.subscription;e.splice(t,1),r.complete(),i.unsubscribe()}},e}(Ft);var Ei=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new _i(t,this.closingSelector))},t}(),_i=function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.closingSelector=n,r.openWindow(),r}return n(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow(i)},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n,r=this.window=new x;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=zt(this,n))},e}(Ft);var Si=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new Ti(t,this.observables,this.project))},t}(),Ti=function(t){function e(e,n,r){var i=t.call(this,e)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var a=0;a<o;a++)i.toRespond.push(a);for(a=0;a<o;a++){var s=n[a];i.add(zt(i,s,void 0,a))}return i}return n(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Ft);var Ci=Object.freeze({audit:Le,auditTime:function(t,e){return void 0===e&&(e=wt),Le((function(){return Se(t,e)}))},buffer:function(t){return function(e){return e.lift(new Ne(t))}},bufferCount:function(t,e){return void 0===e&&(e=null),function(n){return n.lift(new Ue(t,e))}},bufferTime:function(t){var e=arguments.length,n=wt;J(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var r=null;e>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return e>=3&&(i=arguments[2]),function(e){return e.lift(new He(t,r,i,n))}},bufferToggle:function(t,e){return function(n){return n.lift(new qe(t,e))}},bufferWhen:function(t){return function(e){return e.lift(new Ke(t))}},catchError:function(t){return function(e){var n=new Je(t),r=e.lift(n);return n.caught=r}},combineAll:function(t){return function(e){return e.lift(new Wt(t))}},combineLatest:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&u(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(Jt([e].concat(t)),new Wt(n))}},concat:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(ae.apply(void 0,[e].concat(t)))}},concatAll:oe,concatMap:$e,concatMapTo:function(t,e){return $e((function(){return t}),e)},count:function(t){return function(e){return e.lift(new Ze(t,e))}},debounce:function(t){return function(e){return e.lift(new en(t))}},debounceTime:function(t,e){return void 0===e&&(e=wt),function(n){return n.lift(new rn(t,e))}},defaultIfEmpty:sn,delay:function(t,e){void 0===e&&(e=wt);var n=ln(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new dn(n,e))}},delayWhen:function(t,e){return e?function(n){return new mn(n,e).lift(new pn(t))}:function(e){return e.lift(new pn(t))}},dematerialize:function(){return function(t){return t.lift(new An)}},distinct:function(t,e){return function(n){return n.lift(new bn(t,e))}},distinctUntilChanged:En,distinctUntilKeyChanged:function(t,e){return En((function(n,r){return e?e(n[t],r[t]):n[t]===r[t]}))},elementAt:function(t,e){if(t<0)throw new Rt;var n=arguments.length>=2;return function(r){return r.pipe(ge((function(e,n){return n===t})),In(1),n?sn(e):Tn((function(){return new Rt})))}},endWith:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return ae(e,et.apply(void 0,t))}},every:function(t,e){return function(n){return n.lift(new Ln(t,e,n))}},exhaust:function(){return function(t){return t.lift(new Bn)}},exhaustMap:function t(e,n){return n?function(r){return r.pipe(t((function(t,r){return Jt(e(t,r)).pipe(Mt((function(e,i){return n(t,e,r,i)})))})))}:function(t){return t.lift(new Pn(e))}},expand:function(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(r){return r.lift(new Dn(t,e,n))}},filter:ge,finalize:function(t){return function(e){return e.lift(new Hn(t))}},find:function(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(n){return n.lift(new Vn(t,n,!1,e))}},findIndex:function(t,e){return function(n){return n.lift(new Vn(t,n,!0,e))}},first:function(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?ge((function(e,n){return t(e,n,r)})):y,In(1),n?sn(e):Tn((function(){return new It})))}},groupBy:function(t,e,n,r){return function(i){return i.lift(new P(t,e,n,r))}},ignoreElements:function(){return function(t){return t.lift(new Qn)}},isEmpty:function(){return function(t){return t.lift(new qn)}},last:function(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?ge((function(e,n){return t(e,n,r)})):y,Kn(1),n?sn(e):Tn((function(){return new It})))}},map:Mt,mapTo:function(t){return function(e){return e.lift(new Yn(t))}},materialize:function(){return function(t){return t.lift(new Zn)}},max:function(t){return ir("function"==typeof t?function(e,n){return t(e,n)>0?e:n}:function(t,e){return t>e?t:e})},merge:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(fe.apply(void 0,[e].concat(t)))}},mergeAll:ie,mergeMap:te,flatMap:re,mergeMapTo:function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?te((function(){return t}),e,n):("number"==typeof e&&(n=e),te((function(){return t}),n))},mergeScan:function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new or(t,e,n))}},min:function(t){return ir("function"==typeof t?function(e,n){return t(e,n)<0?e:n}:function(t,e){return t<e?t:e})},multicast:sr,observeOn:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new ot(t,e))}},onErrorResumeNext:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length&&u(t[0])&&(t=t[0]),function(e){return e.lift(new ur(t))}},pairwise:function(){return function(t){return t.lift(new dr)}},partition:function(t,e){return function(n){return[ge(t,e)(n),ge(me(t,e))(n)]}},pluck:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return Mt(fr(t,n))(e)}},publish:function(t){return t?sr((function(){return new x}),t):sr(new x)},publishBehavior:function(t){return function(e){return sr(new j(t))(e)}},publishLast:function(){return function(t){return sr(new lt)(t)}},publishReplay:function(t,e,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,o=new ct(t,e,r);return function(t){return sr((function(){return o}),i)(t)}},race:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return 1===t.length&&u(t[0])&&(t=t[0]),e.lift.call(be.apply(void 0,[e].concat(t)))}},reduce:ir,repeat:function(t){return void 0===t&&(t=-1),function(e){return 0===t?X():t<0?e.lift(new pr(-1,e)):e.lift(new pr(t-1,e))}},repeatWhen:function(t){return function(e){return e.lift(new mr(t))}},retry:function(t){return void 0===t&&(t=-1),function(e){return e.lift(new Ar(t,e))}},retryWhen:function(t){return function(e){return e.lift(new br(t,e))}},refCount:I,sample:function(t){return function(e){return e.lift(new Er(t))}},sampleTime:function(t,e){return void 0===e&&(e=wt),function(n){return n.lift(new Sr(t,e))}},scan:er,sequenceEqual:function(t,e){return function(n){return n.lift(new xr(t,e))}},share:function(){return function(t){return I()(sr(Or)(t))}},shareReplay:function(t,e,n){var r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},function(t){return t.lift(function(t){var e,n,r=t.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=t.windowTime,a=void 0===o?Number.POSITIVE_INFINITY:o,s=t.refCount,c=t.scheduler,u=0,l=!1,d=!1;return function(t){var r;u++,!e||l?(l=!1,e=new ct(i,a,c),r=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){d=!0,n=void 0,e.complete()}})):r=e.subscribe(this),this.add((function(){u--,r.unsubscribe(),n&&!d&&s&&0===u&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(r))}},single:function(t){return function(e){return e.lift(new Mr(t,e))}},skip:function(t){return function(e){return e.lift(new kr(t))}},skipLast:function(t){return function(e){return e.lift(new Nr(t))}},skipUntil:function(t){return function(e){return e.lift(new Ur(t))}},skipWhile:function(t){return function(e){return e.lift(new Fr(t))}},startWith:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return J(n)?(t.pop(),function(e){return ae(t,e,n)}):function(e){return ae(t,e)}},subscribeOn:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Vr(t,e))}},switchAll:function(){return Gr(y)},switchMap:Gr,switchMapTo:function(t,e){return e?Gr((function(){return t}),e):Gr((function(){return t}))},take:In,takeLast:Kn,takeUntil:function(t){return function(e){return e.lift(new qr(t))}},takeWhile:function(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new Kr(t,e))}},tap:function(t,e,n){return function(r){return r.lift(new Jr(t,e,n))}},throttle:function(t,e){return void 0===e&&(e=$r),function(n){return n.lift(new Zr(t,!!e.leading,!!e.trailing))}},throttleTime:function(t,e,n){return void 0===e&&(e=wt),void 0===n&&(n=$r),function(r){return r.lift(new ei(t,e,n.leading,n.trailing))}},throwIfEmpty:Tn,timeInterval:function(t){return void 0===t&&(t=wt),function(e){return se((function(){return e.pipe(er((function(e,n){var r=e.current;return{value:n,current:t.now(),last:r}}),{current:t.now(),value:void 0,last:void 0}),Mt((function(t){var e=t.current,n=t.last,r=t.value;return new ii(r,e-n)})))}))}},timeout:function(t,e){return void 0===e&&(e=wt),oi(t,nt(new Ot),e)},timeoutWith:oi,timestamp:function(t){return void 0===t&&(t=wt),Mt((function(e){return new ci(e,t.now())}))},toArray:function(){return ir(ui,[])},window:function(t){return function(e){return e.lift(new li(t))}},windowCount:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new hi(t,e))}},windowTime:function(t){var e=wt,n=null,r=Number.POSITIVE_INFINITY;return J(arguments[3])&&(e=arguments[3]),J(arguments[2])?e=arguments[2]:de(arguments[2])&&(r=Number(arguments[2])),J(arguments[1])?e=arguments[1]:de(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new pi(t,n,r,e))}},windowToggle:function(t,e){return function(n){return n.lift(new bi(t,e))}},windowWhen:function(t){return function(e){return e.lift(new Ei(t))}},withLatestFrom:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var r=t;return e.lift(new Si(r,n))}},zip:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(Ce.apply(void 0,[e].concat(t)))}},zipAll:function(t){return function(e){return e.lift(new xe(t))}}}),xi=function(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.subscribedFrame=t,this.unsubscribedFrame=e},Ri=function(){function t(){this.subscriptions=[]}return t.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new xi(this.scheduler.now())),this.subscriptions.length-1},t.prototype.logUnsubscribedFrame=function(t){var e=this.subscriptions,n=e[t];e[t]=new xi(n.subscribedFrame,this.scheduler.now())},t}();function Ii(t,e){for(var n=0,r=e.length;n<r;n++)for(var i=e[n],o=Object.getOwnPropertyNames(i.prototype),a=0,s=o.length;a<s;a++){var c=o[a];t.prototype[c]=i.prototype[c]}}var Oi=function(t){function e(e,n){var r=t.call(this,(function(t){var e=this,n=e.logSubscribedFrame(),r=new h;return r.add(new h((function(){e.logUnsubscribedFrame(n)}))),e.scheduleMessages(t),r}))||this;return r.messages=e,r.subscriptions=[],r.scheduler=n,r}return n(e,t),e.prototype.scheduleMessages=function(t){for(var e=this.messages.length,n=0;n<e;n++){var r=this.messages[n];t.add(this.scheduler.schedule((function(t){var e=t.message,n=t.subscriber;e.notification.observe(n)}),r.frame,{message:r,subscriber:t}))}},e}(E);Ii(Oi,[Ri]);var Mi=function(t){function e(e,n){var r=t.call(this)||this;return r.messages=e,r.subscriptions=[],r.scheduler=n,r}return n(e,t),e.prototype._subscribe=function(e){var n=this,r=n.logSubscribedFrame(),i=new h;return i.add(new h((function(){n.logUnsubscribedFrame(r)}))),i.add(t.prototype._subscribe.call(this,e)),i},e.prototype.setup=function(){for(var t=this,e=t.messages.length,n=0;n<e;n++)!function(){var e=t.messages[n];t.scheduler.schedule((function(){e.notification.observe(t)}),e.frame)}()},e}(x);Ii(Mi,[Ri]);var Li=function(t){function e(e){var n=t.call(this,Ct,750)||this;return n.assertDeepEqual=e,n.hotObservables=[],n.coldObservables=[],n.flushTests=[],n.runMode=!1,n}return n(e,t),e.prototype.createTime=function(t){var n=t.indexOf("|");if(-1===n)throw new Error('marble diagram for time should have a completion marker "|"');return n*e.frameTimeFactor},e.prototype.createColdObservable=function(t,n,r){if(-1!==t.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==t.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var i=e.parseMarbles(t,n,r,void 0,this.runMode),o=new Oi(i,this);return this.coldObservables.push(o),o},e.prototype.createHotObservable=function(t,n,r){if(-1!==t.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var i=e.parseMarbles(t,n,r,void 0,this.runMode),o=new Mi(i,this);return this.hotObservables.push(o),o},e.prototype.materializeInnerObservable=function(t,e){var n=this,r=[];return t.subscribe((function(t){r.push({frame:n.frame-e,notification:it.createNext(t)})}),(function(t){r.push({frame:n.frame-e,notification:it.createError(t)})}),(function(){r.push({frame:n.frame-e,notification:it.createComplete()})})),r},e.prototype.expectObservable=function(t,n){var r=this;void 0===n&&(n=null);var i,o=[],a={actual:o,ready:!1},s=e.parseMarblesAsSubscriptions(n,this.runMode),c=s.subscribedFrame===Number.POSITIVE_INFINITY?0:s.subscribedFrame,u=s.unsubscribedFrame;this.schedule((function(){i=t.subscribe((function(t){var e=t;t instanceof E&&(e=r.materializeInnerObservable(e,r.frame)),o.push({frame:r.frame,notification:it.createNext(e)})}),(function(t){o.push({frame:r.frame,notification:it.createError(t)})}),(function(){o.push({frame:r.frame,notification:it.createComplete()})}))}),c),u!==Number.POSITIVE_INFINITY&&this.schedule((function(){return i.unsubscribe()}),u),this.flushTests.push(a);var l=this.runMode;return{toBe:function(t,n,r){a.ready=!0,a.expected=e.parseMarbles(t,n,r,!0,l)}}},e.prototype.expectSubscriptions=function(t){var n={actual:t,ready:!1};this.flushTests.push(n);var r=this.runMode;return{toBe:function(t){var i="string"==typeof t?[t]:t;n.ready=!0,n.expected=i.map((function(t){return e.parseMarblesAsSubscriptions(t,r)}))}}},e.prototype.flush=function(){for(var e=this,n=this.hotObservables;n.length>0;)n.shift().setup();t.prototype.flush.call(this),this.flushTests=this.flushTests.filter((function(t){return!t.ready||(e.assertDeepEqual(t.actual,t.expected),!1)}))},e.parseMarblesAsSubscriptions=function(t,e){var n=this;if(void 0===e&&(e=!1),"string"!=typeof t)return new xi(Number.POSITIVE_INFINITY);for(var r,i=t.length,o=-1,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,c=0,u=function(i){var u=c,d=function(t){u+=t*n.frameTimeFactor},h=t[i];switch(h){case" ":e||d(1);break;case"-":d(1);break;case"(":o=c,d(1);break;case")":o=-1,d(1);break;case"^":if(a!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");a=o>-1?o:c,d(1);break;case"!":if(s!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");s=o>-1?o:c;break;default:if(e&&h.match(/^[0-9]$/)&&(0===i||" "===t[i-1])){var f=t.slice(i).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(f){i+=f[0].length-1;var p=parseFloat(f[1]),v=void 0;switch(f[2]){case"ms":v=p;break;case"s":v=1e3*p;break;case"m":v=1e3*p*60}d(v/l.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+h+"'.")}c=u,r=i},l=this,d=0;d<i;d++)u(d),d=r;return s<0?new xi(a):new xi(a,s)},e.parseMarbles=function(t,e,n,r,i){var o=this;if(void 0===r&&(r=!1),void 0===i&&(i=!1),-1!==t.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var a,s=t.length,c=[],u=i?t.replace(/^[ ]+/,"").indexOf("^"):t.indexOf("^"),l=-1===u?0:u*-this.frameTimeFactor,d="object"!=typeof e?function(t){return t}:function(t){return r&&e[t]instanceof Oi?e[t].messages:e[t]},h=-1,f=function(e){var r=l,s=function(t){r+=t*o.frameTimeFactor},u=void 0,f=t[e];switch(f){case" ":i||s(1);break;case"-":s(1);break;case"(":h=l,s(1);break;case")":h=-1,s(1);break;case"|":u=it.createComplete(),s(1);break;case"^":s(1);break;case"#":u=it.createError(n||"error"),s(1);break;default:if(i&&f.match(/^[0-9]$/)&&(0===e||" "===t[e-1])){var v=t.slice(e).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(v){e+=v[0].length-1;var m=parseFloat(v[1]),g=void 0;switch(v[2]){case"ms":g=m;break;case"s":g=1e3*m;break;case"m":g=1e3*m*60}s(g/p.frameTimeFactor);break}}u=it.createNext(d(f)),s(1)}u&&c.push({frame:h>-1?h:l,notification:u}),l=r,a=e},p=this,v=0;v<s;v++)f(v),v=a;return c},e.prototype.run=function(t){var n=e.frameTimeFactor,r=this.maxFrames;e.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,z.delegate=this;var i={cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)};try{var o=t(i);return this.flush(),o}finally{e.frameTimeFactor=n,this.maxFrames=r,this.runMode=!1,z.delegate=void 0}},e}(Tt),ki=Object.freeze({TestScheduler:Li}),Bi="undefined"!=typeof window&&window,Ni="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Pi="undefined"!=typeof global&&global,Ui=Bi||Pi||Ni;function Di(t,e){return void 0===e&&(e=null),new zi({method:"GET",url:t,headers:e})}function Fi(t,e,n){return new zi({method:"POST",url:t,body:e,headers:n})}function Hi(t,e){return new zi({method:"DELETE",url:t,headers:e})}function ji(t,e,n){return new zi({method:"PUT",url:t,body:e,headers:n})}function Vi(t,e,n){return new zi({method:"PATCH",url:t,body:e,headers:n})}!function(){if(!Ui)throw new Error("RxJS could not find any global context (window, self, global)")}();var Gi=Mt((function(t,e){return t.response}));function Qi(t,e){return Gi(new zi({method:"GET",url:t,responseType:"json",headers:e}))}var zi=function(t){function e(e){var n=t.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(Ui.XMLHttpRequest)return new Ui.XMLHttpRequest;if(Ui.XDomainRequest)return new Ui.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(Ui.XMLHttpRequest)return new Ui.XMLHttpRequest;var t=void 0;try{for(var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(t=e[n],new Ui.ActiveXObject(t))break}catch(t){}return new Ui.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)r.url=e;else for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return n.request=r,n}var r;return n(e,t),e.prototype._subscribe=function(t){return new qi(t,this.request)},e.create=((r=function(t){return new e(t)}).get=Di,r.post=Fi,r.delete=Hi,r.put=ji,r.patch=Vi,r.getJSON=Qi,r),e}(E),qi=function(t){function e(e,n){var r=t.call(this,e)||this;r.request=n,r.done=!1;var i=n.headers=n.headers||{};return n.crossDomain||r.getHeader(i,"X-Requested-With")||(i["X-Requested-With"]="XMLHttpRequest"),r.getHeader(i,"Content-Type")||Ui.FormData&&n.body instanceof Ui.FormData||void 0===n.body||(i["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return n(e,t),e.prototype.next=function(t){this.done=!0;var e,n=this,r=n.xhr,i=n.request,o=n.destination;try{e=new Wi(t,r,i)}catch(t){return o.error(t)}o.next(e)},e.prototype.send=function(){var t=this.request,e=this.request,n=e.user,r=e.method,i=e.url,o=e.async,a=e.password,s=e.headers,c=e.body;try{var u=this.xhr=t.createXHR();this.setupEvents(u,t),n?u.open(r,i,o,n,a):u.open(r,i,o),o&&(u.timeout=t.timeout,u.responseType=t.responseType),"withCredentials"in u&&(u.withCredentials=!!t.withCredentials),this.setHeaders(u,s),c?u.send(c):u.send()}catch(t){this.error(t)}},e.prototype.serializeBody=function(t,e){if(!t||"string"==typeof t)return t;if(Ui.FormData&&t instanceof Ui.FormData)return t;if(e){var n=e.indexOf(";");-1!==n&&(e=e.substring(0,n))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&");case"application/json":return JSON.stringify(t);default:return t}},e.prototype.setHeaders=function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setRequestHeader(n,e[n])},e.prototype.getHeader=function(t,e){for(var n in t)if(n.toLowerCase()===e.toLowerCase())return t[n]},e.prototype.setupEvents=function(t,e){var n=e.progressSubscriber;function r(t){var e,n=r,i=n.subscriber,o=n.progressSubscriber,a=n.request;o&&o.error(t);try{e=new Ji(this,a)}catch(t){e=t}i.error(e)}if(t.ontimeout=r,r.request=e,r.subscriber=this,r.progressSubscriber=n,t.upload&&"withCredentials"in t){var i,o;if(n)i=function(t){i.progressSubscriber.next(t)},Ui.XDomainRequest?t.onprogress=i:t.upload.onprogress=i,i.progressSubscriber=n;o=function(t){var e,n=o,r=n.progressSubscriber,i=n.subscriber,a=n.request;r&&r.error(t);try{e=new Ki("ajax error",this,a)}catch(t){e=t}i.error(e)},t.onerror=o,o.request=e,o.subscriber=this,o.progressSubscriber=n}function a(t){}function s(t){var e=s,n=e.subscriber,r=e.progressSubscriber,i=e.request;if(4===this.readyState){var o=1223===this.status?204:this.status,a="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=a?200:0),o<400)r&&r.complete(),n.next(t),n.complete();else{r&&r.error(t);var c=void 0;try{c=new Ki("ajax error "+o,this,i)}catch(t){c=t}n.error(c)}}}t.onreadystatechange=a,a.subscriber=this,a.progressSubscriber=n,a.request=e,t.onload=s,s.subscriber=this,s.progressSubscriber=n,s.request=e},e.prototype.unsubscribe=function(){var e=this.done,n=this.xhr;!e&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),t.prototype.unsubscribe.call(this)},e}(v),Wi=function(t,e,n){this.originalEvent=t,this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=Xi(this.responseType,e)},Ki=function(){function t(t,e,n){return Error.call(this),this.message=t,this.name="AjaxError",this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=Xi(this.responseType,e),this}return t.prototype=Object.create(Error.prototype),t}();function Xi(t,e){switch(t){case"json":return function(t){return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null")}(e);case"xml":return e.responseXML;case"text":default:return"response"in e?e.response:e.responseText}}var Ji=function(t,e){return Ki.call(this,"ajax timeout",t,e),this.name="AjaxTimeoutError",this},Yi=zi.create,$i=Object.freeze({ajax:Yi,AjaxResponse:Wi,AjaxError:Ki,AjaxTimeoutError:Ji}),Zi={url:"",deserializer:function(t){return JSON.parse(t.data)},serializer:function(t){return JSON.stringify(t)}},to=function(t){function e(e,n){var i=t.call(this)||this;if(e instanceof E)i.destination=n,i.source=e;else{var o=i._config=r({},Zi);if(i._output=new x,"string"==typeof e)o.url=e;else for(var a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new ct}return i}return n(e,t),e.prototype.lift=function(t){var n=new e(this._config,this.destination);return n.operator=t,n.source=this,n},e.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new ct),this._output=new x},e.prototype.multiplex=function(t,e,n){var r=this;return new E((function(i){try{r.next(t())}catch(t){i.error(t)}var o=r.subscribe((function(t){try{n(t)&&i.next(t)}catch(t){i.error(t)}}),(function(t){return i.error(t)}),(function(){return i.complete()}));return function(){try{r.next(e())}catch(t){i.error(t)}o.unsubscribe()}}))},e.prototype._connectSocket=function(){var t=this,e=this._config,n=e.WebSocketCtor,r=e.protocol,i=e.url,o=e.binaryType,a=this._output,s=null;try{s=r?new n(i,r):new n(i),this._socket=s,o&&(this._socket.binaryType=o)}catch(t){return void a.error(t)}var c=new h((function(){t._socket=null,s&&1===s.readyState&&s.close()}));s.onopen=function(e){if(!t._socket)return s.close(),void t._resetState();var n=t._config.openObserver;n&&n.next(e);var r=t.destination;t.destination=v.create((function(e){if(1===s.readyState)try{var n=t._config.serializer;s.send(n(e))}catch(e){t.destination.error(e)}}),(function(e){var n=t._config.closingObserver;n&&n.next(void 0),e&&e.code?s.close(e.code,e.reason):a.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),t._resetState()}),(function(){var e=t._config.closingObserver;e&&e.next(void 0),s.close(),t._resetState()})),r&&r instanceof ct&&c.add(r.subscribe(t.destination))},s.onerror=function(e){t._resetState(),a.error(e)},s.onclose=function(e){t._resetState();var n=t._config.closeObserver;n&&n.next(e),e.wasClean?a.complete():a.error(e)},s.onmessage=function(e){try{var n=t._config.deserializer;a.next(n(e))}catch(t){a.error(t)}}},e.prototype._subscribe=function(t){var e=this,n=this.source;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add((function(){var t=e._socket;0===e._output.observers.length&&(t&&1===t.readyState&&t.close(),e._resetState())})),t)},e.prototype.unsubscribe=function(){var e=this._socket;e&&1===e.readyState&&e.close(),this._resetState(),t.prototype.unsubscribe.call(this)},e}(R);var eo=Ci,no=ki,ro=$i,io=Object.freeze({webSocket:function(t){return new to(t)},WebSocketSubject:to}),oo=Object.freeze({fromFetch:function(t,e){void 0===e&&(e={});var n=e.selector,i=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}(e,["selector"]);return new E((function(e){var o,a=new AbortController,s=a.signal,c=!0,u=!1,l=new h;if(l.add((function(){u=!0,c&&a.abort()})),i){if(i.signal)if(i.signal.aborted)a.abort();else{var d=i.signal,f=function(){s.aborted||a.abort()};d.addEventListener("abort",f),l.add((function(){return d.removeEventListener("abort",f)}))}o=r({},i,{signal:s})}else o={signal:s};return fetch(t,o).then((function(t){n?l.add(Jt(n(t)).subscribe((function(t){return e.next(t)}),(function(t){c=!1,u||e.error(t)}),(function(){c=!1,e.complete()}))):(c=!1,e.next(t),e.complete())})).catch((function(t){c=!1,u||e.error(t)})),l}))}});t.operators=eo,t.testing=no,t.ajax=ro,t.webSocket=io,t.fetch=oo,t.Observable=E,t.ConnectableObservable=k,t.GroupedObservable=F,t.observable=A,t.Subject=x,t.BehaviorSubject=j,t.ReplaySubject=ct,t.AsyncSubject=lt,t.asap=yt,t.asapScheduler=At,t.async=wt,t.asyncScheduler=bt,t.queue=W,t.queueScheduler=q,t.animationFrame=St,t.animationFrameScheduler=_t,t.VirtualTimeScheduler=Tt,t.VirtualAction=Ct,t.Scheduler=Q,t.Subscription=h,t.Subscriber=v,t.Notification=it,t.pipe=b,t.noop=xt,t.identity=y,t.isObservable=function(t){return!!t&&(t instanceof E||"function"==typeof t.lift&&"function"==typeof t.subscribe)},t.ArgumentOutOfRangeError=Rt,t.EmptyError=It,t.ObjectUnsubscribedError=S,t.UnsubscriptionError=d,t.TimeoutError=Ot,t.bindCallback=function t(e,n,r){if(n){if(!J(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return t(e,r).apply(void 0,i).pipe(Mt((function(t){return u(t)?n.apply(void 0,t):n(t)})))};r=n}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i,o=this,a={context:o,subject:i,callbackFunc:e,scheduler:r};return new E((function(n){if(r){var s={args:t,subscriber:n,params:a};return r.schedule(Bt,0,s)}if(!i){i=new lt;try{e.apply(o,t.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.next(t.length<=1?t[0]:t),i.complete()}]))}catch(t){g(i)?i.error(t):console.warn(t)}}return i.subscribe(n)}))}},t.bindNodeCallback=function t(e,n,r){if(n){if(!J(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return t(e,r).apply(void 0,i).pipe(Mt((function(t){return u(t)?n.apply(void 0,t):n(t)})))};r=n}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i={subject:void 0,args:t,callbackFunc:e,scheduler:r,context:this};return new E((function(n){var o=i.context,a=i.subject;if(r)return r.schedule(Pt,0,{params:i,subscriber:n,context:o});if(!a){a=i.subject=new lt;try{e.apply(o,t.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.shift();n?a.error(n):(a.next(t.length<=1?t[0]:t),a.complete())}]))}catch(t){g(a)?a.error(t):console.warn(t)}}return a.subscribe(n)}))}},t.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,r=void 0;return J(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),tt(t,r).lift(new Wt(n))},t.concat=ae,t.defer=se,t.empty=X,t.forkJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if(u(n))return ce(n,null);if(l(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return ce(r.map((function(t){return n[t]})),r)}}if("function"==typeof t[t.length-1]){var i=t.pop();return ce(t=1===t.length&&u(t[0])?t[0]:t,null).pipe(Mt((function(t){return i.apply(void 0,t)})))}return ce(t,null)},t.from=Jt,t.fromEvent=function t(e,n,r,o){return i(r)&&(o=r,r=void 0),o?t(e,n,r).pipe(Mt((function(t){return u(t)?o.apply(void 0,t):o(t)}))):new E((function(t){ue(e,n,(function(e){arguments.length>1?t.next(Array.prototype.slice.call(arguments)):t.next(e)}),t,r)}))},t.fromEventPattern=function t(e,n,r){return r?t(e,n).pipe(Mt((function(t){return u(t)?r.apply(void 0,t):r(t)}))):new E((function(t){var r,o=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1===e.length?e[0]:e)};try{r=e(o)}catch(e){return void t.error(e)}if(i(n))return function(){return n(o,r)}}))},t.generate=function(t,e,n,r,i){var o,a;if(1==arguments.length){var s=t;a=s.initialState,e=s.condition,n=s.iterate,o=s.resultSelector||y,i=s.scheduler}else void 0===r||J(r)?(a=t,o=y,i=r):(a=t,o=r);return new E((function(t){var r=a;if(i)return i.schedule(le,0,{subscriber:t,iterate:n,condition:e,resultSelector:o,state:r});for(;;){if(e){var s=void 0;try{s=e(r)}catch(e){return void t.error(e)}if(!s){t.complete();break}}var c=void 0;try{c=o(r)}catch(e){return void t.error(e)}if(t.next(c),t.closed)break;try{r=n(r)}catch(e){return void t.error(e)}}}))},t.iif=function(t,e,n){return void 0===e&&(e=K),void 0===n&&(n=K),se((function(){return t()?e:n}))},t.interval=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=wt),(!de(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=wt),new E((function(n){return n.add(e.schedule(he,t,{subscriber:n,counter:0,period:t})),n}))},t.merge=fe,t.never=function(){return pe},t.of=et,t.onErrorResumeNext=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)return K;var r=e[0],i=e.slice(1);return 1===e.length&&u(r)?t.apply(void 0,r):new E((function(e){var n=function(){return e.add(t.apply(void 0,i).subscribe(e))};return Jt(r).subscribe({next:function(t){e.next(t)},error:n,complete:n})}))},t.pairs=function(t,e){return new E(e?function(n){var r=Object.keys(t),i=new h;return i.add(e.schedule(ve,0,{keys:r,index:0,subscriber:n,subscription:i,obj:t})),i}:function(e){for(var n=Object.keys(t),r=0;r<n.length&&!e.closed;r++){var i=n[r];t.hasOwnProperty(i)&&e.next([i,t[i]])}e.complete()})},t.partition=function(t,e,n){return[ge(e,n)(new E(Qt(t))),ge(me(e,n))(new E(Qt(t)))]},t.race=be,t.range=function(t,e,n){return void 0===t&&(t=0),new E((function(r){void 0===e&&(e=t,t=0);var i=0,o=t;if(n)return n.schedule(_e,0,{index:i,count:e,start:t,subscriber:r});for(;;){if(i++>=e){r.complete();break}if(r.next(o++),r.closed)break}}))},t.throwError=nt,t.timer=Se,t.using=function(t,e){return new E((function(n){var r,i;try{r=t()}catch(t){return void n.error(t)}try{i=e(r)}catch(t){return void n.error(t)}var o=(i?Jt(i):K).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},t.zip=Ce,t.scheduled=Xt,t.EMPTY=K,t.NEVER=pe,t.config=a,Object.defineProperty(t,"__esModule",{value:!0})}));
/**
 * @license rxcomp v1.0.0-beta.20
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var rxcomp=function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function u(t,e,n){return(u=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return u(t,arguments,a(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}var d={},h={},f=function(){function t(){this.rxcompId=-1,this.unsubscribe$=new e.Subject,this.changes$=new e.ReplaySubject(1)}var n=t.prototype;return n.onInit=function(){},n.onChanges=function(t){},n.onView=function(){},n.onDestroy=function(){},n.pushChanges=function(){p(this).module.instances&&(this.changes$.next(this),this.onView())},n.onParentDidChange=function(t){p(this).module.resolveInputsOutputs(this,t),this.onChanges(t),this.pushChanges()},t.getInputsTokens=function(t,e,n){var r,i={};return null==(r=this.meta.inputs)||r.forEach((function(t){var r=n.resolveAttribute(t,e);r&&(i[t]=r)})),i},t}();function p(t){return d[t.rxcompId]}var v=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(f),m=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).class="",e.keys=[],e}o(e,t);var n=e.prototype;return n.onInit=function(){var t=this,e=p(this).node;Array.prototype.slice.call(e.classList).forEach((function(e){t.keys.push(e)}))},n.onChanges=function(){var t=p(this).node,e=[],n=this.class;if("object"==typeof n)for(var r in n)n[r]&&e.push(r);else"string"==typeof n&&(e=n.split(/\s+/));e=e.concat(this.keys),t.setAttribute("class",e.join(" "))},e}(v);m.meta={selector:"[[class]]",inputs:["class"]};var g=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(l(Error)),A=function(t){function e(e,n,r,i,o){var a,s="ExpressionError in "+r.constructor.name+' "'+i+'"\n\t\t'+e.message;(a=t.call(this,s)||this).name=e.name,a.module=n,a.instance=r,a.expression=i,a.params=o;var c=p(r).node;return a.template=c.outerHTML,a}return o(e,t),e}(l(Error)),y=function(){function t(t,e){this.next=t,this.interceptor=e}return t.prototype.handle=function(t){return this.interceptor.intercept(t,this.next)},t}(),b=function(){function t(){}return t.prototype.handle=function(t){return e.of(t)},t}(),w=[],E=new e.ReplaySubject(1),_=E.pipe(n.switchMap((function(t){return w.reduceRight((function(t,e){return new y(t,e)}),new b).handle(t)})),n.tap((function(t){t&&console.error(t)}))),S=function(t){function r(){var e;return(e=t.apply(this,arguments)||this).event="",e}return o(r,t),r.prototype.onInit=function(){var t=p(this),r=t.module,i=t.node,o=t.parentInstance,a=t.selector,s=this.event=a.replace(/\[|\]|\(|\)/g,""),c=e.fromEvent(i,s).pipe(n.shareReplay(1)),u=i.getAttribute("("+s+")");if(u){var l=r.makeFunction(u,["$event"]);c.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(l,o,t)}))}else o[s+"$"]=c},r}(v);S.meta={selector:"[("+["mousedown","mouseup","mousemove","click","dblclick","mouseover","mouseout","mouseenter","mouseleave","contextmenu","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var T=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(f),C=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.pushChanges=function(){var t=p(this),e=t.module,n=t.node;e.instances&&(this.changes$.next(this),e.parse(n,this),this.onView())},e}(f),x=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"],R=function(t){function e(n,r){var i;return void 0===r&&(r={}),i=t.call(this)||this,r=e.mergeDescriptors(n,n,r),r=e.mergeDescriptors(Object.getPrototypeOf(n),n,r),Object.defineProperties(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i),r),i}o(e,t);var n=e.prototype;return n.pushChanges=function(){var e=this,n=p(this);n.keys||(n.keys=Object.keys(n.parentInstance).filter((function(t){return-1===x.indexOf(t)}))),n.module.instances&&n.keys.forEach((function(t){e[t]=n.parentInstance[t]})),t.prototype.pushChanges.call(this)},n.onParentDidChange=function(t){this.onChanges(t),this.pushChanges()},e.mergeDescriptors=function(t,e,n){void 0===n&&(n={});for(var r=Object.getOwnPropertyNames(t),i=function(){var i=r.shift();if(-1===x.indexOf(i)&&!n.hasOwnProperty(i)){var o=Object.getOwnPropertyDescriptor(t,i);"function"==typeof o.value&&(o.value=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e[i].apply(e,n)}),n[i]=o}};r.length;)i();return n},e}(C),I=function(t){function e(e,n,r,i,o,a,s){var c;return(c=t.call(this,s)||this)[e]=n,c[r]=i,c.index=o,c.count=a,c}return o(e,t),i(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(R),O=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).instances=[],e}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p(this).node,e=this.forbegin=document.createComment("*for begin");e.rxcompId=t.rxcompId,t.parentNode.replaceChild(e,t);var n=this.forend=document.createComment("*for end");e.parentNode.insertBefore(n,e.nextSibling),t.removeAttribute("*for")},n.onChanges=function(){for(var t=p(this),e=t.module,n=t.node,r=this.tokens,i=this.for||[],o=Array.isArray(i),a=o?i:Object.keys(i),s=a.length,c=this.instances.length,u=0;u<Math.max(c,s);u++)if(u<s){var l=o?u:a[u],d=o?a[l]:i[l];if(u<c){var h=this.instances[u];h[r.key]=l,h[r.value]=d}else{var f=n.cloneNode(!0);delete f.rxcompId,this.forend.parentNode.insertBefore(f,this.forend);var v=[r.key,l,r.value,d,u,s,t.parentInstance],m=e.makeInstance(f,I,t.selector,t.parentInstance,v,void 0,!0);m&&(e.compile(f,m),e.makeInstanceSubscription(m,t.parentInstance),this.instances.push(m))}}else{var g=p(this.instances[u]).node;g.parentNode.removeChild(g),e.remove(g)}this.instances.length=a.length},e.getInputsTokens=function(t,n,r){var i={},o=n.getAttribute("*for");if(o){var a=e.getForExpressionTokens(o);t.tokens=a,i.for=a.iterable}return i},e.getForExpressionTokens=function(t){if(null===t)throw new Error("invalid for");if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw new Error("invalid for");var e=t.split(";").map((function(t){return t.trim()})).filter((function(t){return""!==t})),n=e[0].split(" of ").map((function(t){return t.trim()})),r=n[0].replace(/\s*let\s*/,""),i=n[1],o="index",a=r.match(/\[(.+)\s*,\s*(.+)\]/);if(a&&(o=a[1],r=a[2]),e.length>1){var s=e[1].split(/\s*let\s*|\s*=\s*index/).map((function(t){return t.trim()}));3===s.length&&(o=s[1])}return{key:o,value:r,iterable:i}},e}(T);O.meta={selector:"[*for]",inputs:["for"]};var M=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),i(e,[{key:"target",set:function(t){if(this.target_!==t){this.target_=t;var e=p(this).node;t?e.setAttribute("target",t):e.removeAttribute("target")}},get:function(){return this.target_}}]),e}(v);M.meta={selector:"[[target]]",inputs:["target"]};var L=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),i(e,[{key:"href",set:function(t){if(this.href_!==t){this.href_=t;var e=p(this).node;t?e.setAttribute("href",t):e.removeAttribute("href")}},get:function(){return this.href_}}]),e}(v);L.meta={selector:"[[href]]",inputs:["href"]};var k=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p(this).node,e=this.ifbegin=document.createComment("*if begin");e.rxcompId=t.rxcompId,t.parentNode.replaceChild(e,t);var n=this.ifend=document.createComment("*if end");e.parentNode.insertBefore(n,e.nextSibling);var r=t.cloneNode(!0);r.removeAttribute("*if"),this.clonedNode=r,this.element=r.cloneNode(!0)},n.onChanges=function(){var t=p(this).module,e=this.element;if(Boolean(this.if)){if(!e.parentNode){var n=this.ifend;n.parentNode.insertBefore(e,n),t.compile(e)}}else e.parentNode&&(t.remove(e,this),e.parentNode.removeChild(e),this.element=this.clonedNode.cloneNode(!0))},e}(T);k.meta={selector:"[*if]",inputs:["if"]};var B=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),i(e,[{key:"innerHTML",set:function(t){this.innerHTML_!==t&&(this.innerHTML_=t,p(this).node.innerHTML=null==t?"":t)},get:function(){return this.innerHTML_}}]),e}(v);B.meta={selector:"[innerHTML]",inputs:["innerHTML"]};var N=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e}return o(e,t),e.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},e}(C);N.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var P=function(){function t(){}return t.transform=function(t){return t},t}(),U=[T,C,v],D=function(){function t(){}return t.bootstrap=function(t){if(!t)throw new g("missing moduleFactory");if(!t.meta)throw new g("missing moduleFactory meta");if(!t.meta.bootstrap)throw new g("missing bootstrap");if(!t.meta.bootstrap.meta)throw new g("missing bootstrap meta");if(!t.meta.bootstrap.meta.selector)throw new g("missing bootstrap meta selector");var e=this.resolveMeta(t),n=new t;return n.meta=e,e.imports.forEach((function(t){t.prototype.constructor.call(n)})),n},t.querySelector=function(t){return document.querySelector(t)},t.resolveMeta=function(t){var e=this.resolveImportedMeta(t),n=t.meta.bootstrap,r=this.querySelector(n.meta.selector);if(!r)throw new g("missing node "+n.meta.selector);var i=r.innerHTML,o=this.resolvePipes(e),a=this.resolveFactories(e);return this.sortFactories(a),a.unshift(n),{factories:a,pipes:o,selectors:this.unwrapSelectors(a),bootstrap:n,node:r,nodeInnerHTML:i,imports:t.meta.imports||[]}},t.resolveImportedMeta=function(t){var e=this,n=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},t.meta);return n.imports=(t.meta.imports||[]).map((function(t){return e.resolveImportedMeta(t)})),n},t.resolvePipes=function(t,e){var n=this,r=t.imports.map((function(t){return n.resolvePipes(t,!0)})),i={};return(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof P})).forEach((function(t){return i[t.meta.name]=t})),Object.assign.apply(Object,[{}].concat(r,[i]))},t.resolveFactories=function(t,e){var n,r=this,i=t.imports.map((function(t){return r.resolveFactories(t,!0)})),o=(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof f}));return(n=Array.prototype.concat).call.apply(n,[o].concat(i))},t.sortFactories=function(t){t.sort((function(t,e){var n=U.reduce((function(e,n,r){return t.prototype instanceof n?r:e}),-1)-U.reduce((function(t,n,r){return e.prototype instanceof n?r:t}),-1);return 0===n?(t.meta.hosts?1:0)-(e.meta.hosts?1:0):n}))},t.getExpressions=function(t){var e=[];return t.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(t,n,r,i,o,a,s){return n&&e.push((function(t){return t.classList.contains(n)})),r&&e.push((function(t){return t.hasAttribute(r)&&t.getAttribute(r)===o||t.hasAttribute("["+r+"]")&&t.getAttribute("["+r+"]")===o})),a&&e.push((function(t){return t.hasAttribute(a)||t.hasAttribute("["+a+"]")})),s&&e.push((function(t){return t.nodeName.toLowerCase()===s.toLowerCase()})),""})),e},t.unwrapSelectors=function(t){var e=this,n=[];return t.forEach((function(t){t.meta&&t.meta.selector&&t.meta.selector.split(",").forEach((function(r){r=r.trim();var i=[],o=r.replace(/\:not\((.+?)\)/g,(function(t,n){return i=e.getExpressions(n),""})),a=e.getExpressions(o);n.push((function(e){var n=a.reduce((function(t,n){return t&&n(e)}),!0),o=i.reduce((function(t,n){return t||n(e)}),!1);return!(!n||o)&&{node:e,factory:t,selector:r}}))}))})),n},t}(),F="undefined"!=typeof window&&void 0!==window.document,H="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Node.js")||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("jsdom"),j="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,V="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,G=j,Q=!j&&F,z=V,q=function(){function t(){}return t.encode=function(t,e){return void 0===e&&(e=[W]),e.reduce((function(t,e){return e(t)}),t)},t.decode=function(t,e){return void 0===e&&(e=[X]),e.reduce((function(t,e){return e(t)}),t)},t.encodeJson=function(t){return this.encode(t,[W])},t.decodeJson=function(t){return this.decode(t,[X])},t.encodeBase64=function(t){return this.encode(t,[W,J])},t.decodeBase64=function(t){return this.decode(t,[Y,X])},t}();function W(t,e,n){var r;try{var i=[];r=JSON.stringify(t,(function(t,n){if("object"==typeof n&&null!=n){if(-1!==i.indexOf(n))return e;i.push(n)}return n}),n)}catch(t){}return r}function K(t,e){return function(n){return W(n,t,e)}}function X(t){var e;if(t)try{e=JSON.parse(t)}catch(t){}return e}function J(t){var e;try{e=Q?btoa(t):Buffer.from(t).toString("base64")}catch(n){e=t}return e}function Y(t){var e;try{e=Q?atob(t):Buffer.from(t,"base64").toString()}catch(n){e=t}return e}var $=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.transform=function(t){return q.encode(t,[K("#ref",2)])},e}(P);$.meta={name:"json"};var Z="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,tt=0,et=function(){function t(){this.unsubscribe$=new e.Subject}var r=t.prototype;return r.compile=function(e,n){var r,i=this;return t.querySelectorsAll(e,this.meta.selectors,[]).map((function(t){r&&r!==t.node&&(n=void 0);var e=i.makeInstance(t.node,t.factory,t.selector,n);return t.factory.prototype instanceof C&&(r=t.node),e})).filter((function(t){return void 0!==t}))},r.makeInstance=function(e,n,r,i,o,a,s){if(void 0===s&&(s=!1),i||e.parentNode){var c=n.meta;if(!(i=i||this.getParentInstance(e.parentNode)))return;var l=u(n,o||[]);a&&Object.keys(a).forEach((function(t){Object.defineProperty(l,t,{value:a[t],configurable:!1,enumerable:!1,writable:!0})}));var d=t.makeContext(this,l,i,e,n,r);return l instanceof R||(this.makeHosts(c,l,e),d.inputs=this.makeInputs(c,l,e,n),d.outputs=this.makeOutputs(c,l),this.resolveInputsOutputs(l,i)),l.onInit(),s||this.makeInstanceSubscription(l,i),l}},r.makeInstanceSubscription=function(t,e){e instanceof f&&e.changes$.pipe(n.takeUntil(t.unsubscribe$)).subscribe((function(e){t.onParentDidChange(e)}))},r.makeFunction=function(e,n){void 0===n&&(n=["$instance"]),e=t.parseExpression(e);var r="with(this) {\n\treturn (function ("+n.join(",")+", $$module) {\n\t\ttry {\n\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\treturn "+e+";\n\t\t} catch(error) {\n\t\t\t$$module.nextError(error, this, "+JSON.stringify(e)+", arguments);\n\t\t}\n\t}.bind(this)).apply(this, arguments);\n}",i=new Function(r);return i.expression=e,i},r.resolveInputsOutputs=function(t,e){var n=p(t),r=n.parentInstance,i=n.inputs;for(var o in i){var a=i[o],s=this.resolve(a,r,t);t[o]=s}},r.resolveAttribute=function(t,e){var n=null;if(e.hasAttribute("["+t+"]"))n=e.getAttribute("["+t+"]");else if(e.hasAttribute("*"+t))n=e.getAttribute("*"+t);else if(e.hasAttribute(t)&&(n=e.getAttribute(t))){var r=n.replace(/({{)|(}})|(")/g,(function(t,e,n,r){return e?'"+':n?'+"':r?'"':""}));n='"'+r+'"'}return n},r.resolve=function(t,e,n){return t.apply(e,[n,this])},r.parse=function(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType){var i=r;nt(i)||this.parse(i,e)}else if(3===r.nodeType){var o=r;this.parseTextNode(o,e)}}},r.remove=function(e,n){var r=n?p(n):void 0;return t.traverseDown(e,(function(e){var n=e.rxcompId;n&&(0===t.deleteContext(n,r).length&&delete e.rxcompId)})),e},r.destroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML},r.nextError=function(t,e,n,r){var i=new A(t,this,e,n,r);E.next(i)},r.makeContext=function(e,n,r,i){return t.makeContext(this,e,n,r,e.constructor,i)},r.makeHosts=function(t,e,n){t.hosts&&Object.keys(t.hosts).forEach((function(r){var i=t.hosts[r];e[r]=it(e,i,n)}))},r.makeInputs=function(t,e,n,r){var i=this,o={},a=r.getInputsTokens(e,n,this);return Object.keys(a).forEach((function(t){o[t]=i.makeFunction(a[t])})),o},r.makeOutput=function(t,r){var i=this,o=p(t),a=o.node,s=o.parentInstance,c=a.getAttribute("("+r+")"),u=c?this.makeFunction(c,["$event"]):null,l=(new e.Subject).pipe(n.tap((function(t){u&&i.resolve(u,s,t)})));return l.pipe(n.takeUntil(t.unsubscribe$)).subscribe(),t[r]=l,l},r.makeOutputs=function(t,e){var n=this,r={};return t.outputs&&t.outputs.forEach((function(t){var i=n.makeOutput(e,t);i&&(r[t]=i)})),r},r.getInstance=function(t){if(t===document)return Z;var e=rt(t);return e?e.instance:void 0},r.getParentInstance=function(e){var n=this;return t.traverseUp(e,(function(t){return n.getInstance(t)}))},r.parseTextNode=function(t,e){var n=this,r=t.nodeExpressions;if(r||(r=this.parseTextNodeExpression(t.wholeText)),r.length){var i=r.reduce((function(t,r){var i;return"function"==typeof r?null==(i=n.resolve(r,e,e))&&(i=""):i=r,t+i}),"");if(t.nodeValue!==i){var o=document.createTextNode(i);o.nodeExpressions=r,t.parentNode.replaceChild(o,t)}}else t.nodeExpressions=r},r.pushFragment=function(t,e,n,r){var i=t.substring(e,n);r.push(i)},r.parseTextNodeExpression=function(t){for(var e,n=[],r=/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g,i=0;null!==(e=r.exec(t));){var o=r.lastIndex-e[0].length;if(o>i&&this.pushFragment(t,o,i,n),i=r.lastIndex,e[1]){var a=this.makeFunction(e[1]);n.push(a)}}var s=t.length;return s>i&&this.pushFragment(t,i,s,n),n.find((function(t){return"function"==typeof t}))?n:[]},t.makeContext=function(t,e,n,r,i,o){e.rxcompId=++tt;var a={module:t,instance:e,parentInstance:n,node:r,factory:i,selector:o},s=r.rxcompId=r.rxcompId||e.rxcompId;return(h[s]||(h[s]=[])).push(a),d[e.rxcompId]=a,a},t.parseExpression=function(e){for(var n=/(\()([^\(\)]*)(\))/;e.match(n);)e=e.replace(n,(function(e){return"┌"+t.parsePipes(arguments.length<=2?void 0:arguments[2])+"┘"}));return e=(e=t.parsePipes(e)).replace(/(┌)|(┘)/g,(function(t){return(arguments.length<=1?void 0:arguments[1])?"(":")"})),t.parseOptionalChaining(e)},t.parsePipes=function(e){for(var n=/(.*?[^\|])\|([^\|]+)/;e.match(n);)e=e.replace(n,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r[0].trim(),a=t.parsePipeParams(r[1]),s=a.shift().trim();return"$$pipes."+s+".transform┌"+[o].concat(a)+"┘"}));return e},t.parsePipeParams=function(t){for(var e=[],n=0,r="",i=0,o=t.length;n<o;){var a=t.substr(n,1);"{"!==a&&"("!==a&&"["!==a||i++,"}"!==a&&")"!==a&&"]"!==a||i--,":"===a&&0===i?(r.length&&e.push(r.trim()),r=""):r+=a,n++}return r.length&&e.push(r.trim()),e},t.parseOptionalChaining=function(t){var e;return t=t.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(t){for(var n=t.split("?."),r=0;r<n.length-1;r++){var i=r>0?"("+n[r]+" = "+e+")":n[r],o=n[r+1];e=r>0?i+"."+o:"("+i+" ? "+i+"."+o+" : void 0)"}return e||""}))},t.deleteContext=function(t,e){var n=[],r=h[t];return r&&(r.forEach((function(t){if(t===e)n.push(e);else{var r=t.instance;r.unsubscribe$.next(),r.unsubscribe$.complete(),r.onDestroy(),delete d[r.rxcompId]}})),n.length?h[t]=n:delete h[t]),n},t.matchSelectors=function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r](t);if(i){var o=i.factory;if(o.prototype instanceof C&&o.meta.template&&(t.innerHTML=o.meta.template),n.push(i),o.prototype instanceof T)break}}return n},t.querySelectorsAll=function(t,e,n){if(1===t.nodeType){var r=this.matchSelectors(t,e,[]);if(n=n.concat(r),r.find((function(t){return t.factory.prototype instanceof T})))return n;for(var i=t.childNodes,o=0;o<i.length;o++)n=this.querySelectorsAll(i[o],e,n)}return n},t.traverseUp=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseUp(t.parentNode,e,n+1)}},t.traverseDown=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);if(r)return r;if(1===t.nodeType)for(var i=0,o=t.childNodes.length;i<o&&!r;)r=this.traverseDown(t.childNodes[i],e,n+1),i++;return r}},t.traversePrevious=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traversePrevious(t.previousSibling,e,n+1)}},t.traverseNext=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseNext(t.nextSibling,e,n+1)}},t}();function nt(t){var e,n=t.rxcompId;if(n){var r=h[n];r&&(e=r.reduce((function(t,e){return e.instance instanceof R?t||e:e.instance instanceof C?e:t}),void 0))}return e}function rt(t){var e=nt(t);if(!(e&&e.factory.prototype instanceof T))return e}function it(t,e,n){if(n||(n=p(t).node),n.rxcompId){var r=h[n.rxcompId];if(r)for(var i=0;i<r.length;i++){var o=r[i];if(o.instance!==t&&o.instance instanceof e)return o.instance}}return n.parentNode?it(t,e,n.parentNode):void 0}var ot=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),i(e,[{key:"src",set:function(t){if(this.src_!==t){this.src_=t;var e=p(this).node;t?e.setAttribute("src",t):e.removeAttribute("src")}},get:function(){return this.src_}}]),e}(v);ot.meta={selector:"[[src]]",inputs:["src"]};var at=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.onChanges=function(){var t=p(this).node,e=this.style,n=this.previousStyle;if(n)for(var r in n)if(!e||!e[r]){var i=r.split(".").shift();t.style.removeProperty(i)}if(e)for(var o in e)if(!n||n[o]!==e[o]){var a=o.split("."),s=a.shift(),c=e[o]+(a.length?a[0]:"");t.style.setProperty(s,c)}this.previousStyle=e},e}(v);at.meta={selector:"[[style]]",inputs:["style"]};var st=[m,S,O,L,M,k,B,N,ot,at],ct=[$],ut=function(t){function e(){var e;return e=t.call(this)||this,_.pipe(n.takeUntil(e.unsubscribe$)).subscribe(),e}return o(e,t),e}(et);ut.meta={declarations:[].concat(st,ct),exports:[].concat(st,ct)};var lt=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.bootstrap=function(t){if(!Q)throw new g("missing platform browser, Window not found");if(!t)throw new g("missing moduleFactory");if(!t.meta)throw new g("missing moduleFactory meta");if(!t.meta.bootstrap)throw new g("missing bootstrap");if(!t.meta.bootstrap.meta)throw new g("missing bootstrap meta");if(!t.meta.bootstrap.meta.selector)throw new g("missing bootstrap meta selector");var e=this.resolveMeta(t),n=new t;if(n.meta=e,e.imports.forEach((function(t){t.prototype.constructor.call(n)})),Z.rxcomp_hydrate_){var r,i=e.node.cloneNode();i.innerHTML=e.nodeInnerHTML=Z.rxcomp_hydrate_.innerHTML;var o=n.compile(i,Z);n.instances=o,o[0].pushChanges(),null==(r=e.node.parentNode)||r.replaceChild(i,e.node)}else{var a=n.compile(e.node,Z);n.instances=a,a[0].pushChanges()}return n},e}(D);var dt=function(){function t(){}return t.makeKey=function(t,e){var n="rxcomp-hydrate-"+t+"-"+(e?ht(e):"");return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"}))},t.has=function(t){return null!==document.querySelector("#"+t)},t.get=function(t){var e=document.querySelector("#"+t);if(e&&e.firstChild){var n=e.firstChild.nodeValue;return n?q.decode(n,[X]):void 0}},t.set=function(t,e){var n=q.encode(e,[W]);if(n){var r=document.createTextNode(n),i=document.querySelector("#"+t);i?i.replaceChild(r,i.firstChild):((i=document.createElement("script")).setAttribute("id",t),i.setAttribute("type","text/template"),i.append(r),document.head.append(i))}},t.remove=function(t){var e=document.querySelector("#"+t);e&&e.parentNode&&e.parentNode.removeChild(e)},t}();function ht(t,e){return void 0===e&&(e=""),"number"==typeof t?e+="-"+t.toString():"string"==typeof t?e+="-"+t.substr(0,20):t&&Array.isArray(t)?e+="-"+t.map((function(t){return ht(t)})).join(""):t&&"object"==typeof t&&(e+="-"+Object.keys(t).map((function(e){return e+ht(t[e])})).join("-")),e}return t.Browser=lt,t.ClassDirective=m,t.Component=C,t.Context=R,t.CoreModule=ut,t.DefaultErrorHandler=b,t.Directive=v,t.ErrorInterceptorHandler=y,t.ErrorInterceptors=w,t.EventDirective=S,t.ExpressionError=A,t.Factory=f,t.ForItem=I,t.ForStructure=O,t.HrefDirective=L,t.HrefTargetDirective=M,t.IfStructure=k,t.InnerHtmlDirective=B,t.JsonComponent=N,t.JsonPipe=$,t.Module=et,t.ModuleError=g,t.PLATFORM_BROWSER=F,t.PLATFORM_JS_DOM=H,t.PLATFORM_NODE=j,t.PLATFORM_WEB_WORKER=V,t.Pipe=P,t.Platform=D,t.Serializer=q,t.SrcDirective=ot,t.Structure=T,t.StyleDirective=at,t.TransferService=dt,t.WINDOW=Z,t.decodeBase64=Y,t.decodeJson=X,t.encodeBase64=J,t.encodeJson=W,t.encodeJsonWithOptions=K,t.errors$=_,t.getContext=p,t.getContextByNode=rt,t.getHost=it,t.getLocationComponents=function(t){for(var e,n="",r="",i="",o="",a="",s="",c="",u=/^((http\:|https\:)?\/\/)?((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])|locahost)?(\:([^\/]+))?(\.?\/[^\?]+)?(\?[^\#]+)?(\#.+)?$/g,l=[];null!==(e=u.exec(t));)l.push(e);for(var d=0,h=l;d<h.length;d++){var f=h[d];n=f[2]||"",r=i=f[3]||"",o=f[11]||"",a=f[12]||"",s=f[13]||"",c=f[14]||""}return{href:t,protocol:n,host:r,hostname:i,port:o,pathname:a,search:s,hash:c}},t.getParsableContextByElement=nt,t.isPlatformBrowser=Q,t.isPlatformServer=G,t.isPlatformWorker=z,t.nextError$=E,t.optionsToKey=ht,t}({},rxjs,rxjs.operators);
/**
 * @license rxcomp-form v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */this.rxcomp=this.rxcomp||{},this.rxcomp.form=function(t,e,n,r){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var s=function(t){function n(){return t.apply(this,arguments)||this}return a(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(t){r[t]?n.classList.add(t):n.classList.remove(t)}))},o(n,[{key:"control",get:function(){return{}}}]),n}(e.Directive);s.meta={selector:"",hosts:{host:s}};var c=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),o(e,[{key:"control",get:function(){if(this.formArray)return this.formArray;if(!this.host)throw"missing form collection";return this.host.control.get(this.formArrayName)}}]),e}(s);c.meta={selector:"[formArray],[formArrayName]",inputs:["formArray","formArrayName"],hosts:{host:s}};var u=function(t){function i(){return t.apply(this,arguments)||this}a(i,t);var s=i.prototype;return s.onInit=function(){var t=this,i=e.getContext(this).node;n.fromEvent(i,"input").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},s.onChanges=function(t){var n=e.getContext(this).node;this.formControlName&&(n.name=this.formControlName);var r=this.control,i=r.flags;Object.keys(i).forEach((function(t){i[t]?n.classList.add(t):n.classList.remove(t)})),this.writeValue(r.value)},s.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},s.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},s.onBlur=function(t){this.control.touched=!0},s.setDisabledState=function(t){e.getContext(this).node.disabled=t},o(i,[{key:"control",get:function(){if(this.formControl)return this.formControl;if(!this.host)throw"missing form collection";return this.host.control.get(this.formControlName)}}]),i}(e.Directive);u.meta={selector:"",inputs:["formControl","formControlName","value"],hosts:{host:s}};var l=function(t){function i(){return t.apply(this,arguments)||this}a(i,t);var o=i.prototype;return o.onInit=function(){var t=this,i=e.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},o.writeValue=function(t){var n=e.getContext(this).node;t===this.value?n.setAttribute("checked",t):n.removeAttribute("checked")},o.setDisabledState=function(t){e.getContext(this).node.disabled=t},o.onChange=function(t){var n=e.getContext(this).node;this.control.value=n.checked?this.value:!0!==this.value&&null},o.onBlur=function(t){this.control.touched=!0},i}(u);l.meta={selector:"input[type=checkbox][formControl],input[type=checkbox][formControlName]",inputs:["formControl","formControlName","value"],hosts:{host:s}};var d=function(t){function n(){return t.apply(this,arguments)||this}return a(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(t){r[t]?n.classList.add(t):n.classList.remove(t)}))},o(n,[{key:"control",get:function(){if(this.formField)return this.formField;if(!this.host)throw"missing form collection";return this.host.control.get(this.formFieldName)}}]),n}(e.Component);d.meta={selector:"[formField],[formFieldName]",inputs:["formField","formFieldName"],hosts:{host:s}};var h=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),o(e,[{key:"control",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control.get(this.formGroupName)}}]),e}(s);h.meta={selector:"[formGroup],[formGroupName]",inputs:["formGroup","formGroupName"],hosts:{host:s}};var f=function(t){function n(){return t.apply(this,arguments)||this}a(n,t);var r=n.prototype;return r.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},r.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(t){this.control.touched=!0},n}(u);f.meta={selector:"input[type=text][formControl],input[type=text][formControlName],input[type=email][formControl],input[type=email][formControlName],input[type=password][formControl],input[type=password][formControlName],textarea[formControl],textarea[formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var p=function(t){function n(){return t.apply(this,arguments)||this}return a(n,t),n.prototype.onChanges=function(t){e.getContext(this).node.setAttribute("placeholder",this.placeholder||"")},n}(e.Directive);p.meta={selector:"input[placeholder],textarea[placeholder]",inputs:["placeholder"]};var v=function(t){function i(){return t.apply(this,arguments)||this}a(i,t);var o=i.prototype;return o.onInit=function(){var t=this,i=e.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},o.writeValue=function(t){var n=e.getContext(this).node;n.checked=n.value===t},o.setDisabledState=function(t){e.getContext(this).node.disabled=t},o.onChange=function(t){var n=e.getContext(this).node;n.checked&&(this.control.value=n.value)},o.onBlur=function(t){this.control.touched=!0},i}(u);v.meta={selector:"input[type=radio][formControl],input[type=radio][formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var m=function(t){function n(){return t.apply(this,arguments)||this}a(n,t);var r=n.prototype;return r.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},r.setDisabledState=function(t){e.getContext(this).node.disabled=t},r.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(t){this.control.touched=!0},n}(u);m.meta={selector:"select[formControl],select[formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var g=function(t){function i(){return t.apply(this,arguments)||this}return a(i,t),i.prototype.onInit=function(){var t=e.getContext(this),i=t.module,o=t.node,a=t.selector,s=t.parentInstance,c=this.event=a.replace(/\[|\]|\(|\)/g,""),u=o,l=this.event$=n.fromEvent(u,"submit").pipe(r.tap((function(t){t.preventDefault()})),r.shareReplay(1)),d=o.getAttribute("("+c+")");if(d){var h=i.makeFunction(d,["$event"]);l.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){i.resolve(h,s,t)}))}else s[c+"$"]=l},i}(e.Directive);g.meta={selector:"[(submit)]"};var A=function(){function t(t,e){this.validator=t,this.params$=new n.BehaviorSubject(e)}return t.prototype.validate=function(t){return this.validator(t,this.params)},o(t,[{key:"params",get:function(){return this.params$.getValue()},set:function(t){if(t){var e=this.params;Object.keys(t).reduce((function(n,r){return n||!e||e[r]!==t[r]}),!1)&&this.params$.next(t)}}}]),t}();function y(){return new A((function(t,e){return null}))}function b(){return new A((function(t,e){return null==t||0===t.length?{required:!0}:null}))}function w(){return new A((function(t,e){return!0===t?null:{required:!0}}))}function E(t){return new A((function(t,e){var n=e.min;return t&&n?(t=parseFloat(t),!isNaN(t)&&t<n?{min:{min:n,actual:t}}:null):null}),{min:t})}function _(t){return new A((function(t,e){var n=e.max;return t&&n?(t=parseFloat(t),!isNaN(t)&&t>n?{max:{max:n,actual:t}}:null):null}),{max:t})}function S(t){return new A((function(t,e){var n=e.minlength;if(!t||!n)return null;var r=t?t.length:0;return r<n?{minlength:{requiredLength:n,actualLength:r}}:null}),{minlength:t})}function T(t){return new A((function(t,e){var n=e.maxlength;if(!t||!n)return null;var r=t?t.length:0;return r>n?{minlength:{requiredLength:n,actualLength:r}}:null}),{maxlength:t})}function C(t){return new A((function(t,e){var n=e.pattern;if(!t||!n)return null;var r=function(t){var e;t instanceof RegExp?e=t:"string"==typeof t&&(t="$"===(t="^"===t.charAt(0)?t:"^"+t).charAt(t.length-1)?t:t+"$",e=new RegExp(t));return e||new RegExp("")}(n);return r.test(t)?null:{pattern:{requiredPattern:r.toString(),actualValue:t}}}),{pattern:t})}function x(){var t=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return new A((function(e,n){return e?t.test(e)?null:{email:!0}:null}))}var R=Object.freeze({__proto__:null,NullValidator:y,RequiredValidator:b,RequiredTrueValidator:w,MinValidator:E,MaxValidator:_,MinLengthValidator:S,MaxLengthValidator:T,PatternValidator:C,EmailValidator:x}),I=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.onInit=function(){var t=this.validator=x();this.host&&this.host.control.addValidators(t)},e}(e.Directive);I.meta={selector:"[email][formControl],[email][formControlName]",inputs:["email"],hosts:{host:u}};var O=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).maxlength=Number.POSITIVE_INFINITY,e}a(e,t);var n=e.prototype;return n.onInit=function(){this.validator=T(this.maxlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={maxlength:this.maxlength})},e}(e.Directive);O.meta={selector:"[maxlength][formControl],[maxlength][formControlName]",inputs:["maxlength"],hosts:{host:u}};var M=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).max=Number.POSITIVE_INFINITY,e}a(e,t);var n=e.prototype;return n.onInit=function(){this.validator=_(this.max),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={max:this.max})},e}(e.Directive);M.meta={selector:"[max][formControl],[max][formControlName]",inputs:["max"],hosts:{host:u}};var L=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).minlength=Number.NEGATIVE_INFINITY,e}a(e,t);var n=e.prototype;return n.onInit=function(){this.validator=S(this.minlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={minlength:this.minlength})},e}(e.Directive);L.meta={selector:"[minlength][formControl],[minlength][formControlName]",inputs:["minlength"],hosts:{host:u}};var k=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).min=Number.NEGATIVE_INFINITY,e}a(e,t);var n=e.prototype;return n.onInit=function(){this.validator=E(this.min),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={min:this.min})},e}(e.Directive);k.meta={selector:"[min][formControl],[min][formControlName]",inputs:["min"],hosts:{host:u}};var B=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.onInit=function(){this.pattern&&(this.validator=C(this.pattern),this.host&&this.host.control.addValidators(this.validator))},n.onChanges=function(t){this.validator&&(this.validator.params={pattern:this.pattern})},e}(e.Directive);B.meta={selector:"[pattern][formControl],[pattern][formControlName]",inputs:["pattern"],hosts:{host:u}};var N=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.onInit=function(){this.validator=w(),this.host&&this.host.control.addValidators(this.validator)},e}(e.Directive);N.meta={selector:"[requiredTrue][formControl],[requiredTrue][formControlName]",inputs:["requiredTrue"],hosts:{host:u}};var P=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.onInit=function(){this.validator=b(),this.host&&this.host.control.addValidators(this.validator)},e}(e.Directive);P.meta={selector:"[required][formControl],[required][formControlName]",inputs:["required"],hosts:{host:u}};var U,D=[c,l,d,h,f,p,v,m,g,I,M,O,k,L,B,P,N],F=[],H=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e}(e.Module);H.meta={declarations:[].concat(D,F),exports:[].concat(D,F)},function(t){t.Pending="pending",t.Valid="valid",t.Invalid="invalid",t.Disabled="disabled",t.Hidden="hidden"}(U||(U={}));var j=U,V=function(){function t(t){var e=this;this.value_=void 0,this.submitted_=!1,this.touched_=!1,this.dirty_=!1,this.valueSubject=new n.BehaviorSubject(null),this.statusSubject=new n.BehaviorSubject(null),this.validatorsSubject=(new n.ReplaySubject).pipe(r.switchAll()),this.value$=this.valueSubject.pipe(r.distinctUntilChanged(),r.skip(1),r.tap((function(){e.submitted_=!1,e.dirty_=!0,e.statusSubject.next(null)})),r.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.validatorsSubject).pipe(r.switchMap((function(){return e.validate$(e.value)})),r.shareReplay(1)),this.changes$=n.merge(this.value$,this.status$).pipe(r.map((function(){return e.value})),r.auditTime(1),r.shareReplay(1)),this.validators=t?Array.isArray(t)?t:[t]:[]}var e=t.prototype;return e.initSubjects_=function(){this.switchValidators_()},e.switchValidators_=function(){var t=this.validators.map((function(t){return t.params$})),e=t.length?n.combineLatest(t):n.of(t);this.validatorsSubject.next(e)},e.initObservables_=function(){},e.validate$=function(t){var e=this;return this.status===j.Disabled||this.status===j.Hidden||this.submitted_||!this.validators.length?(this.errors_={},this.status===j.Invalid&&(this.status=j.Valid),n.of(this.errors_)):n.combineLatest(this.validators.map((function(e){var r=e.validate(t);return n.isObservable(r)?r:n.of(r)}))).pipe(r.map((function(t){return e.errors_=Object.assign.apply(Object,[{}].concat(t)),e.status=0===Object.keys(e.errors_).length?j.Valid:j.Invalid,e.errors_})))},e.reset=function(t){this.status=t||j.Pending,this.value_=null,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)},e.patch=function(t){this.value_=t,this.dirty_=!0,this.submitted_=!1,this.statusSubject.next(null)},e.addValidators=function(){var t;(t=this.validators).push.apply(t,arguments),this.switchValidators_()},e.replaceValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.validators=e,this.switchValidators_()},e.clearValidators=function(){this.validators=[],this.switchValidators_()},o(t,[{key:"errors",get:function(){return this.errors_},set:function(t){this.errors_=t}},{key:"pending",get:function(){return this.status===j.Pending}},{key:"valid",get:function(){return this.status!==j.Invalid}},{key:"invalid",get:function(){return this.status===j.Invalid}},{key:"disabled",get:function(){return this.status===j.Disabled},set:function(t){t?this.status!==j.Disabled&&(this.status=j.Disabled,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===j.Disabled&&(this.status=j.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"enabled",get:function(){return this.status!==j.Disabled}},{key:"hidden",get:function(){return this.status===j.Hidden},set:function(t){t?this.status!==j.Hidden&&(this.status=j.Hidden,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===j.Hidden&&(this.status=j.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"visible",get:function(){return this.status!==j.Hidden}},{key:"submitted",get:function(){return this.submitted_},set:function(t){this.submitted_=t,this.statusSubject.next(null)}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(t){this.touched_=t,this.statusSubject.next(null)}},{key:"untouched",get:function(){return!this.touched_}},{key:"flags",get:function(){return{untouched:this.untouched,touched:this.touched,pristine:this.pristine,dirty:this.dirty,pending:this.pending,enabled:this.enabled,disabled:this.disabled,hidden:this.hidden,visible:this.visible,valid:this.valid,invalid:this.invalid,submitted:this.submitted}}},{key:"value",get:function(){return this.value_},set:function(t){this.value_=t,this.valueSubject.next(t)}}]),t}(),G=function(t){function e(e,n){var r;return void 0===e&&(e=null),(r=t.call(this,n)||this).value_=e,r.status=j.Pending,r.errors={},r.initSubjects_(),r.initObservables_(),r.statusSubject.next(null),r}return a(e,t),e}(V),Q=function(t){function e(e,r){var i;return(i=t.call(this,r)||this).changesChildren=new n.BehaviorSubject(void 0),i.controls=e,i.initControls_(),i.initSubjects_(),i.initObservables_(),i}a(e,t);var i=e.prototype;return i.initControl_=function(t,e){var n=t instanceof V?t:new G(t);return n.addValidators.apply(n,this.validators),n.name=e,n},i.initControls_=function(){var t=this;return this.forEach_((function(e,n){t.init(e,n)})),this.controls},i.initSubjects_=function(){this.changesChildren=this.changesChildren.pipe(r.switchAll()),this.switchSubjects_()},i.switchSubjects_=function(){var t=this.reduce_((function(t,e){return t.push(e.changes$),t}),[]),e=t.length?n.combineLatest(t):n.of(t);this.changesChildren.next(e)},i.initObservables_=function(){var t=this;this.changes$=this.changesChildren.pipe(r.map((function(){return t.value})),r.shareReplay(1))},i.validate=function(t){var e;if(this.status===j.Disabled||this.status===j.Hidden)e=[];else{var n=this.validators.map((function(e){return e.validate(t)})).filter((function(t){return null!==t}));e=this.reduce_((function(t,e){return t.concat(e.errors)}),n),this.status=0===e.length?j.Valid:j.Invalid}return e},i.forEach_=function(t){var e=this;Object.keys(this.controls).forEach((function(n){return t(e.controls[n],n)}))},i.reduce_=function(t,e){return this.forEach_((function(n,r){e=t(e,n,r)})),e},i.all_=function(t,e){return this.reduce_((function(n,r){return n&&r[t]===e}),!0)},i.any_=function(t,e){return this.reduce_((function(n,r){return n||r[t]===e}),!1)},i.reset=function(){this.forEach_((function(t){return t.reset()}))},i.patch=function(t){t&&this.forEach_((function(e,n){null!=t[n]&&e.patch(t[n])}))},i.init=function(t,e){this.controls[e]=this.initControl_(t,e)},i.get=function(t){return this.controls[t]},i.set=function(t,e){delete this.controls[e],this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},i.add=function(t,e){this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},i.remove=function(t){var e=this,n=Object.keys(this.controls).find((function(n){return e.controls[n]===t?n:null}));n&&this.removeKey(n)},i.removeKey=function(t){var e=void 0!==this.controls[t];delete this.controls[t],e&&this.switchSubjects_()},i.addValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forEach_((function(t){return t.addValidators.apply(t,e)}))},i.replaceValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forEach_((function(t){return t.replaceValidators.apply(t,e)}))},i.clearValidators=function(){this.forEach_((function(t){return t.clearValidators()}))},o(e,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)},set:function(t){this.forEach_((function(e){e.disabled=t}))}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"hidden",get:function(){return this.all_("hidden",!0)},set:function(t){this.forEach_((function(e){e.hidden=t}))}},{key:"visible",get:function(){return this.any_("visible",!0)}},{key:"submitted",get:function(){return this.all_("submitted",!0)},set:function(t){this.forEach_((function(e){e.submitted=t}))}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(t){this.forEach_((function(e){e.touched=t}))}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(t,e,n){return t[n]=e.value,t}),{})},set:function(t){this.forEach_((function(e,n){e.value=t[n]}))}},{key:"errors",get:function(){return this.reduce_((function(t,e){return Object.assign(t,e.errors)}),{})},set:function(t){}}]),e}(V),z=function(t){function e(e,n){return void 0===e&&(e=[]),t.call(this,e,n)||this}a(e,t);var n=e.prototype;return n.forEach_=function(t){this.controls.forEach((function(e,n){return t(e,n)}))},n.init=function(t,e){this.controls.length=Math.max(this.controls.length,e),this.controls[e]=this.initControl_(t,e)},n.set=function(t,e){this.controls.splice(e,1,this.initControl_(t,e)),this.switchSubjects_()},n.add=function(t,e){this.controls.length=Math.max(this.controls.length,e),this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},n.push=function(t){this.controls.push(this.initControl_(t,this.controls.length)),this.switchSubjects_()},n.insert=function(t,e){this.controls.splice(e,0,this.initControl_(t,e)),this.switchSubjects_()},n.remove=function(t){var e=this.controls.indexOf(t);-1!==e&&this.removeKey(e)},n.removeKey=function(t){this.controls.length>t&&(this.controls.splice(t,1),this.switchSubjects_())},n.at=function(t){return this.controls[t]},o(e,[{key:"value",get:function(){return this.reduce_((function(t,e,n){return t[n]=e.value,t}),[])}},{key:"length",get:function(){return this.controls.length}}]),e}(Q);var q=function(t){function e(e,n){return void 0===e&&(e={}),t.call(this,e,n)||this}return a(e,t),e}(Q);return t.EmailValidator=x,t.FormAbstract=V,t.FormAbstractCollection=Q,t.FormAbstractCollectionDirective=s,t.FormArray=z,t.FormArrayDirective=c,t.FormCheckboxDirective=l,t.FormControl=G,t.FormEmailDirective=I,t.FormFieldComponent=d,t.FormGroup=q,t.FormGroupDirective=h,t.FormInputDirective=f,t.FormMaxDirective=M,t.FormMaxLengthDirective=O,t.FormMinDirective=k,t.FormMinLengthDirective=L,t.FormModule=H,t.FormPatternDirective=B,t.FormPlaceholderDirective=p,t.FormRadioDirective=v,t.FormRequiredDirective=P,t.FormRequiredTrueDirective=N,t.FormSelectDirective=m,t.FormStatus=j,t.FormValidator=A,t.MaxLengthValidator=T,t.MaxValidator=_,t.MinLengthValidator=S,t.MinValidator=E,t.NullValidator=y,t.PatternValidator=C,t.RequiredTrueValidator=w,t.RequiredValidator=b,t.Validators=R,t.formArray=function(t,e){return void 0===t&&(t=[]),new z(t,e)},t.formGroup=function(t,e){return void 0===t&&(t={}),new q(t,e)},t}({},rxcomp,rxjs,rxjs.operators),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,(function(t){"use strict";
/*!
	 * EasePack 3.6.1
	 * https://greensock.com
	 *
	 * @license Copyright 2008-2021, GreenSock. All rights reserved.
	 * Subject to the terms at https://greensock.com/standard-license or for
	 * Club GreenSock members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/var e,n,r=function(){return e||"undefined"!=typeof window&&(e=window.gsap)&&e.registerPlugin&&e},i=function(t,e){return!!(void 0===t?e:t&&!~(t+"").indexOf("false"))},o=function(t){if(e=t||r()){n=e.registerEase;var i,o=e.parseEase(),a=function(t){return function(e){var n=.5+e/2;t.config=function(e){return t(2*(1-e)*e*n+e*e)}}};for(i in o)o[i].config||a(o[i]);for(i in n("slow",l),n("expoScale",d),n("rough",h),f)"version"!==i&&e.core.globals(i,f[i])}},a=function(t,e,n){var r=(t=Math.min(1,t||.7))<1?e||0===e?e:.7:0,o=(1-t)/2,a=o+t,s=i(n);return function(t){var e=t+(.5-t)*r;return t<o?s?1-(t=1-t/o)*t:e-(t=1-t/o)*t*t*t*e:t>a?s?1===t?0:1-(t=(t-a)/o)*t:e+(t-e)*(t=(t-a)/o)*t*t*t:s?1:e}},s=function(t,n,r){var i=Math.log(n/t),o=n-t;return r&&(r=e.parseEase(r)),function(e){return(t*Math.exp(i*(r?r(e):e))-t)/o}},c=function(t,e,n){this.t=t,this.v=e,n&&(this.next=n,n.prev=this,this.c=n.v-e,this.gap=n.t-t)},u=function(t){"object"!=typeof t&&(t={points:+t||20});for(var n,r,o,a,s,u,l,d=t.taper||"none",h=[],f=0,p=0|(+t.points||20),v=p,m=i(t.randomize,!0),g=i(t.clamp),A=e?e.parseEase(t.template):0,y=.4*(+t.strength||1);--v>-1;)n=m?Math.random():1/p*v,r=A?A(n):n,o="none"===d?y:"out"===d?(a=1-n)*a*y:"in"===d?n*n*y:n<.5?(a=2*n)*a*.5*y:(a=2*(1-n))*a*.5*y,m?r+=Math.random()*o-.5*o:v%2?r+=.5*o:r-=.5*o,g&&(r>1?r=1:r<0&&(r=0)),h[f++]={x:n,y:r};for(h.sort((function(t,e){return t.x-e.x})),u=new c(1,1,null),v=p;v--;)s=h[v],u=new c(s.x,s.y,u);return l=new c(0,0,u.t?u:u.next),function(t){var e=l;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&t<=e.t;)e=e.prev;return l=e,e.v+(t-e.t)/e.gap*e.c}},l=a(.7);l.ease=l,l.config=a;var d=s(1,2);d.config=s;var h=u();h.ease=h,h.config=u;var f={SlowMo:l,RoughEase:h,ExpoScaleEase:d};for(var p in f)f[p].register=o,f[p].version="3.6.1";r()&&e.registerPlugin(l),t.EasePack=f,t.ExpoScaleEase=d,t.RoughEase=h,t.SlowMo=l,t.default=f,Object.defineProperty(t,"__esModule",{value:!0})})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,(function(t){"use strict";function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}
/*!
   * GSAP 3.6.1
   * https://greensock.com
   *
   * @license Copyright 2008-2021, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */var r,i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w,E,_,S,T,C,x,R,I,O,M={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},L={duration:.5,overwrite:!1,delay:0},k=1e8,B=1e-8,N=2*Math.PI,P=N/4,U=0,D=Math.sqrt,F=Math.cos,H=Math.sin,j=function(t){return"string"==typeof t},V=function(t){return"function"==typeof t},G=function(t){return"number"==typeof t},Q=function(t){return void 0===t},z=function(t){return"object"==typeof t},q=function(t){return!1!==t},W=function(){return"undefined"!=typeof window},K=function(t){return V(t)||j(t)},X="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},J=Array.isArray,Y=/(?:-?\.?\d|\.)+/gi,$=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Z=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,tt=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,et=/[+-]=-?[.\d]+/,nt=/[#\-+.]*\b[a-z\d-=+%.]+/gi,rt=/[\d.+\-=]+(?:e[-+]\d*)*/i,it={},ot={},at=function(t){return(ot=Lt(t,it))&&An},st=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},ct=function(t,e){return!e&&console.warn(t)},ut=function(t,e){return t&&(it[t]=e)&&ot&&(ot[t]=e)||it},lt=function(){return 0},dt={},ht=[],ft={},pt={},vt={},mt=30,gt=[],At="",yt=function(t){var e,n,r=t[0];if(z(r)||V(r)||(t=[t]),!(e=(r._gsap||{}).harness)){for(n=gt.length;n--&&!gt[n].targetTest(r););e=gt[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new Ve(t[n],e)))||t.splice(n,1);return t},bt=function(t){return t._gsap||yt(se(t))[0]._gsap},wt=function(t,e,n){return(n=t[e])&&V(n)?t[e]():Q(n)&&t.getAttribute&&t.getAttribute(e)||n},Et=function(t,e){return(t=t.split(",")).forEach(e)||t},_t=function(t){return Math.round(1e5*t)/1e5||0},St=function(t,e){for(var n=e.length,r=0;t.indexOf(e[r])<0&&++r<n;);return r<n},Tt=function(t,e,n){var r,i=G(t[1]),o=(i?2:1)+(e<2?0:1),a=t[o];if(i&&(a.duration=t[1]),a.parent=n,e){for(r=a;n&&!("immediateRender"in r);)r=n.vars.defaults||{},n=q(n.vars.inherit)&&n.parent;a.immediateRender=q(r.immediateRender),e<2?a.runBackwards=1:a.startAt=t[o-1]}return a},Ct=function(){var t,e,n=ht.length,r=ht.slice(0);for(ft={},ht.length=0,t=0;t<n;t++)(e=r[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},xt=function(t,e,n,r){ht.length&&Ct(),t.render(e,n,r),ht.length&&Ct()},Rt=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(nt).length<2?e:j(t)?t.trim():t},It=function(t){return t},Ot=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},Mt=function(t,e){for(var n in e)n in t||"duration"===n||"ease"===n||(t[n]=e[n])},Lt=function(t,e){for(var n in e)t[n]=e[n];return t},kt=function t(e,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(e[r]=z(n[r])?t(e[r]||(e[r]={}),n[r]):n[r]);return e},Bt=function(t,e){var n,r={};for(n in t)n in e||(r[n]=t[n]);return r},Nt=function(t){var e=t.parent||i,n=t.keyframes?Mt:Ot;if(q(t.inherit))for(;e;)n(t,e.vars.defaults),e=e.parent||e._dp;return t},Pt=function(t,e,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=e._prev,o=e._next;i?i._next=o:t[n]===e&&(t[n]=o),o?o._prev=i:t[r]===e&&(t[r]=i),e._next=e._prev=e.parent=null},Ut=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},Dt=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},Ft=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Ht=function t(e){return!e||e._ts&&t(e.parent)},jt=function(t){return t._repeat?Vt(t._tTime,t=t.duration()+t._rDelay)*t:0},Vt=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},Gt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Qt=function(t){return t._end=_t(t._start+(t._tDur/Math.abs(t._ts||t._rts||B)||0))},zt=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=_t(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Qt(t),n._dirty||Dt(n,t)),t},qt=function(t,e){var n;if((e._time||e._initted&&!e._dur)&&(n=Gt(t.rawTime(),e),(!e._dur||ne(0,e.totalDuration(),n)-e._tTime>B)&&e.render(n,!0)),Dt(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},Wt=function(t,e,n,r){return e.parent&&Ut(e),e._start=_t(n+e._delay),e._end=_t(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),function(t,e,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var o,a=t[r];if(i)for(o=e[i];a&&a[i]>o;)a=a._prev;a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[r]=e,e._prev=a,e.parent=e._dp=t}(t,e,"_first","_last",t._sort?"_start":0),t._recent=e,r||qt(t,e),t},Kt=function(t,e){return(it.ScrollTrigger||st("scrollTrigger",e))&&it.ScrollTrigger.create(e,t)},Xt=function(t,e,n,r){return Xe(t,e),t._initted?!n&&t._pt&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&u!==Ie.frame?(ht.push(t),t._lazy=[e,r],1):void 0:1},Jt=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},Yt=function(t,e,n,r){var i=t._repeat,o=_t(e)||0,a=t._tTime/t._tDur;return a&&!r&&(t._time*=o/t._dur),t._dur=o,t._tDur=i?i<0?1e10:_t(o*(i+1)+t._rDelay*i):o,a&&!r?zt(t,t._tTime=t._tDur*a):t.parent&&Qt(t),n||Dt(t.parent,t),t},$t=function(t){return t instanceof Qe?Dt(t):Yt(t,t._dur)},Zt={_start:0,endTime:lt},te=function t(e,n){var r,i,o=e.labels,a=e._recent||Zt,s=e.duration()>=k?a.endTime(!1):e._dur;return j(n)&&(isNaN(n)||n in o)?"<"===(r=n.charAt(0))||">"===r?("<"===r?a._start:a.endTime(a._repeat>=0))+(parseFloat(n.substr(1))||0):(r=n.indexOf("="))<0?(n in o||(o[n]=s),o[n]):(i=+(n.charAt(r-1)+n.substr(r+1)),r>1?t(e,n.substr(0,r-1))+i:s+i):null==n?s:+n},ee=function(t,e){return t||0===t?e(t):e},ne=function(t,e,n){return n<t?t:n>e?e:n},re=function(t){if("string"!=typeof t)return"";var e=rt.exec(t);return e?t.substr(e.index+e[0].length):""},ie=[].slice,oe=function(t,e){return t&&z(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&z(t[0]))&&!t.nodeType&&t!==o},ae=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var r;return j(t)&&!e||oe(t,1)?(r=n).push.apply(r,se(t)):n.push(t)}))||n},se=function(t,e){return!j(t)||e||!a&&Oe()?J(t)?ae(t,e):oe(t)?ie.call(t,0):t?[t]:[]:ie.call(s.querySelectorAll(t),0)},ce=function(t){return t.sort((function(){return.5-Math.random()}))},ue=function(t){if(V(t))return t;var e=z(t)?t:{each:t},n=Ue(e.ease),r=e.from||0,i=parseFloat(e.base)||0,o={},a=r>0&&r<1,s=isNaN(r)||a,c=e.axis,u=r,l=r;return j(r)?u=l={center:.5,edges:.5,end:1}[r]||0:!a&&s&&(u=r[0],l=r[1]),function(t,a,d){var h,f,p,v,m,g,A,y,b,w=(d||e).length,E=o[w];if(!E){if(!(b="auto"===e.grid?0:(e.grid||[1,k])[1])){for(A=-k;A<(A=d[b++].getBoundingClientRect().left)&&b<w;);b--}for(E=o[w]=[],h=s?Math.min(b,w)*u-.5:r%b,f=s?w*l/b-.5:r/b|0,A=0,y=k,g=0;g<w;g++)p=g%b-h,v=f-(g/b|0),E[g]=m=c?Math.abs("y"===c?v:p):D(p*p+v*v),m>A&&(A=m),m<y&&(y=m);"random"===r&&ce(E),E.max=A-y,E.min=y,E.v=w=(parseFloat(e.amount)||parseFloat(e.each)*(b>w?w-1:c?"y"===c?w/b:b:Math.max(b,w/b))||0)*("edges"===r?-1:1),E.b=w<0?i-w:i,E.u=re(e.amount||e.each)||0,n=n&&w<0?Ne(n):n}return w=(E[t]-E.min)/E.max||0,_t(E.b+(n?n(w):w)*E.v)+E.u}},le=function(t){var e=t<1?Math.pow(10,(t+"").length-2):1;return function(n){var r=Math.round(parseFloat(n)/t)*t*e;return(r-r%1)/e+(G(n)?0:re(n))}},de=function(t,e){var n,r,i=J(t);return!i&&z(t)&&(n=i=t.radius||k,t.values?(t=se(t.values),(r=!G(t[0]))&&(n*=n)):t=le(t.increment)),ee(e,i?V(t)?function(e){return r=t(e),Math.abs(r-e)<=n?r:e}:function(e){for(var i,o,a=parseFloat(r?e.x:e),s=parseFloat(r?e.y:0),c=k,u=0,l=t.length;l--;)(i=r?(i=t[l].x-a)*i+(o=t[l].y-s)*o:Math.abs(t[l]-a))<c&&(c=i,u=l);return u=!n||c<=n?t[u]:e,r||u===e||G(e)?u:u+re(e)}:le(t))},he=function(t,e,n,r){return ee(J(t)?!e:!0===n?!!(n=0):!r,(function(){return J(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*r)/r}))},fe=function(t,e,n){return ee(n,(function(n){return t[~~e(n)]}))},pe=function(t){for(var e,n,r,i,o=0,a="";~(e=t.indexOf("random(",o));)r=t.indexOf(")",e),i="["===t.charAt(e+7),n=t.substr(e+7,r-e-7).match(i?nt:Y),a+=t.substr(o,e-o)+he(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),o=r+1;return a+t.substr(o,t.length-o)},ve=function(t,e,n,r,i){var o=e-t,a=r-n;return ee(i,(function(e){return n+((e-t)/o*a||0)}))},me=function(t,e,n){var r,i,o,a=t.labels,s=k;for(r in a)(i=a[r]-e)<0==!!n&&i&&s>(i=Math.abs(i))&&(o=r,s=i);return o},ge=function(t,e,n){var r,i,o=t.vars,a=o[e];if(a)return r=o[e+"Params"],i=o.callbackScope||t,n&&ht.length&&Ct(),r?a.apply(i,r):a.call(i)},Ae=function(t){return Ut(t),t.scrollTrigger&&t.scrollTrigger.kill(!1),t.progress()<1&&ge(t,"onInterrupt"),t},ye=function(t){var e=(t=!t.name&&t.default||t).name,n=V(t),r=e&&!n&&t.init?function(){this._props=[]}:t,i={init:lt,render:un,add:We,kill:dn,modifier:ln,rawVars:0},o={targetTest:0,get:0,getSetter:on,aliases:{},register:0};if(Oe(),t!==r){if(pt[e])return;Ot(r,Ot(Bt(t,i),o)),Lt(r.prototype,Lt(i,Bt(t,o))),pt[r.prop=e]=r,t.targetTest&&(gt.push(r),dt[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}ut(e,r),t.register&&t.register(An,r,pn)},be=255,we={aqua:[0,be,be],lime:[0,be,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,be],navy:[0,0,128],white:[be,be,be],olive:[128,128,0],yellow:[be,be,0],orange:[be,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[be,0,0],pink:[be,192,203],cyan:[0,be,be],transparent:[be,be,be,0]},Ee=function(t,e,n){return(6*(t=t<0?t+1:t>1?t-1:t)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*be+.5|0},_e=function(t,e,n){var r,i,o,a,s,c,u,l,d,h,f=t?G(t)?[t>>16,t>>8&be,t&be]:0:we.black;if(!f){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),we[t])f=we[t];else if("#"===t.charAt(0)){if(t.length<6&&(r=t.charAt(1),i=t.charAt(2),o=t.charAt(3),t="#"+r+r+i+i+o+o+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(f=parseInt(t.substr(1,6),16))>>16,f>>8&be,f&be,parseInt(t.substr(7),16)/255];f=[(t=parseInt(t.substr(1),16))>>16,t>>8&be,t&be]}else if("hsl"===t.substr(0,3))if(f=h=t.match(Y),e){if(~t.indexOf("="))return f=t.match($),n&&f.length<4&&(f[3]=1),f}else a=+f[0]%360/360,s=+f[1]/100,r=2*(c=+f[2]/100)-(i=c<=.5?c*(s+1):c+s-c*s),f.length>3&&(f[3]*=1),f[0]=Ee(a+1/3,r,i),f[1]=Ee(a,r,i),f[2]=Ee(a-1/3,r,i);else f=t.match(Y)||we.transparent;f=f.map(Number)}return e&&!h&&(r=f[0]/be,i=f[1]/be,o=f[2]/be,c=((u=Math.max(r,i,o))+(l=Math.min(r,i,o)))/2,u===l?a=s=0:(d=u-l,s=c>.5?d/(2-u-l):d/(u+l),a=u===r?(i-o)/d+(i<o?6:0):u===i?(o-r)/d+2:(r-i)/d+4,a*=60),f[0]=~~(a+.5),f[1]=~~(100*s+.5),f[2]=~~(100*c+.5)),n&&f.length<4&&(f[3]=1),f},Se=function(t){var e=[],n=[],r=-1;return t.split(Ce).forEach((function(t){var i=t.match(Z)||[];e.push.apply(e,i),n.push(r+=i.length+1)})),e.c=n,e},Te=function(t,e,n){var r,i,o,a,s="",c=(t+s).match(Ce),u=e?"hsla(":"rgba(",l=0;if(!c)return t;if(c=c.map((function(t){return(t=_e(t,e,1))&&u+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(o=Se(t),(r=n.c).join(s)!==o.c.join(s)))for(a=(i=t.replace(Ce,"1").split(Z)).length-1;l<a;l++)s+=i[l]+(~r.indexOf(l)?c.shift()||u+"0,0,0,0)":(o.length?o:c.length?c:n).shift());if(!i)for(a=(i=t.split(Ce)).length-1;l<a;l++)s+=i[l]+c[l];return s+i[a]},Ce=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in we)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),xe=/hsl[a]?\(/,Re=function(t){var e,n=t.join(" ");if(Ce.lastIndex=0,Ce.test(n))return e=xe.test(n),t[1]=Te(t[1],e),t[0]=Te(t[0],e,Se(t[1])),!0},Ie=(A=Date.now,y=500,b=33,w=A(),E=w,S=_=1e3/240,C=function t(e){var n,r,i,o,a=A()-E,s=!0===e;if(a>y&&(w+=a-b),((n=(i=(E+=a)-w)-S)>0||s)&&(o=++v.frame,m=i-1e3*v.time,v.time=i/=1e3,S+=n+(n>=_?4:_-n),r=1),s||(h=f(t)),r)for(g=0;g<T.length;g++)T[g](i,m,o,e)},v={time:0,frame:0,tick:function(){C(!0)},deltaRatio:function(t){return m/(1e3/(t||60))},wake:function(){c&&(!a&&W()&&(o=a=window,s=o.document||{},it.gsap=An,(o.gsapVersions||(o.gsapVersions=[])).push(An.version),at(ot||o.GreenSockGlobals||!o.gsap&&o||{}),p=o.requestAnimationFrame),h&&v.sleep(),f=p||function(t){return setTimeout(t,S-1e3*v.time+1|0)},d=1,C(2))},sleep:function(){(p?o.cancelAnimationFrame:clearTimeout)(h),d=0,f=lt},lagSmoothing:function(t,e){y=t||1e8,b=Math.min(e,y,0)},fps:function(t){_=1e3/(t||240),S=1e3*v.time+_},add:function(t){T.indexOf(t)<0&&T.push(t),Oe()},remove:function(t){var e;~(e=T.indexOf(t))&&T.splice(e,1)&&g>=e&&g--},_listeners:T=[]}),Oe=function(){return!d&&Ie.wake()},Me={},Le=/^[\d.\-M][\d.\-,\s]/,ke=/["']/g,Be=function(t){for(var e,n,r,i={},o=t.substr(1,t.length-3).split(":"),a=o[0],s=1,c=o.length;s<c;s++)n=o[s],e=s!==c-1?n.lastIndexOf(","):n.length,r=n.substr(0,e),i[a]=isNaN(r)?r.replace(ke,"").trim():+r,a=n.substr(e+1).trim();return i},Ne=function(t){return function(e){return 1-t(1-e)}},Pe=function t(e,n){for(var r,i=e._first;i;)i instanceof Qe?t(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?t(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},Ue=function(t,e){return t&&(V(t)?t:Me[t]||function(t){var e,n,r,i,o=(t+"").split("("),a=Me[o[0]];return a&&o.length>1&&a.config?a.config.apply(null,~t.indexOf("{")?[Be(o[1])]:(e=t,n=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",n),e.substring(n,~i&&i<r?e.indexOf(")",r+1):r)).split(",").map(Rt)):Me._CE&&Le.test(t)?Me._CE("",t):a}(t))||e},De=function(t,e,n,r){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===r&&(r=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var i,o={easeIn:e,easeOut:n,easeInOut:r};return Et(t,(function(t){for(var e in Me[t]=it[t]=o,Me[i=t.toLowerCase()]=n,o)Me[i+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Me[t+"."+e]=o[e]})),o},Fe=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},He=function t(e,n,r){var i=n>=1?n:1,o=(r||(e?.3:.45))/(n<1?n:1),a=o/N*(Math.asin(1/i)||0),s=function(t){return 1===t?1:i*Math.pow(2,-10*t)*H((t-a)*o)+1},c="out"===e?s:"in"===e?function(t){return 1-s(1-t)}:Fe(s);return o=N/o,c.config=function(n,r){return t(e,n,r)},c},je=function t(e,n){void 0===n&&(n=1.70158);var r=function(t){return t?--t*t*((n+1)*t+n)+1:0},i="out"===e?r:"in"===e?function(t){return 1-r(1-t)}:Fe(r);return i.config=function(n){return t(e,n)},i};Et("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;De(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Me.Linear.easeNone=Me.none=Me.Linear.easeIn,De("Elastic",He("in"),He("out"),He()),x=7.5625,I=1/(R=2.75),De("Bounce",(function(t){return 1-O(1-t)}),O=function(t){return t<I?x*t*t:t<.7272727272727273?x*Math.pow(t-1.5/R,2)+.75:t<.9090909090909092?x*(t-=2.25/R)*t+.9375:x*Math.pow(t-2.625/R,2)+.984375}),De("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),De("Circ",(function(t){return-(D(1-t*t)-1)})),De("Sine",(function(t){return 1===t?1:1-F(t*P)})),De("Back",je("in"),je("out"),je()),Me.SteppedEase=Me.steps=it.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,r=t+(e?0:1),i=e?1:0;return function(t){return((r*ne(0,.99999999,t)|0)+i)*n}}},L.ease=Me["quad.out"],Et("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return At+=t+","+t+"Params,"}));var Ve=function(t,e){this.id=U++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:wt,this.set=e?e.getSetter:on},Ge=function(){function t(t,e){var n=t.parent||i;this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Yt(this,+t.duration,1,1),this.data=t.data,d||Ie.wake(),n&&Wt(n,this,e||0===e?e:n._time,1),t.reversed&&this.reverse(),t.paused&&this.paused(!0)}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Yt(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Oe(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(zt(this,t),!n._dp||n.parent||qt(n,this);n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Wt(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===B||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),xt(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+jt(this))%this._dur||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+jt(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?Vt(this._tTime,n)+1:1},e.timeScale=function(t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?Gt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,Ft(this.totalTime(ne(-this._delay,this._tDur,e),!0))},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Oe(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&(this._tTime-=B)&&Math.abs(this._zTime)!==B))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&Wt(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(q(t)?this.totalDuration():this.duration())/Math.abs(this._ts)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Gt(e.rawTime(t),this):this._tTime:this._tTime},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(e._ts||1),e=e._dp;return n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,$t(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){return arguments.length?(this._rDelay=t,$t(this)):this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(te(this,t),q(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,q(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-B))},e.eventCallback=function(t,e,n){var r=this.vars;return arguments.length>1?(e?(r[t]=e,n&&(r[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete r[t],this):r[t]},e.then=function(t){var e=this;return new Promise((function(n){var r=V(t)?t:It,i=function(){var t=e.then;e.then=null,V(r)&&(r=r(e))&&(r.then||r===e)&&(e.then=t),n(r),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?i():e._prom=i}))},e.kill=function(){Ae(this)},t}();Ot(Ge.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Qe=function(t){function r(e,r){var i;return void 0===e&&(e={}),(i=t.call(this,e,r)||this).labels={},i.smoothChildTiming=!!e.smoothChildTiming,i.autoRemoveChildren=!!e.autoRemoveChildren,i._sort=q(e.sortChildren),i.parent&&qt(i.parent,n(i)),e.scrollTrigger&&Kt(n(i),e.scrollTrigger),i}e(r,t);var o=r.prototype;return o.to=function(t,e,n){return new Ze(t,Tt(arguments,0,this),te(this,G(e)?arguments[3]:n)),this},o.from=function(t,e,n){return new Ze(t,Tt(arguments,1,this),te(this,G(e)?arguments[3]:n)),this},o.fromTo=function(t,e,n,r){return new Ze(t,Tt(arguments,2,this),te(this,G(e)?arguments[4]:r)),this},o.set=function(t,e,n){return e.duration=0,e.parent=this,Nt(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new Ze(t,e,te(this,n),1),this},o.call=function(t,e,n){return Wt(this,Ze.delayedCall(0,t,e),te(this,n))},o.staggerTo=function(t,e,n,r,i,o,a){return n.duration=e,n.stagger=n.stagger||r,n.onComplete=o,n.onCompleteParams=a,n.parent=this,new Ze(t,n,te(this,i)),this},o.staggerFrom=function(t,e,n,r,i,o,a){return n.runBackwards=1,Nt(n).immediateRender=q(n.immediateRender),this.staggerTo(t,e,n,r,i,o,a)},o.staggerFromTo=function(t,e,n,r,i,o,a,s){return r.startAt=n,Nt(r).immediateRender=q(r.immediateRender),this.staggerTo(t,e,r,i,o,a,s)},o.render=function(t,e,n){var r,o,a,s,c,u,l,d,h,f,p,v,m=this._time,g=this._dirty?this.totalDuration():this._tDur,A=this._dur,y=this!==i&&t>g-B&&t>=0?g:t<B?0:t,b=this._zTime<0!=t<0&&(this._initted||!A);if(y!==this._tTime||n||b){if(m!==this._time&&A&&(y+=this._time-m,t+=this._time-m),r=y,h=this._start,u=!(d=this._ts),b&&(A||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,c=A+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*c+t,e,n);if(r=_t(y%c),y===g?(s=this._repeat,r=A):((s=~~(y/c))&&s===y/c&&(r=A,s--),r>A&&(r=A)),f=Vt(this._tTime,c),!m&&this._tTime&&f!==s&&(f=s),p&&1&s&&(r=A-r,v=1),s!==f&&!this._lock){var w=p&&1&f,E=w===(p&&1&s);if(s<f&&(w=!w),m=w?0:A,this._lock=1,this.render(m||(v?0:_t(s*c)),e,!A)._lock=0,!e&&this.parent&&ge(this,"onRepeat"),this.vars.repeatRefresh&&!v&&(this.invalidate()._lock=1),m&&m!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(A=this._dur,g=this._tDur,E&&(this._lock=2,m=w?A:-1e-4,this.render(m,!0)),this._lock=0,!this._ts&&!u)return this;Pe(this,v)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(t,e,n){var r;if(n>e)for(r=t._first;r&&r._start<=n;){if(!r._dur&&"isPause"===r.data&&r._start>e)return r;r=r._next}else for(r=t._last;r&&r._start>=n;){if(!r._dur&&"isPause"===r.data&&r._start<e)return r;r=r._prev}}(this,_t(m),_t(r)))&&(y-=r-(r=l._start)),this._tTime=y,this._time=r,this._act=!d,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&r&&!e&&ge(this,"onStart"),r>=m&&t>=0)for(o=this._first;o;){if(a=o._next,(o._act||r>=o._start)&&o._ts&&l!==o){if(o.parent!==this)return this.render(t,e,n);if(o.render(o._ts>0?(r-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(r-o._start)*o._ts,e,n),r!==this._time||!this._ts&&!u){l=0,a&&(y+=this._zTime=-1e-8);break}}o=a}else{o=this._last;for(var _=t<0?t:r;o;){if(a=o._prev,(o._act||_<=o._end)&&o._ts&&l!==o){if(o.parent!==this)return this.render(t,e,n);if(o.render(o._ts>0?(_-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(_-o._start)*o._ts,e,n),r!==this._time||!this._ts&&!u){l=0,a&&(y+=this._zTime=_?-1e-8:B);break}}o=a}}if(l&&!e&&(this.pause(),l.render(r>=m?0:-1e-8)._zTime=r>=m?1:-1,this._ts))return this._start=h,Qt(this),this.render(t,e,n);this._onUpdate&&!e&&ge(this,"onUpdate",!0),(y===g&&g>=this.totalDuration()||!y&&m)&&(h!==this._start&&Math.abs(d)===Math.abs(this._ts)||this._lock||((t||!A)&&(y===g&&this._ts>0||!y&&this._ts<0)&&Ut(this,1),e||t<0&&!m||!y&&!m||(ge(this,y===g?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},o.add=function(t,e){var n=this;if(G(e)||(e=te(this,e)),!(t instanceof Ge)){if(J(t))return t.forEach((function(t){return n.add(t,e)})),this;if(j(t))return this.addLabel(t,e);if(!V(t))return this;t=Ze.delayedCall(0,t)}return this!==t?Wt(this,t,e):this},o.getChildren=function(t,e,n,r){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===r&&(r=-k);for(var i=[],o=this._first;o;)o._start>=r&&(o instanceof Ze?e&&i.push(o):(n&&i.push(o),t&&i.push.apply(i,o.getChildren(!0,e,n)))),o=o._next;return i},o.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},o.remove=function(t){return j(t)?this.removeLabel(t):V(t)?this.killTweensOf(t):(Pt(this,t),t===this._recent&&(this._recent=this._last),Dt(this))},o.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_t(Ie.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},o.addLabel=function(t,e){return this.labels[t]=te(this,e),this},o.removeLabel=function(t){return delete this.labels[t],this},o.addPause=function(t,e,n){var r=Ze.delayedCall(0,e||lt,n);return r.data="isPause",this._hasPause=1,Wt(this,r,te(this,t))},o.removePause=function(t){var e=this._first;for(t=te(this,t);e;)e._start===t&&"isPause"===e.data&&Ut(e),e=e._next},o.killTweensOf=function(t,e,n){for(var r=this.getTweensOf(t,n),i=r.length;i--;)ze!==r[i]&&r[i].kill(t,e);return this},o.getTweensOf=function(t,e){for(var n,r=[],i=se(t),o=this._first,a=G(e);o;)o instanceof Ze?St(o._targets,i)&&(a?(!ze||o._initted&&o._ts)&&o.globalTime(0)<=e&&o.globalTime(o.totalDuration())>e:!e||o.isActive())&&r.push(o):(n=o.getTweensOf(i,e)).length&&r.push.apply(r,n),o=o._next;return r},o.tweenTo=function(t,e){e=e||{};var n=this,r=te(n,t),i=e,o=i.startAt,a=i.onStart,s=i.onStartParams,c=i.immediateRender,u=Ze.to(n,Ot({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(o&&"time"in o?o.time:n._time))/n.timeScale())||B,onStart:function(){n.pause();var t=e.duration||Math.abs((r-n._time)/n.timeScale());u._dur!==t&&Yt(u,t,0,1).render(u._time,!0,!0),a&&a.apply(u,s||[])}},e));return c?u.render(0):u},o.tweenFromTo=function(t,e,n){return this.tweenTo(e,Ot({startAt:{time:te(this,t)}},n))},o.recent=function(){return this._recent},o.nextLabel=function(t){return void 0===t&&(t=this._time),me(this,te(this,t))},o.previousLabel=function(t){return void 0===t&&(t=this._time),me(this,te(this,t),1)},o.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+B)},o.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var r,i=this._first,o=this.labels;i;)i._start>=n&&(i._start+=t,i._end+=t),i=i._next;if(e)for(r in o)o[r]>=n&&(o[r]+=t);return Dt(this)},o.invalidate=function(){var e=this._first;for(this._lock=0;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},o.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Dt(this)},o.totalDuration=function(t){var e,n,r,o=0,a=this,s=a._last,c=k;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-t:t));if(a._dirty){for(r=a.parent;s;)e=s._prev,s._dirty&&s.totalDuration(),(n=s._start)>c&&a._sort&&s._ts&&!a._lock?(a._lock=1,Wt(a,s,n-s._delay,1)._lock=0):c=n,n<0&&s._ts&&(o-=n,(!r&&!a._dp||r&&r.smoothChildTiming)&&(a._start+=n/a._ts,a._time-=n,a._tTime-=n),a.shiftChildren(-n,!1,-Infinity),c=0),s._end>o&&s._ts&&(o=s._end),s=e;Yt(a,a===i&&a._time>o?a._time:o,1,1),a._dirty=0}return a._tDur},r.updateRoot=function(t){if(i._ts&&(xt(i,Gt(t,i)),u=Ie.frame),Ie.frame>=mt){mt+=M.autoSleep||120;var e=i._first;if((!e||!e._ts)&&M.autoSleep&&Ie._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Ie.sleep()}}},r}(Ge);Ot(Qe.prototype,{_lock:0,_hasPause:0,_forcing:0});var ze,qe=function(t,e,n,r,i,o,a){var s,c,u,l,d,h,f,p,v=new pn(this._pt,t,e,0,1,cn,null,i),m=0,g=0;for(v.b=n,v.e=r,n+="",(f=~(r+="").indexOf("random("))&&(r=pe(r)),o&&(o(p=[n,r],t,e),n=p[0],r=p[1]),c=n.match(tt)||[];s=tt.exec(r);)l=s[0],d=r.substring(m,s.index),u?u=(u+1)%5:"rgba("===d.substr(-5)&&(u=1),l!==c[g++]&&(h=parseFloat(c[g-1])||0,v._pt={_next:v._pt,p:d||1===g?d:",",s:h,c:"="===l.charAt(1)?parseFloat(l.substr(2))*("-"===l.charAt(0)?-1:1):parseFloat(l)-h,m:u&&u<4?Math.round:0},m=tt.lastIndex);return v.c=m<r.length?r.substring(m,r.length):"",v.fp=a,(et.test(r)||f)&&(v.e=0),this._pt=v,v},We=function(t,e,n,r,i,o,a,s,c){V(r)&&(r=r(i||0,t,o));var u,l=t[e],d="get"!==n?n:V(l)?c?t[e.indexOf("set")||!V(t["get"+e.substr(3)])?e:"get"+e.substr(3)](c):t[e]():l,h=V(l)?c?nn:en:tn;if(j(r)&&(~r.indexOf("random(")&&(r=pe(r)),"="===r.charAt(1)&&(r=parseFloat(d)+parseFloat(r.substr(2))*("-"===r.charAt(0)?-1:1)+(re(d)||0))),d!==r)return isNaN(d*r)?(!l&&!(e in t)&&st(e,r),qe.call(this,t,e,d,r,h,s||M.stringFilter,c)):(u=new pn(this._pt,t,e,+d||0,r-(d||0),"boolean"==typeof l?sn:an,0,h),c&&(u.fp=c),a&&u.modifier(a,this,t),this._pt=u)},Ke=function(t,e,n,r,i,o){var a,s,c,u;if(pt[t]&&!1!==(a=new pt[t]).init(i,a.rawVars?e[t]:function(t,e,n,r,i){if(V(t)&&(t=Je(t,i,e,n,r)),!z(t)||t.style&&t.nodeType||J(t)||X(t))return j(t)?Je(t,i,e,n,r):t;var o,a={};for(o in t)a[o]=Je(t[o],i,e,n,r);return a}(e[t],r,i,o,n),n,r,o)&&(n._pt=s=new pn(n._pt,i,t,0,1,a.render,a,0,a.priority),n!==l))for(c=n._ptLookup[n._targets.indexOf(i)],u=a._props.length;u--;)c[a._props[u]]=s;return a},Xe=function t(e,n){var o,a,s,c,u,l,d,h,f,p,v,m,g,A=e.vars,y=A.ease,b=A.startAt,w=A.immediateRender,E=A.lazy,_=A.onUpdate,S=A.onUpdateParams,T=A.callbackScope,C=A.runBackwards,x=A.yoyoEase,R=A.keyframes,I=A.autoRevert,O=e._dur,M=e._startAt,k=e._targets,N=e.parent,P=N&&"nested"===N.data?N.parent._targets:k,U="auto"===e._overwrite&&!r,D=e.timeline;if(D&&(!R||!y)&&(y="none"),e._ease=Ue(y,L.ease),e._yEase=x?Ne(Ue(!0===x?y:x,L.ease)):0,x&&e._yoyo&&!e._repeat&&(x=e._yEase,e._yEase=e._ease,e._ease=x),!D){if(m=(h=k[0]?bt(k[0]).harness:0)&&A[h.prop],o=Bt(A,dt),M&&M.render(-1,!0).kill(),b)if(Ut(e._startAt=Ze.set(k,Ot({data:"isStart",overwrite:!1,parent:N,immediateRender:!0,lazy:q(E),startAt:null,delay:0,onUpdate:_,onUpdateParams:S,callbackScope:T,stagger:0},b))),w){if(n>0)I||(e._startAt=0);else if(O&&!(n<0&&M))return void(n&&(e._zTime=n))}else!1===I&&(e._startAt=0);else if(C&&O)if(M)!I&&(e._startAt=0);else if(n&&(w=!1),s=Ot({overwrite:!1,data:"isFromStart",lazy:w&&q(E),immediateRender:w,stagger:0,parent:N},o),m&&(s[h.prop]=m),Ut(e._startAt=Ze.set(k,s)),w){if(!n)return}else t(e._startAt,B);for(e._pt=0,E=O&&q(E)||E&&!O,a=0;a<k.length;a++){if(d=(u=k[a])._gsap||yt(k)[a]._gsap,e._ptLookup[a]=p={},ft[d.id]&&ht.length&&Ct(),v=P===k?a:P.indexOf(u),h&&!1!==(f=new h).init(u,m||o,e,v,P)&&(e._pt=c=new pn(e._pt,u,f.name,0,1,f.render,f,0,f.priority),f._props.forEach((function(t){p[t]=c})),f.priority&&(l=1)),!h||m)for(s in o)pt[s]&&(f=Ke(s,o,e,v,u,P))?f.priority&&(l=1):p[s]=c=We.call(e,u,s,"get",o[s],v,P,0,A.stringFilter);e._op&&e._op[a]&&e.kill(u,e._op[a]),U&&e._pt&&(ze=e,i.killTweensOf(u,p,e.globalTime(0)),g=!e.parent,ze=0),e._pt&&E&&(ft[d.id]=1)}l&&fn(e),e._onInit&&e._onInit(e)}e._from=!D&&!!A.runBackwards,e._onUpdate=_,e._initted=(!e._op||e._pt)&&!g},Je=function(t,e,n,r,i){return V(t)?t.call(e,n,r,i):j(t)&&~t.indexOf("random(")?pe(t):t},Ye=At+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",$e=(Ye+",id,stagger,delay,duration,paused,scrollTrigger").split(","),Ze=function(t){function o(e,o,a,s){var c;"number"==typeof o&&(a.duration=o,o=a,a=null);var u,l,d,h,f,p,v,m,g=(c=t.call(this,s?o:Nt(o),a)||this).vars,A=g.duration,y=g.delay,b=g.immediateRender,w=g.stagger,E=g.overwrite,_=g.keyframes,S=g.defaults,T=g.scrollTrigger,C=g.yoyoEase,x=c.parent,R=(J(e)||X(e)?G(e[0]):"length"in o)?[e]:se(e);if(c._targets=R.length?yt(R):ct("GSAP target "+e+" not found. https://greensock.com",!M.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=E,_||w||K(A)||K(y)){if(o=c.vars,(u=c.timeline=new Qe({data:"nested",defaults:S||{}})).kill(),u.parent=u._dp=n(c),u._start=0,_)Ot(u.vars.defaults,{ease:"none"}),_.forEach((function(t){return u.to(R,t,">")}));else{if(h=R.length,v=w?ue(w):lt,z(w))for(f in w)~Ye.indexOf(f)&&(m||(m={}),m[f]=w[f]);for(l=0;l<h;l++){for(f in d={},o)$e.indexOf(f)<0&&(d[f]=o[f]);d.stagger=0,C&&(d.yoyoEase=C),m&&Lt(d,m),p=R[l],d.duration=+Je(A,n(c),l,p,R),d.delay=(+Je(y,n(c),l,p,R)||0)-c._delay,!w&&1===h&&d.delay&&(c._delay=y=d.delay,c._start+=y,d.delay=0),u.to(p,d,v(l,p,R))}u.duration()?A=y=0:c.timeline=0}A||c.duration(A=u.duration())}else c.timeline=0;return!0!==E||r||(ze=n(c),i.killTweensOf(R),ze=0),x&&qt(x,n(c)),(b||!A&&!_&&c._start===_t(x._time)&&q(b)&&Ht(n(c))&&"nested"!==x.data)&&(c._tTime=-1e-8,c.render(Math.max(0,-y))),T&&Kt(n(c),T),c}e(o,t);var a=o.prototype;return a.render=function(t,e,n){var r,i,o,a,s,c,u,l,d,h=this._time,f=this._tDur,p=this._dur,v=t>f-B&&t>=0?f:t<B?0:t;if(p){if(v!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=t<0){if(r=v,l=this.timeline,this._repeat){if(a=p+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*a+t,e,n);if(r=_t(v%a),v===f?(o=this._repeat,r=p):((o=~~(v/a))&&o===v/a&&(r=p,o--),r>p&&(r=p)),(c=this._yoyo&&1&o)&&(d=this._yEase,r=p-r),s=Vt(this._tTime,a),r===h&&!n&&this._initted)return this;o!==s&&(l&&this._yEase&&Pe(l,c),!this.vars.repeatRefresh||c||this._lock||(this._lock=n=1,this.render(_t(a*o),!0).invalidate()._lock=0))}if(!this._initted){if(Xt(this,t<0?t:r,n,e))return this._tTime=0,this;if(p!==this._dur)return this.render(t,e,n)}for(this._tTime=v,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(d||this._ease)(r/p),this._from&&(this.ratio=u=1-u),r&&!h&&!e&&ge(this,"onStart"),i=this._pt;i;)i.r(u,i.d),i=i._next;l&&l.render(t<0?t:!r&&c?-1e-8:l._dur*u,e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(t<0&&this._startAt&&this._startAt.render(t,!0,n),ge(this,"onUpdate")),this._repeat&&o!==s&&this.vars.onRepeat&&!e&&this.parent&&ge(this,"onRepeat"),v!==this._tDur&&v||this._tTime!==v||(t<0&&this._startAt&&!this._onUpdate&&this._startAt.render(t,!0,!0),(t||!p)&&(v===this._tDur&&this._ts>0||!v&&this._ts<0)&&Ut(this,1),e||t<0&&!h||!v&&!h||(ge(this,v===f?"onComplete":"onReverseComplete",!0),this._prom&&!(v<f&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,r){var i,o,a,s=t.ratio,c=e<0||!e&&(!t._start&&Jt(t)||(t._ts<0||t._dp._ts<0)&&"isFromStart"!==t.data&&"isStart"!==t.data)?0:1,u=t._rDelay,l=0;if(u&&t._repeat&&(l=ne(0,t._tDur,e),o=Vt(l,u),a=Vt(t._tTime,u),t._yoyo&&1&o&&(c=1-c),o!==a&&(s=1-c,t.vars.repeatRefresh&&t._initted&&t.invalidate())),c!==s||r||t._zTime===B||!e&&t._zTime){if(!t._initted&&Xt(t,e,r,n))return;for(a=t._zTime,t._zTime=e||(n?B:0),n||(n=e&&!a),t.ratio=c,t._from&&(c=1-c),t._time=0,t._tTime=l,i=t._pt;i;)i.r(c,i.d),i=i._next;t._startAt&&e<0&&t._startAt.render(e,!0,!0),t._onUpdate&&!n&&ge(t,"onUpdate"),l&&t._repeat&&!n&&t.parent&&ge(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===c&&(c&&Ut(t,1),n||(ge(t,c?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},a.targets=function(){return this._targets},a.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),t.prototype.invalidate.call(this)},a.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?Ae(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,ze&&!0!==ze.vars.overwrite)._first||Ae(this),this.parent&&n!==this.timeline.totalDuration()&&Yt(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,o,a,s,c,u,l=this._targets,d=t?se(t):l,h=this._ptLookup,f=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,r=n===e.length;r&&n--&&t[n]===e[n];);return n<0}(l,d))return"all"===e&&(this._pt=0),Ae(this);for(r=this._op=this._op||[],"all"!==e&&(j(e)&&(s={},Et(e,(function(t){return s[t]=1})),e=s),e=function(t,e){var n,r,i,o,a=t[0]?bt(t[0]).harness:0,s=a&&a.aliases;if(!s)return e;for(r in n=Lt({},e),s)if(r in n)for(i=(o=s[r].split(",")).length;i--;)n[o[i]]=n[r];return n}(l,e)),u=l.length;u--;)if(~d.indexOf(l[u]))for(s in i=h[u],"all"===e?(r[u]=e,a=i,o={}):(o=r[u]=r[u]||{},a=e),a)(c=i&&i[s])&&("kill"in c.d&&!0!==c.d.kill(s)||Pt(this,c,"_pt"),delete i[s]),"all"!==o&&(o[s]=1);return this._initted&&!this._pt&&f&&Ae(this),this},o.to=function(t,e){return new o(t,e,arguments[2])},o.from=function(t,e){return new o(t,Tt(arguments,1))},o.delayedCall=function(t,e,n,r){return new o(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:r})},o.fromTo=function(t,e,n){return new o(t,Tt(arguments,2))},o.set=function(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new o(t,e)},o.killTweensOf=function(t,e,n){return i.killTweensOf(t,e,n)},o}(Ge);Ot(Ze.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Et("staggerTo,staggerFrom,staggerFromTo",(function(t){Ze[t]=function(){var e=new Qe,n=ie.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var tn=function(t,e,n){return t[e]=n},en=function(t,e,n){return t[e](n)},nn=function(t,e,n,r){return t[e](r.fp,n)},rn=function(t,e,n){return t.setAttribute(e,n)},on=function(t,e){return V(t[e])?en:Q(t[e])&&t.setAttribute?rn:tn},an=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4,e)},sn=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},cn=function(t,e){var n=e._pt,r="";if(!t&&e.b)r=e.b;else if(1===t&&e.e)r=e.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+r,n=n._next;r+=e.c}e.set(e.t,e.p,r,e)},un=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},ln=function(t,e,n,r){for(var i,o=this._pt;o;)i=o._next,o.p===r&&o.modifier(t,e,n),o=i},dn=function(t){for(var e,n,r=this._pt;r;)n=r._next,r.p===t&&!r.op||r.op===t?Pt(this,r,"_pt"):r.dep||(e=1),r=n;return!e},hn=function(t,e,n,r){r.mSet(t,e,r.m.call(r.tween,n,r.mt),r)},fn=function(t){for(var e,n,r,i,o=t._pt;o;){for(e=o._next,n=r;n&&n.pr>o.pr;)n=n._next;(o._prev=n?n._prev:i)?o._prev._next=o:r=o,(o._next=n)?n._prev=o:i=o,o=e}t._pt=r},pn=function(){function t(t,e,n,r,i,o,a,s,c){this.t=e,this.s=r,this.c=i,this.p=n,this.r=o||an,this.d=a||this,this.set=s||tn,this.pr=c||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=hn,this.m=t,this.mt=n,this.tween=e},t}();Et(At+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return dt[t]=1})),it.TweenMax=it.TweenLite=Ze,it.TimelineLite=it.TimelineMax=Qe,i=new Qe({sortChildren:!1,defaults:L,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),M.stringFilter=Re;var vn={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return ye(t)}))},timeline:function(t){return new Qe(t)},getTweensOf:function(t,e){return i.getTweensOf(t,e)},getProperty:function(t,e,n,r){j(t)&&(t=se(t)[0]);var i=bt(t||{}).get,o=n?It:Rt;return"native"===n&&(n=""),t?e?o((pt[e]&&pt[e].get||i)(t,e,n,r)):function(e,n,r){return o((pt[e]&&pt[e].get||i)(t,e,n,r))}:t},quickSetter:function(t,e,n){if((t=se(t)).length>1){var r=t.map((function(t){return An.quickSetter(t,e,n)})),i=r.length;return function(t){for(var e=i;e--;)r[e](t)}}t=t[0]||{};var o=pt[e],a=bt(t),s=a.harness&&(a.harness.aliases||{})[e]||e,c=o?function(e){var r=new o;l._pt=0,r.init(t,n?e+n:e,l,0,[t]),r.render(1,r),l._pt&&un(1,l)}:a.set(t,s);return o?c:function(e){return c(t,s,n?e+n:e,a,1)}},isTweening:function(t){return i.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Ue(t.ease,L.ease)),kt(L,t||{})},config:function(t){return kt(M,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,r=t.plugins,i=t.defaults,o=t.extendTimeline;(r||"").split(",").forEach((function(t){return t&&!pt[t]&&!it[t]&&ct(e+" effect requires "+t+" plugin.")})),vt[e]=function(t,e,r){return n(se(t),Ot(e||{},i),r)},o&&(Qe.prototype[e]=function(t,n,r){return this.add(vt[e](t,z(n)?n:(r=n)&&{},this),r)})},registerEase:function(t,e){Me[t]=Ue(e)},parseEase:function(t,e){return arguments.length?Ue(t,e):Me},getById:function(t){return i.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,r,o=new Qe(t);for(o.smoothChildTiming=q(t.smoothChildTiming),i.remove(o),o._dp=0,o._time=o._tTime=i._time,n=i._first;n;)r=n._next,!e&&!n._dur&&n instanceof Ze&&n.vars.onComplete===n._targets[0]||Wt(o,n,n._start-n._delay),n=r;return Wt(i,o,0),o},utils:{wrap:function t(e,n,r){var i=n-e;return J(e)?fe(e,t(0,e.length),n):ee(r,(function(t){return(i+(t-e)%i)%i+e}))},wrapYoyo:function t(e,n,r){var i=n-e,o=2*i;return J(e)?fe(e,t(0,e.length-1),n):ee(r,(function(t){return e+((t=(o+(t-e)%o)%o||0)>i?o-t:t)}))},distribute:ue,random:he,snap:de,normalize:function(t,e,n){return ve(t,e,0,1,n)},getUnit:re,clamp:function(t,e,n){return ee(n,(function(n){return ne(t,e,n)}))},splitColor:_e,toArray:se,mapRange:ve,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||re(n))}},interpolate:function t(e,n,r,i){var o=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!o){var a,s,c,u,l,d=j(e),h={};if(!0===r&&(i=1)&&(r=null),d)e={p:e},n={p:n};else if(J(e)&&!J(n)){for(c=[],u=e.length,l=u-2,s=1;s<u;s++)c.push(t(e[s-1],e[s]));u--,o=function(t){t*=u;var e=Math.min(l,~~t);return c[e](t-e)},r=n}else i||(e=Lt(J(e)?[]:{},e));if(!c){for(a in n)We.call(h,e,a,"get",n[a]);o=function(t){return un(t,h)||(d?e.p:e)}}}return ee(r,o)},shuffle:ce},install:at,effects:vt,ticker:Ie,updateRoot:Qe.updateRoot,plugins:pt,globalTimeline:i,core:{PropTween:pn,globals:ut,Tween:Ze,Timeline:Qe,Animation:Ge,getCache:bt,_removeLinkedListItem:Pt,suppressOverwrites:function(t){return r=t}}};Et("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return vn[t]=Ze[t]})),Ie.add(Qe.updateRoot),l=vn.to({},{duration:0});var mn=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},gn=function(t,e){return{name:t,rawVars:1,init:function(t,n,r){r._onInit=function(t){var r,i;if(j(n)&&(r={},Et(n,(function(t){return r[t]=1})),n=r),e){for(i in r={},n)r[i]=e(n[i]);n=r}!function(t,e){var n,r,i,o=t._targets;for(n in e)for(r=o.length;r--;)(i=t._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=mn(i,n)),i&&i.modifier&&i.modifier(e[n],t,o[r],n))}(t,n)}}}},An=vn.registerPlugin({name:"attr",init:function(t,e,n,r,i){var o,a;for(o in e)(a=this.add(t,"setAttribute",(t.getAttribute(o)||0)+"",e[o],r,i,0,0,o))&&(a.op=o),this._props.push(o)}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n])}},gn("roundProps",le),gn("modifiers"),gn("snap",de))||vn;Ze.version=Qe.version=An.version="3.6.1",c=1,W()&&Oe();var yn,bn,wn,En,_n,Sn,Tn,Cn=Me.Power0,xn=Me.Power1,Rn=Me.Power2,In=Me.Power3,On=Me.Power4,Mn=Me.Linear,Ln=Me.Quad,kn=Me.Cubic,Bn=Me.Quart,Nn=Me.Quint,Pn=Me.Strong,Un=Me.Elastic,Dn=Me.Back,Fn=Me.SteppedEase,Hn=Me.Bounce,jn=Me.Sine,Vn=Me.Expo,Gn=Me.Circ,Qn={},zn=180/Math.PI,qn=Math.PI/180,Wn=Math.atan2,Kn=/([A-Z])/g,Xn=/(?:left|right|width|margin|padding|x)/i,Jn=/[\s,\(]\S/,Yn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},$n=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Zn=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},tr=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},er=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},nr=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},rr=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},ir=function(t,e,n){return t.style[e]=n},or=function(t,e,n){return t.style.setProperty(e,n)},ar=function(t,e,n){return t._gsap[e]=n},sr=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},cr=function(t,e,n,r,i){var o=t._gsap;o.scaleX=o.scaleY=n,o.renderTransform(i,o)},ur=function(t,e,n,r,i){var o=t._gsap;o[e]=n,o.renderTransform(i,o)},lr="transform",dr=lr+"Origin",hr=function(t,e){var n=bn.createElementNS?bn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):bn.createElement(t);return n.style?n:bn.createElement(t)},fr=function t(e,n,r){var i=getComputedStyle(e);return i[n]||i.getPropertyValue(n.replace(Kn,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&t(e,vr(n)||n,1)||""},pr="O,Moz,ms,Ms,Webkit".split(","),vr=function(t,e,n){var r=(e||_n).style,i=5;if(t in r&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);i--&&!(pr[i]+t in r););return i<0?null:(3===i?"ms":i>=0?pr[i]:"")+t},mr=function(){"undefined"!=typeof window&&window.document&&(yn=window,bn=yn.document,wn=bn.documentElement,_n=hr("div")||{style:{}},hr("div"),lr=vr(lr),dr=lr+"Origin",_n.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Tn=!!vr("perspective"),En=1)},gr=function t(e){var n,r=hr("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,o=this.nextSibling,a=this.style.cssText;if(wn.appendChild(r),r.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(o?i.insertBefore(this,o):i.appendChild(this)),wn.removeChild(r),this.style.cssText=a,n},Ar=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},yr=function(t){var e;try{e=t.getBBox()}catch(n){e=gr.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===gr||(e=gr.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+Ar(t,["x","cx","x1"])||0,y:+Ar(t,["y","cy","y1"])||0,width:0,height:0}},br=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!yr(t))},wr=function(t,e){if(e){var n=t.style;e in Qn&&e!==dr&&(e=lr),n.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),n.removeProperty(e.replace(Kn,"-$1").toLowerCase())):n.removeAttribute(e)}},Er=function(t,e,n,r,i,o){var a=new pn(t._pt,e,n,0,1,o?rr:nr);return t._pt=a,a.b=r,a.e=i,t._props.push(n),a},_r={deg:1,rad:1,turn:1},Sr=function t(e,n,r,i){var o,a,s,c,u=parseFloat(r)||0,l=(r+"").trim().substr((u+"").length)||"px",d=_n.style,h=Xn.test(n),f="svg"===e.tagName.toLowerCase(),p=(f?"client":"offset")+(h?"Width":"Height"),v=100,m="px"===i,g="%"===i;return i===l||!u||_r[i]||_r[l]?u:("px"!==l&&!m&&(u=t(e,n,r,"px")),c=e.getCTM&&br(e),!g&&"%"!==l||!Qn[n]&&!~n.indexOf("adius")?(d[h?"width":"height"]=v+(m?l:i),a=~n.indexOf("adius")||"em"===i&&e.appendChild&&!f?e:e.parentNode,c&&(a=(e.ownerSVGElement||{}).parentNode),a&&a!==bn&&a.appendChild||(a=bn.body),(s=a._gsap)&&g&&s.width&&h&&s.time===Ie.time?_t(u/s.width*v):((g||"%"===l)&&(d.position=fr(e,"position")),a===e&&(d.position="static"),a.appendChild(_n),o=_n[p],a.removeChild(_n),d.position="absolute",h&&g&&((s=bt(a)).time=Ie.time,s.width=a[p]),_t(m?o*u/v:o&&u?v/o*u:0))):(o=c?e.getBBox()[h?"width":"height"]:e[p],_t(g?u/o*v:u/100*o)))},Tr=function(t,e,n,r){var i;return En||mr(),e in Yn&&"transform"!==e&&~(e=Yn[e]).indexOf(",")&&(e=e.split(",")[0]),Qn[e]&&"transform"!==e?(i=Pr(t,r),i="transformOrigin"!==e?i[e]:Ur(fr(t,dr))+" "+i.zOrigin+"px"):(!(i=t.style[e])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Ir[e]&&Ir[e](t,e,n)||fr(t,e)||wt(t,e)||("opacity"===e?1:0)),n&&!~(i+"").trim().indexOf(" ")?Sr(t,e,i,n)+n:i},Cr=function(t,e,n,r){if(!n||"none"===n){var i=vr(e,t,1),o=i&&fr(t,i,1);o&&o!==n?(e=i,n=o):"borderColor"===e&&(n=fr(t,"borderTopColor"))}var a,s,c,u,l,d,h,f,p,v,m,g,A=new pn(this._pt,t.style,e,0,1,cn),y=0,b=0;if(A.b=n,A.e=r,n+="","auto"===(r+="")&&(t.style[e]=r,r=fr(t,e)||r,t.style[e]=n),Re(a=[n,r]),r=a[1],c=(n=a[0]).match(Z)||[],(r.match(Z)||[]).length){for(;s=Z.exec(r);)h=s[0],p=r.substring(y,s.index),l?l=(l+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(l=1),h!==(d=c[b++]||"")&&(u=parseFloat(d)||0,m=d.substr((u+"").length),(g="="===h.charAt(1)?+(h.charAt(0)+"1"):0)&&(h=h.substr(2)),f=parseFloat(h),v=h.substr((f+"").length),y=Z.lastIndex-v.length,v||(v=v||M.units[e]||m,y===r.length&&(r+=v,A.e+=v)),m!==v&&(u=Sr(t,e,d,v)||0),A._pt={_next:A._pt,p:p||1===b?p:",",s:u,c:g?g*f:f-u,m:l&&l<4||"zIndex"===e?Math.round:0});A.c=y<r.length?r.substring(y,r.length):""}else A.r="display"===e&&"none"===r?rr:nr;return et.test(r)&&(A.e=0),this._pt=A,A},xr={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Rr=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,r,i,o=e.t,a=o.style,s=e.u,c=o._gsap;if("all"===s||!0===s)a.cssText="",r=1;else for(i=(s=s.split(",")).length;--i>-1;)n=s[i],Qn[n]&&(r=1,n="transformOrigin"===n?dr:lr),wr(o,n);r&&(wr(o,lr),c&&(c.svg&&o.removeAttribute("transform"),Pr(o,1),c.uncache=1))}},Ir={clearProps:function(t,e,n,r,i){if("isFromStart"!==i.data){var o=t._pt=new pn(t._pt,e,n,0,0,Rr);return o.u=r,o.pr=-10,o.tween=i,t._props.push(n),1}}},Or=[1,0,0,1,0,0],Mr={},Lr=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},kr=function(t){var e=fr(t,lr);return Lr(e)?Or:e.substr(7).match($).map(_t)},Br=function(t,e){var n,r,i,o,a=t._gsap||bt(t),s=t.style,c=kr(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(c=[(i=t.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Or:c:(c!==Or||t.offsetParent||t===wn||a.svg||(i=s.display,s.display="block",(n=t.parentNode)&&t.offsetParent||(o=1,r=t.nextSibling,wn.appendChild(t)),c=kr(t),i?s.display=i:wr(t,"display"),o&&(r?n.insertBefore(t,r):n?n.appendChild(t):wn.removeChild(t))),e&&c.length>6?[c[0],c[1],c[4],c[5],c[12],c[13]]:c)},Nr=function(t,e,n,r,i,o){var a,s,c,u=t._gsap,l=i||Br(t,!0),d=u.xOrigin||0,h=u.yOrigin||0,f=u.xOffset||0,p=u.yOffset||0,v=l[0],m=l[1],g=l[2],A=l[3],y=l[4],b=l[5],w=e.split(" "),E=parseFloat(w[0])||0,_=parseFloat(w[1])||0;n?l!==Or&&(s=v*A-m*g)&&(c=E*(-m/s)+_*(v/s)-(v*b-m*y)/s,E=E*(A/s)+_*(-g/s)+(g*b-A*y)/s,_=c):(E=(a=yr(t)).x+(~w[0].indexOf("%")?E/100*a.width:E),_=a.y+(~(w[1]||w[0]).indexOf("%")?_/100*a.height:_)),r||!1!==r&&u.smooth?(y=E-d,b=_-h,u.xOffset=f+(y*v+b*g)-y,u.yOffset=p+(y*m+b*A)-b):u.xOffset=u.yOffset=0,u.xOrigin=E,u.yOrigin=_,u.smooth=!!r,u.origin=e,u.originIsAbsolute=!!n,t.style[dr]="0px 0px",o&&(Er(o,u,"xOrigin",d,E),Er(o,u,"yOrigin",h,_),Er(o,u,"xOffset",f,u.xOffset),Er(o,u,"yOffset",p,u.yOffset)),t.setAttribute("data-svg-origin",E+" "+_)},Pr=function(t,e){var n=t._gsap||new Ve(t);if("x"in n&&!e&&!n.uncache)return n;var r,i,o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w,E,_,S,T,C,x,R,I,O,L,k,B,N,P=t.style,U=n.scaleX<0,D="px",F="deg",H=fr(t,dr)||"0";return r=i=o=c=u=l=d=h=f=0,a=s=1,n.svg=!(!t.getCTM||!br(t)),m=Br(t,n.svg),n.svg&&(C=!n.uncache&&!e&&t.getAttribute("data-svg-origin"),Nr(t,C||H,!!C||n.originIsAbsolute,!1!==n.smooth,m)),p=n.xOrigin||0,v=n.yOrigin||0,m!==Or&&(b=m[0],w=m[1],E=m[2],_=m[3],r=S=m[4],i=T=m[5],6===m.length?(a=Math.sqrt(b*b+w*w),s=Math.sqrt(_*_+E*E),c=b||w?Wn(w,b)*zn:0,(d=E||_?Wn(E,_)*zn+c:0)&&(s*=Math.abs(Math.cos(d*qn))),n.svg&&(r-=p-(p*b+v*E),i-=v-(p*w+v*_))):(N=m[6],k=m[7],I=m[8],O=m[9],L=m[10],B=m[11],r=m[12],i=m[13],o=m[14],u=(g=Wn(N,L))*zn,g&&(C=S*(A=Math.cos(-g))+I*(y=Math.sin(-g)),x=T*A+O*y,R=N*A+L*y,I=S*-y+I*A,O=T*-y+O*A,L=N*-y+L*A,B=k*-y+B*A,S=C,T=x,N=R),l=(g=Wn(-E,L))*zn,g&&(A=Math.cos(-g),B=_*(y=Math.sin(-g))+B*A,b=C=b*A-I*y,w=x=w*A-O*y,E=R=E*A-L*y),c=(g=Wn(w,b))*zn,g&&(C=b*(A=Math.cos(g))+w*(y=Math.sin(g)),x=S*A+T*y,w=w*A-b*y,T=T*A-S*y,b=C,S=x),u&&Math.abs(u)+Math.abs(c)>359.9&&(u=c=0,l=180-l),a=_t(Math.sqrt(b*b+w*w+E*E)),s=_t(Math.sqrt(T*T+N*N)),g=Wn(S,T),d=Math.abs(g)>2e-4?g*zn:0,f=B?1/(B<0?-B:B):0),n.svg&&(C=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!Lr(fr(t,lr)),C&&t.setAttribute("transform",C))),Math.abs(d)>90&&Math.abs(d)<270&&(U?(a*=-1,d+=c<=0?180:-180,c+=c<=0?180:-180):(s*=-1,d+=d<=0?180:-180)),n.x=r-((n.xPercent=r&&(n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-r)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+D,n.y=i-((n.yPercent=i&&(n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-i)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+D,n.z=o+D,n.scaleX=_t(a),n.scaleY=_t(s),n.rotation=_t(c)+F,n.rotationX=_t(u)+F,n.rotationY=_t(l)+F,n.skewX=d+F,n.skewY=h+F,n.transformPerspective=f+D,(n.zOrigin=parseFloat(H.split(" ")[2])||0)&&(P[dr]=Ur(H)),n.xOffset=n.yOffset=0,n.force3D=M.force3D,n.renderTransform=n.svg?Qr:Tn?Gr:Fr,n.uncache=0,n},Ur=function(t){return(t=t.split(" "))[0]+" "+t[1]},Dr=function(t,e,n){var r=re(e);return _t(parseFloat(e)+parseFloat(Sr(t,"x",n+"px",r)))+r},Fr=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Gr(t,e)},Hr="0deg",jr="0px",Vr=") ",Gr=function(t,e){var n=e||this,r=n.xPercent,i=n.yPercent,o=n.x,a=n.y,s=n.z,c=n.rotation,u=n.rotationY,l=n.rotationX,d=n.skewX,h=n.skewY,f=n.scaleX,p=n.scaleY,v=n.transformPerspective,m=n.force3D,g=n.target,A=n.zOrigin,y="",b="auto"===m&&t&&1!==t||!0===m;if(A&&(l!==Hr||u!==Hr)){var w,E=parseFloat(u)*qn,_=Math.sin(E),S=Math.cos(E);E=parseFloat(l)*qn,w=Math.cos(E),o=Dr(g,o,_*w*-A),a=Dr(g,a,-Math.sin(E)*-A),s=Dr(g,s,S*w*-A+A)}v!==jr&&(y+="perspective("+v+Vr),(r||i)&&(y+="translate("+r+"%, "+i+"%) "),(b||o!==jr||a!==jr||s!==jr)&&(y+=s!==jr||b?"translate3d("+o+", "+a+", "+s+") ":"translate("+o+", "+a+Vr),c!==Hr&&(y+="rotate("+c+Vr),u!==Hr&&(y+="rotateY("+u+Vr),l!==Hr&&(y+="rotateX("+l+Vr),d===Hr&&h===Hr||(y+="skew("+d+", "+h+Vr),1===f&&1===p||(y+="scale("+f+", "+p+Vr),g.style[lr]=y||"translate(0, 0)"},Qr=function(t,e){var n,r,i,o,a,s=e||this,c=s.xPercent,u=s.yPercent,l=s.x,d=s.y,h=s.rotation,f=s.skewX,p=s.skewY,v=s.scaleX,m=s.scaleY,g=s.target,A=s.xOrigin,y=s.yOrigin,b=s.xOffset,w=s.yOffset,E=s.forceCSS,_=parseFloat(l),S=parseFloat(d);h=parseFloat(h),f=parseFloat(f),(p=parseFloat(p))&&(f+=p=parseFloat(p),h+=p),h||f?(h*=qn,f*=qn,n=Math.cos(h)*v,r=Math.sin(h)*v,i=Math.sin(h-f)*-m,o=Math.cos(h-f)*m,f&&(p*=qn,a=Math.tan(f-p),i*=a=Math.sqrt(1+a*a),o*=a,p&&(a=Math.tan(p),n*=a=Math.sqrt(1+a*a),r*=a)),n=_t(n),r=_t(r),i=_t(i),o=_t(o)):(n=v,o=m,r=i=0),(_&&!~(l+"").indexOf("px")||S&&!~(d+"").indexOf("px"))&&(_=Sr(g,"x",l,"px"),S=Sr(g,"y",d,"px")),(A||y||b||w)&&(_=_t(_+A-(A*n+y*i)+b),S=_t(S+y-(A*r+y*o)+w)),(c||u)&&(a=g.getBBox(),_=_t(_+c/100*a.width),S=_t(S+u/100*a.height)),a="matrix("+n+","+r+","+i+","+o+","+_+","+S+")",g.setAttribute("transform",a),E&&(g.style[lr]=a)},zr=function(t,e,n,r,i,o){var a,s,c=360,u=j(i),l=parseFloat(i)*(u&&~i.indexOf("rad")?zn:1),d=o?l*o:l-r,h=r+d+"deg";return u&&("short"===(a=i.split("_")[1])&&(d%=c)!==d%180&&(d+=d<0?c:-360),"cw"===a&&d<0?d=(d+36e9)%c-~~(d/c)*c:"ccw"===a&&d>0&&(d=(d-36e9)%c-~~(d/c)*c)),t._pt=s=new pn(t._pt,e,n,r,d,Zn),s.e=h,s.u="deg",t._props.push(n),s},qr=function(t,e){for(var n in e)t[n]=e[n];return t},Wr=function(t,e,n){var r,i,o,a,s,c,u,l=qr({},n._gsap),d=n.style;for(i in l.svg?(o=n.getAttribute("transform"),n.setAttribute("transform",""),d[lr]=e,r=Pr(n,1),wr(n,lr),n.setAttribute("transform",o)):(o=getComputedStyle(n)[lr],d[lr]=e,r=Pr(n,1),d[lr]=o),Qn)(o=l[i])!==(a=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(s=re(o)!==(u=re(a))?Sr(n,i,o,u):parseFloat(o),c=parseFloat(a),t._pt=new pn(t._pt,r,i,s,c-s,$n),t._pt.u=u||0,t._props.push(i));qr(r,l)};Et("padding,margin,Width,Radius",(function(t,e){var n="Top",r="Right",i="Bottom",o="Left",a=(e<3?[n,r,i,o]:[n+o,n+r,i+r,i+o]).map((function(n){return e<2?t+n:"border"+n+t}));Ir[e>1?"border"+t:t]=function(t,e,n,r,i){var o,s;if(arguments.length<4)return o=a.map((function(e){return Tr(t,e,n)})),5===(s=o.join(" ")).split(o[0]).length?o[0]:s;o=(r+"").split(" "),s={},a.forEach((function(t,e){return s[t]=o[e]=o[e]||o[(e-1)/2|0]})),t.init(e,s,i)}}));var Kr,Xr,Jr,Yr={name:"css",register:mr,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,r,i){var o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w,E,_,S=this._props,T=t.style,C=n.vars.startAt;for(d in En||mr(),e)if("autoRound"!==d&&(a=e[d],!pt[d]||!Ke(d,e,n,r,t,i)))if(u=typeof a,l=Ir[d],"function"===u&&(u=typeof(a=a.call(n,r,t,i))),"string"===u&&~a.indexOf("random(")&&(a=pe(a)),l)l(this,t,d,a,n)&&(y=1);else if("--"===d.substr(0,2))o=(getComputedStyle(t).getPropertyValue(d)+"").trim(),a+="",Ce.lastIndex=0,Ce.test(o)||(h=re(o),f=re(a)),f?h!==f&&(o=Sr(t,d,o,f)+f):h&&(a+=h),this.add(T,"setProperty",o,a,r,i,0,0,d);else if("undefined"!==u){if(C&&d in C?(o="function"==typeof C[d]?C[d].call(n,r,t,i):C[d],d in M.units&&!re(o)&&(o+=M.units[d]),"="===(o+"").charAt(1)&&(o=Tr(t,d))):o=Tr(t,d),c=parseFloat(o),(p="string"===u&&"="===a.charAt(1)?+(a.charAt(0)+"1"):0)&&(a=a.substr(2)),s=parseFloat(a),d in Yn&&("autoAlpha"===d&&(1===c&&"hidden"===Tr(t,"visibility")&&s&&(c=0),Er(this,T,"visibility",c?"inherit":"hidden",s?"inherit":"hidden",!s)),"scale"!==d&&"transform"!==d&&~(d=Yn[d]).indexOf(",")&&(d=d.split(",")[0])),v=d in Qn)if(m||((g=t._gsap).renderTransform&&!e.parseTransform||Pr(t,e.parseTransform),A=!1!==e.smoothOrigin&&g.smooth,(m=this._pt=new pn(this._pt,T,lr,0,1,g.renderTransform,g,0,-1)).dep=1),"scale"===d)this._pt=new pn(this._pt,g,"scaleY",g.scaleY,p?p*s:s-g.scaleY),S.push("scaleY",d),d+="X";else{if("transformOrigin"===d){w=void 0,E=void 0,_=void 0,w=(b=a).split(" "),E=w[0],_=w[1]||"50%","top"!==E&&"bottom"!==E&&"left"!==_&&"right"!==_||(b=E,E=_,_=b),w[0]=xr[E]||E,w[1]=xr[_]||_,a=w.join(" "),g.svg?Nr(t,a,0,A,0,this):((f=parseFloat(a.split(" ")[2])||0)!==g.zOrigin&&Er(this,g,"zOrigin",g.zOrigin,f),Er(this,T,d,Ur(o),Ur(a)));continue}if("svgOrigin"===d){Nr(t,a,1,A,0,this);continue}if(d in Mr){zr(this,g,d,c,a,p);continue}if("smoothOrigin"===d){Er(this,g,"smooth",g.smooth,a);continue}if("force3D"===d){g[d]=a;continue}if("transform"===d){Wr(this,a,t);continue}}else d in T||(d=vr(d)||d);if(v||(s||0===s)&&(c||0===c)&&!Jn.test(a)&&d in T)s||(s=0),(h=(o+"").substr((c+"").length))!==(f=re(a)||(d in M.units?M.units[d]:h))&&(c=Sr(t,d,o,f)),this._pt=new pn(this._pt,v?g:T,d,c,p?p*s:s-c,v||"px"!==f&&"zIndex"!==d||!1===e.autoRound?$n:er),this._pt.u=f||0,h!==f&&(this._pt.b=o,this._pt.r=tr);else if(d in T)Cr.call(this,t,d,o,a);else{if(!(d in t)){st(d,a);continue}this.add(t,d,t[d],a,r,i)}S.push(d)}y&&fn(this)},get:Tr,aliases:Yn,getSetter:function(t,e,n){var r=Yn[e];return r&&r.indexOf(",")<0&&(e=r),e in Qn&&e!==dr&&(t._gsap.x||Tr(t,"x"))?n&&Sn===n?"scale"===e?sr:ar:(Sn=n||{})&&("scale"===e?cr:ur):t.style&&!Q(t.style[e])?ir:~e.indexOf("-")?or:on(t,e)},core:{_removeProperty:wr,_getMatrix:Br}};An.utils.checkPrefix=vr,Jr=Et((Kr="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Xr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Qn[t]=1})),Et(Xr,(function(t){M.units[t]="deg",Mr[t]=1})),Yn[Jr[13]]=Kr+","+Xr,Et("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");Yn[e[1]]=Jr[e[0]]})),Et("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){M.units[t]="px"})),An.registerPlugin(Yr);var $r=An.registerPlugin(Yr)||An,Zr=$r.core.Tween;t.Back=Dn,t.Bounce=Hn,t.CSSPlugin=Yr,t.Circ=Gn,t.Cubic=kn,t.Elastic=Un,t.Expo=Vn,t.Linear=Mn,t.Power0=Cn,t.Power1=xn,t.Power2=Rn,t.Power3=In,t.Power4=On,t.Quad=Ln,t.Quart=Bn,t.Quint=Nn,t.Sine=jn,t.SteppedEase=Fn,t.Strong=Pn,t.TimelineLite=Qe,t.TimelineMax=Qe,t.TweenLite=Ze,t.TweenMax=Zr,t.default=$r,t.gsap=$r,"undefined"==typeof window||window!==t?Object.defineProperty(t,"__esModule",{value:!0}):delete window.default})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.QRious=e()}(this,(function(){"use strict";var t=function(){},e=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function r(t,r,i){for(var o,a,s=0,c=(i=n.call(arguments,2)).length;s<c;s++)for(o in a=i[s])t&&!e.call(a,o)||(r[o]=a[o])}var i=function(e,n,i,o){var a=this;return"string"!=typeof e&&(o=i,i=n,n=e,e=null),"function"!=typeof n&&(o=i,i=n,n=function(){return a.apply(this,arguments)}),r(!1,n,a,o),n.prototype=function(e,n){var i;return"function"==typeof Object.create?i=Object.create(e):(t.prototype=e,i=new t,t.prototype=null),n&&r(!0,i,n),i}(a.prototype,i),n.prototype.constructor=n,n.class_=e||a.class_,n.super_=a,n};function o(){}o.class_="Nevis",o.super_=Object,o.extend=i;var a=o,s=a.extend((function(t,e,n){this.qrious=t,this.element=e,this.element.qrious=t,this.enabled=Boolean(n)}),{draw:function(t){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(t){var e=this.qrious,n=e.padding||0,r=Math.floor((e.size-2*n)/t.width);return Math.max(1,r)},getOffset:function(t){var e=this.qrious,n=e.padding;if(null!=n)return n;var r=this.getModuleSize(t),i=Math.floor((e.size-r*t.width)/2);return Math.max(0,i)},render:function(t){this.enabled&&(this.resize(),this.reset(),this.draw(t))},reset:function(){},resize:function(){}}),c=s.extend({draw:function(t){var e,n,r=this.qrious,i=this.getModuleSize(t),o=this.getOffset(t),a=this.element.getContext("2d");for(a.fillStyle=r.foreground,a.globalAlpha=r.foregroundAlpha,e=0;e<t.width;e++)for(n=0;n<t.width;n++)t.buffer[n*t.width+e]&&a.fillRect(i*e+o,i*n+o,i,i)},reset:function(){var t=this.qrious,e=this.element.getContext("2d"),n=t.size;e.lineWidth=1,e.clearRect(0,0,n,n),e.fillStyle=t.background,e.globalAlpha=t.backgroundAlpha,e.fillRect(0,0,n,n)},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),u=a.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),l=a.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),d=a.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),h=a.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),f=a.extend((function(t){var e,n,r,i,o,a=t.value.length;for(this._badness=[],this._level=l.LEVELS[t.level],this._polynomial=[],this._value=t.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,r=4*(this._level-1)+16*(this._version-1),i=l.BLOCKS[r++],o=l.BLOCKS[r++],e=l.BLOCKS[r++],n=l.BLOCKS[r],!(a<=(r=e*(i+o)+o-3+(this._version<=9)))););this._dataBlock=e,this._eccBlock=n,this._neccBlock1=i,this._neccBlock2=o;var s=this.width=17+4*this._version;this.buffer=f._createArray(s*s),this._ecc=f._createArray(e+(e+n)*(i+o)+o),this._mask=f._createArray((s*(s+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+s*(s-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(a),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()}),{_addAlignment:function(t,e){var n,r=this.buffer,i=this.width;for(r[t+i*e]=1,n=-2;n<2;n++)r[t+n+i*(e-2)]=1,r[t-2+i*(e+n+1)]=1,r[t+2+i*(e+n)]=1,r[t+n+1+i*(e+2)]=1;for(n=0;n<2;n++)this._setMask(t-1,e+n),this._setMask(t+1,e-n),this._setMask(t-n,e-1),this._setMask(t+n,e+1)},_appendData:function(t,e,n,r){var i,o,a,s=this._polynomial,c=this._stringBuffer;for(o=0;o<r;o++)c[n+o]=0;for(o=0;o<e;o++){if(255!==(i=d.LOG[c[t+o]^c[n]]))for(a=1;a<r;a++)c[n+a-1]=c[n+a]^d.EXPONENT[f._modN(i+s[r-a])];else for(a=n;a<n+r;a++)c[a]=c[a+1];c[n+r-1]=255===i?0:d.EXPONENT[f._modN(i+s[0])]}},_appendEccToData:function(){var t,e=0,n=this._dataBlock,r=this._calculateMaxLength(),i=this._eccBlock;for(t=0;t<this._neccBlock1;t++)this._appendData(e,n,r,i),e+=n,r+=i;for(t=0;t<this._neccBlock2;t++)this._appendData(e,n+1,r,i),e+=n+1,r+=i},_applyMask:function(t){var e,n,r,i,o=this.buffer,a=this.width;switch(t){case 0:for(i=0;i<a;i++)for(r=0;r<a;r++)r+i&1||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 1:for(i=0;i<a;i++)for(r=0;r<a;r++)1&i||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 2:for(i=0;i<a;i++)for(e=0,r=0;r<a;r++,e++)3===e&&(e=0),e||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 3:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),e=n,r=0;r<a;r++,e++)3===e&&(e=0),e||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 4:for(i=0;i<a;i++)for(e=0,n=i>>1&1,r=0;r<a;r++,e++)3===e&&(e=0,n=!n),n||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 5:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),e=0,r=0;r<a;r++,e++)3===e&&(e=0),(r&i&1)+!(!e|!n)||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 6:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),e=0,r=0;r<a;r++,e++)3===e&&(e=0),(r&i&1)+(e&&e===n)&1||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 7:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),e=0,r=0;r<a;r++,e++)3===e&&(e=0),(e&&e===n)+(r+i&1)&1||this._isMasked(r,i)||(o[r+i*a]^=1)}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var t,e,n=this._eccBlock,r=this._polynomial;for(r[0]=1,t=0;t<n;t++){for(r[t+1]=1,e=t;e>0;e--)r[e]=r[e]?r[e-1]^d.EXPONENT[f._modN(d.LOG[r[e]]+t)]:r[e-1];r[0]=d.EXPONENT[f._modN(d.LOG[r[0]]+t)]}for(t=0;t<=n;t++)r[t]=d.LOG[r[t]]},_checkBadness:function(){var t,e,n,r,i,o=0,a=this._badness,s=this.buffer,c=this.width;for(i=0;i<c-1;i++)for(r=0;r<c-1;r++)(s[r+c*i]&&s[r+1+c*i]&&s[r+c*(i+1)]&&s[r+1+c*(i+1)]||!(s[r+c*i]||s[r+1+c*i]||s[r+c*(i+1)]||s[r+1+c*(i+1)]))&&(o+=f.N2);var u=0;for(i=0;i<c;i++){for(n=0,a[0]=0,t=0,r=0;r<c;r++)t===(e=s[r+c*i])?a[n]++:a[++n]=1,u+=(t=e)?1:-1;o+=this._getBadness(n)}u<0&&(u=-u);var l=0,d=u;for(d+=d<<2,d<<=1;d>c*c;)d-=c*c,l++;for(o+=l*f.N4,r=0;r<c;r++){for(n=0,a[0]=0,t=0,i=0;i<c;i++)t===(e=s[r+c*i])?a[n]++:a[++n]=1,t=e;o+=this._getBadness(n)}return o},_convertBitStream:function(t){var e,n,r=this._ecc,i=this._version;for(n=0;n<t;n++)r[n]=this._value.charCodeAt(n);var o=this._stringBuffer=r.slice(),a=this._calculateMaxLength();t>=a-2&&(t=a-2,i>9&&t--);var s=t;if(i>9){for(o[s+2]=0,o[s+3]=0;s--;)e=o[s],o[s+3]|=255&e<<4,o[s+2]=e>>4;o[2]|=255&t<<4,o[1]=t>>4,o[0]=64|t>>12}else{for(o[s+1]=0,o[s+2]=0;s--;)e=o[s],o[s+2]|=255&e<<4,o[s+1]=e>>4;o[1]|=255&t<<4,o[0]=64|t>>4}for(s=t+3-(i<10);s<a;)o[s++]=236,o[s++]=17},_getBadness:function(t){var e,n=0,r=this._badness;for(e=0;e<=t;e++)r[e]>=5&&(n+=f.N1+r[e]-5);for(e=3;e<t-1;e+=2)r[e-2]===r[e+2]&&r[e+2]===r[e-1]&&r[e-1]===r[e+1]&&3*r[e-1]===r[e]&&(0===r[e-3]||e+3>t||3*r[e-3]>=4*r[e]||3*r[e+3]>=4*r[e])&&(n+=f.N3);return n},_finish:function(){var t,e;this._stringBuffer=this.buffer.slice();var n=0,r=3e4;for(e=0;e<8&&(this._applyMask(e),(t=this._checkBadness())<r&&(r=t,n=e),7!==n);e++)this.buffer=this._stringBuffer.slice();n!==e&&this._applyMask(n),r=l.FINAL_FORMAT[n+(this._level-1<<3)];var i=this.buffer,o=this.width;for(e=0;e<8;e++,r>>=1)1&r&&(i[o-1-e+8*o]=1,e<6?i[8+o*e]=1:i[8+o*(e+1)]=1);for(e=0;e<7;e++,r>>=1)1&r&&(i[8+o*(o-7+e)]=1,e?i[6-e+8*o]=1:i[7+8*o]=1)},_interleaveBlocks:function(){var t,e,n=this._dataBlock,r=this._ecc,i=this._eccBlock,o=0,a=this._calculateMaxLength(),s=this._neccBlock1,c=this._neccBlock2,u=this._stringBuffer;for(t=0;t<n;t++){for(e=0;e<s;e++)r[o++]=u[t+e*n];for(e=0;e<c;e++)r[o++]=u[s*n+t+e*(n+1)]}for(e=0;e<c;e++)r[o++]=u[s*n+t+e*(n+1)];for(t=0;t<i;t++)for(e=0;e<s+c;e++)r[o++]=u[a+t+e*i];this._stringBuffer=r},_insertAlignments:function(){var t,e,n,r=this._version,i=this.width;if(r>1)for(t=u.BLOCK[r],n=i-7;;){for(e=i-7;e>t-3&&(this._addAlignment(e,n),!(e<t));)e-=t;if(n<=t+9)break;n-=t,this._addAlignment(6,n),this._addAlignment(n,6)}},_insertFinders:function(){var t,e,n,r,i=this.buffer,o=this.width;for(t=0;t<3;t++){for(e=0,r=0,1===t&&(e=o-7),2===t&&(r=o-7),i[r+3+o*(e+3)]=1,n=0;n<6;n++)i[r+n+o*e]=1,i[r+o*(e+n+1)]=1,i[r+6+o*(e+n)]=1,i[r+n+1+o*(e+6)]=1;for(n=1;n<5;n++)this._setMask(r+n,e+1),this._setMask(r+1,e+n+1),this._setMask(r+5,e+n),this._setMask(r+n+1,e+5);for(n=2;n<4;n++)i[r+n+o*(e+2)]=1,i[r+2+o*(e+n+1)]=1,i[r+4+o*(e+n)]=1,i[r+n+1+o*(e+4)]=1}},_insertTimingGap:function(){var t,e,n=this.width;for(e=0;e<7;e++)this._setMask(7,e),this._setMask(n-8,e),this._setMask(7,e+n-7);for(t=0;t<8;t++)this._setMask(t,7),this._setMask(t+n-8,7),this._setMask(t,n-8)},_insertTimingRowAndColumn:function(){var t,e=this.buffer,n=this.width;for(t=0;t<n-14;t++)1&t?(this._setMask(8+t,6),this._setMask(6,8+t)):(e[8+t+6*n]=1,e[6+n*(8+t)]=1)},_insertVersion:function(){var t,e,n,r,i=this.buffer,o=this._version,a=this.width;if(o>6)for(t=h.BLOCK[o-7],e=17,n=0;n<6;n++)for(r=0;r<3;r++,e--)1&(e>11?o>>e-12:t>>e)?(i[5-n+a*(2-r+a-11)]=1,i[2-r+a-11+a*(5-n)]=1):(this._setMask(5-n,2-r+a-11),this._setMask(2-r+a-11,5-n))},_isMasked:function(t,e){var n=f._getMaskBit(t,e);return 1===this._mask[n]},_pack:function(){var t,e,n,r=1,i=1,o=this.width,a=o-1,s=o-1,c=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(e=0;e<c;e++)for(t=this._stringBuffer[e],n=0;n<8;n++,t<<=1){128&t&&(this.buffer[a+o*s]=1);do{i?a--:(a++,r?0!==s?s--:(r=!r,6===(a-=2)&&(a--,s=9)):s!==o-1?s++:(r=!r,6===(a-=2)&&(a--,s-=8))),i=!i}while(this._isMasked(a,s))}},_reverseMask:function(){var t,e,n=this.width;for(t=0;t<9;t++)this._setMask(t,8);for(t=0;t<8;t++)this._setMask(t+n-8,8),this._setMask(8,t);for(e=0;e<7;e++)this._setMask(8,e+n-7)},_setMask:function(t,e){var n=f._getMaskBit(t,e);this._mask[n]=1},_syncMask:function(){var t,e,n=this.width;for(e=0;e<n;e++)for(t=0;t<=e;t++)this.buffer[t+n*e]&&this._setMask(t,e)}},{_createArray:function(t){var e,n=[];for(e=0;e<t;e++)n[e]=0;return n},_getMaskBit:function(t,e){var n;return t>e&&(n=t,t=e,e=n),n=e,n+=e*e,n>>=1,n+=t},_modN:function(t){for(;t>=255;)t=((t-=255)>>8)+(255&t);return t},N1:3,N2:3,N3:40,N4:10}),p=f,v=s.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),m=a.extend((function(t,e,n,r){this.name=t,this.modifiable=Boolean(e),this.defaultValue=n,this._valueTransformer=r}),{transform:function(t){var e=this._valueTransformer;return"function"==typeof e?e(t,this):t}}),g=a.extend(null,{abs:function(t){return null!=t?Math.abs(t):null},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},noop:function(){},toUpperCase:function(t){return null!=t?t.toUpperCase():null}}),A=a.extend((function(t){this.options={},t.forEach((function(t){this.options[t.name]=t}),this)}),{exists:function(t){return null!=this.options[t]},get:function(t,e){return A._get(this.options[t],e)},getAll:function(t){var e,n=this.options,r={};for(e in n)g.hasOwn(n,e)&&(r[e]=A._get(n[e],t));return r},init:function(t,e,n){var r,i;for(r in"function"!=typeof n&&(n=g.noop),this.options)g.hasOwn(this.options,r)&&(i=this.options[r],A._set(i,i.defaultValue,e),A._createAccessor(i,e,n));this._setAll(t,e,!0)},set:function(t,e,n){return this._set(t,e,n)},setAll:function(t,e){return this._setAll(t,e)},_set:function(t,e,n,r){var i=this.options[t];if(!i)throw new Error("Invalid option: "+t);if(!i.modifiable&&!r)throw new Error("Option cannot be modified: "+t);return A._set(i,e,n)},_setAll:function(t,e,n){if(!t)return!1;var r,i=!1;for(r in t)g.hasOwn(t,r)&&this._set(r,t[r],e,n)&&(i=!0);return i}},{_createAccessor:function(t,e,n){var r={get:function(){return A._get(t,e)}};t.modifiable&&(r.set=function(r){A._set(t,r,e)&&n(r,t)}),Object.defineProperty(e,t.name,r)},_get:function(t,e){return e["_"+t.name]},_set:function(t,e,n){var r="_"+t.name,i=n[r],o=t.transform(null!=e?e:t.defaultValue);return n[r]=o,o!==i}}),y=A,b=a.extend((function(){this._services={}}),{getService:function(t){var e=this._services[t];if(!e)throw new Error("Service is not being managed with name: "+t);return e},setService:function(t,e){if(this._services[t])throw new Error("Service is already managed with name: "+t);e&&(this._services[t]=e)}}),w=new y([new m("background",!0,"white"),new m("backgroundAlpha",!0,1,g.abs),new m("element"),new m("foreground",!0,"black"),new m("foregroundAlpha",!0,1,g.abs),new m("level",!0,"L",g.toUpperCase),new m("mime",!0,"image/png"),new m("padding",!0,null,g.abs),new m("size",!0,100,g.abs),new m("value",!0,"")]),E=new b,_=a.extend((function(t){w.init(t,this,this.update.bind(this));var e=w.get("element",this),n=E.getService("element"),r=e&&n.isCanvas(e)?e:n.createCanvas(),i=e&&n.isImage(e)?e:n.createImage();this._canvasRenderer=new c(this,r,!0),this._imageRenderer=new v(this,i,i===e),this.update()}),{get:function(){return w.getAll(this)},set:function(t){w.setAll(t,this)&&this.update()},toDataURL:function(t){return this.canvas.toDataURL(t||this.mime)},update:function(){var t=new p({level:this.level,value:this.value});this._canvasRenderer.render(t),this._imageRenderer.render(t)}},{use:function(t){E.setService(t.getName(),t)}});Object.defineProperties(_.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var S=_,T=a.extend({getName:function(){}}).extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(t){},isImage:function(t){}}).extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(t){return t instanceof HTMLCanvasElement},isImage:function(t){return t instanceof HTMLImageElement}});return S.use(new T),S})),
/*!
 * html2canvas 1.0.0-rc.7 <https://html2canvas.hertzen.com>
 * Copyright (c) 2020 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).html2canvas=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}for(var o=function(){function t(t,e,n,r){this.left=t,this.top=e,this.width=n,this.height=r}return t.prototype.add=function(e,n,r,i){return new t(this.left+e,this.top+n,this.width+r,this.height+i)},t.fromClientRect=function(e){return new t(e.left,e.top,e.width,e.height)},t}(),a=function(t){return o.fromClientRect(t.getBoundingClientRect())},s=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=t.charCodeAt(n++);56320==(64512&o)?e.push(((1023&i)<<10)+(1023&o)+65536):(e.push(i),n--)}else e.push(i)}return e},c=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var r=[],i=-1,o="";++i<n;){var a=t[i];a<=65535?r.push(a):(a-=65536,r.push(55296+(a>>10),a%1024+56320)),(i+1===n||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="undefined"==typeof Uint8Array?[]:new Uint8Array(256),d=0;d<u.length;d++)l[u.charCodeAt(d)]=d;var h,f=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},p=function(){function t(t,e,n,r,i,o){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=o}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>5])<<2)+(31&t),this.data[e];if(t<=65535)return e=((e=this.index[2048+(t-55296>>5)])<<2)+(31&t),this.data[e];if(t<this.highStart)return e=2080+(t>>11),e=this.index[e],e+=t>>5&63,e=((e=this.index[e])<<2)+(31&t),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),v=10,m=13,g=15,A=17,y=18,b=19,w=20,E=21,_=22,S=24,T=25,C=26,x=27,R=28,I=30,O=32,M=33,L=34,k=35,B=37,N=38,P=39,U=40,D=42,F="×",H="÷",j=function(t){var e,n,r,i=function(t){var e,n,r,i,o,a=.75*t.length,s=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),d=Array.isArray(u)?u:new Uint8Array(u);for(e=0;e<s;e+=4)n=l[t.charCodeAt(e)],r=l[t.charCodeAt(e+1)],i=l[t.charCodeAt(e+2)],o=l[t.charCodeAt(e+3)],d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&o;return u}(t),o=Array.isArray(i)?function(t){for(var e=t.length,n=[],r=0;r<e;r+=4)n.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return n}(i):new Uint32Array(i),a=Array.isArray(i)?function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n.push(t[r+1]<<8|t[r]);return n}(i):new Uint16Array(i),s=f(a,12,o[4]/2),c=2===o[5]?f(a,(24+o[4])/2):(e=o,n=Math.ceil((24+o[4])/4),e.slice?e.slice(n,r):new Uint32Array(Array.prototype.slice.call(e,n,r)));return new p(o[0],o[1],o[2],o[3],s,c)}("KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA"),V=[I,36],G=[1,2,3,5],Q=[v,8],z=[x,C],q=G.concat(Q),W=[N,P,U,L,k],K=[g,m],X=function(t,e,n,r){var i=r[n];if(Array.isArray(t)?-1!==t.indexOf(i):t===i)for(var o=n;o<=r.length;){if((c=r[++o])===e)return!0;if(c!==v)break}if(i===v)for(o=n;o>0;){var a=r[--o];if(Array.isArray(t)?-1!==t.indexOf(a):t===a)for(var s=n;s<=r.length;){var c;if((c=r[++s])===e)return!0;if(c!==v)break}if(a!==v)break}return!1},J=function(t,e){for(var n=t;n>=0;){var r=e[n];if(r!==v)return r;n--}return 0},Y=function(t,e,n,r,i){if(0===n[r])return F;var o=r-1;if(Array.isArray(i)&&!0===i[o])return F;var a=o-1,s=o+1,c=e[o],u=a>=0?e[a]:0,l=e[s];if(2===c&&3===l)return F;if(-1!==G.indexOf(c))return"!";if(-1!==G.indexOf(l))return F;if(-1!==Q.indexOf(l))return F;if(8===J(o,e))return H;if(11===j.get(t[o])&&(l===B||l===O||l===M))return F;if(7===c||7===l)return F;if(9===c)return F;if(-1===[v,m,g].indexOf(c)&&9===l)return F;if(-1!==[A,y,b,S,R].indexOf(l))return F;if(J(o,e)===_)return F;if(X(23,_,o,e))return F;if(X([A,y],E,o,e))return F;if(X(12,12,o,e))return F;if(c===v)return H;if(23===c||23===l)return F;if(16===l||16===c)return H;if(-1!==[m,g,E].indexOf(l)||14===c)return F;if(36===u&&-1!==K.indexOf(c))return F;if(c===R&&36===l)return F;if(l===w&&-1!==V.concat(w,b,T,B,O,M).indexOf(c))return F;if(-1!==V.indexOf(l)&&c===T||-1!==V.indexOf(c)&&l===T)return F;if(c===x&&-1!==[B,O,M].indexOf(l)||-1!==[B,O,M].indexOf(c)&&l===C)return F;if(-1!==V.indexOf(c)&&-1!==z.indexOf(l)||-1!==z.indexOf(c)&&-1!==V.indexOf(l))return F;if(-1!==[x,C].indexOf(c)&&(l===T||-1!==[_,g].indexOf(l)&&e[s+1]===T)||-1!==[_,g].indexOf(c)&&l===T||c===T&&-1!==[T,R,S].indexOf(l))return F;if(-1!==[T,R,S,A,y].indexOf(l))for(var d=o;d>=0;){if((h=e[d])===T)return F;if(-1===[R,S].indexOf(h))break;d--}if(-1!==[x,C].indexOf(l))for(d=-1!==[A,y].indexOf(c)?a:o;d>=0;){var h;if((h=e[d])===T)return F;if(-1===[R,S].indexOf(h))break;d--}if(N===c&&-1!==[N,P,L,k].indexOf(l)||-1!==[P,L].indexOf(c)&&-1!==[P,U].indexOf(l)||-1!==[U,k].indexOf(c)&&l===U)return F;if(-1!==W.indexOf(c)&&-1!==[w,C].indexOf(l)||-1!==W.indexOf(l)&&c===x)return F;if(-1!==V.indexOf(c)&&-1!==V.indexOf(l))return F;if(c===S&&-1!==V.indexOf(l))return F;if(-1!==V.concat(T).indexOf(c)&&l===_||-1!==V.concat(T).indexOf(l)&&c===y)return F;if(41===c&&41===l){for(var f=n[o],p=1;f>0&&41===e[--f];)p++;if(p%2!=0)return F}return c===O&&l===M?F:H},$=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var n=function(t,e){void 0===e&&(e="strict");var n=[],r=[],i=[];return t.forEach((function(t,o){var a=j.get(t);if(a>50?(i.push(!0),a-=50):i.push(!1),-1!==["normal","auto","loose"].indexOf(e)&&-1!==[8208,8211,12316,12448].indexOf(t))return r.push(o),n.push(16);if(4===a||11===a){if(0===o)return r.push(o),n.push(I);var s=n[o-1];return-1===q.indexOf(s)?(r.push(r[o-1]),n.push(s)):(r.push(o),n.push(I))}return r.push(o),31===a?n.push("strict"===e?E:B):a===D||29===a?n.push(I):43===a?t>=131072&&t<=196605||t>=196608&&t<=262141?n.push(B):n.push(I):void n.push(a)})),[r,n,i]}(t,e.lineBreak),r=n[0],i=n[1],o=n[2];return"break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(i=i.map((function(t){return-1!==[T,I,D].indexOf(t)?B:t}))),[r,i,"keep-all"===e.wordBreak?o.map((function(e,n){return e&&t[n]>=19968&&t[n]<=40959})):void 0]},Z=function(){function t(t,e,n,r){this.codePoints=t,this.required="!"===e,this.start=n,this.end=r}return t.prototype.slice=function(){return c.apply(void 0,this.codePoints.slice(this.start,this.end))},t}();!function(t){t[t.STRING_TOKEN=0]="STRING_TOKEN",t[t.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",t[t.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",t[t.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",t[t.COMMA_TOKEN=4]="COMMA_TOKEN",t[t.HASH_TOKEN=5]="HASH_TOKEN",t[t.DELIM_TOKEN=6]="DELIM_TOKEN",t[t.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",t[t.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",t[t.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",t[t.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",t[t.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",t[t.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",t[t.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",t[t.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",t[t.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",t[t.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",t[t.NUMBER_TOKEN=17]="NUMBER_TOKEN",t[t.FUNCTION=18]="FUNCTION",t[t.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",t[t.IDENT_TOKEN=20]="IDENT_TOKEN",t[t.COLUMN_TOKEN=21]="COLUMN_TOKEN",t[t.URL_TOKEN=22]="URL_TOKEN",t[t.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",t[t.CDC_TOKEN=24]="CDC_TOKEN",t[t.CDO_TOKEN=25]="CDO_TOKEN",t[t.COLON_TOKEN=26]="COLON_TOKEN",t[t.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",t[t.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",t[t.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",t[t.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",t[t.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",t[t.EOF_TOKEN=32]="EOF_TOKEN"}(h||(h={}));var tt=45,et=43,nt=-1,rt=function(t){return t>=48&&t<=57},it=function(t){return rt(t)||t>=65&&t<=70||t>=97&&t<=102},ot=function(t){return 10===t||9===t||32===t},at=function(t){return function(t){return function(t){return t>=97&&t<=122}(t)||function(t){return t>=65&&t<=90}(t)}(t)||function(t){return t>=128}(t)||95===t},st=function(t){return at(t)||rt(t)||t===tt},ct=function(t){return t>=0&&t<=8||11===t||t>=14&&t<=31||127===t},ut=function(t,e){return 92===t&&10!==e},lt=function(t,e,n){return t===tt?at(e)||ut(e,n):!!at(t)||!(92!==t||!ut(t,e))},dt=function(t,e,n){return t===et||t===tt?!!rt(e)||46===e&&rt(n):rt(46===t?e:t)},ht=function(t){var e=0,n=1;t[e]!==et&&t[e]!==tt||(t[e]===tt&&(n=-1),e++);for(var r=[];rt(t[e]);)r.push(t[e++]);var i=r.length?parseInt(c.apply(void 0,r),10):0;46===t[e]&&e++;for(var o=[];rt(t[e]);)o.push(t[e++]);var a=o.length,s=a?parseInt(c.apply(void 0,o),10):0;69!==t[e]&&101!==t[e]||e++;var u=1;t[e]!==et&&t[e]!==tt||(t[e]===tt&&(u=-1),e++);for(var l=[];rt(t[e]);)l.push(t[e++]);var d=l.length?parseInt(c.apply(void 0,l),10):0;return n*(i+s*Math.pow(10,-a))*Math.pow(10,u*d)},ft={type:h.LEFT_PARENTHESIS_TOKEN},pt={type:h.RIGHT_PARENTHESIS_TOKEN},vt={type:h.COMMA_TOKEN},mt={type:h.SUFFIX_MATCH_TOKEN},gt={type:h.PREFIX_MATCH_TOKEN},At={type:h.COLUMN_TOKEN},yt={type:h.DASH_MATCH_TOKEN},bt={type:h.INCLUDE_MATCH_TOKEN},wt={type:h.LEFT_CURLY_BRACKET_TOKEN},Et={type:h.RIGHT_CURLY_BRACKET_TOKEN},_t={type:h.SUBSTRING_MATCH_TOKEN},St={type:h.BAD_URL_TOKEN},Tt={type:h.BAD_STRING_TOKEN},Ct={type:h.CDO_TOKEN},xt={type:h.CDC_TOKEN},Rt={type:h.COLON_TOKEN},It={type:h.SEMICOLON_TOKEN},Ot={type:h.LEFT_SQUARE_BRACKET_TOKEN},Mt={type:h.RIGHT_SQUARE_BRACKET_TOKEN},Lt={type:h.WHITESPACE_TOKEN},kt={type:h.EOF_TOKEN},Bt=function(){function t(){this._value=[]}return t.prototype.write=function(t){this._value=this._value.concat(s(t))},t.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==kt;)t.push(e),e=this.consumeToken();return t},t.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(st(e)||ut(n,r)){var i=lt(e,n,r)?2:1,o=this.consumeName();return{type:h.HASH_TOKEN,value:o,flags:i}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),mt;break;case 39:return this.consumeStringToken(39);case 40:return ft;case 41:return pt;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),_t;break;case et:if(dt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 44:return vt;case tt:var a=t,s=this.peekCodePoint(0),u=this.peekCodePoint(1);if(dt(a,s,u))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(lt(a,s,u))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(s===tt&&62===u)return this.consumeCodePoint(),this.consumeCodePoint(),xt;break;case 46:if(dt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(42===l&&47===(l=this.consumeCodePoint()))return this.consumeToken();if(l===nt)return this.consumeToken()}break;case 58:return Rt;case 59:return It;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===tt&&this.peekCodePoint(2)===tt)return this.consumeCodePoint(),this.consumeCodePoint(),Ct;break;case 64:var d=this.peekCodePoint(0),f=this.peekCodePoint(1),p=this.peekCodePoint(2);if(lt(d,f,p)){o=this.consumeName();return{type:h.AT_KEYWORD_TOKEN,value:o}}break;case 91:return Ot;case 92:if(ut(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case 93:return Mt;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),gt;break;case 123:return wt;case 125:return Et;case 117:case 85:var v=this.peekCodePoint(0),m=this.peekCodePoint(1);return v!==et||!it(m)&&63!==m||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),yt;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),At;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),bt;break;case nt:return kt}return ot(t)?(this.consumeWhiteSpace(),Lt):rt(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):at(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:h.DELIM_TOKEN,value:c(t)}},t.prototype.consumeCodePoint=function(){var t=this._value.shift();return void 0===t?-1:t},t.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},t.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},t.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();it(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;63===e&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n){var r=parseInt(c.apply(void 0,t.map((function(t){return 63===t?48:t}))),16),i=parseInt(c.apply(void 0,t.map((function(t){return 63===t?70:t}))),16);return{type:h.UNICODE_RANGE_TOKEN,start:r,end:i}}var o=parseInt(c.apply(void 0,t),16);if(this.peekCodePoint(0)===tt&&it(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var a=[];it(e)&&a.length<6;)a.push(e),e=this.consumeCodePoint();i=parseInt(c.apply(void 0,a),16);return{type:h.UNICODE_RANGE_TOKEN,start:o,end:i}}return{type:h.UNICODE_RANGE_TOKEN,start:o,end:o}},t.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return"url"===t.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:h.FUNCTION_TOKEN,value:t}):{type:h.IDENT_TOKEN,value:t}},t.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===nt)return{type:h.URL_TOKEN,value:""};var e=this.peekCodePoint(0);if(39===e||34===e){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===h.STRING_TOKEN&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===nt||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:h.URL_TOKEN,value:n.value}):(this.consumeBadUrlRemnants(),St)}for(;;){var r=this.consumeCodePoint();if(r===nt||41===r)return{type:h.URL_TOKEN,value:c.apply(void 0,t)};if(ot(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===nt||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:h.URL_TOKEN,value:c.apply(void 0,t)}):(this.consumeBadUrlRemnants(),St);if(34===r||39===r||40===r||ct(r))return this.consumeBadUrlRemnants(),St;if(92===r){if(!ut(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),St;t.push(this.consumeEscapedCodePoint())}else t.push(r)}},t.prototype.consumeWhiteSpace=function(){for(;ot(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(41===t||t===nt)return;ut(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(t){for(var e="";t>0;){var n=Math.min(6e4,t);e+=c.apply(void 0,this._value.splice(0,n)),t-=n}return this._value.shift(),e},t.prototype.consumeStringToken=function(t){for(var e="",n=0;;){var r=this._value[n];if(r===nt||void 0===r||r===t)return e+=this.consumeStringSlice(n),{type:h.STRING_TOKEN,value:e};if(10===r)return this._value.splice(0,n),Tt;if(92===r){var i=this._value[n+1];i!==nt&&void 0!==i&&(10===i?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):ut(r,i)&&(e+=this.consumeStringSlice(n),e+=c(this.consumeEscapedCodePoint()),n=-1))}n++}},t.prototype.consumeNumber=function(){var t=[],e=4,n=this.peekCodePoint(0);for(n!==et&&n!==tt||t.push(this.consumeCodePoint());rt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===n&&rt(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;rt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((69===n||101===n)&&((r===et||r===tt)&&rt(i)||rt(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;rt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[ht(t),e]},t.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);if(lt(r,i,o)){var a=this.consumeName();return{type:h.DIMENSION_TOKEN,number:e,flags:n,unit:a}}return 37===r?(this.consumeCodePoint(),{type:h.PERCENTAGE_TOKEN,number:e,flags:n}):{type:h.NUMBER_TOKEN,number:e,flags:n}},t.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(it(t)){for(var e=c(t);it(this.peekCodePoint(0))&&e.length<6;)e+=c(this.consumeCodePoint());ot(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return 0===n||function(t){return t>=55296&&t<=57343}(n)||n>1114111?65533:n}return t===nt?65533:t},t.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(st(e))t+=c(e);else{if(!ut(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),t;t+=c(this.consumeEscapedCodePoint())}}},t}(),Nt=function(){function t(t){this._tokens=t}return t.create=function(e){var n=new Bt;return n.write(e),new t(n.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===h.WHITESPACE_TOKEN;)t=this.consumeToken();if(t.type===h.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do{t=this.consumeToken()}while(t.type===h.WHITESPACE_TOKEN);if(t.type===h.EOF_TOKEN)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===h.EOF_TOKEN)return t;t.push(e),t.push()}},t.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case h.LEFT_CURLY_BRACKET_TOKEN:case h.LEFT_SQUARE_BRACKET_TOKEN:case h.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(t.type);case h.FUNCTION_TOKEN:return this.consumeFunction(t)}return t},t.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(n.type===h.EOF_TOKEN||Qt(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},t.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:h.FUNCTION};;){var n=this.consumeToken();if(n.type===h.EOF_TOKEN||n.type===h.RIGHT_PARENTHESIS_TOKEN)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var t=this._tokens.shift();return void 0===t?kt:t},t.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},t}(),Pt=function(t){return t.type===h.DIMENSION_TOKEN},Ut=function(t){return t.type===h.NUMBER_TOKEN},Dt=function(t){return t.type===h.IDENT_TOKEN},Ft=function(t){return t.type===h.STRING_TOKEN},Ht=function(t,e){return Dt(t)&&t.value===e},jt=function(t){return t.type!==h.WHITESPACE_TOKEN},Vt=function(t){return t.type!==h.WHITESPACE_TOKEN&&t.type!==h.COMMA_TOKEN},Gt=function(t){var e=[],n=[];return t.forEach((function(t){if(t.type===h.COMMA_TOKEN){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(n),void(n=[])}t.type!==h.WHITESPACE_TOKEN&&n.push(t)})),n.length&&e.push(n),e},Qt=function(t,e){return e===h.LEFT_CURLY_BRACKET_TOKEN&&t.type===h.RIGHT_CURLY_BRACKET_TOKEN||(e===h.LEFT_SQUARE_BRACKET_TOKEN&&t.type===h.RIGHT_SQUARE_BRACKET_TOKEN||e===h.LEFT_PARENTHESIS_TOKEN&&t.type===h.RIGHT_PARENTHESIS_TOKEN)},zt=function(t){return t.type===h.NUMBER_TOKEN||t.type===h.DIMENSION_TOKEN},qt=function(t){return t.type===h.PERCENTAGE_TOKEN||zt(t)},Wt=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},Kt={type:h.NUMBER_TOKEN,number:0,flags:4},Xt={type:h.PERCENTAGE_TOKEN,number:50,flags:4},Jt={type:h.PERCENTAGE_TOKEN,number:100,flags:4},Yt=function(t,e,n){var r=t[0],i=t[1];return[$t(r,e),$t(void 0!==i?i:r,n)]},$t=function(t,e){if(t.type===h.PERCENTAGE_TOKEN)return t.number/100*e;if(Pt(t))switch(t.unit){case"rem":case"em":return 16*t.number;case"px":default:return t.number}return t.number},Zt="grad",te="turn",ee=function(t){if(t.type===h.DIMENSION_TOKEN)switch(t.unit){case"deg":return Math.PI*t.number/180;case Zt:return Math.PI/200*t.number;case"rad":return t.number;case te:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},ne=function(t){return t.type===h.DIMENSION_TOKEN&&("deg"===t.unit||t.unit===Zt||"rad"===t.unit||t.unit===te)},re=function(t){switch(t.filter(Dt).map((function(t){return t.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Kt,Kt];case"to top":case"bottom":return ie(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Kt,Jt];case"to right":case"left":return ie(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Jt,Jt];case"to bottom":case"top":return ie(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Jt,Kt];case"to left":case"right":return ie(270)}return 0},ie=function(t){return Math.PI*t/180},oe=function(t){if(t.type===h.FUNCTION){var e=ve[t.name];if(void 0===e)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(t.values)}if(t.type===h.HASH_TOKEN){if(3===t.value.length){var n=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3);return ce(parseInt(n+n,16),parseInt(r+r,16),parseInt(i+i,16),1)}if(4===t.value.length){n=t.value.substring(0,1),r=t.value.substring(1,2),i=t.value.substring(2,3);var o=t.value.substring(3,4);return ce(parseInt(n+n,16),parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(6===t.value.length){n=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6);return ce(parseInt(n,16),parseInt(r,16),parseInt(i,16),1)}if(8===t.value.length){n=t.value.substring(0,2),r=t.value.substring(2,4),i=t.value.substring(4,6),o=t.value.substring(6,8);return ce(parseInt(n,16),parseInt(r,16),parseInt(i,16),parseInt(o,16)/255)}}if(t.type===h.IDENT_TOKEN){var a=me[t.value.toUpperCase()];if(void 0!==a)return a}return me.TRANSPARENT},ae=function(t){return 0==(255&t)},se=function(t){var e=255&t,n=255&t>>8,r=255&t>>16,i=255&t>>24;return e<255?"rgba("+i+","+r+","+n+","+e/255+")":"rgb("+i+","+r+","+n+")"},ce=function(t,e,n,r){return(t<<24|e<<16|n<<8|Math.round(255*r)<<0)>>>0},ue=function(t,e){if(t.type===h.NUMBER_TOKEN)return t.number;if(t.type===h.PERCENTAGE_TOKEN){var n=3===e?1:255;return 3===e?t.number/100*n:Math.round(t.number/100*n)}return 0},le=function(t){var e=t.filter(Vt);if(3===e.length){var n=e.map(ue),r=n[0],i=n[1],o=n[2];return ce(r,i,o,1)}if(4===e.length){var a=e.map(ue),s=(r=a[0],i=a[1],o=a[2],a[3]);return ce(r,i,o,s)}return 0};function de(t,e,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(e-t)*n*6+t:n<.5?e:n<2/3?6*(e-t)*(2/3-n)+t:t}var he,fe,pe=function(t){var e=t.filter(Vt),n=e[0],r=e[1],i=e[2],o=e[3],a=(n.type===h.NUMBER_TOKEN?ie(n.number):ee(n))/(2*Math.PI),s=qt(r)?r.number/100:0,c=qt(i)?i.number/100:0,u=void 0!==o&&qt(o)?$t(o,1):1;if(0===s)return ce(255*c,255*c,255*c,1);var l=c<=.5?c*(s+1):c+s-c*s,d=2*c-l,f=de(d,l,a+1/3),p=de(d,l,a),v=de(d,l,a-1/3);return ce(255*f,255*p,255*v,u)},ve={hsl:pe,hsla:pe,rgb:le,rgba:le},me={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};!function(t){t[t.VALUE=0]="VALUE",t[t.LIST=1]="LIST",t[t.IDENT_VALUE=2]="IDENT_VALUE",t[t.TYPE_VALUE=3]="TYPE_VALUE",t[t.TOKEN_VALUE=4]="TOKEN_VALUE"}(he||(he={})),function(t){t[t.BORDER_BOX=0]="BORDER_BOX",t[t.PADDING_BOX=1]="PADDING_BOX",t[t.CONTENT_BOX=2]="CONTENT_BOX"}(fe||(fe={}));var ge,Ae={name:"background-clip",initialValue:"border-box",prefix:!1,type:he.LIST,parse:function(t){return t.map((function(t){if(Dt(t))switch(t.value){case"padding-box":return fe.PADDING_BOX;case"content-box":return fe.CONTENT_BOX}return fe.BORDER_BOX}))}},ye={name:"background-color",initialValue:"transparent",prefix:!1,type:he.TYPE_VALUE,format:"color"},be=function(t){var e=oe(t[0]),n=t[1];return n&&qt(n)?{color:e,stop:n}:{color:e,stop:null}},we=function(t,e){var n=t[0],r=t[t.length-1];null===n.stop&&(n.stop=Kt),null===r.stop&&(r.stop=Jt);for(var i=[],o=0,a=0;a<t.length;a++){var s=t[a].stop;if(null!==s){var c=$t(s,e);c>o?i.push(c):i.push(o),o=c}else i.push(null)}var u=null;for(a=0;a<i.length;a++){var l=i[a];if(null===l)null===u&&(u=a);else if(null!==u){for(var d=a-u,h=(l-i[u-1])/(d+1),f=1;f<=d;f++)i[u+f-1]=h*f;u=null}}return t.map((function(t,n){return{color:t.color,stop:Math.max(Math.min(1,i[n]/e),0)}}))},Ee=function(t,e,n){var r="number"==typeof t?t:function(t,e,n){var r=e/2,i=n/2,o=$t(t[0],e)-r,a=i-$t(t[1],n);return(Math.atan2(a,o)+2*Math.PI)%(2*Math.PI)}(t,e,n),i=Math.abs(e*Math.sin(r))+Math.abs(n*Math.cos(r)),o=e/2,a=n/2,s=i/2,c=Math.sin(r-Math.PI/2)*s,u=Math.cos(r-Math.PI/2)*s;return[i,o-u,o+u,a-c,a+c]},_e=function(t,e){return Math.sqrt(t*t+e*e)},Se=function(t,e,n,r,i){return[[0,0],[0,e],[t,0],[t,e]].reduce((function(t,e){var o=e[0],a=e[1],s=_e(n-o,r-a);return(i?s<t.optimumDistance:s>t.optimumDistance)?{optimumCorner:e,optimumDistance:s}:t}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},Te=function(t){var e=ie(180),n=[];return Gt(t).forEach((function(t,r){if(0===r){var i=t[0];if(i.type===h.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(i.value))return void(e=re(t));if(ne(i))return void(e=(ee(i)+ie(270))%ie(360))}var o=be(t);n.push(o)})),{angle:e,stops:n,type:ge.LINEAR_GRADIENT}},Ce=function(t){return 0===t[0]&&255===t[1]&&0===t[2]&&255===t[3]},xe=function(t,e,n,r,i){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",t.toString()),a.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",n.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(s),s.appendChild(i),a},Re=function(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},Ie={get SUPPORT_RANGE_BOUNDS(){var t=function(t){if(t.createRange){var e=t.createRange();if(e.getBoundingClientRect){var n=t.createElement("boundtest");n.style.height="123px",n.style.display="block",t.body.appendChild(n),e.selectNode(n);var r=e.getBoundingClientRect(),i=Math.round(r.height);if(t.body.removeChild(n),123===i)return!0}}return!1}(document);return Object.defineProperty(Ie,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=function(t){var e=new Image,n=t.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),n.toDataURL()}catch(t){return!1}return!0}(document);return Object.defineProperty(Ie,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var e=t.createElement("canvas"),n=100;e.width=n,e.height=n;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,o=e.toDataURL();i.src=o;var a=xe(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),Re(a).then((function(e){r.drawImage(e,0,0);var i=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var a=t.createElement("div");return a.style.backgroundImage="url("+o+")",a.style.height="100px",Ce(i)?Re(xe(n,n,0,0,a)):Promise.reject(!1)})).then((function(t){return r.drawImage(t,0,0),Ce(r.getImageData(0,0,n,n).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Ie,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=void 0!==(new Image).crossOrigin;return Object.defineProperty(Ie,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Ie,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ie,"SUPPORT_CORS_XHR",{value:t}),t}},Oe=function(){function t(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,[this.id,this.getTime()+"ms"].concat(t)):this.info.apply(this,t))},t.prototype.getTime=function(){return Date.now()-this.start},t.create=function(e){t.instances[e.id]=new t(e)},t.destroy=function(e){delete t.instances[e]},t.getInstance=function(e){var n=t.instances[e];if(void 0===n)throw new Error("No logger instance found with id "+e);return n},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,[this.id,this.getTime()+"ms"].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,[this.id,this.getTime()+"ms"].concat(t)):this.info.apply(this,t))},t.instances={},t}(),Me=function(){function t(){}return t.create=function(e,n){return t._caches[e]=new Le(e,n)},t.destroy=function(e){delete t._caches[e]},t.open=function(e){var n=t._caches[e];if(void 0!==n)return n;throw new Error('Cache with key "'+e+'" not found')},t.getOrigin=function(e){var n=t._link;return n?(n.href=e,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t.getInstance=function(){var e=t._current;if(null===e)throw new Error("No cache instance attached");return e},t.attachInstance=function(e){t._current=e},t.detachInstance=function(){t._current=null},t._caches={},t._origin="about:blank",t._current=null,t}(),Le=function(){function t(t,e){this.id=t,this._options=e,this._cache={}}return t.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)?e:Fe(t)||Pe(t)?(this._cache[t]=this.loadImage(t),e):e},t.prototype.match=function(t){return this._cache[t]},t.prototype.loadImage=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,a=this;return i(this,(function(i){switch(i.label){case 0:return e=Me.isSameOrigin(t),n=!Ue(t)&&!0===this._options.useCORS&&Ie.SUPPORT_CORS_IMAGES&&!e,r=!Ue(t)&&!e&&"string"==typeof this._options.proxy&&Ie.SUPPORT_CORS_XHR&&!n,e||!1!==this._options.allowTaint||Ue(t)||r||n?(o=t,r?[4,this.proxy(o)]:[3,2]):[2];case 1:o=i.sent(),i.label=2;case 2:return Oe.getInstance(this.id).debug("Added image "+t.substring(0,256)),[4,new Promise((function(t,e){var r=new Image;r.onload=function(){return t(r)},r.onerror=e,(De(o)||n)&&(r.crossOrigin="anonymous"),r.src=o,!0===r.complete&&setTimeout((function(){return t(r)}),500),a._options.imageTimeout>0&&setTimeout((function(){return e("Timed out ("+a._options.imageTimeout+"ms) loading image")}),a._options.imageTimeout)}))];case 3:return[2,i.sent()]}}))}))},t.prototype.has=function(t){return void 0!==this._cache[t]},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise((function(i,o){var a=Ie.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;if(s.onload=function(){if(200===s.status)if("text"===a)i(s.response);else{var t=new FileReader;t.addEventListener("load",(function(){return i(t.result)}),!1),t.addEventListener("error",(function(t){return o(t)}),!1),t.readAsDataURL(s.response)}else o("Failed to proxy resource "+r+" with status code "+s.status)},s.onerror=o,s.open("GET",n+"?url="+encodeURIComponent(t)+"&responseType="+a),"text"!==a&&s instanceof XMLHttpRequest&&(s.responseType=a),e._options.imageTimeout){var c=e._options.imageTimeout;s.timeout=c,s.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}s.send()}))},t}(),ke=/^data:image\/svg\+xml/i,Be=/^data:image\/.*;base64,/i,Ne=/^data:image\/.*/i,Pe=function(t){return Ie.SUPPORT_SVG_DRAWING||!He(t)},Ue=function(t){return Ne.test(t)},De=function(t){return Be.test(t)},Fe=function(t){return"blob"===t.substr(0,4)},He=function(t){return"svg"===t.substr(-3).toLowerCase()||ke.test(t)},je="closest-side",Ve="farthest-side",Ge="closest-corner",Qe="farthest-corner",ze="circle",qe="ellipse",We="cover",Ke="contain",Xe=function(t){var e=Je.CIRCLE,n=Ye.FARTHEST_CORNER,r=[],i=[];return Gt(t).forEach((function(t,o){var a=!0;if(0===o?a=t.reduce((function(t,e){if(Dt(e))switch(e.value){case"center":return i.push(Xt),!1;case"top":case"left":return i.push(Kt),!1;case"right":case"bottom":return i.push(Jt),!1}else if(qt(e)||zt(e))return i.push(e),!1;return t}),a):1===o&&(a=t.reduce((function(t,r){if(Dt(r))switch(r.value){case ze:return e=Je.CIRCLE,!1;case qe:return e=Je.ELLIPSE,!1;case Ke:case je:return n=Ye.CLOSEST_SIDE,!1;case Ve:return n=Ye.FARTHEST_SIDE,!1;case Ge:return n=Ye.CLOSEST_CORNER,!1;case We:case Qe:return n=Ye.FARTHEST_CORNER,!1}else if(zt(r)||qt(r))return Array.isArray(n)||(n=[]),n.push(r),!1;return t}),a)),a){var s=be(t);r.push(s)}})),{size:n,shape:e,stops:r,position:i,type:ge.RADIAL_GRADIENT}};!function(t){t[t.URL=0]="URL",t[t.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",t[t.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(ge||(ge={}));var Je,Ye;!function(t){t[t.CIRCLE=0]="CIRCLE",t[t.ELLIPSE=1]="ELLIPSE"}(Je||(Je={})),function(t){t[t.CLOSEST_SIDE=0]="CLOSEST_SIDE",t[t.FARTHEST_SIDE=1]="FARTHEST_SIDE",t[t.CLOSEST_CORNER=2]="CLOSEST_CORNER",t[t.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(Ye||(Ye={}));var $e=function(t){if(t.type===h.URL_TOKEN){var e={url:t.value,type:ge.URL};return Me.getInstance().addImage(t.value),e}if(t.type===h.FUNCTION){var n=tn[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(t.values)}throw new Error("Unsupported image type")};var Ze,tn={"linear-gradient":function(t){var e=ie(180),n=[];return Gt(t).forEach((function(t,r){if(0===r){var i=t[0];if(i.type===h.IDENT_TOKEN&&"to"===i.value)return void(e=re(t));if(ne(i))return void(e=ee(i))}var o=be(t);n.push(o)})),{angle:e,stops:n,type:ge.LINEAR_GRADIENT}},"-moz-linear-gradient":Te,"-ms-linear-gradient":Te,"-o-linear-gradient":Te,"-webkit-linear-gradient":Te,"radial-gradient":function(t){var e=Je.CIRCLE,n=Ye.FARTHEST_CORNER,r=[],i=[];return Gt(t).forEach((function(t,o){var a=!0;if(0===o){var s=!1;a=t.reduce((function(t,r){if(s)if(Dt(r))switch(r.value){case"center":return i.push(Xt),t;case"top":case"left":return i.push(Kt),t;case"right":case"bottom":return i.push(Jt),t}else(qt(r)||zt(r))&&i.push(r);else if(Dt(r))switch(r.value){case ze:return e=Je.CIRCLE,!1;case qe:return e=Je.ELLIPSE,!1;case"at":return s=!0,!1;case je:return n=Ye.CLOSEST_SIDE,!1;case We:case Ve:return n=Ye.FARTHEST_SIDE,!1;case Ke:case Ge:return n=Ye.CLOSEST_CORNER,!1;case Qe:return n=Ye.FARTHEST_CORNER,!1}else if(zt(r)||qt(r))return Array.isArray(n)||(n=[]),n.push(r),!1;return t}),a)}if(a){var c=be(t);r.push(c)}})),{size:n,shape:e,stops:r,position:i,type:ge.RADIAL_GRADIENT}},"-moz-radial-gradient":Xe,"-ms-radial-gradient":Xe,"-o-radial-gradient":Xe,"-webkit-radial-gradient":Xe,"-webkit-gradient":function(t){var e=ie(180),n=[],r=ge.LINEAR_GRADIENT,i=Je.CIRCLE,o=Ye.FARTHEST_CORNER;return Gt(t).forEach((function(t,e){var i=t[0];if(0===e){if(Dt(i)&&"linear"===i.value)return void(r=ge.LINEAR_GRADIENT);if(Dt(i)&&"radial"===i.value)return void(r=ge.RADIAL_GRADIENT)}if(i.type===h.FUNCTION)if("from"===i.name){var o=oe(i.values[0]);n.push({stop:Kt,color:o})}else if("to"===i.name){o=oe(i.values[0]);n.push({stop:Jt,color:o})}else if("color-stop"===i.name){var a=i.values.filter(Vt);if(2===a.length){o=oe(a[1]);var s=a[0];Ut(s)&&n.push({stop:{type:h.PERCENTAGE_TOKEN,number:100*s.number,flags:s.flags},color:o})}}})),r===ge.LINEAR_GRADIENT?{angle:(e+ie(180))%ie(360),stops:n,type:r}:{size:o,shape:i,stops:n,position:[],type:r}}},en={name:"background-image",initialValue:"none",type:he.LIST,prefix:!1,parse:function(t){if(0===t.length)return[];var e=t[0];return e.type===h.IDENT_TOKEN&&"none"===e.value?[]:t.filter((function(t){return Vt(t)&&function(t){return t.type!==h.FUNCTION||tn[t.name]}(t)})).map($e)}},nn={name:"background-origin",initialValue:"border-box",prefix:!1,type:he.LIST,parse:function(t){return t.map((function(t){if(Dt(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},rn={name:"background-position",initialValue:"0% 0%",type:he.LIST,prefix:!1,parse:function(t){return Gt(t).map((function(t){return t.filter(qt)})).map(Wt)}};!function(t){t[t.REPEAT=0]="REPEAT",t[t.NO_REPEAT=1]="NO_REPEAT",t[t.REPEAT_X=2]="REPEAT_X",t[t.REPEAT_Y=3]="REPEAT_Y"}(Ze||(Ze={}));var on,an={name:"background-repeat",initialValue:"repeat",prefix:!1,type:he.LIST,parse:function(t){return Gt(t).map((function(t){return t.filter(Dt).map((function(t){return t.value})).join(" ")})).map(sn)}},sn=function(t){switch(t){case"no-repeat":return Ze.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return Ze.REPEAT_X;case"repeat-y":case"no-repeat repeat":return Ze.REPEAT_Y;case"repeat":default:return Ze.REPEAT}};!function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"}(on||(on={}));var cn,un={name:"background-size",initialValue:"0",prefix:!1,type:he.LIST,parse:function(t){return Gt(t).map((function(t){return t.filter(ln)}))}},ln=function(t){return Dt(t)||qt(t)},dn=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:he.TYPE_VALUE,format:"color"}},hn=dn("top"),fn=dn("right"),pn=dn("bottom"),vn=dn("left"),mn=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:he.LIST,parse:function(t){return Wt(t.filter(qt))}}},gn=mn("top-left"),An=mn("top-right"),yn=mn("bottom-right"),bn=mn("bottom-left");!function(t){t[t.NONE=0]="NONE",t[t.SOLID=1]="SOLID"}(cn||(cn={}));var wn,En=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"none":return cn.NONE}return cn.SOLID}}},_n=En("top"),Sn=En("right"),Tn=En("bottom"),Cn=En("left"),xn=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:he.VALUE,prefix:!1,parse:function(t){return Pt(t)?t.number:0}}},Rn=xn("top"),In=xn("right"),On=xn("bottom"),Mn=xn("left"),Ln={name:"color",initialValue:"transparent",prefix:!1,type:he.TYPE_VALUE,format:"color"},kn={name:"display",initialValue:"inline-block",prefix:!1,type:he.LIST,parse:function(t){return t.filter(Dt).reduce((function(t,e){return t|Bn(e.value)}),0)}},Bn=function(t){switch(t){case"block":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.INLINE_START=3]="INLINE_START",t[t.INLINE_END=4]="INLINE_END"}(wn||(wn={}));var Nn,Pn={name:"float",initialValue:"none",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"left":return wn.LEFT;case"right":return wn.RIGHT;case"inline-start":return wn.INLINE_START;case"inline-end":return wn.INLINE_END}return wn.NONE}},Un={name:"letter-spacing",initialValue:"0",prefix:!1,type:he.VALUE,parse:function(t){return t.type===h.IDENT_TOKEN&&"normal"===t.value?0:t.type===h.NUMBER_TOKEN||t.type===h.DIMENSION_TOKEN?t.number:0}};!function(t){t.NORMAL="normal",t.STRICT="strict"}(Nn||(Nn={}));var Dn,Fn={name:"line-break",initialValue:"normal",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"strict":return Nn.STRICT;case"normal":default:return Nn.NORMAL}}},Hn={name:"line-height",initialValue:"normal",prefix:!1,type:he.TOKEN_VALUE},jn={name:"list-style-image",initialValue:"none",type:he.VALUE,prefix:!1,parse:function(t){return t.type===h.IDENT_TOKEN&&"none"===t.value?null:$e(t)}};!function(t){t[t.INSIDE=0]="INSIDE",t[t.OUTSIDE=1]="OUTSIDE"}(Dn||(Dn={}));var Vn,Gn={name:"list-style-position",initialValue:"outside",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"inside":return Dn.INSIDE;case"outside":default:return Dn.OUTSIDE}}};!function(t){t[t.NONE=-1]="NONE",t[t.DISC=0]="DISC",t[t.CIRCLE=1]="CIRCLE",t[t.SQUARE=2]="SQUARE",t[t.DECIMAL=3]="DECIMAL",t[t.CJK_DECIMAL=4]="CJK_DECIMAL",t[t.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",t[t.LOWER_ROMAN=6]="LOWER_ROMAN",t[t.UPPER_ROMAN=7]="UPPER_ROMAN",t[t.LOWER_GREEK=8]="LOWER_GREEK",t[t.LOWER_ALPHA=9]="LOWER_ALPHA",t[t.UPPER_ALPHA=10]="UPPER_ALPHA",t[t.ARABIC_INDIC=11]="ARABIC_INDIC",t[t.ARMENIAN=12]="ARMENIAN",t[t.BENGALI=13]="BENGALI",t[t.CAMBODIAN=14]="CAMBODIAN",t[t.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",t[t.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",t[t.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",t[t.DEVANAGARI=18]="DEVANAGARI",t[t.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",t[t.GEORGIAN=20]="GEORGIAN",t[t.GUJARATI=21]="GUJARATI",t[t.GURMUKHI=22]="GURMUKHI",t[t.HEBREW=22]="HEBREW",t[t.HIRAGANA=23]="HIRAGANA",t[t.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",t[t.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",t[t.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",t[t.KANNADA=27]="KANNADA",t[t.KATAKANA=28]="KATAKANA",t[t.KATAKANA_IROHA=29]="KATAKANA_IROHA",t[t.KHMER=30]="KHMER",t[t.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",t[t.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",t[t.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",t[t.LAO=34]="LAO",t[t.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",t[t.MALAYALAM=36]="MALAYALAM",t[t.MONGOLIAN=37]="MONGOLIAN",t[t.MYANMAR=38]="MYANMAR",t[t.ORIYA=39]="ORIYA",t[t.PERSIAN=40]="PERSIAN",t[t.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",t[t.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",t[t.TAMIL=43]="TAMIL",t[t.TELUGU=44]="TELUGU",t[t.THAI=45]="THAI",t[t.TIBETAN=46]="TIBETAN",t[t.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",t[t.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",t[t.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",t[t.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",t[t.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(Vn||(Vn={}));var Qn,zn={name:"list-style-type",initialValue:"none",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"disc":return Vn.DISC;case"circle":return Vn.CIRCLE;case"square":return Vn.SQUARE;case"decimal":return Vn.DECIMAL;case"cjk-decimal":return Vn.CJK_DECIMAL;case"decimal-leading-zero":return Vn.DECIMAL_LEADING_ZERO;case"lower-roman":return Vn.LOWER_ROMAN;case"upper-roman":return Vn.UPPER_ROMAN;case"lower-greek":return Vn.LOWER_GREEK;case"lower-alpha":return Vn.LOWER_ALPHA;case"upper-alpha":return Vn.UPPER_ALPHA;case"arabic-indic":return Vn.ARABIC_INDIC;case"armenian":return Vn.ARMENIAN;case"bengali":return Vn.BENGALI;case"cambodian":return Vn.CAMBODIAN;case"cjk-earthly-branch":return Vn.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return Vn.CJK_HEAVENLY_STEM;case"cjk-ideographic":return Vn.CJK_IDEOGRAPHIC;case"devanagari":return Vn.DEVANAGARI;case"ethiopic-numeric":return Vn.ETHIOPIC_NUMERIC;case"georgian":return Vn.GEORGIAN;case"gujarati":return Vn.GUJARATI;case"gurmukhi":return Vn.GURMUKHI;case"hebrew":return Vn.HEBREW;case"hiragana":return Vn.HIRAGANA;case"hiragana-iroha":return Vn.HIRAGANA_IROHA;case"japanese-formal":return Vn.JAPANESE_FORMAL;case"japanese-informal":return Vn.JAPANESE_INFORMAL;case"kannada":return Vn.KANNADA;case"katakana":return Vn.KATAKANA;case"katakana-iroha":return Vn.KATAKANA_IROHA;case"khmer":return Vn.KHMER;case"korean-hangul-formal":return Vn.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return Vn.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return Vn.KOREAN_HANJA_INFORMAL;case"lao":return Vn.LAO;case"lower-armenian":return Vn.LOWER_ARMENIAN;case"malayalam":return Vn.MALAYALAM;case"mongolian":return Vn.MONGOLIAN;case"myanmar":return Vn.MYANMAR;case"oriya":return Vn.ORIYA;case"persian":return Vn.PERSIAN;case"simp-chinese-formal":return Vn.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return Vn.SIMP_CHINESE_INFORMAL;case"tamil":return Vn.TAMIL;case"telugu":return Vn.TELUGU;case"thai":return Vn.THAI;case"tibetan":return Vn.TIBETAN;case"trad-chinese-formal":return Vn.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return Vn.TRAD_CHINESE_INFORMAL;case"upper-armenian":return Vn.UPPER_ARMENIAN;case"disclosure-open":return Vn.DISCLOSURE_OPEN;case"disclosure-closed":return Vn.DISCLOSURE_CLOSED;case"none":default:return Vn.NONE}}},qn=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:he.TOKEN_VALUE}},Wn=qn("top"),Kn=qn("right"),Xn=qn("bottom"),Jn=qn("left");!function(t){t[t.VISIBLE=0]="VISIBLE",t[t.HIDDEN=1]="HIDDEN",t[t.SCROLL=2]="SCROLL",t[t.AUTO=3]="AUTO"}(Qn||(Qn={}));var Yn,$n={name:"overflow",initialValue:"visible",prefix:!1,type:he.LIST,parse:function(t){return t.filter(Dt).map((function(t){switch(t.value){case"hidden":return Qn.HIDDEN;case"scroll":return Qn.SCROLL;case"auto":return Qn.AUTO;case"visible":default:return Qn.VISIBLE}}))}};!function(t){t.NORMAL="normal",t.BREAK_WORD="break-word"}(Yn||(Yn={}));var Zn,tr={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"break-word":return Yn.BREAK_WORD;case"normal":default:return Yn.NORMAL}}},er=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:he.TYPE_VALUE,format:"length-percentage"}},nr=er("top"),rr=er("right"),ir=er("bottom"),or=er("left");!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(Zn||(Zn={}));var ar,sr={name:"text-align",initialValue:"left",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"right":return Zn.RIGHT;case"center":case"justify":return Zn.CENTER;case"left":default:return Zn.LEFT}}};!function(t){t[t.STATIC=0]="STATIC",t[t.RELATIVE=1]="RELATIVE",t[t.ABSOLUTE=2]="ABSOLUTE",t[t.FIXED=3]="FIXED",t[t.STICKY=4]="STICKY"}(ar||(ar={}));var cr,ur={name:"position",initialValue:"static",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"relative":return ar.RELATIVE;case"absolute":return ar.ABSOLUTE;case"fixed":return ar.FIXED;case"sticky":return ar.STICKY}return ar.STATIC}},lr={name:"text-shadow",initialValue:"none",type:he.LIST,prefix:!1,parse:function(t){return 1===t.length&&Ht(t[0],"none")?[]:Gt(t).map((function(t){for(var e={color:me.TRANSPARENT,offsetX:Kt,offsetY:Kt,blur:Kt},n=0,r=0;r<t.length;r++){var i=t[r];zt(i)?(0===n?e.offsetX=i:1===n?e.offsetY=i:e.blur=i,n++):e.color=oe(i)}return e}))}};!function(t){t[t.NONE=0]="NONE",t[t.LOWERCASE=1]="LOWERCASE",t[t.UPPERCASE=2]="UPPERCASE",t[t.CAPITALIZE=3]="CAPITALIZE"}(cr||(cr={}));var dr,hr={name:"text-transform",initialValue:"none",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"uppercase":return cr.UPPERCASE;case"lowercase":return cr.LOWERCASE;case"capitalize":return cr.CAPITALIZE}return cr.NONE}},fr={name:"transform",initialValue:"none",prefix:!0,type:he.VALUE,parse:function(t){if(t.type===h.IDENT_TOKEN&&"none"===t.value)return null;if(t.type===h.FUNCTION){var e=pr[t.name];if(void 0===e)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},pr={matrix:function(t){var e=t.filter((function(t){return t.type===h.NUMBER_TOKEN})).map((function(t){return t.number}));return 6===e.length?e:null},matrix3d:function(t){var e=t.filter((function(t){return t.type===h.NUMBER_TOKEN})).map((function(t){return t.number})),n=e[0],r=e[1],i=(e[2],e[3],e[4]),o=e[5],a=(e[6],e[7],e[8],e[9],e[10],e[11],e[12]),s=e[13];e[14],e[15];return 16===e.length?[n,r,i,o,a,s]:null}},vr={type:h.PERCENTAGE_TOKEN,number:50,flags:4},mr=[vr,vr],gr={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:he.LIST,parse:function(t){var e=t.filter(qt);return 2!==e.length?mr:[e[0],e[1]]}};!function(t){t[t.VISIBLE=0]="VISIBLE",t[t.HIDDEN=1]="HIDDEN",t[t.COLLAPSE=2]="COLLAPSE"}(dr||(dr={}));var Ar,yr={name:"visible",initialValue:"none",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"hidden":return dr.HIDDEN;case"collapse":return dr.COLLAPSE;case"visible":default:return dr.VISIBLE}}};!function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"}(Ar||(Ar={}));var br,wr={name:"word-break",initialValue:"normal",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"break-all":return Ar.BREAK_ALL;case"keep-all":return Ar.KEEP_ALL;case"normal":default:return Ar.NORMAL}}},Er={name:"z-index",initialValue:"auto",prefix:!1,type:he.VALUE,parse:function(t){if(t.type===h.IDENT_TOKEN)return{auto:!0,order:0};if(Ut(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},_r={name:"opacity",initialValue:"1",type:he.VALUE,prefix:!1,parse:function(t){return Ut(t)?t.number:1}},Sr={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:he.TYPE_VALUE,format:"color"},Tr={name:"text-decoration-line",initialValue:"none",prefix:!1,type:he.LIST,parse:function(t){return t.filter(Dt).map((function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(t){return 0!==t}))}},Cr={name:"font-family",initialValue:"",prefix:!1,type:he.LIST,parse:function(t){var e=[],n=[];return t.forEach((function(t){switch(t.type){case h.IDENT_TOKEN:case h.STRING_TOKEN:e.push(t.value);break;case h.NUMBER_TOKEN:e.push(t.number.toString());break;case h.COMMA_TOKEN:n.push(e.join(" ")),e.length=0}})),e.length&&n.push(e.join(" ")),n.map((function(t){return-1===t.indexOf(" ")?t:"'"+t+"'"}))}},xr={name:"font-size",initialValue:"0",prefix:!1,type:he.TYPE_VALUE,format:"length"},Rr={name:"font-weight",initialValue:"normal",type:he.VALUE,prefix:!1,parse:function(t){if(Ut(t))return t.number;if(Dt(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},Ir={name:"font-variant",initialValue:"none",type:he.LIST,prefix:!1,parse:function(t){return t.filter(Dt).map((function(t){return t.value}))}};!function(t){t.NORMAL="normal",t.ITALIC="italic",t.OBLIQUE="oblique"}(br||(br={}));var Or,Mr={name:"font-style",initialValue:"normal",prefix:!1,type:he.IDENT_VALUE,parse:function(t){switch(t){case"oblique":return br.OBLIQUE;case"italic":return br.ITALIC;case"normal":default:return br.NORMAL}}},Lr=function(t,e){return 0!=(t&e)},kr={name:"content",initialValue:"none",type:he.LIST,prefix:!1,parse:function(t){if(0===t.length)return[];var e=t[0];return e.type===h.IDENT_TOKEN&&"none"===e.value?[]:t}},Br={name:"counter-increment",initialValue:"none",prefix:!0,type:he.LIST,parse:function(t){if(0===t.length)return null;var e=t[0];if(e.type===h.IDENT_TOKEN&&"none"===e.value)return null;for(var n=[],r=t.filter(jt),i=0;i<r.length;i++){var o=r[i],a=r[i+1];if(o.type===h.IDENT_TOKEN){var s=a&&Ut(a)?a.number:1;n.push({counter:o.value,increment:s})}}return n}},Nr={name:"counter-reset",initialValue:"none",prefix:!0,type:he.LIST,parse:function(t){if(0===t.length)return[];for(var e=[],n=t.filter(jt),r=0;r<n.length;r++){var i=n[r],o=n[r+1];if(Dt(i)&&"none"!==i.value){var a=o&&Ut(o)?o.number:0;e.push({counter:i.value,reset:a})}}return e}},Pr={name:"quotes",initialValue:"none",prefix:!0,type:he.LIST,parse:function(t){if(0===t.length)return null;var e=t[0];if(e.type===h.IDENT_TOKEN&&"none"===e.value)return null;var n=[],r=t.filter(Ft);if(r.length%2!=0)return null;for(var i=0;i<r.length;i+=2){var o=r[i].value,a=r[i+1].value;n.push({open:o,close:a})}return n}},Ur=function(t,e,n){if(!t)return"";var r=t[Math.min(e,t.length-1)];return r?n?r.open:r.close:""},Dr={name:"box-shadow",initialValue:"none",type:he.LIST,prefix:!1,parse:function(t){return 1===t.length&&Ht(t[0],"none")?[]:Gt(t).map((function(t){for(var e={color:255,offsetX:Kt,offsetY:Kt,blur:Kt,spread:Kt,inset:!1},n=0,r=0;r<t.length;r++){var i=t[r];Ht(i,"inset")?e.inset=!0:zt(i)?(0===n?e.offsetX=i:1===n?e.offsetY=i:2===n?e.blur=i:e.spread=i,n++):e.color=oe(i)}return e}))}},Fr=function(){function t(t){this.backgroundClip=Vr(Ae,t.backgroundClip),this.backgroundColor=Vr(ye,t.backgroundColor),this.backgroundImage=Vr(en,t.backgroundImage),this.backgroundOrigin=Vr(nn,t.backgroundOrigin),this.backgroundPosition=Vr(rn,t.backgroundPosition),this.backgroundRepeat=Vr(an,t.backgroundRepeat),this.backgroundSize=Vr(un,t.backgroundSize),this.borderTopColor=Vr(hn,t.borderTopColor),this.borderRightColor=Vr(fn,t.borderRightColor),this.borderBottomColor=Vr(pn,t.borderBottomColor),this.borderLeftColor=Vr(vn,t.borderLeftColor),this.borderTopLeftRadius=Vr(gn,t.borderTopLeftRadius),this.borderTopRightRadius=Vr(An,t.borderTopRightRadius),this.borderBottomRightRadius=Vr(yn,t.borderBottomRightRadius),this.borderBottomLeftRadius=Vr(bn,t.borderBottomLeftRadius),this.borderTopStyle=Vr(_n,t.borderTopStyle),this.borderRightStyle=Vr(Sn,t.borderRightStyle),this.borderBottomStyle=Vr(Tn,t.borderBottomStyle),this.borderLeftStyle=Vr(Cn,t.borderLeftStyle),this.borderTopWidth=Vr(Rn,t.borderTopWidth),this.borderRightWidth=Vr(In,t.borderRightWidth),this.borderBottomWidth=Vr(On,t.borderBottomWidth),this.borderLeftWidth=Vr(Mn,t.borderLeftWidth),this.boxShadow=Vr(Dr,t.boxShadow),this.color=Vr(Ln,t.color),this.display=Vr(kn,t.display),this.float=Vr(Pn,t.cssFloat),this.fontFamily=Vr(Cr,t.fontFamily),this.fontSize=Vr(xr,t.fontSize),this.fontStyle=Vr(Mr,t.fontStyle),this.fontVariant=Vr(Ir,t.fontVariant),this.fontWeight=Vr(Rr,t.fontWeight),this.letterSpacing=Vr(Un,t.letterSpacing),this.lineBreak=Vr(Fn,t.lineBreak),this.lineHeight=Vr(Hn,t.lineHeight),this.listStyleImage=Vr(jn,t.listStyleImage),this.listStylePosition=Vr(Gn,t.listStylePosition),this.listStyleType=Vr(zn,t.listStyleType),this.marginTop=Vr(Wn,t.marginTop),this.marginRight=Vr(Kn,t.marginRight),this.marginBottom=Vr(Xn,t.marginBottom),this.marginLeft=Vr(Jn,t.marginLeft),this.opacity=Vr(_r,t.opacity);var e=Vr($n,t.overflow);this.overflowX=e[0],this.overflowY=e[e.length>1?1:0],this.overflowWrap=Vr(tr,t.overflowWrap),this.paddingTop=Vr(nr,t.paddingTop),this.paddingRight=Vr(rr,t.paddingRight),this.paddingBottom=Vr(ir,t.paddingBottom),this.paddingLeft=Vr(or,t.paddingLeft),this.position=Vr(ur,t.position),this.textAlign=Vr(sr,t.textAlign),this.textDecorationColor=Vr(Sr,t.textDecorationColor||t.color),this.textDecorationLine=Vr(Tr,t.textDecorationLine),this.textShadow=Vr(lr,t.textShadow),this.textTransform=Vr(hr,t.textTransform),this.transform=Vr(fr,t.transform),this.transformOrigin=Vr(gr,t.transformOrigin),this.visibility=Vr(yr,t.visibility),this.wordBreak=Vr(wr,t.wordBreak),this.zIndex=Vr(Er,t.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===dr.VISIBLE},t.prototype.isTransparent=function(){return ae(this.backgroundColor)},t.prototype.isTransformed=function(){return null!==this.transform},t.prototype.isPositioned=function(){return this.position!==ar.STATIC},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return this.float!==wn.NONE},t.prototype.isInlineLevel=function(){return Lr(this.display,4)||Lr(this.display,33554432)||Lr(this.display,268435456)||Lr(this.display,536870912)||Lr(this.display,67108864)||Lr(this.display,134217728)},t}(),Hr=function(t){this.content=Vr(kr,t.content),this.quotes=Vr(Pr,t.quotes)},jr=function(t){this.counterIncrement=Vr(Br,t.counterIncrement),this.counterReset=Vr(Nr,t.counterReset)},Vr=function(t,e){var n=new Bt,r=null!=e?e.toString():t.initialValue;n.write(r);var i=new Nt(n.read());switch(t.type){case he.IDENT_VALUE:var o=i.parseComponentValue();return t.parse(Dt(o)?o.value:t.initialValue);case he.VALUE:return t.parse(i.parseComponentValue());case he.LIST:return t.parse(i.parseComponentValues());case he.TOKEN_VALUE:return i.parseComponentValue();case he.TYPE_VALUE:switch(t.format){case"angle":return ee(i.parseComponentValue());case"color":return oe(i.parseComponentValue());case"image":return $e(i.parseComponentValue());case"length":var a=i.parseComponentValue();return zt(a)?a:Kt;case"length-percentage":var s=i.parseComponentValue();return qt(s)?s:Kt}}throw new Error("Attempting to parse unsupported css format type "+t.format)},Gr=function(t){this.styles=new Fr(window.getComputedStyle(t,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&_i(t)&&(t.style.transform="none"),this.bounds=a(t),this.flags=0},Qr=function(t,e){this.text=t,this.bounds=e},zr=function(t){var e=t.ownerDocument;if(e){var n=e.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(n,t);var i=a(n);return n.firstChild&&r.replaceChild(n.firstChild,n),i}}return new o(0,0,0,0)},qr=function(t,e,n){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(t,e),i.setEnd(t,e+n),o.fromClientRect(i.getBoundingClientRect())},Wr=function(t,e){return 0!==e.letterSpacing?s(t).map((function(t){return c(t)})):Kr(t,e)},Kr=function(t,e){for(var n,r=function(t,e){var n=s(t),r=$(n,e),i=r[0],o=r[1],a=r[2],c=n.length,u=0,l=0;return{next:function(){if(l>=c)return{done:!0,value:null};for(var t=F;l<c&&(t=Y(n,o,i,++l,a))===F;);if(t!==F||l===c){var e=new Z(n,t,u,l);return u=l,{value:e,done:!1}}return{done:!0,value:null}}}}(t,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap===Yn.BREAK_WORD?"break-word":e.wordBreak}),i=[];!(n=r.next()).done;)n.value&&i.push(n.value.slice());return i},Xr=function(t,e){this.text=Jr(t.data,e.textTransform),this.textBounds=function(t,e,n){var r=Wr(t,e),i=[],o=0;return r.forEach((function(t){if(e.textDecorationLine.length||t.trim().length>0)if(Ie.SUPPORT_RANGE_BOUNDS)i.push(new Qr(t,qr(n,o,t.length)));else{var r=n.splitText(t.length);i.push(new Qr(t,zr(n))),n=r}else Ie.SUPPORT_RANGE_BOUNDS||(n=n.splitText(t.length));o+=t.length})),i}(this.text,e,t)},Jr=function(t,e){switch(e){case cr.LOWERCASE:return t.toLowerCase();case cr.CAPITALIZE:return t.replace(Yr,$r);case cr.UPPERCASE:return t.toUpperCase();default:return t}},Yr=/(^|\s|:|-|\(|\))([a-z])/g,$r=function(t,e,n){return t.length>0?e+n.toUpperCase():t},Zr=function(t){function n(e){var n=t.call(this,e)||this;return n.src=e.currentSrc||e.src,n.intrinsicWidth=e.naturalWidth,n.intrinsicHeight=e.naturalHeight,Me.getInstance().addImage(n.src),n}return e(n,t),n}(Gr),ti=function(t){function n(e){var n=t.call(this,e)||this;return n.canvas=e,n.intrinsicWidth=e.width,n.intrinsicHeight=e.height,n}return e(n,t),n}(Gr),ei=function(t){function n(e){var n=t.call(this,e)||this,r=new XMLSerializer;return n.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),n.intrinsicWidth=e.width.baseVal.value,n.intrinsicHeight=e.height.baseVal.value,Me.getInstance().addImage(n.svg),n}return e(n,t),n}(Gr),ni=function(t){function n(e){var n=t.call(this,e)||this;return n.value=e.value,n}return e(n,t),n}(Gr),ri=function(t){function n(e){var n=t.call(this,e)||this;return n.start=e.start,n.reversed="boolean"==typeof e.reversed&&!0===e.reversed,n}return e(n,t),n}(Gr),ii=[{type:h.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],oi=[{type:h.PERCENTAGE_TOKEN,flags:0,number:50}],ai="checkbox",si="radio",ci="password",ui=707406591,li=function(t){function n(e){var n,r,i,a=t.call(this,e)||this;switch(a.type=e.type.toLowerCase(),a.checked=e.checked,a.value=0===(r=(n=e).type===ci?new Array(n.value.length+1).join("•"):n.value).length?n.placeholder||"":r,a.type!==ai&&a.type!==si||(a.styles.backgroundColor=3739148031,a.styles.borderTopColor=a.styles.borderRightColor=a.styles.borderBottomColor=a.styles.borderLeftColor=2779096575,a.styles.borderTopWidth=a.styles.borderRightWidth=a.styles.borderBottomWidth=a.styles.borderLeftWidth=1,a.styles.borderTopStyle=a.styles.borderRightStyle=a.styles.borderBottomStyle=a.styles.borderLeftStyle=cn.SOLID,a.styles.backgroundClip=[fe.BORDER_BOX],a.styles.backgroundOrigin=[0],a.bounds=(i=a.bounds).width>i.height?new o(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new o(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i),a.type){case ai:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=ii;break;case si:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=oi}return a}return e(n,t),n}(Gr),di=function(t){function n(e){var n=t.call(this,e)||this,r=e.options[e.selectedIndex||0];return n.value=r&&r.text||"",n}return e(n,t),n}(Gr),hi=function(t){function n(e){var n=t.call(this,e)||this;return n.value=e.value,n}return e(n,t),n}(Gr),fi=function(t){return oe(Nt.create(t).parseComponentValue())},pi=function(t){function n(e){var n=t.call(this,e)||this;n.src=e.src,n.width=parseInt(e.width,10)||0,n.height=parseInt(e.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement){n.tree=Ai(e.contentWindow.document.documentElement);var r=e.contentWindow.document.documentElement?fi(getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):me.TRANSPARENT,i=e.contentWindow.document.body?fi(getComputedStyle(e.contentWindow.document.body).backgroundColor):me.TRANSPARENT;n.backgroundColor=ae(r)?ae(i)?n.styles.backgroundColor:i:r}}catch(t){}return n}return e(n,t),n}(Gr),vi=["OL","UL","MENU"],mi=function(t,e,n){for(var r=t.firstChild,i=void 0;r;r=i)if(i=r.nextSibling,wi(r)&&r.data.trim().length>0)e.textNodes.push(new Xr(r,e.styles));else if(Ei(r)){var o=gi(r);o.styles.isVisible()&&(yi(r,o,n)?o.flags|=4:bi(o.styles)&&(o.flags|=2),-1!==vi.indexOf(r.tagName)&&(o.flags|=8),e.elements.push(o),Ni(r)||Ri(r)||Pi(r)||mi(r,o,n))}},gi=function(t){return Mi(t)?new Zr(t):Oi(t)?new ti(t):Ri(t)?new ei(t):Ti(t)?new ni(t):Ci(t)?new ri(t):xi(t)?new li(t):Pi(t)?new di(t):Ni(t)?new hi(t):Li(t)?new pi(t):new Gr(t)},Ai=function(t){var e=gi(t);return e.flags|=4,mi(t,e,e),e},yi=function(t,e,n){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Ii(t)&&n.styles.isTransparent()},bi=function(t){return t.isPositioned()||t.isFloating()},wi=function(t){return t.nodeType===Node.TEXT_NODE},Ei=function(t){return t.nodeType===Node.ELEMENT_NODE},_i=function(t){return Ei(t)&&void 0!==t.style&&!Si(t)},Si=function(t){return"object"==typeof t.className},Ti=function(t){return"LI"===t.tagName},Ci=function(t){return"OL"===t.tagName},xi=function(t){return"INPUT"===t.tagName},Ri=function(t){return"svg"===t.tagName},Ii=function(t){return"BODY"===t.tagName},Oi=function(t){return"CANVAS"===t.tagName},Mi=function(t){return"IMG"===t.tagName},Li=function(t){return"IFRAME"===t.tagName},ki=function(t){return"STYLE"===t.tagName},Bi=function(t){return"SCRIPT"===t.tagName},Ni=function(t){return"TEXTAREA"===t.tagName},Pi=function(t){return"SELECT"===t.tagName},Ui=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},t.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},t.prototype.pop=function(t){var e=this;t.forEach((function(t){return e.counters[t].pop()}))},t.prototype.parse=function(t){var e=this,n=t.counterIncrement,r=t.counterReset,i=!0;null!==n&&n.forEach((function(t){var n=e.counters[t.counter];n&&0!==t.increment&&(i=!1,n[Math.max(0,n.length-1)]+=t.increment)}));var o=[];return i&&r.forEach((function(t){var n=e.counters[t.counter];o.push(t.counter),n||(n=e.counters[t.counter]=[]),n.push(t.reset)})),o},t}(),Di={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Fi={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Hi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},ji={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Vi=function(t,e,n,r,i,o){return t<e||t>n?Yi(t,i,o.length>0):r.integers.reduce((function(e,n,i){for(;t>=n;)t-=n,e+=r.values[i];return e}),"")+o},Gi=function(t,e,n,r){var i="";do{n||t--,i=r(t)+i,t/=e}while(t*e>=e);return i},Qi=function(t,e,n,r,i){var o=n-e+1;return(t<0?"-":"")+(Gi(Math.abs(t),o,r,(function(t){return c(Math.floor(t%o)+e)}))+i)},zi=function(t,e,n){void 0===n&&(n=". ");var r=e.length;return Gi(Math.abs(t),r,!1,(function(t){return e[Math.floor(t%r)]}))+n},qi=function(t,e,n,r,i,o){if(t<-9999||t>9999)return Yi(t,Vn.CJK_DECIMAL,i.length>0);var a=Math.abs(t),s=i;if(0===a)return e[0]+s;for(var c=0;a>0&&c<=4;c++){var u=a%10;0===u&&Lr(o,1)&&""!==s?s=e[u]+s:u>1||1===u&&0===c||1===u&&1===c&&Lr(o,2)||1===u&&1===c&&Lr(o,4)&&t>100||1===u&&c>1&&Lr(o,8)?s=e[u]+(c>0?n[c-1]:"")+s:1===u&&c>0&&(s=n[c-1]+s),a=Math.floor(a/10)}return(t<0?r:"")+s},Wi="十百千萬",Ki="拾佰仟萬",Xi="マイナス",Ji="마이너스",Yi=function(t,e,n){var r=n?". ":"",i=n?"、":"",o=n?", ":"",a=n?" ":"";switch(e){case Vn.DISC:return"•"+a;case Vn.CIRCLE:return"◦"+a;case Vn.SQUARE:return"◾"+a;case Vn.DECIMAL_LEADING_ZERO:var s=Qi(t,48,57,!0,r);return s.length<4?"0"+s:s;case Vn.CJK_DECIMAL:return zi(t,"〇一二三四五六七八九",i);case Vn.LOWER_ROMAN:return Vi(t,1,3999,Di,Vn.DECIMAL,r).toLowerCase();case Vn.UPPER_ROMAN:return Vi(t,1,3999,Di,Vn.DECIMAL,r);case Vn.LOWER_GREEK:return Qi(t,945,969,!1,r);case Vn.LOWER_ALPHA:return Qi(t,97,122,!1,r);case Vn.UPPER_ALPHA:return Qi(t,65,90,!1,r);case Vn.ARABIC_INDIC:return Qi(t,1632,1641,!0,r);case Vn.ARMENIAN:case Vn.UPPER_ARMENIAN:return Vi(t,1,9999,Fi,Vn.DECIMAL,r);case Vn.LOWER_ARMENIAN:return Vi(t,1,9999,Fi,Vn.DECIMAL,r).toLowerCase();case Vn.BENGALI:return Qi(t,2534,2543,!0,r);case Vn.CAMBODIAN:case Vn.KHMER:return Qi(t,6112,6121,!0,r);case Vn.CJK_EARTHLY_BRANCH:return zi(t,"子丑寅卯辰巳午未申酉戌亥",i);case Vn.CJK_HEAVENLY_STEM:return zi(t,"甲乙丙丁戊己庚辛壬癸",i);case Vn.CJK_IDEOGRAPHIC:case Vn.TRAD_CHINESE_INFORMAL:return qi(t,"零一二三四五六七八九",Wi,"負",i,14);case Vn.TRAD_CHINESE_FORMAL:return qi(t,"零壹貳參肆伍陸柒捌玖",Ki,"負",i,15);case Vn.SIMP_CHINESE_INFORMAL:return qi(t,"零一二三四五六七八九",Wi,"负",i,14);case Vn.SIMP_CHINESE_FORMAL:return qi(t,"零壹贰叁肆伍陆柒捌玖",Ki,"负",i,15);case Vn.JAPANESE_INFORMAL:return qi(t,"〇一二三四五六七八九","十百千万",Xi,i,0);case Vn.JAPANESE_FORMAL:return qi(t,"零壱弐参四伍六七八九","拾百千万",Xi,i,7);case Vn.KOREAN_HANGUL_FORMAL:return qi(t,"영일이삼사오육칠팔구","십백천만",Ji,o,7);case Vn.KOREAN_HANJA_INFORMAL:return qi(t,"零一二三四五六七八九","十百千萬",Ji,o,0);case Vn.KOREAN_HANJA_FORMAL:return qi(t,"零壹貳參四五六七八九","拾百千",Ji,o,7);case Vn.DEVANAGARI:return Qi(t,2406,2415,!0,r);case Vn.GEORGIAN:return Vi(t,1,19999,ji,Vn.DECIMAL,r);case Vn.GUJARATI:return Qi(t,2790,2799,!0,r);case Vn.GURMUKHI:return Qi(t,2662,2671,!0,r);case Vn.HEBREW:return Vi(t,1,10999,Hi,Vn.DECIMAL,r);case Vn.HIRAGANA:return zi(t,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case Vn.HIRAGANA_IROHA:return zi(t,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case Vn.KANNADA:return Qi(t,3302,3311,!0,r);case Vn.KATAKANA:return zi(t,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case Vn.KATAKANA_IROHA:return zi(t,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case Vn.LAO:return Qi(t,3792,3801,!0,r);case Vn.MONGOLIAN:return Qi(t,6160,6169,!0,r);case Vn.MYANMAR:return Qi(t,4160,4169,!0,r);case Vn.ORIYA:return Qi(t,2918,2927,!0,r);case Vn.PERSIAN:return Qi(t,1776,1785,!0,r);case Vn.TAMIL:return Qi(t,3046,3055,!0,r);case Vn.TELUGU:return Qi(t,3174,3183,!0,r);case Vn.THAI:return Qi(t,3664,3673,!0,r);case Vn.TIBETAN:return Qi(t,3872,3881,!0,r);case Vn.DECIMAL:default:return Qi(t,48,57,!0,r)}},$i="data-html2canvas-ignore",Zi=function(){function t(t,e){if(this.options=e,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ui,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement)}return t.prototype.toIFrame=function(t,e){var n=this,o=eo(t,e);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var a=t.defaultView.pageXOffset,s=t.defaultView.pageYOffset,c=o.contentWindow,u=c.document,l=no(o).then((function(){return r(n,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.scrolledElements.forEach(ao),c&&(c.scrollTo(e.left,e.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||c.scrollY===e.top&&c.scrollX===e.left||(u.documentElement.style.top=-e.top+"px",u.documentElement.style.left=-e.left+"px",u.documentElement.style.position="absolute")),t=this.options.onclone,void 0===this.clonedReferenceElement?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:n.sent(),n.label=2;case 2:return"function"==typeof t?[2,Promise.resolve().then((function(){return t(u)})).then((function(){return o}))]:[2,o]}}))}))}));return u.open(),u.write(io(document.doctype)+"<html></html>"),oo(this.referenceElement.ownerDocument,a,s),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),l},t.prototype.createElementClone=function(t){if(Oi(t))return this.createCanvasClone(t);if(ki(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return Mi(e)&&"lazy"===e.loading&&(e.loading="eager"),e},t.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce((function(t,e){return e&&"string"==typeof e.cssText?t+e.cssText:t}),""),r=t.cloneNode(!1);return r.textContent=n,r}}catch(t){if(Oe.getInstance(this.options.id).error("Unable to access cssRules property",t),"SecurityError"!==t.name)throw t}return t.cloneNode(!1)},t.prototype.createCanvasClone=function(t){if(this.options.inlineImages&&t.ownerDocument){var e=t.ownerDocument.createElement("img");try{return e.src=t.toDataURL(),e}catch(t){Oe.getInstance(this.options.id).info("Unable to clone canvas contents, canvas is tainted")}}var n=t.cloneNode(!1);try{n.width=t.width,n.height=t.height;var r=t.getContext("2d"),i=n.getContext("2d");return i&&(r?i.putImageData(r.getImageData(0,0,t.width,t.height),0,0):i.drawImage(t,0,0)),n}catch(t){}return n},t.prototype.cloneNode=function(t){if(wi(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var e=t.ownerDocument.defaultView;if(e&&Ei(t)&&(_i(t)||Si(t))){var n=this.createElementClone(t),r=e.getComputedStyle(t),i=e.getComputedStyle(t,":before"),o=e.getComputedStyle(t,":after");this.referenceElement===t&&_i(n)&&(this.clonedReferenceElement=n),Ii(n)&&lo(n);for(var a=this.counters.parse(new jr(r)),s=this.resolvePseudoContent(t,n,i,Or.BEFORE),c=t.firstChild;c;c=c.nextSibling)Ei(c)&&(Bi(c)||c.hasAttribute($i)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(c))||this.options.copyStyles&&Ei(c)&&ki(c)||n.appendChild(this.cloneNode(c));s&&n.insertBefore(s,n.firstChild);var u=this.resolvePseudoContent(t,n,o,Or.AFTER);return u&&n.appendChild(u),this.counters.pop(a),r&&(this.options.copyStyles||Si(t))&&!Li(t)&&ro(r,n),0===t.scrollTop&&0===t.scrollLeft||this.scrolledElements.push([n,t.scrollLeft,t.scrollTop]),(Ni(t)||Pi(t))&&(Ni(n)||Pi(n))&&(n.value=t.value),n}return t.cloneNode(!1)},t.prototype.resolvePseudoContent=function(t,e,n,r){var i=this;if(n){var o=n.content,a=e.ownerDocument;if(a&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==n.display){this.counters.parse(new jr(n));var s=new Hr(n),c=a.createElement("html2canvaspseudoelement");ro(n,c),s.content.forEach((function(e){if(e.type===h.STRING_TOKEN)c.appendChild(a.createTextNode(e.value));else if(e.type===h.URL_TOKEN){var n=a.createElement("img");n.src=e.value,n.style.opacity="1",c.appendChild(n)}else if(e.type===h.FUNCTION){if("attr"===e.name){var r=e.values.filter(Dt);r.length&&c.appendChild(a.createTextNode(t.getAttribute(r[0].value)||""))}else if("counter"===e.name){var o=e.values.filter(Vt),u=o[0],l=o[1];if(u&&Dt(u)){var d=i.counters.getCounterValue(u.value),f=l&&Dt(l)?zn.parse(l.value):Vn.DECIMAL;c.appendChild(a.createTextNode(Yi(d,f,!1)))}}else if("counters"===e.name){var p=e.values.filter(Vt),v=(u=p[0],p[1]);l=p[2];if(u&&Dt(u)){var m=i.counters.getCounterValues(u.value),g=l&&Dt(l)?zn.parse(l.value):Vn.DECIMAL,A=v&&v.type===h.STRING_TOKEN?v.value:"",y=m.map((function(t){return Yi(t,g,!1)})).join(A);c.appendChild(a.createTextNode(y))}}}else if(e.type===h.IDENT_TOKEN)switch(e.value){case"open-quote":c.appendChild(a.createTextNode(Ur(s.quotes,i.quoteDepth++,!0)));break;case"close-quote":c.appendChild(a.createTextNode(Ur(s.quotes,--i.quoteDepth,!1)));break;default:c.appendChild(a.createTextNode(e.value))}})),c.className=so+" "+co;var u=r===Or.BEFORE?" "+so:" "+co;return Si(e)?e.className.baseValue+=u:e.className+=u,c}}},t.destroy=function(t){return!!t.parentNode&&(t.parentNode.removeChild(t),!0)},t}();!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"}(Or||(Or={}));var to,eo=function(t,e){var n=t.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=e.width.toString(),n.height=e.height.toString(),n.scrolling="no",n.setAttribute($i,"true"),t.body.appendChild(n),n},no=function(t){return new Promise((function(e,n){var r=t.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=t.onload=i.onreadystatechange=function(){r.onload=t.onload=i.onreadystatechange=null;var n=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),e(t))}),50)}}))},ro=function(t,e){for(var n=t.length-1;n>=0;n--){var r=t.item(n);"content"!==r&&e.style.setProperty(r,t.getPropertyValue(r))}return e},io=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},oo=function(t,e,n){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||n!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,n)},ao=function(t){var e=t[0],n=t[1],r=t[2];e.scrollLeft=n,e.scrollTop=r},so="___html2canvas___pseudoelement_before",co="___html2canvas___pseudoelement_after",uo='{\n    content: "" !important;\n    display: none !important;\n}',lo=function(t){ho(t,"."+so+":before"+uo+"\n         ."+co+":after"+uo)},ho=function(t,e){var n=t.ownerDocument;if(n){var r=n.createElement("style");r.textContent=e,t.appendChild(r)}};!function(t){t[t.VECTOR=0]="VECTOR",t[t.BEZIER_CURVE=1]="BEZIER_CURVE"}(to||(to={}));var fo,po=function(t,e){return t.length===e.length&&t.some((function(t,n){return t===e[n]}))},vo=function(){function t(t,e){this.type=to.VECTOR,this.x=t,this.y=e}return t.prototype.add=function(e,n){return new t(this.x+e,this.y+n)},t}(),mo=function(t,e,n){return new vo(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n)},go=function(){function t(t,e,n,r){this.type=to.BEZIER_CURVE,this.start=t,this.startControl=e,this.endControl=n,this.end=r}return t.prototype.subdivide=function(e,n){var r=mo(this.start,this.startControl,e),i=mo(this.startControl,this.endControl,e),o=mo(this.endControl,this.end,e),a=mo(r,i,e),s=mo(i,o,e),c=mo(a,s,e);return n?new t(this.start,r,a,c):new t(c,s,o,this.end)},t.prototype.add=function(e,n){return new t(this.start.add(e,n),this.startControl.add(e,n),this.endControl.add(e,n),this.end.add(e,n))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Ao=function(t){return t.type===to.BEZIER_CURVE},yo=function(t){var e=t.styles,n=t.bounds,r=Yt(e.borderTopLeftRadius,n.width,n.height),i=r[0],o=r[1],a=Yt(e.borderTopRightRadius,n.width,n.height),s=a[0],c=a[1],u=Yt(e.borderBottomRightRadius,n.width,n.height),l=u[0],d=u[1],h=Yt(e.borderBottomLeftRadius,n.width,n.height),f=h[0],p=h[1],v=[];v.push((i+s)/n.width),v.push((f+l)/n.width),v.push((o+p)/n.height),v.push((c+d)/n.height);var m=Math.max.apply(Math,v);m>1&&(i/=m,o/=m,s/=m,c/=m,l/=m,d/=m,f/=m,p/=m);var g=n.width-s,A=n.height-d,y=n.width-l,b=n.height-p,w=e.borderTopWidth,E=e.borderRightWidth,_=e.borderBottomWidth,S=e.borderLeftWidth,T=$t(e.paddingTop,t.bounds.width),C=$t(e.paddingRight,t.bounds.width),x=$t(e.paddingBottom,t.bounds.width),R=$t(e.paddingLeft,t.bounds.width);this.topLeftBorderBox=i>0||o>0?bo(n.left,n.top,i,o,fo.TOP_LEFT):new vo(n.left,n.top),this.topRightBorderBox=s>0||c>0?bo(n.left+g,n.top,s,c,fo.TOP_RIGHT):new vo(n.left+n.width,n.top),this.bottomRightBorderBox=l>0||d>0?bo(n.left+y,n.top+A,l,d,fo.BOTTOM_RIGHT):new vo(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=f>0||p>0?bo(n.left,n.top+b,f,p,fo.BOTTOM_LEFT):new vo(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||o>0?bo(n.left+S,n.top+w,Math.max(0,i-S),Math.max(0,o-w),fo.TOP_LEFT):new vo(n.left+S,n.top+w),this.topRightPaddingBox=s>0||c>0?bo(n.left+Math.min(g,n.width+S),n.top+w,g>n.width+S?0:s-S,c-w,fo.TOP_RIGHT):new vo(n.left+n.width-E,n.top+w),this.bottomRightPaddingBox=l>0||d>0?bo(n.left+Math.min(y,n.width-S),n.top+Math.min(A,n.height+w),Math.max(0,l-E),d-_,fo.BOTTOM_RIGHT):new vo(n.left+n.width-E,n.top+n.height-_),this.bottomLeftPaddingBox=f>0||p>0?bo(n.left+S,n.top+b,Math.max(0,f-S),p-_,fo.BOTTOM_LEFT):new vo(n.left+S,n.top+n.height-_),this.topLeftContentBox=i>0||o>0?bo(n.left+S+R,n.top+w+T,Math.max(0,i-(S+R)),Math.max(0,o-(w+T)),fo.TOP_LEFT):new vo(n.left+S+R,n.top+w+T),this.topRightContentBox=s>0||c>0?bo(n.left+Math.min(g,n.width+S+R),n.top+w+T,g>n.width+S+R?0:s-S+R,c-(w+T),fo.TOP_RIGHT):new vo(n.left+n.width-(E+C),n.top+w+T),this.bottomRightContentBox=l>0||d>0?bo(n.left+Math.min(y,n.width-(S+R)),n.top+Math.min(A,n.height+w+T),Math.max(0,l-(E+C)),d-(_+x),fo.BOTTOM_RIGHT):new vo(n.left+n.width-(E+C),n.top+n.height-(_+x)),this.bottomLeftContentBox=f>0||p>0?bo(n.left+S+R,n.top+b,Math.max(0,f-(S+R)),p-(_+x),fo.BOTTOM_LEFT):new vo(n.left+S+R,n.top+n.height-(_+x))};!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(fo||(fo={}));var bo=function(t,e,n,r,i){var o=(Math.sqrt(2)-1)/3*4,a=n*o,s=r*o,c=t+n,u=e+r;switch(i){case fo.TOP_LEFT:return new go(new vo(t,u),new vo(t,u-s),new vo(c-a,e),new vo(c,e));case fo.TOP_RIGHT:return new go(new vo(t,e),new vo(t+a,e),new vo(c,u-s),new vo(c,u));case fo.BOTTOM_RIGHT:return new go(new vo(c,e),new vo(c,e+s),new vo(t+a,u),new vo(t,u));case fo.BOTTOM_LEFT:default:return new go(new vo(c,u),new vo(c-a,u),new vo(t,e+s),new vo(t,e))}},wo=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},Eo=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},_o=function(t,e,n){this.type=0,this.offsetX=t,this.offsetY=e,this.matrix=n,this.target=6},So=function(t,e){this.type=1,this.target=e,this.path=t},To=function(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Co=function(){function t(t,e){if(this.container=t,this.effects=e.slice(0),this.curves=new yo(t),null!==t.styles.transform){var n=t.bounds.left+t.styles.transformOrigin[0].number,r=t.bounds.top+t.styles.transformOrigin[1].number,i=t.styles.transform;this.effects.push(new _o(n,r,i))}if(t.styles.overflowX!==Qn.VISIBLE){var o=wo(this.curves),a=Eo(this.curves);po(o,a)?this.effects.push(new So(o,6)):(this.effects.push(new So(o,2)),this.effects.push(new So(a,4)))}}return t.prototype.getParentEffects=function(){var t=this.effects.slice(0);if(this.container.styles.overflowX!==Qn.VISIBLE){var e=wo(this.curves),n=Eo(this.curves);po(e,n)||t.push(new So(n,6))}return t},t}(),xo=function(t,e,n,r){t.container.elements.forEach((function(i){var o=Lr(i.flags,4),a=Lr(i.flags,2),s=new Co(i,t.getParentEffects());Lr(i.styles.display,2048)&&r.push(s);var c=Lr(i.flags,8)?[]:r;if(o||a){var u=o||i.styles.isPositioned()?n:e,l=new To(s);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var d=i.styles.zIndex.order;if(d<0){var h=0;u.negativeZIndex.some((function(t,e){return d>t.element.container.styles.zIndex.order?(h=e,!1):h>0})),u.negativeZIndex.splice(h,0,l)}else if(d>0){var f=0;u.positiveZIndex.some((function(t,e){return d>=t.element.container.styles.zIndex.order?(f=e+1,!1):f>0})),u.positiveZIndex.splice(f,0,l)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(l)}else i.styles.isFloating()?u.nonPositionedFloats.push(l):u.nonPositionedInlineLevel.push(l);xo(s,l,o?l:n,c)}else i.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),xo(s,e,n,c);Lr(i.flags,8)&&Ro(i,c)}))},Ro=function(t,e){for(var n=t instanceof ri?t.start:1,r=t instanceof ri&&t.reversed,i=0;i<e.length;i++){var o=e[i];o.container instanceof ni&&"number"==typeof o.container.value&&0!==o.container.value&&(n=o.container.value),o.listValue=Yi(n,o.container.styles.listStyleType,!0),n+=r?-1:1}},Io=function(t,e,n,r){var i=[];return Ao(t)?i.push(t.subdivide(.5,!1)):i.push(t),Ao(n)?i.push(n.subdivide(.5,!0)):i.push(n),Ao(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),Ao(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},Oo=function(t){var e=t.bounds,n=t.styles;return e.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},Mo=function(t){var e=t.styles,n=t.bounds,r=$t(e.paddingLeft,n.width),i=$t(e.paddingRight,n.width),o=$t(e.paddingTop,n.width),a=$t(e.paddingBottom,n.width);return n.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+i),-(e.borderTopWidth+e.borderBottomWidth+o+a))},Lo=function(t,e,n){var r=function(t,e){return 0===t?e.bounds:2===t?Mo(e):Oo(e)}(Po(t.styles.backgroundOrigin,e),t),i=function(t,e){return t===fe.BORDER_BOX?e.bounds:t===fe.CONTENT_BOX?Mo(e):Oo(e)}(Po(t.styles.backgroundClip,e),t),o=No(Po(t.styles.backgroundSize,e),n,r),a=o[0],s=o[1],c=Yt(Po(t.styles.backgroundPosition,e),r.width-a,r.height-s);return[Uo(Po(t.styles.backgroundRepeat,e),c,o,r,i),Math.round(r.left+c[0]),Math.round(r.top+c[1]),a,s]},ko=function(t){return Dt(t)&&t.value===on.AUTO},Bo=function(t){return"number"==typeof t},No=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=t[0],s=t[1];if(qt(a)&&s&&qt(s))return[$t(a,n.width),$t(s,n.height)];var c=Bo(o);if(Dt(a)&&(a.value===on.CONTAIN||a.value===on.COVER))return Bo(o)?n.width/n.height<o!=(a.value===on.COVER)?[n.width,n.width/o]:[n.height*o,n.height]:[n.width,n.height];var u=Bo(r),l=Bo(i),d=u||l;if(ko(a)&&(!s||ko(s)))return u&&l?[r,i]:c||d?d&&c?[u?r:i*o,l?i:r/o]:[u?r:n.width,l?i:n.height]:[n.width,n.height];if(c){var h=0,f=0;return qt(a)?h=$t(a,n.width):qt(s)&&(f=$t(s,n.height)),ko(a)?h=f*o:s&&!ko(s)||(f=h/o),[h,f]}var p=null,v=null;if(qt(a)?p=$t(a,n.width):s&&qt(s)&&(v=$t(s,n.height)),null===p||s&&!ko(s)||(v=u&&l?p/r*i:n.height),null!==v&&ko(a)&&(p=u&&l?v/i*r:n.width),null!==p&&null!==v)return[p,v];throw new Error("Unable to calculate background-size for element")},Po=function(t,e){var n=t[e];return void 0===n?t[0]:n},Uo=function(t,e,n,r,i){var o=e[0],a=e[1],s=n[0],c=n[1];switch(t){case Ze.REPEAT_X:return[new vo(Math.round(r.left),Math.round(r.top+a)),new vo(Math.round(r.left+r.width),Math.round(r.top+a)),new vo(Math.round(r.left+r.width),Math.round(c+r.top+a)),new vo(Math.round(r.left),Math.round(c+r.top+a))];case Ze.REPEAT_Y:return[new vo(Math.round(r.left+o),Math.round(r.top)),new vo(Math.round(r.left+o+s),Math.round(r.top)),new vo(Math.round(r.left+o+s),Math.round(r.height+r.top)),new vo(Math.round(r.left+o),Math.round(r.height+r.top))];case Ze.NO_REPEAT:return[new vo(Math.round(r.left+o),Math.round(r.top+a)),new vo(Math.round(r.left+o+s),Math.round(r.top+a)),new vo(Math.round(r.left+o+s),Math.round(r.top+a+c)),new vo(Math.round(r.left+o),Math.round(r.top+a+c))];default:return[new vo(Math.round(i.left),Math.round(i.top)),new vo(Math.round(i.left+i.width),Math.round(i.top)),new vo(Math.round(i.left+i.width),Math.round(i.height+i.top)),new vo(Math.round(i.left),Math.round(i.height+i.top))]}},Do="Hidden Text",Fo=function(){function t(t){this._data={},this._document=t}return t.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",o.appendChild(n),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(Do)),n.appendChild(i),n.appendChild(r);var a=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode(Do)),n.style.lineHeight="normal",r.style.verticalAlign="super";var s=r.offsetTop-n.offsetTop+2;return o.removeChild(n),{baseline:a,middle:s}},t.prototype.getMetrics=function(t,e){var n=t+" "+e;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},t}(),Ho=function(){function t(t){this._activeEffects=[],this.canvas=t.canvas?t.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=t,t.canvas||(this.canvas.width=Math.floor(t.width*t.scale),this.canvas.height=Math.floor(t.height*t.scale),this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px"),this.fontMetrics=new Fo(document),this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-t.x+t.scrollX,-t.y+t.scrollY),this.ctx.textBaseline="bottom",this._activeEffects=[],Oe.getInstance(t.id).debug("Canvas renderer initialized ("+t.width+"x"+t.height+" at "+t.x+","+t.y+") with scale "+t.scale)}return t.prototype.applyEffects=function(t,e){for(var n=this;this._activeEffects.length;)this.popEffect();t.filter((function(t){return Lr(t.target,e)})).forEach((function(t){return n.applyEffect(t)}))},t.prototype.applyEffect=function(t){this.ctx.save(),function(t){return 0===t.type}(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),function(t){return 1===t.type}(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=t.element.container.styles).isVisible()?(this.ctx.globalAlpha=e.opacity,[4,this.renderStackContent(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.renderNode=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.renderTextWithLetterSpacing=function(t,e){var n=this;0===e?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+t.bounds.height):s(t.text).map((function(t){return c(t)})).reduce((function(e,r){return n.ctx.fillText(r,e,t.bounds.top+t.bounds.height),e+n.ctx.measureText(r).width}),t.bounds.left)},t.prototype.createFontStyle=function(t){var e=t.fontVariant.filter((function(t){return"normal"===t||"small-caps"===t})).join(""),n=t.fontFamily.join(", "),r=Pt(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,e,t.fontWeight,r,n].join(" "),n,r]},t.prototype.renderTextNode=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,a,s=this;return i(this,(function(i){return n=this.createFontStyle(e),r=n[0],o=n[1],a=n[2],this.ctx.font=r,t.textBounds.forEach((function(t){s.ctx.fillStyle=se(e.color),s.renderTextWithLetterSpacing(t,e.letterSpacing);var n=e.textShadow;n.length&&t.text.trim().length&&(n.slice(0).reverse().forEach((function(e){s.ctx.shadowColor=se(e.color),s.ctx.shadowOffsetX=e.offsetX.number*s.options.scale,s.ctx.shadowOffsetY=e.offsetY.number*s.options.scale,s.ctx.shadowBlur=e.blur.number,s.ctx.fillText(t.text,t.bounds.left,t.bounds.top+t.bounds.height)})),s.ctx.shadowColor="",s.ctx.shadowOffsetX=0,s.ctx.shadowOffsetY=0,s.ctx.shadowBlur=0),e.textDecorationLine.length&&(s.ctx.fillStyle=se(e.textDecorationColor||e.color),e.textDecorationLine.forEach((function(e){switch(e){case 1:var n=s.fontMetrics.getMetrics(o,a).baseline;s.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+n),t.bounds.width,1);break;case 2:s.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:var r=s.fontMetrics.getMetrics(o,a).middle;s.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+r),t.bounds.width,1)}})))})),[2]}))}))},t.prototype.renderReplacedElement=function(t,e,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var r=Mo(t),i=Eo(e);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var n,r,a,s,c,u,l,d,f,p,v,m,g,A;return i(this,(function(i){switch(i.label){case 0:this.applyEffects(e.effects,4),n=e.container,r=e.curves,a=n.styles,s=0,c=n.textNodes,i.label=1;case 1:return s<c.length?(u=c[s],[4,this.renderTextNode(u,a)]):[3,4];case 2:i.sent(),i.label=3;case 3:return s++,[3,1];case 4:if(!(n instanceof Zr))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.options.cache.match(n.src)];case 6:return m=i.sent(),this.renderReplacedElement(n,r,m),[3,8];case 7:return i.sent(),Oe.getInstance(this.options.id).error("Error loading image "+n.src),[3,8];case 8:if(n instanceof ti&&this.renderReplacedElement(n,r,n.canvas),!(n instanceof ei))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.options.cache.match(n.svg)];case 10:return m=i.sent(),this.renderReplacedElement(n,r,m),[3,12];case 11:return i.sent(),Oe.getInstance(this.options.id).error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof pi&&n.tree?[4,new t({id:this.options.id,scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,scrollX:0,scrollY:0,width:n.width,height:n.height,cache:this.options.cache,windowWidth:n.width,windowHeight:n.height}).render(n.tree)]:[3,14];case 13:l=i.sent(),n.width&&n.height&&this.ctx.drawImage(l,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),i.label=14;case 14:if(n instanceof li&&(d=Math.min(n.bounds.width,n.bounds.height),n.type===ai?n.checked&&(this.ctx.save(),this.path([new vo(n.bounds.left+.39363*d,n.bounds.top+.79*d),new vo(n.bounds.left+.16*d,n.bounds.top+.5549*d),new vo(n.bounds.left+.27347*d,n.bounds.top+.44071*d),new vo(n.bounds.left+.39694*d,n.bounds.top+.5649*d),new vo(n.bounds.left+.72983*d,n.bounds.top+.23*d),new vo(n.bounds.left+.84*d,n.bounds.top+.34085*d),new vo(n.bounds.left+.39363*d,n.bounds.top+.79*d)]),this.ctx.fillStyle=se(ui),this.ctx.fill(),this.ctx.restore()):n.type===si&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+d/2,n.bounds.top+d/2,d/4,0,2*Math.PI,!0),this.ctx.fillStyle=se(ui),this.ctx.fill(),this.ctx.restore())),jo(n)&&n.value.length){switch(this.ctx.font=this.createFontStyle(a)[0],this.ctx.fillStyle=se(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign=Go(n.styles.textAlign),A=Mo(n),f=0,n.styles.textAlign){case Zn.CENTER:f+=A.width/2;break;case Zn.RIGHT:f+=A.width}p=A.add(f,0,0,-A.height/2+1),this.ctx.save(),this.path([new vo(A.left,A.top),new vo(A.left+A.width,A.top),new vo(A.left+A.width,A.top+A.height),new vo(A.left,A.top+A.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Qr(n.value,p),a.letterSpacing),this.ctx.restore(),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"}if(!Lr(n.styles.display,2048))return[3,20];if(null===n.styles.listStyleImage)return[3,19];if((v=n.styles.listStyleImage).type!==ge.URL)return[3,18];m=void 0,g=v.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.options.cache.match(g)];case 16:return m=i.sent(),this.ctx.drawImage(m,n.bounds.left-(m.width+10),n.bounds.top),[3,18];case 17:return i.sent(),Oe.getInstance(this.options.id).error("Error loading list-style-image "+g),[3,18];case 18:return[3,20];case 19:e.listValue&&n.styles.listStyleType!==Vn.NONE&&(this.ctx.font=this.createFontStyle(a)[0],this.ctx.fillStyle=se(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",A=new o(n.bounds.left,n.bounds.top+$t(n.styles.paddingTop,n.bounds.width),n.bounds.width,function(t,e){return Dt(t)&&"normal"===t.value?1.2*e:t.type===h.NUMBER_TOKEN?e*t.number:qt(t)?$t(t,e):e}(a.lineHeight,a.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Qr(e.listValue,A),a.letterSpacing),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}}))}))},t.prototype.renderStackContent=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,a,s,c,u,l,d,h,f,p,v,m;return i(this,(function(i){switch(i.label){case 0:return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:i.sent(),e=0,n=t.negativeZIndex,i.label=2;case 2:return e<n.length?(m=n[e],[4,this.renderStack(m)]):[3,5];case 3:i.sent(),i.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:i.sent(),r=0,o=t.nonInlineLevel,i.label=7;case 7:return r<o.length?(m=o[r],[4,this.renderNode(m)]):[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:a=0,s=t.nonPositionedFloats,i.label=11;case 11:return a<s.length?(m=s[a],[4,this.renderStack(m)]):[3,14];case 12:i.sent(),i.label=13;case 13:return a++,[3,11];case 14:c=0,u=t.nonPositionedInlineLevel,i.label=15;case 15:return c<u.length?(m=u[c],[4,this.renderStack(m)]):[3,18];case 16:i.sent(),i.label=17;case 17:return c++,[3,15];case 18:l=0,d=t.inlineLevel,i.label=19;case 19:return l<d.length?(m=d[l],[4,this.renderNode(m)]):[3,22];case 20:i.sent(),i.label=21;case 21:return l++,[3,19];case 22:h=0,f=t.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return h<f.length?(m=f[h],[4,this.renderStack(m)]):[3,26];case 24:i.sent(),i.label=25;case 25:return h++,[3,23];case 26:p=0,v=t.positiveZIndex,i.label=27;case 27:return p<v.length?(m=v[p],[4,this.renderStack(m)]):[3,30];case 28:i.sent(),i.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},t.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},t.prototype.formatPath=function(t){var e=this;t.forEach((function(t,n){var r=Ao(t)?t.start:t;0===n?e.ctx.moveTo(r.x,r.y):e.ctx.lineTo(r.x,r.y),Ao(t)&&e.ctx.bezierCurveTo(t.startControl.x,t.startControl.y,t.endControl.x,t.endControl.y,t.end.x,t.end.y)}))},t.prototype.renderRepeat=function(t,e,n,r){this.path(t),this.ctx.fillStyle=e,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},t.prototype.resizeImage=function(t,e,n){if(t.width===e&&t.height===n)return t;var r=this.canvas.ownerDocument.createElement("canvas");return r.width=e,r.height=n,r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,n),r},t.prototype.renderBackgroundImage=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,a,s;return i(this,(function(c){switch(c.label){case 0:e=t.styles.backgroundImage.length-1,n=function(n){var o,a,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w,E,_,S,T,C,x,R,I,O,M,L,k,B,N;return i(this,(function(i){switch(i.label){case 0:if(n.type!==ge.URL)return[3,5];o=void 0,a=n.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.options.cache.match(a)];case 2:return o=i.sent(),[3,4];case 3:return i.sent(),Oe.getInstance(r.options.id).error("Error loading background-image "+a),[3,4];case 4:return o&&(s=Lo(t,e,[o.width,o.height,o.width/o.height]),b=s[0],C=s[1],x=s[2],_=s[3],S=s[4],A=r.ctx.createPattern(r.resizeImage(o,_,S),"repeat"),r.renderRepeat(b,A,C,x)),[3,6];case 5:n.type===ge.LINEAR_GRADIENT?(c=Lo(t,e,[null,null,null]),b=c[0],C=c[1],x=c[2],_=c[3],S=c[4],u=Ee(n.angle,_,S),l=u[0],d=u[1],h=u[2],f=u[3],p=u[4],(v=document.createElement("canvas")).width=_,v.height=S,m=v.getContext("2d"),g=m.createLinearGradient(d,f,h,p),we(n.stops,l).forEach((function(t){return g.addColorStop(t.stop,se(t.color))})),m.fillStyle=g,m.fillRect(0,0,_,S),_>0&&S>0&&(A=r.ctx.createPattern(v,"repeat"),r.renderRepeat(b,A,C,x))):function(t){return t.type===ge.RADIAL_GRADIENT}(n)&&(y=Lo(t,e,[null,null,null]),b=y[0],w=y[1],E=y[2],_=y[3],S=y[4],T=0===n.position.length?[Xt]:n.position,C=$t(T[0],_),x=$t(T[T.length-1],S),R=function(t,e,n,r,i){var o=0,a=0;switch(t.size){case Ye.CLOSEST_SIDE:t.shape===Je.CIRCLE?o=a=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===Je.ELLIPSE&&(o=Math.min(Math.abs(e),Math.abs(e-r)),a=Math.min(Math.abs(n),Math.abs(n-i)));break;case Ye.CLOSEST_CORNER:if(t.shape===Je.CIRCLE)o=a=Math.min(_e(e,n),_e(e,n-i),_e(e-r,n),_e(e-r,n-i));else if(t.shape===Je.ELLIPSE){var s=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(e),Math.abs(e-r)),c=Se(r,i,e,n,!0),u=c[0],l=c[1];a=s*(o=_e(u-e,(l-n)/s))}break;case Ye.FARTHEST_SIDE:t.shape===Je.CIRCLE?o=a=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===Je.ELLIPSE&&(o=Math.max(Math.abs(e),Math.abs(e-r)),a=Math.max(Math.abs(n),Math.abs(n-i)));break;case Ye.FARTHEST_CORNER:if(t.shape===Je.CIRCLE)o=a=Math.max(_e(e,n),_e(e,n-i),_e(e-r,n),_e(e-r,n-i));else if(t.shape===Je.ELLIPSE){s=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(e),Math.abs(e-r));var d=Se(r,i,e,n,!1);u=d[0],l=d[1],a=s*(o=_e(u-e,(l-n)/s))}}return Array.isArray(t.size)&&(o=$t(t.size[0],r),a=2===t.size.length?$t(t.size[1],i):o),[o,a]}(n,C,x,_,S),I=R[0],O=R[1],I>0&&I>0&&(M=r.ctx.createRadialGradient(w+C,E+x,0,w+C,E+x,I),we(n.stops,2*I).forEach((function(t){return M.addColorStop(t.stop,se(t.color))})),r.path(b),r.ctx.fillStyle=M,I!==O?(L=t.bounds.left+.5*t.bounds.width,k=t.bounds.top+.5*t.bounds.height,N=1/(B=O/I),r.ctx.save(),r.ctx.translate(L,k),r.ctx.transform(1,0,0,B,0,0),r.ctx.translate(-L,-k),r.ctx.fillRect(w,N*(E-k)+k,_,S*N),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return e--,[2]}}))},r=this,o=0,a=t.styles.backgroundImage.slice(0).reverse(),c.label=1;case 1:return o<a.length?(s=a[o],[5,n(s)]):[3,4];case 2:c.sent(),c.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},t.prototype.renderBorder=function(t,e,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return this.path(function(t,e){switch(e){case 0:return Io(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return Io(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return Io(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);case 3:default:return Io(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}}(n,e)),this.ctx.fillStyle=se(t),this.ctx.fill(),[2]}))}))},t.prototype.renderNodeBackgroundAndBorders=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,a,s,c,u,l=this;return i(this,(function(i){switch(i.label){case 0:return this.applyEffects(t.effects,2),e=t.container.styles,n=!ae(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor},{style:e.borderRightStyle,color:e.borderRightColor},{style:e.borderBottomStyle,color:e.borderBottomColor},{style:e.borderLeftStyle,color:e.borderLeftColor}],o=Vo(Po(e.backgroundClip,0),t.curves),n||e.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),ae(e.backgroundColor)||(this.ctx.fillStyle=se(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach((function(e){l.ctx.save();var n,r,i,o,a,s=wo(t.curves),c=e.inset?0:1e4,u=(n=s,r=-c+(e.inset?1:-1)*e.spread.number,i=(e.inset?1:-1)*e.spread.number,o=e.spread.number*(e.inset?-2:2),a=e.spread.number*(e.inset?-2:2),n.map((function(t,e){switch(e){case 0:return t.add(r,i);case 1:return t.add(r+o,i);case 2:return t.add(r+o,i+a);case 3:return t.add(r,i+a)}return t})));e.inset?(l.path(s),l.ctx.clip(),l.mask(u)):(l.mask(s),l.ctx.clip(),l.path(u)),l.ctx.shadowOffsetX=e.offsetX.number+c,l.ctx.shadowOffsetY=e.offsetY.number,l.ctx.shadowColor=se(e.color),l.ctx.shadowBlur=e.blur.number,l.ctx.fillStyle=e.inset?se(e.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()})),i.label=2;case 2:a=0,s=0,c=r,i.label=3;case 3:return s<c.length?(u=c[s]).style===cn.NONE||ae(u.color)?[3,5]:[4,this.renderBorder(u.color,a,t.curves)]:[3,7];case 4:i.sent(),i.label=5;case 5:a++,i.label=6;case 6:return s++,[3,3];case 7:return[2]}}))}))},t.prototype.render=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=se(this.options.backgroundColor),this.ctx.fillRect(this.options.x-this.options.scrollX,this.options.y-this.options.scrollY,this.options.width,this.options.height)),r=new Co(t,[]),i=new To(r),xo(r,i,i,o=[]),Ro(r.container,o),e=i,[4,this.renderStack(e)];case 1:return n.sent(),this.applyEffects([],2),[2,this.canvas]}var r,i,o}))}))},t}(),jo=function(t){return t instanceof hi||(t instanceof di||t instanceof li&&t.type!==si&&t.type!==ai)},Vo=function(t,e){switch(t){case fe.BORDER_BOX:return wo(e);case fe.CONTENT_BOX:return function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]}(e);case fe.PADDING_BOX:default:return Eo(e)}},Go=function(t){switch(t){case Zn.CENTER:return"center";case Zn.RIGHT:return"right";case Zn.LEFT:default:return"left"}},Qo=function(){function t(t){this.canvas=t.canvas?t.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=t,this.canvas.width=Math.floor(t.width*t.scale),this.canvas.height=Math.floor(t.height*t.scale),this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-t.x+t.scrollX,-t.y+t.scrollY),Oe.getInstance(t.id).debug("EXPERIMENTAL ForeignObject renderer initialized ("+t.width+"x"+t.height+" at "+t.x+","+t.y+") with scale "+t.scale)}return t.prototype.render=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return e=xe(Math.max(this.options.windowWidth,this.options.width)*this.options.scale,Math.max(this.options.windowHeight,this.options.height)*this.options.scale,this.options.scrollX*this.options.scale,this.options.scrollY*this.options.scale,t),[4,zo(e)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=se(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},t}(),zo=function(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},qo=function(t){return oe(Nt.create(t).parseComponentValue())};"undefined"!=typeof window&&Me.setContext(window);var Wo=function(t,e){return r(undefined,void 0,void 0,(function(){var r,s,c,u,l,d,h,f,p,v,m,g,A,y,b,w,E,_,S,T,C,x,R;return i(this,(function(i){switch(i.label){case 0:if(!(r=t.ownerDocument))throw new Error("Element is not attached to a Document");if(!(s=r.defaultView))throw new Error("Document is not attached to a Window");return c=(Math.round(1e3*Math.random())+Date.now()).toString(16),u=Ii(t)||"HTML"===t.tagName?function(t){var e=t.body,n=t.documentElement;if(!e||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,n.scrollWidth),Math.max(e.offsetWidth,n.offsetWidth),Math.max(e.clientWidth,n.clientWidth)),i=Math.max(Math.max(e.scrollHeight,n.scrollHeight),Math.max(e.offsetHeight,n.offsetHeight),Math.max(e.clientHeight,n.clientHeight));return new o(0,0,r,i)}(r):a(t),l=u.width,d=u.height,h=u.left,f=u.top,p=n({},{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1},e),v={backgroundColor:"#ffffff",cache:e.cache?e.cache:Me.create(c,p),logging:!0,removeContainer:!0,foreignObjectRendering:!1,scale:s.devicePixelRatio||1,windowWidth:s.innerWidth,windowHeight:s.innerHeight,scrollX:s.pageXOffset,scrollY:s.pageYOffset,x:h,y:f,width:Math.ceil(l),height:Math.ceil(d),id:c},m=n({},v,p,e),g=new o(m.scrollX,m.scrollY,m.windowWidth,m.windowHeight),Oe.create({id:c,enabled:m.logging}),Oe.getInstance(c).debug("Starting document clone"),A=new Zi(t,{id:c,onclone:m.onclone,ignoreElements:m.ignoreElements,inlineImages:m.foreignObjectRendering,copyStyles:m.foreignObjectRendering}),(y=A.clonedReferenceElement)?[4,A.toIFrame(r,g)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return b=i.sent(),w=r.documentElement?qo(getComputedStyle(r.documentElement).backgroundColor):me.TRANSPARENT,E=r.body?qo(getComputedStyle(r.body).backgroundColor):me.TRANSPARENT,_=e.backgroundColor,S="string"==typeof _?qo(_):null===_?me.TRANSPARENT:4294967295,T=t===r.documentElement?ae(w)?ae(E)?S:E:w:S,C={id:c,cache:m.cache,canvas:m.canvas,backgroundColor:T,scale:m.scale,x:m.x,y:m.y,scrollX:m.scrollX,scrollY:m.scrollY,width:m.width,height:m.height,windowWidth:m.windowWidth,windowHeight:m.windowHeight},m.foreignObjectRendering?(Oe.getInstance(c).debug("Document cloned, using foreign object rendering"),[4,new Qo(C).render(y)]):[3,3];case 2:return x=i.sent(),[3,5];case 3:return Oe.getInstance(c).debug("Document cloned, using computed rendering"),Me.attachInstance(m.cache),Oe.getInstance(c).debug("Starting DOM parsing"),R=Ai(y),Me.detachInstance(),T===R.styles.backgroundColor&&(R.styles.backgroundColor=me.TRANSPARENT),Oe.getInstance(c).debug("Starting renderer"),[4,new Ho(C).render(R)];case 4:x=i.sent(),i.label=5;case 5:return!0===m.removeContainer&&(Zi.destroy(b)||Oe.getInstance(c).error("Cannot detach cloned iframe as it is not in the DOM anymore")),Oe.getInstance(c).debug("Finished rendering"),Oe.destroy(c),Me.destroy(c),[2,x]}}))}))};return function(t,e){return void 0===e&&(e={}),Wo(t,e)}})),
/**
 * @license b-here v1.0.0
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,(function(t){"use strict";function e(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}for(var c,u="128",l=100,d=300,h=301,f=302,p=303,v=304,m=306,g=307,A=1e3,y=1001,b=1002,w=1003,E=1004,_=1005,S=1006,T=1007,C=1008,x=1009,R=1012,I=1014,O=1015,M=1016,L=1020,k=1022,B=1023,N=1026,P=1027,U=33776,D=33777,F=33778,H=33779,j=35840,V=35841,G=35842,Q=35843,z=37492,q=37496,W=2300,K=2301,X=2302,J=2400,Y=2401,$=2402,Z=2500,tt=2501,et=3e3,nt=3001,rt=3007,it=3002,ot=3004,at=3005,st=3006,ct=7680,ut=35044,lt=35048,dt="300 es",ht=function(){function t(){}var e=t.prototype;return e.addEventListener=function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},e.hasEventListener=function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},e.removeEventListener=function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},e.dispatchEvent=function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t);t.target=null}}},t}(),ft=[],pt=0
/**
   * @license
   * Copyright 2010-2021 Three.js Authors
   * SPDX-License-Identifier: MIT
   */;pt<256;pt++)ft[pt]=(pt<16?"0":"")+pt.toString(16);var vt=1234567,mt=Math.PI/180,gt=180/Math.PI;function At(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ft[255&t]+ft[t>>8&255]+ft[t>>16&255]+ft[t>>24&255]+"-"+ft[255&e]+ft[e>>8&255]+"-"+ft[e>>16&15|64]+ft[e>>24&255]+"-"+ft[63&n|128]+ft[n>>8&255]+"-"+ft[n>>16&255]+ft[n>>24&255]+ft[255&r]+ft[r>>8&255]+ft[r>>16&255]+ft[r>>24&255]).toUpperCase()}function yt(t,e,n){return Math.max(e,Math.min(n,t))}function bt(t,e){return(t%e+e)%e}function wt(t,e,n){return(1-n)*t+n*e}function Et(t){return 0==(t&t-1)&&0!==t}function _t(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function St(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Tt=Object.freeze({__proto__:null,DEG2RAD:mt,RAD2DEG:gt,generateUUID:At,clamp:yt,euclideanModulo:bt,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:wt,damp:function(t,e,n,r){return wt(t,e,1-Math.exp(-n*r))},pingpong:function(t,e){return void 0===e&&(e=1),e-Math.abs(bt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(vt=t%2147483647),((vt=16807*vt%2147483647)-1)/2147483646},degToRad:function(t){return t*mt},radToDeg:function(t){return t*gt},isPowerOfTwo:Et,ceilPowerOfTwo:_t,floorPowerOfTwo:St,setQuaternionFromProperEuler:function(t,e,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),c=a(n/2),u=o((e+r)/2),l=a((e+r)/2),d=o((e-r)/2),h=a((e-r)/2),f=o((r-e)/2),p=a((r-e)/2);switch(i){case"XYX":t.set(s*l,c*d,c*h,s*u);break;case"YZY":t.set(c*h,s*l,c*d,s*u);break;case"ZXZ":t.set(c*d,c*h,s*l,s*u);break;case"XZX":t.set(s*l,c*p,c*f,s*u);break;case"YXY":t.set(c*f,s*l,c*p,s*u);break;case"ZYZ":t.set(c*p,c*f,s*l,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}}),Ct=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.setScalar=function(t){return this.x=t,this.y=t,this},e.setX=function(t){return this.x=t,this},e.setY=function(t){return this.y=t,this},e.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},e.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y)},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.add=function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},e.addScalar=function(t){return this.x+=t,this.y+=t,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},e.subScalar=function(t){return this.x-=t,this.y-=t,this},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.divideScalar=function(t){return this.multiplyScalar(1/t)},e.applyMatrix3=function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},e.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},e.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},e.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},e.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},e.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},e.cross=function(t){return this.x*t.y-this.y*t.x},e.lengthSq=function(){return this.x*this.x+this.y*this.y},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},e.normalize=function(){return this.divideScalar(this.length()||1)},e.angle=function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t},e.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},e.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},e.setLength=function(t){return this.normalize().multiplyScalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},e.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},e.equals=function(t){return t.x===this.x&&t.y===this.y},e.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},e.fromBufferAttribute=function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},e.rotateAround=function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this},r(t,[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}}]),t}();Ct.prototype.isVector2=!0;var xt,Rt=function(){function t(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}var e=t.prototype;return e.set=function(t,e,n,r,i,o,a,s,c){var u=this.elements;return u[0]=t,u[1]=r,u[2]=a,u[3]=e,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=c,this},e.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},e.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},e.extractBasis=function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},e.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},e.multiply=function(t){return this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],c=n[1],u=n[4],l=n[7],d=n[2],h=n[5],f=n[8],p=r[0],v=r[3],m=r[6],g=r[1],A=r[4],y=r[7],b=r[2],w=r[5],E=r[8];return i[0]=o*p+a*g+s*b,i[3]=o*v+a*A+s*w,i[6]=o*m+a*y+s*E,i[1]=c*p+u*g+l*b,i[4]=c*v+u*A+l*w,i[7]=c*m+u*y+l*E,i[2]=d*p+h*g+f*b,i[5]=d*v+h*A+f*w,i[8]=d*m+h*y+f*E,this},e.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return e*o*u-e*a*c-n*i*u+n*a*s+r*i*c-r*o*s},e.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=u*o-a*c,d=a*s-u*i,h=c*i-o*s,f=e*l+n*d+r*h;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return t[0]=l*p,t[1]=(r*c-u*n)*p,t[2]=(a*n-r*o)*p,t[3]=d*p,t[4]=(u*e-r*s)*p,t[5]=(r*i-a*e)*p,t[6]=h*p,t[7]=(n*s-c*e)*p,t[8]=(o*e-n*i)*p,this},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.getNormalMatrix=function(t){return this.setFromMatrix4(t).invert().transpose()},e.transposeIntoArray=function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},e.setUvTransform=function(t,e,n,r,i,o,a){var s=Math.cos(i),c=Math.sin(i);return this.set(n*s,n*c,-n*(s*o+c*a)+o+t,-r*c,r*s,-r*(-c*o+s*a)+a+e,0,0,1),this},e.scale=function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},e.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],c=r[4],u=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*c,r[6]=e*a+n*u,r[1]=-n*i+e*s,r[4]=-n*o+e*c,r[7]=-n*a+e*u,this},e.translate=function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},e.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},e.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},e.clone=function(){return(new this.constructor).fromArray(this.elements)},t}();Rt.prototype.isMatrix3=!0;var It=function(){function t(){}return t.getDataURL=function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;var e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===xt&&(xt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),xt.width=t.width,xt.height=t.height;var n=xt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=xt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")},t}(),Ot=0,Mt=function(t){function e(n,r,i,a,s,c,u,l,d,h){var f;return void 0===n&&(n=e.DEFAULT_IMAGE),void 0===r&&(r=e.DEFAULT_MAPPING),void 0===i&&(i=y),void 0===a&&(a=y),void 0===s&&(s=S),void 0===c&&(c=C),void 0===u&&(u=B),void 0===l&&(l=x),void 0===d&&(d=1),void 0===h&&(h=et),f=t.call(this)||this,Object.defineProperty(o(f),"id",{value:Ot++}),f.uuid=At(),f.name="",f.image=n,f.mipmaps=[],f.mapping=r,f.wrapS=i,f.wrapT=a,f.magFilter=s,f.minFilter=c,f.anisotropy=d,f.format=u,f.internalFormat=null,f.type=l,f.offset=new Ct(0,0),f.repeat=new Ct(1,1),f.center=new Ct(0,0),f.rotation=0,f.matrixAutoUpdate=!0,f.matrix=new Rt,f.generateMipmaps=!0,f.premultiplyAlpha=!1,f.flipY=!0,f.unpackAlignment=4,f.encoding=h,f.version=0,f.onUpdate=null,f}i(e,t);var n=e.prototype;return n.updateMatrix=function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},n.clone=function(){return(new this.constructor).copy(this)},n.copy=function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},n.toJSON=function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=At()),!e&&void 0===t.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)r[o].isDataTexture?i.push(Lt(r[o].image)):i.push(Lt(r[o]))}else i=Lt(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},n.dispose=function(){this.dispatchEvent({type:"dispose"})},n.transformUv=function(t){if(this.mapping!==d)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case A:t.x=t.x-Math.floor(t.x);break;case y:t.x=t.x<0?0:1;break;case b:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case A:t.y=t.y-Math.floor(t.y);break;case y:t.y=t.y<0?0:1;break;case b:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t},r(e,[{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),e}(ht);function Lt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?It.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Mt.DEFAULT_IMAGE=void 0,Mt.DEFAULT_MAPPING=d,Mt.prototype.isTexture=!0;var kt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=e,this.z=n,this.w=r}var e=t.prototype;return e.set=function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},e.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},e.setX=function(t){return this.x=t,this},e.setY=function(t){return this.y=t,this},e.setZ=function(t){return this.z=t,this},e.setW=function(t){return this.w=t,this},e.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},e.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},e.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},e.add=function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},e.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},e.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},e.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.applyMatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},e.divideScalar=function(t){return this.multiplyScalar(1/t)},e.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},e.setAxisAngleFromRotationMatrix=function(t){var e,n,r,i,o=.01,a=.1,s=t.elements,c=s[0],u=s[4],l=s[8],d=s[1],h=s[5],f=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(u-d)<o&&Math.abs(l-p)<o&&Math.abs(f-v)<o){if(Math.abs(u+d)<a&&Math.abs(l+p)<a&&Math.abs(f+v)<a&&Math.abs(c+h+m-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var g=(c+1)/2,A=(h+1)/2,y=(m+1)/2,b=(u+d)/4,w=(l+p)/4,E=(f+v)/4;return g>A&&g>y?g<o?(n=0,r=.707106781,i=.707106781):(r=b/(n=Math.sqrt(g)),i=w/n):A>y?A<o?(n=.707106781,r=0,i=.707106781):(n=b/(r=Math.sqrt(A)),i=E/r):y<o?(n=.707106781,r=.707106781,i=0):(n=w/(i=Math.sqrt(y)),r=E/i),this.set(n,r,i,e),this}var _=Math.sqrt((v-f)*(v-f)+(l-p)*(l-p)+(d-u)*(d-u));return Math.abs(_)<.001&&(_=1),this.x=(v-f)/_,this.y=(l-p)/_,this.z=(d-u)/_,this.w=Math.acos((c+h+m-1)/2),this},e.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},e.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},e.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},e.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},e.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},e.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},e.normalize=function(){return this.divideScalar(this.length()||1)},e.setLength=function(t){return this.normalize().multiplyScalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},e.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},e.fromBufferAttribute=function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},r(t,[{key:"width",get:function(){return this.z},set:function(t){this.z=t}},{key:"height",get:function(){return this.w},set:function(t){this.w=t}}]),t}();kt.prototype.isVector4=!0;var Bt=function(t){function e(e,n,r){var i;return(i=t.call(this)||this).width=e,i.height=n,i.depth=1,i.scissor=new kt(0,0,e,n),i.scissorTest=!1,i.viewport=new kt(0,0,e,n),r=r||{},i.texture=new Mt(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),i.texture.image={},i.texture.image.width=e,i.texture.image.height=n,i.texture.image.depth=1,i.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,i.texture.minFilter=void 0!==r.minFilter?r.minFilter:S,i.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,i.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,i.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,i}i(e,t);var n=e.prototype;return n.setTexture=function(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t},n.setSize=function(t,e,n){void 0===n&&(n=1),this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},n.clone=function(){return(new this.constructor).copy(this)},n.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},n.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(ht);Bt.prototype.isWebGLRenderTarget=!0;var Nt=function(t){function e(e,n,r){var i;return(i=t.call(this,e,n,r)||this).samples=4,i}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.samples=e.samples,this},e}(Bt);Nt.prototype.isWebGLMultisampleRenderTarget=!0;var Pt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),this._x=t,this._y=e,this._z=n,this._w=r}t.slerp=function(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)},t.slerpFlat=function(t,e,n,r,i,o,a){var s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3],d=i[o+0],h=i[o+1],f=i[o+2],p=i[o+3];if(0===a)return t[e+0]=s,t[e+1]=c,t[e+2]=u,void(t[e+3]=l);if(1===a)return t[e+0]=d,t[e+1]=h,t[e+2]=f,void(t[e+3]=p);if(l!==p||s!==d||c!==h||u!==f){var v=1-a,m=s*d+c*h+u*f+l*p,g=m>=0?1:-1,A=1-m*m;if(A>Number.EPSILON){var y=Math.sqrt(A),b=Math.atan2(y,m*g);v=Math.sin(v*b)/y,a=Math.sin(a*b)/y}var w=a*g;if(s=s*v+d*w,c=c*v+h*w,u=u*v+f*w,l=l*v+p*w,v===1-a){var E=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=E,c*=E,u*=E,l*=E}}t[e]=s,t[e+1]=c,t[e+2]=u,t[e+3]=l},t.multiplyQuaternionsFlat=function(t,e,n,r,i,o){var a=n[r],s=n[r+1],c=n[r+2],u=n[r+3],l=i[o],d=i[o+1],h=i[o+2],f=i[o+3];return t[e]=a*f+u*l+s*h-c*d,t[e+1]=s*f+u*d+c*l-a*h,t[e+2]=c*f+u*h+a*d-s*l,t[e+3]=u*f-a*l-s*d-c*h,t};var e=t.prototype;return e.set=function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},e.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},e.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},e.setFromEuler=function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,s=Math.sin,c=a(n/2),u=a(r/2),l=a(i/2),d=s(n/2),h=s(r/2),f=s(i/2);switch(o){case"XYZ":this._x=d*u*l+c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l-d*h*f;break;case"YXZ":this._x=d*u*l+c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l+d*h*f;break;case"ZXY":this._x=d*u*l-c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l-d*h*f;break;case"ZYX":this._x=d*u*l-c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l+d*h*f;break;case"YZX":this._x=d*u*l+c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l-d*h*f;break;case"XZY":this._x=d*u*l-c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this},e.setFromAxisAngle=function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},e.setFromRotationMatrix=function(t){var e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],c=e[2],u=e[6],l=e[10],d=n+a+l;if(d>0){var h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(u-s)*h,this._y=(i-c)*h,this._z=(o-r)*h}else if(n>a&&n>l){var f=2*Math.sqrt(1+n-a-l);this._w=(u-s)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(i+c)/f}else if(a>l){var p=2*Math.sqrt(1+a-n-l);this._w=(i-c)/p,this._x=(r+o)/p,this._y=.25*p,this._z=(s+u)/p}else{var v=2*Math.sqrt(1+l-n-a);this._w=(o-r)/v,this._x=(i+c)/v,this._y=(s+u)/v,this._z=.25*v}return this._onChangeCallback(),this},e.setFromUnitVectors=function(t,e){var n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},e.angleTo=function(t){return 2*Math.acos(Math.abs(yt(this.dot(t),-1,1)))},e.rotateTowards=function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},e.identity=function(){return this.set(0,0,0,1)},e.invert=function(){return this.conjugate()},e.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},e.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},e.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},e.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},e.normalize=function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},e.multiply=function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},e.premultiply=function(t){return this.multiplyQuaternions(t,this)},e.multiplyQuaternions=function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,c=e._z,u=e._w;return this._x=n*u+o*a+r*c-i*s,this._y=r*u+o*s+i*a-n*c,this._z=i*u+o*c+n*s-r*a,this._w=o*u-n*a-r*s-i*c,this._onChangeCallback(),this},e.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var c=1-e;return this._w=c*o+e*this._w,this._x=c*n+e*this._x,this._y=c*r+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),l=Math.atan2(u,a),d=Math.sin((1-e)*l)/u,h=Math.sin(e*l)/u;return this._w=o*d+this._w*h,this._x=n*d+this._x*h,this._y=r*d+this._y*h,this._z=i*d+this._z*h,this._onChangeCallback(),this},e.slerpQuaternions=function(t,e,n){this.copy(t).slerp(e,n)},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},e.fromArray=function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},e.fromBufferAttribute=function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},e._onChange=function(t){return this._onChangeCallback=t,this},e._onChangeCallback=function(){},r(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}]),t}();Pt.prototype.isQuaternion=!0;var Ut=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}var e=t.prototype;return e.set=function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this},e.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this},e.setX=function(t){return this.x=t,this},e.setY=function(t){return this.y=t,this},e.setZ=function(t){return this.z=t,this},e.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},e.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y,this.z)},e.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.add=function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},e.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},e.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.multiply=function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},e.applyEuler=function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ft.setFromEuler(t))},e.applyAxisAngle=function(t,e){return this.applyQuaternion(Ft.setFromAxisAngle(t,e))},e.applyMatrix3=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},e.applyNormalMatrix=function(t){return this.applyMatrix3(t).normalize()},e.applyMatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this},e.applyQuaternion=function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*r-a*n,u=s*n+a*e-i*r,l=s*r+i*n-o*e,d=-i*e-o*n-a*r;return this.x=c*s+d*-i+u*-a-l*-o,this.y=u*s+d*-o+l*-i-c*-a,this.z=l*s+d*-a+c*-o-u*-i,this},e.project=function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},e.unproject=function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},e.transformDirection=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},e.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},e.divideScalar=function(t){return this.multiplyScalar(1/t)},e.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},e.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},e.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},e.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},e.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},e.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},e.normalize=function(){return this.divideScalar(this.length()||1)},e.setLength=function(t){return this.normalize().multiplyScalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},e.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},e.cross=function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},e.crossVectors=function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},e.projectOnVector=function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},e.projectOnPlane=function(t){return Dt.copy(this).projectOnVector(t),this.sub(Dt)},e.reflect=function(t){return this.sub(Dt.copy(t).multiplyScalar(2*this.dot(t)))},e.angleTo=function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(yt(n,-1,1))},e.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},e.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},e.setFromSpherical=function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},e.setFromSphericalCoords=function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},e.setFromCylindrical=function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},e.setFromCylindricalCoords=function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},e.setFromMatrixPosition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},e.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},e.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},e.setFromMatrix3Column=function(t,e){return this.fromArray(t.elements,3*e)},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},e.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},e.fromBufferAttribute=function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},t}();Ut.prototype.isVector3=!0;var Dt=new Ut,Ft=new Pt,Ht=function(){function t(t,e){void 0===t&&(t=new Ut(1/0,1/0,1/0)),void 0===e&&(e=new Ut(-1/0,-1/0,-1/0)),this.min=t,this.max=e}var e=t.prototype;return e.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},e.setFromArray=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.length;s<c;s+=3){var u=t[s],l=t[s+1],d=t[s+2];u<e&&(e=u),l<n&&(n=l),d<r&&(r=d),u>i&&(i=u),l>o&&(o=l),d>a&&(a=d)}return this.min.set(e,n,r),this.max.set(i,o,a),this},e.setFromBufferAttribute=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,c=t.count;s<c;s++){var u=t.getX(s),l=t.getY(s),d=t.getZ(s);u<e&&(e=u),l<n&&(n=l),d<r&&(r=d),u>i&&(i=u),l>o&&(o=l),d>a&&(a=d)}return this.min.set(e,n,r),this.max.set(i,o,a),this},e.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},e.setFromCenterAndSize=function(t,e){var n=Vt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},e.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},e.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},e.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.getCenter=function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Ut),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},e.getSize=function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Ut),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},e.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},e.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},e.expandByObject=function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Gt.copy(e.boundingBox),Gt.applyMatrix4(t.matrixWorld),this.union(Gt));for(var n=t.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},e.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},e.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},e.getParameter=function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Ut),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},e.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},e.intersectsSphere=function(t){return this.clampPoint(t.center,Vt),Vt.distanceToSquared(t.center)<=t.radius*t.radius},e.intersectsPlane=function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},e.intersectsTriangle=function(t){if(this.isEmpty())return!1;this.getCenter(Jt),Yt.subVectors(this.max,Jt),Qt.subVectors(t.a,Jt),zt.subVectors(t.b,Jt),qt.subVectors(t.c,Jt),Wt.subVectors(zt,Qt),Kt.subVectors(qt,zt),Xt.subVectors(Qt,qt);var e=[0,-Wt.z,Wt.y,0,-Kt.z,Kt.y,0,-Xt.z,Xt.y,Wt.z,0,-Wt.x,Kt.z,0,-Kt.x,Xt.z,0,-Xt.x,-Wt.y,Wt.x,0,-Kt.y,Kt.x,0,-Xt.y,Xt.x,0];return!!te(e,Qt,zt,qt,Yt)&&(!!te(e=[1,0,0,0,1,0,0,0,1],Qt,zt,qt,Yt)&&($t.crossVectors(Wt,Kt),te(e=[$t.x,$t.y,$t.z],Qt,zt,qt,Yt)))},e.clampPoint=function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Ut),e.copy(t).clamp(this.min,this.max)},e.distanceToPoint=function(t){return Vt.copy(t).clamp(this.min,this.max).sub(t).length()},e.getBoundingSphere=function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Vt).length(),t},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.applyMatrix4=function(t){return this.isEmpty()||(jt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),jt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),jt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),jt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),jt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),jt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),jt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),jt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(jt)),this},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}();Ht.prototype.isBox3=!0;var jt=[new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut],Vt=new Ut,Gt=new Ht,Qt=new Ut,zt=new Ut,qt=new Ut,Wt=new Ut,Kt=new Ut,Xt=new Ut,Jt=new Ut,Yt=new Ut,$t=new Ut,Zt=new Ut;function te(t,e,n,r,i){for(var o=0,a=t.length-3;o<=a;o+=3){Zt.fromArray(t,o);var s=i.x*Math.abs(Zt.x)+i.y*Math.abs(Zt.y)+i.z*Math.abs(Zt.z),c=e.dot(Zt),u=n.dot(Zt),l=r.dot(Zt);if(Math.max(-Math.max(c,u,l),Math.min(c,u,l))>s)return!1}return!0}var ee=new Ht,ne=new Ut,re=new Ut,ie=new Ut,oe=function(){function t(t,e){void 0===t&&(t=new Ut),void 0===e&&(e=-1),this.center=t,this.radius=e}var e=t.prototype;return e.set=function(t,e){return this.center.copy(t),this.radius=e,this},e.setFromPoints=function(t,e){var n=this.center;void 0!==e?n.copy(e):ee.setFromPoints(t).getCenter(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this},e.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},e.isEmpty=function(){return this.radius<0},e.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},e.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},e.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},e.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},e.intersectsBox=function(t){return t.intersectsSphere(this)},e.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},e.clampPoint=function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Ut),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},e.getBoundingBox=function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ht),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},e.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},e.translate=function(t){return this.center.add(t),this},e.expandByPoint=function(t){ie.subVectors(t,this.center);var e=ie.lengthSq();if(e>this.radius*this.radius){var n=Math.sqrt(e),r=.5*(n-this.radius);this.center.add(ie.multiplyScalar(r/n)),this.radius+=r}return this},e.union=function(t){return re.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ne.copy(t.center).add(re)),this.expandByPoint(ne.copy(t.center).sub(re)),this},e.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},e.clone=function(){return(new this.constructor).copy(this)},t}(),ae=new Ut,se=new Ut,ce=new Ut,ue=new Ut,le=new Ut,de=new Ut,he=new Ut,fe=function(){function t(t,e){void 0===t&&(t=new Ut),void 0===e&&(e=new Ut(0,0,-1)),this.origin=t,this.direction=e}var e=t.prototype;return e.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},e.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},e.at=function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Ut),e.copy(this.direction).multiplyScalar(t).add(this.origin)},e.lookAt=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},e.recast=function(t){return this.origin.copy(this.at(t,ae)),this},e.closestPointToPoint=function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Ut),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},e.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},e.distanceSqToPoint=function(t){var e=ae.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ae.copy(this.direction).multiplyScalar(e).add(this.origin),ae.distanceToSquared(t))},e.distanceSqToSegment=function(t,e,n,r){se.copy(t).add(e).multiplyScalar(.5),ce.copy(e).sub(t).normalize(),ue.copy(this.origin).sub(se);var i,o,a,s,c=.5*t.distanceTo(e),u=-this.direction.dot(ce),l=ue.dot(this.direction),d=-ue.dot(ce),h=ue.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(o=u*l-d,s=c*f,(i=u*d-l)>=0)if(o>=-s)if(o<=s){var p=1/f;a=(i*=p)*(i+u*(o*=p)+2*l)+o*(u*i+o+2*d)+h}else o=c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*d)+h;else o=-c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*d)+h;else o<=-s?a=-(i=Math.max(0,-(-u*c+l)))*i+(o=i>0?-c:Math.min(Math.max(-c,-d),c))*(o+2*d)+h:o<=s?(i=0,a=(o=Math.min(Math.max(-c,-d),c))*(o+2*d)+h):a=-(i=Math.max(0,-(u*c+l)))*i+(o=i>0?c:Math.min(Math.max(-c,-d),c))*(o+2*d)+h;else o=u>0?-c:c,a=-(i=Math.max(0,-(u*o+l)))*i+o*(o+2*d)+h;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(ce).multiplyScalar(o).add(se),a},e.intersectSphere=function(t,e){ae.subVectors(t.center,this.origin);var n=ae.dot(this.direction),r=ae.dot(ae)-n*n,i=t.radius*t.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)},e.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},e.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},e.intersectPlane=function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},e.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},e.intersectBox=function(t,e){var n,r,i,o,a,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,d=this.origin;return c>=0?(n=(t.min.x-d.x)*c,r=(t.max.x-d.x)*c):(n=(t.max.x-d.x)*c,r=(t.min.x-d.x)*c),u>=0?(i=(t.min.y-d.y)*u,o=(t.max.y-d.y)*u):(i=(t.max.y-d.y)*u,o=(t.min.y-d.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(a=(t.min.z-d.z)*l,s=(t.max.z-d.z)*l):(a=(t.max.z-d.z)*l,s=(t.min.z-d.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},e.intersectsBox=function(t){return null!==this.intersectBox(t,ae)},e.intersectTriangle=function(t,e,n,r,i){le.subVectors(e,t),de.subVectors(n,t),he.crossVectors(le,de);var o,a=this.direction.dot(he);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}ue.subVectors(this.origin,t);var s=o*this.direction.dot(de.crossVectors(ue,de));if(s<0)return null;var c=o*this.direction.dot(le.cross(ue));if(c<0)return null;if(s+c>a)return null;var u=-o*ue.dot(he);return u<0?null:this.at(u/a,i)},e.applyMatrix4=function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},e.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},e.clone=function(){return(new this.constructor).copy(this)},t}(),pe=function(){function t(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}var e=t.prototype;return e.set=function(t,e,n,r,i,o,a,s,c,u,l,d,h,f,p,v){var m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=r,m[1]=i,m[5]=o,m[9]=a,m[13]=s,m[2]=c,m[6]=u,m[10]=l,m[14]=d,m[3]=h,m[7]=f,m[11]=p,m[15]=v,this},e.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.clone=function(){return(new t).fromArray(this.elements)},e.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},e.copyPosition=function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},e.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this},e.extractBasis=function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},e.makeBasis=function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},e.extractRotation=function(t){var e=this.elements,n=t.elements,r=1/ve.setFromMatrixColumn(t,0).length(),i=1/ve.setFromMatrixColumn(t,1).length(),o=1/ve.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},e.makeRotationFromEuler=function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var d=o*u,h=o*l,f=a*u,p=a*l;e[0]=s*u,e[4]=-s*l,e[8]=c,e[1]=h+f*c,e[5]=d-p*c,e[9]=-a*s,e[2]=p-d*c,e[6]=f+h*c,e[10]=o*s}else if("YXZ"===t.order){var v=s*u,m=s*l,g=c*u,A=c*l;e[0]=v+A*a,e[4]=g*a-m,e[8]=o*c,e[1]=o*l,e[5]=o*u,e[9]=-a,e[2]=m*a-g,e[6]=A+v*a,e[10]=o*s}else if("ZXY"===t.order){var y=s*u,b=s*l,w=c*u,E=c*l;e[0]=y-E*a,e[4]=-o*l,e[8]=w+b*a,e[1]=b+w*a,e[5]=o*u,e[9]=E-y*a,e[2]=-o*c,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){var _=o*u,S=o*l,T=a*u,C=a*l;e[0]=s*u,e[4]=T*c-S,e[8]=_*c+C,e[1]=s*l,e[5]=C*c+_,e[9]=S*c-T,e[2]=-c,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var x=o*s,R=o*c,I=a*s,O=a*c;e[0]=s*u,e[4]=O-x*l,e[8]=I*l+R,e[1]=l,e[5]=o*u,e[9]=-a*u,e[2]=-c*u,e[6]=R*l+I,e[10]=x-O*l}else if("XZY"===t.order){var M=o*s,L=o*c,k=a*s,B=a*c;e[0]=s*u,e[4]=-l,e[8]=c*u,e[1]=M*l+B,e[5]=o*u,e[9]=L*l-k,e[2]=k*l-L,e[6]=a*u,e[10]=B*l+M}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},e.makeRotationFromQuaternion=function(t){return this.compose(ge,t,Ae)},e.lookAt=function(t,e,n){var r=this.elements;return we.subVectors(t,e),0===we.lengthSq()&&(we.z=1),we.normalize(),ye.crossVectors(n,we),0===ye.lengthSq()&&(1===Math.abs(n.z)?we.x+=1e-4:we.z+=1e-4,we.normalize(),ye.crossVectors(n,we)),ye.normalize(),be.crossVectors(we,ye),r[0]=ye.x,r[4]=be.x,r[8]=we.x,r[1]=ye.y,r[5]=be.y,r[9]=we.y,r[2]=ye.z,r[6]=be.z,r[10]=we.z,this},e.multiply=function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],c=n[12],u=n[1],l=n[5],d=n[9],h=n[13],f=n[2],p=n[6],v=n[10],m=n[14],g=n[3],A=n[7],y=n[11],b=n[15],w=r[0],E=r[4],_=r[8],S=r[12],T=r[1],C=r[5],x=r[9],R=r[13],I=r[2],O=r[6],M=r[10],L=r[14],k=r[3],B=r[7],N=r[11],P=r[15];return i[0]=o*w+a*T+s*I+c*k,i[4]=o*E+a*C+s*O+c*B,i[8]=o*_+a*x+s*M+c*N,i[12]=o*S+a*R+s*L+c*P,i[1]=u*w+l*T+d*I+h*k,i[5]=u*E+l*C+d*O+h*B,i[9]=u*_+l*x+d*M+h*N,i[13]=u*S+l*R+d*L+h*P,i[2]=f*w+p*T+v*I+m*k,i[6]=f*E+p*C+v*O+m*B,i[10]=f*_+p*x+v*M+m*N,i[14]=f*S+p*R+v*L+m*P,i[3]=g*w+A*T+y*I+b*k,i[7]=g*E+A*C+y*O+b*B,i[11]=g*_+A*x+y*M+b*N,i[15]=g*S+A*R+y*L+b*P,this},e.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],c=t[13],u=t[2],l=t[6],d=t[10],h=t[14];return t[3]*(+i*s*l-r*c*l-i*a*d+n*c*d+r*a*h-n*s*h)+t[7]*(+e*s*h-e*c*d+i*o*d-r*o*h+r*c*u-i*s*u)+t[11]*(+e*c*l-e*a*h-i*o*l+n*o*h+i*a*u-n*c*u)+t[15]*(-r*a*u-e*s*l+e*a*d+r*o*l-n*o*d+n*s*u)},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.setPosition=function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},e.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],l=t[9],d=t[10],h=t[11],f=t[12],p=t[13],v=t[14],m=t[15],g=l*v*c-p*d*c+p*s*h-a*v*h-l*s*m+a*d*m,A=f*d*c-u*v*c-f*s*h+o*v*h+u*s*m-o*d*m,y=u*p*c-f*l*c+f*a*h-o*p*h-u*a*m+o*l*m,b=f*l*s-u*p*s-f*a*d+o*p*d+u*a*v-o*l*v,w=e*g+n*A+r*y+i*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var E=1/w;return t[0]=g*E,t[1]=(p*d*i-l*v*i-p*r*h+n*v*h+l*r*m-n*d*m)*E,t[2]=(a*v*i-p*s*i+p*r*c-n*v*c-a*r*m+n*s*m)*E,t[3]=(l*s*i-a*d*i-l*r*c+n*d*c+a*r*h-n*s*h)*E,t[4]=A*E,t[5]=(u*v*i-f*d*i+f*r*h-e*v*h-u*r*m+e*d*m)*E,t[6]=(f*s*i-o*v*i-f*r*c+e*v*c+o*r*m-e*s*m)*E,t[7]=(o*d*i-u*s*i+u*r*c-e*d*c-o*r*h+e*s*h)*E,t[8]=y*E,t[9]=(f*l*i-u*p*i-f*n*h+e*p*h+u*n*m-e*l*m)*E,t[10]=(o*p*i-f*a*i+f*n*c-e*p*c-o*n*m+e*a*m)*E,t[11]=(u*a*i-o*l*i-u*n*c+e*l*c+o*n*h-e*a*h)*E,t[12]=b*E,t[13]=(u*p*r-f*l*r+f*n*d-e*p*d-u*n*v+e*l*v)*E,t[14]=(f*a*r-o*p*r-f*n*s+e*p*s+o*n*v-e*a*v)*E,t[15]=(o*l*r-u*a*r+u*n*s-e*l*s-o*n*d+e*a*d)*E,this},e.scale=function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},e.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},e.makeTranslation=function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},e.makeRotationX=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},e.makeRotationY=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},e.makeRotationZ=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},e.makeRotationAxis=function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,c=i*o,u=i*a;return this.set(c*o+n,c*a-r*s,c*s+r*a,0,c*a+r*s,u*a+n,u*s-r*o,0,c*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},e.makeScale=function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},e.makeShear=function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},e.compose=function(t,e,n){var r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,c=i+i,u=o+o,l=a+a,d=i*c,h=i*u,f=i*l,p=o*u,v=o*l,m=a*l,g=s*c,A=s*u,y=s*l,b=n.x,w=n.y,E=n.z;return r[0]=(1-(p+m))*b,r[1]=(h+y)*b,r[2]=(f-A)*b,r[3]=0,r[4]=(h-y)*w,r[5]=(1-(d+m))*w,r[6]=(v+g)*w,r[7]=0,r[8]=(f+A)*E,r[9]=(v-g)*E,r[10]=(1-(d+p))*E,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},e.decompose=function(t,e,n){var r=this.elements,i=ve.set(r[0],r[1],r[2]).length(),o=ve.set(r[4],r[5],r[6]).length(),a=ve.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],me.copy(this);var s=1/i,c=1/o,u=1/a;return me.elements[0]*=s,me.elements[1]*=s,me.elements[2]*=s,me.elements[4]*=c,me.elements[5]*=c,me.elements[6]*=c,me.elements[8]*=u,me.elements[9]*=u,me.elements[10]*=u,e.setFromRotationMatrix(me),n.x=i,n.y=o,n.z=a,this},e.makePerspective=function(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(e-t),c=2*i/(n-r),u=(e+t)/(e-t),l=(n+r)/(n-r),d=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},e.makeOrthographic=function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),c=1/(n-r),u=1/(o-i),l=(e+t)*s,d=(n+r)*c,h=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},e.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},e.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},t}();pe.prototype.isMatrix4=!0;var ve=new Ut,me=new pe,ge=new Ut(0,0,0),Ae=new Ut(1,1,1),ye=new Ut,be=new Ut,we=new Ut,Ee=new pe,_e=new Pt,Se=function(){function t(e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=t.DefaultOrder),this._x=e,this._y=n,this._z=r,this._order=i}var e=t.prototype;return e.set=function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},e.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},e.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},e.setFromRotationMatrix=function(t,e,n){var r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],c=r[5],u=r[9],l=r[2],d=r[6],h=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-yt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(yt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-yt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},e.setFromQuaternion=function(t,e,n){return Ee.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ee,e,n)},e.setFromVector3=function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},e.reorder=function(t){return _e.setFromEuler(this),this.setFromQuaternion(_e,t)},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},e.fromArray=function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},e.toVector3=function(t){return t?t.set(this._x,this._y,this._z):new Ut(this._x,this._y,this._z)},e._onChange=function(t){return this._onChangeCallback=t,this},e._onChangeCallback=function(){},r(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}]),t}();Se.prototype.isEuler=!0,Se.DefaultOrder="XYZ",Se.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Te=function(){function t(){this.mask=1}var e=t.prototype;return e.set=function(t){this.mask=1<<t|0},e.enable=function(t){this.mask|=1<<t|0},e.enableAll=function(){this.mask=-1},e.toggle=function(t){this.mask^=1<<t|0},e.disable=function(t){this.mask&=~(1<<t|0)},e.disableAll=function(){this.mask=0},e.test=function(t){return 0!=(this.mask&t.mask)},t}(),Ce=0,xe=new Ut,Re=new Pt,Ie=new pe,Oe=new Ut,Me=new Ut,Le=new Ut,ke=new Pt,Be=new Ut(1,0,0),Ne=new Ut(0,1,0),Pe=new Ut(0,0,1),Ue={type:"added"},De={type:"removed"},Fe=function(t){function e(){var n;n=t.call(this)||this,Object.defineProperty(o(n),"id",{value:Ce++}),n.uuid=At(),n.name="",n.type="Object3D",n.parent=null,n.children=[],n.up=e.DefaultUp.clone();var r=new Ut,i=new Se,a=new Pt,s=new Ut(1,1,1);return i._onChange((function(){a.setFromEuler(i,!1)})),a._onChange((function(){i.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(o(n),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pe},normalMatrix:{value:new Rt}}),n.matrix=new pe,n.matrixWorld=new pe,n.matrixAutoUpdate=e.DefaultMatrixAutoUpdate,n.matrixWorldNeedsUpdate=!1,n.layers=new Te,n.visible=!0,n.castShadow=!1,n.receiveShadow=!1,n.frustumCulled=!0,n.renderOrder=0,n.animations=[],n.userData={},n}i(e,t);var n=e.prototype;return n.onBeforeRender=function(){},n.onAfterRender=function(){},n.applyMatrix4=function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},n.applyQuaternion=function(t){return this.quaternion.premultiply(t),this},n.setRotationFromAxisAngle=function(t,e){this.quaternion.setFromAxisAngle(t,e)},n.setRotationFromEuler=function(t){this.quaternion.setFromEuler(t,!0)},n.setRotationFromMatrix=function(t){this.quaternion.setFromRotationMatrix(t)},n.setRotationFromQuaternion=function(t){this.quaternion.copy(t)},n.rotateOnAxis=function(t,e){return Re.setFromAxisAngle(t,e),this.quaternion.multiply(Re),this},n.rotateOnWorldAxis=function(t,e){return Re.setFromAxisAngle(t,e),this.quaternion.premultiply(Re),this},n.rotateX=function(t){return this.rotateOnAxis(Be,t)},n.rotateY=function(t){return this.rotateOnAxis(Ne,t)},n.rotateZ=function(t){return this.rotateOnAxis(Pe,t)},n.translateOnAxis=function(t,e){return xe.copy(t).applyQuaternion(this.quaternion),this.position.add(xe.multiplyScalar(e)),this},n.translateX=function(t){return this.translateOnAxis(Be,t)},n.translateY=function(t){return this.translateOnAxis(Ne,t)},n.translateZ=function(t){return this.translateOnAxis(Pe,t)},n.localToWorld=function(t){return t.applyMatrix4(this.matrixWorld)},n.worldToLocal=function(t){return t.applyMatrix4(Ie.copy(this.matrixWorld).invert())},n.lookAt=function(t,e,n){t.isVector3?Oe.copy(t):Oe.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Me.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ie.lookAt(Me,Oe,this.up):Ie.lookAt(Oe,Me,this.up),this.quaternion.setFromRotationMatrix(Ie),r&&(Ie.extractRotation(r.matrixWorld),Re.setFromRotationMatrix(Ie),this.quaternion.premultiply(Re.invert()))},n.add=function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ue)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},n.remove=function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(De)),this},n.clear=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.parent=null,e.dispatchEvent(De)}return this.children.length=0,this},n.attach=function(t){return this.updateWorldMatrix(!0,!1),Ie.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ie.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ie),this.add(t),t.updateWorldMatrix(!1,!0),this},n.getObjectById=function(t){return this.getObjectByProperty("id",t)},n.getObjectByName=function(t){return this.getObjectByProperty("name",t)},n.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},n.getWorldPosition=function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Ut),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},n.getWorldQuaternion=function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Pt),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Me,t,Le),t},n.getWorldScale=function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Ut),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Me,ke,t),t},n.getWorldDirection=function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Ut),this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},n.raycast=function(){},n.traverse=function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},n.traverseVisible=function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},n.traverseAncestors=function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},n.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},n.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},n.updateWorldMatrix=function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},n.toJSON=function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,c=a.length;s<c;s++){var u=a[s];i(t.shapes,u)}else i(t.shapes,a)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],d=0,h=this.material.length;d<h;d++)l.push(i(t.materials,this.material[d]));r.material=l}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(var f=0;f<this.children.length;f++)r.children.push(this.children[f].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(i(t.animations,v))}}if(e){var m=_(t.geometries),g=_(t.materials),A=_(t.textures),y=_(t.images),b=_(t.shapes),w=_(t.skeletons),E=_(t.animations);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),A.length>0&&(n.textures=A),y.length>0&&(n.images=y),b.length>0&&(n.shapes=b),w.length>0&&(n.skeletons=w),E.length>0&&(n.animations=E)}return n.object=r,n;function _(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},n.clone=function(t){return(new this.constructor).copy(this,t)},n.copy=function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this},e}(ht);Fe.DefaultUp=new Ut(0,1,0),Fe.DefaultMatrixAutoUpdate=!0,Fe.prototype.isObject3D=!0;var He=new Ut,je=new Ut,Ve=new Rt,Ge=function(){function t(t,e){void 0===t&&(t=new Ut(1,0,0)),void 0===e&&(e=0),this.normal=t,this.constant=e}var e=t.prototype;return e.set=function(t,e){return this.normal.copy(t),this.constant=e,this},e.setComponents=function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},e.setFromNormalAndCoplanarPoint=function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},e.setFromCoplanarPoints=function(t,e,n){var r=He.subVectors(n,e).cross(je.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},e.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},e.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},e.negate=function(){return this.constant*=-1,this.normal.negate(),this},e.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},e.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},e.projectPoint=function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Ut),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},e.intersectLine=function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Ut);var n=t.delta(He),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;var i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)},e.intersectsLine=function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},e.intersectsBox=function(t){return t.intersectsPlane(this)},e.intersectsSphere=function(t){return t.intersectsPlane(this)},e.coplanarPoint=function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Ut),t.copy(this.normal).multiplyScalar(-this.constant)},e.applyMatrix4=function(t,e){var n=e||Ve.getNormalMatrix(t),r=this.coplanarPoint(He).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},e.translate=function(t){return this.constant-=t.dot(this.normal),this},e.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},e.clone=function(){return(new this.constructor).copy(this)},t}();Ge.prototype.isPlane=!0;var Qe=new Ut,ze=new Ut,qe=new Ut,We=new Ut,Ke=new Ut,Xe=new Ut,Je=new Ut,Ye=new Ut,$e=new Ut,Ze=new Ut,tn=function(){function t(t,e,n){void 0===t&&(t=new Ut),void 0===e&&(e=new Ut),void 0===n&&(n=new Ut),this.a=t,this.b=e,this.c=n}t.getNormal=function(t,e,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Ut),r.subVectors(n,e),Qe.subVectors(t,e),r.cross(Qe);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},t.getBarycoord=function(t,e,n,r,i){Qe.subVectors(r,e),ze.subVectors(n,e),qe.subVectors(t,e);var o=Qe.dot(Qe),a=Qe.dot(ze),s=Qe.dot(qe),c=ze.dot(ze),u=ze.dot(qe),l=o*c-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Ut),0===l)return i.set(-2,-1,-1);var d=1/l,h=(c*s-a*u)*d,f=(o*u-a*s)*d;return i.set(1-h-f,f,h)},t.containsPoint=function(t,e,n,r){return this.getBarycoord(t,e,n,r,We),We.x>=0&&We.y>=0&&We.x+We.y<=1},t.getUV=function(t,e,n,r,i,o,a,s){return this.getBarycoord(t,e,n,r,We),s.set(0,0),s.addScaledVector(i,We.x),s.addScaledVector(o,We.y),s.addScaledVector(a,We.z),s},t.isFrontFacing=function(t,e,n,r){return Qe.subVectors(n,e),ze.subVectors(t,e),Qe.cross(ze).dot(r)<0};var e=t.prototype;return e.set=function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},e.setFromPointsAndIndices=function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},e.getArea=function(){return Qe.subVectors(this.c,this.b),ze.subVectors(this.a,this.b),.5*Qe.cross(ze).length()},e.getMidpoint=function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Ut),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},e.getNormal=function(e){return t.getNormal(this.a,this.b,this.c,e)},e.getPlane=function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ge),t.setFromCoplanarPoints(this.a,this.b,this.c)},e.getBarycoord=function(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)},e.getUV=function(e,n,r,i,o){return t.getUV(e,this.a,this.b,this.c,n,r,i,o)},e.containsPoint=function(e){return t.containsPoint(e,this.a,this.b,this.c)},e.isFrontFacing=function(e){return t.isFrontFacing(this.a,this.b,this.c,e)},e.intersectsBox=function(t){return t.intersectsTriangle(this)},e.closestPointToPoint=function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Ut);var n,r,i=this.a,o=this.b,a=this.c;Ke.subVectors(o,i),Xe.subVectors(a,i),Ye.subVectors(t,i);var s=Ke.dot(Ye),c=Xe.dot(Ye);if(s<=0&&c<=0)return e.copy(i);$e.subVectors(t,o);var u=Ke.dot($e),l=Xe.dot($e);if(u>=0&&l<=u)return e.copy(o);var d=s*l-u*c;if(d<=0&&s>=0&&u<=0)return n=s/(s-u),e.copy(i).addScaledVector(Ke,n);Ze.subVectors(t,a);var h=Ke.dot(Ze),f=Xe.dot(Ze);if(f>=0&&h<=f)return e.copy(a);var p=h*c-s*f;if(p<=0&&c>=0&&f<=0)return r=c/(c-f),e.copy(i).addScaledVector(Xe,r);var v=u*f-h*l;if(v<=0&&l-u>=0&&h-f>=0)return Je.subVectors(a,o),r=(l-u)/(l-u+(h-f)),e.copy(o).addScaledVector(Je,r);var m=1/(v+p+d);return n=p*m,r=d*m,e.copy(i).addScaledVector(Ke,n).addScaledVector(Xe,r)},e.equals=function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},t}(),en=0;function nn(){Object.defineProperty(this,"id",{value:en++}),this.uuid=At(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=l,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ct,this.stencilZFail=ct,this.stencilZPass=ct,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}nn.prototype=Object.assign(Object.create(ht.prototype),{constructor:nn,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var i=r(t.textures),o=r(t.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(nn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});var rn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},on={h:0,s:0,l:0},an={h:0,s:0,l:0};function sn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function cn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function un(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var ln=function(){function t(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}var e=t.prototype;return e.set=function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},e.setScalar=function(t){return this.r=t,this.g=t,this.b=t,this},e.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},e.setRGB=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},e.setHSL=function(t,e,n){if(t=bt(t,1),e=yt(e,0,1),n=yt(n,0,1),0===e)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=sn(i,r,t+1/3),this.g=sn(i,r,t),this.b=sn(i,r,t-1/3)}return this},e.setStyle=function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return e(r[4]),this.setHSL(a,s,c)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){var u=n[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},e.setColorName=function(t){var e=rn[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},e.clone=function(){return new this.constructor(this.r,this.g,this.b)},e.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.copyGammaToLinear=function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},e.copyLinearToGamma=function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},e.convertGammaToLinear=function(t){return this.copyGammaToLinear(this,t),this},e.convertLinearToGamma=function(t){return this.copyLinearToGamma(this,t),this},e.copySRGBToLinear=function(t){return this.r=cn(t.r),this.g=cn(t.g),this.b=cn(t.b),this},e.copyLinearToSRGB=function(t){return this.r=un(t.r),this.g=un(t.g),this.b=un(t.b),this},e.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},e.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},e.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},e.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},e.getHSL=function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),c=(s+a)/2;if(s===a)e=0,n=0;else{var u=a-s;switch(n=c<=.5?u/(a+s):u/(2-a-s),a){case r:e=(i-o)/u+(i<o?6:0);break;case i:e=(o-r)/u+2;break;case o:e=(r-i)/u+4}e/=6}return t.h=e,t.s=n,t.l=c,t},e.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},e.offsetHSL=function(t,e,n){return this.getHSL(on),on.h+=t,on.s+=e,on.l+=n,this.setHSL(on.h,on.s,on.l),this},e.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},e.addColors=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},e.addScalar=function(t){return this.r+=t,this.g+=t,this.b+=t,this},e.sub=function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},e.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},e.multiplyScalar=function(t){return this.r*=t,this.g*=t,this.b*=t,this},e.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},e.lerpColors=function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this},e.lerpHSL=function(t,e){this.getHSL(on),t.getHSL(an);var n=wt(on.h,an.h,e),r=wt(on.s,an.s,e),i=wt(on.l,an.l,e);return this.setHSL(n,r,i),this},e.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},e.fromArray=function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},e.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},e.fromBufferAttribute=function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},e.toJSON=function(){return this.getHex()},t}();ln.NAMES=rn,ln.prototype.isColor=!0,ln.prototype.r=1,ln.prototype.g=1,ln.prototype.b=1;var dn=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshBasicMaterial",n.color=new ln(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.combine=0,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},e}(nn);dn.prototype.isMeshBasicMaterial=!0;var hn=new Ut,fn=new Ct,pn=function(){function t(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}var e=t.prototype;return e.setUsage=function(t){return this.usage=t,this},e.copy=function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},e.copyAt=function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},e.copyArray=function(t){return this.array.set(t),this},e.copyColorsArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ln),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},e.copyVector2sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Ct),e[n++]=o.x,e[n++]=o.y}return this},e.copyVector3sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Ut),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},e.copyVector4sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new kt),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},e.applyMatrix3=function(t){if(2===this.itemSize)for(var e=0,n=this.count;e<n;e++)fn.fromBufferAttribute(this,e),fn.applyMatrix3(t),this.setXY(e,fn.x,fn.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)hn.fromBufferAttribute(this,r),hn.applyMatrix3(t),this.setXYZ(r,hn.x,hn.y,hn.z);return this},e.applyMatrix4=function(t){for(var e=0,n=this.count;e<n;e++)hn.x=this.getX(e),hn.y=this.getY(e),hn.z=this.getZ(e),hn.applyMatrix4(t),this.setXYZ(e,hn.x,hn.y,hn.z);return this},e.applyNormalMatrix=function(t){for(var e=0,n=this.count;e<n;e++)hn.x=this.getX(e),hn.y=this.getY(e),hn.z=this.getZ(e),hn.applyNormalMatrix(t),this.setXYZ(e,hn.x,hn.y,hn.z);return this},e.transformDirection=function(t){for(var e=0,n=this.count;e<n;e++)hn.x=this.getX(e),hn.y=this.getY(e),hn.z=this.getZ(e),hn.transformDirection(t),this.setXYZ(e,hn.x,hn.y,hn.z);return this},e.set=function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},e.getX=function(t){return this.array[t*this.itemSize]},e.setX=function(t,e){return this.array[t*this.itemSize]=e,this},e.getY=function(t){return this.array[t*this.itemSize+1]},e.setY=function(t,e){return this.array[t*this.itemSize+1]=e,this},e.getZ=function(t){return this.array[t*this.itemSize+2]},e.setZ=function(t,e){return this.array[t*this.itemSize+2]=e,this},e.getW=function(t){return this.array[t*this.itemSize+3]},e.setW=function(t,e){return this.array[t*this.itemSize+3]=e,this},e.setXY=function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},e.setXYZ=function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},e.setXYZW=function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},e.onUpload=function(t){return this.onUploadCallback=t,this},e.clone=function(){return new this.constructor(this.array,this.itemSize).copy(this)},e.toJSON=function(){var t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t},r(t,[{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),t}();pn.prototype.isBufferAttribute=!0;var vn=function(t){function e(e,n,r){return t.call(this,new Int8Array(e),n,r)||this}return i(e,t),e}(pn),mn=function(t){function e(e,n,r){return t.call(this,new Uint8Array(e),n,r)||this}return i(e,t),e}(pn),gn=function(t){function e(e,n,r){return t.call(this,new Uint8ClampedArray(e),n,r)||this}return i(e,t),e}(pn),An=function(t){function e(e,n,r){return t.call(this,new Int16Array(e),n,r)||this}return i(e,t),e}(pn),yn=function(t){function e(e,n,r){return t.call(this,new Uint16Array(e),n,r)||this}return i(e,t),e}(pn),bn=function(t){function e(e,n,r){return t.call(this,new Int32Array(e),n,r)||this}return i(e,t),e}(pn),wn=function(t){function e(e,n,r){return t.call(this,new Uint32Array(e),n,r)||this}return i(e,t),e}(pn),En=function(t){function e(e,n,r){return t.call(this,new Uint16Array(e),n,r)||this}return i(e,t),e}(pn);En.prototype.isFloat16BufferAttribute=!0;var _n=function(t){function e(e,n,r){return t.call(this,new Float32Array(e),n,r)||this}return i(e,t),e}(pn),Sn=function(t){function e(e,n,r){return t.call(this,new Float64Array(e),n,r)||this}return i(e,t),e}(pn);function Tn(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}var Cn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function xn(t,e){return new Cn[t](e)}var Rn=0,In=new pe,On=new Fe,Mn=new Ut,Ln=new Ht,kn=new Ht,Bn=new Ut,Nn=function(t){function e(){var e;return e=t.call(this)||this,Object.defineProperty(o(e),"id",{value:Rn++}),e.uuid=At(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}i(e,t);var n=e.prototype;return n.getIndex=function(){return this.index},n.setIndex=function(t){return Array.isArray(t)?this.index=new(Tn(t)>65535?wn:yn)(t,1):this.index=t,this},n.getAttribute=function(t){return this.attributes[t]},n.setAttribute=function(t,e){return this.attributes[t]=e,this},n.deleteAttribute=function(t){return delete this.attributes[t],this},n.hasAttribute=function(t){return void 0!==this.attributes[t]},n.addGroup=function(t,e,n){void 0===n&&(n=0),this.groups.push({start:t,count:e,materialIndex:n})},n.clearGroups=function(){this.groups=[]},n.setDrawRange=function(t,e){this.drawRange.start=t,this.drawRange.count=e},n.applyMatrix4=function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Rt).getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},n.rotateX=function(t){return In.makeRotationX(t),this.applyMatrix4(In),this},n.rotateY=function(t){return In.makeRotationY(t),this.applyMatrix4(In),this},n.rotateZ=function(t){return In.makeRotationZ(t),this.applyMatrix4(In),this},n.translate=function(t,e,n){return In.makeTranslation(t,e,n),this.applyMatrix4(In),this},n.scale=function(t,e,n){return In.makeScale(t,e,n),this.applyMatrix4(In),this},n.lookAt=function(t){return On.lookAt(t),On.updateMatrix(),this.applyMatrix4(On.matrix),this},n.center=function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mn).negate(),this.translate(Mn.x,Mn.y,Mn.z),this},n.setFromPoints=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new _n(e,3)),this},n.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new Ht);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ut(-1/0,-1/0,-1/0),new Ut(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,r=e.length;n<r;n++){var i=e[n];Ln.setFromBufferAttribute(i),this.morphTargetsRelative?(Bn.addVectors(this.boundingBox.min,Ln.min),this.boundingBox.expandByPoint(Bn),Bn.addVectors(this.boundingBox.max,Ln.max),this.boundingBox.expandByPoint(Bn)):(this.boundingBox.expandByPoint(Ln.min),this.boundingBox.expandByPoint(Ln.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},n.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new oe);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ut,1/0);if(t){var n=this.boundingSphere.center;if(Ln.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var o=e[r];kn.setFromBufferAttribute(o),this.morphTargetsRelative?(Bn.addVectors(Ln.min,kn.min),Ln.expandByPoint(Bn),Bn.addVectors(Ln.max,kn.max),Ln.expandByPoint(Bn)):(Ln.expandByPoint(kn.min),Ln.expandByPoint(kn.max))}Ln.getCenter(n);for(var a=0,s=0,c=t.count;s<c;s++)Bn.fromBufferAttribute(t,s),a=Math.max(a,n.distanceToSquared(Bn));if(e)for(var u=0,l=e.length;u<l;u++)for(var d=e[u],h=this.morphTargetsRelative,f=0,p=d.count;f<p;f++)Bn.fromBufferAttribute(d,f),h&&(Mn.fromBufferAttribute(t,f),Bn.add(Mn)),a=Math.max(a,n.distanceToSquared(Bn));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},n.computeFaceNormals=function(){},n.computeTangents=function(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var n=t.array,r=e.position.array,i=e.normal.array,o=e.uv.array,a=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new pn(new Float32Array(4*a),4));for(var s=e.tangent.array,c=[],u=[],l=0;l<a;l++)c[l]=new Ut,u[l]=new Ut;var d=new Ut,h=new Ut,f=new Ut,p=new Ct,v=new Ct,m=new Ct,g=new Ut,A=new Ut,y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(var b=0,w=y.length;b<w;++b)for(var E=y[b],_=E.start,S=_,T=_+E.count;S<T;S+=3)P(n[S+0],n[S+1],n[S+2]);for(var C=new Ut,x=new Ut,R=new Ut,I=new Ut,O=0,M=y.length;O<M;++O)for(var L=y[O],k=L.start,B=k,N=k+L.count;B<N;B+=3)U(n[B+0]),U(n[B+1]),U(n[B+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function P(t,e,n){d.fromArray(r,3*t),h.fromArray(r,3*e),f.fromArray(r,3*n),p.fromArray(o,2*t),v.fromArray(o,2*e),m.fromArray(o,2*n),h.sub(d),f.sub(d),v.sub(p),m.sub(p);var i=1/(v.x*m.y-m.x*v.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(i),A.copy(f).multiplyScalar(v.x).addScaledVector(h,-m.x).multiplyScalar(i),c[t].add(g),c[e].add(g),c[n].add(g),u[t].add(A),u[e].add(A),u[n].add(A))}function U(t){R.fromArray(i,3*t),I.copy(R);var e=c[t];C.copy(e),C.sub(R.multiplyScalar(R.dot(e))).normalize(),x.crossVectors(I,e);var n=x.dot(u[t])<0?-1:1;s[4*t]=C.x,s[4*t+1]=C.y,s[4*t+2]=C.z,s[4*t+3]=n}},n.computeVertexNormals=function(){var t=this.index,e=this.getAttribute("position");if(void 0!==e){var n=this.getAttribute("normal");if(void 0===n)n=new pn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var o=new Ut,a=new Ut,s=new Ut,c=new Ut,u=new Ut,l=new Ut,d=new Ut,h=new Ut;if(t)for(var f=0,p=t.count;f<p;f+=3){var v=t.getX(f+0),m=t.getX(f+1),g=t.getX(f+2);o.fromBufferAttribute(e,v),a.fromBufferAttribute(e,m),s.fromBufferAttribute(e,g),d.subVectors(s,a),h.subVectors(o,a),d.cross(h),c.fromBufferAttribute(n,v),u.fromBufferAttribute(n,m),l.fromBufferAttribute(n,g),c.add(d),u.add(d),l.add(d),n.setXYZ(v,c.x,c.y,c.z),n.setXYZ(m,u.x,u.y,u.z),n.setXYZ(g,l.x,l.y,l.z)}else for(var A=0,y=e.count;A<y;A+=3)o.fromBufferAttribute(e,A+0),a.fromBufferAttribute(e,A+1),s.fromBufferAttribute(e,A+2),d.subVectors(s,a),h.subVectors(o,a),d.cross(h),n.setXYZ(A+0,d.x,d.y,d.z),n.setXYZ(A+1,d.x,d.y,d.z),n.setXYZ(A+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}},n.merge=function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,o=t.attributes[r],a=o.array,s=o.itemSize*e,c=Math.min(a.length,i.length-s),u=0,l=s;u<c;u++,l++)i[l]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},n.normalizeNormals=function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)Bn.fromBufferAttribute(t,e),Bn.normalize(),t.setXYZ(e,Bn.x,Bn.y,Bn.z)},n.toNonIndexed=function(){function t(t,e){for(var n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r),a=0,s=0,c=0,u=e.length;c<u;c++){a=e[c]*r;for(var l=0;l<r;l++)o[s++]=n[a++]}return new pn(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var n=new e,r=this.index.array,i=this.attributes;for(var o in i){var a=t(i[o],r);n.setAttribute(o,a)}var s=this.morphAttributes;for(var c in s){for(var u=[],l=s[c],d=0,h=l.length;d<h;d++){var f=t(l[d],r);u.push(f)}n.morphAttributes[c]=u}n.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];n.addGroup(g.start,g.count,g.materialIndex)}return n},n.toJSON=function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var o in i){var a=i[o];t.data.attributes[o]=a.toJSON(t.data)}var s={},c=!1;for(var u in this.morphAttributes){for(var l=this.morphAttributes[u],d=[],h=0,f=l.length;h<f;h++){var p=l[h];d.push(p.toJSON(t.data))}d.length>0&&(s[u]=d,c=!0)}c&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(t.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(t.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),t},n.clone=function(){return(new e).copy(this)},n.copy=function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(e));var r=t.attributes;for(var i in r){var o=r[i];this.setAttribute(i,o.clone(e))}var a=t.morphAttributes;for(var s in a){for(var c=[],u=a[s],l=0,d=u.length;l<d;l++)c.push(u[l].clone(e));this.morphAttributes[s]=c}this.morphTargetsRelative=t.morphTargetsRelative;for(var h=t.groups,f=0,p=h.length;f<p;f++){var v=h[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=t.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=t.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},n.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(ht);Nn.prototype.isBufferGeometry=!0;var Pn=new pe,Un=new fe,Dn=new oe,Fn=new Ut,Hn=new Ut,jn=new Ut,Vn=new Ut,Gn=new Ut,Qn=new Ut,zn=new Ut,qn=new Ut,Wn=new Ut,Kn=new Ct,Xn=new Ct,Jn=new Ct,Yn=new Ut,$n=new Ut,Zn=function(t){function e(e,n){var r;return void 0===e&&(e=new Nn),void 0===n&&(n=new dn),(r=t.call(this)||this).type="Mesh",r.geometry=e,r.material=n,r.updateMorphTargets(),r}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},n.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},n.raycast=function(t,e){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Dn.copy(r.boundingSphere),Dn.applyMatrix4(o),!1!==t.ray.intersectsSphere(Dn)&&(Pn.copy(o).invert(),Un.copy(t.ray).applyMatrix4(Pn),null===r.boundingBox||!1!==Un.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index,s=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,l=r.attributes.uv,d=r.attributes.uv2,h=r.groups,f=r.drawRange;if(null!==a)if(Array.isArray(i))for(var p=0,v=h.length;p<v;p++)for(var m=h[p],g=i[m.materialIndex],A=Math.max(m.start,f.start),y=Math.min(m.start+m.count,f.start+f.count);A<y;A+=3){var b=a.getX(A),w=a.getX(A+1),E=a.getX(A+2);(n=tr(this,g,t,Un,s,c,u,l,d,b,w,E))&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=m.materialIndex,e.push(n))}else for(var _=Math.max(0,f.start),S=Math.min(a.count,f.start+f.count);_<S;_+=3){var T=a.getX(_),C=a.getX(_+1),x=a.getX(_+2);(n=tr(this,i,t,Un,s,c,u,l,d,T,C,x))&&(n.faceIndex=Math.floor(_/3),e.push(n))}else if(void 0!==s)if(Array.isArray(i))for(var R=0,I=h.length;R<I;R++)for(var O=h[R],M=i[O.materialIndex],L=Math.max(O.start,f.start),k=Math.min(O.start+O.count,f.start+f.count);L<k;L+=3){(n=tr(this,M,t,Un,s,c,u,l,d,L,L+1,L+2))&&(n.faceIndex=Math.floor(L/3),n.face.materialIndex=O.materialIndex,e.push(n))}else for(var B=Math.max(0,f.start),N=Math.min(s.count,f.start+f.count);B<N;B+=3){(n=tr(this,i,t,Un,s,c,u,l,d,B,B+1,B+2))&&(n.faceIndex=Math.floor(B/3),e.push(n))}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},e}(Fe);function tr(t,e,n,r,i,o,a,s,c,u,l,d){Fn.fromBufferAttribute(i,u),Hn.fromBufferAttribute(i,l),jn.fromBufferAttribute(i,d);var h=t.morphTargetInfluences;if(e.morphTargets&&o&&h){zn.set(0,0,0),qn.set(0,0,0),Wn.set(0,0,0);for(var f=0,p=o.length;f<p;f++){var v=h[f],m=o[f];0!==v&&(Vn.fromBufferAttribute(m,u),Gn.fromBufferAttribute(m,l),Qn.fromBufferAttribute(m,d),a?(zn.addScaledVector(Vn,v),qn.addScaledVector(Gn,v),Wn.addScaledVector(Qn,v)):(zn.addScaledVector(Vn.sub(Fn),v),qn.addScaledVector(Gn.sub(Hn),v),Wn.addScaledVector(Qn.sub(jn),v)))}Fn.add(zn),Hn.add(qn),jn.add(Wn)}t.isSkinnedMesh&&e.skinning&&(t.boneTransform(u,Fn),t.boneTransform(l,Hn),t.boneTransform(d,jn));var g=function(t,e,n,r,i,o,a,s){if(null===(1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==e.side,s)))return null;$n.copy(s),$n.applyMatrix4(t.matrixWorld);var c=n.ray.origin.distanceTo($n);return c<n.near||c>n.far?null:{distance:c,point:$n.clone(),object:t}}(t,e,n,r,Fn,Hn,jn,Yn);if(g){s&&(Kn.fromBufferAttribute(s,u),Xn.fromBufferAttribute(s,l),Jn.fromBufferAttribute(s,d),g.uv=tn.getUV(Yn,Fn,Hn,jn,Kn,Xn,Jn,new Ct)),c&&(Kn.fromBufferAttribute(c,u),Xn.fromBufferAttribute(c,l),Jn.fromBufferAttribute(c,d),g.uv2=tn.getUV(Yn,Fn,Hn,jn,Kn,Xn,Jn,new Ct));var A={a:u,b:l,c:d,normal:new Ut,materialIndex:0};tn.getNormal(Fn,Hn,jn,A.normal),g.face=A}return g}Zn.prototype.isMesh=!0;var er=function(t){function e(e,n,r,i,a,s){var c;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===s&&(s=1),(c=t.call(this)||this).type="BoxGeometry",c.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:a,depthSegments:s};var u=o(c);i=Math.floor(i),a=Math.floor(a),s=Math.floor(s);var l=[],d=[],h=[],f=[],p=0,v=0;function m(t,e,n,r,i,o,a,s,c,m,g){for(var A=o/c,y=a/m,b=o/2,w=a/2,E=s/2,_=c+1,S=m+1,T=0,C=0,x=new Ut,R=0;R<S;R++)for(var I=R*y-w,O=0;O<_;O++){var M=O*A-b;x[t]=M*r,x[e]=I*i,x[n]=E,d.push(x.x,x.y,x.z),x[t]=0,x[e]=0,x[n]=s>0?1:-1,h.push(x.x,x.y,x.z),f.push(O/c),f.push(1-R/m),T+=1}for(var L=0;L<m;L++)for(var k=0;k<c;k++){var B=p+k+_*L,N=p+k+_*(L+1),P=p+(k+1)+_*(L+1),U=p+(k+1)+_*L;l.push(B,N,U),l.push(N,P,U),C+=6}u.addGroup(v,C,g),v+=C,p+=T}return m("z","y","x",-1,-1,r,n,e,s,a,0),m("z","y","x",1,-1,r,n,-e,s,a,1),m("x","z","y",1,1,e,r,n,i,s,2),m("x","z","y",1,-1,e,r,-n,i,s,3),m("x","y","z",1,-1,e,n,r,i,a,4),m("x","y","z",-1,-1,e,n,-r,i,a,5),c.setIndex(l),c.setAttribute("position",new _n(d,3)),c.setAttribute("normal",new _n(h,3)),c.setAttribute("uv",new _n(f,2)),c}return i(e,t),e}(Nn);function nr(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}return e}function rr(t){for(var e={},n=0;n<t.length;n++){var r=nr(t[n]);for(var i in r)e[i]=r[i]}return e}var ir={clone:nr,merge:rr},or=function(t){function e(e){var n;return(n=t.call(this)||this).type="ShaderMaterial",n.defines={},n.uniforms={},n.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",n.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",n.linewidth=1,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.lights=!1,n.clipping=!1,n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},n.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},n.index0AttributeName=void 0,n.uniformsNeedUpdate=!1,n.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),n.setValues(e)),n}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);for(var r in n.glslVersion=this.glslVersion,n.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?n.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?n.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?n.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?n.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?n.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?n.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?n.uniforms[r]={type:"m4",value:i.toArray()}:n.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;var o={};for(var a in this.extensions)!0===this.extensions[a]&&(o[a]=!0);return Object.keys(o).length>0&&(n.extensions=o),n},e}(nn);or.prototype.isShaderMaterial=!0;var ar=function(t){function e(){var e;return(e=t.call(this)||this).type="Camera",e.matrixWorldInverse=new pe,e.projectionMatrix=new pe,e.projectionMatrixInverse=new pe,e}i(e,t);var n=e.prototype;return n.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},n.getWorldDirection=function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Ut),this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},n.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},n.updateWorldMatrix=function(e,n){t.prototype.updateWorldMatrix.call(this,e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()},n.clone=function(){return(new this.constructor).copy(this)},e}(Fe);ar.prototype.isCamera=!0;var sr=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=50),void 0===n&&(n=1),void 0===r&&(r=.1),void 0===i&&(i=2e3),(o=t.call(this)||this).type="PerspectiveCamera",o.fov=e,o.zoom=1,o.near=r,o.far=i,o.focus=10,o.aspect=n,o.view=null,o.filmGauge=35,o.filmOffset=0,o.updateProjectionMatrix(),o}i(e,t);var n=e.prototype;return n.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},n.setFocalLength=function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*gt*Math.atan(e),this.updateProjectionMatrix()},n.getFocalLength=function(){var t=Math.tan(.5*mt*this.fov);return.5*this.getFilmHeight()/t},n.getEffectiveFOV=function(){return 2*gt*Math.atan(Math.tan(.5*mt*this.fov)/this.zoom)},n.getFilmWidth=function(){return this.filmGauge*Math.min(this.aspect,1)},n.getFilmHeight=function(){return this.filmGauge/Math.max(this.aspect,1)},n.setViewOffset=function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},n.clearViewOffset=function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},n.updateProjectionMatrix=function(){var t=this.near,e=t*Math.tan(.5*mt*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var c=this.filmOffset;0!==c&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,null!==this.view&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n},e}(ar);sr.prototype.isPerspectiveCamera=!0;var cr=90,ur=function(t){function e(e,n,r){var i;if((i=t.call(this)||this).type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),o(i);i.renderTarget=r;var a=new sr(cr,1,e,n);a.layers=i.layers,a.up.set(0,-1,0),a.lookAt(new Ut(1,0,0)),i.add(a);var s=new sr(cr,1,e,n);s.layers=i.layers,s.up.set(0,-1,0),s.lookAt(new Ut(-1,0,0)),i.add(s);var c=new sr(cr,1,e,n);c.layers=i.layers,c.up.set(0,0,1),c.lookAt(new Ut(0,1,0)),i.add(c);var u=new sr(cr,1,e,n);u.layers=i.layers,u.up.set(0,0,-1),u.lookAt(new Ut(0,-1,0)),i.add(u);var l=new sr(cr,1,e,n);l.layers=i.layers,l.up.set(0,-1,0),l.lookAt(new Ut(0,0,1)),i.add(l);var d=new sr(cr,1,e,n);return d.layers=i.layers,d.up.set(0,-1,0),d.lookAt(new Ut(0,0,-1)),i.add(d),i}return i(e,t),e.prototype.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=this.children,i=r[0],o=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=t.xr.enabled,d=t.getRenderTarget();t.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,o),t.setRenderTarget(n,2),t.render(e,a),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,c),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,u),t.setRenderTarget(d),t.xr.enabled=l},e}(Fe),lr=function(t){function e(e,n,r,i,o,a,s,c,u,l){var d;return e=void 0!==e?e:[],n=void 0!==n?n:h,s=void 0!==s?s:k,(d=t.call(this,e,n,r,i,o,a,s,c,u,l)||this)._needsFlipEnvMap=!0,d.flipY=!1,d}return i(e,t),r(e,[{key:"images",get:function(){return this.image},set:function(t){this.image=t}}]),e}(Mt);lr.prototype.isCubeTexture=!0;var dr=function(t){function e(e,n,r){var i;return Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=r),i=t.call(this,e,e,n)||this,n=n||{},i.texture=new lr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),i.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,i.texture.minFilter=void 0!==n.minFilter?n.minFilter:S,i.texture._needsFlipEnvMap=!1,i}i(e,t);var n=e.prototype;return n.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=B,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new er(5,5,5),a=new or({name:"CubemapFromEquirect",uniforms:nr(n),vertexShader:r,fragmentShader:i,side:1,blending:0});a.uniforms.tEquirect.value=e;var s=new Zn(o,a),c=e.minFilter;return e.minFilter===C&&(e.minFilter=S),new ur(1,10,this).update(t,s),e.minFilter=c,s.geometry.dispose(),s.material.dispose(),this},n.clear=function(t,e,n,r){for(var i=t.getRenderTarget(),o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,r);t.setRenderTarget(i)},e}(Bt);dr.prototype.isWebGLCubeRenderTarget=!0;var hr=function(t){function e(e,n,r,i,o,a,s,c,u,l,d,h){var f;return(f=t.call(this,null,a,s,c,u,l,i,o,d,h)||this).image={data:e||null,width:n||1,height:r||1},f.magFilter=void 0!==u?u:w,f.minFilter=void 0!==l?l:w,f.generateMipmaps=!1,f.flipY=!1,f.unpackAlignment=1,f.needsUpdate=!0,f}return i(e,t),e}(Mt);hr.prototype.isDataTexture=!0;var fr=new oe,pr=new Ut,vr=function(){function t(t,e,n,r,i,o){void 0===t&&(t=new Ge),void 0===e&&(e=new Ge),void 0===n&&(n=new Ge),void 0===r&&(r=new Ge),void 0===i&&(i=new Ge),void 0===o&&(o=new Ge),this.planes=[t,e,n,r,i,o]}var e=t.prototype;return e.set=function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},e.copy=function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},e.setFromProjectionMatrix=function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],d=n[8],h=n[9],f=n[10],p=n[11],v=n[12],m=n[13],g=n[14],A=n[15];return e[0].setComponents(a-r,l-s,p-d,A-v).normalize(),e[1].setComponents(a+r,l+s,p+d,A+v).normalize(),e[2].setComponents(a+i,l+c,p+h,A+m).normalize(),e[3].setComponents(a-i,l-c,p-h,A-m).normalize(),e[4].setComponents(a-o,l-u,p-f,A-g).normalize(),e[5].setComponents(a+o,l+u,p+f,A+g).normalize(),this},e.intersectsObject=function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),fr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(fr)},e.intersectsSprite=function(t){return fr.center.set(0,0,0),fr.radius=.7071067811865476,fr.applyMatrix4(t.matrixWorld),this.intersectsSphere(fr)},e.intersectsSphere=function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++){if(e[i].distanceToPoint(n)<r)return!1}return!0},e.intersectsBox=function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(pr.x=r.normal.x>0?t.max.x:t.min.x,pr.y=r.normal.y>0?t.max.y:t.min.y,pr.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(pr)<0)return!1}return!0},e.containsPoint=function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0},e.clone=function(){return(new this.constructor).copy(this)},t}();function mr(){var t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function gr(t,e){var n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){var o=r.get(e);(!o||o.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);var a=r.get(e);void 0===a?r.set(e,function(e,r){var i=e.array,o=e.usage,a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,i,o),e.onUploadCallback();var s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?e.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):a.version<e.version&&(!function(e,r,i){var o=r.array,a=r.updateRange;t.bindBuffer(i,e),-1===a.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(a.buffer,e,i),a.version=e.version)}}}}var Ar=function(t){function e(e,n,r,i){var o;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),(o=t.call(this)||this).type="PlaneGeometry",o.parameters={width:e,height:n,widthSegments:r,heightSegments:i};for(var a=e/2,s=n/2,c=Math.floor(r),u=Math.floor(i),l=c+1,d=u+1,h=e/c,f=n/u,p=[],v=[],m=[],g=[],A=0;A<d;A++)for(var y=A*f-s,b=0;b<l;b++){var w=b*h-a;v.push(w,-y,0),m.push(0,0,1),g.push(b/c),g.push(1-A/u)}for(var E=0;E<u;E++)for(var _=0;_<c;_++){var S=_+l*E,T=_+l*(E+1),C=_+1+l*(E+1),x=_+1+l*E;p.push(S,T,x),p.push(T,C,x)}return o.setIndex(p),o.setAttribute("position",new _n(v,3)),o.setAttribute("normal",new _n(m,3)),o.setAttribute("uv",new _n(g,2)),o}return i(e,t),e}(Nn),yr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},br={common:{diffuse:{value:new ln(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rt},uv2Transform:{value:new Rt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ln(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ln(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Rt}},sprite:{diffuse:{value:new ln(15658734)},opacity:{value:1},center:{value:new Ct(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Rt}}},wr={basic:{uniforms:rr([br.common,br.specularmap,br.envmap,br.aomap,br.lightmap,br.fog]),vertexShader:yr.meshbasic_vert,fragmentShader:yr.meshbasic_frag},lambert:{uniforms:rr([br.common,br.specularmap,br.envmap,br.aomap,br.lightmap,br.emissivemap,br.fog,br.lights,{emissive:{value:new ln(0)}}]),vertexShader:yr.meshlambert_vert,fragmentShader:yr.meshlambert_frag},phong:{uniforms:rr([br.common,br.specularmap,br.envmap,br.aomap,br.lightmap,br.emissivemap,br.bumpmap,br.normalmap,br.displacementmap,br.fog,br.lights,{emissive:{value:new ln(0)},specular:{value:new ln(1118481)},shininess:{value:30}}]),vertexShader:yr.meshphong_vert,fragmentShader:yr.meshphong_frag},standard:{uniforms:rr([br.common,br.envmap,br.aomap,br.lightmap,br.emissivemap,br.bumpmap,br.normalmap,br.displacementmap,br.roughnessmap,br.metalnessmap,br.fog,br.lights,{emissive:{value:new ln(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag},toon:{uniforms:rr([br.common,br.aomap,br.lightmap,br.emissivemap,br.bumpmap,br.normalmap,br.displacementmap,br.gradientmap,br.fog,br.lights,{emissive:{value:new ln(0)}}]),vertexShader:yr.meshtoon_vert,fragmentShader:yr.meshtoon_frag},matcap:{uniforms:rr([br.common,br.bumpmap,br.normalmap,br.displacementmap,br.fog,{matcap:{value:null}}]),vertexShader:yr.meshmatcap_vert,fragmentShader:yr.meshmatcap_frag},points:{uniforms:rr([br.points,br.fog]),vertexShader:yr.points_vert,fragmentShader:yr.points_frag},dashed:{uniforms:rr([br.common,br.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yr.linedashed_vert,fragmentShader:yr.linedashed_frag},depth:{uniforms:rr([br.common,br.displacementmap]),vertexShader:yr.depth_vert,fragmentShader:yr.depth_frag},normal:{uniforms:rr([br.common,br.bumpmap,br.normalmap,br.displacementmap,{opacity:{value:1}}]),vertexShader:yr.normal_vert,fragmentShader:yr.normal_frag},sprite:{uniforms:rr([br.sprite,br.fog]),vertexShader:yr.sprite_vert,fragmentShader:yr.sprite_frag},background:{uniforms:{uvTransform:{value:new Rt},t2D:{value:null}},vertexShader:yr.background_vert,fragmentShader:yr.background_frag},cube:{uniforms:rr([br.envmap,{opacity:{value:1}}]),vertexShader:yr.cube_vert,fragmentShader:yr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yr.equirect_vert,fragmentShader:yr.equirect_frag},distanceRGBA:{uniforms:rr([br.common,br.displacementmap,{referencePosition:{value:new Ut},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yr.distanceRGBA_vert,fragmentShader:yr.distanceRGBA_frag},shadow:{uniforms:rr([br.lights,br.fog,{color:{value:new ln(0)},opacity:{value:1}}]),vertexShader:yr.shadow_vert,fragmentShader:yr.shadow_frag}};function Er(t,e,n,r,i){var o,a,s=new ln(0),c=0,u=null,l=0,d=null;function h(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return s},setClearColor:function(t,e){void 0===e&&(e=1),s.set(t),h(s,c=e)},getClearAlpha:function(){return c},setClearAlpha:function(t){h(s,c=t)},render:function(n,i,f,p){var v=!0===i.isScene?i.background:null;v&&v.isTexture&&(v=e.get(v));var g=t.xr,A=g.getSession&&g.getSession();A&&"additive"===A.environmentBlendMode&&(v=null),null===v?h(s,c):v&&v.isColor&&(h(v,1),p=!0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===m)?(void 0===a&&((a=new Zn(new er(1,1,1),new or({name:"BackgroundCubeMaterial",uniforms:nr(wr.cube.uniforms),vertexShader:wr.cube.vertexShader,fragmentShader:wr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,u===v&&l===v.version&&d===t.toneMapping||(a.material.needsUpdate=!0,u=v,l=v.version,d=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):v&&v.isTexture&&(void 0===o&&((o=new Zn(new Ar(2,2),new or({name:"BackgroundMaterial",uniforms:nr(wr.background.uniforms),vertexShader:wr.background.vertexShader,fragmentShader:wr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),o.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&l===v.version&&d===t.toneMapping||(o.material.needsUpdate=!0,u=v,l=v.version,d=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function _r(t,e,n,r){var i=t.getParameter(34921),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},c=h(null),u=c;function l(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function d(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function h(t){for(var e=[],n=[],r=[],o=0;o<i;o++)e[o]=0,n[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function f(){for(var t=u.newAttributes,e=0,n=t.length;e<n;e++)t[e]=0}function p(t){v(t,0)}function v(n,i){var o=u.newAttributes,a=u.enabledAttributes,s=u.attributeDivisors;(o[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),s[n]!==i)&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function m(){for(var e=u.newAttributes,n=u.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function g(e,n,i,o,a,s){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,o,a,s):t.vertexAttribIPointer(e,n,i,a,s)}function A(){y(),u!==c&&l((u=c).object)}function y(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,d,A,y){var b=!1;if(a){var w=function(e,n,i){var a=!0===i.wireframe,c=s[e.id];void 0===c&&(c={},s[e.id]=c);var u=c[n.id];void 0===u&&(u={},c[n.id]=u);var l=u[a];void 0===l&&(l=h(r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),u[a]=l);return l}(A,d,c);u!==w&&l((u=w).object),(b=function(t,e){var n=u.attributes,r=t.attributes,i=0;for(var o in r){var a=n[o],s=r[o];if(void 0===a)return!0;if(a.attribute!==s)return!0;if(a.data!==s.data)return!0;i++}return u.attributesNum!==i||u.index!==e}(A,y))&&function(t,e){var n={},r=t.attributes,i=0;for(var o in r){var a=r[o],s={};s.attribute=a,a.data&&(s.data=a.data),n[o]=s,i++}u.attributes=n,u.attributesNum=i,u.index=e}(A,y)}else{var E=!0===c.wireframe;u.geometry===A.id&&u.program===d.id&&u.wireframe===E||(u.geometry=A.id,u.program=d.id,u.wireframe=E,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==y&&n.update(y,34963),b&&(!function(i,o,a,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();var c=s.attributes,u=a.getAttributes(),l=o.defaultAttributeValues;for(var d in u){var h=u[d];if(h>=0){var A=c[d];if(void 0!==A){var y=A.normalized,b=A.itemSize,w=n.get(A);if(void 0===w)continue;var E=w.buffer,_=w.type,S=w.bytesPerElement;if(A.isInterleavedBufferAttribute){var T=A.data,C=T.stride,x=A.offset;T&&T.isInstancedInterleavedBuffer?(v(h,T.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=T.meshPerAttribute*T.count)):p(h),t.bindBuffer(34962,E),g(h,b,_,y,C*S,x*S)}else A.isInstancedBufferAttribute?(v(h,A.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=A.meshPerAttribute*A.count)):p(h),t.bindBuffer(34962,E),g(h,b,_,y,0,0)}else if("instanceMatrix"===d){var R=n.get(i.instanceMatrix);if(void 0===R)continue;var I=R.buffer,O=R.type;v(h+0,1),v(h+1,1),v(h+2,1),v(h+3,1),t.bindBuffer(34962,I),t.vertexAttribPointer(h+0,4,O,!1,64,0),t.vertexAttribPointer(h+1,4,O,!1,64,16),t.vertexAttribPointer(h+2,4,O,!1,64,32),t.vertexAttribPointer(h+3,4,O,!1,64,48)}else if("instanceColor"===d){var M=n.get(i.instanceColor);if(void 0===M)continue;var L=M.buffer,k=M.type;v(h,1),t.bindBuffer(34962,L),t.vertexAttribPointer(h,3,k,!1,12,0)}else if(void 0!==l){var B=l[d];if(void 0!==B)switch(B.length){case 2:t.vertexAttrib2fv(h,B);break;case 3:t.vertexAttrib3fv(h,B);break;case 4:t.vertexAttrib4fv(h,B);break;default:t.vertexAttrib1fv(h,B)}}}}m()}(i,c,d,A),null!==y&&t.bindBuffer(34963,n.get(y).buffer))},reset:A,resetDefaultState:y,dispose:function(){for(var t in A(),s){var e=s[t];for(var n in e){var r=e[n];for(var i in r)d(r[i].object),delete r[i];delete e[n]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0!==s[t.id]){var e=s[t.id];for(var n in e){var r=e[n];for(var i in r)d(r[i].object),delete r[i];delete e[n]}delete s[t.id]}},releaseStatesOfProgram:function(t){for(var e in s){var n=s[e];if(void 0!==n[t.id]){var r=n[t.id];for(var i in r)d(r[i].object),delete r[i];delete n[t.id]}}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:m}}function Sr(t,e,n,r){var i,o=r.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=function(r,a,s){if(0!==s){var c,u;if(o)c=t,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](i,r,a,s),n.update(a,i,s)}}}function Tr(t,e,n){var r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var c=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),l=t.getParameter(35660),d=t.getParameter(3379),h=t.getParameter(34076),f=t.getParameter(34921),p=t.getParameter(36347),v=t.getParameter(36348),m=t.getParameter(36349),g=l>0,A=o||e.has("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){var n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:l,maxTextureSize:d,maxCubemapSize:h,maxAttributes:f,maxVertexUniforms:p,maxVaryings:v,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:A,floatVertexTextures:g&&A,maxSamples:o?t.getParameter(36183):0}}function Cr(t){var e=this,n=null,r=0,i=!1,o=!1,a=new Ge,s=new Rt,c={value:null,needsUpdate:!1};function u(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function l(t,n,r,i){var o=null!==t?t.length:0,u=null;if(0!==o){if(u=c.value,!0!==i||null===u){var l=r+4*o,d=n.matrixWorldInverse;s.getNormalMatrix(d),(null===u||u.length<l)&&(u=new Float32Array(l));for(var h=0,f=r;h!==o;++h,f+=4)a.copy(t[h]).applyMatrix4(d,s),a.normal.toArray(u,f),u[f+3]=a.constant}c.value=u,c.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,u}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){var a=0!==t.length||e||0!==r||i;return i=e,n=l(t,o,0),r=t.length,a},this.beginShadows=function(){o=!0,l(null)},this.endShadows=function(){o=!1,u()},this.setState=function(e,a,s){var d=e.clippingPlanes,h=e.clipIntersection,f=e.clipShadows,p=t.get(e);if(!i||null===d||0===d.length||o&&!f)o?l(null):u();else{var v=o?0:r,m=4*v,g=p.clippingState||null;c.value=g,g=l(d,a,m,s);for(var A=0;A!==m;++A)g[A]=n[A];p.clippingState=g,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=v}}}function xr(t){var e=new WeakMap;function n(t,e){return e===p?t.mapping=h:e===v&&(t.mapping=f),t}function r(t){var n=t.target;n.removeEventListener("dispose",r);var i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var o=i.mapping;if(o===p||o===v){if(e.has(i))return n(e.get(i).texture,i.mapping);var a=i.image;if(a&&a.height>0){var s=t.getRenderTarget(),c=new dr(a.height/2);return c.fromEquirectangularTexture(t,i),e.set(i,c),t.setRenderTarget(s),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}return i},dispose:function(){e=new WeakMap}}}function Rr(t){var e={};function n(n){if(void 0!==e[n])return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){var e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Ir(t,e,n,r){var i={},o=new WeakMap;function a(t){var s=t.target;for(var c in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[c]);s.removeEventListener("dispose",a),delete i[s.id];var u=o.get(s);u&&(e.remove(u),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){var n=[],r=t.index,i=t.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var c=0,u=s.length;c<u;c+=3){var l=s[c+0],d=s[c+1],h=s[c+2];n.push(l,d,d,h,h,l)}}else{var f=i.array;a=i.version;for(var p=0,v=f.length/3-1;p<v;p+=3){var m=p+0,g=p+1,A=p+2;n.push(m,g,g,A,A,m)}}var y=new(Tn(n)>65535?wn:yn)(n,1);y.version=a;var b=o.get(t);b&&e.remove(b),o.set(t,y)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",a),i[e.id]=!0,n.memory.geometries++),e},update:function(t){var n=t.attributes;for(var r in n)e.update(n[r],34962);var i=t.morphAttributes;for(var o in i)for(var a=i[o],s=0,c=a.length;s<c;s++)e.update(a[s],34962)},getWireframeAttribute:function(t){var e=o.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return o.get(t)}}}function Or(t,e,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,o,e*a),n.update(r,i,1)},this.renderInstances=function(r,c,u){if(0!==u){var l,d;if(s)l=t,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[d](i,c,o,r*a,u),n.update(c,i,u)}}}function Mr(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Lr(t,e){return t[0]-e[0]}function kr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Br(t){for(var e={},n=new Float32Array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,o,a,s){var c=i.morphTargetInfluences,u=void 0===c?0:c.length,l=e[o.id];if(void 0===l){l=[];for(var d=0;d<u;d++)l[d]=[d,0];e[o.id]=l}for(var h=0;h<u;h++){var f=l[h];f[0]=h,f[1]=c[h]}l.sort(kr);for(var p=0;p<8;p++)p<u&&l[p][1]?(r[p][0]=l[p][0],r[p][1]=l[p][1]):(r[p][0]=Number.MAX_SAFE_INTEGER,r[p][1]=0);r.sort(Lr);for(var v=a.morphTargets&&o.morphAttributes.position,m=a.morphNormals&&o.morphAttributes.normal,g=0,A=0;A<8;A++){var y=r[A],b=y[0],w=y[1];b!==Number.MAX_SAFE_INTEGER&&w?(v&&o.getAttribute("morphTarget"+A)!==v[b]&&o.setAttribute("morphTarget"+A,v[b]),m&&o.getAttribute("morphNormal"+A)!==m[b]&&o.setAttribute("morphNormal"+A,m[b]),n[A]=w,g+=w):(v&&!0===o.hasAttribute("morphTarget"+A)&&o.deleteAttribute("morphTarget"+A),m&&!0===o.hasAttribute("morphNormal"+A)&&o.deleteAttribute("morphNormal"+A),n[A]=0)}var E=o.morphTargetsRelative?1:1-g;s.getUniforms().setValue(t,"morphTargetBaseInfluence",E),s.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Nr(t,e,n,r){var i=new WeakMap;function o(t){var e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){var a=r.render.frame,s=t.geometry,c=e.get(t,s);return i.get(c)!==a&&(e.update(c),i.set(c,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",o)&&t.addEventListener("dispose",o),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),c},dispose:function(){i=new WeakMap}}}wr.physical={uniforms:rr([wr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ct(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ln(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag};var Pr=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=null),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),(o=t.call(this,null)||this).image={data:e,width:n,height:r,depth:i},o.magFilter=w,o.minFilter=w,o.wrapR=y,o.generateMipmaps=!1,o.flipY=!1,o.unpackAlignment=1,o.needsUpdate=!0,o}return i(e,t),e}(Mt);Pr.prototype.isDataTexture2DArray=!0;var Ur=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=null),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),(o=t.call(this,null)||this).image={data:e,width:n,height:r,depth:i},o.magFilter=w,o.minFilter=w,o.wrapR=y,o.generateMipmaps=!1,o.flipY=!1,o.unpackAlignment=1,o.needsUpdate=!0,o}return i(e,t),e}(Mt);Ur.prototype.isDataTexture3D=!0;var Dr=new Mt,Fr=new Pr,Hr=new Ur,jr=new lr,Vr=[],Gr=[],Qr=new Float32Array(16),zr=new Float32Array(9),qr=new Float32Array(4);function Wr(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,o=Vr[i];if(void 0===o&&(o=new Float32Array(i),Vr[i]=o),0!==e){r.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=n,t[a].toArray(o,s)}return o}function Kr(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Xr(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function Jr(t,e){var n=Gr[e];void 0===n&&(n=new Int32Array(e),Gr[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Yr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function $r(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Kr(n,e))return;t.uniform2fv(this.addr,e),Xr(n,e)}}function Zr(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Kr(n,e))return;t.uniform3fv(this.addr,e),Xr(n,e)}}function ti(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Kr(n,e))return;t.uniform4fv(this.addr,e),Xr(n,e)}}function ei(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(Kr(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Xr(n,e)}else{if(Kr(n,r))return;qr.set(r),t.uniformMatrix2fv(this.addr,!1,qr),Xr(n,r)}}function ni(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(Kr(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Xr(n,e)}else{if(Kr(n,r))return;zr.set(r),t.uniformMatrix3fv(this.addr,!1,zr),Xr(n,r)}}function ri(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(Kr(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Xr(n,e)}else{if(Kr(n,r))return;Qr.set(r),t.uniformMatrix4fv(this.addr,!1,Qr),Xr(n,r)}}function ii(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function oi(t,e){var n=this.cache;Kr(n,e)||(t.uniform2iv(this.addr,e),Xr(n,e))}function ai(t,e){var n=this.cache;Kr(n,e)||(t.uniform3iv(this.addr,e),Xr(n,e))}function si(t,e){var n=this.cache;Kr(n,e)||(t.uniform4iv(this.addr,e),Xr(n,e))}function ci(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ui(t,e){var n=this.cache;Kr(n,e)||(t.uniform2uiv(this.addr,e),Xr(n,e))}function li(t,e){var n=this.cache;Kr(n,e)||(t.uniform3uiv(this.addr,e),Xr(n,e))}function di(t,e){var n=this.cache;Kr(n,e)||(t.uniform4uiv(this.addr,e),Xr(n,e))}function hi(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||Dr,i)}function fi(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Hr,i)}function pi(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||jr,i)}function vi(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Fr,i)}function mi(t,e){t.uniform1fv(this.addr,e)}function gi(t,e){var n=Wr(e,this.size,2);t.uniform2fv(this.addr,n)}function Ai(t,e){var n=Wr(e,this.size,3);t.uniform3fv(this.addr,n)}function yi(t,e){var n=Wr(e,this.size,4);t.uniform4fv(this.addr,n)}function bi(t,e){var n=Wr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function wi(t,e){var n=Wr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Ei(t,e){var n=Wr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function _i(t,e){t.uniform1iv(this.addr,e)}function Si(t,e){t.uniform2iv(this.addr,e)}function Ti(t,e){t.uniform3iv(this.addr,e)}function Ci(t,e){t.uniform4iv(this.addr,e)}function xi(t,e){t.uniform1uiv(this.addr,e)}function Ri(t,e){t.uniform2uiv(this.addr,e)}function Ii(t,e){t.uniform3uiv(this.addr,e)}function Oi(t,e){t.uniform4uiv(this.addr,e)}function Mi(t,e,n){var r=e.length,i=Jr(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(e[o]||Dr,i[o])}function Li(t,e,n){var r=e.length,i=Jr(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(e[o]||jr,i[o])}function ki(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Yr;case 35664:return $r;case 35665:return Zr;case 35666:return ti;case 35674:return ei;case 35675:return ni;case 35676:return ri;case 5124:case 35670:return ii;case 35667:case 35671:return oi;case 35668:case 35672:return ai;case 35669:case 35673:return si;case 5125:return ci;case 36294:return ui;case 36295:return li;case 36296:return di;case 35678:case 36198:case 36298:case 36306:case 35682:return hi;case 35679:case 36299:case 36307:return fi;case 35680:case 36300:case 36308:case 36293:return pi;case 36289:case 36303:case 36311:case 36292:return vi}}(e.type)}function Bi(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return mi;case 35664:return gi;case 35665:return Ai;case 35666:return yi;case 35674:return bi;case 35675:return wi;case 35676:return Ei;case 5124:case 35670:return _i;case 35667:case 35671:return Si;case 35668:case 35672:return Ti;case 35669:case 35673:return Ci;case 5125:return xi;case 36294:return Ri;case 36295:return Ii;case 36296:return Oi;case 35678:case 36198:case 36298:case 36306:case 35682:return Mi;case 35680:case 36300:case 36308:case 36293:return Li}}(e.type)}function Ni(t){this.id=t,this.seq=[],this.map={}}Bi.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Xr(e,t)},Ni.prototype.setValue=function(t,e,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(t,e[a.id],n)}};var Pi=/(\w+)(\])?(\[|\.)?/g;function Ui(t,e){t.seq.push(e),t.map[e.id]=e}function Di(t,e,n){var r=t.name,i=r.length;for(Pi.lastIndex=0;;){var o=Pi.exec(r),a=Pi.lastIndex,s=o[1],c="]"===o[2],u=o[3];if(c&&(s|=0),void 0===u||"["===u&&a+2===i){Ui(n,void 0===u?new ki(s,t,e):new Bi(s,t,e));break}var l=n.map[s];void 0===l&&Ui(n,l=new Ni(s)),n=l}}function Fi(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),r=0;r<n;++r){var i=t.getActiveUniform(e,r);Di(i,t.getUniformLocation(e,i.name),this)}}function Hi(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Fi.prototype.setValue=function(t,e,n,r){var i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Fi.prototype.setOptional=function(t,e,n){var r=e[n];void 0!==r&&this.setValue(t,n,r)},Fi.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},Fi.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n};var ji=0;function Vi(t){switch(t){case et:return["Linear","( value )"];case nt:return["sRGB","( value )"];case it:return["RGBE","( value )"];case ot:return["RGBM","( value, 7.0 )"];case at:return["RGBM","( value, 16.0 )"];case st:return["RGBD","( value, 256.0 )"];case rt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Gi(t,e,n){var r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getShaderSource(e))}function Qi(t,e){var n=Vi(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function zi(t,e){var n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function qi(t){return""!==t}function Wi(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ki(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Xi=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ji(t){return t.replace(Xi,Yi)}function Yi(t,e){var n=yr[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Ji(n)}var $i=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Zi=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function to(t){return t.replace(Zi,no).replace($i,eo)}function eo(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),no(t,e,n,r)}function no(t,e,n,r){for(var i="",o=parseInt(e);o<parseInt(n);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function ro(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function io(t,e,n,r){var i,o,a,s,c,u=t.getContext(),l=n.defines,d=n.vertexShader,p=n.fragmentShader,v=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),A=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case h:case f:e="ENVMAP_TYPE_CUBE";break;case m:case g:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),y=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case f:case g:e="ENVMAP_MODE_REFRACTION"}return e}(n),b=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),w=t.gammaFactor>0?t.gammaFactor:1,E=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(qi).join("\n")}(n),_=function(t){var e=[];for(var n in t){var r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(l),S=u.createProgram(),T=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[_].filter(qi).join("\n")).length>0&&(i+="\n"),(o=[E,_].filter(qi).join("\n")).length>0&&(o+="\n")):(i=[ro(n),"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+y:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+v:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(qi).join("\n"),o=[E,ro(n),"#define SHADER_NAME "+n.shaderName,_,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+w,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+A:"",n.envMap?"#define "+y:"",n.envMap?"#define "+b:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+v:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?yr.tonemapping_pars_fragment:"",0!==n.toneMapping?zi("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",yr.encodings_pars_fragment,n.map?Qi("mapTexelToLinear",n.mapEncoding):"",n.matcap?Qi("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Qi("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Qi("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Qi("lightMapTexelToLinear",n.lightMapEncoding):"",(a="linearToOutputTexel",s=n.outputEncoding,c=Vi(s),"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(qi).join("\n")),d=Ki(d=Wi(d=Ji(d),n),n),p=Ki(p=Wi(p=Ji(p),n),n),d=to(d),p=to(p),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(T="#version 300 es\n",i=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,o=["#define varying in",n.glslVersion===dt?"":"out highp vec4 pc_fragColor;",n.glslVersion===dt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);var C,x,R=T+o+p,I=Hi(u,35633,T+i+d),O=Hi(u,35632,R);if(u.attachShader(S,I),u.attachShader(S,O),void 0!==n.index0AttributeName?u.bindAttribLocation(S,0,n.index0AttributeName):!0===n.morphTargets&&u.bindAttribLocation(S,0,"position"),u.linkProgram(S),t.debug.checkShaderErrors){var M=u.getProgramInfoLog(S).trim(),L=u.getShaderInfoLog(I).trim(),k=u.getShaderInfoLog(O).trim(),B=!0,N=!0;if(!1===u.getProgramParameter(S,35714)){B=!1;var P=Gi(u,I,"vertex"),U=Gi(u,O,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(S,35715),"gl.getProgramInfoLog",M,P,U)}else""!==M?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",M):""!==L&&""!==k||(N=!1);N&&(this.diagnostics={runnable:B,programLog:M,vertexShader:{log:L,prefix:i},fragmentShader:{log:k,prefix:o}})}return u.deleteShader(I),u.deleteShader(O),this.getUniforms=function(){return void 0===C&&(C=new Fi(u,S)),C},this.getAttributes=function(){return void 0===x&&(x=function(t,e){for(var n={},r=t.getProgramParameter(e,35721),i=0;i<r;i++){var o=t.getActiveAttrib(e,i).name;n[o]=t.getAttribLocation(e,o)}return n}(u,S)),x},this.destroy=function(){r.releaseStatesOfProgram(this),u.deleteProgram(S),this.program=void 0},this.name=n.shaderName,this.id=ji++,this.cacheKey=e,this.usedTimes=1,this.program=S,this.vertexShader=I,this.fragmentShader=O,this}function oo(t,e,n,r,i,o){var a=[],s=r.isWebGL2,c=r.logarithmicDepthBuffer,u=r.floatVertexTextures,l=r.maxVertexUniforms,d=r.vertexTextures,h=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(t){var e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=et,e}return{getParameters:function(i,a,p,A,y){var b,w,E=A.fog,_=i.isMeshStandardMaterial?A.environment:null,S=e.get(i.envMap||_),T=f[i.type],C=y.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(u)return 1024;var n=l,r=Math.floor((n-20)/4),i=Math.min(r,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(y):0;if(null!==i.precision&&(h=r.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead."),T){var x=wr[T];b=x.vertexShader,w=x.fragmentShader}else b=i.vertexShader,w=i.fragmentShader;var R=t.getRenderTarget();return{isWebGL2:s,shaderID:T,shaderName:i.type,vertexShader:b,fragmentShader:w,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:h,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:d,outputEncoding:null!==R?v(R.texture):t.outputEncoding,map:!!i.map,mapEncoding:v(i.map),matcap:!!i.matcap,matcapEncoding:v(i.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:v(S),envMapCubeUV:!!S&&(S.mapping===m||S.mapping===g),lightMap:!!i.lightMap,lightMapEncoding:v(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:v(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&y.geometry&&y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!E,useFog:i.fog,fogExp2:E&&E.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:c,skinning:i.skinning&&C>0,maxBones:C,useVertexTexture:u,morphTargets:i.morphTargets,morphNormals:i.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);if(!1===e.isRawShaderMaterial){for(var i=0;i<p.length;i++)n.push(e[p[i]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){var e,n=f[t.type];if(n){var r=wr[n];e=ir.clone(r.uniforms)}else e=t.uniforms;return e},acquireProgram:function(e,n){for(var r,o=0,s=a.length;o<s;o++){var c=a[o];if(c.cacheKey===n){++(r=c).usedTimes;break}}return void 0===r&&(r=new io(t,n,e,i),a.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){var e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function ao(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function so(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function co(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function uo(t){var e=[],n=0,r=[],i=[],o={id:-1};function a(r,i,a,s,c,u){var l=e[n],d=t.get(a);return void 0===l?(l={id:r.id,object:r,geometry:i,material:a,program:d.program||o,groupOrder:s,renderOrder:r.renderOrder,z:c,group:u},e[n]=l):(l.id=r.id,l.object=r,l.geometry=i,l.material=a,l.program=d.program||o,l.groupOrder=s,l.renderOrder=r.renderOrder,l.z=c,l.group=u),n++,l}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,o,s,c){var u=a(t,e,n,o,s,c);(!0===n.transparent?i:r).push(u)},unshift:function(t,e,n,o,s,c){var u=a(t,e,n,o,s,c);(!0===n.transparent?i:r).unshift(u)},finish:function(){for(var t=n,r=e.length;t<r;t++){var i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){r.length>1&&r.sort(t||so),i.length>1&&i.sort(e||co)}}}function lo(t){var e=new WeakMap;return{get:function(n,r){var i;return!1===e.has(n)?(i=new uo(t),e.set(n,[i])):r>=e.get(n).length?(i=new uo(t),e.get(n).push(i)):i=e.get(n)[r],i},dispose:function(){e=new WeakMap}}}function ho(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new Ut,color:new ln};break;case"SpotLight":n={position:new Ut,direction:new Ut,color:new ln,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ut,color:new ln,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ut,skyColor:new ln,groundColor:new ln};break;case"RectAreaLight":n={color:new ln,position:new Ut,halfWidth:new Ut,halfHeight:new Ut}}return t[e.id]=n,n}}}var fo=0;function po(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function vo(t,e){for(var n,r=new ho,i=(n={},{get:function(t){if(void 0!==n[t.id])return n[t.id];var e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct,shadowCameraNear:1,shadowCameraFar:1e3}}return n[t.id]=e,e}}),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)o.probe.push(new Ut);var s=new Ut,c=new pe,u=new pe;return{setup:function(n){for(var a=0,s=0,c=0,u=0;u<9;u++)o.probe[u].set(0,0,0);var l=0,d=0,h=0,f=0,p=0,v=0,m=0,g=0;n.sort(po);for(var A=0,y=n.length;A<y;A++){var b=n[A],w=b.color,E=b.intensity,_=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)a+=w.r*E,s+=w.g*E,c+=w.b*E;else if(b.isLightProbe)for(var T=0;T<9;T++)o.probe[T].addScaledVector(b.sh.coefficients[T],E);else if(b.isDirectionalLight){var C=r.get(b);if(C.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){var x=b.shadow,R=i.get(b);R.shadowBias=x.bias,R.shadowNormalBias=x.normalBias,R.shadowRadius=x.radius,R.shadowMapSize=x.mapSize,o.directionalShadow[l]=R,o.directionalShadowMap[l]=S,o.directionalShadowMatrix[l]=b.shadow.matrix,v++}o.directional[l]=C,l++}else if(b.isSpotLight){var I=r.get(b);if(I.position.setFromMatrixPosition(b.matrixWorld),I.color.copy(w).multiplyScalar(E),I.distance=_,I.coneCos=Math.cos(b.angle),I.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),I.decay=b.decay,b.castShadow){var O=b.shadow,M=i.get(b);M.shadowBias=O.bias,M.shadowNormalBias=O.normalBias,M.shadowRadius=O.radius,M.shadowMapSize=O.mapSize,o.spotShadow[h]=M,o.spotShadowMap[h]=S,o.spotShadowMatrix[h]=b.shadow.matrix,g++}o.spot[h]=I,h++}else if(b.isRectAreaLight){var L=r.get(b);L.color.copy(w).multiplyScalar(E),L.halfWidth.set(.5*b.width,0,0),L.halfHeight.set(0,.5*b.height,0),o.rectArea[f]=L,f++}else if(b.isPointLight){var k=r.get(b);if(k.color.copy(b.color).multiplyScalar(b.intensity),k.distance=b.distance,k.decay=b.decay,b.castShadow){var B=b.shadow,N=i.get(b);N.shadowBias=B.bias,N.shadowNormalBias=B.normalBias,N.shadowRadius=B.radius,N.shadowMapSize=B.mapSize,N.shadowCameraNear=B.camera.near,N.shadowCameraFar=B.camera.far,o.pointShadow[d]=N,o.pointShadowMap[d]=S,o.pointShadowMatrix[d]=b.shadow.matrix,m++}o.point[d]=k,d++}else if(b.isHemisphereLight){var P=r.get(b);P.skyColor.copy(b.color).multiplyScalar(E),P.groundColor.copy(b.groundColor).multiplyScalar(E),o.hemi[p]=P,p++}}f>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(o.rectAreaLTC1=br.LTC_FLOAT_1,o.rectAreaLTC2=br.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=br.LTC_HALF_1,o.rectAreaLTC2=br.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=a,o.ambient[1]=s,o.ambient[2]=c;var U=o.hash;U.directionalLength===l&&U.pointLength===d&&U.spotLength===h&&U.rectAreaLength===f&&U.hemiLength===p&&U.numDirectionalShadows===v&&U.numPointShadows===m&&U.numSpotShadows===g||(o.directional.length=l,o.spot.length=h,o.rectArea.length=f,o.point.length=d,o.hemi.length=p,o.directionalShadow.length=v,o.directionalShadowMap.length=v,o.pointShadow.length=m,o.pointShadowMap.length=m,o.spotShadow.length=g,o.spotShadowMap.length=g,o.directionalShadowMatrix.length=v,o.pointShadowMatrix.length=m,o.spotShadowMatrix.length=g,U.directionalLength=l,U.pointLength=d,U.spotLength=h,U.rectAreaLength=f,U.hemiLength=p,U.numDirectionalShadows=v,U.numPointShadows=m,U.numSpotShadows=g,o.version=fo++)},setupView:function(t,e){for(var n=0,r=0,i=0,a=0,l=0,d=e.matrixWorldInverse,h=0,f=t.length;h<f;h++){var p=t[h];if(p.isDirectionalLight){var v=o.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(s),v.direction.transformDirection(d),n++}else if(p.isSpotLight){var m=o.spot[i];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(d),m.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(s),m.direction.transformDirection(d),i++}else if(p.isRectAreaLight){var g=o.rectArea[a];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(d),u.identity(),c.copy(p.matrixWorld),c.premultiply(d),u.extractRotation(c),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),a++}else if(p.isPointLight){var A=o.point[r];A.position.setFromMatrixPosition(p.matrixWorld),A.position.applyMatrix4(d),r++}else if(p.isHemisphereLight){var y=o.hemi[l];y.direction.setFromMatrixPosition(p.matrixWorld),y.direction.transformDirection(d),y.direction.normalize(),l++}}},state:o}}function mo(t,e){var n=new vo(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function go(t,e){var n=new WeakMap;return{get:function(r,i){var o;return void 0===i&&(i=0),!1===n.has(r)?(o=new mo(t,e),n.set(r,[o])):i>=n.get(r).length?(o=new mo(t,e),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}var Ao=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshDepthMaterial",n.depthPacking=3200,n.skinning=!1,n.morphTargets=!1,n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},e}(nn);Ao.prototype.isMeshDepthMaterial=!0;var yo=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshDistanceMaterial",n.referencePosition=new Ut,n.nearDistance=1,n.farDistance=1e3,n.skinning=!1,n.morphTargets=!1,n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.fog=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},e}(nn);yo.prototype.isMeshDistanceMaterial=!0;function bo(t,e,n){var r=new vr,i=new Ct,o=new Ct,a=new kt,s=[],c=[],u={},l=n.maxTextureSize,d={0:1,1:0,2:2},h=new or({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ct},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;var p=new Nn;p.setAttribute("position",new pn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Zn(p,h),m=this;function g(n,r){var i=e.update(v);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,h,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,f,v,null)}function A(t,e,n){var r=t<<0|e<<1|n<<2,i=s[r];return void 0===i&&(i=new Ao({depthPacking:3201,morphTargets:t,skinning:e}),s[r]=i),i}function y(t,e,n){var r=t<<0|e<<1|n<<2,i=c[r];return void 0===i&&(i=new yo({morphTargets:t,skinning:e}),c[r]=i),i}function b(e,n,r,i,o,a,s){var c=null,l=A,h=e.customDepthMaterial;if(!0===i.isPointLight&&(l=y,h=e.customDistanceMaterial),void 0===h){var f=!1;!0===r.morphTargets&&(f=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var p=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),c=l(f,p,!0===e.isInstancedMesh)}else c=h;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var v=c.uuid,m=r.uuid,g=u[v];void 0===g&&(g={},u[v]=g);var b=g[m];void 0===b&&(b=c.clone(),g[m]=b),c=b}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=3===s?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:d[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===i.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(i.matrixWorld),c.nearDistance=o,c.farDistance=a),c}function E(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var c=e.update(n),u=n.material;if(Array.isArray(u))for(var l=c.groups,d=0,h=l.length;d<h;d++){var f=l[d],p=u[f.materialIndex];if(p&&p.visible){var v=b(n,c,p,a,o.near,o.far,s);t.renderBufferDirect(o,null,c,v,n,f)}}else if(u.visible){var m=b(n,c,u,a,o.near,o.far,s);t.renderBufferDirect(o,null,c,m,n,null)}}for(var g=n.children,A=0,y=g.length;A<y;A++)E(g[A],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==e.length){var c=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),h=t.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var f=0,p=e.length;f<p;f++){var v=e[f],A=v.shadow;if(void 0!==A){if(!1!==A.autoUpdate||!1!==A.needsUpdate){i.copy(A.mapSize);var y=A.getFrameExtents();if(i.multiply(y),o.copy(A.mapSize),(i.x>l||i.y>l)&&(i.x>l&&(o.x=Math.floor(l/y.x),i.x=o.x*y.x,A.mapSize.x=o.x),i.y>l&&(o.y=Math.floor(l/y.y),i.y=o.y*y.y,A.mapSize.y=o.y)),null===A.map&&!A.isPointLightShadow&&3===this.type){var b={minFilter:S,magFilter:S,format:B};A.map=new Bt(i.x,i.y,b),A.map.texture.name=v.name+".shadowMap",A.mapPass=new Bt(i.x,i.y,b),A.camera.updateProjectionMatrix()}if(null===A.map){var _={minFilter:w,magFilter:w,format:B};A.map=new Bt(i.x,i.y,_),A.map.texture.name=v.name+".shadowMap",A.camera.updateProjectionMatrix()}t.setRenderTarget(A.map),t.clear();for(var T=A.getViewportCount(),C=0;C<T;C++){var x=A.getViewport(C);a.set(o.x*x.x,o.y*x.y,o.x*x.z,o.y*x.w),h.viewport(a),A.updateMatrices(v,C),r=A.getFrustum(),E(n,s,A.camera,v,this.type)}A.isPointLightShadow||3!==this.type||g(A,s),A.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,t.setRenderTarget(c,u,d)}}}function wo(t,e,n){var r,i,o=n.isWebGL2;var a=new function(){var e=!1,n=new kt,r=null,i=new kt(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var e=!1,n=null,r=null,i=null;return{setTest:function(t){t?D(2929):F(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},c=new function(){var e=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null;return{setTest:function(t){e||(t?D(2960):F(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){a===e&&s===n&&c===r||(t.stencilOp(e,n,r),a=e,s=n,c=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null}}},u={},d=null,h={},f=null,p=!1,v=null,m=null,g=null,A=null,y=null,b=null,w=null,E=!1,_=null,S=null,T=null,C=null,x=null,R=t.getParameter(35661),I=!1,O=0,M=t.getParameter(7938);-1!==M.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(M)[1]),I=O>=1):-1!==M.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(M)[1]),I=O>=2);var L=null,k={},B=new kt(0,0,t.canvas.width,t.canvas.height),N=new kt(0,0,t.canvas.width,t.canvas.height);function P(e,n,r){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var a=0;a<r;a++)t.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var U={};function D(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function F(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}U[3553]=P(3553,3553,1),U[34067]=P(34067,34069,6),a.setClear(0,0,0,1),s.setClear(1),c.setClear(0),D(2929),s.setFunc(3),Q(!1),z(1),D(2884),G(0);var H=((r={})[100]=32774,r[101]=32778,r[102]=32779,r);if(o)H[103]=32775,H[104]=32776;else{var j=e.get("EXT_blend_minmax");null!==j&&(H[103]=j.MIN_EXT,H[104]=j.MAX_EXT)}var V=((i={})[200]=0,i[201]=1,i[202]=768,i[204]=770,i[210]=776,i[208]=774,i[206]=772,i[203]=769,i[205]=771,i[209]=775,i[207]=773,i);function G(e,n,r,i,o,a,s,c){if(0!==e){if(!1===p&&(D(3042),p=!0),5===e)o=o||n,a=a||r,s=s||i,n===m&&o===y||(t.blendEquationSeparate(H[n],H[o]),m=n,y=o),r===g&&i===A&&a===b&&s===w||(t.blendFuncSeparate(V[r],V[i],V[a],V[s]),g=r,A=i,b=a,w=s),v=e,E=null;else if(e!==v||c!==E){if(m===l&&y===l||(t.blendEquation(32774),m=l,y=l),c)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,A=null,b=null,w=null,v=e,E=c}}else!0===p&&(F(3042),p=!1)}function Q(e){_!==e&&(e?t.frontFace(2304):t.frontFace(2305),_=e)}function z(e){0!==e?(D(2884),e!==S&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):F(2884),S=e}function q(e,n,r){e?(D(32823),C===n&&x===r||(t.polygonOffset(n,r),C=n,x=r)):F(32823)}function W(e){void 0===e&&(e=33984+R-1),L!==e&&(t.activeTexture(e),L=e)}return{buffers:{color:a,depth:s,stencil:c},enable:D,disable:F,bindFramebuffer:function(e,n){null===n&&null!==d&&(n=d),h[e]!==n&&(t.bindFramebuffer(e,n),h[e]=n,o&&(36009===e&&(h[36160]=n),36160===e&&(h[36009]=n)))},bindXRFramebuffer:function(e){e!==d&&(t.bindFramebuffer(36160,e),d=e)},useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:G,setMaterial:function(t,e){2===t.side?F(2884):D(2884);var n=1===t.side;e&&(n=!n),Q(n),1===t.blending&&!1===t.transparent?G(0):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),a.setMask(t.colorWrite);var r=t.stencilWrite;c.setTest(r),r&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?D(32926):F(32926)},setFlipSided:Q,setCullFace:z,setLineWidth:function(e){e!==T&&(I&&t.lineWidth(e),T=e)},setPolygonOffset:q,setScissorTest:function(t){t?D(3089):F(3089)},activeTexture:W,bindTexture:function(e,n){null===L&&W();var r=k[L];void 0===r&&(r={type:void 0,texture:void 0},k[L]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||U[e]),r.type=e,r.texture=n)},unbindTexture:function(){var e=k[L];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===B.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),B.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===o&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},L=null,k={},d=null,h={},f=null,p=!1,v=null,m=null,g=null,A=null,y=null,b=null,w=null,E=!1,_=null,S=null,T=null,C=null,x=null,B.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),a.reset(),s.reset(),c.reset()}}}function Eo(t,e,n,r,i,o,a){var s,c,u,l=i.isWebGL2,d=i.maxTextures,h=i.maxCubemapSize,f=i.maxTextureSize,p=i.maxSamples,v=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function g(t,e){return m?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function A(t,e,n,r){var i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var o=e?St:Math.floor,a=o(i*t.width),s=o(i*t.height);void 0===u&&(u=g(a,s));var c=n?g(a,s):u;return c.width=a,c.height=s,c.getContext("2d").drawImage(t,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+s+")."),c}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return Et(t.width)&&Et(t.height)}function T(t,e){return t.generateMipmaps&&e&&t.minFilter!==w&&t.minFilter!==S}function C(e,n,i,o){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log2(Math.max(i,o))}function x(n,r,i){if(!1===l)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function U(t){return t===w||t===E||t===_?9728:9729}function D(e){var n=e.target;n.removeEventListener("dispose",D),function(e){var n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&v.delete(n),a.memory.textures--}function F(e){var n=e.target;n.removeEventListener("dispose",F),function(e){var n=e.texture,i=r.get(e),o=r.get(n);if(!e)return;void 0!==o.__webglTexture&&t.deleteTexture(o.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)t.deleteFramebuffer(i.__webglFramebuffer[a]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[a]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);r.remove(n),r.remove(e)}(n),a.memory.textures--}var H=0;function j(t,e){var i=r.get(t);if(t.isVideoTexture&&function(t){var e=a.render.frame;v.get(t)!==e&&(v.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void W(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function V(e,i){var a=r.get(e);e.version>0&&a.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;q(e,r),n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);for(var a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,c=[],u=0;u<6;u++)c[u]=a||s?s?r.image[u].image:r.image[u]:A(r.image[u],!1,!0,h);var d,f=c[0],p=b(f)||l,v=o.convert(r.format),m=o.convert(r.type),g=x(r.internalFormat,v,m);if(z(34067,r,p),a){for(var y=0;y<6;y++){d=c[y].mipmaps;for(var w=0;w<d.length;w++){var E=d[w];r.format!==B&&r.format!==k?null!==v?n.compressedTexImage2D(34069+y,w,g,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+y,w,g,E.width,E.height,0,v,m,E.data)}}e.__maxMipLevel=d.length-1}else{d=r.mipmaps;for(var _=0;_<6;_++)if(s){n.texImage2D(34069+_,0,g,c[_].width,c[_].height,0,v,m,c[_].data);for(var S=0;S<d.length;S++){var R=d[S].image[_].image;n.texImage2D(34069+_,S+1,g,R.width,R.height,0,v,m,R.data)}}else{n.texImage2D(34069+_,0,g,v,m,c[_]);for(var I=0;I<d.length;I++){var O=d[I];n.texImage2D(34069+_,I+1,g,v,m,O.image[_])}}e.__maxMipLevel=d.length}T(r,p)&&C(34067,r,f.width,f.height);e.__version=r.version,r.onUpdate&&r.onUpdate(r)}(a,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture))}var G=((s={})[1e3]=10497,s[1001]=33071,s[1002]=33648,s),Q=((c={})[1003]=9728,c[1004]=9984,c[1005]=9986,c[1006]=9729,c[1007]=9985,c[1008]=9987,c);function z(n,o,a){if(a?(t.texParameteri(n,10242,G[o.wrapS]),t.texParameteri(n,10243,G[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,G[o.wrapR]),t.texParameteri(n,10240,Q[o.magFilter]),t.texParameteri(n,10241,Q[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),o.wrapS===y&&o.wrapT===y||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,U(o.magFilter)),t.texParameteri(n,10241,U(o.minFilter)),o.minFilter!==w&&o.minFilter!==S&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){var s=e.get("EXT_texture_filter_anisotropic");if(o.type===O&&!1===e.has("OES_texture_float_linear"))return;if(!1===l&&o.type===M&&!1===e.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function q(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",D),e.__webglTexture=t.createTexture(),a.memory.textures++)}function W(e,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),q(e,r),n.activeTexture(33984+i),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);var s,c=function(t){return!l&&(t.wrapS!==y||t.wrapT!==y||t.minFilter!==w&&t.minFilter!==S)}(r)&&!1===b(r.image),u=A(r.image,c,!1,f),d=b(u)||l,h=o.convert(r.format),p=o.convert(r.type),v=x(r.internalFormat,h,p);z(a,r,d);var m=r.mipmaps;if(r.isDepthTexture)v=6402,l?v=r.type===O?36012:r.type===I?33190:r.type===L?35056:33189:r.type===O&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===N&&6402===v&&r.type!==R&&r.type!==I&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=R,p=o.convert(r.type)),r.format===P&&6402===v&&(v=34041,r.type!==L&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=L,p=o.convert(r.type))),n.texImage2D(3553,0,v,u.width,u.height,0,h,p,null);else if(r.isDataTexture)if(m.length>0&&d){for(var g=0,E=m.length;g<E;g++)s=m[g],n.texImage2D(3553,g,v,s.width,s.height,0,h,p,s.data);r.generateMipmaps=!1,e.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,u.width,u.height,0,h,p,u.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(var _=0,M=m.length;_<M;_++)s=m[_],r.format!==B&&r.format!==k?null!==h?n.compressedTexImage2D(3553,_,v,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,_,v,s.width,s.height,0,h,p,s.data);e.__maxMipLevel=m.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,v,u.width,u.height,u.depth,0,h,p,u.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,v,u.width,u.height,u.depth,0,h,p,u.data),e.__maxMipLevel=0;else if(m.length>0&&d){for(var U=0,D=m.length;U<D;U++)s=m[U],n.texImage2D(3553,U,v,h,p,s);r.generateMipmaps=!1,e.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,h,p,u),e.__maxMipLevel=0;T(r,d)&&C(a,r,u.width,u.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function K(e,i,a,s){var c=i.texture,u=o.convert(c.format),l=o.convert(c.type),d=x(c.internalFormat,u,l);32879===s||35866===s?n.texImage3D(s,0,d,i.width,i.height,i.depth,0,u,l,null):n.texImage2D(s,0,d,i.width,i.height,0,u,l,null),n.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,r.get(c).__webglTexture,0),n.bindFramebuffer(36160,null)}function X(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r){var a=n.depthTexture;a&&a.isDepthTexture&&(a.type===O?i=36012:a.type===I&&(i=33190));var s=Y(n);t.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var c=Y(n);t.renderbufferStorageMultisample(36161,c,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var u=n.texture,l=o.convert(u.format),d=o.convert(u.type),h=x(u.internalFormat,l,d);if(r){var f=Y(n);t.renderbufferStorageMultisample(36161,f,h,n.width,n.height)}else t.renderbufferStorage(36161,h,n.width,n.height)}t.bindRenderbuffer(36161,null)}function J(e){var i=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),j(i.depthTexture,0);var o=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===N)t.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==P)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,e)}else if(o){i.__webglDepthbuffer=[];for(var a=0;a<6;a++)n.bindFramebuffer(36160,i.__webglFramebuffer[a]),i.__webglDepthbuffer[a]=t.createRenderbuffer(),X(i.__webglDepthbuffer[a],e,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),X(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function Y(t){return l&&t.isWebGLMultisampleRenderTarget?Math.min(p,t.samples):0}var $=!1,Z=!1;this.allocateTextureUnit=function(){var t=H;return t>=d&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+d),H+=1,t},this.resetTextureUnits=function(){H=0},this.setTexture2D=j,this.setTexture2DArray=function(t,e){var i=r.get(t);t.version>0&&i.__version!==t.version?W(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=r.get(t);t.version>0&&i.__version!==t.version?W(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=V,this.setupRenderTarget=function(e){var i=e.texture,s=r.get(e),c=r.get(i);e.addEventListener("dispose",F),c.__webglTexture=t.createTexture(),c.__version=i.version,a.memory.textures++;var u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultisampleRenderTarget,h=i.isDataTexture3D||i.isDataTexture2DArray,f=b(e)||l;if(!l||i.format!==k||i.type!==O&&i.type!==M||(i.format=B,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){s.__webglFramebuffer=[];for(var p=0;p<6;p++)s.__webglFramebuffer[p]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),d)if(l){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var v=o.convert(i.format),m=o.convert(i.type),g=x(i.internalFormat,v,m),A=Y(e);t.renderbufferStorageMultisample(36161,A,g,e.width,e.height),n.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),X(s.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,c.__webglTexture),z(34067,i,f);for(var y=0;y<6;y++)K(s.__webglFramebuffer[y],e,36064,34069+y);T(i,f)&&C(34067,i,e.width,e.height),n.bindTexture(34067,null)}else{var w=3553;if(h)if(l)w=i.isDataTexture3D?32879:35866;else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(w,c.__webglTexture),z(w,i,f),K(s.__webglFramebuffer,e,36064,w),T(i,f)&&C(3553,i,e.width,e.height),n.bindTexture(3553,null)}e.depthBuffer&&J(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(T(e,b(t)||l)){var i=t.isWebGLCubeRenderTarget?34067:3553,o=r.get(e).__webglTexture;n.bindTexture(i,o),C(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(l){var i=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024);var s=r.get(e);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===$&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),$=!0),t=t.texture),j(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===Z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Z=!0),t=t.texture),V(t,e)}}function _o(t,e,n){var r=n.isWebGL2;return{convert:function(t){var n;if(t===x)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===R)return 5123;if(1013===t)return 5124;if(t===I)return 5125;if(t===O)return 5126;if(t===M)return r?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===t)return 6406;if(t===k)return 6407;if(t===B)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===N)return 6402;if(t===P)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(t===U||t===D||t===F||t===H){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===U)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===D)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===F)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===H)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===j||t===V||t===G||t===Q){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===j)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===V)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===G)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Q)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===z||t===q)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(t===z)return n.COMPRESSED_RGB8_ETC2;if(t===q)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:36492===t?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:t===L?r?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var So=function(t){function e(e){var n;return void 0===e&&(e=[]),(n=t.call(this)||this).cameras=e,n}return i(e,t),e}(sr);So.prototype.isArrayCamera=!0;var To=function(t){function e(){var e;return(e=t.call(this)||this).type="Group",e}return i(e,t),e}(Fe);To.prototype.isGroup=!0;var Co={type:"move"},xo=function(){function t(){this._targetRay=null,this._grip=null,this._hand=null}var e=t.prototype;return e.getHandSpace=function(){return null===this._hand&&(this._hand=new To,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},e.getTargetRaySpace=function(){return null===this._targetRay&&(this._targetRay=new To,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ut,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ut),this._targetRay},e.getGripSpace=function(){return null===this._grip&&(this._grip=new To,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ut,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ut),this._grip},e.dispatchEvent=function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},e.disconnect=function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},e.update=function(t,e,n){var r=null,i=null,o=null,a=this._targetRay,c=this._grip,u=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&null!==(r=e.getPose(t.targetRaySpace,n))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Co)),u&&t.hand){o=!0;for(var l,d=s(t.hand.values());!(l=d()).done;){var h=l.value,f=e.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var p=new To;p.matrixAutoUpdate=!1,p.visible=!1,u.joints[h.jointName]=p,u.add(p)}var v=u.joints[h.jointName];null!==f&&(v.matrix.fromArray(f.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=f.radius),v.visible=null!==f}var m=u.joints["index-finger-tip"],g=u.joints["thumb-tip"],A=m.position.distanceTo(g.position);u.inputState.pinching&&A>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&A<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==c&&t.gripSpace&&null!==(i=e.getPose(t.gripSpace,n))&&(c.matrix.fromArray(i.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),i.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(i.linearVelocity)):c.hasLinearVelocity=!1,i.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(i.angularVelocity)):c.hasAngularVelocity=!1);return null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==i),null!==u&&(u.visible=null!==o),this},t}(),Ro=function(t){function n(n,r){var i,a=o(i=t.call(this)||this),s=n.state,c=null,u=1,l=null,d="local-floor",h=null,f=[],p=new Map,v=new sr;v.layers.enable(1),v.viewport=new kt;var m=new sr;m.layers.enable(2),m.viewport=new kt;var g=[v,m],A=new So;A.layers.enable(1),A.layers.enable(2);var y=null,b=null;function w(t){var e=p.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function E(){p.forEach((function(t,e){t.disconnect(e)})),p.clear(),y=null,b=null,s.bindXRFramebuffer(null),n.setRenderTarget(n.getRenderTarget()),R.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function _(t){for(var e=c.inputSources,n=0;n<f.length;n++)p.set(e[n],f[n]);for(var r=0;r<t.removed.length;r++){var i=t.removed[r],o=p.get(i);o&&(o.dispatchEvent({type:"disconnected",data:i}),p.delete(i))}for(var a=0;a<t.added.length;a++){var s=t.added[a],u=p.get(s);u&&u.dispatchEvent({type:"connected",data:s})}}i.enabled=!1,i.isPresenting=!1,i.getController=function(t){var e=f[t];return void 0===e&&(e=new xo,f[t]=e),e.getTargetRaySpace()},i.getControllerGrip=function(t){var e=f[t];return void 0===e&&(e=new xo,f[t]=e),e.getGripSpace()},i.getHand=function(t){var e=f[t];return void 0===e&&(e=new xo,f[t]=e),e.getHandSpace()},i.setFramebufferScaleFactor=function(t){u=t,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},i.setReferenceSpaceType=function(t){d=t,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},i.getReferenceSpace=function(){return l},i.getSession=function(){return c},i.setSession=function(){var t,n=(t=regeneratorRuntime.mark((function t(e){var n,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(c=e)){t.next=24;break}if(c.addEventListener("select",w),c.addEventListener("selectstart",w),c.addEventListener("selectend",w),c.addEventListener("squeeze",w),c.addEventListener("squeezestart",w),c.addEventListener("squeezeend",w),c.addEventListener("end",E),c.addEventListener("inputsourceschange",_),!0===(n=r.getContextAttributes()).xrCompatible){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:return i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},o=new XRWebGLLayer(c,r,i),c.updateRenderState({baseLayer:o}),t.next=19,c.requestReferenceSpace(d);case 19:l=t.sent,R.setContext(c),R.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 24:case"end":return t.stop()}}),t)})),function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,c,"next",t)}function c(t){e(a,i,o,s,c,"throw",t)}s(void 0)}))});return function(t){return n.apply(this,arguments)}}();var S=new Ut,T=new Ut;function C(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}i.getCamera=function(t){A.near=m.near=v.near=t.near,A.far=m.far=v.far=t.far,y===A.near&&b===A.far||(c.updateRenderState({depthNear:A.near,depthFar:A.far}),y=A.near,b=A.far);var e=t.parent,n=A.cameras;C(A,e);for(var r=0;r<n.length;r++)C(n[r],e);t.matrixWorld.copy(A.matrixWorld),t.matrix.copy(A.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);for(var i=t.children,o=0,a=i.length;o<a;o++)i[o].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){S.setFromMatrixPosition(e.matrixWorld),T.setFromMatrixPosition(n.matrixWorld);var r=S.distanceTo(T),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),c=(i[9]+1)/i[5],u=(i[9]-1)/i[5],l=(i[8]-1)/i[0],d=(o[8]+1)/o[0],h=a*l,f=a*d,p=r/(-l+d),v=p*-l;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(v),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();var m=a+p,g=s+p,A=h-v,y=f+(r-v),b=c*s/g*m,w=u*s/g*m;t.projectionMatrix.makePerspective(A,y,b,w,m,g)}(A,v,m):A.projectionMatrix.copy(v.projectionMatrix),A};var x=null;var R=new mr;return R.setAnimationLoop((function(t,e){if(null!==(h=e.getViewerPose(l))){var n=h.views,r=c.renderState.baseLayer;s.bindXRFramebuffer(r.framebuffer);var i=!1;n.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(var o=0;o<n.length;o++){var a=n[o],u=r.getViewport(a),d=g[o];d.matrix.fromArray(a.transform.matrix),d.projectionMatrix.fromArray(a.projectionMatrix),d.viewport.set(u.x,u.y,u.width,u.height),0===o&&A.matrix.copy(d.matrix),!0===i&&A.cameras.push(d)}}for(var p=c.inputSources,v=0;v<f.length;v++){var m=f[v],y=p[v];m.update(y,e,l)}x&&x(t,e)})),i.setAnimationLoop=function(t){x=t},i.dispose=function(){},i}return i(n,t),n}(ht);function Io(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);var r,i,o=t.get(n).envMap;if(o){e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture&&o._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;var a=t.get(o).__maxMipLevel;void 0!==a&&(e.maxMipLevel.value=a)}n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,r):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Oo(t){var e,n=void 0!==(t=t||{}).canvas?t.canvas:((e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).style.display="block",e),r=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,c=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",d=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,h=null,f=null,p=[],v=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=et,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var m=this,g=!1,A=0,y=0,b=null,w=-1,E=null,_=new kt,S=new kt,T=null,C=n.width,R=n.height,I=1,L=null,k=null,N=new kt(0,0,C,R),P=new kt(0,0,C,R),U=!1,D=new vr,F=!1,H=!1,j=new pe,V=new Ut,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Q(){return null===b?I:1}var z,q,W,K,X,J,Y,$,Z,tt,nt,rt,it,ot,at,st,ct,ut,lt,dt,ht,ft,pt=r;function vt(t,e){for(var r=0;r<t.length;r++){var i=t[r],o=n.getContext(i,e);if(null!==o)return o}return null}try{var mt={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:d};if(n.addEventListener("webglcontextlost",bt,!1),n.addEventListener("webglcontextrestored",wt,!1),null===pt){var gt=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&gt.shift(),null===(pt=vt(gt,mt)))throw vt(gt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===pt.getShaderPrecisionFormat&&(pt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function At(){z=new Rr(pt),q=new Tr(pt,z,t),z.init(q),ht=new _o(pt,z,q),W=new wo(pt,z,q),K=new Mr(pt),X=new ao,J=new Eo(pt,z,W,X,q,ht,K),Y=new xr(m),$=new gr(pt,q),ft=new _r(pt,z,$,q),Z=new Ir(pt,$,K,ft),tt=new Nr(pt,Z,$,K),ut=new Br(pt),at=new Cr(X),nt=new oo(m,Y,z,q,ft,at),rt=new Io(X),it=new lo(X),ot=new go(z,q),ct=new Er(m,Y,W,tt,c),st=new bo(m,tt,q),lt=new Sr(pt,z,K,q),dt=new Or(pt,z,K,q),K.programs=nt.programs,m.capabilities=q,m.extensions=z,m.properties=X,m.renderLists=it,m.shadowMap=st,m.state=W,m.info=K}At();var yt=new Ro(m,pt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function wt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;var t=K.autoReset,e=st.enabled,n=st.autoUpdate,r=st.needsUpdate,i=st.type;At(),K.autoReset=t,st.enabled=e,st.autoUpdate=n,st.needsUpdate=r,st.type=i}function Et(t){var e=t.target;e.removeEventListener("dispose",Et),function(t){(function(t){var e=X.get(t).programs;void 0!==e&&e.forEach((function(t){nt.releaseProgram(t)}))})(t),X.remove(t)}(e)}this.xr=yt,this.getContext=function(){return pt},this.getContextAttributes=function(){return pt.getContextAttributes()},this.forceContextLoss=function(){var t=z.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=z.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(C,R,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Ct),t.set(C,R)},this.setSize=function(t,e,r){yt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=t,R=e,n.width=Math.floor(t*I),n.height=Math.floor(e*I),!1!==r&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Ct),t.set(C*I,R*I).floor()},this.setDrawingBufferSize=function(t,e,r){C=t,R=e,I=r,n.width=Math.floor(t*r),n.height=Math.floor(e*r),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new kt),t.copy(_)},this.getViewport=function(t){return t.copy(N)},this.setViewport=function(t,e,n,r){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,r),W.viewport(_.copy(N).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(P)},this.setScissor=function(t,e,n,r){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,r),W.scissor(S.copy(P).multiplyScalar(I).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){W.setScissorTest(U=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){k=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new ln),t.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),pt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",bt,!1),n.removeEventListener("webglcontextrestored",wt,!1),it.dispose(),ot.dispose(),X.dispose(),Y.dispose(),tt.dispose(),ft.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",Tt),yt.removeEventListener("sessionend",xt),Rt.stop()},this.renderBufferImmediate=function(t,e){ft.initAttributes();var n=X.get(t);t.hasPositions&&!n.position&&(n.position=pt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=pt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=pt.createBuffer()),t.hasColors&&!n.color&&(n.color=pt.createBuffer());var r=e.getAttributes();t.hasPositions&&(pt.bindBuffer(34962,n.position),pt.bufferData(34962,t.positionArray,35048),ft.enableAttribute(r.position),pt.vertexAttribPointer(r.position,3,5126,!1,0,0)),t.hasNormals&&(pt.bindBuffer(34962,n.normal),pt.bufferData(34962,t.normalArray,35048),ft.enableAttribute(r.normal),pt.vertexAttribPointer(r.normal,3,5126,!1,0,0)),t.hasUvs&&(pt.bindBuffer(34962,n.uv),pt.bufferData(34962,t.uvArray,35048),ft.enableAttribute(r.uv),pt.vertexAttribPointer(r.uv,2,5126,!1,0,0)),t.hasColors&&(pt.bindBuffer(34962,n.color),pt.bufferData(34962,t.colorArray,35048),ft.enableAttribute(r.color),pt.vertexAttribPointer(r.color,3,5126,!1,0,0)),ft.disableUnusedAttributes(),pt.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=G);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Nt(t,e,r,i);W.setMaterial(r,a);var c=n.index,u=n.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;var l,d=1;!0===r.wireframe&&(c=Z.getWireframeAttribute(n),d=2),(r.morphTargets||r.morphNormals)&&ut.update(i,n,r,s),ft.setup(i,r,s,n,c);var h=lt;null!==c&&(l=$.get(c),(h=dt).setIndex(l));var f=null!==c?c.count:u.count,p=n.drawRange.start*d,v=n.drawRange.count*d,m=null!==o?o.start*d:0,g=null!==o?o.count*d:1/0,A=Math.max(p,m),y=Math.min(f,p+v,m+g)-1,b=Math.max(0,y-A+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(W.setLineWidth(r.wireframeLinewidth*Q()),h.setMode(1)):h.setMode(4);else if(i.isLine){var w=r.linewidth;void 0===w&&(w=1),W.setLineWidth(w*Q()),i.isLineSegments?h.setMode(1):i.isLineLoop?h.setMode(2):h.setMode(3)}else i.isPoints?h.setMode(0):i.isSprite&&h.setMode(4);if(i.isInstancedMesh)h.renderInstances(A,b,i.count);else if(n.isInstancedBufferGeometry){var E=Math.min(n.instanceCount,n._maxInstanceCount);h.renderInstances(A,b,E)}else h.render(A,b)}},this.compile=function(t,e){(f=ot.get(t)).init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(),t.traverse((function(e){var n=e.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){Lt(n[r],t,e)}else Lt(n,t,e)}))};var St=null;function Tt(){Rt.stop()}function xt(){Rt.start()}var Rt=new mr;function It(t,e,n,r){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){r&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);var i=tt.update(t),o=t.material;o.visible&&h.push(t,i,o,n,V.z,null)}}else if(t.isImmediateRenderObject)r&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j),h.push(t,null,t.material,n,V.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==K.render.frame&&(t.skeleton.update(),t.skeleton.frame=K.render.frame),!t.frustumCulled||D.intersectsObject(t))){r&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);var a=tt.update(t),s=t.material;if(Array.isArray(s))for(var c=a.groups,u=0,l=c.length;u<l;u++){var d=c[u],p=s[d.materialIndex];p&&p.visible&&h.push(t,a,p,n,V.z,d)}else s.visible&&h.push(t,a,s,n,V.z,null)}for(var v=t.children,m=0,g=v.length;m<g;m++)It(v[m],e,n,r)}}function Ot(t,e,n){for(var r=!0===e.isScene?e.overrideMaterial:null,i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,c=a.geometry,u=null===r?a.material:r,l=a.group;if(n.isArrayCamera)for(var d=n.cameras,h=0,p=d.length;h<p;h++){var v=d[h];s.layers.test(v.layers)&&(W.viewport(_.copy(v.viewport)),f.setupLightsView(v),Mt(s,e,v,c,u,l))}else Mt(s,e,n,c,u,l)}}function Mt(t,e,n,r,i,o){if(t.onBeforeRender(m,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=Nt(n,e,i,t);W.setMaterial(i),ft.reset(),function(t,e){t.render((function(t){m.renderBufferImmediate(t,e)}))}(t,a)}else m.renderBufferDirect(n,e,r,i,t,o);t.onAfterRender(m,e,n,r,i,o)}function Lt(t,e,n){!0!==e.isScene&&(e=G);var r=X.get(t),i=f.state.lights,o=f.state.shadowsArray,a=i.state.version,s=nt.getParameters(t,i.state,o,e,n),c=nt.getProgramCacheKey(s),u=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=Y.get(t.envMap||r.environment),void 0===u&&(t.addEventListener("dispose",Et),u=new Map,r.programs=u);var l=u.get(c);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===a)return Bt(t,s),l}else s.uniforms=nt.getUniforms(t),t.onBuild(s,m),t.onBeforeCompile(s,m),l=nt.acquireProgram(s,c),u.set(c,l),r.uniforms=s.uniforms;var d=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(d.clippingPlanes=at.uniform),Bt(t,s),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=a,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var h=l.getUniforms(),p=Fi.seqWithValue(h.seq,d);return r.currentProgram=l,r.uniformsList=p,l}function Bt(t,e){var n=X.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas}function Nt(t,e,n,r){!0!==e.isScene&&(e=G),J.resetTextureUnits();var i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===b?m.outputEncoding:b.texture.encoding,s=Y.get(n.envMap||o),c=!0===n.vertexColors&&r.geometry&&r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,u=X.get(n),l=f.state.lights;if(!0===F&&(!0===H||t!==E)){var d=t===E&&n.id===w;at.setState(n,t,d)}var h=!1;n.version===u.__version?u.needsLights&&u.lightsStateVersion!==l.state.version||u.outputEncoding!==a||r.isInstancedMesh&&!1===u.instancing?h=!0:r.isInstancedMesh||!0!==u.instancing?u.envMap!==s||n.fog&&u.fog!==i?h=!0:void 0===u.numClippingPlanes||u.numClippingPlanes===at.numPlanes&&u.numIntersection===at.numIntersection?u.vertexAlphas!==c&&(h=!0):h=!0:h=!0:(h=!0,u.__version=n.version);var p=u.currentProgram;!0===h&&(p=Lt(n,e,r));var v,g,A=!1,y=!1,_=!1,S=p.getUniforms(),T=u.uniforms;if(W.useProgram(p.program)&&(A=!0,y=!0,_=!0),n.id!==w&&(w=n.id,y=!0),A||E!==t){if(S.setValue(pt,"projectionMatrix",t.projectionMatrix),q.logarithmicDepthBuffer&&S.setValue(pt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),E!==t&&(E=t,y=!0,_=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var C=S.map.cameraPosition;void 0!==C&&C.setValue(pt,V.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&S.setValue(pt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&S.setValue(pt,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){S.setOptional(pt,r,"bindMatrix"),S.setOptional(pt,r,"bindMatrixInverse");var x=r.skeleton;if(x){var M=x.bones;if(q.floatVertexTextures){if(null===x.boneTexture){var L=Math.sqrt(4*M.length);L=_t(L),L=Math.max(L,4);var k=new Float32Array(L*L*4);k.set(x.boneMatrices);var N=new hr(k,L,L,B,O);x.boneMatrices=k,x.boneTexture=N,x.boneTextureSize=L}S.setValue(pt,"boneTexture",x.boneTexture,J),S.setValue(pt,"boneTextureSize",x.boneTextureSize)}else S.setOptional(pt,x,"boneMatrices")}}return(y||u.receiveShadow!==r.receiveShadow)&&(u.receiveShadow=r.receiveShadow,S.setValue(pt,"receiveShadow",r.receiveShadow)),y&&(S.setValue(pt,"toneMappingExposure",m.toneMappingExposure),u.needsLights&&(g=_,(v=T).ambientLightColor.needsUpdate=g,v.lightProbe.needsUpdate=g,v.directionalLights.needsUpdate=g,v.directionalLightShadows.needsUpdate=g,v.pointLights.needsUpdate=g,v.pointLightShadows.needsUpdate=g,v.spotLights.needsUpdate=g,v.spotLightShadows.needsUpdate=g,v.rectAreaLights.needsUpdate=g,v.hemisphereLights.needsUpdate=g),i&&n.fog&&rt.refreshFogUniforms(T,i),rt.refreshMaterialUniforms(T,n,I,R),Fi.upload(pt,u.uniformsList,T,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Fi.upload(pt,u.uniformsList,T,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&S.setValue(pt,"center",r.center),S.setValue(pt,"modelViewMatrix",r.modelViewMatrix),S.setValue(pt,"normalMatrix",r.normalMatrix),S.setValue(pt,"modelMatrix",r.matrixWorld),p}Rt.setAnimationLoop((function(t){St&&St(t)})),"undefined"!=typeof window&&Rt.setContext(window),this.setAnimationLoop=function(t){St=t,yt.setAnimationLoop(t),null===t?Rt.stop():Rt.start()},yt.addEventListener("sessionstart",Tt),yt.addEventListener("sessionend",xt),this.render=function(t,e){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0===e||!0===e.isCamera){if(!0!==g){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===yt.enabled&&!0===yt.isPresenting&&(e=yt.getCamera(e)),!0===t.isScene&&t.onBeforeRender(m,t,e,n||b),(f=ot.get(t,v.length)).init(),v.push(f),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(j),H=this.localClippingEnabled,F=at.init(this.clippingPlanes,H,e),(h=it.get(t,p.length)).init(),p.push(h),It(t,e,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(L,k),!0===F&&at.beginShadows();var i=f.state.shadowsArray;st.render(i,t,e),f.setupLights(),f.setupLightsView(e),!0===F&&at.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ct.render(h,t,e,r);var o=h.opaque,a=h.transparent;o.length>0&&Ot(o,t,e),a.length>0&&Ot(a,t,e),null!==b&&(J.updateRenderTargetMipmap(b),J.updateMultisampleRenderTarget(b)),!0===t.isScene&&t.onAfterRender(m,t,e),W.buffers.depth.setTest(!0),W.buffers.depth.setMask(!0),W.buffers.color.setMask(!0),W.setPolygonOffset(!1),ft.resetDefaultState(),w=-1,E=null,v.pop(),f=v.length>0?v[v.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTarget=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),b=t,A=e,y=n,t&&void 0===X.get(t).__webglFramebuffer&&J.setupRenderTarget(t);var r=null,i=!1,o=!1;if(t){var a=t.texture;(a.isDataTexture3D||a.isDataTexture2DArray)&&(o=!0);var s=X.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=s[e],i=!0):r=t.isWebGLMultisampleRenderTarget?X.get(t).__webglMultisampledFramebuffer:s,_.copy(t.viewport),S.copy(t.scissor),T=t.scissorTest}else _.copy(N).multiplyScalar(I).floor(),S.copy(P).multiplyScalar(I).floor(),T=U;if(W.bindFramebuffer(36160,r),W.viewport(_),W.scissor(S),W.setScissorTest(T),i){var c=X.get(t.texture);pt.framebufferTexture2D(36160,36064,34069+e,c.__webglTexture,n)}else if(o){var u=X.get(t.texture),l=e||0;pt.framebufferTextureLayer(36160,36064,u.__webglTexture,n||0,l)}},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(t&&t.isWebGLRenderTarget){var s=X.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){W.bindFramebuffer(36160,s);try{var c=t.texture,u=c.format,l=c.type;if(u!==B&&ht.convert(u)!==pt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var d=l===M&&(z.has("EXT_color_buffer_half_float")||q.isWebGL2&&z.has("EXT_color_buffer_float"));if(!(l===x||ht.convert(l)===pt.getParameter(35738)||l===O&&(q.isWebGL2||z.has("OES_texture_float")||z.has("WEBGL_color_buffer_float"))||d))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===pt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&pt.readPixels(e,n,r,i,ht.convert(u),ht.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{var h=null!==b?X.get(b).__webglFramebuffer:null;W.bindFramebuffer(36160,h)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),a=ht.convert(e.format);J.setTexture2D(e,0),pt.copyTexImage2D(3553,n,a,t.x,t.y,i,o,0),W.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);var i=e.image.width,o=e.image.height,a=ht.convert(n.format),s=ht.convert(n.type);J.setTexture2D(n,0),pt.pixelStorei(37440,n.flipY),pt.pixelStorei(37441,n.premultiplyAlpha),pt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?pt.texSubImage2D(3553,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?pt.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):pt.texSubImage2D(3553,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&pt.generateMipmap(3553),W.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i){if(void 0===i&&(i=0),m.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var o,a=n.image,s=a.width,c=a.height,u=a.data,l=ht.convert(r.format),d=ht.convert(r.type);if(r.isDataTexture3D)J.setTexture3D(r,0),o=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(r,0),o=35866}pt.pixelStorei(37440,r.flipY),pt.pixelStorei(37441,r.premultiplyAlpha),pt.pixelStorei(3317,r.unpackAlignment);var h=pt.getParameter(3314),f=pt.getParameter(32878),p=pt.getParameter(3316),v=pt.getParameter(3315),g=pt.getParameter(32877);pt.pixelStorei(3314,s),pt.pixelStorei(32878,c),pt.pixelStorei(3316,t.min.x),pt.pixelStorei(3315,t.min.y),pt.pixelStorei(32877,t.min.z),pt.texSubImage3D(o,i,e.x,e.y,e.z,t.max.x-t.min.x+1,t.max.y-t.min.y+1,t.max.z-t.min.z+1,l,d,u),pt.pixelStorei(3314,h),pt.pixelStorei(32878,f),pt.pixelStorei(3316,p),pt.pixelStorei(3315,v),pt.pixelStorei(32877,g),0===i&&r.generateMipmaps&&pt.generateMipmap(o),W.unbindTexture()}},this.initTexture=function(t){J.setTexture2D(t,0),W.unbindTexture()},this.resetState=function(){A=0,y=0,b=null,W.reset(),ft.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Mo=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(Oo);Mo.prototype.isWebGL1Renderer=!0;var Lo=function(){function t(t,e){void 0===e&&(e=25e-5),this.name="",this.color=new ln(t),this.density=e}var e=t.prototype;return e.clone=function(){return new t(this.color,this.density)},e.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},t}();Lo.prototype.isFogExp2=!0;var ko=function(){function t(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1e3),this.name="",this.color=new ln(t),this.near=e,this.far=n}var e=t.prototype;return e.clone=function(){return new t(this.color,this.near,this.far)},e.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},t}();ko.prototype.isFog=!0;var Bo=function(t){function e(){var e;return(e=t.call(this)||this).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:o(e)})),e}i(e,t);var n=e.prototype;return n.copy=function(e,n){return t.prototype.copy.call(this,e,n),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return null!==this.background&&(n.object.background=this.background.toJSON(e)),null!==this.environment&&(n.object.environment=this.environment.toJSON(e)),null!==this.fog&&(n.object.fog=this.fog.toJSON()),n},e}(Fe);Bo.prototype.isScene=!0;var No=function(){function t(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=At(),this.onUploadCallback=function(){}}var e=t.prototype;return e.setUsage=function(t){return this.usage=t,this},e.copy=function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},e.copyAt=function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},e.set=function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},e.clone=function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=At()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var n=new t(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return n.setUsage(this.usage),n},e.onUpload=function(t){return this.onUploadCallback=t,this},e.toJSON=function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=At()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}},r(t,[{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),t}();No.prototype.isInterleavedBuffer=!0;var Po=new Ut,Uo=function(){function t(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}var e=t.prototype;return e.applyMatrix4=function(t){for(var e=0,n=this.data.count;e<n;e++)Po.x=this.getX(e),Po.y=this.getY(e),Po.z=this.getZ(e),Po.applyMatrix4(t),this.setXYZ(e,Po.x,Po.y,Po.z);return this},e.applyNormalMatrix=function(t){for(var e=0,n=this.count;e<n;e++)Po.x=this.getX(e),Po.y=this.getY(e),Po.z=this.getZ(e),Po.applyNormalMatrix(t),this.setXYZ(e,Po.x,Po.y,Po.z);return this},e.transformDirection=function(t){for(var e=0,n=this.count;e<n;e++)Po.x=this.getX(e),Po.y=this.getY(e),Po.z=this.getZ(e),Po.transformDirection(t),this.setXYZ(e,Po.x,Po.y,Po.z);return this},e.setX=function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},e.setY=function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},e.setZ=function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},e.setW=function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},e.getX=function(t){return this.data.array[t*this.data.stride+this.offset]},e.getY=function(t){return this.data.array[t*this.data.stride+this.offset+1]},e.getZ=function(t){return this.data.array[t*this.data.stride+this.offset+2]},e.getW=function(t){return this.data.array[t*this.data.stride+this.offset+3]},e.setXY=function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},e.setXYZ=function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},e.setXYZW=function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},e.clone=function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var i=r*this.data.stride+this.offset,o=0;o<this.itemSize;o++)n.push(this.data.array[i+o]);return new pn(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new t(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},e.toJSON=function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)e.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}},r(t,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(t){this.data.needsUpdate=t}}]),t}();Uo.prototype.isInterleavedBufferAttribute=!0;var Do,Fo=function(t){function e(e){var n;return(n=t.call(this)||this).type="SpriteMaterial",n.color=new ln(16777215),n.map=null,n.alphaMap=null,n.rotation=0,n.sizeAttenuation=!0,n.transparent=!0,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},e}(nn);Fo.prototype.isSpriteMaterial=!0;var Ho=new Ut,jo=new Ut,Vo=new Ut,Go=new Ct,Qo=new Ct,zo=new pe,qo=new Ut,Wo=new Ut,Ko=new Ut,Xo=new Ct,Jo=new Ct,Yo=new Ct,$o=function(t){function e(e){var n;if((n=t.call(this)||this).type="Sprite",void 0===Do){Do=new Nn;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new No(r,5);Do.setIndex([0,1,2,0,2,3]),Do.setAttribute("position",new Uo(i,3,0,!1)),Do.setAttribute("uv",new Uo(i,2,3,!1))}return n.geometry=Do,n.material=void 0!==e?e:new Fo,n.center=new Ct(.5,.5),n}i(e,t);var n=e.prototype;return n.raycast=function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jo.setFromMatrixScale(this.matrixWorld),zo.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Vo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&jo.multiplyScalar(-Vo.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Zo(qo.set(-.5,-.5,0),Vo,o,jo,n,r),Zo(Wo.set(.5,-.5,0),Vo,o,jo,n,r),Zo(Ko.set(.5,.5,0),Vo,o,jo,n,r),Xo.set(0,0),Jo.set(1,0),Yo.set(1,1);var a=t.ray.intersectTriangle(qo,Wo,Ko,!1,Ho);if(null!==a||(Zo(Wo.set(-.5,.5,0),Vo,o,jo,n,r),Jo.set(0,1),null!==(a=t.ray.intersectTriangle(qo,Ko,Wo,!1,Ho)))){var s=t.ray.origin.distanceTo(Ho);s<t.near||s>t.far||e.push({distance:s,point:Ho.clone(),uv:tn.getUV(Ho,qo,Wo,Ko,Xo,Jo,Yo,new Ct),face:null,object:this})}},n.copy=function(e){return t.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this},e}(Fe);function Zo(t,e,n,r,i,o){Go.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Qo.x=o*Go.x-i*Go.y,Qo.y=i*Go.x+o*Go.y):Qo.copy(Go),t.copy(e),t.x+=Qo.x,t.y+=Qo.y,t.applyMatrix4(zo)}$o.prototype.isSprite=!0;var ta=new Ut,ea=new Ut,na=function(t){function e(){var e;return(e=t.call(this)||this)._currentLevel=0,e.type="LOD",Object.defineProperties(o(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}i(e,t);var n=e.prototype;return n.copy=function(e){t.prototype.copy.call(this,e,!1);for(var n=e.levels,r=0,i=n.length;r<i;r++){var o=n[r];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this},n.addLevel=function(t,e){void 0===e&&(e=0),e=Math.abs(e);var n,r=this.levels;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},n.getCurrentLevel=function(){return this._currentLevel},n.getObjectForDistance=function(t){var e=this.levels;if(e.length>0){var n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},n.raycast=function(t,e){if(this.levels.length>0){ta.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(ta);this.getObjectForDistance(n).raycast(t,e)}},n.update=function(t){var e=this.levels;if(e.length>1){ta.setFromMatrixPosition(t.matrixWorld),ea.setFromMatrixPosition(this.matrixWorld);var n,r,i=ta.distanceTo(ea)/t.zoom;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(n.object.autoUpdate=!1),n.object.levels=[];for(var r=this.levels,i=0,o=r.length;i<o;i++){var a=r[i];n.object.levels.push({object:a.object.uuid,distance:a.distance})}return n},e}(Fe),ra=new Ut,ia=new kt,oa=new kt,aa=new Ut,sa=new pe,ca=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new pe,r.bindMatrixInverse=new pe,r}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},n.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},n.pose=function(){this.skeleton.pose()},n.normalizeSkinWeights=function(){for(var t=new kt,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},n.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},n.boneTransform=function(t,e){var n=this.skeleton,r=this.geometry;ia.fromBufferAttribute(r.attributes.skinIndex,t),oa.fromBufferAttribute(r.attributes.skinWeight,t),ra.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var i=0;i<4;i++){var o=oa.getComponent(i);if(0!==o){var a=ia.getComponent(i);sa.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(aa.copy(ra).applyMatrix4(sa),o)}}return e.applyMatrix4(this.bindMatrixInverse)},e}(Zn);ca.prototype.isSkinnedMesh=!0;var ua=function(t){function e(){var e;return(e=t.call(this)||this).type="Bone",e}return i(e,t),e}(Fe);ua.prototype.isBone=!0;var la=new pe,da=new pe,ha=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]),this.uuid=At(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}var e=t.prototype;return e.init=function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new pe)}},e.calculateInverses=function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new pe;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},e.pose=function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var o=this.bones[r];o&&(o.parent&&o.parent.isBone?(o.matrix.copy(o.parent.matrixWorld).invert(),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}},e.update=function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++){var a=t[i]?t[i].matrixWorld:da;la.multiplyMatrices(a,e[i]),la.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)},e.clone=function(){return new t(this.bones,this.boneInverses)},e.getBoneByName=function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},e.dispose=function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},e.fromJSON=function(t,e){this.uuid=t.uuid;for(var n=0,r=t.bones.length;n<r;n++){var i=t.bones[n],o=e[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new ua),this.bones.push(o),this.boneInverses.push((new pe).fromArray(t.boneInverses[n]))}return this.init(),this},e.toJSON=function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneInverses,r=0,i=e.length;r<i;r++){var o=e[r];t.bones.push(o.uuid);var a=n[r];t.boneInverses.push(a.toArray())}return t},t}(),fa=new pe,pa=new pe,va=[],ma=new Zn,ga=function(t){function e(e,n,r){var i;return(i=t.call(this,e,n)||this).instanceMatrix=new pn(new Float32Array(16*r),16),i.instanceColor=null,i.count=r,i.frustumCulled=!1,i}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},n.getColorAt=function(t,e){e.fromArray(this.instanceColor.array,3*t)},n.getMatrixAt=function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},n.raycast=function(t,e){var n=this.matrixWorld,r=this.count;if(ma.geometry=this.geometry,ma.material=this.material,void 0!==ma.material)for(var i=0;i<r;i++){this.getMatrixAt(i,fa),pa.multiplyMatrices(n,fa),ma.matrixWorld=pa,ma.raycast(t,va);for(var o=0,a=va.length;o<a;o++){var s=va[o];s.instanceId=i,s.object=this,e.push(s)}va.length=0}},n.setColorAt=function(t,e){null===this.instanceColor&&(this.instanceColor=new pn(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},n.setMatrixAt=function(t,e){e.toArray(this.instanceMatrix.array,16*t)},n.updateMorphTargets=function(){},n.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(Zn);ga.prototype.isInstancedMesh=!0;var Aa=function(t){function e(e){var n;return(n=t.call(this)||this).type="LineBasicMaterial",n.color=new ln(16777215),n.linewidth=1,n.linecap="round",n.linejoin="round",n.morphTargets=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this},e}(nn);Aa.prototype.isLineBasicMaterial=!0;var ya=new Ut,ba=new Ut,wa=new pe,Ea=new fe,_a=new oe,Sa=function(t){function e(e,n){var r;return void 0===e&&(e=new Nn),void 0===n&&(n=new Aa),(r=t.call(this)||this).type="Line",r.geometry=e,r.material=n,r.updateMorphTargets(),r}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},n.computeLineDistances=function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)ya.fromBufferAttribute(e,r-1),ba.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=ya.distanceTo(ba);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},n.raycast=function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),_a.copy(n.boundingSphere),_a.applyMatrix4(r),_a.radius+=i,!1!==t.ray.intersectsSphere(_a)){wa.copy(r).invert(),Ea.copy(t.ray).applyMatrix4(wa);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,c=new Ut,u=new Ut,l=new Ut,d=new Ut,h=this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,p=n.attributes.position;if(null!==f)for(var v=Math.max(0,o.start),m=Math.min(f.count,o.start+o.count)-1;v<m;v+=h){var g=f.getX(v),A=f.getX(v+1);if(c.fromBufferAttribute(p,g),u.fromBufferAttribute(p,A),!(Ea.distanceSqToSegment(c,u,d,l)>s)){d.applyMatrix4(this.matrixWorld);var y=t.ray.origin.distanceTo(d);y<t.near||y>t.far||e.push({distance:y,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var b=Math.max(0,o.start),w=Math.min(p.count,o.start+o.count)-1;b<w;b+=h){if(c.fromBufferAttribute(p,b),u.fromBufferAttribute(p,b+1),!(Ea.distanceSqToSegment(c,u,d,l)>s)){d.applyMatrix4(this.matrixWorld);var E=t.ray.origin.distanceTo(d);E<t.near||E>t.far||e.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},n.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},e}(Fe);Sa.prototype.isLine=!0;var Ta=new Ut,Ca=new Ut,xa=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="LineSegments",r}return i(e,t),e.prototype.computeLineDistances=function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)Ta.fromBufferAttribute(e,r),Ca.fromBufferAttribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Ta.distanceTo(Ca);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},e}(Sa);xa.prototype.isLineSegments=!0;var Ra=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="LineLoop",r}return i(e,t),e}(Sa);Ra.prototype.isLineLoop=!0;var Ia=function(t){function e(e){var n;return(n=t.call(this)||this).type="PointsMaterial",n.color=new ln(16777215),n.map=null,n.alphaMap=null,n.size=1,n.sizeAttenuation=!0,n.morphTargets=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},e}(nn);Ia.prototype.isPointsMaterial=!0;var Oa=new pe,Ma=new fe,La=new oe,ka=new Ut,Ba=function(t){function e(e,n){var r;return void 0===e&&(e=new Nn),void 0===n&&(n=new Ia),(r=t.call(this)||this).type="Points",r.geometry=e,r.material=n,r.updateMorphTargets(),r}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},n.raycast=function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),La.copy(n.boundingSphere),La.applyMatrix4(r),La.radius+=i,!1!==t.ray.intersectsSphere(La)){Oa.copy(r).invert(),Ma.copy(t.ray).applyMatrix4(Oa);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){var c=n.index,u=n.attributes.position;if(null!==c)for(var l=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);l<d;l++){var h=c.getX(l);ka.fromBufferAttribute(u,h),Na(ka,h,s,r,t,e,this)}else for(var f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);f<p;f++)ka.fromBufferAttribute(u,f),Na(ka,f,s,r,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},n.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},e}(Fe);function Na(t,e,n,r,i,o,a){var s=Ma.distanceSqToPoint(t);if(s<n){var c=new Ut;Ma.closestPointToPoint(t,c),c.applyMatrix4(r);var u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:c,index:e,face:null,object:a})}}Ba.prototype.isPoints=!0;var Pa=function(t){function e(e,n,r,i,a,s,c,u,l){var d;(d=t.call(this,e,n,r,i,a,s,c,u,l)||this).format=void 0!==c?c:k,d.minFilter=void 0!==s?s:S,d.magFilter=void 0!==a?a:S,d.generateMipmaps=!1;var h=o(d);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){h.needsUpdate=!0,e.requestVideoFrameCallback(t)})),d}i(e,t);var n=e.prototype;return n.clone=function(){return new this.constructor(this.image).copy(this)},n.update=function(){var t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)},e}(Mt);Pa.prototype.isVideoTexture=!0;var Ua=function(t){function e(e,n,r,i,o,a,s,c,u,l,d,h){var f;return(f=t.call(this,null,a,s,c,u,l,i,o,d,h)||this).image={width:n,height:r},f.mipmaps=e,f.flipY=!1,f.generateMipmaps=!1,f}return i(e,t),e}(Mt);Ua.prototype.isCompressedTexture=!0;var Da=function(t){function e(e,n,r,i,o,a,s,c,u){var l;return(l=t.call(this,e,n,r,i,o,a,s,c,u)||this).needsUpdate=!0,l}return i(e,t),e}(Mt);Da.prototype.isCanvasTexture=!0;var Fa=function(t){function e(e,n,r,i,o,a,s,c,u,l){var d;if((l=void 0!==l?l:N)!==N&&l!==P)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&l===N&&(r=R),void 0===r&&l===P&&(r=L),(d=t.call(this,null,i,o,a,s,c,l,r,u)||this).image={width:e,height:n},d.magFilter=void 0!==s?s:w,d.minFilter=void 0!==c?c:w,d.flipY=!1,d.generateMipmaps=!1,d}return i(e,t),e}(Mt);Fa.prototype.isDepthTexture=!0;var Ha=function(t){function e(e,n,r,i){var o;void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=0),void 0===i&&(i=2*Math.PI),(o=t.call(this)||this).type="CircleGeometry",o.parameters={radius:e,segments:n,thetaStart:r,thetaLength:i},n=Math.max(3,n);var a=[],s=[],c=[],u=[],l=new Ut,d=new Ct;s.push(0,0,0),c.push(0,0,1),u.push(.5,.5);for(var h=0,f=3;h<=n;h++,f+=3){var p=r+h/n*i;l.x=e*Math.cos(p),l.y=e*Math.sin(p),s.push(l.x,l.y,l.z),c.push(0,0,1),d.x=(s[f]/e+1)/2,d.y=(s[f+1]/e+1)/2,u.push(d.x,d.y)}for(var v=1;v<=n;v++)a.push(v,v+1,0);return o.setIndex(a),o.setAttribute("position",new _n(s,3)),o.setAttribute("normal",new _n(c,3)),o.setAttribute("uv",new _n(u,2)),o}return i(e,t),e}(Nn),ja=function(t){function e(e,n,r,i,a,s,c,u){var l;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=8),void 0===a&&(a=1),void 0===s&&(s=!1),void 0===c&&(c=0),void 0===u&&(u=2*Math.PI),(l=t.call(this)||this).type="CylinderGeometry",l.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:a,openEnded:s,thetaStart:c,thetaLength:u};var d=o(l);i=Math.floor(i),a=Math.floor(a);var h=[],f=[],p=[],v=[],m=0,g=[],A=r/2,y=0;function b(t){for(var r=m,o=new Ct,a=new Ut,s=0,l=!0===t?e:n,g=!0===t?1:-1,b=1;b<=i;b++)f.push(0,A*g,0),p.push(0,g,0),v.push(.5,.5),m++;for(var w=m,E=0;E<=i;E++){var _=E/i*u+c,S=Math.cos(_),T=Math.sin(_);a.x=l*T,a.y=A*g,a.z=l*S,f.push(a.x,a.y,a.z),p.push(0,g,0),o.x=.5*S+.5,o.y=.5*T*g+.5,v.push(o.x,o.y),m++}for(var C=0;C<i;C++){var x=r+C,R=w+C;!0===t?h.push(R,R+1,x):h.push(R+1,R,x),s+=3}d.addGroup(y,s,!0===t?1:2),y+=s}return function(){for(var t=new Ut,o=new Ut,s=0,l=(n-e)/r,b=0;b<=a;b++){for(var w=[],E=b/a,_=E*(n-e)+e,S=0;S<=i;S++){var T=S/i,C=T*u+c,x=Math.sin(C),R=Math.cos(C);o.x=_*x,o.y=-E*r+A,o.z=_*R,f.push(o.x,o.y,o.z),t.set(x,l,R).normalize(),p.push(t.x,t.y,t.z),v.push(T,1-E),w.push(m++)}g.push(w)}for(var I=0;I<i;I++)for(var O=0;O<a;O++){var M=g[O][I],L=g[O+1][I],k=g[O+1][I+1],B=g[O][I+1];h.push(M,L,B),h.push(L,k,B),s+=6}d.addGroup(y,s,0),y+=s}(),!1===s&&(e>0&&b(!0),n>0&&b(!1)),l.setIndex(h),l.setAttribute("position",new _n(f,3)),l.setAttribute("normal",new _n(p,3)),l.setAttribute("uv",new _n(v,2)),l}return i(e,t),e}(Nn),Va=function(t){function e(e,n,r,i,o,a,s){var c;return void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=2*Math.PI),(c=t.call(this,0,e,n,r,i,o,a,s)||this).type="ConeGeometry",c.parameters={radius:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},c}return i(e,t),e}(ja),Ga=function(t){function e(e,n,r,i){var o;void 0===r&&(r=1),void 0===i&&(i=0),(o=t.call(this)||this).type="PolyhedronGeometry",o.parameters={vertices:e,indices:n,radius:r,detail:i};var a=[],s=[];function c(t,e,n,r){for(var i=r+1,o=[],a=0;a<=i;a++){o[a]=[];for(var s=t.clone().lerp(n,a/i),c=e.clone().lerp(n,a/i),l=i-a,d=0;d<=l;d++)o[a][d]=0===d&&a===i?s:s.clone().lerp(c,d/l)}for(var h=0;h<i;h++)for(var f=0;f<2*(i-h)-1;f++){var p=Math.floor(f/2);f%2==0?(u(o[h][p+1]),u(o[h+1][p]),u(o[h][p])):(u(o[h][p+1]),u(o[h+1][p+1]),u(o[h+1][p]))}}function u(t){a.push(t.x,t.y,t.z)}function l(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function d(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}return function(t){for(var e=new Ut,r=new Ut,i=new Ut,o=0;o<n.length;o+=3)l(n[o+0],e),l(n[o+1],r),l(n[o+2],i),c(e,r,i,t)}(i),function(t){for(var e=new Ut,n=0;n<a.length;n+=3)e.x=a[n+0],e.y=a[n+1],e.z=a[n+2],e.normalize().multiplyScalar(t),a[n+0]=e.x,a[n+1]=e.y,a[n+2]=e.z}(r),function(){for(var t=new Ut,e=0;e<a.length;e+=3){t.x=a[e+0],t.y=a[e+1],t.z=a[e+2];var n=h(t)/2/Math.PI+.5,r=(i=t,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);s.push(n,1-r)}var i;(function(){for(var t=new Ut,e=new Ut,n=new Ut,r=new Ut,i=new Ct,o=new Ct,c=new Ct,u=0,l=0;u<a.length;u+=9,l+=6){t.set(a[u+0],a[u+1],a[u+2]),e.set(a[u+3],a[u+4],a[u+5]),n.set(a[u+6],a[u+7],a[u+8]),i.set(s[l+0],s[l+1]),o.set(s[l+2],s[l+3]),c.set(s[l+4],s[l+5]),r.copy(t).add(e).add(n).divideScalar(3);var f=h(r);d(i,l+0,t,f),d(o,l+2,e,f),d(c,l+4,n,f)}})(),function(){for(var t=0;t<s.length;t+=6){var e=s[t+0],n=s[t+2],r=s[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),o.setAttribute("position",new _n(a,3)),o.setAttribute("normal",new _n(a.slice(),3)),o.setAttribute("uv",new _n(s,2)),0===i?o.computeVertexNormals():o.normalizeNormals(),o}return i(e,t),e}(Nn),Qa=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);var i=(1+Math.sqrt(5))/2,o=1/i,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o];return(r=t.call(this,a,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,n)||this).type="DodecahedronGeometry",r.parameters={radius:e,detail:n},r}return i(e,t),e}(Ga),za=new Ut,qa=new Ut,Wa=new Ut,Ka=new tn,Xa=function(t){function e(e,n){var r;if((r=t.call(this)||this).type="EdgesGeometry",r.parameters={thresholdAngle:n},n=void 0!==n?n:1,!0===e.isGeometry)return console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),o(r);for(var i=Math.pow(10,4),a=Math.cos(mt*n),s=e.getIndex(),c=e.getAttribute("position"),u=s?s.count:c.count,l=[0,0,0],d=["a","b","c"],h=new Array(3),f={},p=[],v=0;v<u;v+=3){s?(l[0]=s.getX(v),l[1]=s.getX(v+1),l[2]=s.getX(v+2)):(l[0]=v,l[1]=v+1,l[2]=v+2);var m=Ka.a,g=Ka.b,A=Ka.c;if(m.fromBufferAttribute(c,l[0]),g.fromBufferAttribute(c,l[1]),A.fromBufferAttribute(c,l[2]),Ka.getNormal(Wa),h[0]=Math.round(m.x*i)+","+Math.round(m.y*i)+","+Math.round(m.z*i),h[1]=Math.round(g.x*i)+","+Math.round(g.y*i)+","+Math.round(g.z*i),h[2]=Math.round(A.x*i)+","+Math.round(A.y*i)+","+Math.round(A.z*i),h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(var y=0;y<3;y++){var b=(y+1)%3,w=h[y],E=h[b],_=Ka[d[y]],S=Ka[d[b]],T=w+"_"+E,C=E+"_"+w;C in f&&f[C]?(Wa.dot(f[C].normal)<=a&&(p.push(_.x,_.y,_.z),p.push(S.x,S.y,S.z)),f[C]=null):T in f||(f[T]={index0:l[y],index1:l[b],normal:Wa.clone()})}}for(var x in f)if(f[x]){var R=f[x],I=R.index0,O=R.index1;za.fromBufferAttribute(c,I),qa.fromBufferAttribute(c,O),p.push(za.x,za.y,za.z),p.push(qa.x,qa.y,qa.z)}return r.setAttribute("position",new _n(p,3)),r}return i(e,t),e}(Nn),Ja=function(t,e,n){n=n||2;var r,i,o,a,s,c,u,l=e&&e.length,d=l?e[0]*n:t.length,h=Ya(t,0,d,n,!0),f=[];if(!h||h.next===h.prev)return f;if(l&&(h=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Ya(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(cs(a));for(s.sort(is),i=0;i<s.length;i++)os(s[i],n),n=$a(n,n.next);return n}(t,e,h,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var p=n;p<d;p+=n)(s=t[p])<r&&(r=s),(c=t[p+1])<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return Za(h,f,n,r,i,u),f};function Ya(t,e,n,r,i){var o,a;if(i===function(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=As(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=As(o,t[o],t[o+1],a);return a&&hs(a,a.next)&&(ys(a),a=a.next),a}function $a(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!hs(r,r.next)&&0!==ds(r.prev,r,r.next))r=r.next;else{if(ys(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Za(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=ss(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,o);for(var s,c,u=t;t.prev!==t.next;)if(s=t.prev,c=t.next,o?es(t,r,i,o):ts(t))e.push(s.i/n),e.push(t.i/n),e.push(c.i/n),ys(t),t=c.next,u=c.next;else if((t=c)===u){a?1===a?Za(t=ns($a(t),e,n),e,n,r,i,o,2):2===a&&rs(t,e,n,r,i,o):Za($a(t),e,n,r,i,o,1);break}}}function ts(t){var e=t.prev,n=t,r=t.next;if(ds(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(us(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&ds(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function es(t,e,n,r){var i=t.prev,o=t,a=t.next;if(ds(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=ss(s,c,e,n,r),h=ss(u,l,e,n,r),f=t.prevZ,p=t.nextZ;f&&f.z>=d&&p&&p.z<=h;){if(f!==t.prev&&f!==t.next&&us(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ds(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&us(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ds(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==t.prev&&f!==t.next&&us(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ds(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==t.prev&&p!==t.next&&us(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ds(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ns(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!hs(i,o)&&fs(i,r,r.next,o)&&ms(i,o)&&ms(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),ys(r),ys(r.next),r=t=o),r=r.next}while(r!==t);return $a(r)}function rs(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ls(a,s)){var c=gs(a,s);return a=$a(a,a.next),c=$a(c,c.next),Za(a,e,n,r,i,o),void Za(c,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function is(t,e){return t.x-e.x}function os(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var c,u=n,l=n.x,d=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&us(o<d?i:a,o,l,d,o<d?a:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),ms(r,t)&&(c<h||c===h&&(r.x>n.x||r.x===n.x&&as(n,r)))&&(n=r,h=c)),r=r.next}while(r!==u);return n}(t,e)){var n=gs(e,t);$a(e,e.next),$a(n,n.next)}}function as(t,e){return ds(t.prev,t,e.prev)<0&&ds(e.next,t,t.next)<0}function ss(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cs(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function us(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function ls(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&fs(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ms(t,e)&&ms(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(ds(t.prev,t,e.prev)||ds(t,e.prev,e))||hs(t,e)&&ds(t.prev,t,t.next)>0&&ds(e.prev,e,e.next)>0)}function ds(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function hs(t,e){return t.x===e.x&&t.y===e.y}function fs(t,e,n,r){var i=vs(ds(t,e,n)),o=vs(ds(t,e,r)),a=vs(ds(n,r,t)),s=vs(ds(n,r,e));return i!==o&&a!==s||(!(0!==i||!ps(t,n,e))||(!(0!==o||!ps(t,r,e))||(!(0!==a||!ps(n,t,r))||!(0!==s||!ps(n,e,r)))))}function ps(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function vs(t){return t>0?1:t<0?-1:0}function ms(t,e){return ds(t.prev,t,t.next)<0?ds(t,e,t.next)>=0&&ds(t,t.prev,e)>=0:ds(t,e,t.prev)<0||ds(t,t.next,e)<0}function gs(t,e){var n=new bs(t.i,t.x,t.y),r=new bs(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function As(t,e,n,r){var i=new bs(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ys(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bs(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ws=function(){function t(){}return t.area=function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},t.isClockWise=function(e){return t.area(e)<0},t.triangulateShape=function(t,e){var n=[],r=[],i=[];Es(t),_s(n,t);var o=t.length;e.forEach(Es);for(var a=0;a<e.length;a++)r.push(o),o+=e[a].length,_s(n,e[a]);for(var s=Ja(n,r),c=0;c<s.length;c+=3)i.push(s.slice(c,c+3));return i},t}();function Es(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function _s(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var Ss=function(t){function e(e,n){var r;(r=t.call(this)||this).type="ExtrudeGeometry",r.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];for(var i=o(r),a=[],s=[],c=0,u=e.length;c<u;c++){l(e[c])}function l(t){var e=[],r=void 0!==n.curveSegments?n.curveSegments:12,o=void 0!==n.steps?n.steps:1,c=void 0!==n.depth?n.depth:100,u=void 0===n.bevelEnabled||n.bevelEnabled,l=void 0!==n.bevelThickness?n.bevelThickness:6,d=void 0!==n.bevelSize?n.bevelSize:l-2,h=void 0!==n.bevelOffset?n.bevelOffset:0,f=void 0!==n.bevelSegments?n.bevelSegments:3,p=n.extrudePath,v=void 0!==n.UVGenerator?n.UVGenerator:Ts;void 0!==n.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=n.amount);var m,g,A,y,b,w=!1;p&&(m=p.getSpacedPoints(o),w=!0,u=!1,g=p.computeFrenetFrames(o,!1),A=new Ut,y=new Ut,b=new Ut),u||(f=0,l=0,d=0,h=0);var E=t.extractPoints(r),_=E.shape,S=E.holes;if(!ws.isClockWise(_)){_=_.reverse();for(var T=0,C=S.length;T<C;T++){var x=S[T];ws.isClockWise(x)&&(S[T]=x.reverse())}}for(var R=ws.triangulateShape(_,S),I=_,O=0,M=S.length;O<M;O++){var L=S[O];_=_.concat(L)}function k(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}var B=_.length,N=R.length;function P(t,e,n){var r,i,o,a=t.x-e.x,s=t.y-e.y,c=n.x-t.x,u=n.y-t.y,l=a*a+s*s,d=a*u-s*c;if(Math.abs(d)>Number.EPSILON){var h=Math.sqrt(l),f=Math.sqrt(c*c+u*u),p=e.x-s/h,v=e.y+a/h,m=((n.x-u/f-p)*u-(n.y+c/f-v)*c)/(a*u-s*c),g=(r=p+a*m-t.x)*r+(i=v+s*m-t.y)*i;if(g<=2)return new Ct(r,i);o=Math.sqrt(g/2)}else{var A=!1;a>Number.EPSILON?c>Number.EPSILON&&(A=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(A=!0):Math.sign(s)===Math.sign(u)&&(A=!0),A?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new Ct(r/o,i/o)}for(var U=[],D=0,F=I.length,H=F-1,j=D+1;D<F;D++,H++,j++)H===F&&(H=0),j===F&&(j=0),U[D]=P(I[D],I[H],I[j]);for(var V,G=[],Q=U.concat(),z=0,q=S.length;z<q;z++){var W=S[z];V=[];for(var K=0,X=W.length,J=X-1,Y=K+1;K<X;K++,J++,Y++)J===X&&(J=0),Y===X&&(Y=0),V[K]=P(W[K],W[J],W[Y]);G.push(V),Q=Q.concat(V)}for(var $=0;$<f;$++){for(var Z=$/f,tt=l*Math.cos(Z*Math.PI/2),et=d*Math.sin(Z*Math.PI/2)+h,nt=0,rt=I.length;nt<rt;nt++){var it=k(I[nt],U[nt],et);Lt(it.x,it.y,-tt)}for(var ot=0,at=S.length;ot<at;ot++){var st=S[ot];V=G[ot];for(var ct=0,ut=st.length;ct<ut;ct++){var lt=k(st[ct],V[ct],et);Lt(lt.x,lt.y,-tt)}}}for(var dt=d+h,ht=0;ht<B;ht++){var ft=u?k(_[ht],Q[ht],dt):_[ht];w?(y.copy(g.normals[0]).multiplyScalar(ft.x),A.copy(g.binormals[0]).multiplyScalar(ft.y),b.copy(m[0]).add(y).add(A),Lt(b.x,b.y,b.z)):Lt(ft.x,ft.y,0)}for(var pt=1;pt<=o;pt++)for(var vt=0;vt<B;vt++){var mt=u?k(_[vt],Q[vt],dt):_[vt];w?(y.copy(g.normals[pt]).multiplyScalar(mt.x),A.copy(g.binormals[pt]).multiplyScalar(mt.y),b.copy(m[pt]).add(y).add(A),Lt(b.x,b.y,b.z)):Lt(mt.x,mt.y,c/o*pt)}for(var gt=f-1;gt>=0;gt--){for(var At=gt/f,yt=l*Math.cos(At*Math.PI/2),bt=d*Math.sin(At*Math.PI/2)+h,wt=0,Et=I.length;wt<Et;wt++){var _t=k(I[wt],U[wt],bt);Lt(_t.x,_t.y,c+yt)}for(var St=0,Tt=S.length;St<Tt;St++){var xt=S[St];V=G[St];for(var Rt=0,It=xt.length;Rt<It;Rt++){var Ot=k(xt[Rt],V[Rt],bt);w?Lt(Ot.x,Ot.y+m[o-1].y,m[o-1].x+yt):Lt(Ot.x,Ot.y,c+yt)}}}function Mt(t,e){for(var n=t.length;--n>=0;){var r=n,i=n-1;i<0&&(i=t.length-1);for(var a=0,s=o+2*f;a<s;a++){var c=B*a,u=B*(a+1);Bt(e+r+c,e+i+c,e+i+u,e+r+u)}}}function Lt(t,n,r){e.push(t),e.push(n),e.push(r)}function kt(t,e,n){Nt(t),Nt(e),Nt(n);var r=a.length/3,o=v.generateTopUV(i,a,r-3,r-2,r-1);Pt(o[0]),Pt(o[1]),Pt(o[2])}function Bt(t,e,n,r){Nt(t),Nt(e),Nt(r),Nt(e),Nt(n),Nt(r);var o=a.length/3,s=v.generateSideWallUV(i,a,o-6,o-3,o-2,o-1);Pt(s[0]),Pt(s[1]),Pt(s[3]),Pt(s[1]),Pt(s[2]),Pt(s[3])}function Nt(t){a.push(e[3*t+0]),a.push(e[3*t+1]),a.push(e[3*t+2])}function Pt(t){s.push(t.x),s.push(t.y)}!function(){var t=a.length/3;if(u){for(var e=0,n=B*e,r=0;r<N;r++){var s=R[r];kt(s[2]+n,s[1]+n,s[0]+n)}n=B*(e=o+2*f);for(var c=0;c<N;c++){var l=R[c];kt(l[0]+n,l[1]+n,l[2]+n)}}else{for(var d=0;d<N;d++){var h=R[d];kt(h[2],h[1],h[0])}for(var p=0;p<N;p++){var v=R[p];kt(v[0]+B*o,v[1]+B*o,v[2]+B*o)}}i.addGroup(t,a.length/3-t,0)}(),function(){var t=a.length/3,e=0;Mt(I,e),e+=I.length;for(var n=0,r=S.length;n<r;n++){var o=S[n];Mt(o,e),e+=o.length}i.addGroup(t,a.length/3-t,1)}()}return r.setAttribute("position",new _n(a,3)),r.setAttribute("uv",new _n(s,2)),r.computeVertexNormals(),r}return i(e,t),e.prototype.toJSON=function(){var t=Nn.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)},e}(Nn),Ts={generateTopUV:function(t,e,n,r,i){var o=e[3*n],a=e[3*n+1],s=e[3*r],c=e[3*r+1],u=e[3*i],l=e[3*i+1];return[new Ct(o,a),new Ct(s,c),new Ct(u,l)]},generateSideWallUV:function(t,e,n,r,i,o){var a=e[3*n],s=e[3*n+1],c=e[3*n+2],u=e[3*r],l=e[3*r+1],d=e[3*r+2],h=e[3*i],f=e[3*i+1],p=e[3*i+2],v=e[3*o],m=e[3*o+1],g=e[3*o+2];return Math.abs(s-l)<.01?[new Ct(a,1-c),new Ct(u,1-d),new Ct(h,1-p),new Ct(v,1-g)]:[new Ct(s,1-c),new Ct(l,1-d),new Ct(f,1-p),new Ct(m,1-g)]}};var Cs=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);var i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];return(r=t.call(this,o,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,n)||this).type="IcosahedronGeometry",r.parameters={radius:e,detail:n},r}return i(e,t),e}(Ga),xs=function(t){function e(e,n,r,i){var o;void 0===n&&(n=12),void 0===r&&(r=0),void 0===i&&(i=2*Math.PI),(o=t.call(this)||this).type="LatheGeometry",o.parameters={points:e,segments:n,phiStart:r,phiLength:i},n=Math.floor(n),i=yt(i,0,2*Math.PI);for(var a=[],s=[],c=[],u=1/n,l=new Ut,d=new Ct,h=0;h<=n;h++)for(var f=r+h*u*i,p=Math.sin(f),v=Math.cos(f),m=0;m<=e.length-1;m++)l.x=e[m].x*p,l.y=e[m].y,l.z=e[m].x*v,s.push(l.x,l.y,l.z),d.x=h/n,d.y=m/(e.length-1),c.push(d.x,d.y);for(var g=0;g<n;g++)for(var A=0;A<e.length-1;A++){var y=A+g*e.length,b=y,w=y+e.length,E=y+e.length+1,_=y+1;a.push(b,w,_),a.push(w,E,_)}if(o.setIndex(a),o.setAttribute("position",new _n(s,3)),o.setAttribute("uv",new _n(c,2)),o.computeVertexNormals(),i===2*Math.PI)for(var S=o.attributes.normal.array,T=new Ut,C=new Ut,x=new Ut,R=n*e.length*3,I=0,O=0;I<e.length;I++,O+=3)T.x=S[O+0],T.y=S[O+1],T.z=S[O+2],C.x=S[R+O+0],C.y=S[R+O+1],C.z=S[R+O+2],x.addVectors(T,C).normalize(),S[O+0]=S[R+O+0]=x.x,S[O+1]=S[R+O+1]=x.y,S[O+2]=S[R+O+2]=x.z;return o}return i(e,t),e}(Nn),Rs=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);return(r=t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,n)||this).type="OctahedronGeometry",r.parameters={radius:e,detail:n},r}return i(e,t),e}(Ga),Is=function(t){function e(e,n,r){var i;(i=t.call(this)||this).type="ParametricGeometry",i.parameters={func:e,slices:n,stacks:r};var o=[],a=[],s=[],c=[],u=1e-5,l=new Ut,d=new Ut,h=new Ut,f=new Ut,p=new Ut;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var v=n+1,m=0;m<=r;m++)for(var g=m/r,A=0;A<=n;A++){var y=A/n;e(y,g,d),a.push(d.x,d.y,d.z),y-u>=0?(e(y-u,g,h),f.subVectors(d,h)):(e(y+u,g,h),f.subVectors(h,d)),g-u>=0?(e(y,g-u,h),p.subVectors(d,h)):(e(y,g+u,h),p.subVectors(h,d)),l.crossVectors(f,p).normalize(),s.push(l.x,l.y,l.z),c.push(y,g)}for(var b=0;b<r;b++)for(var w=0;w<n;w++){var E=b*v+w,_=b*v+w+1,S=(b+1)*v+w+1,T=(b+1)*v+w;o.push(E,_,T),o.push(_,S,T)}return i.setIndex(o),i.setAttribute("position",new _n(a,3)),i.setAttribute("normal",new _n(s,3)),i.setAttribute("uv",new _n(c,2)),i}return i(e,t),e}(Nn),Os=function(t){function e(e,n,r,i,o,a){var s;void 0===e&&(e=.5),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===o&&(o=0),void 0===a&&(a=2*Math.PI),(s=t.call(this)||this).type="RingGeometry",s.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:a},r=Math.max(3,r);for(var c=[],u=[],l=[],d=[],h=e,f=(n-e)/(i=Math.max(1,i)),p=new Ut,v=new Ct,m=0;m<=i;m++){for(var g=0;g<=r;g++){var A=o+g/r*a;p.x=h*Math.cos(A),p.y=h*Math.sin(A),u.push(p.x,p.y,p.z),l.push(0,0,1),v.x=(p.x/n+1)/2,v.y=(p.y/n+1)/2,d.push(v.x,v.y)}h+=f}for(var y=0;y<i;y++)for(var b=y*(r+1),w=0;w<r;w++){var E=w+b,_=E,S=E+r+1,T=E+r+2,C=E+1;c.push(_,S,C),c.push(S,T,C)}return s.setIndex(c),s.setAttribute("position",new _n(u,3)),s.setAttribute("normal",new _n(l,3)),s.setAttribute("uv",new _n(d,2)),s}return i(e,t),e}(Nn),Ms=function(t){function e(e,n){var r;void 0===n&&(n=12),(r=t.call(this)||this).type="ShapeGeometry",r.parameters={shapes:e,curveSegments:n};var i=[],o=[],a=[],s=[],c=0,u=0;if(!1===Array.isArray(e))d(e);else for(var l=0;l<e.length;l++)d(e[l]),r.addGroup(c,u,l),c+=u,u=0;function d(t){var e=o.length/3,r=t.extractPoints(n),c=r.shape,l=r.holes;!1===ws.isClockWise(c)&&(c=c.reverse());for(var d=0,h=l.length;d<h;d++){var f=l[d];!0===ws.isClockWise(f)&&(l[d]=f.reverse())}for(var p=ws.triangulateShape(c,l),v=0,m=l.length;v<m;v++){var g=l[v];c=c.concat(g)}for(var A=0,y=c.length;A<y;A++){var b=c[A];o.push(b.x,b.y,0),a.push(0,0,1),s.push(b.x,b.y)}for(var w=0,E=p.length;w<E;w++){var _=p[w],S=_[0]+e,T=_[1]+e,C=_[2]+e;i.push(S,T,C),u+=3}}return r.setIndex(i),r.setAttribute("position",new _n(o,3)),r.setAttribute("normal",new _n(a,3)),r.setAttribute("uv",new _n(s,2)),r}return i(e,t),e.prototype.toJSON=function(){var t=Nn.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)},e}(Nn);var Ls=function(t){function e(e,n,r,i,o,a,s){var c;void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=6),void 0===i&&(i=0),void 0===o&&(o=2*Math.PI),void 0===a&&(a=0),void 0===s&&(s=Math.PI),(c=t.call(this)||this).type="SphereGeometry",c.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:i,phiLength:o,thetaStart:a,thetaLength:s},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));for(var u=Math.min(a+s,Math.PI),l=0,d=[],h=new Ut,f=new Ut,p=[],v=[],m=[],g=[],A=0;A<=r;A++){var y=[],b=A/r,w=0;0==A&&0==a?w=.5/n:A==r&&u==Math.PI&&(w=-.5/n);for(var E=0;E<=n;E++){var _=E/n;h.x=-e*Math.cos(i+_*o)*Math.sin(a+b*s),h.y=e*Math.cos(a+b*s),h.z=e*Math.sin(i+_*o)*Math.sin(a+b*s),v.push(h.x,h.y,h.z),f.copy(h).normalize(),m.push(f.x,f.y,f.z),g.push(_+w,1-b),y.push(l++)}d.push(y)}for(var S=0;S<r;S++)for(var T=0;T<n;T++){var C=d[S][T+1],x=d[S][T],R=d[S+1][T],I=d[S+1][T+1];(0!==S||a>0)&&p.push(C,x,I),(S!==r-1||u<Math.PI)&&p.push(x,R,I)}return c.setIndex(p),c.setAttribute("position",new _n(v,3)),c.setAttribute("normal",new _n(m,3)),c.setAttribute("uv",new _n(g,2)),c}return i(e,t),e}(Nn),ks=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);return(r=t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,n)||this).type="TetrahedronGeometry",r.parameters={radius:e,detail:n},r}return i(e,t),e}(Ga),Bs=function(t){function e(e,n){var r;void 0===n&&(n={});var i=n.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Nn||o(r);var a=i.generateShapes(e,n.size);return n.depth=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),(r=t.call(this,a,n)||this).type="TextGeometry",r}return i(e,t),e}(Ss),Ns=function(t){function e(e,n,r,i,o){var a;void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=8),void 0===i&&(i=6),void 0===o&&(o=2*Math.PI),(a=t.call(this)||this).type="TorusGeometry",a.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);for(var s=[],c=[],u=[],l=[],d=new Ut,h=new Ut,f=new Ut,p=0;p<=r;p++)for(var v=0;v<=i;v++){var m=v/i*o,g=p/r*Math.PI*2;h.x=(e+n*Math.cos(g))*Math.cos(m),h.y=(e+n*Math.cos(g))*Math.sin(m),h.z=n*Math.sin(g),c.push(h.x,h.y,h.z),d.x=e*Math.cos(m),d.y=e*Math.sin(m),f.subVectors(h,d).normalize(),u.push(f.x,f.y,f.z),l.push(v/i),l.push(p/r)}for(var A=1;A<=r;A++)for(var y=1;y<=i;y++){var b=(i+1)*A+y-1,w=(i+1)*(A-1)+y-1,E=(i+1)*(A-1)+y,_=(i+1)*A+y;s.push(b,w,_),s.push(w,E,_)}return a.setIndex(s),a.setAttribute("position",new _n(c,3)),a.setAttribute("normal",new _n(u,3)),a.setAttribute("uv",new _n(l,2)),a}return i(e,t),e}(Nn),Ps=function(t){function e(e,n,r,i,o,a){var s;void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=64),void 0===i&&(i=8),void 0===o&&(o=2),void 0===a&&(a=3),(s=t.call(this)||this).type="TorusKnotGeometry",s.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:o,q:a},r=Math.floor(r),i=Math.floor(i);for(var c=[],u=[],l=[],d=[],h=new Ut,f=new Ut,p=new Ut,v=new Ut,m=new Ut,g=new Ut,A=new Ut,y=0;y<=r;++y){var b=y/r*o*Math.PI*2;M(b,o,a,e,p),M(b+.01,o,a,e,v),g.subVectors(v,p),A.addVectors(v,p),m.crossVectors(g,A),A.crossVectors(m,g),m.normalize(),A.normalize();for(var w=0;w<=i;++w){var E=w/i*Math.PI*2,_=-n*Math.cos(E),S=n*Math.sin(E);h.x=p.x+(_*A.x+S*m.x),h.y=p.y+(_*A.y+S*m.y),h.z=p.z+(_*A.z+S*m.z),u.push(h.x,h.y,h.z),f.subVectors(h,p).normalize(),l.push(f.x,f.y,f.z),d.push(y/r),d.push(w/i)}}for(var T=1;T<=r;T++)for(var C=1;C<=i;C++){var x=(i+1)*(T-1)+(C-1),R=(i+1)*T+(C-1),I=(i+1)*T+C,O=(i+1)*(T-1)+C;c.push(x,R,O),c.push(R,I,O)}function M(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,c=Math.cos(s);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*a*.5,i.z=r*Math.sin(s)*.5}return s.setIndex(c),s.setAttribute("position",new _n(u,3)),s.setAttribute("normal",new _n(l,3)),s.setAttribute("uv",new _n(d,2)),s}return i(e,t),e}(Nn),Us=function(t){function e(e,n,r,i,o){var a;void 0===n&&(n=64),void 0===r&&(r=1),void 0===i&&(i=8),void 0===o&&(o=!1),(a=t.call(this)||this).type="TubeGeometry",a.parameters={path:e,tubularSegments:n,radius:r,radialSegments:i,closed:o};var s=e.computeFrenetFrames(n,o);a.tangents=s.tangents,a.normals=s.normals,a.binormals=s.binormals;var c=new Ut,u=new Ut,l=new Ct,d=new Ut,h=[],f=[],p=[],v=[];function m(t){d=e.getPointAt(t/n,d);for(var o=s.normals[t],a=s.binormals[t],l=0;l<=i;l++){var p=l/i*Math.PI*2,v=Math.sin(p),m=-Math.cos(p);u.x=m*o.x+v*a.x,u.y=m*o.y+v*a.y,u.z=m*o.z+v*a.z,u.normalize(),f.push(u.x,u.y,u.z),c.x=d.x+r*u.x,c.y=d.y+r*u.y,c.z=d.z+r*u.z,h.push(c.x,c.y,c.z)}}return function(){for(var t=0;t<n;t++)m(t);m(!1===o?n:0),function(){for(var t=0;t<=n;t++)for(var e=0;e<=i;e++)l.x=t/n,l.y=e/i,p.push(l.x,l.y)}(),function(){for(var t=1;t<=n;t++)for(var e=1;e<=i;e++){var r=(i+1)*(t-1)+(e-1),o=(i+1)*t+(e-1),a=(i+1)*t+e,s=(i+1)*(t-1)+e;v.push(r,o,s),v.push(o,a,s)}}()}(),a.setIndex(v),a.setAttribute("position",new _n(h,3)),a.setAttribute("normal",new _n(f,3)),a.setAttribute("uv",new _n(p,2)),a}return i(e,t),e.prototype.toJSON=function(){var t=Nn.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},e}(Nn),Ds=function(t){function e(e){var n;if((n=t.call(this)||this).type="WireframeGeometry",!0===e.isGeometry)return console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),o(n);var r=[],i=[0,0],a={},s=new Ut;if(null!==e.index){var c=e.attributes.position,u=e.index,l=e.groups;0===l.length&&(l=[{start:0,count:u.count,materialIndex:0}]);for(var d=0,h=l.length;d<h;++d)for(var f=l[d],p=f.start,v=p,m=p+f.count;v<m;v+=3)for(var g=0;g<3;g++){var A=u.getX(v+g),y=u.getX(v+(g+1)%3);i[0]=Math.min(A,y),i[1]=Math.max(A,y);var b=i[0]+","+i[1];void 0===a[b]&&(a[b]={index1:i[0],index2:i[1]})}for(var w in a){var E=a[w];s.fromBufferAttribute(c,E.index1),r.push(s.x,s.y,s.z),s.fromBufferAttribute(c,E.index2),r.push(s.x,s.y,s.z)}}else for(var _=e.attributes.position,S=0,T=_.count/3;S<T;S++)for(var C=0;C<3;C++){var x=3*S+C;s.fromBufferAttribute(_,x),r.push(s.x,s.y,s.z);var R=3*S+(C+1)%3;s.fromBufferAttribute(_,R),r.push(s.x,s.y,s.z)}return n.setAttribute("position",new _n(r,3)),n}return i(e,t),e}(Nn),Fs=Object.freeze({__proto__:null,BoxGeometry:er,BoxBufferGeometry:er,CircleGeometry:Ha,CircleBufferGeometry:Ha,ConeGeometry:Va,ConeBufferGeometry:Va,CylinderGeometry:ja,CylinderBufferGeometry:ja,DodecahedronGeometry:Qa,DodecahedronBufferGeometry:Qa,EdgesGeometry:Xa,ExtrudeGeometry:Ss,ExtrudeBufferGeometry:Ss,IcosahedronGeometry:Cs,IcosahedronBufferGeometry:Cs,LatheGeometry:xs,LatheBufferGeometry:xs,OctahedronGeometry:Rs,OctahedronBufferGeometry:Rs,ParametricGeometry:Is,ParametricBufferGeometry:Is,PlaneGeometry:Ar,PlaneBufferGeometry:Ar,PolyhedronGeometry:Ga,PolyhedronBufferGeometry:Ga,RingGeometry:Os,RingBufferGeometry:Os,ShapeGeometry:Ms,ShapeBufferGeometry:Ms,SphereGeometry:Ls,SphereBufferGeometry:Ls,TetrahedronGeometry:ks,TetrahedronBufferGeometry:ks,TextGeometry:Bs,TextBufferGeometry:Bs,TorusGeometry:Ns,TorusBufferGeometry:Ns,TorusKnotGeometry:Ps,TorusKnotBufferGeometry:Ps,TubeGeometry:Us,TubeBufferGeometry:Us,WireframeGeometry:Ds}),Hs=function(t){function e(e){var n;return(n=t.call(this)||this).type="ShadowMaterial",n.color=new ln(0),n.transparent=!0,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this},e}(nn);Hs.prototype.isShadowMaterial=!0;var js=function(t){function e(e){var n;return(n=t.call(this,e)||this).type="RawShaderMaterial",n}return i(e,t),e}(or);js.prototype.isRawShaderMaterial=!0;var Vs=function(t){function e(e){var n;return(n=t.call(this)||this).defines={STANDARD:""},n.type="MeshStandardMaterial",n.color=new ln(16777215),n.roughness=1,n.metalness=0,n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new ln(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new Ct(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.roughnessMap=null,n.metalnessMap=null,n.alphaMap=null,n.envMap=null,n.envMapIntensity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.flatShading=!1,n.vertexTangents=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this},e}(nn);Vs.prototype.isMeshStandardMaterial=!0;var Gs=function(t){function e(e){var n;return(n=t.call(this)||this).defines={STANDARD:"",PHYSICAL:""},n.type="MeshPhysicalMaterial",n.clearcoat=0,n.clearcoatMap=null,n.clearcoatRoughness=0,n.clearcoatRoughnessMap=null,n.clearcoatNormalScale=new Ct(1,1),n.clearcoatNormalMap=null,n.reflectivity=.5,Object.defineProperty(o(n),"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=yt(2.5*(t-1)/(t+1),0,1)}}),n.sheen=null,n.transmission=0,n.transmissionMap=null,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ln).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},e}(Vs);Gs.prototype.isMeshPhysicalMaterial=!0;var Qs=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshPhongMaterial",n.color=new ln(16777215),n.specular=new ln(1118481),n.shininess=30,n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new ln(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new Ct(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.combine=0,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.flatShading=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(nn);Qs.prototype.isMeshPhongMaterial=!0;var zs=function(t){function e(e){var n;return(n=t.call(this)||this).defines={TOON:""},n.type="MeshToonMaterial",n.color=new ln(16777215),n.map=null,n.gradientMap=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new ln(0),n.emissiveIntensity=1,n.emissiveMap=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new Ct(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.alphaMap=null,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},e}(nn);zs.prototype.isMeshToonMaterial=!0;var qs=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshNormalMaterial",n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new Ct(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.flatShading=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(nn);qs.prototype.isMeshNormalMaterial=!0;var Ws=function(t){function e(e){var n;return(n=t.call(this)||this).type="MeshLambertMaterial",n.color=new ln(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.emissive=new ln(0),n.emissiveIntensity=1,n.emissiveMap=null,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.combine=0,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},e}(nn);Ws.prototype.isMeshLambertMaterial=!0;var Ks=function(t){function e(e){var n;return(n=t.call(this)||this).defines={MATCAP:""},n.type="MeshMatcapMaterial",n.color=new ln(16777215),n.matcap=null,n.map=null,n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new Ct(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.alphaMap=null,n.skinning=!1,n.morphTargets=!1,n.morphNormals=!1,n.flatShading=!1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(nn);Ks.prototype.isMeshMatcapMaterial=!0;var Xs=function(t){function e(e){var n;return(n=t.call(this)||this).type="LineDashedMaterial",n.scale=1,n.dashSize=3,n.gapSize=1,n.setValues(e),n}return i(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},e}(Aa);Xs.prototype.isLineDashedMaterial=!0;var Js=Object.freeze({__proto__:null,ShadowMaterial:Hs,SpriteMaterial:Fo,RawShaderMaterial:js,ShaderMaterial:or,PointsMaterial:Ia,MeshPhysicalMaterial:Gs,MeshStandardMaterial:Vs,MeshPhongMaterial:Qs,MeshToonMaterial:zs,MeshNormalMaterial:qs,MeshLambertMaterial:Ws,MeshDepthMaterial:Ao,MeshDistanceMaterial:yo,MeshBasicMaterial:dn,MeshMatcapMaterial:Ks,LineDashedMaterial:Xs,LineBasicMaterial:Aa,Material:nn}),Ys={arraySlice:function(t,e,n){return Ys.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,c=0;c!==e;++c)i[a++]=t[s+c];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,n,r,i){void 0===i&&(i=30);var o=t.clone();o.name=e;for(var a=[],s=0;s<o.tracks.length;++s){for(var c=o.tracks[s],u=c.getValueSize(),l=[],d=[],h=0;h<c.times.length;++h){var f=c.times[h]*i;if(!(f<n||f>=r)){l.push(c.times[h]);for(var p=0;p<u;++p)d.push(c.values[h*u+p])}}0!==l.length&&(c.times=Ys.convertArray(l,c.times.constructor),c.values=Ys.convertArray(d,c.values.constructor),a.push(c))}o.tracks=a;for(var v=1/0,m=0;m<o.tracks.length;++m)v>o.tracks[m].times[0]&&(v=o.tracks[m].times[0]);for(var g=0;g<o.tracks.length;++g)o.tracks[g].shift(-1*v);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),void 0===r&&(r=30),r<=0&&(r=30);for(var i=n.tracks.length,o=e/r,a=function(e){var r=n.tracks[e],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var a=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0===a)return"continue";var s=0,c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=c/3);var u=0,l=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=l/3);var d=r.times.length-1,h=void 0;if(o<=r.times[0]){var f=s,p=c-s;h=Ys.arraySlice(r.values,f,p)}else if(o>=r.times[d]){var v=d*c+s,m=v+c-s;h=Ys.arraySlice(r.values,v,m)}else{var g=r.createInterpolant(),A=s,y=c-s;g.evaluate(o),h=Ys.arraySlice(g.resultBuffer,A,y)}"quaternion"===i&&(new Pt).fromArray(h).normalize().conjugate().toArray(h);for(var b=a.times.length,w=0;w<b;++w){var E=w*l+u;if("quaternion"===i)Pt.multiplyQuaternionsFlat(a.values,E,h,0,a.values,E);else for(var _=l-2*u,S=0;S<_;++S)a.values[E+S]-=h[S]}},s=0;s<i;++s)a(s);return t.blendMode=tt,t}},$s=function(){function t(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}var e=t.prototype;return e.evaluate=function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var o;n:{r:if(!(t<r)){for(var a=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===a)break;if(i=r,t<(r=e[++n]))break e}o=e.length;break n}if(t>=i)break t;var s=e[1];t<s&&(n=2,i=s);for(var c=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===c)break;if(r=i,t>=(i=e[--n-1]))break e}o=n,n=0}for(;n<o;){var u=n+o>>>1;t<e[u]?o=u:n=u+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},e.getSettings_=function(){return this.settings||this.DefaultSettings_},e.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,o=0;o!==r;++o)e[o]=n[i+o];return e},e.interpolate_=function(){throw new Error("call to abstract method")},e.intervalChanged_=function(){},t}();$s.prototype.beforeStart_=$s.prototype.copySampleValue_,$s.prototype.afterEnd_=$s.prototype.copySampleValue_;var Zs=function(t){function e(e,n,r,i){var o;return(o=t.call(this,e,n,r,i)||this)._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:J,endingEnd:J},o}i(e,t);var n=e.prototype;return n.intervalChanged_=function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case Y:i=t,a=2*e-n;break;case $:a=e+r[i=r.length-2]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Y:o=t,s=2*n-e;break;case $:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}var c=.5*(n-e),u=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u},n.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=this._offsetPrev,l=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-e)/(r-e),p=f*f,v=p*f,m=-d*v+2*d*p-d*f,g=(1+d)*v+(-1.5-2*d)*p+(-.5+d)*f+1,A=(-1-h)*v+(1.5+h)*p+.5*f,y=h*v-h*p,b=0;b!==a;++b)i[b]=m*o[u+b]+g*o[c+b]+A*o[s+b]+y*o[l+b];return i},e}($s),tc=function(t){function e(e,n,r,i){return t.call(this,e,n,r,i)||this}return i(e,t),e.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,c=s-a,u=(n-e)/(r-e),l=1-u,d=0;d!==a;++d)i[d]=o[c+d]*l+o[s+d]*u;return i},e}($s),ec=function(t){function e(e,n,r,i){return t.call(this,e,n,r,i)||this}return i(e,t),e.prototype.interpolate_=function(t){return this.copySampleValue_(t-1)},e}($s),nc=function(){function t(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ys.convertArray(e,this.TimeBufferType),this.values=Ys.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}t.toJSON=function(t){var e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:Ys.convertArray(t.times,Array),values:Ys.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e};var e=t.prototype;return e.InterpolantFactoryMethodDiscrete=function(t){return new ec(this.times,this.values,this.getValueSize(),t)},e.InterpolantFactoryMethodLinear=function(t){return new tc(this.times,this.values,this.getValueSize(),t)},e.InterpolantFactoryMethodSmooth=function(t){return new Zs(this.times,this.values,this.getValueSize(),t)},e.setInterpolation=function(t){var e;switch(t){case W:e=this.InterpolantFactoryMethodDiscrete;break;case K:e=this.InterpolantFactoryMethodLinear;break;case X:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},e.getInterpolation=function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return W;case this.InterpolantFactoryMethodLinear:return K;case this.InterpolantFactoryMethodSmooth:return X}},e.getValueSize=function(){return this.values.length/this.times.length},e.shift=function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},e.scale=function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},e.trim=function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Ys.arraySlice(n,i,o),this.values=Ys.arraySlice(this.values,i*a,o*a)}return this},e.validate=function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==r&&Ys.isTypedArray(r))for(var c=0,u=r.length;c!==u;++c){var l=r[c];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,l),t=!1;break}}return t},e.optimize=function(){for(var t=Ys.arraySlice(this.times),e=Ys.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===X,i=t.length-1,o=1,a=1;a<i;++a){var s=!1,c=t[a];if(c!==t[a+1]&&(1!==a||c!==t[0]))if(r)s=!0;else for(var u=a*n,l=u-n,d=u+n,h=0;h!==n;++h){var f=e[u+h];if(f!==e[l+h]||f!==e[d+h]){s=!0;break}}if(s){if(a!==o){t[o]=t[a];for(var p=a*n,v=o*n,m=0;m!==n;++m)e[v+m]=e[p+m]}++o}}if(i>0){t[o]=t[i];for(var g=i*n,A=o*n,y=0;y!==n;++y)e[A+y]=e[g+y];++o}return o!==t.length?(this.times=Ys.arraySlice(t,0,o),this.values=Ys.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},e.clone=function(){var t=Ys.arraySlice(this.times,0),e=Ys.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n},t}();nc.prototype.TimeBufferType=Float32Array,nc.prototype.ValueBufferType=Float32Array,nc.prototype.DefaultInterpolation=K;var rc=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(nc);rc.prototype.ValueTypeName="bool",rc.prototype.ValueBufferType=Array,rc.prototype.DefaultInterpolation=W,rc.prototype.InterpolantFactoryMethodLinear=void 0,rc.prototype.InterpolantFactoryMethodSmooth=void 0;var ic=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(nc);ic.prototype.ValueTypeName="color";var oc=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(nc);oc.prototype.ValueTypeName="number";var ac=function(t){function e(e,n,r,i){return t.call(this,e,n,r,i)||this}return i(e,t),e.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(r-e),c=t*a,u=c+a;c!==u;c+=4)Pt.slerpFlat(i,0,o,c-a,o,c,s);return i},e}($s),sc=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.InterpolantFactoryMethodLinear=function(t){return new ac(this.times,this.values,this.getValueSize(),t)},e}(nc);sc.prototype.ValueTypeName="quaternion",sc.prototype.DefaultInterpolation=K,sc.prototype.InterpolantFactoryMethodSmooth=void 0;var cc=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(nc);cc.prototype.ValueTypeName="string",cc.prototype.ValueBufferType=Array,cc.prototype.DefaultInterpolation=W,cc.prototype.InterpolantFactoryMethodLinear=void 0,cc.prototype.InterpolantFactoryMethodSmooth=void 0;var uc=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(nc);uc.prototype.ValueTypeName="vector";var lc=function(){function t(t,e,n,r){void 0===e&&(e=-1),void 0===r&&(r=Z),this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=At(),this.duration<0&&this.resetDuration()}t.parse=function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(dc(n[i]).scale(r));var a=new this(t.name,t.duration,e,t.blendMode);return a.uuid=t.uuid,a},t.toJSON=function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},i=0,o=n.length;i!==o;++i)e.push(nc.toJSON(n[i]));return r},t.CreateFromMorphTargetSequence=function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],c=[];s.push((a+i-1)%i,a,(a+1)%i),c.push(0,1,0);var u=Ys.getKeyframeOrder(s);s=Ys.sortedArray(s,1,u),c=Ys.sortedArray(c,1,u),r||0!==s[0]||(s.push(i),c.push(c[0])),o.push(new oc(".morphTargetInfluences["+e[a].name+"]",s,c).scale(1/n))}return new this(t,-1,o)},t.findByName=function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},t.CreateClipsFromMorphTargetSequences=function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],c=s.name.match(i);if(c&&c.length>1){var u=c[1],l=r[u];l||(r[u]=l=[]),l.push(s)}}var d=[];for(var h in r)d.push(this.CreateFromMorphTargetSequence(h,r[h],e,n));return d},t.parseAnimation=function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];Ys.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.fps||30,a=t.blendMode,s=t.length||-1,c=t.hierarchy||[],u=0;u<c.length;u++){var l=c[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){var d={},h=void 0;for(h=0;h<l.length;h++)if(l[h].morphTargets)for(var f=0;f<l[h].morphTargets.length;f++)d[l[h].morphTargets[f]]=-1;for(var p in d){for(var v=[],m=[],g=0;g!==l[h].morphTargets.length;++g){var A=l[h];v.push(A.time),m.push(A.morphTarget===p?1:0)}r.push(new oc(".morphTargetInfluence["+p+"]",v,m))}s=d.length*(o||1)}else{var y=".bones["+e[u].name+"]";n(uc,y+".position",l,"pos",r),n(sc,y+".quaternion",l,"rot",r),n(uc,y+".scale",l,"scl",r)}}return 0===r.length?null:new this(i,s,r,a)};var e=t.prototype;return e.resetDuration=function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},e.trim=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},e.validate=function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},e.optimize=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},e.clone=function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)},e.toJSON=function(){return this.constructor.toJSON(this)},t}();function dc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return oc;case"vector":case"vector2":case"vector3":case"vector4":return uc;case"color":return ic;case"quaternion":return sc;case"bool":case"boolean":return rc;case"string":return cc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],r=[];Ys.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var hc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},fc=function(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){var e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(var e=0,n=c.length;e<n;e+=2){var r=c[e],i=c[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null}},pc=new fc,vc=function(){function t(t){this.manager=void 0!==t?t:pc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var e=t.prototype;return e.load=function(){},e.loadAsync=function(t,e){var n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},e.parse=function(){},e.setCrossOrigin=function(t){return this.crossOrigin=t,this},e.setWithCredentials=function(t){return this.withCredentials=t,this},e.setPath=function(t){return this.path=t,this},e.setResourcePath=function(t){return this.resourcePath=t,this},e.setRequestHeader=function(t){return this.requestHeader=t,this},t}(),mc={},gc=function(t){function e(e){return t.call(this,e)||this}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=hc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===mc[t]){var a,s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var c=s[1],u=!!s[2],l=s[3];l=decodeURIComponent(l),u&&(l=atob(l));try{var d,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var f=new Uint8Array(l.length),p=0;p<l.length;p++)f[p]=l.charCodeAt(p);d="blob"===h?new Blob([f.buffer],{type:c}):f.buffer;break;case"document":var v=new DOMParser;d=v.parseFromString(l,c);break;case"json":d=JSON.parse(l);break;default:d=l}setTimeout((function(){e&&e(d),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{for(var m in mc[t]=[],mc[t].push({onLoad:e,onProgress:n,onError:r}),(a=new XMLHttpRequest).open("GET",t,!0),a.addEventListener("load",(function(e){var n=this.response,r=mc[t];if(delete mc[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),hc.add(t,n);for(var o=0,a=r.length;o<a;o++){var s=r[o];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(t)}else{for(var c=0,u=r.length;c<u;c++){var l=r[c];l.onError&&l.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){for(var n=mc[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}}),!1),a.addEventListener("error",(function(e){var n=mc[t];delete mc[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){var n=mc[t];delete mc[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)a.setRequestHeader(m,this.requestHeader[m]);a.send(null)}return i.manager.itemStart(t),a}mc[t].push({onLoad:e,onProgress:n,onError:r})},n.setResponseType=function(t){return this.responseType=t,this},n.setMimeType=function(t){return this.mimeType=t,this},e}(vc),Ac=function(t){function e(e){return t.call(this,e)||this}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,o=new gc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},n.parse=function(t){for(var e=[],n=0;n<t.length;n++){var r=lc.parse(t[n]);e.push(r)}return e},e}(vc),yc=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){var i=this,o=[],a=new Ua,s=new gc(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);var c=0;function u(u){s.load(t[u],(function(t){var n=i.parse(t,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(a.minFilter=S),a.image=o,a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,r)}if(Array.isArray(t))for(var l=0,d=t.length;l<d;++l)u(l);else s.load(t,(function(t){var n=i.parse(t,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+c]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=S),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,r);return a},e}(vc),bc=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=hc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",c,!1),hc.add(t,this),e&&e(this),i.manager.itemEnd(t)}function c(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",c,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},e}(vc),wc=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){var i=new lr,o=new bc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(t[n],(function(t){i.images[n]=t,6===++a&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(var c=0;c<t.length;++c)s(c);return i},e}(vc),Ec=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){var i=this,o=new hr,a=new gc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(t,(function(t){var n=i.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:y,o.wrapT=void 0!==n.wrapT?n.wrapT:y,o.magFilter=void 0!==n.magFilter?n.magFilter:S,o.minFilter=void 0!==n.minFilter?n.minFilter:S,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=C),1===n.mipmapCount&&(o.minFilter=S),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n))}),n,r),o},e}(vc),_c=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){var i=new Mt,o=new bc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){i.image=n;var r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?k:B,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i},e}(vc),Sc=function(){function t(){this.type="Curve",this.arcLengthDivisions=200}var e=t.prototype;return e.getPoint=function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},e.getPointAt=function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},e.getPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},e.getSpacedPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},e.getLength=function(){var t=this.getLengths();return t[t.length-1]},e.getLengths=function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],r=this.getPoint(0),i=0;n.push(0);for(var o=1;o<=t;o++)i+=(e=this.getPoint(o/t)).distanceTo(r),n.push(i),r=e;return this.cacheArcLengths=n,n},e.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},e.getUtoTmapping=function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,c=o-1;s<=c;)if((a=r[i=Math.floor(s+(c-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){c=i;break}c=i-1}if(r[i=c]===n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},e.getTangent=function(t,e){var n=1e-4,r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);var o=this.getPoint(r),a=this.getPoint(i),s=e||(o.isVector2?new Ct:new Ut);return s.copy(a).sub(o).normalize(),s},e.getTangentAt=function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)},e.computeFrenetFrames=function(t,e){for(var n=new Ut,r=[],i=[],o=[],a=new Ut,s=new pe,c=0;c<=t;c++){var u=c/t;r[c]=this.getTangentAt(u,new Ut),r[c].normalize()}i[0]=new Ut,o[0]=new Ut;var l=Number.MAX_VALUE,d=Math.abs(r[0].x),h=Math.abs(r[0].y),f=Math.abs(r[0].z);d<=l&&(l=d,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),f<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(var p=1;p<=t;p++){if(i[p]=i[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(r[p-1],r[p]),a.length()>Number.EPSILON){a.normalize();var v=Math.acos(yt(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(a,v))}o[p].crossVectors(r[p],i[p])}if(!0===e){var m=Math.acos(yt(i[0].dot(i[t]),-1,1));m/=t,r[0].dot(a.crossVectors(i[0],i[t]))>0&&(m=-m);for(var g=1;g<=t;g++)i[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),o[g].crossVectors(r[g],i[g])}return{tangents:r,normals:i,binormals:o}},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},e.toJSON=function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},e.fromJSON=function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},t}(),Tc=function(t){function e(e,n,r,i,o,a,s,c){var u;return void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=1),void 0===o&&(o=0),void 0===a&&(a=2*Math.PI),void 0===s&&(s=!1),void 0===c&&(c=0),(u=t.call(this)||this).type="EllipseCurve",u.aX=e,u.aY=n,u.xRadius=r,u.yRadius=i,u.aStartAngle=o,u.aEndAngle=a,u.aClockwise=s,u.aRotation=c,u}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){for(var n=e||new Ct,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),d=s-this.aX,h=c-this.aY;s=d*u-h*l+this.aX,c=d*l+h*u+this.aY}return n.set(s,c)},n.copy=function(e){return t.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},e}(Sc);Tc.prototype.isEllipseCurve=!0;var Cc=function(t){function e(e,n,r,i,o,a){var s;return(s=t.call(this,e,n,r,r,i,o,a)||this).type="ArcCurve",s}return i(e,t),e}(Tc);function xc(){var t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){var c=(e-t)/o-(n-t)/(o+a)+(n-e)/a,u=(n-e)/a-(r-e)/(a+s)+(r-n)/s;i(e,n,c*=a,u*=a)},calc:function(i){var o=i*i;return t+e*i+n*o+r*(o*i)}}}Cc.prototype.isArcCurve=!0;var Rc=new Ut,Ic=new xc,Oc=new xc,Mc=new xc,Lc=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=[]),void 0===n&&(n=!1),void 0===r&&(r="centripetal"),void 0===i&&(i=.5),(o=t.call(this)||this).type="CatmullRomCurve3",o.points=e,o.closed=n,o.curveType=r,o.tension=i,o}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ut);var n,r,i=e,o=this.points,a=o.length,s=(a-(this.closed?0:1))*t,c=Math.floor(s),u=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/a)+1)*a:0===u&&c===a-1&&(c=a-2,u=1),this.closed||c>0?n=o[(c-1)%a]:(Rc.subVectors(o[0],o[1]).add(o[0]),n=Rc);var l=o[c%a],d=o[(c+1)%a];if(this.closed||c+2<a?r=o[(c+2)%a]:(Rc.subVectors(o[a-1],o[a-2]).add(o[a-1]),r=Rc),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(l),h),p=Math.pow(l.distanceToSquared(d),h),v=Math.pow(d.distanceToSquared(r),h);p<1e-4&&(p=1),f<1e-4&&(f=p),v<1e-4&&(v=p),Ic.initNonuniformCatmullRom(n.x,l.x,d.x,r.x,f,p,v),Oc.initNonuniformCatmullRom(n.y,l.y,d.y,r.y,f,p,v),Mc.initNonuniformCatmullRom(n.z,l.z,d.z,r.z,f,p,v)}else"catmullrom"===this.curveType&&(Ic.initCatmullRom(n.x,l.x,d.x,r.x,this.tension),Oc.initCatmullRom(n.y,l.y,d.y,r.y,this.tension),Mc.initCatmullRom(n.z,l.z,d.z,r.z,this.tension));return i.set(Ic.calc(u),Oc.calc(u),Mc.calc(u)),i},n.copy=function(e){t.prototype.copy.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);e.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},n.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push((new Ut).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},e}(Sc);function kc(t,e,n,r,i){var o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function Bc(t,e,n,r){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Nc(t,e,n,r,i){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}Lc.prototype.isCatmullRomCurve3=!0;var Pc=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=new Ct),void 0===n&&(n=new Ct),void 0===r&&(r=new Ct),void 0===i&&(i=new Ct),(o=t.call(this)||this).type="CubicBezierCurve",o.v0=e,o.v1=n,o.v2=r,o.v3=i,o}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ct);var n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Nc(t,r.x,i.x,o.x,a.x),Nc(t,r.y,i.y,o.y,a.y)),n},n.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},e}(Sc);Pc.prototype.isCubicBezierCurve=!0;var Uc=function(t){function e(e,n,r,i){var o;return void 0===e&&(e=new Ut),void 0===n&&(n=new Ut),void 0===r&&(r=new Ut),void 0===i&&(i=new Ut),(o=t.call(this)||this).type="CubicBezierCurve3",o.v0=e,o.v1=n,o.v2=r,o.v3=i,o}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ut);var n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Nc(t,r.x,i.x,o.x,a.x),Nc(t,r.y,i.y,o.y,a.y),Nc(t,r.z,i.z,o.z,a.z)),n},n.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},e}(Sc);Uc.prototype.isCubicBezierCurve3=!0;var Dc=function(t){function e(e,n){var r;return void 0===e&&(e=new Ct),void 0===n&&(n=new Ct),(r=t.call(this)||this).type="LineCurve",r.v1=e,r.v2=n,r}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ct);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},n.getPointAt=function(t,e){return this.getPoint(t,e)},n.getTangent=function(t,e){var n=e||new Ct;return n.copy(this.v2).sub(this.v1).normalize(),n},n.copy=function(e){return t.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Sc);Dc.prototype.isLineCurve=!0;var Fc=function(t){function e(e,n){var r;return void 0===e&&(e=new Ut),void 0===n&&(n=new Ut),(r=t.call(this)||this).type="LineCurve3",r.isLineCurve3=!0,r.v1=e,r.v2=n,r}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ut);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},n.getPointAt=function(t,e){return this.getPoint(t,e)},n.copy=function(e){return t.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Sc),Hc=function(t){function e(e,n,r){var i;return void 0===e&&(e=new Ct),void 0===n&&(n=new Ct),void 0===r&&(r=new Ct),(i=t.call(this)||this).type="QuadraticBezierCurve",i.v0=e,i.v1=n,i.v2=r,i}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ct);var n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Bc(t,r.x,i.x,o.x),Bc(t,r.y,i.y,o.y)),n},n.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Sc);Hc.prototype.isQuadraticBezierCurve=!0;var jc=function(t){function e(e,n,r){var i;return void 0===e&&(e=new Ut),void 0===n&&(n=new Ut),void 0===r&&(r=new Ut),(i=t.call(this)||this).type="QuadraticBezierCurve3",i.v0=e,i.v1=n,i.v2=r,i}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ut);var n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(Bc(t,r.x,i.x,o.x),Bc(t,r.y,i.y,o.y),Bc(t,r.z,i.z,o.z)),n},n.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Sc);jc.prototype.isQuadraticBezierCurve3=!0;var Vc=function(t){function e(e){var n;return void 0===e&&(e=[]),(n=t.call(this)||this).type="SplineCurve",n.points=e,n}i(e,t);var n=e.prototype;return n.getPoint=function(t,e){void 0===e&&(e=new Ct);var n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(kc(a,s.x,c.x,u.x,l.x),kc(a,s.y,c.y,u.y,l.y)),n},n.copy=function(e){t.prototype.copy.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push(i.clone())}return this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);e.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];e.points.push(i.toArray())}return e},n.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push((new Ct).fromArray(i))}return this},e}(Sc);Vc.prototype.isSplineCurve=!0;var Gc=Object.freeze({__proto__:null,ArcCurve:Cc,CatmullRomCurve3:Lc,CubicBezierCurve:Pc,CubicBezierCurve3:Uc,EllipseCurve:Tc,LineCurve:Dc,LineCurve3:Fc,QuadraticBezierCurve:Hc,QuadraticBezierCurve3:jc,SplineCurve:Vc}),Qc=function(t){function e(){var e;return(e=t.call(this)||this).type="CurvePath",e.curves=[],e.autoClose=!1,e}i(e,t);var n=e.prototype;return n.add=function(t){this.curves.push(t)},n.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Dc(e,t))},n.getPoint=function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},n.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},n.updateArcLengths=function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},n.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},n.getSpacedPoints=function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},n.getPoints=function(t){void 0===t&&(t=12);for(var e,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),c=0;c<s.length;c++){var u=s[c];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},n.copy=function(e){t.prototype.copy.call(this,e),this.curves=[];for(var n=0,r=e.curves.length;n<r;n++){var i=e.curves[n];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var n=0,r=this.curves.length;n<r;n++){var i=this.curves[n];e.curves.push(i.toJSON())}return e},n.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var n=0,r=e.curves.length;n<r;n++){var i=e.curves[n];this.curves.push((new Gc[i.type]).fromJSON(i))}return this},e}(Sc),zc=function(t){function e(e){var n;return(n=t.call(this)||this).type="Path",n.currentPoint=new Ct,e&&n.setFromPoints(e),n}i(e,t);var n=e.prototype;return n.setFromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},n.moveTo=function(t,e){return this.currentPoint.set(t,e),this},n.lineTo=function(t,e){var n=new Dc(this.currentPoint.clone(),new Ct(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},n.quadraticCurveTo=function(t,e,n,r){var i=new Hc(this.currentPoint.clone(),new Ct(t,e),new Ct(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},n.bezierCurveTo=function(t,e,n,r,i,o){var a=new Pc(this.currentPoint.clone(),new Ct(t,e),new Ct(n,r),new Ct(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},n.splineThru=function(t){var e=[this.currentPoint.clone()].concat(t),n=new Vc(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},n.arc=function(t,e,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,r,i,o),this},n.absarc=function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},n.ellipse=function(t,e,n,r,i,o,a,s){var c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,e+u,n,r,i,o,a,s),this},n.absellipse=function(t,e,n,r,i,o,a,s){var c=new Tc(t,e,n,r,i,o,a,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);return this.currentPoint.copy(l),this},n.copy=function(e){return t.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},n.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this},e}(Qc),qc=function(t){function e(e){var n;return(n=t.call(this,e)||this).uuid=At(),n.type="Shape",n.holes=[],n}i(e,t);var n=e.prototype;return n.getPointsHoles=function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},n.extractPoints=function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},n.copy=function(e){t.prototype.copy.call(this,e),this.holes=[];for(var n=0,r=e.holes.length;n<r;n++){var i=e.holes[n];this.holes.push(i.clone())}return this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var n=0,r=this.holes.length;n<r;n++){var i=this.holes[n];e.holes.push(i.toJSON())}return e},n.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var n=0,r=e.holes.length;n<r;n++){var i=e.holes[n];this.holes.push((new zc).fromJSON(i))}return this},e}(zc),Wc=function(t){function e(e,n){var r;return void 0===n&&(n=1),(r=t.call(this)||this).type="Light",r.color=new ln(e),r.intensity=n,r}i(e,t);var n=e.prototype;return n.dispose=function(){},n.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,void 0!==this.groundColor&&(n.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(n.object.distance=this.distance),void 0!==this.angle&&(n.object.angle=this.angle),void 0!==this.decay&&(n.object.decay=this.decay),void 0!==this.penumbra&&(n.object.penumbra=this.penumbra),void 0!==this.shadow&&(n.object.shadow=this.shadow.toJSON()),n},e}(Fe);Wc.prototype.isLight=!0;var Kc=function(t){function e(e,n,r){var i;return(i=t.call(this,e,r)||this).type="HemisphereLight",i.position.copy(Fe.DefaultUp),i.updateMatrix(),i.groundColor=new ln(n),i}return i(e,t),e.prototype.copy=function(t){return Wc.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this},e}(Wc);Kc.prototype.isHemisphereLight=!0;var Xc=new pe,Jc=new Ut,Yc=new Ut,$c=function(){function t(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ct(512,512),this.map=null,this.mapPass=null,this.matrix=new pe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vr,this._frameExtents=new Ct(1,1),this._viewportCount=1,this._viewports=[new kt(0,0,1,1)]}var e=t.prototype;return e.getViewportCount=function(){return this._viewportCount},e.getFrustum=function(){return this._frustum},e.updateMatrices=function(t){var e=this.camera,n=this.matrix;Jc.setFromMatrixPosition(t.matrixWorld),e.position.copy(Jc),Yc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Yc),e.updateMatrixWorld(),Xc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},e.getViewport=function(t){return this._viewports[t]},e.getFrameExtents=function(){return this._frameExtents},e.dispose=function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()},e.copy=function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},e.clone=function(){return(new this.constructor).copy(this)},e.toJSON=function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t},t}(),Zc=function(t){function e(){var e;return(e=t.call(this,new sr(50,1,.5,500))||this).focus=1,e}i(e,t);var n=e.prototype;return n.updateMatrices=function(e){var n=this.camera,r=2*gt*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||n.far;r===n.fov&&i===n.aspect&&o===n.far||(n.fov=r,n.aspect=i,n.far=o,n.updateProjectionMatrix()),t.prototype.updateMatrices.call(this,e)},n.copy=function(e){return t.prototype.copy.call(this,e),this.focus=e.focus,this},e}($c);Zc.prototype.isSpotLightShadow=!0;var tu=function(t){function e(e,n,r,i,o,a){var s;return void 0===r&&(r=0),void 0===i&&(i=Math.PI/3),void 0===o&&(o=0),void 0===a&&(a=1),(s=t.call(this,e,n)||this).type="SpotLight",s.position.copy(Fe.DefaultUp),s.updateMatrix(),s.target=new Fe,s.distance=r,s.angle=i,s.penumbra=o,s.decay=a,s.shadow=new Zc,s}i(e,t);var n=e.prototype;return n.dispose=function(){this.shadow.dispose()},n.copy=function(e){return t.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},r(e,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}]),e}(Wc);tu.prototype.isSpotLight=!0;var eu=new pe,nu=new Ut,ru=new Ut,iu=function(t){function e(){var e;return(e=t.call(this,new sr(90,1,.5,500))||this)._frameExtents=new Ct(4,2),e._viewportCount=6,e._viewports=[new kt(2,1,1,1),new kt(0,1,1,1),new kt(3,1,1,1),new kt(1,1,1,1),new kt(3,0,1,1),new kt(1,0,1,1)],e._cubeDirections=[new Ut(1,0,0),new Ut(-1,0,0),new Ut(0,0,1),new Ut(0,0,-1),new Ut(0,1,0),new Ut(0,-1,0)],e._cubeUps=[new Ut(0,1,0),new Ut(0,1,0),new Ut(0,1,0),new Ut(0,1,0),new Ut(0,0,1),new Ut(0,0,-1)],e}return i(e,t),e.prototype.updateMatrices=function(t,e){void 0===e&&(e=0);var n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),nu.setFromMatrixPosition(t.matrixWorld),n.position.copy(nu),ru.copy(n.position),ru.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(ru),n.updateMatrixWorld(),r.makeTranslation(-nu.x,-nu.y,-nu.z),eu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eu)},e}($c);iu.prototype.isPointLightShadow=!0;var ou=function(t){function e(e,n,r,i){var o;return void 0===r&&(r=0),void 0===i&&(i=1),(o=t.call(this,e,n)||this).type="PointLight",o.distance=r,o.decay=i,o.shadow=new iu,o}i(e,t);var n=e.prototype;return n.dispose=function(){this.shadow.dispose()},n.copy=function(e){return t.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},r(e,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}]),e}(Wc);ou.prototype.isPointLight=!0;var au=function(t){function e(e,n,r,i,o,a){var s;return void 0===e&&(e=-1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=-1),void 0===o&&(o=.1),void 0===a&&(a=2e3),(s=t.call(this)||this).type="OrthographicCamera",s.zoom=1,s.view=null,s.left=e,s.right=n,s.top=r,s.bottom=i,s.near=o,s.far=a,s.updateProjectionMatrix(),s}i(e,t);var n=e.prototype;return n.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},n.setViewOffset=function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},n.clearViewOffset=function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},n.updateProjectionMatrix=function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=c*this.view.offsetX)+c*this.view.width,s=(a-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,null!==this.view&&(n.object.view=Object.assign({},this.view)),n},e}(ar);au.prototype.isOrthographicCamera=!0;var su=function(t){function e(){return t.call(this,new au(-5,5,5,-5,.5,500))||this}return i(e,t),e}($c);su.prototype.isDirectionalLightShadow=!0;var cu=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="DirectionalLight",r.position.copy(Fe.DefaultUp),r.updateMatrix(),r.target=new Fe,r.shadow=new su,r}i(e,t);var n=e.prototype;return n.dispose=function(){this.shadow.dispose()},n.copy=function(e){return t.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},e}(Wc);cu.prototype.isDirectionalLight=!0;var uu=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).type="AmbientLight",r}return i(e,t),e}(Wc);uu.prototype.isAmbientLight=!0;var lu=function(t){function e(e,n,r,i){var o;return void 0===r&&(r=10),void 0===i&&(i=10),(o=t.call(this,e,n)||this).type="RectAreaLight",o.width=r,o.height=i,o}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.width=this.width,n.object.height=this.height,n},e}(Wc);lu.prototype.isRectAreaLight=!0;var du=function(){function t(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Ut)}var e=t.prototype;return e.set=function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},e.zero=function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},e.getAt=function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e},e.getIrradianceAt=function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e},e.add=function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},e.addScaledSH=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},e.scale=function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},e.lerp=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},e.equals=function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},e.copy=function(t){return this.set(t.coefficients)},e.clone=function(){return(new this.constructor).copy(this)},e.fromArray=function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(t,e+3*r);return t},t.getBasisAt=function(t,e){var n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)},t}();du.prototype.isSphericalHarmonics3=!0;var hu=function(t){function e(e,n){var r;return void 0===e&&(e=new du),void 0===n&&(n=1),(r=t.call(this,void 0,n)||this).sh=e,r}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.sh.copy(e.sh),this},n.fromJSON=function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.sh=this.sh.toArray(),n},e}(Wc);hu.prototype.isLightProbe=!0;var fu=function(t){function e(e){var n;return(n=t.call(this,e)||this).textures={},n}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,o=new gc(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},n.parse=function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var r=new Js[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new ln).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var i in t.uniforms){var o=t.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new ln).setHex(o.value);break;case"v2":r.uniforms[i].value=(new Ct).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new Ut).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new kt).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new Rt).fromArray(o.value);break;case"m4":r.uniforms[i].value=(new pe).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)r.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Ct).fromArray(s)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Ct).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),r},n.setTextures=function(t){return this.textures=t,this},e}(vc),pu=function(){function t(){}return t.decodeText=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},t.extractUrlBase=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)},t}(),vu=function(t){function e(){var e;return(e=t.call(this)||this).type="InstancedBufferGeometry",e.instanceCount=1/0,e}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},n.clone=function(){return(new this.constructor).copy(this)},n.toJSON=function(){var e=t.prototype.toJSON.call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e},e}(Nn);vu.prototype.isInstancedBufferGeometry=!0;var mu=function(t){function e(e,n,r,i){var o;return"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(o=t.call(this,e,n,r)||this).meshPerAttribute=i||1,o}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e},e}(pn);mu.prototype.isInstancedBufferAttribute=!0;var gu=function(t){function e(e){return t.call(this,e)||this}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,o=new gc(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},n.parse=function(t){var e={},n={};function r(t,r){if(void 0!==e[r])return e[r];var i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];var r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),a=xn(i.type,o),s=new No(a,i.stride);return s.uuid=i.uuid,e[r]=s,s}var i=t.isInstancedBufferGeometry?new vu:new Nn,o=t.data.index;if(void 0!==o){var a=xn(o.type,o.array);i.setIndex(new pn(a,1))}var s=t.data.attributes;for(var c in s){var u=s[c],l=void 0;if(u.isInterleavedBufferAttribute){var d=r(t.data,u.data);l=new Uo(d,u.itemSize,u.offset,u.normalized)}else{var h=xn(u.type,u.array);l=new(u.isInstancedBufferAttribute?mu:pn)(h,u.itemSize,u.normalized)}void 0!==u.name&&(l.name=u.name),void 0!==u.usage&&l.setUsage(u.usage),void 0!==u.updateRange&&(l.updateRange.offset=u.updateRange.offset,l.updateRange.count=u.updateRange.count),i.setAttribute(c,l)}var f=t.data.morphAttributes;if(f)for(var p in f){for(var v=f[p],m=[],g=0,A=v.length;g<A;g++){var y=v[g],b=void 0;if(y.isInterleavedBufferAttribute){var w=r(t.data,y.data);b=new Uo(w,y.itemSize,y.offset,y.normalized)}else{var E=xn(y.type,y.array);b=new pn(E,y.itemSize,y.normalized)}void 0!==y.name&&(b.name=y.name),m.push(b)}i.morphAttributes[p]=m}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var _=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==_)for(var S=0,T=_.length;S!==T;++S){var C=_[S];i.addGroup(C.start,C.count,C.materialIndex)}var x=t.data.boundingSphere;if(void 0!==x){var R=new Ut;void 0!==x.center&&R.fromArray(x.center),i.boundingSphere=new oe(R,x.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i},e}(vc),Au=function(t){function e(e){return t.call(this,e)||this}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,o=""===this.path?pu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;var a=new gc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){var o=null;try{o=JSON.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)},n.parse=function(t,e){var n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(c)})),a=this.parseTextures(t.textures,o),s=this.parseMaterials(t.materials,a),c=this.parseObject(t.object,i,s,n),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),void 0!==e){var l=!1;for(var d in o)if(o[d]instanceof HTMLImageElement){l=!0;break}!1===l&&e(c)}return c},n.parseShapes=function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new qc).fromJSON(t[n]);e[i.uuid]=i}return e},n.parseSkeletons=function(t,e){var n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=(new ha).fromJSON(t[i],r);n[a.uuid]=a}return n},n.parseGeometries=function(t,e){var n,r={};if(void 0!==t)for(var i=new gu,o=0,a=t.length;o<a;o++){var s=void 0,c=t[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Fs[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":s=new Fs[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Fs[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Fs[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Fs[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Fs[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Fs[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Fs[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Fs[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Fs[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Fs[c.type]((new Gc[c.path.type]).fromJSON(c.path),c.tubularSegments,c.radius,c.radialSegments,c.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Fs[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Fs[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(var u=0,l=c.shapes.length;u<l;u++){var d=e[c.shapes[u]];n.push(d)}s=new Fs[c.type](n,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(var h=0,f=c.shapes.length;h<f;h++){var p=e[c.shapes[h]];n.push(p)}var v=c.options.extrudePath;void 0!==v&&(c.options.extrudePath=(new Gc[v.type]).fromJSON(v)),s=new Fs[c.type](n,c.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(c);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),!0===s.isBufferGeometry&&void 0!==c.userData&&(s.userData=c.userData),r[c.uuid]=s}return r},n.parseMaterials=function(t,e){var n={},r={};if(void 0!==t){var i=new fu;i.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];if("MultiMaterial"===s.type){for(var c=[],u=0;u<s.materials.length;u++){var l=s.materials[u];void 0===n[l.uuid]&&(n[l.uuid]=i.parse(l)),c.push(n[l.uuid])}r[s.uuid]=c}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},n.parseAnimations=function(t){var e={};if(void 0!==t)for(var n=0;n<t.length;n++){var r=t[n],i=lc.parse(r);e[i.uuid]=i}return e},n.parseImages=function(t,e){var n,r=this,i={};function o(t){if("string"==typeof t){var e=t;return function(t){return r.manager.itemStart(t),n.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e)}return t.data?{data:xn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){var a=new fc(e);(n=new bc(a)).setCrossOrigin(this.crossOrigin);for(var s=0,c=t.length;s<c;s++){var u=t[s],l=u.url;if(Array.isArray(l)){i[u.uuid]=[];for(var d=0,h=l.length;d<h;d++){var f=o(l[d]);null!==f&&(f instanceof HTMLImageElement?i[u.uuid].push(f):i[u.uuid].push(new hr(f.data,f.width,f.height)))}}else{var p=o(u.url);null!==p&&(i[u.uuid]=p)}}}return i},n.parseTextures=function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=void 0,c=e[a.image];Array.isArray(c)?(s=new lr(c),6===c.length&&(s.needsUpdate=!0)):(s=c&&c.data?new hr(c.data,c.width,c.height):new Mt(c),c&&(s.needsUpdate=!0)),s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,yu)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],bu),s.wrapT=n(a.wrap[1],bu)),void 0!==a.format&&(s.format=a.format),void 0!==a.type&&(s.type=a.type),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,wu)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,wu)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),r[a.uuid]=s}return r},n.parseObject=function(t,e,n,r){var i,o,a;function s(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new Bo,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new ln(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new ko(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new Lo(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new sr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new au(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new uu(t.color,t.intensity);break;case"DirectionalLight":i=new cu(t.color,t.intensity);break;case"PointLight":i=new ou(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new lu(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new tu(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new Kc(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new hu).fromJSON(t);break;case"SkinnedMesh":o=s(t.geometry),a=c(t.material),i=new ca(o,a),void 0!==t.bindMode&&(i.bindMode=t.bindMode),void 0!==t.bindMatrix&&i.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"Mesh":o=s(t.geometry),a=c(t.material),i=new Zn(o,a);break;case"InstancedMesh":o=s(t.geometry),a=c(t.material);var u=t.count,l=t.instanceMatrix,d=t.instanceColor;(i=new ga(o,a,u)).instanceMatrix=new pn(new Float32Array(l.array),16),void 0!==d&&(i.instanceColor=new pn(new Float32Array(d.array),d.itemSize));break;case"LOD":i=new na;break;case"Line":i=new Sa(s(t.geometry),c(t.material));break;case"LineLoop":i=new Ra(s(t.geometry),c(t.material));break;case"LineSegments":i=new xa(s(t.geometry),c(t.material));break;case"PointCloud":case"Points":i=new Ba(s(t.geometry),c(t.material));break;case"Sprite":i=new $o(c(t.material));break;case"Group":i=new To;break;case"Bone":i=new ua;break;default:i=new Fe}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(i.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children)for(var h=t.children,f=0;f<h.length;f++)i.add(this.parseObject(h[f],e,n,r));if(void 0!==t.animations)for(var p=t.animations,v=0;v<p.length;v++){var m=p[v];i.animations.push(r[m])}if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);for(var g=t.levels,A=0;A<g.length;A++){var y=g[A],b=i.getObjectByProperty("uuid",y.object);void 0!==b&&i.addLevel(b,y.distance)}}return i},n.bindSkeletons=function(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){var n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))},n.setTexturePath=function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)},e}(vc),yu={UVMapping:d,CubeReflectionMapping:h,CubeRefractionMapping:f,EquirectangularReflectionMapping:p,EquirectangularRefractionMapping:v,CubeUVReflectionMapping:m,CubeUVRefractionMapping:g},bu={RepeatWrapping:A,ClampToEdgeWrapping:y,MirroredRepeatWrapping:b},wu={NearestFilter:w,NearestMipmapNearestFilter:E,NearestMipmapLinearFilter:_,LinearFilter:S,LinearMipmapNearestFilter:T,LinearMipmapLinearFilter:C},Eu=function(t){function e(e){var n;return n=t.call(this,e)||this,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),n.options={premultiplyAlpha:"none"},n}i(e,t);var n=e.prototype;return n.setOptions=function(t){return this.options=t,this},n.load=function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=hc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){hc.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)},e}(vc);Eu.prototype.isImageBitmapLoader=!0;var _u=function(){function t(){this.type="ShapePath",this.color=new ln,this.subPaths=[],this.currentPath=null}var e=t.prototype;return e.moveTo=function(t,e){return this.currentPath=new zc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},e.lineTo=function(t,e){return this.currentPath.lineTo(t,e),this},e.quadraticCurveTo=function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},e.bezierCurveTo=function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},e.splineThru=function(t){return this.currentPath.splineThru(t),this},e.toShapes=function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new qc;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],c=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=e[o],c=-c,s=e[i],u=-u),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var l=u*(t.x-a.x)-c*(t.y-a.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return r}var i,o,a,s=ws.isClockWise,c=this.subPaths;if(0===c.length)return[];if(!0===e)return n(c);var u=[];if(1===c.length)return o=c[0],(a=new qc).curves=o.curves,u.push(a),u;var l=!s(c[0].getPoints());l=t?!l:l;var d,h,f=[],p=[],v=[],m=0;p[m]=void 0,v[m]=[];for(var g=0,A=c.length;g<A;g++)i=s(d=(o=c[g]).getPoints()),(i=t?!i:i)?(!l&&p[m]&&m++,p[m]={s:new qc,p:d},p[m].s.curves=o.curves,l&&m++,v[m]=[]):v[m].push({h:o,p:d[0]});if(!p[0])return n(c);if(p.length>1){for(var y=!1,b=[],w=0,E=p.length;w<E;w++)f[w]=[];for(var _=0,S=p.length;_<S;_++)for(var T=v[_],C=0;C<T.length;C++){for(var x=T[C],R=!0,I=0;I<p.length;I++)r(x.p,p[I].p)&&(_!==I&&b.push({froms:_,tos:I,hole:C}),R?(R=!1,f[I].push(x)):y=!0);R&&f[_].push(x)}b.length>0&&(y||(v=f))}for(var O=0,M=p.length;O<M;O++){a=p[O].s,u.push(a);for(var L=0,k=(h=v[O]).length;L<k;L++)a.holes.push(h[L].h)}return u},t}(),Su=function(){function t(t){this.type="Font",this.data=t}return t.prototype.generateShapes=function(t,e){void 0===e&&(e=100);for(var n=[],r=function(t,e,n){for(var r=Array.from(t),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,c=0,u=0;u<r.length;u++){var l=r[u];if("\n"===l)s=0,c-=o;else{var d=Tu(l,i,s,c,n);s+=d.offsetX,a.push(d.path)}}return a}(t,e,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n},t}();function Tu(t,e,n,r,i){var o=i.glyphs[t]||i.glyphs["?"];if(o){var a,s,c,u,l,d,h,f,p=new _u;if(o.o)for(var v=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),m=0,g=v.length;m<g;){switch(v[m++]){case"m":a=v[m++]*e+n,s=v[m++]*e+r,p.moveTo(a,s);break;case"l":a=v[m++]*e+n,s=v[m++]*e+r,p.lineTo(a,s);break;case"q":c=v[m++]*e+n,u=v[m++]*e+r,l=v[m++]*e+n,d=v[m++]*e+r,p.quadraticCurveTo(l,d,c,u);break;case"b":c=v[m++]*e+n,u=v[m++]*e+r,l=v[m++]*e+n,d=v[m++]*e+r,h=v[m++]*e+n,f=v[m++]*e+r,p.bezierCurveTo(l,d,h,f,c,u)}}return{offsetX:o.ha*e,path:p}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".")}Su.prototype.isFont=!0;var Cu,xu=function(t){function e(e){return t.call(this,e)||this}i(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,o=new gc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){var n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var r=i.parse(n);e&&e(r)}),n,r)},n.parse=function(t){return new Su(t)},e}(vc),Ru={getContext:function(){return void 0===Cu&&(Cu=new(window.AudioContext||window.webkitAudioContext)),Cu},setContext:function(t){Cu=t}},Iu=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.load=function(t,e,n,r){var i=this,o=new gc(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{var o=n.slice(0);Ru.getContext().decodeAudioData(o,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)},e}(vc),Ou=function(t){function e(e,n,r){var i;void 0===r&&(r=1),i=t.call(this,void 0,r)||this;var o=(new ln).set(e),a=(new ln).set(n),s=new Ut(o.r,o.g,o.b),c=new Ut(a.r,a.g,a.b),u=Math.sqrt(Math.PI),l=u*Math.sqrt(.75);return i.sh.coefficients[0].copy(s).add(c).multiplyScalar(u),i.sh.coefficients[1].copy(s).sub(c).multiplyScalar(l),i}return i(e,t),e}(hu);Ou.prototype.isHemisphereLightProbe=!0;var Mu=function(t){function e(e,n){var r;void 0===n&&(n=1),r=t.call(this,void 0,n)||this;var i=(new ln).set(e);return r.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI)),r}return i(e,t),e}(hu);Mu.prototype.isAmbientLightProbe=!0;var Lu=new pe,ku=new pe,Bu=function(){function t(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return t.prototype.update=function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n,r,i=t.projectionMatrix.clone(),o=e.eyeSep/2,a=o*e.near/e.focus,s=e.near*Math.tan(mt*e.fov*.5)/e.zoom;ku.elements[12]=-o,Lu.elements[12]=o,n=-s*e.aspect+a,r=s*e.aspect+a,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*e.aspect-a,r=s*e.aspect-a,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ku),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Lu)},t}(),Nu=function(){function t(t){void 0===t&&(t=!0),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var e=t.prototype;return e.start=function(){this.startTime=Pu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},e.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},e.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},e.getDelta=function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=Pu();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t},t}();function Pu(){return("undefined"==typeof performance?Date:performance).now()}var Uu=new Ut,Du=new Pt,Fu=new Ut,Hu=new Ut,ju=function(t){function e(){var e;return(e=t.call(this)||this).type="AudioListener",e.context=Ru.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new Nu,e}i(e,t);var n=e.prototype;return n.getInput=function(){return this.gain},n.removeFilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},n.getFilter=function(){return this.filter},n.setFilter=function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},n.getMasterVolume=function(){return this.gain.gain.value},n.setMasterVolume=function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},n.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e);var n=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Uu,Du,Fu),Hu.set(0,0,-1).applyQuaternion(Du),n.positionX){var i=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Uu.x,i),n.positionY.linearRampToValueAtTime(Uu.y,i),n.positionZ.linearRampToValueAtTime(Uu.z,i),n.forwardX.linearRampToValueAtTime(Hu.x,i),n.forwardY.linearRampToValueAtTime(Hu.y,i),n.forwardZ.linearRampToValueAtTime(Hu.z,i),n.upX.linearRampToValueAtTime(r.x,i),n.upY.linearRampToValueAtTime(r.y,i),n.upZ.linearRampToValueAtTime(r.z,i)}else n.setPosition(Uu.x,Uu.y,Uu.z),n.setOrientation(Hu.x,Hu.y,Hu.z,r.x,r.y,r.z)},e}(Fe),Vu=function(t){function e(e){var n;return(n=t.call(this)||this).type="Audio",n.listener=e,n.context=e.context,n.gain=n.context.createGain(),n.gain.connect(e.getInput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopStart=0,n.loopEnd=0,n.offset=0,n.duration=void 0,n.playbackRate=1,n.isPlaying=!1,n.hasPlaybackControl=!0,n.source=null,n.sourceType="empty",n._startedAt=0,n._progress=0,n._connected=!1,n.filters=[],n}i(e,t);var n=e.prototype;return n.getOutput=function(){return this.gain},n.setNodeSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},n.setMediaElementSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},n.setMediaStreamSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},n.setBuffer=function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},n.play=function(t){if(void 0===t&&(t=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},n.pause=function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},n.stop=function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},n.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},n.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},n.getFilters=function(){return this.filters},n.setFilters=function(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this},n.setDetune=function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},n.getDetune=function(){return this.detune},n.getFilter=function(){return this.getFilters()[0]},n.setFilter=function(t){return this.setFilters(t?[t]:[])},n.setPlaybackRate=function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},n.getPlaybackRate=function(){return this.playbackRate},n.onEnded=function(){this.isPlaying=!1},n.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},n.setLoop=function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},n.setLoopStart=function(t){return this.loopStart=t,this},n.setLoopEnd=function(t){return this.loopEnd=t,this},n.getVolume=function(){return this.gain.gain.value},n.setVolume=function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},e}(Fe),Gu=new Ut,Qu=new Pt,zu=new Ut,qu=new Ut,Wu=function(t){function e(e){var n;return(n=t.call(this,e)||this).panner=n.context.createPanner(),n.panner.panningModel="HRTF",n.panner.connect(n.gain),n}i(e,t);var n=e.prototype;return n.getOutput=function(){return this.panner},n.getRefDistance=function(){return this.panner.refDistance},n.setRefDistance=function(t){return this.panner.refDistance=t,this},n.getRolloffFactor=function(){return this.panner.rolloffFactor},n.setRolloffFactor=function(t){return this.panner.rolloffFactor=t,this},n.getDistanceModel=function(){return this.panner.distanceModel},n.setDistanceModel=function(t){return this.panner.distanceModel=t,this},n.getMaxDistance=function(){return this.panner.maxDistance},n.setMaxDistance=function(t){return this.panner.maxDistance=t,this},n.setDirectionalCone=function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},n.updateMatrixWorld=function(e){if(t.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Gu,Qu,zu),qu.set(0,0,1).applyQuaternion(Qu);var n=this.panner;if(n.positionX){var r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Gu.x,r),n.positionY.linearRampToValueAtTime(Gu.y,r),n.positionZ.linearRampToValueAtTime(Gu.z,r),n.orientationX.linearRampToValueAtTime(qu.x,r),n.orientationY.linearRampToValueAtTime(qu.y,r),n.orientationZ.linearRampToValueAtTime(qu.z,r)}else n.setPosition(Gu.x,Gu.y,Gu.z),n.setOrientation(qu.x,qu.y,qu.z)}},e}(Vu),Ku=function(){function t(t,e){void 0===e&&(e=2048),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}var e=t.prototype;return e.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},e.getAverageFrequency=function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length},t}(),Xu=function(){function t(t,e,n){var r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}var e=t.prototype;return e.accumulate=function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},e.accumulateAdditive=function(t){var e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},e.apply=function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=e*this._origIndex;this._mixBufferRegion(n,r,s,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(var c=e,u=e+e;c!==u;++c)if(n[c]!==n[c+e]){a.setValue(n,r);break}},e.saveOriginalState=function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(var i=n,o=r;i!==o;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},e.restoreOriginalState=function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},e._setAdditiveIdentityNumeric=function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,n=t;n<e;n++)this.buffer[n]=0},e._setAdditiveIdentityQuaternion=function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},e._setAdditiveIdentityOther=function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},e._select=function(t,e,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)t[e+o]=t[n+o]},e._slerp=function(t,e,n,r){Pt.slerpFlat(t,e,t,e,t,n,r)},e._slerpAdditive=function(t,e,n,r,i){var o=this._workIndex*i;Pt.multiplyQuaternionsFlat(t,o,t,e,t,n),Pt.slerpFlat(t,e,t,e,t,o,r)},e._lerp=function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}},e._lerpAdditive=function(t,e,n,r,i){for(var o=0;o!==i;++o){var a=e+o;t[a]=t[a]+t[n+o]*r}},t}(),Ju="\\[\\]\\.:\\/",Yu=new RegExp("[\\[\\]\\.:\\/]","g"),$u="[^\\[\\]\\.:\\/]",Zu="[^"+Ju.replace("\\.","")+"]",tl=/((?:WC+[\/:])*)/.source.replace("WC",$u),el=/(WCOD+)?/.source.replace("WCOD",Zu),nl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$u),rl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$u),il=new RegExp("^"+tl+el+nl+rl+"$"),ol=["material","materials","bones"],al=function(){function t(t,e,n){var r=n||sl.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}var e=t.prototype;return e.getValue=function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},e.setValue=function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},e.bind=function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},e.unbind=function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()},t}(),sl=function(){function t(e,n,r){this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}t.create=function(e,n,r){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,r):new t(e,n,r)},t.sanitizeNodeName=function(t){return t.replace(/\s/g,"_").replace(Yu,"")},t.parseTrackName=function(t){var e=il.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==ol.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},t.findNode=function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function t(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===e||i.uuid===e)return i;var o=t(i.children);if(o)return o}return null}(t.children);if(r)return r}return null};var e=t.prototype;return e._getValue_unavailable=function(){},e._setValue_unavailable=function(){},e._getValue_direct=function(t,e){t[e]=this.node[this.propertyName]},e._getValue_array=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},e._getValue_arrayElement=function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},e._getValue_toArray=function(t,e){this.resolvedProperty.toArray(t,e)},e._setValue_direct=function(t,e){this.targetObject[this.propertyName]=t[e]},e._setValue_direct_setNeedsUpdate=function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},e._setValue_direct_setMatrixWorldNeedsUpdate=function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0},e._setValue_array=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},e._setValue_array_setNeedsUpdate=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},e._setValue_array_setMatrixWorldNeedsUpdate=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0},e._setValue_arrayElement=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},e._setValue_arrayElement_setNeedsUpdate=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},e._setValue_arrayElement_setMatrixWorldNeedsUpdate=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0},e._setValue_fromArray=function(t,e){this.resolvedProperty.fromArray(t,e)},e._setValue_fromArray_setNeedsUpdate=function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},e._setValue_fromArray_setMatrixWorldNeedsUpdate=function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0},e._getValue_unbound=function(t,e){this.bind(),this.getValue(t,e)},e._setValue_unbound=function(t,e){this.bind(),this.setValue(t,e)},e.bind=function(){var e=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,o=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=n.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===a){a=s;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var c=e[i];if(void 0!==c){var u=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else void 0!==c.fromArray&&void 0!==c.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(l=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var d=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},e.unbind=function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound},t}();sl.Composite=al,sl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},sl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},sl.prototype.GetterByBindingType=[sl.prototype._getValue_direct,sl.prototype._getValue_array,sl.prototype._getValue_arrayElement,sl.prototype._getValue_toArray],sl.prototype.SetterByBindingTypeAndVersioning=[[sl.prototype._setValue_direct,sl.prototype._setValue_direct_setNeedsUpdate,sl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sl.prototype._setValue_array,sl.prototype._setValue_array_setNeedsUpdate,sl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sl.prototype._setValue_arrayElement,sl.prototype._setValue_arrayElement_setNeedsUpdate,sl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sl.prototype._setValue_fromArray,sl.prototype._setValue_fromArray_setNeedsUpdate,sl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var cl=function(){function t(){this.uuid=At(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}var e=t.prototype;return e.add=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length,a=void 0,s=t.length,c=this.nCachedObjects_,u=0,l=arguments.length;u!==l;++u){var d=arguments[u],h=d.uuid,f=e[h];if(void 0===f){f=s++,e[h]=f,t.push(d);for(var p=0,v=o;p!==v;++p)i[p].push(new sl(d,n[p],r[p]))}else if(f<c){a=t[f];var m=--c,g=t[m];e[g.uuid]=f,t[f]=g,e[h]=m,t[m]=d;for(var A=0,y=o;A!==y;++A){var b=i[A],w=b[m],E=b[f];b[f]=w,void 0===E&&(E=new sl(d,n[A],r[A])),b[m]=E}}else t[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},e.remove=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],c=s.uuid,u=e[c];if(void 0!==u&&u>=i){var l=i++,d=t[l];e[d.uuid]=u,t[u]=d,e[c]=l,t[l]=s;for(var h=0,f=r;h!==f;++h){var p=n[h],v=p[l],m=p[u];p[u]=v,p[l]=m}}}this.nCachedObjects_=i},e.uncache=function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,o=t.length,a=0,s=arguments.length;a!==s;++a){var c=arguments[a],u=c.uuid,l=e[u];if(void 0!==l)if(delete e[u],l<i){var d=--i,h=t[d],f=--o,p=t[f];e[h.uuid]=l,t[l]=h,e[p.uuid]=d,t[d]=p,t.pop();for(var v=0,m=r;v!==m;++v){var g=n[v],A=g[d],y=g[f];g[l]=A,g[d]=y,g.pop()}}else{var b=--o,w=t[b];b>0&&(e[w.uuid]=l),t[l]=w,t.pop();for(var E=0,_=r;E!==_;++E){var S=n[E];S[l]=S[b],S.pop()}}}this.nCachedObjects_=i},e.subscribe_=function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,c=s.length,u=this.nCachedObjects_,l=new Array(c);r=i.length,n[t]=r,o.push(t),a.push(e),i.push(l);for(var d=u,h=s.length;d!==h;++d){var f=s[d];l[d]=new sl(f,t,e)}return l},e.unsubscribe_=function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}},t}();cl.prototype.isAnimationObjectGroup=!0;var ul=function(){function t(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=e.blendMode),this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;for(var i=e.tracks,o=i.length,a=new Array(o),s={endingStart:J,endingEnd:J},c=0;c!==o;++c){var u=i[c].createInterpolant(null);a[c]=u,u.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}var e=t.prototype;return e.play=function(){return this._mixer._activateAction(this),this},e.stop=function(){return this._mixer._deactivateAction(this),this.reset()},e.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},e.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},e.isScheduled=function(){return this._mixer._isActiveAction(this)},e.startAt=function(t){return this._startTime=t,this},e.setLoop=function(t,e){return this.loop=t,this.repetitions=e,this},e.setEffectiveWeight=function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},e.getEffectiveWeight=function(){return this._effectiveWeight},e.fadeIn=function(t){return this._scheduleFading(t,0,1)},e.fadeOut=function(t){return this._scheduleFading(t,1,0)},e.crossFadeFrom=function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,o=i/r,a=r/i;t.warp(1,o,e),this.warp(a,1,e)}return this},e.crossFadeTo=function(t,e,n){return t.crossFadeFrom(this,e,n)},e.stopFading=function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},e.setEffectiveTimeScale=function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},e.getEffectiveTimeScale=function(){return this._effectiveTimeScale},e.setDuration=function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},e.syncWith=function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},e.halt=function(t){return this.warp(this._effectiveTimeScale,0,t)},e.warp=function(t,e,n){var r=this._mixer,i=r.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,c=a.sampleValues;return s[0]=i,s[1]=i+n,c[0]=t/o,c[1]=e/o,this},e.stopWarping=function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},e.getMixer=function(){return this._mixer},e.getClip=function(){return this._clip},e.getRoot=function(){return this._localRoot||this._mixer._root},e._update=function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*n;if(o<0||0===n)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0){var c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case tt:for(var l=0,d=c.length;l!==d;++l)c[l].evaluate(a),u[l].accumulateAdditive(s);break;case Z:default:for(var h=0,f=c.length;h!==f;++h)c[h].evaluate(a),u[h].accumulate(r,s)}}}else this._updateWeight(t)},e._updateWeight=function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},e._updateTimeScale=function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},e._updateTime=function(t){var e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopCount,o=2202===n;if(0===t)return-1===i?r:o&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){var a=Math.floor(r/e);r-=e*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var c=t<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&1==(1&i))return e-r}return r},e._setEndings=function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=Y,r.endingEnd=Y):(r.endingStart=t?this.zeroSlopeAtStart?Y:J:$,r.endingEnd=e?this.zeroSlopeAtEnd?Y:J:$)},e._scheduleFading=function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this},t}(),ll=function(t){function e(e){var n;return(n=t.call(this)||this)._root=e,n._initMemoryManager(),n._accuIndex=0,n.time=0,n.timeScale=1,n}i(e,t);var n=e.prototype;return n._bindAction=function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(u={},c[s]=u);for(var l=0;l!==i;++l){var d=r[l],h=d.name,f=u[h];if(void 0!==f)o[l]=f;else{if(void 0!==(f=o[l])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,h));continue}var p=e&&e._propertyBindings[l].binding.parsedPath;++(f=new Xu(sl.create(n,h,p),d.ValueTypeName,d.getValueSize())).referenceCount,this._addInactiveBinding(f,s,h),o[l]=f}a[l].resultBuffer=f.buffer}},n._activateAction=function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},n._deactivateAction=function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},n._initMemoryManager=function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},n._isActiveAction=function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},n._addInactiveAction=function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},n._removeInactiveAction=function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,c=s[s.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},n._removeInactiveBindingsForAction=function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},n._lendAction=function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},n._takeBackAction=function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},n._addInactiveBinding=function(t,e,n){var r=this._bindingsByRootAndName,i=this._bindings,o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)},n._removeInactiveBinding=function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],c=t._cacheIndex;s._cacheIndex=c,e[c]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},n._lendBinding=function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},n._takeBackBinding=function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},n._lendControlInterpolant=function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new tc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},n._takeBackControlInterpolant=function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},n.clipAction=function(t,e,n){var r=e||this._root,i=r.uuid,o="string"==typeof t?lc.findByName(r,t):t,a=null!==o?o.uuid:t,s=this._actionsByClip[a],c=null;if(void 0===n&&(n=null!==o?o.blendMode:Z),void 0!==s){var u=s.actionByRoot[i];if(void 0!==u&&u.blendMode===n)return u;c=s.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;var l=new ul(this,o,e,n);return this._bindAction(l,c),this._addInactiveAction(l,a,i),l},n.existingAction=function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?lc.findByName(n,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},n.stopAllAction=function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},n.update=function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a){e[a]._update(r,t,i,o)}for(var s=this._bindings,c=this._nActiveBindings,u=0;u!==c;++u)s[u].apply(o);return this},n.setTime=function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},n.getRoot=function(){return this._root},n.uncacheClip=function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var c=o[a];this._deactivateAction(c);var u=c._cacheIndex,l=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,e[u]=l,e.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}},n.uncacheRoot=function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},n.uncacheAction=function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))},e}(ht);ll.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var dl=function(){function t(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return t.prototype.clone=function(){return new t(void 0===this.value.clone?this.value:this.value.clone())},t}(),hl=function(t){function e(e,n,r){var i;return void 0===r&&(r=1),(i=t.call(this,e,n)||this).meshPerAttribute=r||1,i}i(e,t);var n=e.prototype;return n.copy=function(e){return t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},n.clone=function(e){var n=t.prototype.clone.call(this,e);return n.meshPerAttribute=this.meshPerAttribute,n},n.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n},e}(No);hl.prototype.isInstancedInterleavedBuffer=!0;var fl=function(){function t(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}var e=t.prototype;return e.setBuffer=function(t){return this.buffer=t,this},e.setType=function(t,e){return this.type=t,this.elementSize=e,this},e.setItemSize=function(t){return this.itemSize=t,this},e.setCount=function(t){return this.count=t,this},r(t,[{key:"needsUpdate",set:function(t){!0===t&&this.version++}}]),t}();fl.prototype.isGLBufferAttribute=!0;var pl=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=1/0),this.ray=new fe(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new Te,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}var e=t.prototype;return e.set=function(t,e){this.ray.set(t,e)},e.setFromCamera=function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},e.intersectObject=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=[]),ml(t,this,n,e),n.sort(vl),n},e.intersectObjects=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=[]);for(var r=0,i=t.length;r<i;r++)ml(t[r],this,n,e);return n.sort(vl),n},t}();function vl(t,e){return t.distance-e.distance}function ml(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r)for(var i=t.children,o=0,a=i.length;o<a;o++)ml(i[o],e,n,!0)}var gl=function(){function t(t,e,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),this.radius=t,this.phi=e,this.theta=n,this}var e=t.prototype;return e.set=function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},e.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},e.makeSafe=function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},e.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},e.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(yt(e/this.radius,-1,1))),this},e.clone=function(){return(new this.constructor).copy(this)},t}(),Al=function(){function t(t,e,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),this.radius=t,this.theta=e,this.y=n,this}var e=t.prototype;return e.set=function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},e.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},e.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},e.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this},e.clone=function(){return(new this.constructor).copy(this)},t}(),yl=new Ct,bl=function(){function t(t,e){void 0===t&&(t=new Ct(1/0,1/0)),void 0===e&&(e=new Ct(-1/0,-1/0)),this.min=t,this.max=e}var e=t.prototype;return e.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},e.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},e.setFromCenterAndSize=function(t,e){var n=yl.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},e.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},e.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},e.getCenter=function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Ct),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},e.getSize=function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Ct),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},e.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},e.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},e.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},e.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},e.getParameter=function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Ct),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},e.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},e.clampPoint=function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Ct),e.copy(t).clamp(this.min,this.max)},e.distanceToPoint=function(t){return yl.copy(t).clamp(this.min,this.max).sub(t).length()},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}();bl.prototype.isBox2=!0;var wl=new Ut,El=new Ut,_l=function(){function t(t,e){void 0===t&&(t=new Ut),void 0===e&&(e=new Ut),this.start=t,this.end=e}var e=t.prototype;return e.set=function(t,e){return this.start.copy(t),this.end.copy(e),this},e.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},e.getCenter=function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Ut),t.addVectors(this.start,this.end).multiplyScalar(.5)},e.delta=function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Ut),t.subVectors(this.end,this.start)},e.distanceSq=function(){return this.start.distanceToSquared(this.end)},e.distance=function(){return this.start.distanceTo(this.end)},e.at=function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Ut),this.delta(e).multiplyScalar(t).add(this.start)},e.closestPointToPointParameter=function(t,e){wl.subVectors(t,this.start),El.subVectors(this.end,this.start);var n=El.dot(El),r=El.dot(wl)/n;return e&&(r=yt(r,0,1)),r},e.closestPointToPoint=function(t,e,n){var r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Ut),this.delta(n).multiplyScalar(r).add(this.start)},e.applyMatrix4=function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},e.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},e.clone=function(){return(new this.constructor).copy(this)},t}(),Sl=function(t){function e(e){var n;return(n=t.call(this)||this).material=e,n.render=function(){},n.hasPositions=!1,n.hasNormals=!1,n.hasColors=!1,n.hasUvs=!1,n.positionArray=null,n.normalArray=null,n.colorArray=null,n.uvArray=null,n.count=0,n}return i(e,t),e}(Fe);Sl.prototype.isImmediateRenderObject=!0;var Tl=new Ut,Cl=function(t){function e(e,n){var r;(r=t.call(this)||this).light=e,r.light.updateMatrixWorld(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=n;for(var i=new Nn,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],a=0,s=1;a<32;a++,s++){var c=a/32*Math.PI*2,u=s/32*Math.PI*2;o.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new _n(o,3));var l=new Aa({fog:!1,toneMapped:!1});return r.cone=new xa(i,l),r.add(r.cone),r.update(),r}i(e,t);var n=e.prototype;return n.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Tl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Tl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},e}(Fe),xl=new Ut,Rl=new pe,Il=new pe,Ol=function(t){function e(e){for(var n,r=Ml(e),i=new Nn,o=[],a=[],s=new ln(0,0,1),c=new ln(0,1,0),u=0;u<r.length;u++){var l=r[u];l.parent&&l.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),a.push(s.r,s.g,s.b),a.push(c.r,c.g,c.b))}i.setAttribute("position",new _n(o,3)),i.setAttribute("color",new _n(a,3));var d=new Aa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(n=t.call(this,i,d)||this).type="SkeletonHelper",n.isSkeletonHelper=!0,n.root=e,n.bones=r,n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n}return i(e,t),e.prototype.updateMatrixWorld=function(e){var n=this.bones,r=this.geometry,i=r.getAttribute("position");Il.copy(this.root.matrixWorld).invert();for(var o=0,a=0;o<n.length;o++){var s=n[o];s.parent&&s.parent.isBone&&(Rl.multiplyMatrices(Il,s.matrixWorld),xl.setFromMatrixPosition(Rl),i.setXYZ(a,xl.x,xl.y,xl.z),Rl.multiplyMatrices(Il,s.parent.matrixWorld),xl.setFromMatrixPosition(Rl),i.setXYZ(a+1,xl.x,xl.y,xl.z),a+=2)}r.getAttribute("position").needsUpdate=!0,t.prototype.updateMatrixWorld.call(this,e)},e}(xa);function Ml(t){var e=[];t&&t.isBone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,Ml(t.children[n]));return e}var Ll=function(t){function e(e,n,r){var i,o=new Ls(n,4,2),a=new dn({wireframe:!0,fog:!1,toneMapped:!1});return(i=t.call(this,o,a)||this).light=e,i.light.updateMatrixWorld(),i.color=r,i.type="PointLightHelper",i.matrix=i.light.matrixWorld,i.matrixAutoUpdate=!1,i.update(),i}i(e,t);var n=e.prototype;return n.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},e}(Zn),kl=new Ut,Bl=new ln,Nl=new ln,Pl=function(t){function e(e,n,r){var i;(i=t.call(this)||this).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=r;var o=new Rs(n);o.rotateY(.5*Math.PI),i.material=new dn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===i.color&&(i.material.vertexColors=!0);var a=o.getAttribute("position"),s=new Float32Array(3*a.count);return o.setAttribute("color",new pn(s,3)),i.add(new Zn(o,i.material)),i.update(),i}i(e,t);var n=e.prototype;return n.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},n.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");Bl.copy(this.light.color),Nl.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?Bl:Nl;e.setXYZ(n,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(kl.setFromMatrixPosition(this.light.matrixWorld).negate())},e}(Fe),Ul=function(t){function e(e,n,r,i){var o;void 0===e&&(e=10),void 0===n&&(n=10),void 0===r&&(r=4473924),void 0===i&&(i=8947848),r=new ln(r),i=new ln(i);for(var a=n/2,s=e/n,c=e/2,u=[],l=[],d=0,h=0,f=-c;d<=n;d++,f+=s){u.push(-c,0,f,c,0,f),u.push(f,0,-c,f,0,c);var p=d===a?r:i;p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3}var v=new Nn;v.setAttribute("position",new _n(u,3)),v.setAttribute("color",new _n(l,3));var m=new Aa({vertexColors:!0,toneMapped:!1});return(o=t.call(this,v,m)||this).type="GridHelper",o}return i(e,t),e}(xa),Dl=function(t){function e(e,n,r,i,o,a){var s;void 0===e&&(e=10),void 0===n&&(n=16),void 0===r&&(r=8),void 0===i&&(i=64),void 0===o&&(o=4473924),void 0===a&&(a=8947848),o=new ln(o),a=new ln(a);for(var c=[],u=[],l=0;l<=n;l++){var d=l/n*(2*Math.PI),h=Math.sin(d)*e,f=Math.cos(d)*e;c.push(0,0,0),c.push(h,0,f);var p=1&l?o:a;u.push(p.r,p.g,p.b),u.push(p.r,p.g,p.b)}for(var v=0;v<=r;v++)for(var m=1&v?o:a,g=e-e/r*v,A=0;A<i;A++){var y=A/i*(2*Math.PI),b=Math.sin(y)*g,w=Math.cos(y)*g;c.push(b,0,w),u.push(m.r,m.g,m.b),y=(A+1)/i*(2*Math.PI),b=Math.sin(y)*g,w=Math.cos(y)*g,c.push(b,0,w),u.push(m.r,m.g,m.b)}var E=new Nn;E.setAttribute("position",new _n(c,3)),E.setAttribute("color",new _n(u,3));var _=new Aa({vertexColors:!0,toneMapped:!1});return(s=t.call(this,E,_)||this).type="PolarGridHelper",s}return i(e,t),e}(xa),Fl=new Ut,Hl=new Ut,jl=new Ut,Vl=function(t){function e(e,n,r){var i;(i=t.call(this)||this).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=r,void 0===n&&(n=1);var o=new Nn;o.setAttribute("position",new _n([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var a=new Aa({fog:!1,toneMapped:!1});return i.lightPlane=new Sa(o,a),i.add(i.lightPlane),(o=new Nn).setAttribute("position",new _n([0,0,0,0,0,1],3)),i.targetLine=new Sa(o,a),i.add(i.targetLine),i.update(),i}i(e,t);var n=e.prototype;return n.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},n.update=function(){Fl.setFromMatrixPosition(this.light.matrixWorld),Hl.setFromMatrixPosition(this.light.target.matrixWorld),jl.subVectors(Hl,Fl),this.lightPlane.lookAt(Hl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Hl),this.targetLine.scale.z=jl.length()},e}(Fe),Gl=new Ut,Ql=new ar,zl=function(t){function e(e){var n,r=new Nn,i=new Aa({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],a=[],s={},c=new ln(16755200),u=new ln(16711680),l=new ln(43775),d=new ln(16777215),h=new ln(3355443);function f(t,e,n){p(t,n),p(e,n)}function p(t,e){o.push(0,0,0),a.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}return f("n1","n2",c),f("n2","n4",c),f("n4","n3",c),f("n3","n1",c),f("f1","f2",c),f("f2","f4",c),f("f4","f3",c),f("f3","f1",c),f("n1","f1",c),f("n2","f2",c),f("n3","f3",c),f("n4","f4",c),f("p","n1",u),f("p","n2",u),f("p","n3",u),f("p","n4",u),f("u1","u2",l),f("u2","u3",l),f("u3","u1",l),f("c","t",d),f("p","c",h),f("cn1","cn2",h),f("cn3","cn4",h),f("cf1","cf2",h),f("cf3","cf4",h),r.setAttribute("position",new _n(o,3)),r.setAttribute("color",new _n(a,3)),(n=t.call(this,r,i)||this).type="CameraHelper",n.camera=e,n.camera.updateProjectionMatrix&&n.camera.updateProjectionMatrix(),n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n.pointMap=s,n.update(),n}i(e,t);var n=e.prototype;return n.update=function(){var t=this.geometry,e=this.pointMap;Ql.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ql("c",e,t,Ql,0,0,-1),ql("t",e,t,Ql,0,0,1),ql("n1",e,t,Ql,-1,-1,-1),ql("n2",e,t,Ql,1,-1,-1),ql("n3",e,t,Ql,-1,1,-1),ql("n4",e,t,Ql,1,1,-1),ql("f1",e,t,Ql,-1,-1,1),ql("f2",e,t,Ql,1,-1,1),ql("f3",e,t,Ql,-1,1,1),ql("f4",e,t,Ql,1,1,1),ql("u1",e,t,Ql,.7,1.1,-1),ql("u2",e,t,Ql,-.7,1.1,-1),ql("u3",e,t,Ql,0,2,-1),ql("cf1",e,t,Ql,-1,0,1),ql("cf2",e,t,Ql,1,0,1),ql("cf3",e,t,Ql,0,-1,1),ql("cf4",e,t,Ql,0,1,1),ql("cn1",e,t,Ql,-1,0,-1),ql("cn2",e,t,Ql,1,0,-1),ql("cn3",e,t,Ql,0,-1,-1),ql("cn4",e,t,Ql,0,1,-1),t.getAttribute("position").needsUpdate=!0},n.dispose=function(){this.geometry.dispose(),this.material.dispose()},e}(xa);function ql(t,e,n,r,i,o,a){Gl.set(i,o,a).unproject(r);var s=e[t];if(void 0!==s)for(var c=n.getAttribute("position"),u=0,l=s.length;u<l;u++)c.setXYZ(s[u],Gl.x,Gl.y,Gl.z)}var Wl,Kl,Xl=new Ht,Jl=function(t){function e(e,n){var r;void 0===n&&(n=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),a=new Nn;return a.setIndex(new pn(i,1)),a.setAttribute("position",new pn(o,3)),(r=t.call(this,a,new Aa({color:n,toneMapped:!1}))||this).object=e,r.type="BoxHelper",r.matrixAutoUpdate=!1,r.update(),r}i(e,t);var n=e.prototype;return n.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Xl.setFromObject(this.object),!Xl.isEmpty()){var e=Xl.min,n=Xl.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},n.setFromObject=function(t){return this.object=t,this.update(),this},n.copy=function(t){return xa.prototype.copy.call(this,t),this.object=t.object,this},e}(xa),Yl=function(t){function e(e,n){var r;void 0===n&&(n=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Nn;return o.setIndex(new pn(i,1)),o.setAttribute("position",new _n([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(r=t.call(this,o,new Aa({color:n,toneMapped:!1}))||this).box=e,r.type="Box3Helper",r.geometry.computeBoundingSphere(),r}return i(e,t),e.prototype.updateMatrixWorld=function(e){var n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),t.prototype.updateMatrixWorld.call(this,e))},e}(xa),$l=function(t){function e(e,n,r){var i;void 0===n&&(n=1),void 0===r&&(r=16776960);var o=r,a=new Nn;a.setAttribute("position",new _n([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),a.computeBoundingSphere(),(i=t.call(this,a,new Aa({color:o,toneMapped:!1}))||this).type="PlaneHelper",i.plane=e,i.size=n;var s=new Nn;return s.setAttribute("position",new _n([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),i.add(new Zn(s,new dn({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),i}return i(e,t),e.prototype.updateMatrixWorld=function(e){var n=-this.plane.constant;Math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?1:0,this.lookAt(this.plane.normal),t.prototype.updateMatrixWorld.call(this,e)},e}(Sa),Zl=new Ut,td=function(t){function e(e,n,r,i,o,a){var s;return void 0===e&&(e=new Ut(0,0,1)),void 0===n&&(n=new Ut(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===o&&(o=.2*r),void 0===a&&(a=.2*o),(s=t.call(this)||this).type="ArrowHelper",void 0===Wl&&((Wl=new Nn).setAttribute("position",new _n([0,0,0,0,1,0],3)),(Kl=new ja(0,.5,1,5,1)).translate(0,-.5,0)),s.position.copy(n),s.line=new Sa(Wl,new Aa({color:i,toneMapped:!1})),s.line.matrixAutoUpdate=!1,s.add(s.line),s.cone=new Zn(Kl,new dn({color:i,toneMapped:!1})),s.cone.matrixAutoUpdate=!1,s.add(s.cone),s.setDirection(e),s.setLength(r,o,a),s}i(e,t);var n=e.prototype;return n.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Zl.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Zl,e)}},n.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},n.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},n.copy=function(e){return t.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},e}(Fe),ed=function(t){function e(e){var n;void 0===e&&(e=1);var r=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Nn;i.setAttribute("position",new _n(r,3)),i.setAttribute("color",new _n([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var o=new Aa({vertexColors:!0,toneMapped:!1});return(n=t.call(this,i,o)||this).type="AxesHelper",n}return i(e,t),e.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},e}(xa),nd=new Float32Array(1),rd=new Int32Array(nd.buffer),id=function(){function t(){}return t.toHalfFloat=function(t){nd[0]=t;var e=rd[0],n=e>>16&32768,r=e>>12&2047,i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e):i<113?n|=((r|=2048)>>114-i)+(r>>113-i&1):(n|=i-112<<10|r>>1,n+=1&r)},t}(),od=Math.pow(2,8),ad=[.125,.215,.35,.446,.526,.582],sd=5+ad.length,cd=20,ud=((c={})[3e3]=0,c[3001]=1,c[3002]=2,c[3004]=3,c[3005]=4,c[3006]=5,c[3007]=6,c),ld=new dn({side:1,depthWrite:!1,depthTest:!1}),dd=new Zn(new er,ld),hd=new au,fd=Td(),pd=fd._lodPlanes,vd=fd._sizeLods,md=fd._sigmas,gd=new ln,Ad=null,yd=(1+Math.sqrt(5))/2,bd=1/yd,wd=[new Ut(1,1,1),new Ut(-1,1,1),new Ut(1,1,-1),new Ut(-1,1,-1),new Ut(0,yd,bd),new Ut(0,yd,-bd),new Ut(bd,0,yd),new Ut(-bd,0,yd),new Ut(yd,bd,0),new Ut(-yd,bd,0)];function Ed(t){var e=Math.max(t.r,t.g,t.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);return t.multiplyScalar(Math.pow(2,-n)),(n+128)/255}var _d=function(){function t(t){var e,n,r;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=cd,n=new Float32Array(e),r=new Ut(0,1,0),new js({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:ud[3e3]},outputEncoding:{value:ud[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}var e=t.prototype;return e.fromScene=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=.1),void 0===r&&(r=100),Ad=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},e.fromEquirectangular=function(t){return this._fromTexture(t)},e.fromCubemap=function(t){return this._fromTexture(t)},e.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=Id(),this._compileMaterial(this._cubemapShader))},e.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=Rd(),this._compileMaterial(this._equirectShader))},e.dispose=function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<pd.length;t++)pd[t].dispose()},e._cleanup=function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ad),t.scissorTest=!1,xd(t,0,0,t.width,t.height)},e._fromTexture=function(t){Ad=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},e._allocateTargets=function(t){var e={magFilter:w,minFilter:w,generateMipmaps:!1,type:x,format:1023,encoding:Sd(t)?t.encoding:it,depthBuffer:!1},n=Cd(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Cd(e),n},e._compileMaterial=function(t){var e=new Zn(pd[0],t);this._renderer.compile(e,hd)},e._sceneToCubeUV=function(t,e,n,r){var i=new sr(90,1,e,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,c=s.autoClear,u=s.outputEncoding,l=s.toneMapping;s.getClearColor(gd),s.toneMapping=0,s.outputEncoding=et,s.autoClear=!1;var d=!1,h=t.background;if(h){if(h.isColor){ld.color.copy(h).convertSRGBToLinear(),t.background=null;var f=Ed(ld.color);ld.opacity=f,d=!0}}else{ld.color.copy(gd).convertSRGBToLinear();var p=Ed(ld.color);ld.opacity=p,d=!0}for(var v=0;v<6;v++){var m=v%3;0==m?(i.up.set(0,o[v],0),i.lookAt(a[v],0,0)):1==m?(i.up.set(0,0,o[v]),i.lookAt(0,a[v],0)):(i.up.set(0,o[v],0),i.lookAt(0,0,a[v])),xd(r,m*od,v>2?od:0,od,od),s.setRenderTarget(r),d&&s.render(dd,i),s.render(t,i)}s.toneMapping=l,s.outputEncoding=u,s.autoClear=c},e._textureToCubeUV=function(t,e){var n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Id()):null==this._equirectShader&&(this._equirectShader=Rd());var r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Zn(pd[0],r),o=r.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=ud[t.encoding],o.outputEncoding.value=ud[e.texture.encoding],xd(e,0,0,3*od,2*od),n.setRenderTarget(e),n.render(i,hd)},e._applyPMREM=function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var r=1;r<sd;r++){var i=Math.sqrt(md[r]*md[r]-md[r-1]*md[r-1]),o=wd[(r-1)%wd.length];this._blur(t,r-1,r,i,o)}e.autoClear=n},e._blur=function(t,e,n,r,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)},e._halfBlur=function(t,e,n,r,i,o,a){var s=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new Zn(pd[r],c),l=c.uniforms,d=vd[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,f=i/h,p=isFinite(i)?1+Math.floor(3*f):cd;p>cd&&console.warn("sigmaRadians, "+i+", is too large and will clip, as it requested "+p+" samples when the maximum is set to "+cd);for(var v=[],m=0,g=0;g<cd;++g){var A=g/f,y=Math.exp(-A*A/2);v.push(y),0==g?m+=y:g<p&&(m+=2*y)}for(var b=0;b<v.length;b++)v[b]=v[b]/m;l.envMap.value=t.texture,l.samples.value=p,l.weights.value=v,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a),l.dTheta.value=h,l.mipInt.value=8-n,l.inputEncoding.value=ud[t.texture.encoding],l.outputEncoding.value=ud[t.texture.encoding];var w=vd[r];xd(e,3*Math.max(0,od-2*w),(0===r?0:2*od)+2*w*(r>4?r-8+4:0),3*w,2*w),s.setRenderTarget(e),s.render(u,hd)},t}();function Sd(t){return void 0!==t&&t.type===x&&(t.encoding===et||t.encoding===nt||t.encoding===rt)}function Td(){for(var t=[],e=[],n=[],r=8,i=0;i<sd;i++){var o=Math.pow(2,r);e.push(o);var a=1/o;i>4?a=ad[i-8+4-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),c=-s/2,u=1+s/2,l=[c,c,u,c,u,u,c,c,u,u,c,u],d=new Float32Array(108),h=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var v=p%3*2/3-1,m=p>2?0:-1,g=[v,m,0,v+2/3,m,0,v+2/3,m+1,0,v,m,0,v+2/3,m+1,0,v,m+1,0];d.set(g,18*p),h.set(l,12*p);var A=[p,p,p,p,p,p];f.set(A,6*p)}var y=new Nn;y.setAttribute("position",new pn(d,3)),y.setAttribute("uv",new pn(h,2)),y.setAttribute("faceIndex",new pn(f,1)),t.push(y),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function Cd(t){var e=new Bt(3*od,3*od,t);return e.texture.mapping=m,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function xd(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Rd(){var t=new Ct(1,1);return new js({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:ud[3e3]},outputEncoding:{value:ud[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Id(){return new js({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ud[3e3]},outputEncoding:{value:ud[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}Sc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Sc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},zc.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Ul.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ol.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},vc.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),pu.extractUrlBase(t)},vc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},bl.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},bl.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},bl.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},bl.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Ht.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ht.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ht.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ht.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ht.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},oe.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},vr.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},_l.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Rt.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Rt.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Rt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Rt.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Rt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Rt.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},pe.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},pe.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},pe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ut).setFromMatrixColumn(this,3)},pe.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},pe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},pe.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},pe.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},pe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},pe.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},pe.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},pe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},pe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},pe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},pe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},pe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},pe.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},pe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},pe.prototype.makeFrustum=function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)},pe.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Ge.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Pt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Pt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},fe.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},fe.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},fe.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},tn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},tn.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},tn.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},tn.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},tn.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},tn.barycoordFromPoint=function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),tn.getBarycoord(t,e,n,r,i)},tn.normal=function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),tn.getNormal(t,e,n,r)},qc.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},qc.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ss(this,t)},qc.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ms(this,t)},Ct.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ct.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Ct.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ut.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Ut.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Ut.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Ut.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Ut.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Ut.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Ut.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ut.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Ut.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},kt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},kt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Fe.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Fe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Fe.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Fe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Fe.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Fe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Zn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Zn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ca.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},sr.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Wc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(pn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===lt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(lt)}}}),pn.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?lt:ut),this},pn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},pn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Nn.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Nn.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new pn(arguments[1],arguments[2])))},Nn.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Nn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Nn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Nn.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Nn.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Nn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),No.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?lt:ut),this},No.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ss.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Ss.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Ss.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Bo.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},dl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(nn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ln}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(or.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Oo.prototype.clearTarget=function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},Oo.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Oo.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Oo.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Oo.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Oo.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Oo.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Oo.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Oo.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Oo.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Oo.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Oo.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Oo.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Oo.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Oo.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Oo.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Oo.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Oo.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Oo.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Oo.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Oo.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Oo.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Oo.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Oo.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Oo.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Oo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?nt:et}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(bo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Bt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Vu.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Iu).load(t,(function(t){e.setBuffer(t)})),this},Ku.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ur.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},ur.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)},It.crossOrigin=void 0,It.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new _c;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},It.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new wc;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},It.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},It.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Od={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:u}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=u),t.ACESFilmicToneMapping=4,t.AddEquation=l,t.AddOperation=2,t.AdditiveAnimationBlendMode=tt,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=uu,t.AmbientLightProbe=Mu,t.AnimationClip=lc,t.AnimationLoader=Ac,t.AnimationMixer=ll,t.AnimationObjectGroup=cl,t.AnimationUtils=Ys,t.ArcCurve=Cc,t.ArrayCamera=So,t.ArrowHelper=td,t.Audio=Vu,t.AudioAnalyser=Ku,t.AudioContext=Ru,t.AudioListener=ju,t.AudioLoader=Iu,t.AxesHelper=ed,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new ed(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Ec(t)},t.Bone=ua,t.BooleanKeyframeTrack=rc,t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Jl(t,e)},t.Box2=bl,t.Box3=Ht,t.Box3Helper=Yl,t.BoxBufferGeometry=er,t.BoxGeometry=er,t.BoxHelper=Jl,t.BufferAttribute=pn,t.BufferGeometry=Nn,t.BufferGeometryLoader=gu,t.ByteType=1010,t.Cache=hc,t.Camera=ar,t.CameraHelper=zl,t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},t.CanvasTexture=Da,t.CatmullRomCurve3=Lc,t.CineonToneMapping=3,t.CircleBufferGeometry=Ha,t.CircleGeometry=Ha,t.ClampToEdgeWrapping=y,t.Clock=Nu,t.Color=ln,t.ColorKeyframeTrack=ic,t.CompressedTexture=Ua,t.CompressedTextureLoader=yc,t.ConeBufferGeometry=Va,t.ConeGeometry=Va,t.CubeCamera=ur,t.CubeReflectionMapping=h,t.CubeRefractionMapping=f,t.CubeTexture=lr,t.CubeTextureLoader=wc,t.CubeUVReflectionMapping=m,t.CubeUVRefractionMapping=g,t.CubicBezierCurve=Pc,t.CubicBezierCurve3=Uc,t.CubicInterpolant=Zs,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=Sc,t.CurvePath=Qc,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=ja,t.CylinderGeometry=ja,t.Cylindrical=Al,t.DataTexture=hr,t.DataTexture2DArray=Pr,t.DataTexture3D=Ur,t.DataTextureLoader=Ec,t.DataUtils=id,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=pc,t.DepthFormat=N,t.DepthStencilFormat=P,t.DepthTexture=Fa,t.DirectionalLight=cu,t.DirectionalLightHelper=Vl,t.DiscreteInterpolant=ec,t.DodecahedronBufferGeometry=Qa,t.DodecahedronGeometry=Qa,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new pn(t,e).setUsage(lt)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=lt,t.DynamicReadUsage=35049,t.EdgesGeometry=Xa,t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new xa(new Xa(t.geometry),new Aa({color:void 0!==e?e:16777215}))},t.EllipseCurve=Tc,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=p,t.EquirectangularRefractionMapping=v,t.Euler=Se,t.EventDispatcher=ht,t.ExtrudeBufferGeometry=Ss,t.ExtrudeGeometry=Ss,t.FaceColors=1,t.FileLoader=gc,t.FlatShading=1,t.Float16BufferAttribute=En,t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new _n(t,e)},t.Float32BufferAttribute=_n,t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Sn(t,e)},t.Float64BufferAttribute=Sn,t.FloatType=O,t.Fog=ko,t.FogExp2=Lo,t.Font=Su,t.FontLoader=xu,t.FrontSide=0,t.Frustum=vr,t.GLBufferAttribute=fl,t.GLSL1="100",t.GLSL3=dt,t.GammaEncoding=rt,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=Ul,t.Group=To,t.HalfFloatType=M,t.HemisphereLight=Kc,t.HemisphereLightHelper=Pl,t.HemisphereLightProbe=Ou,t.IcosahedronBufferGeometry=Cs,t.IcosahedronGeometry=Cs,t.ImageBitmapLoader=Eu,t.ImageLoader=bc,t.ImageUtils=It,t.ImmediateRenderObject=Sl,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=mu,t.InstancedBufferGeometry=vu,t.InstancedInterleavedBuffer=hl,t.InstancedMesh=ga,t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new An(t,e)},t.Int16BufferAttribute=An,t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new bn(t,e)},t.Int32BufferAttribute=bn,t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new vn(t,e)},t.Int8BufferAttribute=vn,t.IntType=1013,t.InterleavedBuffer=No,t.InterleavedBufferAttribute=Uo,t.Interpolant=$s,t.InterpolateDiscrete=W,t.InterpolateLinear=K,t.InterpolateSmooth=X,t.InvertStencilOp=5386,t.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},t.KeepStencilOp=ct,t.KeyframeTrack=nc,t.LOD=na,t.LatheBufferGeometry=xs,t.LatheGeometry=xs,t.Layers=Te,t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=Wc,t.LightProbe=hu,t.Line=Sa,t.Line3=_l,t.LineBasicMaterial=Aa,t.LineCurve=Dc,t.LineCurve3=Fc,t.LineDashedMaterial=Xs,t.LineLoop=Ra,t.LinePieces=1,t.LineSegments=xa,t.LineStrip=0,t.LinearEncoding=et,t.LinearFilter=S,t.LinearInterpolant=tc,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=C,t.LinearMipmapNearestFilter=T,t.LinearToneMapping=1,t.Loader=vc,t.LoaderUtils=pu,t.LoadingManager=fc,t.LogLuvEncoding=3003,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=nn,t.MaterialLoader=fu,t.Math=Tt,t.MathUtils=Tt,t.Matrix3=Rt,t.Matrix4=pe,t.MaxEquation=104,t.Mesh=Zn,t.MeshBasicMaterial=dn,t.MeshDepthMaterial=Ao,t.MeshDistanceMaterial=yo,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MeshLambertMaterial=Ws,t.MeshMatcapMaterial=Ks,t.MeshNormalMaterial=qs,t.MeshPhongMaterial=Qs,t.MeshPhysicalMaterial=Gs,t.MeshStandardMaterial=Vs,t.MeshToonMaterial=zs,t.MinEquation=103,t.MirroredRepeatWrapping=b,t.MixOperation=1,t.MultiMaterial=function(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=w,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=_,t.NearestMipmapNearestFilter=E,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=Z,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=oc,t.Object3D=Fe,t.ObjectLoader=Au,t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=Rs,t.OctahedronGeometry=Rs,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=au,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=_d,t.ParametricBufferGeometry=Is,t.ParametricGeometry=Is,t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new $o(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ia(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ba(t,e)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ia(t)},t.Path=zc,t.PerspectiveCamera=sr,t.Plane=Ge,t.PlaneBufferGeometry=Ar,t.PlaneGeometry=Ar,t.PlaneHelper=$l,t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ba(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ia(t)},t.PointLight=ou,t.PointLightHelper=Ll,t.Points=Ba,t.PointsMaterial=Ia,t.PolarGridHelper=Dl,t.PolyhedronBufferGeometry=Ga,t.PolyhedronGeometry=Ga,t.PositionalAudio=Wu,t.PropertyBinding=sl,t.PropertyMixer=Xu,t.QuadraticBezierCurve=Hc,t.QuadraticBezierCurve3=jc,t.Quaternion=Pt,t.QuaternionKeyframeTrack=sc,t.QuaternionLinearInterpolant=ac,t.REVISION=u,t.RGBADepthPacking=3201,t.RGBAFormat=B,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=q,t.RGBA_PVRTC_2BPPV1_Format=Q,t.RGBA_PVRTC_4BPPV1_Format=G,t.RGBA_S3TC_DXT1_Format=D,t.RGBA_S3TC_DXT3_Format=F,t.RGBA_S3TC_DXT5_Format=H,t.RGBDEncoding=st,t.RGBEEncoding=it,t.RGBEFormat=1023,t.RGBFormat=k,t.RGBIntegerFormat=1032,t.RGBM16Encoding=at,t.RGBM7Encoding=ot,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=z,t.RGB_PVRTC_2BPPV1_Format=V,t.RGB_PVRTC_4BPPV1_Format=j,t.RGB_S3TC_DXT1_Format=U,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=js,t.Ray=fe,t.Raycaster=pl,t.RectAreaLight=lu,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=A,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=Os,t.RingGeometry=Os,t.SRGB8_ALPHA8_ASTC_10x10_Format=37851,t.SRGB8_ALPHA8_ASTC_10x5_Format=37848,t.SRGB8_ALPHA8_ASTC_10x6_Format=37849,t.SRGB8_ALPHA8_ASTC_10x8_Format=37850,t.SRGB8_ALPHA8_ASTC_12x10_Format=37852,t.SRGB8_ALPHA8_ASTC_12x12_Format=37853,t.SRGB8_ALPHA8_ASTC_4x4_Format=37840,t.SRGB8_ALPHA8_ASTC_5x4_Format=37841,t.SRGB8_ALPHA8_ASTC_5x5_Format=37842,t.SRGB8_ALPHA8_ASTC_6x5_Format=37843,t.SRGB8_ALPHA8_ASTC_6x6_Format=37844,t.SRGB8_ALPHA8_ASTC_8x5_Format=37845,t.SRGB8_ALPHA8_ASTC_8x6_Format=37846,t.SRGB8_ALPHA8_ASTC_8x8_Format=37847,t.Scene=Bo,t.SceneUtils=Od,t.ShaderChunk=yr,t.ShaderLib=wr,t.ShaderMaterial=or,t.ShadowMaterial=Hs,t.Shape=qc,t.ShapeBufferGeometry=Ms,t.ShapeGeometry=Ms,t.ShapePath=_u,t.ShapeUtils=ws,t.ShortType=1011,t.Skeleton=ha,t.SkeletonHelper=Ol,t.SkinnedMesh=ca,t.SmoothShading=2,t.Sphere=oe,t.SphereBufferGeometry=Ls,t.SphereGeometry=Ls,t.Spherical=gl,t.SphericalHarmonics3=du,t.SplineCurve=Vc,t.SpotLight=tu,t.SpotLightHelper=Cl,t.Sprite=$o,t.SpriteMaterial=Fo,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=ut,t.StaticReadUsage=35045,t.StereoCamera=Bu,t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=cc,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=ks,t.TetrahedronGeometry=ks,t.TextBufferGeometry=Bs,t.TextGeometry=Bs,t.Texture=Mt,t.TextureLoader=_c,t.TorusBufferGeometry=Ns,t.TorusGeometry=Ns,t.TorusKnotBufferGeometry=Ps,t.TorusKnotGeometry=Ps,t.Triangle=tn,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=Us,t.TubeGeometry=Us,t.UVMapping=d,t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new yn(t,e)},t.Uint16BufferAttribute=yn,t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new wn(t,e)},t.Uint32BufferAttribute=wn,t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new mn(t,e)},t.Uint8BufferAttribute=mn,t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new gn(t,e)},t.Uint8ClampedBufferAttribute=gn,t.Uniform=dl,t.UniformsLib=br,t.UniformsUtils=ir,t.UnsignedByteType=x,t.UnsignedInt248Type=L,t.UnsignedIntType=I,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=R,t.VSMShadowMap=3,t.Vector2=Ct,t.Vector3=Ut,t.Vector4=kt,t.VectorKeyframeTrack=uc,t.Vertex=function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Ut(t,e,n)},t.VertexColors=2,t.VideoTexture=Pa,t.WebGL1Renderer=Mo,t.WebGLCubeRenderTarget=dr,t.WebGLMultisampleRenderTarget=Nt,t.WebGLRenderTarget=Bt,t.WebGLRenderTargetCube=function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new dr(t,n)},t.WebGLRenderer=Oo,t.WebGLUtils=_o,t.WireframeGeometry=Ds,t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new xa(new Ds(t.geometry),new Aa({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=$,t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new gc(t)},t.ZeroCurvatureEnding=J,t.ZeroFactor=200,t.ZeroSlopeEnding=Y,t.ZeroStencilOp=0,t.sRGBEncoding=nt,Object.defineProperty(t,"__esModule",{value:!0})}));
/**
 * @license b-here v1.0.0
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var BHere=function(t,e,n,r,i){"use strict";function o(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function s(t){o(a,r,i,s,c,"next",t)}function c(t){o(a,r,i,s,c,"throw",t)}s(void 0)}))}}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function p(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var v='\n\x3c!-- controls --\x3e\n<div class="group--controls" *if="state.live">\n\t<div class="group--actions">\n\t\t<button type="button" class="btn--call" [title]="\'title_disconnect\' | label" (click)="disconnect()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--cam" [title]="\'title_mute_camera\' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--mic" [title]="\'title_mute_mic\' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--screen" [title]="\'title_share_screen\' | label" [class]="{ active: screen }" (click)="toggleScreen()" *if="state.role == \'publisher\' || state.role == \'attendee\' || controlling">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#screen"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--chat" [title]="\'title_chat\' | label" [class]="{ active: state.chatDirty }" (click)="toggleChat()" *if="(\'chat\' | flag)">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#chat"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--navinfo" [title]="\'title_navinfo\' | label" [class]="{ active: state.showNavInfo }" (click)="toggleNavInfo()" *if="showNavInfoToggler">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navinfo"></use></svg>\n\t\t</button>\n\t</div>\n</div>\n',m='\n\x3c!-- media --\x3e\n<div class="group--media" media-player>\n\t<button type="button" class="btn--play" [title]="\'title_play\' | label" (click)="onPlay()" *if="!playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#play"></use></svg>\n\t</button>\n\t<button type="button" class="btn--pause" [title]="\'title_pause\' | label" (click)="onPause()" *if="playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pause"></use></svg>\n\t</button>\n\t<div class="track" (click)="onTrack($event)">\n\t\t<div class="track__progress" [style]="{ transform: \'scale(\' + this.progress + \', 1)\'}"></div>\n\t</div>\n</div>\n',g='\n\x3c!-- ar-vr --\x3e\n<div class="group--ar-vr">\n\t<button type="button" class="btn--ar" [title]="\'title_ar\' | label" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t</button>\n\t<button type="button" class="btn--vr" [title]="\'title_vr\' | label" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t</button>\n</div>\n',A='\n\x3c!-- like --\x3e\n<div class="group--heart" *if="view && (\'like\' | flag)">\n\t<svg class="love" [class]="{ active: view.showLove }" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t<button type="button" class="btn--heart" [class]="{ active: view.showLove }" (click)="addLike($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t\t<span class="badge" [innerHTML]="view.likes" *if="view.likes"></span>\n\t</button>\n</div>\n<div class="group--spacer" *if="!view || !(\'like\' | flag)"></div>\n',y='\n\x3c!-- chat --\x3e\n<div class="group--chat" *if="state.chat" agora-chat (close)="onChatClose()"></div>\n',b='\n\x3c!-- lock --\x3e\n<div class="ui__lock" [class]="{ spying: spying }" *if="locked || controlling"></div>\n',w='\n\x3c!-- navmap --\x3e\n<div class="group--navmap" *if="navmap && state.showNavmap && state.mode != \'live-meeting\'">\n\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (click)="onNavmapItem(item)" *for="let item of navmap.items">\n\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t<div class="title" [innerHTML]="item.title"></div>\n\t</div>\n</div>\n',E="\n\x3c!-- background --\x3e\n<div class=\"background\" [class]=\"{ 'background--image': ('background.image' | env), 'background--video': ('background.video' | env) }\" *if=\"state.status != 'connected'\">\n\t<img [src]=\"'background.image' | env\" *if=\"'background.image' | env\" />\n\t<video [src]=\"'background.video' | env\" *if=\"'background.video' | env\" oncanplay=\"this.muted = true; this.classList.add('ready');\" playsinline autoplay muted loop></video>\n</div>\n",_='\n\x3c!-- logo --\x3e\n<a class="btn--logo" [routerLink]="\':lang.access\' | route" *if="state.status != \'connected\'">\n\t<img [src]="\'logo\' | env" *if="\'logo\' | env" />\n\t<svg viewBox="0 0 270 98" *if="!(\'logo\' | env)"><use xlink:href="#b-here"></use></svg>\n</a>\n',S='\n\x3c!-- credits --\x3e\n<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener" *if="state.status != \'connected\'">\n\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n</a>\n',T='\n\x3c!-- language --\x3e\n<div class="group--language" language (set)="pushChanges()" *if="state.status != \'connected\'"></div>\n',C=function(){function t(){}return t.has=function(t){return new URLSearchParams(window.location.search).has(t)},t.get=function(t){return new URLSearchParams(window.location.search).get(t)},t.set=function(t,e){var n=new URLSearchParams(window.location.search);"string"==typeof t?n.set(t,e):n.set(t,""),this.pushParams(n)},t.delete=function(t){var e=new URLSearchParams(window.location.search);e.has(t)&&(e.delete(t),this.pushParams(e))},t.pushParams=function(t){if(window.history&&window.history.pushState){var e=document.title,n=window.location.href.split("?")[0]+"?"+t.toString();window.history.pushState(t.toString(),e,n)}},t.replace=function(t,e){var n=window.history;if(n&&n.replaceState){var r=window.location,i=document.title;if("/"===r.pathname){var o=r.origin+e+r.search;n.replaceState(n.state,i,o)}else if(-1!==r.href.indexOf(t)){var a=r.href.replace(t,e);n.replaceState(n.state,i,a)}}},t.deserialize=function(t){var e=this.get("params");return this.decode(t,e)},t.serialize=function(t,e){var n=this.deserialize(),r=this.encode(t,e,n);this.set("params",r)},t.decode=function(t,e){var n=null;if(e){var r=window.atob(e);n=JSON.parse(r)}return t&&n&&(n=n[t]),n||null},t.encode=function(t,e,n){n=n||{};"string"==typeof t?n[t]=e:n=t;var r=JSON.stringify(n);return window.btoa(r)},t}(),x=function(){return(x=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},R=function(){return(R=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},I=function(t){return void 0===t&&(t={}),{arrayFormat:t.arrayFormat||"none",booleanFormat:t.booleanFormat||"none",nullFormat:t.nullFormat||"default"}},O=function(t){return encodeURIComponent(t)},M=function(t){return decodeURIComponent(t)},L=function(t,e,n){return null===e?function(t,e){return"hidden"===e.nullFormat?"":"string"===e.nullFormat?t+"=null":t}(t,n):"boolean"==typeof e?function(t,e,n){return"empty-true"===n.booleanFormat&&e?t:t+"="+("unicode"===n.booleanFormat?e?"✓":"✗":e.toString())}(t,e,n):Array.isArray(e)?function(t,e,n){var r=function(t){return"index"===t.arrayFormat?function(t,e){return t+"["+e+"]"}:"brackets"===t.arrayFormat?function(t){return t+"[]"}:function(t){return t}}(n);return e.map((function(e,n){return r(t,n)+"="+O(e)})).join("&")}(t,e,n):t+"="+O(e)},k=function(t){var e=t.indexOf("?");return-1===e?t:t.slice(e+1)},B=function(t){var e=t.indexOf("["),n=-1!==e;return{hasBrackets:n,name:n?t.slice(0,e):t}},N=function(t,e){var n=I(e);return k(t).split("&").reduce((function(t,e){var r=e.split("="),i=r[0],o=r[1],a=B(i),s=a.hasBrackets,c=a.name,u=t[c],l=function(t,e){if(void 0===t)return"empty-true"===e.booleanFormat||null;if("string"===e.booleanFormat){if("true"===t)return!0;if("false"===t)return!1}if("unicode"===e.booleanFormat){if("✓"===M(t))return!0;if("✗"===M(t))return!1}return"string"===e.nullFormat&&"null"===t?null:M(t)}(o,n);return t[c]=void 0===u?s?[l]:l:(Array.isArray(u)?u:[u]).concat(l),t}),{})},P=function(t,e){var n=I(e);return Object.keys(t).filter((function(e){return void 0!==t[e]})).map((function(e){return L(e,t[e],n)})).filter(Boolean).join("&")},U=/[^!$'()*+,;|:]/g,D=function(t){return t.replace(U,(function(t){return encodeURIComponent(t)}))},F={default:D,uri:encodeURI,uriComponent:encodeURIComponent,none:function(t){return t},legacy:encodeURI},H={default:decodeURIComponent,uri:decodeURI,uriComponent:decodeURIComponent,none:function(t){return t},legacy:decodeURIComponent},j=function(t,e,n){var r=F[e]||D;return n?String(t).split("/").map(r).join("/"):r(String(t))},V=function(t){return"("+(t?t.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@$]+")+")"},G=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(V(t[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(";"+t[1]+"="+V(t[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(t){return new RegExp("\\"+t[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(t){return new RegExp(t[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(t){return new RegExp(t[0])}}],Q=function t(e,n){if(void 0===n&&(n=[]),!G.some((function(r){var i=e.match(r.pattern);return!!i&&(n.push({type:r.name,match:i[0],val:i.slice(1,2),otherVal:i.slice(2),regex:r.regex instanceof Function?r.regex(i):r.regex}),i[0].length<e.length&&(n=t(e.substr(i[0].length),n)),!0)})))throw new Error("Could not parse path '"+e+"'");return n},z=function(t){return null!=t},q={urlParamsEncoding:"default"},W=function(){function t(t,e){if(!t)throw new Error("Missing path in Path constructor");this.path=t,this.options=R(R({},q),e),this.tokens=Q(t),this.hasUrlParams=this.tokens.filter((function(t){return/^url-parameter/.test(t.type)})).length>0,this.hasSpatParam=this.tokens.filter((function(t){return/splat$/.test(t.type)})).length>0,this.hasMatrixParams=this.tokens.filter((function(t){return/matrix$/.test(t.type)})).length>0,this.hasQueryParams=this.tokens.filter((function(t){return/^query-parameter/.test(t.type)})).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter((function(t){return void 0!==t.regex})).map((function(t){return t.regex.source})).join("")}return t.createPath=function(e,n){return new t(e,n)},t.prototype.isQueryParam=function(t){return-1!==this.queryParams.indexOf(t)},t.prototype.isSpatParam=function(t){return-1!==this.spatParams.indexOf(t)},t.prototype.test=function(t,e){var n=this,r=R(R({caseSensitive:!1,strictTrailingSlash:!1},this.options),e),i=function(t,e){return e||"\\/"===t?t:t.replace(/\\\/$/,"")+"(?:\\/)?"}(this.source,r.strictTrailingSlash),o=this.urlTest(t,i+(this.hasQueryParams?"(\\?.*$|$)":"$"),r.caseSensitive,r.urlParamsEncoding);if(!o||!this.hasQueryParams)return o;var a=N(t,r.queryParams);return 0===Object.keys(a).filter((function(t){return!n.isQueryParam(t)})).length?(Object.keys(a).forEach((function(t){return o[t]=a[t]})),o):null},t.prototype.partialTest=function(t,e){var n=this,r=R(R({caseSensitive:!1,delimited:!0},this.options),e),i=function(t,e){return e?/(\/)$/.test(t)?t:t+"(\\/|\\?|\\.|;|$)":t}(this.source,r.delimited),o=this.urlTest(t,i,r.caseSensitive,r.urlParamsEncoding);if(!o)return o;if(!this.hasQueryParams)return o;var a=N(t,r.queryParams);return Object.keys(a).filter((function(t){return n.isQueryParam(t)})).forEach((function(t){return function(t,e,n){void 0===n&&(n="");var r=t[e];return t[e]=void 0===r?n:Array.isArray(r)?r.concat(n):[r,n],t}(o,t,a[t])})),o},t.prototype.build=function(t,e){var n=this;void 0===t&&(t={});var r=R(R({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},this.options),e),i=Object.keys(t).filter((function(t){return!n.isQueryParam(t)})).reduce((function(e,i){if(!z(t[i]))return e;var o=t[i],a=n.isSpatParam(i);return"boolean"==typeof o?e[i]=o:Array.isArray(o)?e[i]=o.map((function(t){return j(t,r.urlParamsEncoding,a)})):e[i]=j(o,r.urlParamsEncoding,a),e}),{});if(this.urlParams.some((function(e){return!z(t[e])}))){var o=this.urlParams.filter((function(e){return!z(t[e])}));throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+o.join(", ")+" }")}if(!r.ignoreConstraints&&!this.tokens.filter((function(t){return/^url-parameter/.test(t.type)&&!/-splat$/.test(t.type)})).every((function(t){return new RegExp("^"+V(t.otherVal[0])+"$").test(i[t.val])})))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var a=this.tokens.filter((function(t){return!1===/^query-parameter/.test(t.type)})).map((function(t){return"url-parameter-matrix"===t.type?";"+t.val+"="+i[t.val[0]]:/^url-parameter/.test(t.type)?i[t.val[0]]:t.match})).join("");if(r.ignoreSearch)return a;var s=this.queryParams.filter((function(e){return-1!==Object.keys(t).indexOf(e)})).reduce((function(e,n){return e[n]=t[n],e}),{}),c=P(s,r.queryParams);return c?a+"?"+c:a},t.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map((function(t){return t.val[0]}))},t.prototype.urlTest=function(t,e,n,r){var i=this,o=new RegExp("^"+e,n?"":"i"),a=t.match(o);return a?this.urlParams.length?a.slice(1,this.urlParams.length+1).reduce((function(t,e,n){return t[i.urlParams[n]]=(H[r]||decodeURIComponent)(e),t}),{}):{}:null},t}(),K=function(t){var e="";return t.reduce((function(t,n){var r,i,o,a,s=null!=(i=null===(r=n.parser)||void 0===r?void 0:r.urlParams.reduce((function(t,e){return t[e]="url",t}),{}))?i:{},c=null!=(a=null===(o=n.parser)||void 0===o?void 0:o.queryParams.reduce((function(t,e){return t[e]="query",t}),s))?a:{};return void 0!==n.name&&(t[e=e?e+"."+n.name:n.name]=c),t}),{})},X=function t(e,n,r,i,o){void 0===i&&(i={});for(var a=i.queryParamsMode,s=void 0===a?"default":a,c=i.strictTrailingSlash,u=void 0!==c&&c,l=i.strongMatching,d=void 0===l||l,h=i.caseSensitive,f=void 0!==h&&h,p=1===e.length&&""===e[0].name,v=function(e){var a,c=null,l=void 0,h=n;if("/"===o&&"/"===e.path&&(h="/"+n),e.children.length||(c=e.parser.test(h,{caseSensitive:f,strictTrailingSlash:u,queryParams:i.queryParams,urlParamsEncoding:i.urlParamsEncoding})),c||(c=e.parser.partialTest(h,{delimited:d,caseSensitive:f,queryParams:i.queryParams,urlParamsEncoding:i.urlParamsEncoding})),c){var v=e.parser.build(c,{ignoreSearch:!0,urlParamsEncoding:i.urlParamsEncoding});u||e.children.length||(v=v.replace(/\/$/,"")),l=0===h.toLowerCase().indexOf(v.toLowerCase())?h.slice(v.length):h,u||e.children.length||(l=l.replace(/^\/\?/,"?"));var m=function(t,e,n){var r=I(n);if(""===k(t))return{querystring:"",removedParams:{}};var i=t.split("&").reduce((function(t,n){var r=t[0],i=t[1],o=n.split("=")[0],a=B(o).name;return-1===e.indexOf(a)?[r.concat(n),i]:[r,i.concat(n)]}),[[],[]]),o=i[0],a=i[1];return{querystring:o.join("&"),removedParams:N(a.join("&"),r)}}((a=h.replace(v,""),a.split("?")[1]||""),e.parser.queryParams,i.queryParams).querystring;if(l=function(t){return t.split("?")[0]}(l)+(m?"?"+m:""),u||p||"/"!==l||/\/$/.test(v)||(l=""),r.segments.push(e),Object.keys(c).forEach((function(t){return r.params[t]=c[t]})),!p&&!l.length)return{value:r};if(!p&&"strict"!==s&&0===l.indexOf("?")){var g=N(l.slice(1),i.queryParams);return Object.keys(g).forEach((function(t){return r.params[t]=g[t]})),{value:r}}var A=e.getNonAbsoluteChildren();return A.length?{value:t(A,l,r,i,v)}:{value:null}}},m=0,g=e;m<g.length;m++){var A=v(g[m]);if("object"==typeof A)return A.value}return null};var J=function(t){return function(e,n){var r,i,o,a,s,c,u=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),l=n.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===u)return 1;if("/"===l)return-1;if(null===(r=e.parser)||void 0===r?void 0:r.hasSpatParam)return 1;if(null===(i=n.parser)||void 0===i?void 0:i.hasSpatParam)return-1;var d=(u.match(/\//g)||[]).length,h=(l.match(/\//g)||[]).length;if(d<h)return 1;if(d>h)return-1;var f=null!=(a=null===(o=e.parser)||void 0===o?void 0:o.urlParams.length)?a:0,p=null!=(c=null===(s=n.parser)||void 0===s?void 0:s.urlParams.length)?c:0;if(f<p)return-1;if(f>p)return 1;var v=(u.split("/").slice(-1)[0]||"").length,m=(l.split("/").slice(-1)[0]||"").length;return v<m?1:v>m?-1:t.indexOf(e)-t.indexOf(n)}},Y=function(){function t(t,e,n,r){return void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=[]),void 0===r&&(r={}),this.name=t,this.absolute=/^~/.test(e),this.path=this.absolute?e.slice(1):e,this.parser=this.path?new W(this.path):null,this.children=[],this.parent=r.parent,this.checkParents(),this.add(n,r.onAdd,!r.finalSort&&!1!==r.sort),r.finalSort&&this.sortDescendants(),this}return t.prototype.getParentSegments=function(t){return void 0===t&&(t=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(t.concat(this.parent)):t.reverse()},t.prototype.setParent=function(t){this.parent=t,this.checkParents()},t.prototype.setPath=function(t){void 0===t&&(t=""),this.path=t,this.parser=t?new W(t):null},t.prototype.add=function(e,n,r){var i=this;if(void 0===r&&(r=!0),null==e)return this;if(e instanceof Array)return e.forEach((function(t){return i.add(t,n,r)})),this;if(!(e instanceof t||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof t)e.setParent(this),this.addRouteNode(e,r);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var o=new t(e.name,e.path,e.children,{finalSort:!1,onAdd:n,parent:this,sort:r}),a=o.getParentSegments([o]).map((function(t){return t.name})).join(".");n&&n(x(x({},e),{name:a})),this.addRouteNode(o,r)}return this},t.prototype.addNode=function(e,n){return this.add(new t(e,n)),this},t.prototype.getPath=function(t){var e,n=this.getSegmentsByName(t);return n?(e=n)?e.map((function(t){return t.path})).join(""):null:null},t.prototype.getNonAbsoluteChildren=function(){return this.children.filter((function(t){return!t.absolute}))},t.prototype.sortChildren=function(){var t,e;this.children.length&&(t=this.children,e=t.slice(0),t.sort(J(e)))},t.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach((function(t){return t.sortDescendants()}))},t.prototype.buildPath=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={});var r=this.getSegmentsByName(t);if(!r)throw new Error("[route-node][buildPath] '{routeName}' is not defined");return function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={});for(var r=n.queryParamsMode,i=void 0===r?"default":r,o=n.trailingSlashMode,a=void 0===o?"default":o,s=[],c=[],u=0,l=t;u<l.length;u++){var d=l[u].parser;d&&(s.push.apply(s,d.queryParams),c.push.apply(c,d.urlParams),c.push.apply(c,d.spatParams))}if("loose"===i){var h=Object.keys(e).reduce((function(t,e){return-1===s.indexOf(e)&&-1===c.indexOf(e)?t.concat(e):t}),[]);s.push.apply(s,h)}var f=s.reduce((function(t,n){return-1!==Object.keys(e).indexOf(n)&&(t[n]=e[n]),t}),{}),p=P(f,n.queryParams),v=t.reduce((function(t,r){var i,o,a=null!=(o=null===(i=r.parser)||void 0===i?void 0:i.build(e,{ignoreSearch:!0,queryParams:n.queryParams,urlParamsEncoding:n.urlParamsEncoding}))?o:"";return r.absolute?a:t+a}),"").replace(/\/\/{1,}/g,"/"),m=v;return"always"===a?m=/\/$/.test(v)?v:v+"/":"never"===a&&"/"!==v&&(m=/\/$/.test(v)?v.slice(0,-1):v),m+(p?"?"+p:"")}(r,e,n)},t.prototype.buildState=function(t,e){void 0===e&&(e={});var n=this.getSegmentsByName(t);return n&&n.length?{name:t,params:e,meta:K(n)}:null},t.prototype.matchPath=function(t,e){void 0===e&&(e={}),""!==t||e.strictTrailingSlash||(t="/");var n=this.getSegmentsMatchingPath(t,e);if(!n)return null;var r=n.segments;if(r[0].absolute){var i=r[0].getParentSegments();r.reverse(),r.push.apply(r,i),r.reverse()}var o=r[r.length-1].findSlashChild();return o&&r.push(o),function(t){return t&&t.segments&&t.segments.length?{name:t.segments.map((function(t){return t.name})).filter((function(t){return t})).join("."),params:t.params,meta:K(t.segments)}:null}(n)},t.prototype.addRouteNode=function(t,e){void 0===e&&(e=!0);var n=t.name.split(".");if(1===n.length){if(-1!==this.children.map((function(t){return t.name})).indexOf(t.name))throw new Error('Alias "'+t.name+'" is already defined in route node');if(-1!==this.children.map((function(t){return t.path})).indexOf(t.path))throw new Error('Path "'+t.path+'" is already defined in route node');this.children.push(t),e&&this.sortChildren()}else{var r=this.getSegmentsByName(n.slice(0,-1).join("."));if(!r)throw new Error("Could not add route named '"+t.name+"', parent is missing.");t.name=n[n.length-1],r[r.length-1].add(t)}return this},t.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},t.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var t=this.parent.parser;return t.hasUrlParams||t.hasSpatParam||t.hasMatrixParams||t.hasQueryParams||this.parent.hasParentsParams()}return!1},t.prototype.findAbsoluteChildren=function(){return this.children.reduce((function(t,e){return t.concat(e.absolute?e:[]).concat(e.findAbsoluteChildren())}),[])},t.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter((function(t){return t.parser&&/^\/(\?|$)/.test(t.parser.path)}))[0]},t.prototype.getSegmentsByName=function(t){var e=[],n=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(t.split(".")).every((function(t){var r=function(t,e){var n=e.filter((function(e){return e.name===t}));return n.length?n[0]:void 0}(t,n);return!!r&&(n=r.children,e.push(r),!0)}))?e:null},t.prototype.getSegmentsMatchingPath=function(t,e){var n=(this.parser?[this]:this.children).reduce((function(t,e){return t.concat(e,e.findAbsoluteChildren())}),[]),r=X(n,t,{segments:[],params:{}},e);return r&&1===r.segments.length&&""===r.segments[0].name?null:r},t}();var $=function(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),Z=function(t){return t.split(".").reduce((function(t,e){return t.concat(t.length?t[t.length-1]+"."+e:e)}),[])},tt=function(t){return t&&t.meta&&t.meta.params},et=function(t,e){return tt(e)&&null!=e.meta.params[t]?Object.keys(e.meta.params[t]).reduce((function(t,n){return t[n]=e.params[n],t}),{}):{}};var nt=function(){return(nt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},rt={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1,urlParamsEncoding:"default"};var it="NOT_STARTED",ot="NO_START_PATH_OR_STATE",at="ALREADY_STARTED",st="ROUTE_NOT_FOUND",ct="SAME_STATES",ut="CANNOT_DEACTIVATE",lt="CANNOT_ACTIVATE",dt="TRANSITION_ERR",ht="CANCELLED",ft="@@router5/UNKNOWN_ROUTE",pt="$start",vt="$stop",mt="$$start",gt="$$cancel",At="$$success",yt="$$error";function bt(t){var e=0,n=null;return t.getState=function(){return n},t.setState=function(t){n=t},t.makeState=function(n,r,i,o,a){return{name:n,params:nt(nt({},t.config.defaultParams[n]),r),path:i,meta:o?nt(nt({},o),{id:void 0===a?++e:a}):void 0}},t.makeNotFoundState=function(e,n){return t.makeState(ft,{path:e},e,{options:n})},t.areStatesEqual=function(e,n,r){if(void 0===r&&(r=!0),e.name!==n.name)return!1;var i=function(e){return t.rootNode.getSegmentsByName(e).map((function(t){return t.parser.urlParams})).reduce((function(t,e){return t.concat(e)}),[])},o=r?i(e.name):Object.keys(e.params),a=r?i(n.name):Object.keys(n.params);return o.length===a.length&&o.every((function(t){return e.params[t]===n.params[t]}))},t.areStatesDescendants=function(t,e){return!!new RegExp("^"+t.name+"\\.(.*)$").test(e.name)&&Object.keys(t.params).every((function(n){return t.params[n]===e.params[n]}))},t.forwardState=function(e,n){var r=t.config.forwardMap[e]||e;return{name:r,params:nt(nt(nt({},t.config.defaultParams[e]),t.config.defaultParams[r]),n)}},t.buildState=function(e,n){var r=t.forwardState(e,n),i=r.name,o=r.params;return t.rootNode.buildState(i,o)},t}var wt={onStart:pt,onStop:vt,onTransitionSuccess:At,onTransitionStart:mt,onTransitionError:yt,onTransitionCancel:gt};function Et(t){var e=[];function n(e){var n=t.executeFactory(e),r=Object.keys(wt).map((function(e){if(n[e])return t.addEventListener(wt[e],n[e])})).filter(Boolean);return function(){r.forEach((function(t){return t()})),n.teardown&&n.teardown()}}return t.getPlugins=function(){return e},t.usePlugin=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=t.map((function(t){return e.push(t),n(t)}));return function(){e=e.filter((function(e){return-1===t.indexOf(e)})),i.forEach((function(t){return t()}))}},t}function _t(t){var e=[],n=[];return t.useMiddleware=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=r.map((function(r){var i=t.executeFactory(r);return e.push(r),n.push(i),function(){e=e.filter((function(t){return t!==r})),n=n.filter((function(t){return t!==i}))}}));return function(){return o.forEach((function(t){return t()}))}},t.clearMiddleware=function(){return e=[],n=[],t},t.getMiddlewareFactories=function(){return e},t.getMiddlewareFunctions=function(){return n},t}function St(t){var e={};function n(e){var n="object"==typeof e,r=n?e.next.bind(e):e,i=t.addEventListener(At,(function(t,e){r({route:t,previousRoute:e})}));return n?{unsubscribe:i}:i}function r(){var t;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");return n(t)}})[$]=function(){return this},t}return t.invokeEventListeners=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(e[t]||[]).forEach((function(t){return t.apply(void 0,n)}))},t.removeEventListener=function(t,n){e[t]=e[t].filter((function(t){return t!==n}))},t.addEventListener=function(n,r){return e[n]=(e[n]||[]).concat(r),function(){return t.removeEventListener(n,r)}},t.subscribe=n,t[$]=r,t["@@observable"]=r,t}function Tt(t,e,n){var r=e.isCancelled,i=e.toState,o=e.fromState,a=e.errorKey,s=void 0===a?void 0:a,c=Array.isArray(t)?t:Object.keys(t),u=function(t){return"object"==typeof t&&void 0!==t.name&&void 0!==t.params&&void 0!==t.path},l=function(t,e,n,i){var a=function(t,e){t?i(t):e&&e!==n&&u(e)?(function(t,e){return e.name!==t.name||e.params!==t.params||e.path!==t.path}(e,n)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),i(null,function(t,e){return nt(nt(nt({},e),t),{meta:nt(nt({},e.meta),t.meta)})}(e,n))):i(null,n)},s=t.call(null,n,o,a);r()?a(null):"boolean"==typeof s?a(s?null:e):u(s)?a(null,s):s&&"function"==typeof s.then&&s.then((function(t){t instanceof Error?a({error:t},null):a(null,t)}),(function(t){t instanceof Error?(console.error(t.stack||t),a(nt(nt({},e),{promiseError:t}),null)):a("object"==typeof t?nt(nt({},e),t):e,null)}))};!function e(i,o){var a;if(r())n();else if(i)n(i);else if(c.length){var u="string"==typeof c[0],d=s&&u?((a={})[s]=c[0],a):{},h=u?t[c[0]]:c[0];c=c.slice(1),l(h,d,o,e)}else n(null,o)}(null,i)}function Ct(t,e,n,r,i){var o=!1,a=!1,s=t.getOptions(),c=t.getLifecycleFunctions(),u=c[0],l=c[1],d=t.getMiddlewareFunctions(),h=function(){return o},f=function(t,e){return nt(nt({},t),e instanceof Object?e:{error:e})},p=e.name===ft,v={isCancelled:h,toState:e,fromState:n},m=function(t,e){var n,r=t.meta&&t.meta&&t.meta.options||{},i=e?Z(e.name):[],o=Z(t.name),a=Math.min(i.length,o.length);n=!e||r.reload?0:tt(e)||tt(t)?function(){var n,r=function(){var r=i[n],a=o[n];if(r!==a)return{value:n};var s=et(r,t),c=et(a,e);return Object.keys(s).length!==Object.keys(c).length?{value:n}:0===Object.keys(s).length?"continue":Object.keys(s).some((function(t){return c[t]!==s[t]}))?{value:n}:void 0};for(n=0;n<a;n+=1){var s=r();if("object"==typeof s)return s.value}return n}():0;var s=i.slice(n).reverse(),c=o.slice(n);return{intersection:e&&n>0?i[n-1]:"",toDeactivate:s,toActivate:c}}(e,n),g=m.toDeactivate,A=m.toActivate,y=!n||r.forceDeactivate?[]:function(t,e,n){Tt(g.filter((function(t){return u[t]})).reduce((function(t,e){var n;return nt(nt({},t),((n={})[e]=u[e],n))}),{}),nt(nt({},v),{errorKey:"segment"}),(function(t){return n(t?f({code:ut},t):null)}))},b=p?[]:function(t,e,n){Tt(A.filter((function(t){return l[t]})).reduce((function(t,e){var n;return nt(nt({},t),((n={})[e]=l[e],n))}),{}),nt(nt({},v),{errorKey:"segment"}),(function(t){return n(t?f({code:lt},t):null)}))},w=d.length?function(t,e,n){return Tt(d,nt({},v),(function(e,r){return n(e?f({code:dt},e):null,r||t)}))}:[];return Tt([].concat(y).concat(b).concat(w),v,(function(n,r){if(a=!0,!h()){if(!n&&s.autoCleanUp){var o=Z(e.name);Object.keys(u).forEach((function(e){-1===o.indexOf(e)&&t.clearCanDeactivate(e)}))}i(n,r||e)}})),function(){o||a||(o=!0,i({code:ht},null))}}var xt=function(){};function Rt(t){var e;function n(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=e[0],o=e[e.length-1],a="function"==typeof o?o:xt,s="object"==typeof e[1]?e[1]:{},c="object"==typeof e[2]?e[2]:{};if(t.isStarted()){var u=t.buildState(i,s);if(!u)return a(l={code:st}),void t.invokeEventListeners(yt,null,t.getState(),l);var l,d=t.makeState(u.name,u.params,t.buildPath(u.name,u.params),{params:u.meta,options:c}),h=!!t.getState()&&t.areStatesEqual(t.getState(),d,!1);if(h&&!c.reload&&!c.force)return a(l={code:ct}),void t.invokeEventListeners(yt,d,t.getState(),l);var f=t.getState();return c.skipTransition?(a(null,d),xt):t.transitionToState(d,f,c,(function(e,r){if(e)if(e.redirect){var i=e.redirect;n(i.name,i.params,nt(nt({},c),{force:!0,redirected:!0}),a)}else a(e);else t.invokeEventListeners(At,r,f,c),a(null,r)}))}a({code:it})}return t.navigate=n,t.navigate=n,t.navigateToDefault=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i="object"==typeof e[0]?e[0]:{},o=2===e.length?e[1]:"function"==typeof e[0]?e[0]:xt,a=t.getOptions();return a.defaultRoute?n(a.defaultRoute,a.defaultParams,i,o):function(){}},t.cancel=function(){return e&&(e("navigate"),e=null),t},t.transitionToState=function(n,r,i,o){return void 0===i&&(i={}),void 0===o&&(o=xt),t.cancel(),t.invokeEventListeners(mt,n,r),e=Ct(t,n,r,i,(function(i,a){e=null,a=a||n,i?(i.code===ht?t.invokeEventListeners(gt,n,r):t.invokeEventListeners(yt,n,r,i),o(i)):(t.setState(a),o(null,a))}))},t}var It=function(){};function Ot(t){var e=!1;return t.isStarted=function(){return e},t.start=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i,o,a=t.getOptions(),s=n[n.length-1],c="function"==typeof s?s:It,u="function"!=typeof n[0]?n[0]:void 0;if(e)return c({code:at}),t;e=!0,t.invokeEventListeners(pt);var l=function(e,n,r){void 0===r&&(r=!0),e||t.invokeEventListeners(At,n,null,{replace:!0}),e&&r&&t.invokeEventListeners(yt,n,null,e),c(e,n)};if(void 0===u&&!a.defaultRoute)return l({code:ot});if("string"==typeof u?i=u:"object"==typeof u&&(o=u),o)t.setState(o),l(null,o);else{o=void 0===i?null:t.matchPath(i);var d=function(){return t.navigateToDefault({replace:!0},c)},h=function(e){return t.navigate(e.name,e.params,{replace:!0,reload:!0,redirected:!0},c)},f=function(e){t.transitionToState(e,t.getState(),{},(function(t,e){t?t.redirect?h(t.redirect):a.defaultRoute?d():l(t,null,!1):l(null,e)}))};o?f(o):a.defaultRoute?d():a.allowNotFound?f(t.makeNotFoundState(i,{replace:!0})):l({code:st,path:i},null)}return t},t.stop=function(){return e&&(t.setState(null),e=!1,t.invokeEventListeners(vt)),t},t}var Mt=function(t){return"function"==typeof t?t:function(){return function(){return t}}};function Lt(t){var e={},n={},r={},i={};return t.getLifecycleFactories=function(){return[e,n]},t.getLifecycleFunctions=function(){return[r,i]},t.canDeactivate=function(n,i){var o=Mt(i);return e[n]=o,r[n]=t.executeFactory(o),t},t.clearCanDeactivate=function(n){return e[n]=void 0,r[n]=void 0,t},t.canActivate=function(e,r){var o=Mt(r);return n[e]=o,i[e]=t.executeFactory(o),t},t}var kt=function(t,e,n){void 0===t&&(t=[]),void 0===e&&(e={}),void 0===n&&(n={});return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce((function(t,e){return e(t)}),e)}}(function(t){return function(e){var n=nt(nt({},rt),t);return e.getOptions=function(){return n},e.setOption=function(t,r){return n[t]=r,e},e}}(e),function(t){return function(e){var n=t;return e.setDependency=function(t,r){return n[t]=r,e},e.setDependencies=function(t){return Object.keys(t).forEach((function(n){return e.setDependency(n,t[n])})),e},e.getDependencies=function(){return n},e.getInjectables=function(){return[e,e.getDependencies()]},e.executeFactory=function(t){return t.apply(void 0,e.getInjectables())},e}}(n),St,bt,Ot,Lt,Rt,Et,_t,function(t){return function(e){e.forward=function(t,n){return e.config.forwardMap[t]=n,e};var n=t instanceof Y?t:new Y("","",t,{onAdd:r});function r(t){t.canActivate&&e.canActivate(t.name,t.canActivate),t.forwardTo&&e.forward(t.name,t.forwardTo),t.decodeParams&&(e.config.decoders[t.name]=t.decodeParams),t.encodeParams&&(e.config.encoders[t.name]=t.encodeParams),t.defaultParams&&(e.config.defaultParams[t.name]=t.defaultParams)}return e.rootNode=n,e.add=function(t,i){return n.add(t,r,!i),i&&n.sortDescendants(),e},e.addNode=function(t,r,i){return n.addNode(t,r),i&&e.canActivate(t,i),e},e.isActive=function(t,n,r,i){void 0===n&&(n={}),void 0===r&&(r=!1),void 0===i&&(i=!0);var o=e.getState();return!!o&&(r||o.name===t?e.areStatesEqual(e.makeState(t,n),o,i):e.areStatesDescendants(e.makeState(t,n),o))},e.buildPath=function(t,n){if(t===ft)return n.path;var r=nt(nt({},e.config.defaultParams[t]),n),i=e.getOptions(),o=i.trailingSlashMode,a=i.queryParamsMode,s=i.queryParams,c=e.config.encoders[t]?e.config.encoders[t](r):r;return e.rootNode.buildPath(t,c,{trailingSlashMode:o,queryParamsMode:a,queryParams:s,urlParamsEncoding:e.getOptions().urlParamsEncoding})},e.matchPath=function(t,n){var r=e.getOptions(),i=e.rootNode.matchPath(t,r);if(i){var o=i.name,a=i.params,s=i.meta,c=e.config.decoders[o]?e.config.decoders[o](a):a,u=e.forwardState(o,c),l=u.name,d=u.params,h=!1===r.rewritePathOnMatch?t:e.buildPath(l,d);return e.makeState(l,d,h,{params:s,source:n})}return null},e.setRootPath=function(t){e.rootNode.setPath(t)},e}}(t))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})},Bt=function(){return(Bt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Nt(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var Pt=function(t){return function(){return t}},Ut=function(){},Dt="undefined"!=typeof window&&window.history,Ft=function(t){try{return encodeURI(decodeURI(t))}catch(e){return t}},Ht=Dt?{getBase:function(){return window.location.pathname},pushState:function(t,e,n){return window.history.pushState(t,e,n)},replaceState:function(t,e,n){return window.history.replaceState(t,e,n)},addPopstateListener:function(t,e){var n=e.useHash&&!(-1===window.navigator.userAgent.indexOf("Trident"));return window.addEventListener("popstate",t),n&&window.addEventListener("hashchange",t),function(){window.removeEventListener("popstate",t),n&&window.removeEventListener("hashchange",t)}},getLocation:function(t){var e=t.useHash?window.location.hash.replace(new RegExp("^#"+t.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+t.base),"");return(Ft(e)||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:Pt(""),pushState:Ut,replaceState:Ut,addPopstateListener:Ut,getLocation:Pt(""),getState:Pt(null),getHash:Pt("")},jt={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:"",mergeState:!1,preserveHash:!0},Vt="popstate";function Gt(t,e){void 0===e&&(e=Ht);var n,r=Bt(Bt({},jt),t),i={forceDeactivate:r.forceDeactivate,source:Vt};return function(t){var o=t.getOptions(),a=t.start;t.buildUrl=function(e,n){return(r.base||"")+(r.useHash?"#"+r.hashPrefix:"")+t.buildPath(e,n)};function s(t,n,i){var o=t?{meta:t.meta,name:t.name,params:t.params,path:t.path}:t,a=!0===r.mergeState?Bt(Bt({},e.getState()),o):o;i?e.replaceState(a,"",n):e.pushState(a,"",n)}function c(n){var a=t.getState(),c=!n.state||!n.state.name,u=c?t.matchPath(e.getLocation(r),Vt):t.makeState(n.state.name,n.state.params,n.state.path,Bt(Bt({},n.state.meta),{source:Vt}),n.state.meta.id),l=o.defaultRoute,d=o.defaultParams;u?a&&t.areStatesEqual(u,a,!1)||t.transitionToState(u,a,i,(function(e,n){if(e)if(e.redirect){var r=e.redirect,o=r.name,h=r.params;t.navigate(o,h,Bt(Bt({},i),{replace:!0,force:!0,redirected:!0}))}else if(e.code===ut){var f=t.buildUrl(a.name,a.params);c||s(u,f,!0)}else l&&t.navigate(l,d,Bt(Bt({},i),{reload:!0,replace:!0}));else t.invokeEventListeners(At,n,a,{replace:!0})})):l&&t.navigateToDefault(Bt(Bt({},i),{reload:!0,replace:!0}))}function u(){n&&(n(),n=void 0)}return t.matchUrl=function(e){return t.matchPath(function(t){var e=t.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(e?e[1]:t).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+t);var i=n[1],o=n[2]||"",a=n[3]||"";return(r.useHash?o.replace(new RegExp("^#"+r.hashPrefix),""):r.base?i.replace(new RegExp("^"+r.base),""):i)+a}(e))},t.start=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return 0===n.length||"function"==typeof n[0]?a.apply(void 0,Nt([e.getLocation(r)],n)):a.apply(void 0,n),t},t.replaceHistoryState=function(n,r,i){void 0===r&&(r={}),void 0===i&&(i="");var o=t.buildState(n,r),a=t.makeState(o.name,o.params,t.buildPath(o.name,o.params),{params:o.meta}),s=t.buildUrl(n,r);t.lastKnownState=a,e.replaceState(a,i,s)},{onStart:function(){r.useHash&&!r.base&&(r.base=e.getBase()),n=e.addPopstateListener(c,r)},onStop:u,teardown:u,onTransitionSuccess:function(n,i,o){var a=e.getState(),c=a&&a.meta&&a.name&&a.params,u=i&&t.areStatesEqual(i,n,!1),l=o.replace||!c||u,d=t.buildUrl(n.name,n.params);null===i&&!1===r.useHash&&!0===r.preserveHash&&(d+=e.getHash()),s(n,d,l)},onPopState:c}}}var Qt=function(){function t(){}return t.useBrowser=function(t){if(Array.isArray(t)&&t.length){this.routes=t;var e=kt(t,{allowNotFound:!1,autoCleanUp:!0,defaultRoute:"index",defaultParams:{},queryParams:{arrayFormat:"default",nullFormat:"default",booleanFormat:"default"},queryParamsMode:"default",trailingSlashMode:"default",strictTrailingSlash:!1,caseSensitive:!1,urlParamsEncoding:"default"});this.router_=e,e.usePlugin(Gt({useHash:!1})),e.start(),this.event$=n.from(e).pipe(r.startWith({route:e.getState(),previousRoute:null}),r.tap((function(t){console.log("RouterService.event$",t)})))}else this.event$=n.EMPTY},t.useBrowser$=function(t){return this.useBrowser(t),this.event$},t.setRouterLink=function(t,e,n){void 0===t&&(t="it.access"),void 0===e&&(e=null),void 0===n&&(n={reload:!0});var r=this.router_;if(r)try{r.navigate(t,e,n)}catch(t){console.log("RouterService.setRouterLink.error",t)}console.log("RouterService.setRouterLink",r,t,e,n)},t.replaceHistoryState=function(t,e){var n=this.router_;if(n)try{n.replaceHistoryState(t,e)}catch(t){console.log("RouterService.replaceHistoryState.error",t)}},t.setCurrentParams=function(t){var e=this.router_;if(e)try{var n=this.route;n&&e.replaceHistoryState(n.name,t)}catch(t){console.log("RouterService.setCurrentParams.error",t)}},t.buildPath=function(t,e){void 0===e&&(e=null);var n=null,r=this.router_;if(r)try{n=r.buildPath(t,e)}catch(t){console.log("RouterService.buildPath.error",t)}return n},t.buildUrl=function(t,e){void 0===e&&(e=null);var n=null,r=this.router_;if(r)try{n=r.buildUrl(t,e)}catch(t){console.log("RouterService.buildUrl.error",t)}return n},t.isActive=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=!1,o=this.router_;if(o)try{i=o.isActive(t,e,n,r)}catch(t){console.log("RouterService.isActive.error",t)}return i},c(t,null,[{key:"router",get:function(){return this.router_}},{key:"route",get:function(){var t=null,e=this.router_;return e&&(t=e.getState(),console.log("RouterService.get.route",t)),t}}]),t}();u(Qt,"routes",[]),u(Qt,"router_",null);var zt=function(){function t(){}return t.patchState=function(t){t=Object.assign({},this.state,t),this.state=t},c(t,null,[{key:"state",set:function(t){this.state$.next(t)},get:function(){return this.state$.getValue()}}]),t}();u(zt,"state$",new n.BehaviorSubject({}));var qt={Publisher:"publisher",Attendee:"attendee",Streamer:"streamer",Viewer:"viewer",SmartDevice:"smart-device",SelfService:"self-service",Embed:"embed"},Wt=function(t){t&&Object.assign(this,t)},Kt=/^\d{9}-\d{4}-\d{13}(-\d+)?$/,Xt=function(){function t(e){if(this.userId=zt.state.user?zt.state.user.id:0,this.role=zt.state.role||qt.Viewer,this.timestamp=(new Date).valueOf().toString(),this.pathId=null,"string"==typeof e){if(!e.match(Kt))return console.warn("MeetingId","invalid meetingId",e),null;e=t.decompose(e)}"object"==typeof e&&(e.id&&(this.id=e.id),e.userId&&(this.userId=e.userId),e.role&&(this.role=e.role),e.roleIndex&&(this.roleIndex=e.roleIndex),e.timestamp&&(this.timestamp=e.timestamp),e.pathId&&(this.pathId=e.pathId))}c(t,[{key:"roleIndex",get:function(){return t.getRoleIndex(this.role)},set:function(e){if(t.getRoleIndex(this.role)!==e){var n=Object.keys(qt)[e];this.role=qt[n]}}}]);var e=t.prototype;return e.toString=function(){return t.compose(this.userId,this.roleIndex,this.timestamp,this.pathId)},e.toRoles=function(){var e=this.userId,n=this.timestamp,r=this.pathId;return{id:t.compose(e,t.getRoleIndex(qt.Publisher),n,r),idAttendee:t.compose(e,t.getRoleIndex(qt.Attendee),n,r),idStreamer:t.compose(e,t.getRoleIndex(qt.Streamer),n,r),idViewer:t.compose(e,t.getRoleIndex(qt.Viewer),n,r),idSmartDevice:t.compose(e,t.getRoleIndex(qt.SmartDevice),n,r),idSelfService:t.compose(e,t.getRoleIndex(qt.SelfService),n,r)}},t.compose=function(e,n,r,i){return t.padded(e,9)+"-"+t.padded(n,4)+"-"+r+(i?"-"+i:"")},t.decompose=function(t){var e=t.split("-");return{userId:parseInt(e[0]),roleIndex:parseInt(e[1]),timestamp:parseInt(e[2]),pathId:e[3]?parseInt(e[3]):null}},t.generateMeetingId=function(){return(new t).toRoles()},t.getRoleIndex=function(t){return Object.keys(qt).reduce((function(e,n,r){return qt[n]===t?r:e}),-1)},t.padded=function(t,e){var n="000000000"+t;return n.substr(n.length-e)},t}(),Jt=function(){function t(e){if(this.link=C.get("link")||null,this.name=C.get("name")||null,this.role=C.get("role")||null,this.viewId=C.has("viewId")?parseInt(C.get("viewId")):null,this.pathId=C.has("pathId")?parseInt(C.get("pathId")):null,this.embedViewId=C.has("embedViewId")?parseInt(C.get("embedViewId")):null,this.support=!!C.has("support")&&"true"===C.get("support"),"string"==typeof e&&(e=t.decompose(e)),"object"==typeof e){if(e.link&&(this.link=e.link),e.user){var n=t.getName(e.user);n&&(this.name=n)}e.name&&(this.name=e.name),e.role&&(this.role=e.role),e.viewId&&(this.viewId=e.viewId),e.pathId&&(this.pathId=e.pathId),e.embedViewId&&(this.embedViewId=e.embedViewId),e.support&&(this.support=e.support)}}c(t,[{key:"meetingId",get:function(){return this.link?new Xt(this.link):null}}]);var e=t.prototype;return e.toParams=function(t){void 0===t&&(t=!1);var e={};return this.link&&(e.link=this.link),this.name&&(e.name=this.name),this.role&&!t&&(e.role=this.role),this.viewId&&(e.viewId=this.viewId),this.pathId&&(e.pathId=this.pathId),this.support&&(e.support=this.support),e},e.toString=function(e){return void 0===e&&(e=!1),t.compose(this.link,this.name,e?null:this.role,this.viewId,this.pathId,this.support)},e.toUrl=function(){var e=this.toParams();return t.getCurrentUrl(e)},e.toAccessCodeUrl=function(){var e=this.toParams();return t.getAccessCodeUrl(e)},e.toGuidedTourUrl=function(){var e=this.toParams();return t.getGuidedTourUrl(e)},e.copyToClipBoard=function(e){void 0===e&&(e=!1);var n=document.createElement("input");n.style.position="absolute",n.style.top="1000vh",document.querySelector("body").appendChild(n);var r=this.toParams(!0);n.value=e?t.getAccessCodeUrl(r):t.getGuidedTourUrl(r),n.focus(),n.select(),n.setSelectionRange(0,99999),document.execCommand("copy"),n.parentNode.removeChild(n),alert("link copiato!\n "+n.value)},e.replaceUrl=function(){Qt.setCurrentParams(this.toParams())},t.replaceWithUser=function(e){var n=new t({user:e});return n.replaceUrl(),n},t.replaceWithName=function(e){var n=new t({name:e});return n.replaceUrl(),n},t.replaceWithLink=function(e){var n=new t({link:e});return n.replaceUrl(),n},t.getCurrentUrl=function(t){void 0===t&&(t=null);var e=Qt.route;if(e){var n=e.name;return console.log("MeetingUrl.getCurrentUrl",n),Qt.buildUrl(n,t)}},t.getAccessCodeUrl=function(t){void 0===t&&(t=null);var e=Qt.route;if(e){var n=e.params.lang+".accessCode";return console.log("MeetingUrl.getAccessCodeUrl",n),Qt.buildUrl(n,t)}},t.getGuidedTourUrl=function(t){void 0===t&&(t=null);var e=Qt.route;if(e){var n=e.params.lang+".guidedTour";return console.log("MeetingUrl.getGuidedTourUrl",n),Qt.buildUrl(n,t)}},t.getName=function(t){return t&&t.firstName&&t.lastName?t.firstName+" "+t.lastName:null},t.compose=function(t,e,n,r,i,o){var a={link:t,name:e,role:n,viewId:r,pathId:i,support:o};return"?"+(a=Object.keys(a).map((function(t){return{key:t,value:a[t]}})).filter((function(t){return null!=t.value&&!1!==t.value})).map((function(t){return t.key+"="+t.value}))).join("&")},t.decompose=function(t){var e={};return t.split("?")[1].split("&").forEach((function(t){var n=t.split("=")[0],r=t.split("=")[1];e[n]=r})),e},t}(),Yt=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.getFactory=function(t){var e=null,n=Qt.routes.find((function(e){return e.name===t.name}));return n&&(e=n.factory),e},o.onInit=function(){var t=this;this.route$().pipe(r.switchMap((function(e){return t.factory$(e)})),r.takeUntil(this.unsubscribe$)).subscribe((function(t){console.log("RouterOutletStructure.route$",t)}))},o.route$=function(){var t=this;return Qt.event$.pipe(r.map((function(e){var n=e.route;return t.route=n,console.log("RouterOutletStructure.route",n),n})))},o.factory$=function(e){var i=this,o=this.getFactory(e),a=t.getContext(this),s=a.module,c=a.node;return this.factory_=o,n.of(o).pipe(r.tap((function(){i.element&&(i.element.parentNode.removeChild(i.element),s.remove(i.element,i),i.element=void 0,i.instance=void 0)})),r.map((function(){if(o&&o.meta.template){var t=document.createElement("div");t.innerHTML=o.meta.template,1===t.children.length&&(t=t.firstElementChild),c.appendChild(t);var n=s.makeInstance(t,o,o.meta.selector,i,void 0,{route:e});return s.compile(t,n),i.instance=n,i.element=t,{element:t,instance:n}}})))},o.onChanges=function(){},i}(t.Structure);u(Yt,"meta",{selector:"router-outlet,[router-outlet]",hosts:{host:Yt}});var $t=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onInit=function(){this.state={};var e=new Jt;if(e.link){var n=e.toGuidedTourUrl(),r=t.getContext(this).node;new QRious({element:r.querySelector(".qrcode"),value:n,size:256})}else window.location.href=Jt.getGuidedTourUrl()},n}(t.Component);$t.meta={selector:"[access-code-component]",hosts:{host:Yt},template:'\n\t\t<div class="page page--access-code">\n\t\t\t'+E+'\n\t\t\t\x3c!-- access-code --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'access_code_title\' | label"></div>\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<canvas class="qrcode"></canvas>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t'+_+"\n\t\t\t"+S+"\n\t\t\t"+T+"\n\t\t</div>\n\t"};var Zt=function(){function t(){}return t.merge=function(t,e){var n=this;return e&&"object"==typeof e&&Object.keys(e).forEach((function(r){var i=e[r];"object"!=typeof i||Array.isArray(i)?t[r]=i:t[r]=n.merge(t[r],i)})),t},t}(),te="undefined"!=typeof module&&module.exports,ee=null!=(te?{get:function(){}}:new URLSearchParams(window.location.search)).get("debug"),ne=te?null:document.querySelector("base").getAttribute("href"),re=!te&&(window&&-1!==window.location.host.indexOf("herokuapp")),ie=!te&&(re||window&&("41789"===window.location.port||"5000"===window.location.port||"6443"===window.location.port||"actarian.github.io"===window.location.host)),oe=!te&&(window&&-1!==["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0])),ae={STATIC:ie,DEVELOPMENT:oe,PRODUCTION:!oe},se=function(){var t=e.prototype;function e(t){t&&Object.assign(this,t)}return t.getAbsoluteUrl=function(t,e){var n=""+window.location.origin+t;return Object.keys(e).forEach((function(t){n=n.replace("$"+t,e[t])})),n},t.getPath=function(t){return this.isLocal(t)?this.href+t:t},t.isLocal=function(t){return-1===t.indexOf("://")},t.merge=function(t){t&&Zt.merge(this,t)},c(e,[{key:"STATIC",get:function(){return ae.STATIC},set:function(t){ae.STATIC=!0===t||"true"===t,console.log("Environment.STATIC.set",ae.STATIC)}},{key:"href",get:function(){return re?this.githubDocs:ne}}]),e}(),ce={channelName:"BHere",flags:{production:!1,useProxy:!1,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!0,menu:!0,navmaps:!0,chat:!0,ar:!0,like:!0,hideNavInfo:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!0,heroku:re},navs:{iconMinScale:1,iconMaxScale:1.4},url:{},languages:["it","en"],defaultLanguage:"it",labels:{},data:{},fields:[]},ue=window.STATIC?{appKey:"8b0cae93d47a44e48e97e7fd0404be4e",channelName:"BHere",flags:{production:!1,useProxy:!0,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!0,editorAssetScreen:!0,menu:!0,menuEmbed:!0,navmaps:!0,chat:!0,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!0,navMoveImportantAnimated:!0,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!0,navTransparentImportantAnimated:!0,useTextureEnvironment:!0,usePaths:!0},navs:{iconMinScale:1,iconMaxScale:1.4},profiles:{streamer:"480p_2",publisher:"1080p_2",screen:"1080p_2"},logo:null,background:{video:"/b-here/img/background.mp4"},selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room"],disabledViewItemTypes:["texture"]},assets:"/b-here/",dist:"/b-here/dist/",workers:{image:"./js/workers/image.service.worker.js",prefetch:"./js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},githubDocs:"https://raw.githubusercontent.com/actarian/b-here/b-here-ws-new/docs/",template:{tryInAr:"/try-in-ar.html?viewId=$viewId",modal:{configureFirewall:"/configure-firewall-modal.html",controlRequest:"/control-request-modal.html",supportRequest:"/support-request-modal.html",tryInAr:"/try-in-ar-modal.html",view:{panorama:"/panorama-modal.html","panorama-grid":"/panorama-grid-modal.html","room-3d":"/room-3d-modal.html",model:"/model-modal.html",media:"/media-modal.html"},viewItem:{nav:"/nav-modal.html",plane:"/plane-modal.html","curved-plane":"/curved-plane-modal.html",texture:"/texture-modal.html",model:"/item-model-modal.html"},navmap:"/navmap-modal.html",navmapItem:"/navmap-item-modal.html",pathAdd:"/path-add-modal.html",pathEdit:"/path-edit-modal.html",remove:"/remove-modal.html"},email:{supportRequest:"/email/support-request.html"}}}:{appKey:"8b0cae93d47a44e48e97e7fd0404be4e",channelName:"BHere",flags:{production:!0,useProxy:!1,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!1,editorAssetScreen:!1,menu:!0,menuEmbed:!1,navmaps:!1,chat:!1,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!1,navMoveImportantAnimated:!1,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!1,navTransparentImportantAnimated:!1,useTextureEnvironment:!0,usePaths:!1},navs:{iconMinScale:1,iconMaxScale:1.4},profiles:{streamer:"480p_2",publisher:"1080p_2",screen:"720p_2"},logo:null,background:{video:"/Modules/B-Here/Client/docs/img/background.mp4"},selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},assets:"/Modules/B-Here/Client/docs/",dist:"/Modules/B-Here/Client/dist/",workers:{image:"/Modules/B-Here/Client/docs/js/workers/image.service.worker.js",prefetch:"/Modules/B-Here/Client/docs/js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},githubDocs:"https://raw.githubusercontent.com/actarian/b-here/b-here-ws-new/docs/",template:{tryInAr:"/template/modules/b-here/try-in-ar.cshtml?viewId=$viewId",modal:{configureFirewall:"/template/modules/b-here/configure-firewall-modal.cshtml",controlRequest:"/template/modules/b-here/control-request-modal.cshtml",supportRequest:"/template/modules/b-here/support-request-modal.cshtml",tryInAr:"/template/modules/b-here/try-in-ar-modal.cshtml",view:{panorama:"/template/modules/b-here/panorama-modal.cshtml","panorama-grid":"/template/modules/b-here/panorama-grid-modal.cshtml","room-3d":"/template/modules/b-here/room-3d-modal.cshtml",model:"/template/modules/b-here/model-modal.cshtml",media:"/template/modules/b-here/media-modal.cshtml"},viewItem:{nav:"/template/modules/b-here/nav-modal.cshtml",plane:"/template/modules/b-here/plane-modal.cshtml","curved-plane":"/template/modules/b-here/curved-plane-modal.cshtml",texture:"/template/modules/b-here/texture-modal.cshtml",model:"/template/modules/b-here/item-model-modal.cshtml"},navmap:"/template/modules/b-here/navmap-modal.cshtml",navmapItem:"/template/modules/b-here/navmap-item-modal.cshtml",pathAdd:"/template/modules/b-here/path-add-modal.cshtml",pathEdit:"/template/modules/b-here/path-edit-modal.cshtml",remove:"/template/modules/b-here/remove-modal.cshtml"},email:{supportRequest:"/template/modules/b-here/email/support-request.cshtml"}}},le=Object.assign({port:5e3,fontFamily:"Work Sans, sans-serif",colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},renderOrder:{panorama:0,room:10,plane:20,tile:30,model:40,banner:50,nav:60,panel:70,menu:80,debug:90,pointer:100}},ce,ue),de=new se(le=Zt.merge(le,window.bhere));console.log("environment",de);var he=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.getControl=function(t){return this.group.get(t)},c(e,[{key:"group",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control}}]),e}(t.Component);function fe(t){return new e.FormGroup(function(t){return t.reduce((function(t,n,r){var i=[];if(n.required&&i.push("checkbox"===n.type?e.Validators.RequiredTrueValidator():e.Validators.RequiredValidator()),"email"===n.type&&i.push(e.Validators.EmailValidator()),"url"===n.type&&i.push(e.Validators.PatternValidator("(https?://(?:www.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|www.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|https?://(?:www.|(?!www))[a-zA-Z0-9]+.[^s]{2,}|www.[a-zA-Z0-9]+.[^s]{2,})")),null!=n.pattern&&i.push(e.Validators.PatternValidator(n.pattern)),t[n.name]=new e.FormControl(null!=n.value?n.value:null,i),"select"===n.type||"custom-select"===n.type){var o=(n.options||[]).slice();o.unshift({id:null,name:"select"}),t[n.name].options=o}return t}),{})}(t))}he.meta={selector:"[controls]",inputs:["formGroup","fields"],hosts:{host:e.FormAbstractCollectionDirective},template:'\n\t\t<div *for="let field of fields">\n\t\t\t<div *if="[\'text\', \'email\', \'url\'].indexOf(field.type) !== -1" control-text [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'select\'" control-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'custom-select\'" control-custom-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'textarea\'" control-textarea [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'checkbox\'" control-checkbox [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<input *if="field.type == \'hidden\'" [name]="field.name" [formControl]="getControl(field.name)" value="" type="text" style="display:none !important;" />\n\t\t</div>\n\t'};var pe=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){return e.labels[t]||t},e.getKeys=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.transform(n.map((function(t){return t.replace("-","_")})).join("_"))},c(e,null,[{key:"labels",get:function(){return de.labels}}]),e}(t.Pipe);pe.meta={name:"label"};var ve=function(){function t(){}return t.setAlternates=function(t,e){this.languages=e,this.selectedLanguage=t},t.setRoute=function(t,e){var n=t.params.lang,r=de.languages.map((function(r){var i="it"===r?"Italiano":"English",o=t.name.replace(new RegExp("(^"+n+"$)|(^"+n+".)"),(function(t,e,n,i){return e?r:r+"."})),a=e.find((function(t){return t.name===o}));return a?{name:a.name,params:t.params,href:a.path,lang:a.defaultParams.lang,title:i}:null})).filter((function(t){return null!==t}));this.setAlternates(n,r)},t.getDefaultLanguages=function(){return de.alternates||[]},t.getDefaultLanguage=function(){return de.defaultLanguage||(this.languages?this.languages[0].lang:null)},t.setLanguage=function(t){this.selectedLanguage=t.lang},t.setLanguage$=function(t){var e=this,i=de.flags.production?"/api/labels/"+t.lang:"./api/labels/"+t.lang+".json";return n.from(fetch(i).then((function(t){return t.json()}))).pipe(r.tap((function(n){de.labels=n,Qt.replaceHistoryState(t.name,t.params);var r=e.activeLanguage.href.split("?")[0],i=t.href.split("?")[0];C.replace(r,i),e.selectedLanguage=t.lang})))},t.setLanguage$_=function(t){var e=this;return n.from(fetch(t.href).then((function(t){return t.text()}))).pipe(r.tap((function(n){var r=/(window\.labels[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*=[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\n*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\{((\{[\s\S]+?\})|[\s\S])+?\})/gm.exec(n);r&&(new Function(r[0]).call(window),pe.setLabels());var i=/(window\.bhere[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*=[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\n*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\{((\{[\s\S]+?\})|[\s\S])+?\})/gm.exec(n);if(i){var o={};new Function(i[0].replace("window","this")).call(o),o.bhere&&Zt.merge(de,o.bhere)}C.replace(e.activeLanguage.href,t.href),e.selectedLanguage=t.lang})))},t.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},c(t,null,[{key:"hasLanguages",get:function(){return this.languages.length>1}},{key:"activeLanguage",get:function(){var t=this;return this.languages.find((function(e){return e.lang===t.selectedLanguage}))}}]),t}();u(ve,"languages",ve.getDefaultLanguages()),u(ve,"defaultLanguage",ve.getDefaultLanguage()),u(ve,"selectedLanguage",ve.defaultLanguage);var me=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){return t.replace(":lang",ve.selectedLanguage)},e}(t.Pipe);me.meta={name:"route"};var ge=[["480p_1",640,480,15,500,!0],["480p_2",640,480,30,1e3,!0],["480p_3",480,480,15,400,!0],["480p_4",640,480,30,750,!0],["480p_6",480,480,30,600,!0],["480p_8",848,480,15,610,!0],["480p_9",848,480,30,930,!0],["480p_10",640,480,10,400,!0],["720p_1",1280,720,15,1130,!0],["720p_2",1280,720,30,2e3,!0],["720p_3",1280,720,30,1710,!0],["720p_5",960,720,15,910,!0],["720p_6",960,720,30,1380,!0],["1080p_1",1920,1080,15,2080,!1],["1080p_2",1920,1080,30,3e3,!1],["1080p_3",1920,1080,30,3150,!1],["1080p_5",1920,1080,60,4780,!1]].map((function(t){return{profile:t[0],resolution:{width:t[1],height:t[2]},frameRate:{min:t[3],max:t[3]},bitrate:{min:t[4],max:t[4]},compatible:t[5]}}));function Ae(t){return t.role===qt.Publisher||t.role===qt.SmartDevice?ge.find((function(t){return t.profile===de.profiles.publisher})):ge.find((function(t){return t.profile===de.profiles.streamer}))}var ye="idle",be="checklist",we="link",Ee="login",_e="name",Se="device",Te="should-connect",Ce="connecting",xe="connected",Re="agoraEvent",Ie="channelMembers",Oe="supportRequest",Me="supportRequestAccepted",Le="supportRequestRejected",ke="requestControl",Be="requestControlAccepted",Ne="requestControlRejected",Pe="requestControlDismiss",Ue="requestControlDismissed",De="requestPeerInfo",Fe="requestPeerInfoResult",He="requestInfo",je="requestInfoResult",Ve="requestInfoDismiss",Ge="requestInfoDismissed",Qe="requestInfoRejected",ze="remoteSilencing",qe="controlInfo",We="addLike",Ke="showPanel",Xe="playMedia",Je="zoomMedia",Ye="currentTimeMedia",$e="playModel",Ze="mode",tn="navInfo",en="navToView",nn="navToGrid",rn="navLink",on="navLinkClose",an="vrStarted",sn="vrEnded",cn="vrState",un="menuToggle",ln="chatMessage",dn="chatTypingBegin",hn="chatTypingEnd",fn="selectItem",pn="virtual-tour",vn="live-meeting",mn="self-service-tour",gn="embed",An="none",yn=function(t){Object.assign(this,t)},bn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),wn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),En=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),_n=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),Sn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),Tn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),Cn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(yn),xn=(function(){function t(t){this.data=null,t&&(this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.ok=t.ok,this.redirected=t.redirected)}c(t,[{key:"static",get:function(){return this.url.indexOf(".json")===this.url.length-5}}])}(),function(){function t(){}return t.http$=function(t,e,i,o){var a=this,s=null;return n.from(fetch(e,{method:t,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(t)?JSON.stringify(i):void 0}).then((function(t){s=t;try{var e,n=t.headers.get("content-type");return e=n&&-1!==n.indexOf("application/json")?t.json():t.text(),t.ok?e:e.then((function(t){return Promise.reject(t)}))}catch(e){return t.ok?(console.warn("HttpService.http$","Cannot parse response"),Promise.resolve()):Promise.reject(e)}}))).pipe(r.catchError((function(t){return n.throwError(a.getError(t,s))})))},t.get$=function(t,e,n){var r=this.query(e);return this.http$("GET",""+t+r,void 0,n)},t.delete$=function(t){return this.http$("DELETE",t)},t.post$=function(t,e){return this.http$("POST",t,e)},t.put$=function(t,e){return this.http$("PUT",t,e)},t.patch$=function(t,e){return this.http$("PATCH",t,e)},t.query=function(t){return""},t.getError=function(t,e){var n="object"==typeof t?t:{};return n.status||(n.status=e?e.status:0),n.statusCode||(n.statusCode=e?e.status:0),n.statusMessage||(n.statusMessage=e?e.statusText:t),n},t}()),Rn=function(){function t(){}return t.setUser=function(t){this.user$.next(t)},t.me$=function(){var t=this;return xn.get$("/api/user/me").pipe(r.map((function(e){return t.mapUser(e)})),r.catchError((function(t){if(404===t.status||404===t.statusCode)return n.of(null);throw t})),r.switchMap((function(e){return t.setUser(e),t.user$})))},t.login$=function(t){var e=this;return xn.post$("/api/user/login",t).pipe(r.map((function(t){return e.mapUser(t)})),r.tap((function(t){return e.setUser(t)})))},t.logout$=function(){var t=this;return xn.get$("/api/user/logout").pipe(r.map((function(e){return t.mapUser(e)})),r.tap((function(e){return t.setUser(null)})))},t.guidedTour$=function(t){var e=this;return xn.post$("/api/user/guided-tour",t).pipe(r.map((function(t){return e.mapUser(t)})),r.tap((function(t){return e.setUser(t)})))},t.selfServiceTour$=function(t){var e=this;return xn.post$("/api/user/self-service-tour",t).pipe(r.map((function(t){return e.mapUser(t)})),r.tap((function(t){return e.setUser(t)})))},t.selfServiceSupportRequest$=function(t,e,n){var i={user:t,meetingId:e,link:n};return xn.post$("/api/user/self-service-support-request",i).pipe(r.tap((function(e){de.flags.production||fetch(de.template.email.supportRequest).then((function(t){return t.text()})).then((function(e){e=(e=e.replace("{{username}}",Jt.getName(t))).replace("{{href}}",n);var r=(new DOMParser).parseFromString(e,"text/html");setTimeout((function(){var t=window.open();t.document.head.innerHTML=r.querySelector("head").innerHTML,t.document.body.innerHTML=r.querySelector("body").innerHTML}),3e3)}))})))},t.resolve$=function(t,e){return"login"===e?this.login$(t):"guided-tour"===e?this.guidedTour$(t):"self-service-tour"===e?this.selfServiceTour$(t):void 0},t.log$=function(t){return xn.post$("/api/user/log",t)},t.temporaryUser$=function(t){var e=this;return void 0===t&&(t=qt.Embed),n.of({id:this.uuid(),type:t,username:t,firstName:"Jhon",lastName:"Appleseed"}).pipe(r.map((function(t){return e.mapUser(t)})),r.switchMap((function(t){return e.setUser(t),e.user$})))},t.uuid=function(){return(new Date).getTime()},t.mapUser=function(t){return new Wt(t)},t.getMode=function(t){var e;switch(t){case qt.Publisher:case qt.Attendee:case qt.Streamer:case qt.Viewer:case qt.Publisher:case qt.Publisher:e=pn;break;case qt.SelfService:e=mn;break;case qt.SmartDevice:e=vn;break;case qt.Embed:e=gn;break;default:e=An}return e},t}();Rn.user$=new n.BehaviorSubject(null);var In=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){console.log("AccessComponent.onInit"),this.state={status:"access"}},i.onSelfServiceTourRequest=function(){this.initRequestForm(),this.state.status="self-service-tour",this.pushChanges(),ie&&-1!==window.navigator.userAgent.indexOf("OculusBrowser")&&(this.test(),this.onSubmit())},i.onGuidedTourRequest=function(){this.initRequestForm(),this.state.status="guided-tour",this.pushChanges()},i.onGuidedTourAccess=function(){Rn.logout$().pipe(r.first()).subscribe((function(){Qt.setRouterLink(me.transform(":lang.guidedTour"))}))},i.onLogin=function(){this.initLoginForm(),this.state.status="login",this.pushChanges()},i.initRequestForm=function(){var t=this;this.formSubscription&&this.formSubscription.unsubscribe();var e=this.data=de.data||{roles:[{id:1,name:"Show room"},{id:2,name:"Architetto"},{id:3,name:"Interior designer"},{id:4,name:"Privato"},{id:5,name:"Altro"}]},n=this.fields=de.fields||[{type:"text",name:"firstName",label:"access_first_name",required:!0,test:"Jhon"},{type:"text",name:"lastName",label:"access_last_name",required:!0,test:"Appleseed"},{type:"email",name:"email",label:"access_email",required:!0,test:"jhonappleseed@gmail.com"},{type:"custom-select",name:"role",label:"access_role",required:!0,options:e.roles,test:e.roles[0].id},{type:"checkbox",name:"privacy",label:"access_privacy_disclaimer",required:!0,test:!0}];n.push({type:"hidden",name:"checkField",value:"",test:""},{type:"none",name:"checkRequest",value:de.antiforgery||"",test:de.antiforgery||""});var i=this.form=fe(n);this.controls=i.controls;this.formSubscription=i.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.pushChanges()})),this.error=null},i.initLoginForm=function(){var t=this;this.formSubscription&&this.formSubscription.unsubscribe();var n=this.form=new e.FormGroup({username:new e.FormControl(null,e.Validators.RequiredValidator()),password:new e.FormControl(null,e.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=n.controls;this.formSubscription=n.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.pushChanges()})),this.error=null},i.test=function(){var t,e,n;"login"===this.state.status?this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""}):(t=this.fields,e=this.form,n=t.reduce((function(t,e,n){return e.test&&(t[e.name]=e.test),t}),{}),e.patch(n))},i.reset=function(){this.form.reset()},i.onBack=function(){this.state.status="access",this.pushChanges()},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n=this.state.status;Rn.resolve$(e,n).pipe(r.first()).subscribe((function(e){switch(n){case"guided-tour":t.state.status="guided-tour-success",t.pushChanges();break;case"self-service-tour":Qt.setRouterLink(me.transform(":lang.selfServiceTour"));break;case"login":Qt.setRouterLink(me.transform(":lang.guidedTour"))}t.form.reset()}),(function(e){console.log("AccessComponent.error",e),t.error=e,t.pushChanges()}))}else this.form.touched=!0},i.isValid=function(){var t=this.form.valid;return t},n}(t.Component);In.meta={selector:"[access-component]",hosts:{host:Yt},template:'\n\t\t<div class="page page--access">\n\t\t\t\x3c!-- background --\x3e\n\t\t\t<div class="background" [class]="{ \'background--image\': (\'background.image\' | env), \'background--video\': (\'background.video\' | env) }" *if="state.status != \'connected\'">\n\t\t\t\t<img [src]="\'background.image\' | env" *if="\'background.image\' | env" />\n\t\t\t\t<video [src]="\'background.video\' | env" *if="\'background.video\' | env" oncanplay="this.muted = true; this.classList.add(\'ready\');" playsinline autoplay muted loop></video>\n\t\t\t</div>\n\t\t\t\x3c!-- access --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'access\'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'access_title\' | label"></div>\n\t\t\t\t\t\t<div *if="\'selfService\' | flag">\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onSelfServiceTourRequest($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="\'access_tour\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="\'access_or\' | label"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div *if="\'guidedTourRequest\' | flag">\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onGuidedTourRequest($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="\'access_guided_tour\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="\'access_has_meeting_id\' | label"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onGuidedTourAccess($event)">\n\t\t\t\t\t\t\t<span [innerHTML]="\'access_guided_tour_cta\' | label"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button type="button" class="btn--absolute" (click)="onLogin($event)">\n\t\t\t\t\t<span [innerHTML]="\'access_cta\' | label"></span> <svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t\x3c!-- guided-tour --\x3e\n\t\t\t<div class="ui ui--info" *if="state.status == \'self-service-tour\' || state.status == \'guided-tour\'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t\t<div class="title" *if="state.status == \'self-service-tour\'" [innerHTML]="\'access_fill_fields\' | label"></div>\n\t\t\t\t\t\t\t<div class="title" *if="state.status == \'guided-tour\'" [innerHTML]="\'access_guided_tour_request\' | label"></div>\n\t\t\t\t\t\t\t\x3c!-- controls --\x3e\n\t\t\t\t\t\t\t<div controls [formGroup]="form" [fields]="fields"></div>\n\t\t\t\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'access_take_part\' | label"></div>\n\t\t\t\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t\t\t\t<span *if="!form.submitted" [innerHTML]="\'access_send\' | label"></span>\n\t\t\t\t\t\t\t\t<span *if="form.submitted" [innerHTML]="\'access_sent\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t\t<span [innerHTML]="\'access_back\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- guided-tour success --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'guided-tour-success\'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'access_request_sent\' | label"></div>\n\t\t\t\t\t\t<div class="info" [innerHTML]="\'access_info_request\' | label"></div>\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t<span [innerHTML]="\'access_back\' | label"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- login --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'login\'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t\t<div class="title" [innerHTML]="\'access_login\' | label"></div>\n\t\t\t\t\t\t\t<input name="checkField" [formControl]="controls.checkField" value="" type="text" style="display:none !important;" />\n\t\t\t\t\t\t\t<div control-text [control]="controls.username" [label]="\'access_username\' | label"></div>\n\t\t\t\t\t\t\t<div control-password [control]="controls.password" [label]="\'access_password\' | label"></div>\n\t\t\t\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'access_cta\' | label"></div>\n\t\t\t\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t\t\t\t<span [innerHTML]="\'access_cta\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t\t<span [innerHTML]="\'access_back\' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="btn--logo" (click)="onBack($event)">\n\t\t\t\t<img [src]="\'logo\' | env" *if="\'logo\' | env" />\n\t\t\t\t<svg viewBox="0 0 270 98" *if="!(\'logo\' | env)"><use xlink:href="#b-here"></use></svg>\n\t\t\t</div>\n\t\t\t\x3c!-- credits --\x3e\n\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener" *if="state.status != \'connected\'">\n\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t</a>\n\t\t\t\x3c!-- language --\x3e\n\t\t\t<div class="group--language" language (set)="pushChanges()" *if="state.status != \'connected\'"></div>\n\t\t</div>\n\t'};var On=function(){function t(){}return t.emoji$=function(){return null!=t.items_?n.of(t.items_):xn.get$(de.assets+"api/emoji/emoji.json").pipe(r.map((function(e){return t.items_=e,e})))},t}(),Mn=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.items=[],On.emoji$().pipe(r.first()).subscribe((function(e){setTimeout((function(){t.items=e,t.pushChanges()}),1)}))},n.onSelect=function(t){this.emoji.next(t)},n.onClose=function(t){this.close.next()},e}(t.Component);Mn.meta={selector:"[agora-chat-emoji]",outputs:["emoji","close"]};var Ln=function(){function t(){}return t.message=function(t){this.message$.next(t)},t.in=function(t){this.in$.next(t)},t.sendBack=function(t){t=Object.assign({},t,{remoteId:t.clientId}),this.in$.next(t)},t.out=function(t){this.out$.next(t)},t}();u(Ln,"message$",new n.ReplaySubject(1)),u(Ln,"in$",new n.ReplaySubject(1)),u(Ln,"send",Ln.in),u(Ln,"out$",new n.ReplaySubject(1));var kn="unknown",Bn="ios",Nn="android",Pn="windowsPhone",Un="vrHeadset",Dn=function(){function t(){}return t.getDevicePlatform=function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?Pn:/android/i.test(t)?Nn:this.isIOS?Bn:this.isVRHeadset?Un:kn},c(t,null,[{key:"platform",get:function(){return this.platform_||(this.platform_=this.getDevicePlatform()),this.platform_}},{key:"isIOS",get:function(){return-1!==["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].indexOf(navigator.platform)||-1!==navigator.userAgent.indexOf("Mac")&&"ontouchend"in document}},{key:"isVRHeadset",get:function(){return-1!==navigator.userAgent.indexOf("VR")||-1!==navigator.userAgent.indexOf("Quest")||-1!==navigator.userAgent.indexOf("Oculus")}}]),t}(),Fn=function(){function t(){this.events={}}var e=t.prototype;return e.on=function(t,e){var n=this,r=this.events[t]=this.events[t]||[];return r.push(e),function(){n.events[t]=r.filter((function(t){return t!==e}))}},e.off=function(t,e){var n=this.events[t];n&&(this.events[t]=n.filter((function(t){return t!==e})))},e.once=function(t,e){var n=this,r=function r(i){e(i),n.off(t,r)};this.on(t,r)},e.emit=function(t,e){var n=this.events[t];n&&n.forEach((function(t){t(e)}));var r=this.events.broadcast;r&&r.forEach((function(n){n(t,e)}))},e.has=function(t){var e=this.events[t];return e&&e.length},t}(),Hn=function(){function t(){}return t.delete=function(t){this.isSessionStorageSupported()&&window.sessionStorage.removeItem(t)},t.exist=function(t){if(this.isSessionStorageSupported())return void 0!==window.sessionStorage[t]},t.get=function(t){var e=null;if(this.isSessionStorageSupported()&&void 0!==window.sessionStorage[t])try{e=JSON.parse(window.sessionStorage[t])}catch(e){console.log("SessionStorageService.get.error parsing",t,e)}return e},t.set=function(t,e){if(this.isSessionStorageSupported())try{var n=[],r=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.sessionStorage.setItem(t,r)}catch(n){console.log("SessionStorageService.set.error serializing",t,e,n)}},t.isSessionStorageSupported=function(){if(this.supported)return!0;var t=!1;try{(t="sessionStorage"in window&&null!==window.sessionStorage)?(window.sessionStorage.setItem("test","1"),window.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t},t}(),jn="client",Vn="editor",Gn=function(){function t(){}return t.orderedRemotes$=function(){return n.combineLatest([t.remotes$,n.interval(1e3)]).pipe(r.map((function(t){var e=[];return t[0].forEach((function(t){var n=null,r=null,i=null,o=0,a=0,s=0;t.clientInfo&&(o=t.clientInfo.audioLevel=t.getAudioLevel(),a=t.clientInfo.peekAudioLevel=Math.max(t.clientInfo.audioLevel,.2),s=t.clientInfo.order,n=t.clientInfo.role||null,r=t.clientInfo.uid||null,i=t.clientInfo.screenUid||null),e.push({role:n,uid:r,screenUid:i,audioLevel:o,peekAudioLevel:a,order:s,remote:t})})),e.sort((function(t,e){var n=t.role===qt.Publisher?2:t.role===qt.Attendee?1:0;return(e.role===qt.Publisher?2:e.role===qt.Attendee?1:0)-n||e.peekAudioLevel-t.peekAudioLevel||(t.order||0)-(e.order||0)})),e.forEach((function(t,e){t.remote.clientInfo&&(t.remote.clientInfo.order=e)})),e})),r.distinctUntilChanged((function(t,e){return t.map((function(t){return t.uid+"-"+t.screenUid})).join("|")===e.map((function(t){return t.uid+"-"+t.screenUid})).join("|")})),r.map((function(t){return t.map((function(t){return t.remote}))})))},t.getEditorStreams$=function(){var t=this;return n.of(null).pipe(r.switchMap((function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&t.mode===Vn){var e=document.querySelector("body"),n=document.createElement("div"),r=document.createElement("video");n.setAttribute("id","stream-editor"),n.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),n.appendChild(r),e.appendChild(n),navigator.mediaDevices.getUserMedia({video:{width:800,height:450}}).then((function(e){"srcObject"in r?r.srcObject=e:r.src=window.URL.createObjectURL(e),r.oncanplay=function(){var e={getId:function(){return"editor"},clientInfo:{role:qt.Publisher,uid:"editor"}},n={getId:function(){return"editor"},clientInfo:{role:qt.Attendee,uid:"editor"}},r={getId:function(){return"editor"},clientInfo:{role:qt.SmartDevice,uid:"editor"}};t.editorStreams$.next([e,n,n,n,n,r])},r.play()})).catch((function(t){console.log("EditorComponent.getUserMedia.error",t.name,t.message)}))}return t.editorStreams$})),r.shareReplay(1))},t.getEditorScreens$=function(){var t=this;return n.of(null).pipe(r.switchMap((function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&t.mode===Vn){var e=document.querySelector("body"),n=document.createElement("div"),r=document.createElement("video");n.setAttribute("id","stream-editor-screen"),n.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),n.appendChild(r),e.appendChild(n),navigator.mediaDevices.getDisplayMedia({screen:{width:800,height:450}}).then((function(e){"srcObject"in r?r.srcObject=e:r.src=window.URL.createObjectURL(e),r.oncanplay=function(){var e={getId:function(){return"editor-screen"},clientInfo:{role:qt.Publisher,uid:"editor",screenUid:"editor-screen"}},n={getId:function(){return"editor-screen"},clientInfo:{role:qt.Attendee,uid:"editor",screenUid:"editor-screen"}};t.editorScreens$.next([e,n])},r.play()})).catch((function(t){console.log("EditorComponent.getUserMedia.error",t.name,t.message)}))}return t.editorScreens$})),r.shareReplay(1))},t.getPublisherStreamId$=function(){var t=this,e=this.publisherStreamId;return e?n.of(e):this.streams$.pipe(r.map((function(){return t.publisherStreamId})),r.filter((function(t){return t})))},t.getRemoteById=function(e){var n=t.remotes.find((function(t){return t.getId()===e}));if(n)return n},t.remoteAdd=function(t){var e=this.remotes.slice();e.push(t),this.remotes=e},t.remoteRemove=function(t){var e=this.remotes.slice(),n=e.find((function(e){return e.getId()===t}));return n&&(n.isPlaying()&&n.stop(),e.splice(e.indexOf(n),1),this.remotes=e),n},t.remoteSetClientInfo=function(t,e){var n=this.remotes,r=n.find((function(e){return e.getId()===t}));r&&(r.clientInfo=e),this.remotes=n},c(t,null,[{key:"editorStreams",set:function(t){this.editorStreams$.next(t)},get:function(){return this.editorStreams$.getValue()}},{key:"editorScreens",set:function(t){this.editorScreens$.next(t)},get:function(){return this.editorScreens$.getValue()}},{key:"local",set:function(t){this.local$.next(t)},get:function(){return this.local$.getValue()}},{key:"screen",set:function(t){this.screen$.next(t)},get:function(){return this.screen$.getValue()}},{key:"remotes",set:function(t){this.remotes$.next(t)},get:function(){return this.remotes$.getValue()}},{key:"peers",set:function(t){this.peers$.next(t)},get:function(){return this.peers$.getValue()}},{key:"publisherStreamId",get:function(){var t=this.remotes.slice(),e=this.local;e&&t.unshift(e);var n=t.find((function(t){return t.clientInfo&&t.clientInfo.role===qt.Publisher&&t.clientInfo.uid===t.getId()}));return n?n.getId():null}}]),t}();u(Gn,"mode",jn),u(Gn,"editorStreams$",new n.BehaviorSubject(null)),u(Gn,"editorScreens$",new n.BehaviorSubject(null)),u(Gn,"local$",new n.BehaviorSubject(null)),u(Gn,"screen$",new n.BehaviorSubject(null)),u(Gn,"remotes$",new n.BehaviorSubject([])),u(Gn,"peers$",new n.BehaviorSubject([])),u(Gn,"streams$",n.combineLatest([Gn.local$,Gn.screen$,Gn.remotes$,Gn.getEditorStreams$(),Gn.getEditorScreens$()]).pipe(r.map((function(t){var e,n,r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=o;(r&&(c=c.slice()).push(r),i&&(c=c.slice()).push(i),a)&&(e=c).push.apply(e,a);s&&(n=c).push.apply(n,s);return c})),r.shareReplay(1)));var Qn=function(t){function e(n){var r;if(e.AGORA)throw"AgoraService is a singleton";u(h(r=t.call(this)||this),"previousMuteAudio_",!1),r.onStreamPublished=r.onStreamPublished.bind(h(r)),r.onStreamUnpublished=r.onStreamUnpublished.bind(h(r)),r.onStreamAdded=r.onStreamAdded.bind(h(r)),r.onStreamRemoved=r.onStreamRemoved.bind(h(r)),r.onStreamSubscribed=r.onStreamSubscribed.bind(h(r)),r.onMuteVideo=r.onMuteVideo.bind(h(r)),r.onUnmuteVideo=r.onUnmuteVideo.bind(h(r)),r.onMuteAudio=r.onMuteAudio.bind(h(r)),r.onUnmuteAudio=r.onUnmuteAudio.bind(h(r)),r.onVolumeIndicator=r.onVolumeIndicator.bind(h(r)),r.onPeerConnect=r.onPeerConnect.bind(h(r)),r.onPeerLeaved=r.onPeerLeaved.bind(h(r)),r.onConnectionStateChange=r.onConnectionStateChange.bind(h(r)),r.onTokenPrivilegeWillExpire=r.onTokenPrivilegeWillExpire.bind(h(r)),r.onTokenPrivilegeDidExpire=r.onTokenPrivilegeDidExpire.bind(h(r)),r.onMessage=r.onMessage.bind(h(r));var i=zt.state;return zt.patchState({devices:i.role!==qt.Attendee&&n?n:{videos:[],audios:[]},quality:Ae(i),membersCount:0}),r}d(e,t),e.getSingleton=function(t){if(!ee)return this.AGORA||(this.AGORA=new e(t)),this.AGORA};var i=e.prototype;return i.addStreamDevice=function(t){this.removeStreamDevice();var e={deviceId:"video-stream",label:"videostream",kind:"videostream",src:t},n={deviceId:"audio-stream",label:"videostream",kind:"videostream",src:t},r=zt.state.devices;r.videos.push(e),r.audios.push(n),zt.patchState({devices:r})},i.removeStreamDevice=function(){var t=zt.state.devices;t.videos=t.videos.filter((function(t){return"videostream"!==t.kind})),t.audios=t.audios.filter((function(t){return"videostream"!==t.kind})),zt.patchState({devices:t})},i.devices$=function(){var t=zt.state.devices,r=this.defaultVideos=this.defaultVideos||t.videos.slice(),i=this.defaultAudios=this.defaultAudios||t.videos.slice();return t.videos=r.slice(),t.audios=i.slice(),n.from(new Promise((function(n,r){var i=function(){e.getDevices().then((function(e){o.close();for(var i=0;i<e.length;i++){var a=e[i];"videoinput"===a.kind&&a.deviceId&&t.videos.push({label:a.label||"camera-"+t.videos.length,deviceId:a.deviceId,kind:a.kind}),"audioinput"===a.kind&&a.deviceId&&t.audios.push({label:a.label||"microphone-"+t.audios.length,deviceId:a.deviceId,kind:a.kind})}t.videos.length>0||t.audios.length>0?n(t):r(t)})).catch((function(t){r(t)}))},o=AgoraRTC.createStream({audio:!0,video:!0});o.init((function(){i()}),(function(){i()}))})))},i.connect$=function(t){var n=this,r=zt.state.devices;return t&&(r.video=t.video,r.audio=t.audio),zt.state.connecting||(zt.patchState({status:Ce,connecting:!0,devices:r}),setTimeout((function(){n.createClient((function(){var t=n.getChannelNameLink();e.rtcToken$(t).subscribe((function(e){n.join(e.token,t)}))}))}),250)),zt.state$},i.membersCount$=function(t){var e=this.messageClient;return n.interval(2e3).pipe(r.switchMap((function(){return n.from(e.getChannelMemberCount([t]))})),r.map((function(e){return e[t]})),r.distinctUntilChanged())},i.observeMemberCount=function(){this.unobserveMemberCount(),this.membersCountSubscription=this.membersCount$(zt.state.channelNameLink).subscribe((function(t){zt.patchState({membersCount:t})}))},i.unobserveMemberCount=function(){this.membersCountSubscription&&(this.membersCountSubscription.unsubscribe(),this.membersCountSubscription=null,zt.patchState({membersCount:0}))},i.createClient=function(t){var e=this;this.client&&t(),AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.NONE);var n=this.client=AgoraRTC.createClient({mode:"live",codec:"h264"}),r=function(){de.flags.useProxy&&(n.startProxyServer(3),console.log("AgoraService.client.startProxyServer")),n.init(de.appKey,(function(){t()}),(function(t){e.client=null}))};this.isAudienceRole?n.setClientRole("audience",(function(t){t||r()})):r(),n.on("error",this.onError),n.on("stream-published",this.onStreamPublished),n.on("stream-unpublished",this.onStreamUnpublished),n.on("stream-added",this.onStreamAdded),n.on("stream-removed",this.onStreamRemoved),n.on("stream-subscribed",this.onStreamSubscribed),n.on("mute-video",this.onMuteVideo),n.on("unmute-video",this.onUnmuteVideo),n.on("mute-audio",this.onMuteAudio),n.on("unmute-audio",this.onUnmuteAudio),n.on("peer-online",this.onPeerConnect),n.on("peer-leave",this.onPeerLeaved),n.on("onTokenPrivilegeWillExpire",this.onTokenPrivilegeWillExpire),n.on("onTokenPrivilegeDidExpire",this.onTokenPrivilegeDidExpire),(this.messageClient=AgoraRTM.createInstance(de.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF})).setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF})},i.getChannelNameLink=function(){var t=zt.state.link||"",e=t.match(/(\d{9})-(\d{4})-(\d{13})/);return e&&(t=e[1]+"-"+e[3]),zt.state.channelName+"-"+t},e.getUniqueUserId=function(){return(1e13*(100*(1+Math.floor(8*Math.random()))+10*(1+Math.floor(8*Math.random()))+1*(1+Math.floor(8*Math.random())))+Date.now()).toString()},i.join=function(t,n){var r=this;this.channel=null;var i=this.client,o=Hn.get("bHereClientId")||e.getUniqueUserId();i.join(t,n,o,(function(t){zt.patchState({status:xe,channelNameLink:n,connected:!0,uid:t}),Hn.set("bHereClientId",t),e.rtmToken$(t).subscribe((function(e){r.joinMessageChannel(e.token,t).then((function(e){r.isAudienceRole||r.autoDetectDevice().then((function(e){r.createMediaStream(t,e.video,e.audio)})),r.observeMemberCount()}),(function(t){console.log("joinMessageChannel.error",t)}))}))}),(function(t){console.log("AgoraService.join.error",t),"DYNAMIC_KEY_EXPIRED"===t&&e.rtcToken$(n).subscribe((function(t){r.join(t.token,n)}))}))},i.joinMessageChannel=function(t,e){var n,r=this;return new Promise((function(i,o){var a=r.messageClient;a.login({token:t,uid:e.toString()}).then((function(){return(n=a.createChannel(zt.state.channelNameLink)).join()})).then((function(){r.channel=n,n.on("ChannelMessage",r.onMessage),r.emit("channel",n),i(e),n.getMembers().then((function(t){t=t.filter((function(t){return t!==e.toString()}));var n={type:Ie,members:t};r.broadcastMessage(n)}))})).catch(o)}))},i.detectDevices=function(t){e.getDevices().then((function(e){for(var n=[],r=[],i=0;i<e.length;i++){var o=e[i];"videoinput"==o.kind&&n.push({label:o.label||"camera-"+n.length,deviceId:o.deviceId,kind:o.kind}),"audioinput"==o.kind&&r.push({label:o.label||"microphone-"+n.length,deviceId:o.deviceId,kind:o.kind})}t({videos:n,audios:r})})).catch((function(t){console.log("AgoraService.detectDevices",t)}))},i.getVideoOptions=function(t,e){return new Promise((function(n,r){if(e)if("videostream"===e.kind){var i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";var o=new Hls;o.attachMedia(i),o.on(Hls.Events.MEDIA_ATTACHED,(function(){o.loadSource(e.src),o.on(Hls.Events.MANIFEST_PARSED,(function(e,r){i.play().then((function(e){var r=i.captureStream();t.videoSource=r.getVideoTracks()[0],n(t)}),(function(t){console.log("AgoraService.getVideoOptions.error",t)}))}))}))}else if("videoplayer"===e.kind||"videostream"===e.kind){var a=document.querySelector("#"+e.deviceId);a.crossOrigin="anonymous";var s=a.captureStream();t.videoSource=s.getVideoTracks()[0],n(t)}else t.cameraId=e.deviceId,n(t);else n(t)}))},i.getAudioOptions=function(t,e){return new Promise((function(n,r){if(e)if("videostream"===e.kind){var i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";var o=new Hls;o.attachMedia(i),o.on(Hls.Events.MEDIA_ATTACHED,(function(){o.loadSource(e.src),o.on(Hls.Events.MANIFEST_PARSED,(function(e,r){o.loadLevel=r.levels.length-1,i.play().then((function(e){var r=i.captureStream();t.audioSource=r.getAudioTracks()[0],n(t)}),(function(t){console.log("AgoraService.getAudioOptions.error",t)}))}))}))}else if("videoplayer"===e.kind||"videostream"===e.kind){var a=document.querySelector("#"+e.deviceId);a.crossOrigin="anonymous";var s=a.captureStream();t.audioSource=s.getAudioTracks()[0],n(t)}else t.microphoneId=e.deviceId,n(t);else n(t)}))},i.autoDetectDevice=function(){return new Promise((function(t,n){var r=zt.state;r.role===qt.SmartDevice?e.getDevices().then((function(e){var n={videos:[],audios:[],video:null,audio:null};e.forEach((function(t){"videoinput"===t.kind?n.videos.push(t):"audioinput"===t.kind&&n.audios.push(t)})),n.video=n.videos[0]||null,n.audio=n.audios[0]||null,zt.patchState({devices:n}),t(n)})).catch((function(t){n(t)})):t(r.devices)}))},i.createMediaStream=function(t,e,n){var r=this,i={streamID:t,video:Boolean(e),audio:Boolean(n),screen:!1};Promise.all([this.getVideoOptions(i,e),this.getAudioOptions(i,n)]).then((function(t){var e=Object.assign({},zt.state.quality);r.createLocalStreamWithOptions(i,e)}))},i.createLocalStreamWithOptions=function(t,e){var n=this,r=AgoraRTC.createStream(t);e&&r.setVideoProfile(e.profile),r.init((function(){Gn.local=r,setTimeout((function(){n.publishLocalStream()}),1)}),(function(t){console.log("AgoraService.initLocalStream.init.error",t)}))},i.initLocalStream=function(){var t=this;Gn.local.init((function(){t.publishLocalStream()}),(function(t){console.log("AgoraService.initLocalStream.init.error",t)}))},i.publishLocalStream=function(){var t=this.client,e=Gn.local;t.publish(e,(function(t){console.log("AgoraService.publishLocalStream.error",e.getId(),t)})),e.clientInfo={role:zt.state.role,name:zt.state.name,uid:zt.state.uid,screenUid:zt.state.screenUid},Gn.local=e},i.unpublishLocalStream=function(){var t=this.client,e=Gn.local;e&&t.unpublish(e,(function(t){console.log("AgoraService.unpublishLocalStream.error",e.getId(),t)})),Gn.local=null},i.leaveChannel=function(){var t=this;return zt.patchState({connecting:!1}),this.unpublishLocalStream(),this.unpublishScreenStream(),Gn.remotes=[],Gn.peers=[],new Promise((function(e,n){t.leaveMessageChannel().then((function(){Promise.all([t.leaveClient(),t.leaveScreenClient()]).then((function(){e()})).catch((function(t){n(t)}))})).catch((function(t){n(t)}))}))},i.leaveClient=function(){var t=this;return new Promise((function(e,n){var r=t.client;r?r.leave((function(){t.client=null,de.flags.useProxy&&(r.stopProxyServer(),console.log("AgoraService.client.stopProxyServer")),e()}),(function(t){console.log("AgoraService.leaveClient.error",t),n(t)})):e()}))},i.leaveMessageChannel=function(){var t=this;return new Promise((function(e,n){t.unobserveMemberCount();var r=t.channel;if(!r)return e();var i=t.messageClient;r.leave().then((function(){t.channel=null,i.logout().then((function(){t.messageClient=null,e()}),n)}),n)}))},i.toggleCamera=function(){var t=Gn.local;t&&t.video&&(t.userMuteVideo?(t.unmuteVideo(),zt.patchState({cameraMuted:!1}),this.broadcastEvent(new _n({streamId:t.getId()}))):(t.muteVideo(),zt.patchState({cameraMuted:!0}),this.broadcastEvent(new En({streamId:t.getId()}))))},i.toggleAudio=function(){var t=Gn.local;t&&t.audio&&(t.userMuteAudio?(t.unmuteAudio(),zt.patchState({audioMuted:!1}),this.broadcastEvent(new Tn({streamId:t.getId()}))):(t.muteAudio(),zt.patchState({audioMuted:!0}),this.broadcastEvent(new Sn({streamId:t.getId()}))))},i.setAudio=function(t){var e=Gn.local;e&&e.audio&&(t?(this.previousMuteAudio_=e.userMuteAudio,e.userMuteAudio||(e.muteAudio(),zt.patchState({audioMuted:!0}),this.broadcastEvent(new Sn({streamId:e.getId()})))):e.userMuteAudio&&!this.previousMuteAudio_&&(e.unmuteAudio(),zt.patchState({audioMuted:!1}),this.broadcastEvent(new Tn({streamId:e.getId()}))))},i.toggleMode=function(){var t=zt.state.mode===pn?vn:pn;zt.patchState({mode:t}),Ln.send({type:Ze,mode:t})},i.toggleNavInfo=function(){var t=!zt.state.showNavInfo;zt.patchState({showNavInfo:t}),Ln.send({type:tn,showNavInfo:t})},i.dismissControl=function(){var t=this;return new Promise((function(e,n){var r=zt.state.controlling;r?t.sendRemoteControlDismiss(r).then((function(){zt.patchState({controlling:!1}),e(r)})):e(!1)}))},i.requestControl=function(t){var e=this;return new Promise((function(n,r){e.sendRemoteControlRequest(t).then((function(t){zt.patchState({controlling:t}),n(t)}))}))},i.toggleControl=function(t){var e=this;this.dismissSpy().then((function(){e.dismissControl().then((function(n){n!==t&&e.requestControl(t).then((function(t){}))}))}))},i.toggleSilence=function(){var t=!zt.state.silencing;this.sendMessage({type:ze,silencing:t}),zt.patchState({silencing:t})},i.dismissSpy=function(){var t=this;return new Promise((function(e,n){var r=zt.state.spying;r?t.sendRemoteSpyDismiss(r).then((function(){zt.patchState({spying:!1}),e(r)})):e(!1)}))},i.requestSpy=function(t){var e=this;return new Promise((function(n,r){e.sendSpyRemoteRequestInfo(t).then((function(){zt.patchState({spying:t}),n(t)}))}))},i.toggleSpy=function(t){var e=this;this.dismissControl().then((function(){e.dismissSpy().then((function(n){n!==t&&e.requestSpy(t).then((function(t){console.log("AgoraService.toggleSpy",t)}))}))}))},i.sendRemoteRequestPeerInfo=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:De,messageId:e.newMessageId(),remoteId:t}).then((function(t){if(t.type===Fe){if(t.clientInfo.role===qt.Publisher){var r={hosted:!0};t.clientInfo.controllingId&&(r.controlling=t.clientInfo.controllingId,r.mode=t.clientInfo.mode,e.sendControlRemoteRequestInfo(t.clientInfo.controllingId)),zt.patchState(r)}n(t)}}))}))},i.sendRemoteControlRequest=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:ke,messageId:e.newMessageId(),controllingId:t}).then((function(e){e.type===Be?n(t):e.type===Ne&&n(!1)}))}))},i.sendRemoteControlDismiss=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:Pe,messageId:e.newMessageId(),controllingId:t}).then((function(e){e.type===Ue?n(t):e.type===Ne&&n(!1)}))}))},i.sendControlRemoteRequestInfo=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:He,messageId:e.newMessageId(),remoteId:t}).then((function(e){e.type===je&&(zt.patchState({controlling:t}),n(e))}))}))},i.sendSpyRemoteRequestInfo=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:He,messageId:e.newMessageId(),remoteId:t}).then((function(e){e.type===je&&(zt.patchState({spying:t}),n(e))}))}))},i.sendRemoteSpyDismiss=function(t){var e=this;return new Promise((function(n,r){e.sendMessage({type:Ve,messageId:e.newMessageId(),remoteId:t}).then((function(e){e.type===Ge?n(t):e.type===Qe&&n(!1)}))}))},i.newMessageId=function(){return zt.state.uid+"-"+Date.now().toString()},i.navToView=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),zt.state.controlling!==zt.state.uid&&zt.state.spying!==zt.state.uid||this.sendMessage({type:en,viewId:t,keepOrientation:e,useLastOrientation:n})},i.getSessionStats=function(){this.client.getSessionStats((function(t){console.log("Current Session Duration: "+t.Duration),console.log("Current Session UserCount: "+t.UserCount),console.log("Current Session SendBytes: "+t.SendBytes),console.log("Current Session RecvBytes: "+t.RecvBytes),console.log("Current Session SendBitrate: "+t.SendBitrate),console.log("Current Session RecvBitrate: "+t.RecvBitrate)}))},i.getSystemStats=function(){this.client.getSystemStats((function(t){console.log("Current battery level: "+t.BatteryLevel)}))},i.sendMessage=function(t){var e=this;return new Promise((function(n,r){if(zt.state.connected){switch(t.clientId=zt.state.uid,t.type){case qe:case nn:case Ke:case Xe:case Je:case Ye:case $e:case Ze:case tn:case rn:case on:if(zt.state.controlling!==zt.state.uid&&zt.state.spying!==zt.state.uid)return}var i=function(t,r){try{var i=JSON.stringify(t);t.messageId&&e.once("message-"+t.messageId,(function(t){n(t)})),r.sendMessage({text:i}).then((function(){t.messageId||n(t)})).catch((function(t){console.log("AgoraService.sendMessage.error",t)}))}catch(t){console.log("AgoraService.sendMessage.error",t)}},o=e.channel;if(o)i(t,o);else try{e.once("channel",(function(e){i(t,e)}))}catch(t){r(t)}}}))},i.addOrUpdateChannelAttributes=function(t){var e=this.messageClient;if(e){var r={};if(t.forEach((function(t){var e=t.date.toString();r[e]=JSON.stringify(t)})),Object.keys(r).length){var i=e.addOrUpdateChannelAttributes(zt.state.channelNameLink,r,{enableNotificationToChannelMembers:!1});return n.from(i)}return n.of(null)}return n.of(null)},i.getChannelAttributes=function(){var t=this.messageClient;if(t){var e=t.getChannelAttributes(zt.state.channelNameLink);return n.from(e).pipe(r.map((function(t){return Object.keys(t).map((function(e){return t[e]}))})),r.map((function(t){return t.sort((function(t,e){return t.lastUpdateTs-e.lastUpdateTs})),t.map((function(t){return JSON.parse(t.value)}))})))}return n.of(null)},i.checkBroadcastMessage=function(t){switch(t.type){case Pe:zt.patchState({controlling:!1}),t.controllingId===zt.state.uid&&this.unpublishScreenStream(),this.sendMessage({type:Ue,messageId:t.messageId});break;case Ve:zt.patchState({spying:!1}),this.sendMessage({type:Ge,messageId:t.messageId,remoteId:t.remoteId});break;case je:(zt.state.role===qt.Publisher||zt.state.controlling&&zt.state.controlling!==zt.state.uid)&&this.broadcastMessage(t);break;case ze:zt.state.role===qt.Streamer&&this.broadcastMessage(t);break;case qe:case Ke:case Xe:case Je:case Ye:case $e:case Ze:case tn:case en:case nn:case rn:case on:(zt.state.controlling&&zt.state.controlling!==zt.state.uid||zt.state.spying&&zt.state.spying!==zt.state.uid)&&this.broadcastMessage(t);break;default:this.broadcastMessage(t)}},i.broadcastMessage=function(t){Ln.out(t)},i.broadcastEvent=function(t){Ln.out({type:Re,event:t})},i.onMessage=function(t,e){if(e!==zt.state.uid){var n=JSON.parse(t.text);if(n.messageId&&this.has("message-"+n.messageId)&&this.emit("message-"+n.messageId,n),n.remoteId&&n.remoteId!==zt.state.uid&&n.remoteId!==zt.state.screenUid)return;if(n.type===an){var r=document.createElement("div");r.classList.add("player__vr"),n.container=r}this.checkBroadcastMessage(n)}},i.onError=function(t){console.log("AgoraService.onError",t)},i.onStreamPublished=function(t){var e=Gn.local;e.clientInfo={role:zt.state.role,name:zt.state.name,uid:zt.state.uid,screenUid:zt.state.screenUid},Gn.local=e},i.onStreamUnpublished=function(t){Gn.local=null},i.onStreamAdded=function(t){var e=this.client,n=t.stream;if(n){var r=n.getId();r!==zt.state.uid&&r!==zt.state.screenUid&&e.subscribe(n,(function(t){console.log("AgoraService.onStreamAdded.subscribe.error",t)}))}},i.onStreamRemoved=function(t){var e=t.stream.getId();e!==zt.state.uid&&e!==zt.state.screenUid&&this.remoteRemove(e)},i.onStreamSubscribed=function(t){this.remoteAdd(t.stream)},i.onPeerConnect=function(t){this.peerAdd(t)},i.onPeerLeaved=function(t){var e=t.uid;if(e!==zt.state.uid){var n=this.remoteRemove(e);n.clientInfo&&(n.clientInfo.role===qt.Publisher?zt.state.role===qt.SelfService?zt.patchState({hosted:!0,controlling:!1,spying:!1,silencing:!1}):zt.patchState({hosted:!1,controlling:!1,spying:!1,silencing:!1}):(zt.state.controlling===e&&zt.patchState({controlling:!1}),zt.state.spying===e&&zt.patchState({spying:!1})))}this.peerRemove(e)},i.peerAdd=function(t){var e={uid:t.uid},n=Gn.peers;n.push(e),Gn.peers=n,this.broadcastEvent(new bn({peer:e}))},i.peerRemove=function(t){var e=Gn.peers,n=e.find((function(e){return e.uid===t}));n&&(e.splice(e.indexOf(n),1),Gn.peers=e)},i.remoteAdd=function(t){Gn.remoteAdd(t),this.broadcastEvent(new wn({stream:t}));var e=t.getId();this.sendRemoteRequestPeerInfo(e).then((function(t){Gn.remoteSetClientInfo(e,t.clientInfo)}))},i.remoteRemove=function(t){var e=Gn.remoteRemove(t);return e&&e.clientInfo&&e.clientInfo.role===qt.Publisher&&e.clientInfo.screenUid!==t&&zt.patchState({hosted:!1}),e},i.onMuteVideo=function(t){this.broadcastEvent(new En({streamId:t.uid}))},i.onUnmuteVideo=function(t){this.broadcastEvent(new _n({streamId:t.uid}))},i.onMuteAudio=function(t){this.broadcastEvent(new Sn({streamId:t.uid}))},i.onUnmuteAudio=function(t){this.broadcastEvent(new Tn({streamId:t.uid}))},i.onVolumeIndicator=function(t){var e=t.attr.map((function(t){return{streamId:t.uid,level:t.level}}));this.broadcastEvent(new Cn({streams:e}))},i.onConnectionStateChange=function(t){console.log("AgoraService.onConnectionStateChange",t)},i.onTokenPrivilegeWillExpire=function(t){console.log("AgoraService.onTokenPrivilegeWillExpire");var n=this.client,r=this.getChannelNameLink();e.rtcToken$(r).subscribe((function(t){t.token&&(n.renewToken(t.token),console.log("AgoraService.onTokenPrivilegeWillExpire.renewed"))}))},i.onTokenPrivilegeDidExpire=function(t){console.log("AgoraService.onTokenPrivilegeDidExpire");var n=this.client,r=this.getChannelNameLink();e.rtcToken$(r).subscribe((function(t){t.token&&(n.renewToken(t.token),console.log("AgoraService.onTokenPrivilegeDidExpire.renewed"))}))},i.toggleScreen=function(){var t=this;Gn.screen?this.unpublishScreenStream():this.screenClient?this.createScreenStream(zt.state.screenUid):this.createScreenClient((function(){var n=t.getChannelNameLink();e.rtcToken$(n).subscribe((function(e){t.screenJoin(e.token,n)}))}))},i.createScreenClient=function(t){var e=this;this.screenClient&&t();var n=this.screenClient=AgoraRTC.createClient({mode:"live",codec:"h264"});de.flags.useProxy&&(n.startProxyServer(3),console.log("AgoraService.screenClient.startProxyServer")),n.init(de.appKey,(function(){t()}),(function(t){e.screenClient=null})),n.on("error",this.onScreenError),n.on("stream-published",this.onScreenStreamPublished),n.on("stream-unpublished",this.onScreenStreamUnpublished)},i.screenJoin=function(t,n){var r=this,i=this.screenClient,o=e.getUniqueUserId();i.join(t,n,o,(function(t){zt.patchState({screenUid:t}),r.createScreenStream(t)}),(function(t){console.log("AgoraService.screenJoin.error",t),"DYNAMIC_KEY_EXPIRED"===t&&e.rtcToken$(n).subscribe((function(t){r.screenJoin(t.token,n)}))}))},i.createScreenStream=function(t){var e=this,n={streamID:t,audio:!1,video:!1,screen:!0},r=AgoraRTC.createStream(n);r.setScreenProfile(de.profiles.screen),console.log("AgoraService.createScreenStream",n);var i=function(){e.unpublishScreenStream()};r.init((function(){Gn.screen=r,r.on("stopScreenSharing",i),r.muteAudio(),setTimeout((function(){e.publishScreenStream()}),1)}),(function(t){console.log("AgoraService.createScreenStream.screen.init.error",t)}))},i.publishScreenStream=function(){var t=this.screenClient,e=Gn.screen;t.publish(e,(function(t){console.log("AgoraService.publishScreenStream.error",e.getId(),t)})),e.clientInfo={role:zt.state.role,name:zt.state.name,uid:zt.state.uid,screenUid:zt.state.screenUid},Gn.screen=e},i.unpublishScreenStream=function(){var t=this.screenClient,e=Gn.screen;t&&e&&t.unpublish(e,(function(t){console.log("AgoraService.unpublishScreenStream.error",e.getId(),t)})),Gn.screen=null},i.leaveScreenClient=function(){var t=this;return new Promise((function(e,n){var r=t.screenClient;r?r.leave((function(){t.screenClient=null,de.flags.useProxy&&(r.stopProxyServer(),console.log("AgoraService.screenClient.stopProxyServer")),e()}),(function(t){console.log("AgoraService.leaveScreenClient.error",t),n(t)})):e()}))},i.onScreenError=function(t){console.log("AgoraService.onScreenError",t)},i.onScreenStreamPublished=function(t){var e=Gn.screen;e.clientInfo={role:zt.state.role,name:zt.state.name,uid:zt.state.uid,screenUid:zt.state.screenUid},Gn.screen=e},i.onScreenStreamUnpublished=function(t){Gn.screen=null},e.rtcToken$=function(t){return de.flags.useToken?xn.post$("/api/token/rtc",{channelName:t,uid:null}):n.of({token:null})},e.rtmToken$=function(t){return de.flags.useToken?xn.post$("/api/token/rtm",{uid:t}):n.of({token:null})},e.checkRtcConnection=function(){return new Promise((function(t,n){try{var r=AgoraRTC.createClient({mode:"live",codec:"h264"});de.flags.useProxy&&r.startProxyServer(3),r.init(de.appKey,(function(){e.checkRtcTryJoin(r).then((function(e){t(e)})).catch((function(t){n(t)})).finally((function(){r.leave((function(){de.flags.useProxy&&r.stopProxyServer()}),(function(){}))}))}),(function(t){n(t)}))}catch(t){n(t)}}))},e.checkRtcTryJoin=function(t){return new Promise((function(n,r){var i="checkRtcConnection";e.rtcToken$(i).subscribe((function(o){t.join(o.token,i,null,(function(t){n(t)}),(function(n){if("DYNAMIC_KEY_EXPIRED"===n)return e.checkRtcTryJoin(t);console.log("AgoraService.checkRtcConnection.error",n),r(n)}))}),(function(t){return r(t)}))}))},e.checkRtmConnection=function(t){return new Promise((function(n,r){try{var i,o=AgoraRTM.createInstance(de.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF});o.setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF}),e.rtmToken$(t).subscribe((function(e){o.login({token:e.token,uid:t.toString()}).then((function(){(i=o.createChannel("checkRtcConnection")).join().then((function(){n(t),i.leave()})).catch((function(t){r(t)})).finally((function(){i.leave().then((function(){i=null,o.logout().then((function(){o=null})).catch((function(){}))})).catch((function(){}))}))})).catch((function(t){r(t)})).finally((function(){o&&o.logout().then((function(){o=null})).catch((function(){}))}))}),(function(t){return r(t)}))}catch(t){r(t)}}))},e.getDevices=function(){return new Promise((function(t,n){var r=e.devices_;if(r)t(r);else{r=e.devices_=[];var i={audio:!0,video:!0};Dn.platform===Bn&&(i.video={facingMode:"user"}),Dn.platform===Un&&(i.video=!1),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(i).then((function(e){navigator.mediaDevices.enumerateDevices().then((function(n){e.getTracks().forEach((function(t){t.stop()})),n.forEach((function(t){r.push(t)})),t(r)})).catch((function(t){n(t)}))})).catch((function(t){n(t)})):n("Media device not available")}}))},c(e,[{key:"isAudienceRole",get:function(){return zt.state.role===qt.Viewer||zt.state.role===qt.SelfService}}]),e}(Fn),zn=function(){function t(t,e,n){this.type=ln,this.clientId_=e,"string"==typeof t?(this.date=Date.now(),this.clientId=e,this.name=n,this.message=t):"object"==typeof t&&(this.date=t.date,this.clientId=t.clientId,this.name=t.name,this.message=t.message);var r=this.name.split(" ");this.shortName=r[0].substr(0,1).toUpperCase()+(r.length>1?r[1]:r[0]).substr(0,1).toUpperCase()}var e=t.prototype;return e.getPayload=function(){return{date:this.date,clientId:this.clientId,name:this.name,message:this.message}},e.getCopy=function(){return new t({date:this.date,clientId:this.clientId,name:this.name,message:this.message},this.clientId_)},c(t,[{key:"me",get:function(){return this.clientId===this.clientId_}}]),t}(),qn=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this;this.rows=1,this.showEmoji=!1,this.demo=-1!==window.location.pathname.indexOf("layout");var n=this.form=new e.FormGroup({message:null});this.controls=n.controls;if(n.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.checkTypings(e),t.pushChanges()})),zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){})),Ln.out$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case ln:t.pushMessage(new zn(e,zt.state.uid,zt.state.name));break;case dn:t.typingBegin(e);break;case hn:t.typingEnd(e)}})),this.messages=[],this.groupedMessages=[],this.demo){var o=i.getFakeList().map((function(t){return new zn(t,zt.state.uid,zt.state.name)}));this.updateMessages(o.slice(0,5)),Ln.in$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.clientId=t.clientId||zt.state.uid,t.type){case ln:break;case dn:case hn:Ln.out(t)}}))}else{var a=this.agora=Qn.getSingleton();a&&a.getChannelAttributes().pipe(r.first()).subscribe((function(e){e=e.map((function(t){return new zn(t,zt.state.uid,zt.state.name)})),t.updateMessages(e)}))}},o.onView=function(){},o.onChanges=function(){},o.onDestroy=function(){i.to&&(clearTimeout(i.to),i.to=null)},o.onSubmit=function(){var t=this.secureText(this.form.value.message),e=this.createMessage(t);this.sendMessage(e),this.form.get("message").value=null,this.demo},o.onKeyDown=function(e){"Enter"===e.key&&(e.shiftKey?(this.rows=Math.min(4,this.rows+1),this.pushChanges()):(e.preventDefault(),this.onSubmit(),this.rows=1),t.getContext(this).node.querySelector("textarea").setAttribute("rows",this.rows))},o.onToggleEmoji=function(){this.showEmoji=!this.showEmoji,this.pushChanges()},o.onSelectEmoji=function(t){this.showEmoji=!1,this.form.get("message").value=(this.form.get("message").value||"")+t.char},o.secureText=function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""},o.createMessage=function(t){return new zn(t,zt.state.uid,zt.state.name)},o.sendMessage=function(t){this.pushMessage(t);var e=this.agora;e&&e.addOrUpdateChannelAttributes([t.getPayload()]).pipe(r.first()).subscribe(),Ln.send(t)},o.onClose=function(t){this.close.next()},o.scrollToBottom=function(){var e=t.getContext(this).node.querySelector(".group--scrollview");e.scrollTop=e.scrollHeight},o.pushMessage=function(t){var e=this.messages?this.messages.slice():[];this.removeTyping({type:dn,clientId:t.clientId},this.messages),e.push(t),this.updateMessages(e)},o.typingBegin=function(t){var e=this.messages?this.messages.slice():[];e.push(t),this.updateMessages(e)},o.typingEnd=function(t){var e=this.messages?this.messages.slice():[];this.removeTyping({type:dn,clientId:t.clientId},e),this.updateMessages(e)},o.removeTyping=function(t,e,n){void 0===n&&(n=!0);var r=e.reduce((function(e,n,r){return n.type===t.type&&n.clientId===t.clientId?r:e}),-1);return-1!==r&&(e.splice(r,1),!0===n&&this.removeTyping(t,e,!0)),r},o.checkTypings=function(t){var e=t.message&&t.message.length>0;this.typings_!==e&&(this.typings_=e,e?Ln.send({type:dn}):Ln.send({type:hn}))},o.updateMessages=function(t){var e=this;this.messages=t,this.groupedMessages=[],this.pushChanges();var n=[];t.forEach((function(t){if(t.type===ln){var e=n.length?n[n.length-1]:null;e&&e.clientId===t.clientId?e.message+="<p>"+t.message+"</p>":n.push(t.getCopy())}else if(t.type===dn){var r=n.reduce((function(e,n,r){return n.clientId===t.clientId?n:e}),null);r&&(r.typing=!0)}})),this.groupedMessages=n,this.pushChanges(),setTimeout((function(){e.scrollToBottom()}),1)},o.isValid=function(){var t=this.form.valid;return t&&this.form.value.message&&this.form.value.message.length>0},o.randomMessage=function(){var t=this;i.to&&(clearTimeout(i.to),i.to=null),i.to=setTimeout((function(){var e=i.createRandomMessage();t.sendMessage(e)}),1e3*(2+6*Math.random()))},i}(t.Component);qn.meta={selector:"[agora-chat]",outputs:["close"],template:'\n\t\t<div class="group--scrollview" [class]="\'rows--\' + rows">\n\t\t\t<div class="group--virtual" *virtual="let item of groupedMessages" [mode]="4" [width]="350" [gutter]="0" [reverse]="true">\n\t\t\t\t\x3c!-- serve un nodo figlio --\x3e\n\t\t\t\t<div class="listing__item message" [class]="{ me: item.me, typing: item.typing }">\n\t\t\t\t\t<div class="message__avatar" [title]="item.name"><span [innerHTML]="item.shortName"></span></div>\n\t\t\t\t\t<div class="message__content">\n\t\t\t\t\t\t<div [innerHTML]="item.message | message"></div>\n\t\t\t\t\t\t<div class="typing-indicator">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group--message" [class]="\'rows--\' + rows">\n\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.message.validators.length, \'addon\': controls.message.valid }">\n\t\t\t\t\t\x3c!-- <input type="text" class="control--text" [formControl]="controls.message" [placeholder]="\'bhere_write_a_message\' | label" /> --\x3e\n\t\t\t\t\t<button type="button" class="control--pre" (click)="onToggleEmoji()">\n\t\t\t\t\t\t<svg class="emoji" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#emoji"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<textarea class="control--text" [formControl]="controls.message" [placeholder]="\'bhere_write_a_message\' | label" rows="1" (keydown)="onKeyDown($event)"></textarea>\n\t\t\t\t\t<button type="submit" class="control--addon">\n\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#send"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t<div class="group--close">\n\t\t\t<button type="button" class="btn--close" [title]="\'title_close\' | label" (click)="onClose($event)">\n\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="group--emoji" [class]="\'rows--\' + rows" agora-chat-emoji (emoji)="onSelectEmoji($event)" (close)="onToggleEmoji()" *if="showEmoji">\n\t\t\t<div class="group--virtual" *virtual="let item of items" [mode]="1" [width]="40" [gutter]="10" [reverse]="true">\n\t\t\t\t\x3c!-- serve un nodo figlio --\x3e\n\t\t\t\t<div class="listing__item emoji">\n\t\t\t\t\t<button type="button" class="btn--emoji" (click)="onSelect(item)"><span [innerHTML]="item.char"></span></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--close">\n\t\t\t\t<button type="button" class="btn--close" [title]="\'title_close\' | label" (click)="onClose($event)">\n\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'},qn.getFakeList=function(){for(var t=[{date:161459223e4,name:"Jhon Appleseed",message:"Function-based web-enabled benchmark",clientId:"7341614597544882"},{date:161459224e4,name:"Jhon Appleseed",message:"Customizable exuding superstructure",clientId:"7341614597544882"},{date:161459225e4,name:"Gilles Pitkins",message:"Synergistic interactive archive",clientId:"cfe9ff5b-f7da-449d-bf5a-3184b5eba6ea"},{date:161459226e4,name:"Jhon Appleseed",message:"Digitized client-server initiative",clientId:"7341614597544882"},{date:161459227e4,name:"Jhon Appleseed",message:"Quality-focused tertiary open system",clientId:"7341614597544882"},{date:161459228e4,name:"Jhon Appleseed",message:"Exclusive uniform middleware",clientId:"7341614597544882"},{date:161459229e4,name:"John Pruckner",message:"Decentralized disintermediate extranet",clientId:"ae51e846-d043-41e9-bb5c-3189181e5b43"},{date:16145923e5,name:"Lamont Georgievski",message:"Enhanced static approach",clientId:"1961cd9e-93aa-4bd0-b96a-89fcbd36b257"},{date:161459231e4,name:"Jhon Appleseed",message:"Ergonomic clear-thinking info-mediaries",clientId:"7341614597544882"},{date:161459232e4,name:"Jeri Pedroni",message:"Grass-roots dynamic encryption",clientId:"13d69bba-3656-449b-8fe3-d7a87062b044"},{date:161459233e4,name:"Frederik Dechelle",message:"Compatible disintermediate policy",clientId:"9151ebe0-efa8-40b4-a341-b8fd489e9c88"},{date:161459234e4,name:"Jhon Appleseed",message:"Inverse user-facing adapter",clientId:"7341614597544882"},{date:161459235e4,name:"Jhon Appleseed",message:"Future-proofed even-keeled application",clientId:"7341614597544882"},{date:161459236e4,name:"Cassie Jonathon",message:"Profit-focused content-based budgetary management",clientId:"5b3dc6f3-2a3d-493d-aac5-66ddfce2d709"},{date:161459237e4,name:"Jhon Appleseed",message:"Managed intermediate monitoring",clientId:"7341614597544882"},{date:161459238e4,name:"Jhon Appleseed",message:"Exclusive client-server encoding",clientId:"7341614597544882"},{date:161459239e4,name:"Jhon Appleseed",message:"Cross-group system-worthy matrices",clientId:"7341614597544882"},{date:16145924e5,name:"Jhon Appleseed",message:"Upgradable encompassing benchmark",clientId:"7341614597544882"},{date:161459241e4,name:"Emelen Beevors",message:"Function-based full-range knowledge base",clientId:"c93aea47-ebd8-4e5e-88fd-52053dd35cd1"},{date:161459242e4,name:"Jhon Appleseed",message:"Synergistic system-worthy capability",clientId:"7341614597544882"}];t.length<100;)t=t.concat(t);return t},qn.createRandomMessage=function(t){return new zn({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:"Herman frederick",message:"Lorem ipsum dolor"},zt.state.uid,zt.state.name)},qn.randomMessage=function(t,e){qn.to&&(clearTimeout(qn.to),qn.to=null),qn.to=setTimeout((function(){var n=function(){var t=e.filter((function(t){return"7341614597544882"!==t.id})),n=t[Math.floor(t.length*Math.random())];return new zn({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:n.name,message:n.message},zt.state.uid,zt.state.name)}();t.sendMessage(n),qn.randomMessage(t,e)}),1e3*(2+6*Math.random()))};var Wn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(t.Component);Wn.meta={selector:"[agora-check]",inputs:["value"],template:'\n\t\t<svg *if="value == null" class="checkmark idle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t</svg>\n\t\t<svg *if="value === true" class="checkmark success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" stroke-linecap="round"/>\n\t\t</svg>\n\t\t<svg *if="value === false" class="checkmark error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" stroke-linecap="round" fill="none" d="M16 16 36 36 M36 16 16 36"/>\n\t\t</svg>\n\t'};var Kn=function(t){this.data=t},Xn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(Kn),Jn=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(Kn),Yn=function(){function t(){}return t.open$=function(t){var e=this;return this.busy$.next(!0),(t.iframe?n.of('<div class="iframe-modal" iframe-modal src="'+t.iframe+'"></div>'):this.getTemplate$(t)).pipe(r.map((function(n){return{node:e.getNode(n),data:t.data,modal:t}})),r.tap((function(t){e.modal$.next(t),e.hasModal=!0,e.busy$.next(!1)})),r.switchMap((function(t){return e.events$})),r.tap((function(t){return e.hasModal=!1})))},t.getTemplate$=function(t){return t.src?n.from(fetch(t.src).then((function(t){return t.text()}))):t.template?n.of(t.template):EMPTY},t.getNode=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},t.reject=function(t){this.modal$.next(null),this.events$.next(new Jn(t))},t.resolve=function(t){this.modal$.next(null),this.events$.next(new Xn(t))},c(t,null,[{key:"hasModal",get:function(){return this.hasModal_},set:function(t){if(this.hasModal_!==t){this.hasModal_=t;var e=document.querySelector("body");t?e.classList.add("modal-open"):e.classList.remove("modal-open")}}}]),t}();Yn.modal$=new n.Subject,Yn.events$=new n.Subject,Yn.busy$=new n.Subject;var $n=function(){function t(){}return t.delete=function(t){this.isLocalStorageSupported()&&window.localStorage.removeItem(t)},t.exist=function(t){if(this.isLocalStorageSupported())return void 0!==window.localStorage[t]},t.get=function(t){var e=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[t])try{e=JSON.parse(window.localStorage[t])}catch(e){console.log("LocalStorageService.get.error parsing",t,e)}return e},t.set=function(t,e){if(this.isLocalStorageSupported())try{var n=[],r=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.localStorage.setItem(t,r)}catch(n){console.log("LocalStorageService.set.error serializing",t,e,n)}},t.isLocalStorageSupported=function(){if(this.supported)return!0;var t=!1;try{(t="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t},t}(),Zn=100,tr=function(){function t(){}return t.checklist$=function(){return zt.state$.pipe(r.first(),r.map((function(t){var e={shouldCheckAudio:!0,shouldCheckVideo:!0,key:"checklist_audio_video",uid:null,checklist:{browser:null,https:null,video:null,audio:null,rtc:null,rtm:null},errors:{}};return t.role===qt.Viewer&&(e.shouldCheckAudio=!1,e.shouldCheckVideo=!1),Dn.platform===Un&&(e.shouldCheckAudio=!0,e.shouldCheckVideo=!1),e.key="checklist"+(e.shouldCheckAudio?"_audio":"")+(e.shouldCheckVideo?"_video":""),e})),r.switchMap((function(t){return!0===$n.get(t.key)&&Object.keys(t.checklist).forEach((function(e){t.checklist[e]=!0})),n.of(t)})))},t.isChecked=function(t){var e=Object.keys(t.checklist).reduce((function(e,n,r){var i=e&&t.checklist[n];switch(n){case"audio":return i||!t.shouldCheckAudio;case"video":return i||!t.shouldCheckVideo;default:return i}}),!0);return e},t.isChecked$=function(){var t=this;return this.checklist$().pipe(r.map((function(e){return t.isChecked(e)})))},t.checkEvent$=function(){var t=this;return this.checklist$().pipe(r.switchMap((function(e){if(!0===Object.keys(e.checklist).reduce((function(t,n,r){return t&&e.checklist[n]}),!0))return n.of(e);$n.set(e.key,!1);var i=new n.Subject,o=n.of(e).pipe(r.delay(1e3),r.switchMap((function(e){return i.next(e),t.checkBrowserEvent$(e)})),r.switchMap((function(e){return i.next(e),t.checkHttpsEvent$(e)})),r.switchMap((function(e){return i.next(e),t.checkAudioEvent$(e)})),r.switchMap((function(e){return i.next(e),t.checkVideoEvent$(e)})),r.switchMap((function(e){return i.next(e),t.checkRtcEvent$(e)})),r.switchMap((function(e){return i.next(e),t.checkRtmEvent$(e)})),r.tap((function(t){$n.set(t.key,!0)})));return n.merge(i,o)})))},t.check$=function(){var t=this;return this.checklist$().pipe(r.switchMap((function(e){return!0===Object.keys(e.checklist).reduce((function(t,n,r){return t&&e.checklist[n]}),!0)?n.of(e):($n.set(e.key,!1),n.of(e).pipe(r.delay(1e3),r.switchMap((function(e){return t.checkBrowserEvent$(e)})),r.switchMap((function(e){return t.checkHttpsEvent$(e)})),r.switchMap((function(e){return t.checkAudioEvent$(e)})),r.switchMap((function(e){return t.checkVideoEvent$(e)})),r.switchMap((function(e){return t.checkRtcEvent$(e)})),r.switchMap((function(e){return t.checkRtmEvent$(e)})),r.tap((function(t){$n.set(t.key,!0)}))))})))},t.checkBrowser$=function(){var t=AgoraRTC.checkSystemRequirements();return n.of(t)},t.checkBrowserEvent$=function(t){var e=this;return this.checkBrowser$().pipe(r.switchMap((function(i){return t.checklist.browser=i,i?n.of(t).pipe(r.delay(Zn)):(t.errors.browser=pe.transform("bhere_browser_error"),e.checkHttpsEvent$(t).pipe(r.switchMap((function(t){return n.throwError(t)}))))})),r.catchError((function(e){return console.log("checkBrowserEvent$.error",e),t.checklist.browser=!1,t.errors.browser=pe.transform("bhere_browser_error"),n.throwError(t)})))},t.checkHttps$=function(){var t="https:"===window.location.protocol;return n.of(t)},t.checkHttpsEvent$=function(t){return this.checkHttps$().pipe(r.switchMap((function(e){return t.checklist.https=e,e?n.of(t).pipe(r.delay(Zn)):(t.errors.https=pe.transform("bhere_https_error"),n.throwError(t))})),r.catchError((function(e){return console.log("checkHttpsEvent$.error",e),t.checklist.https=!1,t.errors.https=pe.transform("bhere_https_error"),n.throwError(t)})))},t.checkAudio$=function(){return n.from(Qn.getDevices()).pipe(r.map((function(t){return null!=t.find((function(t){return"audioinput"===t.kind&&t.deviceId}))})))},t.checkAudioEvent$=function(t){return t.shouldCheckAudio?this.checkAudio$().pipe(r.switchMap((function(e){return t.checklist.audio=e,e?n.of(t).pipe(r.delay(Zn)):(t.errors.audio=pe.transform("bhere_audio_error"),n.throwError(t))})),r.catchError((function(e){return console.log("checkAudioEvent$.error",e),t.checklist.audio=!1,t.errors.audio=pe.transform("bhere_audio_error"),n.throwError(t)}))):n.of(t)},t.checkVideo$=function(){return n.from(Qn.getDevices()).pipe(r.map((function(t){return null!=t.find((function(t){return"videoinput"===t.kind&&t.deviceId}))})))},t.checkVideoEvent$=function(t){return t.shouldCheckVideo?this.checkVideo$().pipe(r.switchMap((function(e){return t.checklist.video=e,e?n.of(t).pipe(r.delay(Zn)):(t.errors.video=pe.transform("bhere_video_error"),n.throwError(t))})),r.catchError((function(e){return console.log("checkVideoEvent$.error",e),t.checklist.video=!1,t.errors.video=pe.transform("bhere_video_error"),n.throwError(t)}))):n.of(t)},t.checkRtc$=function(){return n.from(Qn.checkRtcConnection())},t.checkRtcEvent$=function(t){return this.checkRtc$().pipe(r.switchMap((function(e){return t.uid=e,t.checklist.rtc=!1!==e,e?n.of(t).pipe(r.delay(Zn)):(t.errors.rtc=pe.transform("bhere_rtc_error"),n.throwError(t))})),r.catchError((function(e){return console.log("checkRtcEvent$.error",e),t.checklist.rtc=!1,t.errors.rtc=pe.transform("bhere_rtc_error"),n.throwError(t)})))},t.checkRtm$=function(t){return n.from(Qn.checkRtmConnection(t))},t.checkRtmEvent$=function(t){return this.checkRtm$(t.uid).pipe(r.switchMap((function(e){return t.checklist.rtm=!1!==e,e?n.of(t):(t.errors.rtm=pe.transform("bhere_rtm_error"),n.throwError(t))})),r.catchError((function(e){return console.log("checkRtmEvent$.error",e),t.checklist.rtm=!1,t.errors.rtm=pe.transform("bhere_rtm_error"),n.throwError(t)})))},t}(),er=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onClose=function(){Yn.resolve()},e}(t.Component);er.meta={selector:"[agora-configure-firewall-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form" [innerHTML]="\'bhere_configure_firewall\' | label"></div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="button" class="btn--accept" (click)="onClose()">\n\t\t\t\t\t<span>Chiudi</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'},er.chunk=function(){return'<div class="configure-firewall-modal" agora-configure-firewall-modal></div>'};var nr=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.platform=Dn.platform,this.checklist={},this.errors={},this.state={},this.busy=!0,this.shouldCheckAudio=!1,this.shouldCheckVideo=!1,tr.checkEvent$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.shouldCheckAudio=e.shouldCheckAudio,t.shouldCheckVideo=e.shouldCheckVideo,t.checklist=e.checklist,t.errors=e.errors||{};var n=tr.isChecked(e);n?(t.checklist.success=n,t.busy=!1,t.pushChanges(),t.state.role===qt.SmartDevice&&t.onNext()):t.pushChanges()}),(function(e){t.errors=e.errors||{},t.checklist.error=!0,t.busy=!1,t.pushChanges()}))},n.onNext=function(){this.checked.next(this.checklist)},n.openHttps=function(){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")},n.showFirewallConfiguration=function(){Yn.open$({template:er.chunk()}).pipe(r.first()).subscribe()},e}(t.Component);nr.meta={selector:"[agora-checklist]",outputs:["checked"],template:'\n\t<div class="group--info">\n\t\t<div class="group--info__content stagger--childs">\n\t\t\t<div class="title" *if="busy" [innerHTML]="\'bhere_checklist_busy\' | label"></div>\n\t\t\t<div class="title" *if="checklist.success" [innerHTML]="\'bhere_checklist_success\' | label"></div>\n\t\t\t<div class="title" *if="checklist.error" [innerHTML]="\'bhere_checklist_error\' | label"></div>\n\t\t\t<ul class="group--checklist stagger--childs">\n\t\t\t\t<li class="checklist__item check"><span>Browser</span> <span agora-check [value]="checklist.browser"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.browser"><a class="btn--link" href="https://browsehappy.com/" target="_blank" rel="noopener" [innerHTML]="errors.browser"></a></li>\n\t\t\t\t<li class="checklist__item check"><span>Https</span> <span agora-check [value]="checklist.https"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.https"><a class="btn--link" (click)="openHttps()" [innerHTML]="errors.https"></a></li>\n\t\t\t\t<li class="checklist__item check" *if="shouldCheckAudio"><span>Audio</span> <span agora-check [value]="checklist.audio"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.audio"><span [innerHTML]="errors.audio"></span></li>\n\t\t\t\t<li class="checklist__item check" *if="shouldCheckVideo"><span>Video</span> <span agora-check [value]="checklist.video"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.video"><span [innerHTML]="errors.video"></span></li>\n\t\t\t\t<li class="checklist__item check"><span>Realtime Communication</span> <span agora-check [value]="checklist.rtc"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.rtc"><a class="btn--link" (click)="showFirewallConfiguration()" [innerHTML]="errors.rtc"></a></li>\n\t\t\t\t<li class="checklist__item check"><span>Realtime Messaging</span> <span agora-check [value]="checklist.rtm"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.rtm"><a class="btn--link" (click)="showFirewallConfiguration()" [innerHTML]="errors.rtm"></a></li>\n\t\t\t</ul>\n\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !checklist.success, ready: checklist.success }" (click)="onNext()">\n\t\t\t\t<span [innerHTML]="\'bhere_proceed\' | label"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<a [routerLink]="\':lang.editor\' | route" class="btn--absolute" *if="(\'editor\' | flag) && !(\'heroku\' | flag) && state.role == \'publisher\'">\n\t\t<span [innerHTML]="\'bhere_editor\' | label"></span> <svg class="edit" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#edit"></use></svg>\n\t</a>\n\t'};var rr=function(){function t(){}return t.addSource=function(t){var e=t instanceof MediaStream?t.id:t;return this.sources_[e]||(t instanceof MediaStream?this.sources_[e]=this.context.createMediaStreamSource(t.clone()):this.sources_[e]=this.context.createMediaElementSource(t)),this.sources_[e]},t.removeSource=function(t){var e=t instanceof MediaStream?t.id:t;return this.removeSourceKey(e)},t.removeSourceKey=function(t){var e;return this.sources_[t]&&(e=this.sources_[t],this.analyser&&e.disconnect(this.analyser),e.disconnect(),delete this.sources_[t]),e},t.frequency$=function(e,i){var o=this;if(void 0===i&&(i=64),i%2==1)throw i;var a=new Uint8Array(i/2);if(this.context){var s=this.analyser;if(s)s.fftSize=i,this.addSource(e).connect(s);var c=new n.BehaviorSubject(a);return t.frame$.pipe(r.withLatestFrom(c),r.map((function(t){t[0];var e=t[1];return s&&s.getByteFrequencyData(e),e})),r.tap((function(t){return c.next(t)})),r.finalize((function(){o.removeSource(e)})))}return n.of(a)},t.volume$=function(e){var i=this,o={volume:0,clipped:!1};if(this.context){var a=this.addSource(e),s=t.audioMeterCreate();a.connect(s);var c=new n.BehaviorSubject(o);return t.frame$.pipe(r.withLatestFrom(c),r.map((function(t){t[0];var e=t[1];return e.clipped=s.checkClipping(),e.volume=s.volume,e})),r.tap((function(t){return c.next(t)})),r.finalize((function(){i.removeSource(e)})))}return n.of(o)},t.audioMeterCreate=function(t,e,n){void 0===t&&(t=.98),void 0===e&&(e=.95),void 0===n&&(n=750);var r=this.context;if(r){var i=r.createScriptProcessor(512);return i.onaudioprocess=this.audioMeterProcess,i.checkClipping=this.audioMeterClip,i.dispose=this.audioMeterDispose,i.clipping=!1,i.lastClip=0,i.volume=0,i.clipLevel=t,i.averaging=e,i.clipLag=n,i.connect(r.destination),i}},t.audioMeterProcess=function(t){for(var e,n=t.inputBuffer.getChannelData(0),r=n.length,i=0,o=0;o<r;o++)e=n[o],Math.abs(e)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),i+=e*e;var a=Math.sqrt(i/r);this.volume=Math.max(a,this.volume*this.averaging)},t.audioMeterClip=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},t.audioMeterDispose=function(){this.disconnect(),this.onaudioprocess=null},t.step$=function(t){return n.Observable.create((function(e){requestAnimationFrame((function(n){var r=t?(n-t.startTime)/1e3:0;e.next({startTime:n,deltaTime:r})}))})).pipe(r.map((function(t){return t.deltaTime>1/30&&(t.deltaTime=1/30),t})))},t.dispose=function(){var t=this;Object.keys(this.sources_).forEach((function(e){t.removeSourceKey(e)}));var e=this.analyser;e&&e.disconnect(),this.sources_={}},c(t,null,[{key:"context",get:function(){return!this.context_&&"AudioContext"in window&&(this.context_=new AudioContext),this.context_}},{key:"analyser",get:function(){if(!this.analyser_)try{this.analyser_=this.context.createAnalyser()}catch(t){console.log("AudioStreamService.analyser",t)}return this.analyser_}}]),t}();rr.sources_={},rr.frame$=n.of(void 0).pipe(r.expand((function(t){return rr.step$(t)})),r.filter((function(t){return void 0!==t})),r.map((function(t){return t.deltaTime})),r.share());var ir=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){this.init()},i.init=function(){if(!this.initialized_){this.initialized_=!0,this.platform=Dn.platform;var e=t.getContext(this).node;this.onLoadedMetadata=this.onLoadedMetadata.bind(this),(this.preview=e.querySelector("video")).addEventListener("loadedmetadata",this.onLoadedMetadata);var n=e.querySelector(".audio");if(this.hasPreview)this.bars=new Array(32).fill(0).map((function(t){var e=document.createElement("div");return e.classList.add("bar"),n.appendChild(e),e}))}},i.onDestroy=function(){this.preview.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.hasPreview&&rr.dispose()},i.initStream=function(){var e=this,n=this.preview;if(this.preview){var r=t.getContext(this).node;if(this.video_||this.audio_){if(r.classList.add("ready"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var i=Ae(zt.state),o={video:!!this.video_&&{deviceId:this.video_,width:{ideal:i.resolution.width},height:{ideal:i.resolution.height},frameRate:{ideal:i.frameRate.min,max:i.frameRate.max}},audio:!!this.audio_&&{deviceId:this.audio_}};this.platform===Bn&&(o.video.facingMode="user"),navigator.mediaDevices.getUserMedia(o).then((function(t){e.hasPreview?("srcObject"in n?n.srcObject=t:n.src=window.URL.createObjectURL(t),e.audio_&&e.analyzeData(t),e.loadingStream_=t):e.stream.next(t)})).catch((function(t){console.log("AgoraDevicePreviewComponent.initStream.error",t.name,t.message),e.stream.next(null)}))}}else r.classList.remove("ready"),this.hasPreview&&("srcObject"in n?n.srcObject=null:n.src=null,this.analyzeData(null)),this.stream.next(null)}},i.onLoadedMetadata=function(e){t.getContext(this).node.classList.add("loaded"),this.preview.play(),this.stream.next(this.loadingStream_)},i.analyzeData=function(t){var e=this;this.frequencySubscription&&this.frequencySubscription.unsubscribe(),t&&(this.frequencySubscription=rr.frequency$(t,64).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.bars.forEach((function(e,n){var r=Math.min(100,5+t[n])/100;e.style.left=3.125*n+"%",e.style.transform="scale(1,"+r+")",e.style.opacity=r}))})))},c(n,[{key:"video",get:function(){return this.video_},set:function(t){this.video_!==t&&(this.video_=t,this.change&&(this.change.next(),this.init(),this.initStream()))}},{key:"audio",get:function(){return this.audio_},set:function(t){this.audio_!==t&&(this.audio_=t,this.change&&(this.change.next(),this.init(),this.initStream()))}},{key:"hasPreview",get:function(){return this.platform!==Bn&&this.platform!==Un}}]),n}(t.Component);ir.meta={selector:"[agora-device-preview]",outputs:["stream","change"],inputs:["video","audio"]};var or=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;if(this.platform=Dn.platform,this.isHttps="https:"===window.location.protocol,this.state={},this.devices={videos:[],audios:[]},this.stream=null,this.form=null,this.isHttps){var e=this.agora=Qn.getSingleton();zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.pushChanges()})),e&&e.devices$().subscribe((function(e){t.devices=e,t.initForm(e),t.pushChanges()}),(function(t){console.log("AgoraDeviceComponent.devices$.error",t)}))}},i.openHttps=function(t){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")},i.initForm=function(t){var n=this,i=this.form=new e.FormGroup({video:new e.FormControl(null,t.videos.length?e.Validators.RequiredValidator():void 0),audio:new e.FormControl(null,t.audios.length?e.Validators.RequiredValidator():void 0)}),o=this.controls=i.controls,a=t.videos.map((function(t){return{id:t.deviceId,name:t.label}}));a.length>0&&a.unshift({id:null,name:"bhere_select_video"}),o.video.options=a;var s=t.audios.map((function(t){return{id:t.deviceId,name:t.label}}));s.length>0&&s.unshift({id:null,name:"bhere_select_audio"}),o.audio.options=s,i.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){n.pushChanges()}))},i.onStreamDidChange=function(t){this.stream=null,this.pushChanges()},i.onStream=function(t){this.stream=t,this.pushChanges()},i.isValid=function(){var t=this.form.valid&&(this.stream||!this.hasPreview);return t},i.onEnter=function(t){var e=this.form.value,n=this.devices;n.video=n.videos.find((function(t){return t.deviceId===e.video})),n.audio=n.audios.find((function(t){return t.deviceId===e.audio})),this.enter.next(n)},c(n,[{key:"hasPreview",get:function(){return this.platform!==Bn&&this.platform!==Un}}]),n}(t.Component);or.meta={selector:"[agora-device]",outputs:["enter"],template:'\n\t<div class="group--info" *if="!isHttps">\n\t\t<div class="group--info__content stagger--childs">\n\t\t\t<div class="title" [innerHTML]="\'bhere_invalid_protocol\' | label"></div>\n\t\t\t<div class="info" [innerHTML]="\'bhere_reload_in_https\' | label"></div>\n\t\t\t<button type="button" class="btn--connect" (click)="openHttps($event)">\n\t\t\t\t<span [innerHTML]="\'bhere_reload\' | label"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onEnter($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\x3c!-- PREVIEW --\x3e\n\t\t\t<div class="agora-device-preview" agora-device-preview [video]="controls.video.value" [audio]="controls.audio.value" (stream)="onStream($event)" (change)="onStreamDidChange($event)" *if="this.hasPreview">\n\t\t\t\t<video class="video" muted></video>\n\t\t\t\t<div class="audio"></div>\n\t\t\t</div>\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\x3c!-- VIDEO --\x3e\n\t\t\t\t<div control-custom-select [control]="controls.video" label="Video" *if="devices.videos.length"></div>\n\t\t\t\t\x3c!-- AUDIO --\x3e\n\t\t\t\t<div control-custom-select [control]="controls.audio" label="Audio" *if="devices.audios.length"></div>\n\t\t\t\t<div class="info" *if="!isValid()" [innerHTML]="\'bhere_select_video_audio\' | label"></div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_video_audio_connected\' | label"></div>\n\t\t\t\t<button type="submit" class="btn--connect" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t\t\t\t<span *if="!state.connecting" [innerHTML]="\'bhere_enter\' | label"></span>\n\t\t\t\t\t<span *if="state.connecting" [innerHTML]="\'bhere_connecting\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};var ar=function(){function t(t){t&&Object.assign(this,t),this.items=this.items||[],this.originalItems=this.items.slice()}return c(t,[{key:"payload",get:function(){var t=this,e={};return Object.keys(this).forEach((function(n){-1!==View.allowedProps.indexOf(n)&&(e[n]=t[n])})),e}}]),t}();function sr(t){return t=new ar(t)}u(ar,"allowedProps",["id","name","items"]);var cr={id:null,name:"Principale",items:[]},ur=function(){function t(){}return t.getCurrentPath$=function(t){var e=this;return void 0===t&&(t=null),this.pathGet$().pipe(r.switchMap((function(n){e.paths=n;var r=cr;if(t){var i=n.find((function(e){return e.id===t}));i&&(r=i)}return e.path=r,e.path$})))},t.pathGet$=function(){return de.flags.usePaths?xn.get$("/api/path").pipe(r.map((function(t){return t.paths=t.paths.map((function(t){return sr(t)})),t.paths.unshift(cr),t.paths}))):of([])},t.addPath=function(t){var e=this.paths.slice();e.push(t),this.paths=e,this.path=t},t.editPath=function(t){var e=this.paths.slice(),n=e.reduce((function(e,n,r){return n.id===t.id?r:e}),-1);if(n>0){var r=this.path;r.id===t.id&&(r=t),e.splice(n,1,t),this.paths=e,this.path=r}},t.deletePath=function(t){var e=this.paths.slice(),n=e.indexOf(t);if(n>0){e.splice(n,1),this.paths=e;var r=this.path;r.id===t.id&&(r=e[0]),this.path=r}},t.pathCreate$=function(t){return xn.post$("/api/path",t).pipe(r.map((function(t){return sr(t)})))},t.pathUpdate$=function(t){return xn.put$("/api/path/"+t.id,t).pipe(r.map((function(t){return sr(t)})))},t.pathDelete$=function(t){return xn.delete$("/api/path/"+t.id)},c(t,null,[{key:"paths",set:function(t){this.paths$.next(t)},get:function(){return this.paths$.getValue()}},{key:"path",set:function(t){this.path$.next(t)},get:function(){return this.path$.getValue()}}]),t}();u(ur,"paths$",new n.BehaviorSubject([cr])),u(ur,"path$",new n.BehaviorSubject(cr));var lr=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.state={},this.paths=[],this.pathId=null,this.form=null,zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.pushChanges()})),de.flags.usePaths?ur.getCurrentPath$().pipe(r.first(),r.tap(),r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.paths=ur.paths,t.pathId=e.id||"",t.onLoad()})):this.onLoad()},i.onLoad=function(){var t=this,n=this.form=new e.FormGroup({path:this.pathId,id:new e.FormControl(null,[e.Validators.PatternValidator(Kt),e.Validators.RequiredValidator()]),idAttendee:null,idStreamer:null,idViewer:null,idSmartDevice:null}),i=this.controls=n.controls,o=this.paths.map((function(t){return{id:t.id||"",name:t.name}}));o.length>0&&o.unshift({id:null,name:"bhere_select_path"}),i.path.options=o,n.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.pathId!==e.path&&null!==e.id&&(t.pathId=e.path,t.onGenerateMeetingId()),t.pushChanges()}))},i.onGenerateMeetingId=function(t){var e=this.pathId?String(this.pathId):null;e=e&&e.length?e:null;var n=new Xt({pathId:e}).toRoles();this.form.patch(n)},i.onInputDidChange=function(t){var e=this;"publisher"===this.state.role&&setTimeout((function(){if(e.form.get("id").valid){var t=e.form.get("id").value,n=new Xt(t).toRoles();e.form.patch(n)}else e.form.get("idAttendee").reset(),e.form.get("idStreamer").reset(),e.form.get("idViewer").reset(),e.form.get("idSmartDevice").reset()}),1)},i.onCopyToClipBoard=function(t,e){void 0===e&&(e=!1),new Jt({link:t}).copyToClipBoard(e)},i.onNext=function(t){var e=this.controls.id.value;Jt.replaceWithLink(e),this.link.next(e)},i.isValid=function(){var t=this.form.valid;return t},c(n,[{key:"selfServiceTourRoute",get:function(){var t=this.form.get("path").value,e=[me.transform(":lang.selfServiceTour")];return t&&e.push({pathId:t}),e}}]),n}(t.Component);lr.meta={selector:"[agora-link]",outputs:["link"],template:'\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onNext($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t<div class="stagger--childs" *if="state.role !== \'publisher\'">\n\t\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.id.validators.length, \'addon\': controls.id.valid }">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_insert_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.id" [placeholder]="\'bhere_meeting_id\' | label" />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.id.value)" *if="controls.id.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="stagger--childs" *if="state.role === \'publisher\'">\n\t\t\t\t\t\x3c!-- PATH --\x3e\n\t\t\t\t\t<div control-custom-select [control]="controls.path" [label]="\'bhere_path\' | label" *if="(\'usePaths\' | flag) && paths.length"></div>\n\t\t\t\t\t\x3c!--IDS --\x3e\n\t\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.id.validators.length, \'addon\': controls.id.valid }">\n\t\t\t\t\t\t<label><svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg> <span [innerHTML]="\'bhere_insert_meeting_id\' | label"></span></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.id" [placeholder]="\'bhere_meeting_id\' | label" (change)="onInputDidChange($event)" />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.id.value)" *if="controls.id.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'attendee\' | flag) && controls.idAttendee.valid && controls.idAttendee.value !== null">\n\t\t\t\t\t\t<label><svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg> <span [innerHTML]="\'bhere_attendee_meeting_id\' | label"></span></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idAttendee" [placeholder]="\'bhere_attendee_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idAttendee.value)" *if="controls.idAttendee.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'streamer\' | flag) && controls.idStreamer.valid && controls.idStreamer.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_streamer_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idStreamer" [placeholder]="\'bhere_streamer_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idStreamer.value)" *if="controls.idStreamer.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'viewer\' | flag) && controls.idViewer.valid && controls.idViewer.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_viewer_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idViewer" [placeholder]="\'bhere_viewer_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idViewer.value)" *if="controls.idViewer.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'smartDevice\' | flag) && controls.idSmartDevice.valid && controls.idSmartDevice.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_smart_device_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idSmartDevice" [placeholder]="\'bhere_smart_device_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idSmartDevice.value, true)" *if="controls.idSmartDevice.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="controls.id.errors.required" [innerHTML]="\'bhere_insert_meeting_id\' | label"></div>\n\t\t\t\t<div class="info" *if="controls.id.errors.pattern" [innerHTML]="\'bhere_invalid_meeting_id\' | label"></div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_take_part_meeting\' | label"></div>\n\t\t\t\t<button type="button" class="btn--generate" *if="state.role == \'publisher\'" (click)="onGenerateMeetingId($event)">\n\t\t\t\t\t<span [innerHTML]="\'bhere_generate_meeting_id\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_take_part\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<a [routerLink]="selfServiceTourRoute" class="btn--secondary" *if="state.role === \'publisher\'">\n\t\t\t\t\t<span [innerHTML]="\'bhere_self_service\' | label"></span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t<a [routerLink]="\':lang.editor\' | route" class="btn--absolute" *if="(\'editor\' | flag) && !(\'heroku\' | flag) && state.role == \'publisher\'">\n\t\t<span [innerHTML]="\'bhere_editor\' | label"></span> <svg class="edit" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#edit"></use></svg>\n\t</a>\n\t'};var dr=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this,n=this.form=new e.FormGroup({username:new e.FormControl(null,e.Validators.RequiredValidator()),password:new e.FormControl(null,e.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=n.controls;n.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.pushChanges()})),this.error=null},i.test=function(){this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""})},i.reset=function(){this.form.reset()},i.onSubmit=function(){var t=this;if(this.form.valid){var e=this.form.value;this.form.submitted=!0,this.error=null,this.pushChanges(),Rn.login$(e).pipe(r.first()).subscribe((function(e){zt.state.role===e.type?(t.onNext(e),t.form.reset()):(t.error={friendlyMessage:pe.transform("error_credentials")},t.pushChanges())}),(function(e){console.log("AccessComponent.error",e),t.error=e,t.pushChanges()}))}else this.form.touched=!0},i.isValid=function(){var t=this.form.valid;return t},i.onNext=function(t){Jt.replaceWithUser(t),this.login.next(t)},n}(t.Component);dr.meta={selector:"[agora-login]",outputs:["login"],template:'\n\t<div class="group--info">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t<div class="title" [innerHTML]="\'bhere_login\' | label"></div>\n\t\t\t\t<input name="checkField" [formControl]="controls.checkField" value="" type="text" style="display:none !important;" />\n\t\t\t\t<div control-text [control]="controls.username" [label]="\'bhere_username\' | label"></div>\n\t\t\t\t<div control-password [control]="controls.password" [label]="\'bhere_password\' | label"></div>\n\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_cta\' | label"></div>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_cta\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};var hr=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this,n=(new Jt).name;this.state={};var i=this.form=new e.FormGroup({name:new e.FormControl(n,[e.Validators.PatternValidator(/^\w{2,}\s\w{2,}/),e.Validators.RequiredValidator()])});this.controls=i.controls;i.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.pushChanges()})),zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.pushChanges()}))},i.isValid=function(){var t=this.form.valid;return t},i.onNext=function(t){var e=this.controls.name.value;Jt.replaceWithName(e),this.name.next(e)},n}(t.Component);hr.meta={selector:"[agora-name]",outputs:["name"],template:'\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onNext($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\x3c!-- NAME --\x3e\n\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.name.validators.length }">\n\t\t\t\t\t<label [innerHTML]="\'bhere_fill_fullname\' | label"></label>\n\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.name" [placeholder]="\'bhere_name_and_surname\' | label" />\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="!controls.name.valid" [innerHTML]="\'bhere_fill_name_and_surname\' | label"></div>\n\t\t\t\t<div class="info" *if="isValid()">prosegui come <span [innerHTML]="controls.name.value"></span></div>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_proceed\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};var fr=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var t=this;this.videoMuted=!1,this.audioMuted=!1,this.shouldUseResumeGesture=!1,this.state={},zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.pushChanges()})),Ln.out$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case Re:var n=e.event;t.streamId&&n.streamId===t.streamId&&(n instanceof En&&(t.videoMuted=!0),n instanceof _n&&(t.videoMuted=!1),n instanceof Sn&&(t.audioMuted=!0),n instanceof Tn&&(t.audioMuted=!1));break;case an:t.streamId===e.clientId&&(t.vrContainer=e.container);break;case sn:t.streamId===e.clientId&&(t.vrContainer=null)}}))},i.setMediaStream=function(t){var e=this.videoNode;"srcObject"in e?e.srcObject=t:e.src=t?window.URL.createObjectURL(t):null},i.onLoadedMetadata=function(t){this.videoNode.play().then((function(t){}),(function(t){console.log("AgoraStreamComponent.play.error",t)}))},i.onToggleControl=function(t){this.toggleControl.next(t)},i.onToggleSpy=function(t){this.toggleSpy.next(t)},c(n,[{key:"videoMuted",set:function(e){if(this.videoMuted_!==e){this.videoMuted_=e;var n=t.getContext(this).node;e?n.classList.add("video--muted"):n.classList.remove("video--muted")}}},{key:"audioMuted",set:function(e){if(this.audioMuted_!==e){this.audioMuted_=e;var n=t.getContext(this).node;e?n.classList.add("audio--muted"):n.classList.remove("audio--muted")}}},{key:"streamId",get:function(){return this.streamId_},set:function(t){this.streamId_=t}},{key:"stream",get:function(){return this.stream_},set:function(e){if(this.stream_!==e){for(var n=t.getContext(this).node,r=this.player=n.querySelector(".agora-stream__player");r.childElementCount>0;)r.removeChild(r.firstElementChild);this.stream_&&this.stream_.isPlaying()&&this.stream_.player.div.parentNode===r&&(console.log("AgoraStreamComponent stopping stream",this.stream_.getId(),"on",this.stream_.player.div.parentNode),this.stream_.stop()),this.stream_=e,e&&(this.videoMuted=e.userMuteVideo,this.audioMuted=e.userMuteAudio);var i=e?e.getId():null;if(this.streamId=i,i){var o="stream-"+i;r.setAttribute("id",o);var a=this;e.isPlaying()?r.appendChild(e.player.div):(this.shouldUseResumeGesture=!1,e.play(o,{fit:"cover"},(function(t){t&&"aborted"!==t.status&&(a.shouldUseResumeGesture=!0,a.pushChanges())})))}else r.removeAttribute("id")}}},{key:"vrContainer",set:function(t){this.vrContainer_!==t&&(this.vrContainer_=t,t?(this.stream_.vrContainer=t,this.player.appendChild(t)):this.stream_.vrContainer&&this.stream_.vrContainer.parentNode&&(this.stream_.vrContainer.parentNode.removeChild(this.stream_.vrContainer),this.stream_.vrContainer=null))}},{key:"videoNode",get:function(){var e=this.videoNode_;if(!e){var n=t.getContext(this).node.querySelector(".agora-stream__player");e=document.createElement("video"),this.onLoadedMetadata=this.onLoadedMetadata.bind(this),e.addEventListener("loadedmetadata",this.onLoadedMetadata),n.appendChild(e),this.videoNode_=e}return e}}]),n}(t.Component);fr.meta={selector:"[agora-stream]",outputs:["toggleControl","toggleSpy"],inputs:["stream"]};var pr={WaitingRoom:{id:1,name:"waiting-room"},Panorama:{id:2,name:"panorama"},PanoramaGrid:{id:3,name:"panorama-grid"},Room3d:{id:4,name:"room-3d"},Model:{id:5,name:"model"},Media:{id:6,name:"media"}},vr={Nav:{id:1,name:"nav"},Plane:{id:2,name:"plane"},CurvedPlane:{id:3,name:"curved-plane"},Model:{id:4,name:"model"},Texture:{id:5,name:"texture"}},mr=function(){function t(t){t&&(Object.assign(this,t),this.updateIndices(t.items)),this.items=(this.items||[]).filter((function(t){return function(t){var e;switch(t.type.name){case vr.Nav.name:e=null==t.viewId||function(t){return!Rr(t.title)&&!Rr(t.abstract)}(t)||zt.state.navigable;break;default:e=!0}return e}(t)})).map((function(t){return Cr(t)})),this.tiles&&(this.tiles=this.tiles.map((function(t){return xr(t)}))),this.originalItems=this.items.slice(),this.lastOrientation={latitude:0,longitude:0}}return t.prototype.updateIndices=function(t){if(t){var e=0,n=0,r=0,i=0,o=0;t.forEach((function(t,a){if(t.index=a,t.asset)switch(t.asset.file){case"publisherStream":t.asset.index=e++;break;case"nextAttendeeStream":t.asset.index=n++;break;case"smartDeviceStream":t.asset.index=r++;break;case"publisherScreen":t.asset.index=i++;break;case"attendeeScreen":t.asset.index=o++}}))}},c(t,[{key:"payload",get:function(){var e=this,n={};return Object.keys(this).forEach((function(r){if(-1!==t.allowedProps.indexOf(r))switch(r){case"items":n[r]=e[r].map((function(t){return Cr(t).payload}));break;case"tiles":n[r]=e[r].map((function(t){return xr(t).payload}));break;default:n[r]=e[r]}})),n}},{key:"pathItems",get:function(){return this.items.filter((function(t){return t.path}))}},{key:"shortType",get:function(){return this.type?this.type.split("-").map((function(t){return t.substring(0,1).toUpperCase()})).join(""):"??"}}]),t}();u(mr,"allowedProps",["id","type","name","hidden","likes","asset","items","orientation","zoom","ar","tiles","invertAxes","flipAxes"]);var gr=function(t){function e(e){return t.call(this,e)||this}return d(e,t),e}(mr),Ar=function(t){function e(r){var i;return r.tiles=e.mapTiles(r.tiles,r.flipAxes,r.invertAxes,r.asset?r.asset.folder:""),(i=t.call(this,r)||this).index_=0,i.index$=new n.Subject,i.tiles.forEach((function(t,e){return t.selected=0===e})),i.tiles.length&&(i.items=i.originalItems.concat(i.tiles[0].navs),i.asset=i.tiles[0].asset),i}d(e,t),e.mapTiles=function(t,e,n,r){void 0===t&&(t=[]),void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===r&&(r="");var i=e?-1:1;return t.map((function(t,e){var o=new THREE.Vector2;return(t="string"==typeof t?{id:e+1,asset:{folder:r,file:t},navs:[]}:t).asset.file.replace(/_x([-|\d]+)_y([-|\d]+)/g,(function(t,e,r){n?(o.y=parseInt(e),o.x=parseInt(r)*i):(o.x=parseInt(e),o.y=parseInt(r)*i)})),{id:t.id,type:Object.assign({},pr.PanoramaGrid),asset:t.asset,navs:t.navs||[],indices:o}}))},c(e,[{key:"index",set:function(t){this.index_!==t&&(this.index_=t,this.tiles.forEach((function(e,n){return e.selected=n===t})),this.updateCurrentItems(),this.index$.next(t))},get:function(){return this.index_}}]);var r=e.prototype;return r.updateCurrentItems=function(){this.items=this.originalItems.concat(this.tiles[this.index_].navs)},r.getTileIndex=function(t,e){return this.tiles.reduce((function(n,r,i){return r.indices.x===t&&r.indices.y===e?i:n}),-1)},r.hasTile=function(t,e){return-1!==this.getTileIndex(t,e)},r.getTile=function(t,e){var n=this.getTileIndex(t,e);if(-1!==n)return this.index=n,this.tiles[n]},e}(mr),yr=function(t){function e(e){return t.call(this,e)||this}return d(e,t),e}(mr),br=function(t){function e(e){return t.call(this,e)||this}return d(e,t),e}(mr),wr=function(t){function e(e){return t.call(this,e)||this}return d(e,t),e}(mr),Er=function(){function t(t){t&&Object.assign(this,t)}return c(t,[{key:"payload",get:function(){var e=this,n={};return Object.keys(this).forEach((function(r){-1!==t.allowedProps.indexOf(r)&&(n[r]=e[r])})),!n.link||n.link.title&&n.link.href||delete n.link,n}},{key:"hasPanel",get:function(){return this.type.name===vr.Nav.name&&(this.title&&""!==this.title||this.abstract&&""!==this.abstract||this.asset||this.link)}}]),t}();u(Er,"allowedProps",["id","type","title","abstract","asset","link","viewId","hook","hookExtra","keepOrientation","important","transparent","position","rotation","scale","radius","height","arc"]);var _r=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(Er),Sr=function(){function t(t){t&&Object.assign(this,t),this.navs=(this.navs||[]).map((function(t){return Cr(t)})),this.originalItems=this.navs.slice()}return c(t,[{key:"payload",get:function(){var e=this,n={};return Object.keys(this).forEach((function(r){if(-1!==t.allowedProps.indexOf(r))switch(r){case"navs":n[r]=e[r].map((function(t){return Cr(t).payload}));break;default:n[r]=e[r]}})),n}}]),t}();function Tr(t){switch(t.type.name){case pr.Panorama.name:t=new gr(t);break;case pr.PanoramaGrid.name:t=new Ar(t);break;case pr.Room3d.name:t=new yr(t);break;case pr.Model.name:t=new br(t);break;case pr.Media.name:t=new wr(t);break;default:t=new mr(t)}return t}function Cr(t){switch(t.type.name){case vr.Nav.name:t=new _r(t);break;default:t=new Er(t)}return t}function xr(t){return new Sr(t)}function Rr(t){return t&&t.length>0}u(Sr,"allowedProps",["id","asset","navs"]);var Ir=function(){function t(t){t&&Object.assign(this,t),this.items=(this.items||[]).map((function(t){return Cr(t)})),this.originalItems=this.items.slice()}return c(t,[{key:"payload",get:function(){var t=this,e={};return Object.keys(this).forEach((function(n){if(-1!==View.allowedProps.indexOf(n))switch(n){case"items":e[n]=t[n].map((function(t){return Cr(t).payload}));break;default:e[n]=t[n]}})),e}}]),t}();function Or(t){return t=new Ir(t)}u(Ir,"allowedProps",["id","name","asset","items"]);var Mr=function(){function t(){}return t.navmapGet$=function(){return xn.get$("/api/navmap").pipe(r.map((function(t){return t.navmaps.map((function(t){return Or(t)})),t.navmaps})))},t.navmapCreate$=function(t){return xn.post$("/api/navmap",t).pipe(r.map((function(t){return Or(t)})))},t.navmapUpdate$=function(t){return xn.put$("/api/navmap/"+t.id,t).pipe(r.map((function(t){return Or(t)})))},t.navmapDelete$=function(t){return xn.delete$("/api/navmap/"+t.id)},t.itemCreate$=function(t,e){return xn.post$("/api/navmap/"+t.id+"/item",e).pipe(r.map((function(t){return Cr(t)})))},t.itemUpdate$=function(t,e){return e=Cr(e),xn.put$("/api/navmap/"+t.id+"/item/"+e.id,e.payload).pipe(r.map((function(t){return Cr(t)})))},t.itemDelete$=function(t,e){return xn.delete$("/api/navmap/"+t.id+"/item/"+e.id)},c(t,null,[{key:"active",set:function(t){this.active$.next(t)},get:function(){return this.active$.getValue()}}]),t}();u(Mr,"active$",new n.BehaviorSubject(!1));var Lr=function(){function t(){}return t.push=function(t){return function(t){(window.dataLayer||[]).push(t),console.log("GtmService.dataLayer",t)}(t)},t}(),kr="info",Br="alert",Nr="dialog",Pr="centered",Ur="bottom-right",Dr=function(t){this.toast=t},Fr=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(Dr),Hr=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(Dr),jr=function(){function t(){}return t.open$=function(t){var e=this;switch(t.id=(new Date).getTime(),t.type=t.type||kr,t.position=t.position||Pr,t.type){case Br:t.acceptMessage=t.acceptMessage||"Ok";break;case Nr:t.acceptMessage=t.acceptMessage||"Accept",t.rejectMessage=t.rejectMessage||"Reject"}return this.toast$.next(t),t.type===kr&&setTimeout((function(){e.resolve(t)}),t.duration||4e3),this.events$},t.resolve=function(t){this.toast$.next(null),this.events$.next(new Fr(t))},t.reject=function(t){this.toast$.next(null),this.events$.next(new Hr(t))},t}();jr.toast$=new n.Subject,jr.events$=new n.Subject;var Vr=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var e=this;this.busy_=!1;var n=t.getContext(this).node;this.modalNode=n.querySelector(".modal-outlet__modal"),Yn.modal$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.modal=t})),Yn.busy$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.busy=t}))},i.reject=function(t){Yn.reject()},c(n,[{key:"modal",get:function(){return this.modal_},set:function(e){var n=t.getContext(this).module;if(this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),e&&e.node){this.modal_=e,this.modalNode.appendChild(e.node);n.compile(e.node)}this.modal_=e,this.pushChanges()}},{key:"busy",get:function(){return this.busy_},set:function(t){this.busy_!==t&&(this.busy_=t,this.pushChanges())}}]),n}(t.Component);Vr.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal, busy: busy }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t\t\x3c!-- spinner --\x3e\n\t\t<div class="spinner spinner--contrasted" *if="busy"></div>\n\t</div>\n\t'};var Gr=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){e.prototype.onInit.call(this);var r=t.getContext(this),i=r.parentInstance,o=r.node;if(i instanceof Vr){var a=this.data=i.modal.data;if(a&&a.ar){var s=n.getUrl(a);new QRious({element:o.querySelector(".qrcode"),value:s,size:256})}}},r.onClose=function(){Yn.reject()},n.getUrl=function(t){var e=de.getAbsoluteUrl(de.template.tryInAr,{viewId:t.id});return console.log("TryInARModalComponent.getUrl",e),e},n.openInAR=function(t){var e=this.getUrl(t);window.open(e,"_blank")},n}(t.Component);Gr.meta={selector:"[try-in-ar-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Inquadra il qrcode con il cellulare o il tablet per vedere il VR.</div>\n\t\t\t\t<div class="picture">\n\t\t\t\t\t<canvas class="qrcode"></canvas>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onClose()">\n\t\t\t\t\t\t<span>Chiudi</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Gr.chunk=function(){return'<div class="try-in-ar-modal" try-in-ar-modal></div>'};var Qr=["jpeg","jpg","png","hdr"],zr=["mp4","webm"],qr=["fbx","gltf","glb","usdz"],Wr={Image:{id:1,name:"image"},Video:{id:2,name:"video"},Model:{id:3,name:"model"},PublisherStream:{id:4,name:"publisher-stream",file:"publisherStream"},AttendeeStream:{id:5,name:"next-attendee-stream",file:"nextAttendeeStream"},PublisherScreen:{id:6,name:"publisher-screen",file:"publisherScreen"},AttendeeScreen:{id:7,name:"attendee-screen",file:"attendeeScreen"},SmartDeviceStream:{id:8,name:"smart-device-stream",file:"smartDeviceStream"}},Kr={ImageOrVideo:{id:1,name:"Image or Video",ids:[1,2]},Publisher:{id:3,name:"Publisher",ids:[4]},Attendee:{id:4,name:"Attendee",ids:[5]}};de.flags.editorAssetScreen&&(Kr.PublisherScreen={id:5,name:"PublisherScreen",ids:[6]},Kr.AttendeeScreen={id:6,name:"AttendeeScreen",ids:[7]}),Kr.SmartDevice={id:7,name:"Smart Device",ids:[8]};var Xr=[Wr.PublisherStream.name,Wr.AttendeeStream.name,Wr.PublisherScreen.name,Wr.AttendeeScreen.name,Wr.SmartDeviceStream.name];function Jr(t){return t&&-1!==Xr.indexOf(t.type.name)}function Yr(t){var e;return t&&t.asset&&(e=Object.keys(Kr).find((function(e){return-1!==Kr[e].ids.indexOf(t.asset.type.id)}))),Kr[e||"ImageOrVideo"]}function $r(t){var e,n=function(t){return Object.keys(Wr).reduce((function(e,n){var r=Wr[n];return r.id===t?r:e}),null)}((e=t,Object.keys(Kr).reduce((function(t,n){var r=Kr[n];return r.id===e?r:t}),null)).ids[0]),r=n.file;return new ti({type:n,folder:"",file:r})}function Zr(t){var e=t.split(".").pop().toLowerCase();return-1!==Qr.indexOf(e)?Wr.Image:-1!==zr.indexOf(e)?Wr.Video:-1!==qr.indexOf(e)?Wr.Model:void 0}var ti=function(){function t(t){t&&Object.assign(this,t)}return t.fromUrl=function(e){var n=e.split("/"),r=n.pop(),i=n.join("/")+"/";return new t({type:Zr(r),folder:i,file:r})},c(t,[{key:"payload",get:function(){var e=this,n={};return Object.keys(this).forEach((function(r){-1!==t.allowedProps.indexOf(r)&&(n[r]=e[r])})),n}}],[{key:"defaultMediaAsset",get:function(){return{id:-1,type:{id:Wr.Image,name:"image"},folder:"/textures/grid/",file:"grid.jpg"}}}]),t}();function ei(t){return t.type.name,t=new ti(t)}u(ti,"allowedProps",["id","type","folder","file","linkedPlayId","chromaKeyColor","autoplay","loop"]);var ni={id:"waiting-room",type:{id:1,name:"waiting-room"},name:"Waiting Room",likes:0,liked:!1,asset:{type:{id:1,name:"image"},folder:"/textures/waiting-room/",file:"waiting-room.jpg"},items:[],orientation:{latitude:0,longitude:0}},ri=function(){function t(){}return t.getDataView=function(t){return this.dataViews.find((function(e){return e.id===t}))},t.getValidPathId=function(t){return t?null==this.validPathViews.find((function(e){return e.id===t}))?null:t:null},t.getFirstPathId=function(){var t=this.editor&&null===this.path.id?this.dataViews:this.pathViews;return t.length?t[0].id:null},t.data$=function(){var t=this;if(!this.data$_){var e=(de.flags.production?"/api/view":"./api/data.json")+"?lang="+ve.selectedLanguage;this.data$_=xn.get$(e).pipe(r.map((function(e){e.views=e.views.map((function(t){return Tr(t)})),t.data=e;var n=e.views;return t.views=n,e})),r.shareReplay(1))}return this.data$_},t.view$=function(){var t=this,e=new Jt,n=this.getValidPathId(e.viewId),i=this.getValidPathId(e.embedViewId)||n||this.getFirstPathId();return this.action$_.next({viewId:i}),this.action$_.pipe(r.distinctUntilChanged((function(t,e){return t.viewId===e.viewId})),r.map((function(e){var n=t.dataViews.find((function(t){return t.id===e.viewId}));return n&&(n.keepOrientation=e.keepOrientation||!1,n.useLastOrientation=e.useLastOrientation||!1),n||t.getWaitingRoom()})))},t.setDataAndPath=function(t,e){this.data=t,t.views.forEach((function(t){t.path=!e||-1===e.items.indexOf(t.id),t.items.forEach((function(t){var n=!0;e&&(t.type.name===vr.Nav.name&&(n=-1===e.items.indexOf(t.viewId)),t.path=n)}))})),this.views=t.views,this.path=e},t.hostedView$=function(e,i){var o=this;this.setDataAndPath(e,i),this.editor=!1;var a=this.getWaitingRoom();return n.combineLatest([this.view$(),this.hosted$()]).pipe(r.map((function(t){var e=t[0];return t[1]?e:a})),r.distinctUntilChanged((function(t,e){return t.id===e.id})),r.tap((function(e){if(o.view=e,e.id!==a.id){C.set("viewId",e.id);var n=t.getPrefetchAssets(e);e.prefetchAssets=n}})))},t.editorView$=function(t,e){var n=this;this.setDataAndPath(t,e),this.editor=!0;var i=this.getWaitingRoom();return this.view$().pipe(r.map((function(t){return n.view=t,t.id!==i.id&&C.set("viewId",t.id),e&&null!==e.id?C.set("pathId",e.id):C.delete("pathId"),t})))},t.hosted$=function(){return zt.state$.pipe(r.map((function(t){return t.hosted})),r.distinctUntilChanged())},t.viewById$=function(t){var e=this;return this.data$().pipe(r.map((function(n){return e.views.find((function(e){return e.id===t}))})))},t.viewLike$=function(t){return t.liked?n.of(null):(t.liked=!0,de.flags.production?xn.get$("/api/view/"+t.id+"/like"):(t.likes=t.likes||0,t.likes++,n.of(t)))},t.setViewLike$=function(t){return this.viewById$(t.viewId).pipe(r.tap((function(e){e&&(e.likes=t.likes)})))},t.getWaitingRoom=function(){return this.dataViews.find((function(t){return t.type.name===pr.WaitingRoom.name}))||ni},t.getPrefetchAssets=function(t){var e=this.views;return t.items.filter((function(t){return t.type.name===vr.Nav.name&&null!=t.viewId})).map((function(t){return e.find((function(e){return e.id===t.viewId}))})).filter((function(t){return t&&t.asset&&t.asset.type.name===Wr.Image.name})).map((function(t){return de.getPath(t.asset.folder+t.asset.file)}))},t.addView=function(t){var e=this.data,n=e.views.slice();n.push(t),e.views=n,this.views=n,this.viewId=t.id},t.deleteView=function(e){var n=this.data,r=n.views.slice(),i=r.reduce((function(t,n,r){return n.id===e.id?r:t}),-1);i>0&&(r.splice(i,1),n.paths=r),t.viewId=this.dataViews[0].id},c(t,null,[{key:"views",set:function(t){this.views$_.next(t)},get:function(){return this.views$_.getValue()}},{key:"view",set:function(t){this.view$_.next(t)},get:function(){return this.view$_.getValue()}},{key:"dataViews",get:function(){return this.data?this.data.views:[]}},{key:"validViews",get:function(){return this.data?this.data.views.filter((function(t){return t.type.name!==pr.WaitingRoom.name})):[]}},{key:"pathViews",get:function(){return this.validViews.filter((function(t){return t.path}))}},{key:"validPathViews",get:function(){return(this.editor?this.data.views:this.validViews).filter((function(t){return t.path}))}},{key:"action",set:function(t){this.action$_.next(t)},get:function(){return this.action$_.getValue()}},{key:"viewId",set:function(t){this.action$_.next({viewId:t,keepOrientation:!1,useLastOrientation:!1})},get:function(){var t=this.action$_.getValue();return t?t.viewId:null}}]),t}();u(ri,"views$_",new n.BehaviorSubject([])),u(ri,"view$_",new n.BehaviorSubject(null)),u(ri,"action$_",new n.BehaviorSubject(null));var ii=0,oi=function(){function t(t){t&&Object.assign(this,t)}return t.prototype.toJson=function(){return JSON.stringify(this)},t.newEvent=function(e,n,r){console.log("WebhookEvent.newEvent",e,n,r);var i=new t;i.action=e,i.data=n,i.extra="string"==typeof r?JSON.parse(r):r,i.meetingId=zt.state.link,i.userSessionId=zt.state.uid,i.userRole=zt.state.role,i.fullName=zt.state.name;var o=(new Date).getTime();return i.timestamp=o,i.id=o+"-"+ ++ii,i},t.parseEvent=function(e){if(e&&"data"in e){var n="string"==typeof e.data?JSON.parse(e.data):e.data;return"action"in n?new t(n):null}return null},t}(),ai=function(){function t(){}return t.internal$_=function(t){var e=this;return n.of(t).pipe(r.tap((function(t){console.log("WebhookService.internal$_.postMessage",t),window.parent&&window.parent.postMessage(t.action,t.toJson())})),r.switchMap((function(t){return e.event$_.pipe(r.filter((function(t){return t.id==t.id})),r.first())})),r.map((function(n){return console.log("WebhookService.internal$_.handleResponse_",t,n),e.handleResponse_(t,n)})),r.catchError((function(n){return e.handleError_(t,n)})))},t.send$_=function(t,e){var n=this;xn.post$(t,e).pipe(r.map((function(t){return n.handleResponse_(e,t)})),r.catchError((function(t){return n.handleError_(e,t)})))},t.send$=function(t,e,r){var i=this;if(console.log("WebhookService.send$",t,e,r),this.enabled){var o=oi.newEvent(t,e,r),a=de.webhook.uris.map((function(t){return"internal"===t?i.internal$_(o):i.send$_(t,o)}));return n.forkJoin(a)}return n.of(n.EMPTY)},t.handleResponse_=function(t,e){console.log("WebhookService.handleResponse_",e);var n=Object.assign({},t);return n.remoteStatus=1,n.remoteResponse=e,n},t.handleError_=function(t,e){var r=Object.assign({},t);return r.remoteStatus=0,r.remoteError=e,n.of(r)},c(t,null,[{key:"enabled",get:function(){return de.webhook&&de.webhook.uris&&de.webhook.uris.length>0}}]),t}();u(ai,"event$_",n.fromEvent(window,"message").pipe(r.map((function(t){return oi.parseEvent(t)})),r.filter((function(t){return null!==t})),r.shareReplay(1)));var si=null,ci=function(){function t(){}return t.getItems=function(){return this.items$.getValue()},t.indexOf=function(t){return this.getItems().reduce((function(e,n,r){return-1===e&&n.viewId===t.viewId&&n.itemId===t.itemId?r:e}),-1)},t.has=function(t){return-1!==this.indexOf(t)},t.add$=function(t){var e=this.getItems();return this.has(t)||(e.push(t),$n.set("wishlist",e),this.items$.next(e)),this.items$},t.remove$=function(t){var e=this.getItems(),n=this.indexOf(t);return-1!==n&&(e.splice(n,1),$n.set("wishlist",e),this.items$.next(e)),this.items$},t.toggle$=function(t){var e=this.getItems(),n=this.indexOf(t);return-1!==n?(e.splice(n,1),$n.set("wishlist",e),this.items$.next(e)):(e.push(t),$n.set("wishlist",e),this.items$.next(e)),this.items$},c(t,null,[{key:"items$",get:function(){if(!si){var t=$n.get("wishlist")||[];si=new n.BehaviorSubject(t)}return si}}]),t}(),ui=function(t){this.loader=t},li=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ui),di=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ui),hi=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ui),fi=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ui),pi=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ui),vi=function(){function t(t){var e=this;this.item=t,this.toggle=this.toggle.bind(this),this.muted_=!1,this.subscription=zt.state$.subscribe((function(t){return e.muted=t.volumeMuted}))}t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getPath=function(t){return de.getPath(t.asset.folder+t.asset.file)},t.loadTexture=function(e,n){var r=t.getPath(e);return t.getLoader().load(r,n)},t.isVideo=function(t){return t.asset&&t.asset.file&&(-1!==t.asset.file.indexOf(".mp4")||-1!==t.asset.file.indexOf(".webm"))},t.isStream=function(t){return Jr(t.asset)},t.isMutedStream=function(t){var e=!1;switch(t.asset.type.name){case Wr.PublisherStream.name:e=zt.state.role===qt.Publisher;break;case Wr.AttendeeStream.name:e=zt.state.role===qt.Attendee;break;case Wr.PublisherScreen.name:case Wr.AttendeeScreen.name:e=!0;break;case Wr.SmartDeviceStream.name:e=zt.state.role===qt.SmartDevice}return e},t.isPublisherStream=function(t){return t.asset&&t.asset.type.name===Wr.PublisherStream.name},t.isAttendeeStream=function(t){return t.asset&&t.asset.type.name===Wr.AttendeeStream.name},t.isSmartDeviceStream=function(t){return t.asset&&t.asset.type.name===Wr.SmartDeviceStream.name},t.isPublisherScreen=function(t){return t.asset&&t.asset.type.name===Wr.PublisherScreen.name},t.isAttendeeScreen=function(t){return t.asset&&t.asset.type.name===Wr.AttendeeScreen.name},c(t,[{key:"isVideo",get:function(){return t.isVideo(this.item)}},{key:"isStream",get:function(){return t.isStream(this.item)}},{key:"isMutedStream",get:function(){return t.isMutedStream(this.item)}},{key:"isPublisherStream",get:function(){return t.isPublisherStream(this.item)}},{key:"isAttendeeStream",get:function(){return t.isAttendeeStream(this.item)}},{key:"isSmartDeviceStream",get:function(){return t.isSmartDeviceStream(this.item)}},{key:"isPublisherScreen",get:function(){return t.isPublisherScreen(this.item)}},{key:"isAttendeeScreen",get:function(){return t.isAttendeeScreen(this.item)}},{key:"isPlayableVideo",get:function(){return this.isVideo}},{key:"isAutoplayVideo",get:function(){return this.isStream}},{key:"muted",get:function(){return this.muted_},set:function(t){this.muted_=t,this.video&&this.isVideo&&(this.video.muted=!0===t)}}]);var e=t.prototype;return e.load=function(e){var n,r=this,i=this.item;if(this.isStream&&i.streamId){var o=i.streamId,a=document.querySelector("#stream-"+o+" video");if(!a)return;var s=function t(){r.disposed||(a.removeEventListener("canplay",t),(n=r.texture=new THREE.VideoTexture(a)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,"function"==typeof e&&e(n,r))},c=this.isMutedStream;a.crossOrigin="anonymous",a.volume=c?0:1,a.muted=c,a.readyState>=a.HAVE_FUTURE_DATA?s():a.addEventListener("canplay",s)}else if(this.isVideo){var u=i.asset&&i.asset.autoplay||!1,l=i.asset&&i.asset.loop||!1,d=this.video=document.createElement("video");d.crossOrigin="anonymous",d.preload="metadata",d.volume=.8,d.muted=u,d.playsInline=!0,d.loop=l;d.oncanplay=function(){r.disposed||(d.oncanplay=null,(n=new THREE.VideoTexture(d)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,"function"==typeof e&&e(n,r),u?r.play(i.silent):d.pause())},d.ontimeupdate=function(){r.disposed||t.events$.next(new fi(r))},d.onended=function(){r.disposed||l||t.events$.next(new di(r))},d.src=t.getPath(i),d.load()}else i.asset?t.loadTexture(i,(function(t){r.disposed||(t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,"function"==typeof e&&e(t,r))})):e(null,this);return this},e.play=function(e){var n=this;this.video&&(this.video.muted=this.muted_,this.video.play().then((function(){e||t.events$.next(new li(n))}),(function(t){console.log("MediaLoader.play.error",n.item.asset.file,t)})))},e.pause=function(e){this.video&&this.isVideo&&(this.video.muted=!0,this.video.pause(),e||t.events$.next(new di(this)))},e.toggle=function(){if(this.video&&this.isVideo)return this.video.paused?(this.video.muted=this.muted_,this.play(),!0):(this.pause(),!1)},e.dispose=function(){this.subscription.unsubscribe(),this.pause(!0),this.isVideo&&this.video&&(this.video.ontimeupdate=null,this.video.onended=null,t.events$.next(new hi(this))),this.disposed=!0,delete this.video},c(t,[{key:"progress",get:function(){return this.video?this.video.currentTime/this.video.duration:0},set:function(e){if(this.video){var n=this.video.duration*e;this.video.seekable.length>e&&this.video.currentTime!==n&&(this.video.currentTime=n,t.events$.next(new pi(this)))}}}]),t}();vi.events$=new n.ReplaySubject(1);var mi=function(){function t(){}return c(t,null,[{key:"defaultGeometry",get:function(){return t.defaultGeometry_||(t.defaultGeometry_=new THREE.BoxBufferGeometry(1,1,1))}},{key:"planeGeometry",get:function(){return t.planeGeometry_||(t.planeGeometry_=new THREE.PlaneBufferGeometry(1,1,2,2))}},{key:"sphereGeometry",get:function(){return t.sphereGeometry_||(t.sphereGeometry_=new THREE.SphereBufferGeometry(3,12,12))}},{key:"panoramaGeometry",get:function(){return t.panoramaGeometry_||(t.panoramaGeometry_=new THREE.SphereBufferGeometry(101,36,36))}}]),t}(),gi=(new THREE.Vector3,function(){function t(){}return t.getDistanceToCamera=function(t,e,n,r,i){void 0===i&&(i=.88);var o=2*Math.atan(Math.PI*e/360),a=r.y*t.zoom/o,s=r.x*t.zoom/o/n;return i*Math.max(a,s)},c(t,null,[{key:"origin",get:function(){var t=this.host;if(t){var e=this.origin_;e.set(0,0,0),(t.renderer.xr.isPresenting?t.renderer.xr.getCamera(t.camera):t.camera).localToWorld(e)}return this.origin_}}]),t}());u(gi,"origin_",new THREE.Vector3);var Ai=function(){};Ai.items=[],Ai.hittest=function(t,e,n){var r=this;void 0===e&&(e=!1);var i=!1;this.down!==e&&(this.down=e,this.lock=!1,i=!0);var o,a,s=this.items.filter((function(t){return t.parent&&!t.freezed})),c=t.intersectObjects(s),u={};c.forEach((function(t,e){var n=t.object;o=n.uuid,0===e&&(r.lastIntersectedObject!==n||i?(r.lastIntersectedObject=n,a=n):n.intersection&&(Math.abs(n.intersection.point.x-t.point.x)>.01||Math.abs(n.intersection.point.y-t.point.y)>.01)&&(n.intersection=t,n.emit("move",n))),u[o]=t})),0===c.length&&(this.lastIntersectedObject=null);return s.forEach((function(t){t.intersection=u[t.uuid],t.over=t===r.lastIntersectedObject||t.intersection&&!t.depthTest&&(!r.lastIntersectedObject||r.lastIntersectedObject.depthTest),t.down=e&&t.over&&!r.lock,t.down&&(r.lock=!0)})),a}.bind(Ai),Ai.dispose=function(t){if(t){var e=this.items.indexOf(t);-1!==e&&this.items.splice(e,1)}}.bind(Ai);var yi=function(t){function e(e,n){var r;return e=e||mi.defaultGeometry,n=n||new THREE.MeshBasicMaterial({color:16711935}),(r=t.call(this,e,n)||this).freezed=!1,r}d(e,t),c(e,[{key:"freezed",get:function(){return this.freezed_},set:function(t){this.freezed_=t,this.children.filter((function(t){return t.__lookupGetter__("freezed")})).forEach((function(e){return e.freezed=t}))}}]);var n=e.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},e}(THREE.Mesh),bi=function(t){function e(e,n){var r;return e=e||mi.defaultGeometry,n=n||new THREE.MeshBasicMaterial({color:16711935}),(r=t.call(this,e,n)||this).events={},r}d(e,t);var n=e.prototype;return n.on=function(t,e){var n=this,r=this.events[t]=this.events[t]||[];return r.push(e),function(){n.events[t]=r.filter((function(t){return t!==e}))}},n.off=function(t,e){var n=this.events[t];n&&(this.events[t]=n.filter((function(t){return t!==e})))},n.emit=function(t,e){var n=this.events[t];n&&n.forEach((function(t){t(e)}));var r=this.events.broadcast;r&&r.forEach((function(n){n(t,e)}))},e}(yi),wi=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).depthTest=!0,r.over_=!1,r.down_=!1,Ai.items.push(h(r)),r}return d(e,t),c(e,[{key:"isInteractiveMesh",get:function(){return!0}},{key:"over",get:function(){return this.over_},set:function(t){this.over_!=t&&(this.over_=t,t?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(t){t=t&&this.over,this.down_!=t&&(this.down_=t,t?this.emit("down",this):this.emit("up",this))}}]),e}(bi),Ei=function(){function t(){}return t.keydown$=function(){return this.keydown$_||(this.keydown$_=n.fromEvent(window,"keydown").pipe(r.shareReplay(1))),this.keydown$_},t.keyup$=function(){return this.keyup$_||(this.keyup$_=n.fromEvent(window,"keyup").pipe(r.shareReplay(1))),this.keyup$_},t.keys$=function(){var t=this;return this.keys$_||(this.keys$_=n.merge(this.keydown$(),this.keyup$()).pipe(r.map((function(e){var n=t.keys;return"keydown"===e.type?n[e.key]=!0:delete n[e.key],t.keys})),r.startWith(this.keys),r.shareReplay(1))),this.keys$_},t.key$=function(){if(!this.key$_){var t=/\w/;this.key$_=this.keydown$().pipe(r.filter((function(e){return e.key&&e.key.match(t)})),r.map((function(t){return t.key})),r.shareReplay(1))}return this.key$_},t.typing$=function(){if(!this.typing$_){var t,e="";this.typing$_=this.key$().pipe(r.map((function(n){return t&&clearTimeout(t),e+=n,t=setTimeout((function(){e=""}),1500),e})),r.shareReplay(1))}return this.typing$_},t}();u(Ei,"keys",{});var _i=0,Si=function(){function t(){}return t.switchLoaders=function(){var t=this,e=Object.keys(this.items).map((function(e){return t.items[e]})),r=e.length?n.combineLatest(e):n.of(e);this.progress$.next(r)},t.getRef=function(){var t=++_i;return this.items[t]=new n.BehaviorSubject({loaded:0,total:1}),this.switchLoaders(),t},t.setProgress=function(t,e,n){var r=this;void 0===n&&(n=1);var i=this.items[t];i&&i.next({loaded:e,total:n}),e>=n&&setTimeout((function(){delete r.items[t],r.switchLoaders()}),300),this.switchLoaders()},t}();u(Si,"progress",{value:0,loaded:0,total:0,count:0,title:""}),u(Si,"items",{}),u(Si,"progress$",new n.ReplaySubject(1).pipe(r.switchAll(),r.map((function(){var t=Object.keys(Si.items).map((function(t){return Si.items[t]})),e=t.reduce((function(t,e,n,r){var i=e.getValue(),o=i.loaded||0,a=i.total||1,s=o/a;return t.value+=s,t.loaded+=o,t.total+=a,t}),{value:0,loaded:0,total:0});return e.count=t.length,t.length&&(e.value/=e.count),e.title=Math.round(100*e.value)+"%",Si.progress=e,e}))));var Ti,Ci=0,xi="complete",Ri=function(){function t(){}return t.worker=function(){return this.worker_||(this.worker_=new Worker(de.workers.prefetch)),this.worker_},t.events$=function(t){if(!("Worker"in window))return n.of({type:xi,data:t});var e=this.worker();e.postMessage({id:Ci});var i=++Ci;return e.postMessage({id:i,assets:t}),n.fromEvent(e,"message").pipe(r.map((function(t){return t.data})),r.filter((function(e){return e.assets===t})),r.tap((function(t){})),r.takeWhile((function(t){return t.type!==xi}),!0),r.finalize((function(){e.postMessage({id:i})})))},t.load$=function(t){return this.events$(t).pipe(r.filter((function(t){return t.type===xi})),r.map((function(t){return t.data})))},t.prefetch=function(t){this.load$(t).subscribe((function(t){console.log("PrefetchService.prefetch",t)}))},t.cancel=function(){if(!("Worker"in window))return null;var t=this.worker();return t.postMessage({id:Ci}),t},t}(),Ii=function(){function t(t){this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.set(t)}t.contains=function(t,e,n){return t.top<=n&&n<=t.bottom&&t.left<=e&&e<=t.right},t.intersectRect=function(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)},t.fromNode=function(e){if(e){var n=e.rect_||(e.rect_=new t);if(!e.getClientRects().length)return n;var r=e.getBoundingClientRect();return n.x=r.left,n.y=r.top,n.top=r.top,n.left=r.left,n.width=r.width,n.height=r.height,n.right=n.left+n.width,n.bottom=n.top+n.height,n.setCenter(),n}};var e=t.prototype;return e.set=function(t){t&&(Object.assign(this,t),this.right=this.left+this.width,this.bottom=this.top+this.height),this.setCenter()},e.setSize=function(t,e){this.width=t,this.height=e,this.right=this.left+this.width,this.bottom=this.top+this.height,this.setCenter()},e.setCenter=function(){var t=this.center||(this.center={});t.top=this.top+this.height/2,t.left=this.left+this.width/2,t.x=t.left,t.y=t.top},e.contains=function(e,n){return t.contains(this,e,n)},e.intersect=function(e){return t.intersectRect(this,e)},e.intersection=function(t){var e=this.intersection_||(this.intersection_={left:0,top:0,width:0,height:0,x:0,y:0,pow:{x:-1,y:-1},offset:function(t){return t=t||0,(this.top-this.rect.height/2+t)/-this.height},scroll:function(t){return t=t||0,(this.top-this.rect.height/2+t)/-this.height}});e.left=this.left,e.top=this.top,e.width=this.width,e.height=this.height,e.x=this.left+this.width/2,e.y=this.top+this.height/2,e.rect=t;var n=e.offset(0);return e.pow.y=n,e},t}(),Oi=[16763904,65484,52479,13434624,13369599,16777215],Mi=function(){function t(t){var e=this.clientId=t.clientId,n=this.container=t.container,r=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0});r.setClearColor(0,1),r.setPixelRatio(window.devicePixelRatio),r.setSize(320,240),r.toneMapping=THREE.ACESFilmicToneMapping,r.toneMappingExposure=.8,r.outputEncoding=THREE.sRGBEncoding,n.appendChild(r.domElement);var i=this.camera=new THREE.PerspectiveCamera(70,320/240,.01,1e3);i.position.set(0,0,-.5),i.target=new THREE.Vector3,i.lookAt(i.target);var o=this.scene=new THREE.Scene,a=this.light=new THREE.PointLight(16777215,1,100);a.position.set(0,2,-2),o.add(a);var s=this.head=this.addHead();o.add(s);this.remote=Gn.getRemoteById(e)}c(t,null,[{key:"headGeometry",get:function(){return this.headGeometry_||(this.headGeometry_=new THREE.SphereBufferGeometry(.2,36,24)),this.headGeometry_}}]);var e=t.prototype;return e.addHead=function(){var e=t.headGeometry,n=this.canvas=document.createElement("canvas");n.width=1024,n.height=512;this.ctx=this.canvas.getContext("2d");var r=this.map=new THREE.CanvasTexture(n);r.offset.x=-.25;var i=Oi[this.clientId%Oi.length],o=new THREE.MeshStandardMaterial({map:r,color:i});return this.chalk(0),new THREE.Mesh(e,o)},e.render=function(){this.tick_?++this.tick_:this.tick_=1;if(this.remote){var t=12*this.remote.getAudioLevel();this.chalk(t)}var e=this.renderer,n=this.scene,r=this.camera;e.render(n,r)},e.update=function(t){var e=t.camera;this.head.quaternion.set(e[3],e[4],e[5],e[6])},e.dispose=function(){this.subscription&&this.subscription.unsubscribe()},e.chalk=function(t){t=(t+.5*Math.PI)%(2*Math.PI);var e=30*Math.sin(t),n=10*Math.cos(t),r=256,i=this.ctx;i.fillStyle="#888888",i.fillRect(0,0,1024,512),i.fillStyle="white",i.beginPath(),i.arc(472,206,7,0,2*Math.PI),i.arc(552,206,7,0,2*Math.PI),i.closePath(),i.fill(),i.beginPath(),i.moveTo(472-n,286),i.bezierCurveTo(472-n,316,552+n,316,552+n,286),i.bezierCurveTo(552+n,r+e,472-n,r+e,472-n,286),i.closePath(),i.fill(),this.map.needsUpdate=!0},t}(),Li=THREE,ki=Li.DataTextureLoader,Bi=Li.DataUtils,Ni=Li.FloatType,Pi=Li.HalfFloatType,Ui=Li.LinearEncoding,Di=Li.LinearFilter,Fi=Li.NearestFilter,Hi=Li.RGBEEncoding,ji=Li.RGBEFormat,Vi=Li.RGBFormat,Gi=Li.UnsignedByteType,Qi=function(t){function e(e){var n;return(n=t.call(this,e)||this).type=Gi,n}d(e,t);var n=e.prototype;return n.parse=function(t){var e=function(t,e){switch(t){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},n=function(t,e,n){e=e||1024;for(var r=t.pos,i=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(r,r+128)));0>(i=s.indexOf("\n"))&&o<e&&r<t.byteLength;)a+=s,o+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(r,r+128)));return-1<i&&(!1!==n&&(t.pos+=o+i+1),a+s.slice(0,i))},r=function(t,e,n,r){var i=t[e+3],o=Math.pow(2,i-128)/255;n[r+0]=t[e+0]*o,n[r+1]=t[e+1]*o,n[r+2]=t[e+2]*o},i=function(t,e,n,r){var i=t[e+3],o=Math.pow(2,i-128)/255;n[r+0]=Bi.toHalfFloat(t[e+0]*o),n[r+1]=Bi.toHalfFloat(t[e+1]*o),n[r+2]=Bi.toHalfFloat(t[e+2]*o)},o=new Uint8Array(t);o.pos=0;var a=function(t){var r,i,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(r=n(t)))return e(1,"no header found");if(!(i=r.match(/^#\?(\S+)/)))return e(3,"bad initial token");for(u.valid|=1,u.programtype=i[1],u.string+=r+"\n";!1!==(r=n(t));)if(u.string+=r+"\n","#"!==r.charAt(0)){if((i=r.match(o))&&(u.gamma=parseFloat(i[1],10)),(i=r.match(a))&&(u.exposure=parseFloat(i[1],10)),(i=r.match(s))&&(u.valid|=2,u.format=i[1]),(i=r.match(c))&&(u.valid|=4,u.height=parseInt(i[1],10),u.width=parseInt(i[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid?4&u.valid?u:e(3,"missing image size specifier"):e(3,"missing format specifier")}(o);if(-1!==a){var s=a.width,c=a.height,u=function(t,n,r){var i=n;if(i<8||i>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(i!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");var o=new Uint8Array(4*n*r);if(!o.length)return e(4,"unable to allocate buffer space");for(var a=0,s=0,c=4*i,u=new Uint8Array(4),l=new Uint8Array(c),d=r;d>0&&s<t.byteLength;){if(s+4>t.byteLength)return e(1);if(u[0]=t[s++],u[1]=t[s++],u[2]=t[s++],u[3]=t[s++],2!=u[0]||2!=u[1]||(u[2]<<8|u[3])!=i)return e(3,"bad rgbe scanline format");for(var h=0,f=void 0;h<c&&s<t.byteLength;){var p=(f=t[s++])>128;if(p&&(f-=128),0===f||h+f>c)return e(3,"bad scanline data");if(p)for(var v=t[s++],m=0;m<f;m++)l[h++]=v;else l.set(t.subarray(s,s+f),h),h+=f,s+=f}for(var g=i,A=0;A<g;A++){var y=0;o[a]=l[A+y],y+=i,o[a+1]=l[A+y],y+=i,o[a+2]=l[A+y],y+=i,o[a+3]=l[A+y],a+=4}d--}return o}(o.subarray(o.pos),s,c);if(-1!==u){var l,d,h,f;switch(this.type){case Gi:l=u,d=ji,h=Gi;break;case Ni:f=u.length/4*3;for(var p=new Float32Array(f),v=0;v<f;v++)r(u,4*v,p,3*v);l=p,d=Vi,h=Ni;break;case Pi:f=u.length/4*3;for(var m=new Uint16Array(f),g=0;g<f;g++)i(u,4*g,m,3*g);l=m,d=Vi,h=Pi;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:c,data:l,header:a.string,gamma:a.gamma,exposure:a.exposure,format:d,type:h}}}return null},n.setDataType=function(t){return this.type=t,this},n.load=function(e,n,r,i){return t.prototype.load.call(this,e,(function(t,e){switch(t.type){case Gi:t.encoding=Hi,t.minFilter=Fi,t.magFilter=Fi,t.generateMipmaps=!1,t.flipY=!0;break;case Ni:case Pi:t.encoding=Ui,t.minFilter=Di,t.magFilter=Di,t.generateMipmaps=!1,t.flipY=!0}n&&n(t,e)}),r,i)},e}(ki),zi=function(){function t(){}return c(t,null,[{key:"defaultTexture",get:function(){return t.defaultTexture_||(t.defaultTexture_=(new THREE.TextureLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDA2IDc5LjE2NDc1MywgMjAyMS8wMi8xNS0xMTo1MjoxMyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjMgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjcyODFGQkE0QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjcyODFGQkE1QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NzI4MUZCQTJBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NzI4MUZCQTNBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz55AlN+AAAAZUlEQVR42uzQAQEAAAQDMPTvfD3YIqyT1GdTzwkQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAgAtWgAEAVbYDfaostxgAAAAASUVORK5CYII="))}},{key:"gridTexture",get:function(){return t.gridTexture_||(t.gridTexture_=(new THREE.TextureLoader).load(de.getPath(de.textures.grid)))}}]),t}(),qi=function(t){function e(n){var r,i=mi.planeGeometry,o=e.getMaterial();return u(h(r=t.call(this,i,o)||this),"playing_",!1),r.material=o,r.host=n,r.colorOff=new THREE.Color(o.color.getHex()),r.colorOn=new THREE.Color("#888888"),r.addEventListener(),r}d(e,t),e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getTextureOff=function(){return e.textureOff||(e.textureOff=e.getLoader().load(de.getPath("textures/ui/play-off.png")))},e.getTextureOn=function(){return e.textureOn||(e.textureOn=e.getLoader().load(de.getPath("textures/ui/play-on.png")))},e.getMaterial=function(){return new THREE.MeshBasicMaterial({map:e.getTextureOff(),color:16777215,opacity:1,transparent:!0})},c(e,[{key:"playing",get:function(){return this.playing_},set:function(t){this.playing_!==t&&(this.playing_=t,this.material.map=t?e.getTextureOn():e.getTextureOff(),this.onOut())}}]);var n=e.prototype;return n.update=function(t){var e=this.scale,n=t.scale.x/t.scale.y;e.set(.3/n,.3,1)},n.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},n.dispose=function(){this.removeEventListener(),this.disposeMaterial()},n.onOver=function(){var t=this.material.color,e=this.colorOn,n=this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:1,duration:.2,ease:Power2.easeInOut})},n.onOut=function(){var t=this.material.color,e=this.colorOff,n=this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:this.playing?0:1,duration:.2,ease:Power2.easeInOut})},n.addEventListener=function(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.on("over",this.onOver),this.on("out",this.onOut)},n.removeEventListener=function(){this.off("over",this.onOver),this.off("out",this.onOut)},e}(wi),Wi=function(t){function e(n){var r,i=mi.planeGeometry,o=e.getMaterial();return u(h(r=t.call(this,i,o)||this),"zoomed_",!1),r.material=o,r.host=n,r.colorOff=new THREE.Color(o.color.getHex()),r.colorOn=new THREE.Color("#888888"),r.object=new THREE.Object3D,r.addEventListener(),r}d(e,t),e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getTextureOff=function(){return e.textureOff||(e.textureOff=e.getLoader().load(de.getPath("textures/ui/zoom-off.png")))},e.getTextureOn=function(){return e.textureOn||(e.textureOn=e.getLoader().load(de.getPath("textures/ui/zoom-on.png")))},e.getMaterial=function(){return new THREE.MeshBasicMaterial({map:e.getTextureOff(),color:16777215,opacity:1,transparent:!0})},c(e,[{key:"zoomed",get:function(){return this.zoomed_},set:function(t){this.zoomed_!==t&&(this.zoomed_=t,this.material.map=t?e.getTextureOn():e.getTextureOff())}}]);var n=e.prototype;return n.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},n.dispose=function(){this.removeEventListener(),this.disposeMaterial()},n.onOver=function(){var t=this.material.color,e=this.colorOn;this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut})},n.onOut=function(){var t=this.material.color,e=this.colorOff;this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut})},n.onToggle=function(){this.emit("zoomed",!this.zoomed)},n.addEventListener=function(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.onToggle=this.onToggle.bind(this),this.on("over",this.onOver),this.on("out",this.onOut),this.on("down",this.onToggle)},n.removeEventListener=function(){this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)},e}(wi),Ki="\nvarying vec2 vUvShader;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\tvUvShader = uv;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",Xi="\n#define USE_MAP\n#define threshold 0.55\n#define padding 0.05\n\nvarying vec2 vUvShader;\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform vec3 chromaKeyColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(vec3(1.0), opacity);\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tvec4 chromaKey = vec4(chromaKeyColor, 1.0);\n    vec3 chromaKeyDiff = mapRgba.rgb - chromaKey.rgb;\n    float chromaKeyValue = smoothstep(threshold - padding, threshold + padding, dot(chromaKeyDiff, chromaKeyDiff));\n\tmapRgba = mapTexelToLinear(mapRgba);\n\t/*\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tplayMapRgba = mapTexelToLinear(playMapRgba);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity * chromaKeyValue);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\t}\n\t*/\n\t// diffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\tdiffuseColor = vec4(mapRgba.rgb, opacity * chromaKeyValue);\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapRgba = texture2D(lightMap, vUv2);\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear(lightMapRgba).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3(1.0);\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Ji=function(t){function e(n,r,i,o){var a,s=e.getMaterialByItem(n);u(h(a=t.call(this,i,s)||this),"zoomed_",!1),a.item=n,a.view=r,a.items=r.items,a.host=o,a.uniforms=e.getUniformsByItem(n),a.object=new THREE.Object3D,a.tempPosition=new THREE.Vector3,a.tempRotation=new THREE.Vector3,n.silent=a.isAutoplayLoop;a.mediaLoader=new vi(n);return a.onOver=a.onOver.bind(h(a)),a.onOut=a.onOut.bind(h(a)),a.onToggle=a.onToggle.bind(h(a)),a.onZoomed=a.onZoomed.bind(h(a)),a.addPlayBtn(),a.addZoomBtn(),a.userData.render=function(t,e){a.render(h(a),t,e)},a}d(e,t),e.getMaterial=function(t){return new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,vertexShader:Ki,fragmentShader:t?Xi:"\n#define USE_MAP\n\nvarying vec2 vUvShader;\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(vec3(1.0), opacity);\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tmapRgba = mapTexelToLinear(mapRgba);\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tplayMapRgba = mapTexelToLinear(playMapRgba);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity);\n\t}\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapRgba = texture2D(lightMap, vUv2);\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear(lightMapRgba).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3(1.0);\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",uniforms:{map:{type:"t",value:zi.defaultTexture},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},playMap:{type:"t",value:zi.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}})},e.getChromaKeyMaterial=function(t){void 0===t&&(t=[0,1,0]);var e=new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,vertexShader:Ki,fragmentShader:Xi,uniforms:{map:{type:"t",value:null},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},chromaKeyColor:{value:new THREE.Color(t[0],t[1],t[2])},playMap:{type:"t",value:zi.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}});return e.map=!0,e},e.isPublisherStream=function(t){return t.clientInfo&&t.clientInfo.role===qt.Publisher&&t.clientInfo.uid===t.getId()},e.isAttendeeStream=function(t){return t.clientInfo&&t.clientInfo.role===qt.Attendee&&t.clientInfo.uid===t.getId()},e.isSmartDeviceStream=function(t){return t.clientInfo&&t.clientInfo.role===qt.SmartDevice&&t.clientInfo.uid===t.getId()},e.isPublisherScreen=function(t){return t.clientInfo&&t.clientInfo.role===qt.Publisher&&t.clientInfo.screenUid===t.getId()},e.isAttendeeScreen=function(t){return t.clientInfo&&t.clientInfo.role===qt.Attendee&&t.clientInfo.screenUid===t.getId()},e.getTypeMatcher=function(t){var e;switch(t.name){case Wr.PublisherStream.name:e=this.isPublisherStream;break;case Wr.AttendeeStream.name:e=this.isAttendeeStream;break;case Wr.SmartDeviceStream.name:e=this.isSmartDeviceStream;break;case Wr.PublisherScreen.name:e=this.isPublisherScreen;break;case Wr.AttendeeScreen.name:e=this.isAttendeeScreen;break;default:e=function(t){return!1}}return e},e.getStreamId$=function(t){var e=this;if(!t.asset)return n.of(null);var i=t.asset.type,o=t.asset.file;return Jr(t.asset)?Gn.streams$.pipe(r.map((function(n){var r,o=0,a=e.getTypeMatcher(i);return n.forEach((function(e){a(e)&&(o===t.asset.index&&(r=e),o++)})),r?r.getId():null}))):n.of(o)},e.getMaterialByItem=function(t){return t.asset&&t.asset.chromaKeyColor?e.getChromaKeyMaterial(t.asset.chromaKeyColor):(t.asset,new THREE.MeshBasicMaterial({color:8947848}))},e.getUniformsByItem=function(t){var e=null;return t.asset&&(e={mapTween:1,playMapTween:0,opacity:0}),e},c(e,[{key:"editing",get:function(){return this.editing_},set:function(t){this.editing_!==t&&(this.editing_=t,this.zoomed="media"===this.view.type.name||!t&&this.zoomed)}}]);var i=e.prototype;return i.load=function(t){var e=this;if(this.playBtn&&this.remove(this.playBtn),this.zoomBtn&&this.remove(this.zoomBtn),!this.item.asset)return this.onAppear(),void("function"==typeof t&&t(this));var n=this.material;this.mediaLoader.load((function(r){var i=e.mediaLoader;i&&(r&&(r.encoding=THREE.sRGBEncoding,n.map=r,n.uniforms&&(n.uniforms.map.value=r,n.uniforms.mapResolution.value=new THREE.Vector2(r.image.width||r.image.videoWidth,r.image.height||r.image.videoHeight),i.isPlayableVideo&&e.makePlayMap(r,(function(t){t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,n.uniforms.playMap.value=t,n.uniforms.playMapResolution.value=new THREE.Vector2(t.image.width,t.image.height),n.needsUpdate=!0})))),n.needsUpdate=!0,e.onAppear(),i.isPlayableVideo&&e.playBtn&&(n.uniforms&&(n.uniforms.isVideo.value=!0),e.on("over",e.onOver),e.on("out",e.onOut),e.on("down",e.onToggle),e.add(e.playBtn)),e.zoomBtn&&e.add(e.zoomBtn),"function"==typeof t&&t(e))}))},i.makePlayMap=function(t,e){var n=t.image.width||t.image.videoWidth,r=t.image.height||t.image.videoHeight,i=n/r,o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high";var s=new Image;s.onload=function(){var t,c,u=s.width/s.height;i>u?c=(t=.32*r)/u:t=(c=.32*n)*u,a.drawImage(s,n/2-t/2,r/2-c/2,t,c);var l=new THREE.CanvasTexture(o);"function"==typeof e&&e(l)},s.crossOrigin="anonymous",s.src=de.getPath("textures/ui/play.png")},i.events$=function(){var t=this,e=this.item,n=this.items;return e.asset&&e.asset.linkedPlayId&&this.freeze(),vi.events$.pipe(r.filter((function(t){return t.loader.item&&t.loader.item.id===e.id})),r.map((function(r){(r instanceof li?(t.playing=!0,t.isAutoplayLoop||(t.playBtn&&(t.playBtn.playing=!0),t.emit("playing",!0)),t.onOut()):r instanceof di?(t.playing=!1,t.playBtn&&(t.playBtn.playing=!1),t.emit("playing",!1),t.onOut()):r instanceof pi&&t.emit("currentTime",r.loader.video.currentTime),e.asset&&e.asset.linkedPlayId)&&(n.find((function(t){return t.asset&&-1!==r.src.indexOf(t.asset.file)&&r.id===e.asset.linkedPlayId}))&&(r instanceof li?t.play():r instanceof di&&t.pause()));return r})))},i.onAppear=function(){var t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,opacity:1,ease:Power2.easeInOut,onUpdate:function(){e.uniforms.opacity.value=t.opacity}}),this.zoomed="media"===this.view.type.name||!this.editing&&this.zoomed},i.onDisappear=function(){var t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,opacity:0,ease:Power2.easeInOut,onUpdate:function(){e.uniforms.opacity.value=t.opacity}})},i.onOver=function(){var t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,mapTween:this.playing?0:1,playMapTween:1,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){e.uniforms.mapTween.value=t.mapTween,e.uniforms.playMapTween.value=t.playMapTween,e.uniforms.opacity.value=t.opacity}}),this.playBtn&&this.playBtn.onOver()},i.onOut=function(){var t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,mapTween:this.playing?0:1,playMapTween:0,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){e.uniforms.mapTween.value=t.mapTween,e.uniforms.playMapTween.value=t.playMapTween,e.uniforms.opacity.value=t.opacity}}),this.playBtn&&this.playBtn.onOut()},i.onToggle=function(){this.playing=this.mediaLoader.toggle(),this.playBtn&&(this.playBtn.playing=this.playing),this.emit("playing",this.playing),this.onOut()},i.play=function(){this.mediaLoader.play()},i.pause=function(){this.mediaLoader.pause()},i.setPlayingState=function(t){this.playing!==t&&(this.playing=t,t?this.mediaLoader.play():this.mediaLoader.pause(),this.onOut(),this.playBtn&&(this.playBtn.playing=t))},i.setZoomedState=function(t){this.zoomed=t},i.setCurrentTime=function(t){this.mediaLoader.video&&(this.mediaLoader.video.currentTime=t)},i.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},i.disposeMediaLoader=function(){var t=this.mediaLoader;t&&(t.isPlayableVideo&&(this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)),t.dispose(),this.mediaLoader=null)},i.dispose=function(){this.removePlayBtn(),this.removeZoomBtn(),this.disposeMediaLoader()},i.addPlayBtn=function(){if(this.removePlayBtn(),!this.isAutoplayLoop){var t=this.playBtn=new qi(this.host);t.on("over",this.onOver),t.on("out",this.onOut),t.on("down",this.onToggle),t.position.z=.01}},i.removePlayBtn=function(){this.playBtn&&(this.remove(this.playBtn),this.playBtn.off("over",this.onOver),this.playBtn.off("out",this.onOut),this.playBtn.off("down",this.onToggle),this.playBtn.dispose(),delete this.playBtn)},i.onZoomed=function(t){this.zoomed=t,this.emit("zoomed",t)},i.addZoomBtn=function(){(this.removeZoomBtn(),"media"===this.view.type.name||this.item.asset&&this.item.asset.chromaKeyColor)||(this.zoomBtn=new Wi(this.host)).on("zoomed",this.onZoomed)},i.removeZoomBtn=function(){this.zoomBtn&&(this.remove(this.zoomBtn),this.zoomBtn.off("zoomed",this.onZoomed),this.zoomBtn.dispose(),this.zoomBtn=null,delete this.zoomBtn)},i.updateByItem=function(t){this.disposeMaterial(),this.disposeMediaLoader(),this.material=e.getMaterialByItem(t),this.uniforms=e.getUniformsByItem(t),this.addPlayBtn(),this.addZoomBtn(),t.silent=this.isAutoplayLoop,this.mediaLoader=new vi(t)},i.updateFromItem=function(t){t.position&&this.position.fromArray(t.position),t.rotation&&this.rotation.fromArray(t.rotation),t.scale&&this.scale.fromArray(t.scale),this.playBtn&&this.playBtn.update(this),this.updateZoom()},i.updateZoom=function(){if(this.originalPosition=this.position.clone(),this.originalScale=this.scale.clone(),this.originalQuaternion=this.quaternion.clone(),this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion),this.zoomBtn){var t=this.zoomBtn.scale,e=this.zoomBtn.position,n=this.scale.x/this.scale.y,r=.1;t.set(r/n,r,1),e.x=.5-r/n/2,e.y=-.45,e.z=.01}},i.render=function(t,e){if(!this.editing){var n=this.object;this.zoomed&&!this.host.renderer.xr.isPresenting&&this.updateObjectMatrix(),this.position.copy(n.position),this.scale.copy(n.scale),this.quaternion.copy(n.quaternion)}},i.updateObjectMatrix=function(){var t=this.object,e=this.host;if(this.zoomed){var n,r=this.originalScale,i=e.camera,o=i.fov,a=i.aspect,s=this.tempPosition,c=this.tempRotation;n=.01;var u=e.renderer.xr;if(u.isPresenting){var l=(i=u.getCamera(i)).projectionMatrix.elements,d=l[0],h=l[5];a=h/d;o=2*Math.atan(1/h)*57.29577951308232,n=1}t.scale.copy(r).multiplyScalar(n);var f=gi.getDistanceToCamera(i,o,a,t.scale);i.getWorldDirection(c),c.multiplyScalar(f),s.set(0,0,0),i.localToWorld(s),s.add(c),t.position.copy(s),t.lookAt(gi.origin),u.isPresenting&&(t.position.y-=t.scale.y/2)}},c(e,[{key:"isAutoplayLoop",get:function(){return"media"!==this.view.type.name&&this.item.asset&&this.item.asset.autoplay&&this.item.asset.loop}},{key:"zoomed",get:function(){return this.zoomed_},set:function(t){this.zoomed_!==t&&(this.zoomed_=t,t?(this.renderOrder=de.renderOrder.panel+5,this.material.depthTest=!0):(this.renderOrder=0,this.material.depthTest=!0,this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion)),this.material.needsUpdate=!0,this.updateObjectMatrix(),this.zoomBtn&&(this.zoomBtn.zoomed=t))}}]),e}(wi),Yi=function(){this.x=0,this.y=0},$i=function(t){t&&Object.assign(this,t)},Zi=function(t){function e(e){var n;return(n=t.call(this,e)||this).distance=new Yi,n.strength=new Yi,n.speed=new Yi,n}return d(e,t),e}($i),to=function(t){function e(e){var n;return(n=t.call(this,e)||this).distance=new Yi,n.strength=new Yi,n.speed=new Yi,n}return d(e,t),e}($i),eo=function(t){function e(e){return t.call(this,e)||this}return d(e,t),e}($i),no=function(){function t(){}return t.getPosition=function(t,e){return t instanceof MouseEvent?e?(e.x=t.clientX,e.y=t.clientY):e={x:t.clientX,y:t.clientY}:window.TouchEvent&&t instanceof TouchEvent&&t.touches.length>0&&(e?(e.x=t.touches[0].pageX,e.y=t.touches[0].pageY):e={x:t.touches[0].pageX,y:t.touches[0].pageY}),e},t.down$=function(t,e){var i,o=this;return n.merge(n.fromEvent(t,"mousedown").pipe(r.filter((function(t){return 0===t.button}))),n.fromEvent(t,"touchstart")).pipe(r.map((function(n){if((i=i||new Zi).node=t,i.target=n.target,i.originalEvent=n,i.down=o.getPosition(n,i.down),i.down)return i.distance=new Yi,i.strength=new Yi,i.speed=new Yi,e.next(i),i})),r.filter((function(t){return void 0!==t})))},t.move$=function(t,e,i,o){var a,s=this;return n.fromEvent(document,o.originalEvent instanceof MouseEvent?"mousemove":"touchmove").pipe(r.startWith(o),r.map((function(n){if((a=a||new to).node=t,a.target=n.target,a.originalEvent=n,a.position=s.getPosition(n,a.position),void 0!==o.down&&void 0!==a.position)return a.distance.x=a.position.x-o.down.x,a.distance.y=a.position.y-o.down.y,a.strength.x=a.distance.x/window.innerWidth*2,a.strength.y=a.distance.y/window.innerHeight*2,a.speed.x=o.speed.x+.1*(a.strength.x-o.strength.x),a.speed.y=o.speed.y+.1*(a.strength.y-o.strength.y),o.distance.x=a.distance.x,o.distance.y=a.distance.y,o.speed.x=a.speed.x,o.speed.y=a.speed.y,o.strength.x=a.strength.x,o.strength.y=a.strength.y,e.next(a),a})))},t.dismissEvent=function(t,e,n,r){return Ti=Ti||new eo,e.next(Ti),n.next(),r&&Math.abs(r.distance.x)>10&&(t.preventDefault(),t.stopImmediatePropagation()),Ti},t.up$=function(t,e,i,o){var a=this;return n.fromEvent(document,o.originalEvent instanceof MouseEvent?"mouseup":"touchend").pipe(r.map((function(t){return a.dismissEvent(t,e,i,o)})))},t.observe$=function(e){var i=this;e=e||document;var o=t.events$=new n.ReplaySubject(1),a=t.dismiss$=new n.Subject;return this.down$(e,o).pipe(r.switchMap((function(s){return t.downEvent=s,n.merge(i.move$(e,o,a,s),i.up$(e,o,a,s)).pipe(r.takeUntil(a))})),r.switchMap((function(){return o})))},t}(),ro="panorama",io="model",oo=function(){},ao=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(oo),so=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(oo),co=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(oo),uo=new co,lo=new ao,ho=new so,fo=function(){var t=e.prototype;function e(t){this.mode_=e.mode=ro,this.dolly_=70,this.zoom_=70,this.longitude=0,this.latitude=0,this.direction=1,this.radius=101,this.position=new THREE.Vector3,this.inertia=new THREE.Vector2,this.rotation=new THREE.Euler(0,0,0,"XYZ"),this.target=new THREE.Vector3,this.updatePosition=new THREE.Vector3,this.updateTarget=new THREE.Vector3,this.camera=t,this.setLongitudeLatitude(0,0),this.events$=new n.ReplaySubject(1)}return t.getDollyValue=function(){return 1-(this.dolly_-15)/60-.5},t.getZoomValue=function(){return 2-(this.zoom_-15)/60},c(e,[{key:"dolly",get:function(){return this.dolly_},set:function(t){var e=THREE.Math.clamp(t,15,75);this.dolly_!==e&&(this.dolly_=e,this.markAsDirty())}},{key:"zoom",get:function(){return this.zoom_},set:function(t){var e=THREE.Math.clamp(t,15,75);this.zoom_!==e&&(this.zoom_=e,this.markAsDirty())}},{key:"mode",get:function(){return this.mode_},set:function(t){this.mode_!==t&&(this.mode_=t,e.mode=t,this.markAsDirty())}},{key:"controlled",get:function(){return zt.state.controlling&&zt.state.controlling!==zt.state.uid}},{key:"controlling",get:function(){return zt.state.controlling&&zt.state.controlling===zt.state.uid}},{key:"silencing",get:function(){return zt.state.silencing}},{key:"silenced",get:function(){return zt.state.silencing&&zt.state.role===qt.Streamer}},{key:"spyed",get:function(){return zt.state.spying&&zt.state.spying===zt.state.uid}},{key:"spying",get:function(){return zt.state.spying&&zt.state.spying!==zt.state.uid}},{key:"isMediaView",get:function(){return ri.view&&ri.view.type.name===pr.Media.name}},{key:"locked",get:function(){return this.controlled||this.spying||this.isMediaView}}]),t.setOrientation=function(t){t&&(this.setLongitudeLatitude(t.longitude,t.latitude),this.markAsDirty())},t.getOrientation=function(){return{latitude:this.latitude,longitude:this.longitude}},t.setLongitudeLatitude=function(t,e){e=Math.max(-80,Math.min(80,e)),this.longitude=(t<0?360+t:t)%360,this.latitude=e;var n=THREE.Math.degToRad(90-e),r=THREE.Math.degToRad(t);this.phi=n,this.theta=r},t.observe$=function(t){var e,i,o=this;return n.combineLatest([Ei.keys$(),no.observe$(t)]).pipe(r.filter((function(t){return!o.locked})),r.map((function(t){var n=t[0],r=t[1];if(r instanceof Zi)e=o.latitude,i=o.longitude;else if(r instanceof to)if(n.Shift)o.events$.next(lo);else if(n.Control)o.events$.next(ho);else{var a=o.mode_===io?-1:1;o.setLongitudeLatitude(i-.1*r.distance.x*a,e+.1*r.distance.y)}return r})),r.filter((function(t){return t instanceof to})),r.startWith({latitude:this.latitude,longitude:this.longitude}),r.tap((function(t){return o.markAsDirty()})),r.switchMap((function(t){return o.events$})))},t.walk=function(t,e){var n,r=this;switch(this.mode_){case io:n=3;break;default:n=this.radius}var i=new THREE.Vector2(t.x,t.y).normalize().multiplyScalar(n),o=Math.atan2(i.y,i.x),a=THREE.MathUtils.radToDeg(o);a=(a<0?360+a:a)%360;var s=this.latitude,c=this.longitude,u=a-c;u=Math.abs(u)>180?u-u/Math.abs(u)*360:u;var l=0-s;l=Math.abs(l)>90?l-l/Math.abs(l)*90:l;var d={tween:0};gsap.to(d,{duration:.7,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){r.setLongitudeLatitude(c+u*d.tween,s+l*d.tween),r.position.set(t.x*d.tween,0,t.y*d.tween),r.markAsDirty()},onComplete:function(){"function"==typeof e&&e(a,0)}})},t.walkComplete=function(t,e){this.setLongitudeLatitude(t,e),this.position.set(0,0,0),this.markAsDirty()},t.lookAt=function(t){if(t){var e,n=t.position.clone();switch(n=this.camera.parent.worldToLocal(n),this.mode_){case io:e=3;break;default:e=this.radius}var r=new THREE.Vector3(n.x,n.z,n.y).normalize().multiplyScalar(e),i=Math.atan2(r.y,r.x),o=Math.acos(r.z/e),a=THREE.MathUtils.radToDeg(i);a=(a<0?360+a:a)%360;var s=90-THREE.MathUtils.radToDeg(o);s=Math.max(-80,Math.min(80,s)),this.setLongitudeLatitude(a,s),this.markAsDirty()}},t.setVRCamera=function(t){if(t){var e=this.radius,n=new THREE.Vector3(0,0,-e),r=new THREE.Quaternion(t[3],t[4],t[5],t[6]);n.applyQuaternion(r);var i=new THREE.Vector3(n.x,n.z,n.y).normalize().multiplyScalar(e),o=Math.atan2(i.y,i.x),a=Math.acos(i.z/e),s=THREE.MathUtils.radToDeg(o);s=(s<0?360+s:s)%360;var c=90-THREE.MathUtils.radToDeg(a);c=Math.max(-80,Math.min(80,c)),this.setLongitudeLatitude(s,c),this.markAsDirty()}},t.render=function(){zt.state.hosted||(this.longitude+=.025,this.isDirty=!0),this.isDirty&&(this.isDirty=!1,this.update())},t.markAsDirty=function(){this.isDirty=!0},t.update=function(){var t,e=this.updatePosition,n=this.updateTarget,r=this.getZoomValue(),i=(this.getDollyValue(),THREE.MathUtils.degToRad(90-this.latitude)),o=THREE.MathUtils.degToRad(this.longitude),a=this.camera,s=a.parent;switch(this.mode_){case io:t=3,e.copy(this.position),n.x=this.position.x+t*Math.sin(i)*Math.cos(o),n.y=this.position.y+t*Math.cos(i),n.z=this.position.z+t*Math.sin(i)*Math.sin(o),n=s.worldToLocal(n),a.target.copy(e),a.position.copy(n);break;default:t=this.radius,n.x=this.position.x+t*Math.sin(i)*Math.cos(o),n.y=this.position.y+t*Math.cos(i),n.z=this.position.z+t*Math.sin(i)*Math.sin(o),e.copy(this.position),n=s.worldToLocal(n),a.target.copy(n),a.position.copy(e)}a.zoom=r,a.lookAt(a.target),a.updateProjectionMatrix(),ri.view&&(ri.view.lastOrientation.longitude=this.longitude,ri.view.lastOrientation.latitude=this.latitude),this.events$.next(uo)},e}();fo.orbitMoveEvent=uo;var po=0,vo="progress",mo="complete",go=function(){function t(){}return t.worker=function(){return this.worker_||(this.worker_=new Worker(de.workers.image)),this.worker_},t.events$=function(t,e){if(!("Worker"in window)||this.isBlob(t)||this.isCors(t))return n.of({type:mo,data:t});var i=++po,o=this.worker();return o.postMessage({src:t,id:i,size:e}),n.fromEvent(o,"message").pipe(r.map((function(t){return t.data})),r.filter((function(e){return e.src===t})),r.auditTime(100),r.map((function(t){if(t.type===mo&&t.data instanceof Blob){var e=URL.createObjectURL(t.data);t.data=e}return t})),r.takeWhile((function(t){return t.type!==mo}),!0),r.finalize((function(){o.postMessage({id:i})})))},t.load$=function(t,e){return this.events$(t,e).pipe(r.filter((function(t){return t.type===mo})),r.map((function(t){return t.data})))},t.isCors=function(t){return!1},t.isBlob=function(t){return 0===t.indexOf("blob:")},t}(),Ao=function(){function t(){}return t.load=function(t,e,n){if(vi.events$.next(new hi(this)),this.video=null,t)return t.type.name===Wr.PublisherStream.name?this.loadPublisherStreamBackground(e,n):-1!==t.file.indexOf(".mp4")||-1!==t.file.indexOf(".webm")?this.loadVideoBackground(de.getPath(t.folder),t.file,e,n):-1!==t.file.indexOf(".m3u8")?this.loadHlslVideoBackground(t.file,e,n):-1!==t.file.indexOf(".hdr")?this.loadRgbeBackground(de.getPath(t.folder),t.file,e,n):this.loadBackgroundImageService(de.getPath(t.folder),t.file,e,n)},t.loadBackground=function(t,e,n,r){var i=Si.getRef(),o=new THREE.TextureLoader;return o.setPath(t).load(e,(function(t){t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.needsUpdate=!0,"function"==typeof r&&r(t),Si.setProgress(i,1)}),(function(t){Si.setProgress(i,t.loaded,t.total)})),o},t.loadBackgroundImageService=function(t,e,i,o){var a=Si.getRef(),s=new Image;go.events$(t+e).pipe(r.tap((function(t){t.type===vo&&Si.setProgress(a,t.data.loaded,t.data.total)})),r.filter((function(t){return t.type===mo})),r.switchMap((function(t){var e=n.fromEvent(s,"load");return s.crossOrigin="anonymous",s.src=t.data,e})),r.takeWhile((function(t){return t.type!==mo}),!0)).subscribe((function(t){var e=new THREE.Texture(s);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof o&&(o(e),URL.revokeObjectURL(t.data)),Si.setProgress(a,1)}))},t.loadRgbeBackground=function(t,e,n,r){var i=Si.getRef(),o=new Qi;return o.setDataType(THREE.UnsignedByteType).setPath(t).load(e,(function(t){"function"==typeof r&&r(t,!0),Si.setProgress(i,1)}),(function(t){Si.setProgress(i,t.loaded,t.total)})),o},t.loadHlslVideoBackground=function(t,e,n){var r=Si.getRef(),i=document.createElement("video");if(i.oncanplay=function(){!function(){i.oncanplay=null;var t=new THREE.VideoTexture(i);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.needsUpdate=!0,"function"==typeof n&&n(t),Si.setProgress(r,1)}()},Hls.isSupported()){var o=new Hls;o.attachMedia(i),o.on(Hls.Events.MEDIA_ATTACHED,(function(){o.loadSource(t),o.on(Hls.Events.MANIFEST_PARSED,(function(t,e){i.play()}))}))}},t.play=function(t){var e=this,n=this.video;n&&(n.muted=this.muted_,n.play().then((function(){t||vi.events$.next(new li(e))}),(function(t){console.log("PanoramaLoader.play.error",n.src,t)})))},t.pause=function(t){var e=this.video;e&&(e.muted=!0,e.pause(),t||vi.events$.next(new di(this)))},t.loadVideoBackground=function(t,e,n,r){var i=this,o=Si.getRef();this.video=!0;var a=this.video;a.oncanplay=function(){a.oncanplay=null;var t=new THREE.VideoTexture(a);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.needsUpdate=!0,"function"==typeof r&&r(t),Si.setProgress(o,1),i.play()},a.ontimeupdate=function(){vi.events$.next(new fi(i))},a.onended=function(){},a.crossOrigin="anonymous",a.src=t+e,a.load()},t.loadPublisherStreamBackground=function(t,e){var n=this;Gn.getPublisherStreamId$().pipe(r.first()).subscribe((function(t){return function(t){var r=document.querySelector("#stream-"+t+" video");if(r){var i=function(){var t=n.texture=new THREE.VideoTexture(r);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.needsUpdate=!0,"function"==typeof e&&e(t)};r.crossOrigin="anonymous",r.readyState>=r.HAVE_FUTURE_DATA?i():r.oncanplay=function(){i()}}}(t)}))},c(t,null,[{key:"video",get:function(){return this.video_},set:function(t){if(this.video_&&(this.video_.muted=!0,this.video_.pause(),this.video_.parentNode&&this.video_.parentNode.removeChild(this.video_),this.video_=null),t){var e=this.video_=document.createElement("video");e.loop=!0,e.playsInline=!0,e.crossOrigin="anonymous"}}},{key:"muted",get:function(){return this.muted_},set:function(t){this.muted_=t,this.video&&(this.video.muted=!0===t)}},{key:"cubeRenderTarget",set:function(t){this.cubeRenderTarget_&&(this.cubeRenderTarget_.texture.dispose(),this.cubeRenderTarget_.dispose()),this.cubeRenderTarget_=t}},{key:"texture",set:function(t){this.texture_&&this.texture_.dispose(),this.texture_=t}},{key:"progress",get:function(){var t=this.video;return t?t.currentTime/t.duration:0},set:function(t){var e=this.video;if(e){var n=e.duration*t;e.seekable.length>t&&e.currentTime!==n&&(e.currentTime=n,vi.events$.next(new pi(this)))}}}]),t}(),yo=function(){function t(t){this.muted_=!1,this.subscription=zt.state$.subscribe((function(t){return Ao.muted=t.volumeMuted})),this.tween=0,this.create(t)}var e=t.prototype;return e.create=function(t){var e=this;this.renderer=t,this.onCubeMapDispose=this.onCubeMapDispose.bind(this);var n=new THREE.BoxGeometry(202,202,202),r=this.getBlackMaterial(),i=new wi(n,r);i.userData={render:function(t,n,r,o,a){i.matrixWorld.copyPosition(a.matrixWorld);var s=e.cubeMap,c=e.texture;s&&c&&c.isVideoTexture&&e.updateCubeMapEquirectangularTexture(s,r,c)}},i.name="[panorama]",this.mesh=i},e.getBlackMaterial=function(){return new THREE.MeshBasicMaterial({name:"PanoramaStandardMaterial",color:0,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1})},e.getShaderMaterial=function(t){var e=new THREE.ShaderMaterial({name:"PanoramaCubeMaterial",uniforms:this.cloneUniforms(THREE.ShaderLib.cube.uniforms),vertexShader:THREE.ShaderLib.cube.vertexShader,fragmentShader:THREE.ShaderLib.cube.fragmentShader,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1});t.mapping=THREE.EquirectangularReflectionMapping;var n=this.toCubeMap(t,this.renderer);return e.map=n,e.uniforms.envMap.value=n,e.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.needsUpdate=!0,this.mesh.geometry.deleteAttribute("normal"),this.mesh.geometry.deleteAttribute("uv"),Object.defineProperty(e,"envMap",{get:function(){return this.uniforms.envMap.value},configurable:!0}),e},e.makeEnvMap=function(t){var e=this.mesh.material;if(e.uniforms){t.mapping=THREE.EquirectangularReflectionMapping;var n=this.toCubeMap(t,this.renderer);e.map=n,e.uniforms.envMap.value=n,e.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.needsUpdate=!0}else e.dispose(),e=this.getShaderMaterial(t),this.mesh.material=e},e.toCubeMap=function(t,e){this.cubeMap&&this.cubeMap.dispose();var n=t.image,r=n.height||n.videoHeight,i=new THREE.WebGLCubeRenderTarget(r/2,{generateMipmaps:!0,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.CubeUVReflectionMapping,format:THREE.RGBFormat});return i.addEventListener("dispose",this.onCubeMapDispose),this.setCubeMapEquirectangularTexture(i,t),this.updateCubeMapEquirectangularTexture(i,e,t),this.cubeMap=i,this.texture=t,this.mapTextureMapping(i.texture,t.mapping)},e.setCubeMapEquirectangularTexture=function(t,e){t.texture.type=e.type,t.texture.format=THREE.RGBFormat,t.texture.encoding=THREE.sRGBEncoding,t.texture.generateMipmaps=e.generateMipmaps,t.texture.minFilter=e.minFilter,t.texture.magFilter=e.magFilter,t.texture.needsUpdate=!0;var n={tEquirect:{value:null}},r="\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\t\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\t\t\t\t\t}\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\t\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t\t#include <project_vertex>\n\t\t\t\t\t}\n\t\t\t\t",i="\n\t\t\t\t\tuniform sampler2D tEquirect;\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\t#include <common>\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\t\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\t\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t\t\t\t\t}\n\t\t\t\t",o=new THREE.BoxGeometry(5,5,5),a=new THREE.ShaderMaterial({name:"CubemapFromEquirect",uniforms:this.cloneUniforms(n),vertexShader:r,fragmentShader:i,side:THREE.BackSide,blending:THREE.NoBlending});a.uniforms.tEquirect.value=e;var s=new THREE.Mesh(o,a),c=new THREE.CubeCamera(1,10,t);return t.camera=c,t.mesh=s,t},e.updateCubeMapEquirectangularTexture=function(t,e,n){var r=n.minFilter;n.minFilter===THREE.LinearMipmapLinearFilter&&(n.minFilter=THREE.LinearFilter),t.camera.update(e,t.mesh),n.minFilter=r},e.cloneUniforms=function(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}return e},e.mapTextureMapping=function(t,e){return e===THREE.EquirectangularReflectionMapping?t.mapping=THREE.CubeReflectionMapping:e===THREE.EquirectangularRefractionMapping&&(t.mapping=THREE.CubeRefractionMapping),t},e.onCubeMapDispose=function(){var t=this.cubeMap;t&&(t.removeEventListener("dispose",this.onCubeMapDispose),t.texture.dispose(),t.mesh.geometry.dispose(),t.mesh.material.dispose(),void 0!==t&&(this.cubeMap=null))},e.change=function(t,e,n,r){var i=t instanceof Ar?t.tiles[t.index_]:t,o=this.mesh.material;this.load(i,e,(function(e){"function"==typeof r&&r(t),o.uniforms&&o.uniforms.uTween&&(o.uniforms.uTween.value=1,o.needsUpdate=!0),"function"==typeof n&&n(e)}))},e.crossfade=function(t,e,n){var r=this.mesh.material;this.load(t,e,(function(t){r.uniforms&&r.uniforms.uTween&&(r.uniforms.uTween.value=1,r.needsUpdate=!0),"function"==typeof n&&n(t)}))},e.load=function(t,e,n){var r=this,i=t.type.name===pr.Media.name?ti.defaultMediaAsset:t.asset;i&&(i.type.name!==Wr.Model.name?(this.currentAsset=i.folder+i.file,Ao.load(i,e,(function(t,e){if(i.folder+i.file===r.currentAsset){var o=r.makeEnvMap(t);"function"==typeof n&&n(o)}else t.dispose()}))):"function"==typeof n&&n(null))},e.dispose=function(){this.subscription.unsubscribe(),this.cubeMap&&this.cubeMap.dispose()},t}(),bo=4/3,wo=[16777215,16763904,65484,52479,13434624,13369599],Eo=function(){var t=e.prototype;function e(){var t=e.geometry,n=new THREE.MeshBasicMaterial({color:16777215});this.plane=new THREE.Mesh(t,n)}return t.setRemote=function(t,e,n){var r=this;this.remote=t;var i,o,a,s,c,u,l;n<4?(o=0,a=e,u=0,l=(c=(s=.12*(i=1))/bo)/2-n*c/2,this.plane.position.set(u,l+c*e,.005)):(i=.5,o=e%2,a=Math.floor(e/2),u=-(s=.12*i)/2,l=(c=s/bo)/2-Math.ceil(n/2)*c/2,this.plane.position.set(u+o*s,l+a*c,.005)),this.plane.scale.set(i,i,i),"number"==typeof t?this.plane.material.color.set(wo[e%wo.length]):t.texture?(this.plane.material.map=t.texture,this.plane.material.needsUpdate=!0):this.addStreamTexture(t.getId(),(function(e){t.texture=e,r.plane.material.map=e,r.plane.material.needsUpdate=!0}))},t.addStreamTexture=function(t,e){var n="#stream-"+t,r=document.querySelector(n+" video");if(r){var i=function(){var t=new THREE.VideoTexture(r);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.encoding=THREE.sRGBEncoding,t.needsUpdate=!0,"function"==typeof e&&e(t)};r.crossOrigin="anonymous",r.readyState>=r.HAVE_FUTURE_DATA?i():r.oncanplay=function(){i()}}},c(e,null,[{key:"geometry",get:function(){return new THREE.PlaneBufferGeometry(.12,.09,2,2)}}]),e}(),_o=function(){function t(){var t=this,e=this.mesh=new THREE.Group,n=this.phone=this.create();e.add(n);this.streams=[];Gn.remotes$.subscribe((function(e){t.remotes=e}))}return c(t,[{key:"remotes",set:function(t){var e=this;t.forEach((function(n,r){var i=e.streams[r];i||(i=new Eo),i.setRemote(n,r,t.length),e.phone.add(i.plane),e.streams[r]=i}));for(var n=t.length;n<this.streams.length;n++)this.phone.remove(this.streams[n].plane);this.streams.length=t.length}}]),t.prototype.create=function(){var t=new THREE.BoxBufferGeometry(.12,.27,.005,2,2,1),e=new THREE.MeshStandardMaterial({color:0,transparent:!0,opacity:.6}),n=new THREE.Mesh(t,e);return n.rotation.set(-Math.PI/4,0,0),n},t}(),So=function(){function t(t){void 0===t&&(t="#ffffff");this.position=new THREE.Vector3;var e=mi.planeGeometry,n=(new THREE.TextureLoader).load(de.getPath("textures/ui/nav-point.png")),r=new THREE.MeshBasicMaterial({color:new THREE.Color(t),depthTest:!1,depthWrite:!1,map:n,transparent:!0,opacity:.9}),i=this.mesh=new THREE.Mesh(e,r);i.renderOrder=de.renderOrder.pointer,i.position.set(-1e5,-1e5,-1e5)}var e=t.prototype;return e.update=function(t){if(Ai.lastIntersectedObject){var e=this.position;e.copy(Ai.lastIntersectedObject.intersection.point),e.multiplyScalar(.99);var n=this.mesh;n.position.set(e.x,e.y,e.z),e.sub(t.position);var r=e.length()/80;n.scale.set(r,r,r),n.lookAt(gi.origin)}},e.setPosition=function(t,e,n,r){var i=this.position;i.set(t,e,n).multiplyScalar(80);var o=this.mesh;o.position.copy(i),i.sub(r.position);var a=i.length()/80;o.scale.set(a,a,a),o.lookAt(gi.origin)},t}(),To=function(){function t(){this.gravity=new THREE.Vector3(0,-9.8,0),this.controllerPosition=new THREE.Vector3,this.controllerDirection=new THREE.Vector3,this.currentPosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3;var t=new THREE.BufferGeometry,e=this.vertices=new Float32Array(33);e.fill(0);var n=new Float32Array(33);n.fill(.5),t.setAttribute("position",new THREE.BufferAttribute(e,3)),t.setAttribute("color",new THREE.BufferAttribute(n,3));var r=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),i=(this.line=new THREE.Line(t,r),(new THREE.TextureLoader).load(de.getPath("textures/ui/nav-point.png")));(this.target=new THREE.Mesh(new THREE.PlaneBufferGeometry(.3,.3,1,1),new THREE.MeshBasicMaterial({map:i,blending:THREE.AdditiveBlending,color:5592405,transparent:!0}))).rotation.x=-Math.PI/2}var e=t.prototype;return e.addToController=function(t,e){this.currentController=t,t.add(this.line),e.add(this.target)},e.removeFromController=function(t,e,n,r,i){var o=this.currentController;if(o===t){var a=this.gravity,s=this.currentPosition,c=this.controllerPosition,u=this.controllerDirection;n.xr.getCamera(r).getWorldPosition(s),s.y=0,o.getWorldPosition(c),o.getWorldDirection(u),u.multiplyScalar(6);var l=(-u.y+Math.sqrt(Math.pow(u.y,2)-2*c.y*a.y))/a.y,d=this.getPositionT(this.targetPosition,l,c,u,a);d.addScaledVector(s,-1),i.position.add(d),this.currentController=null,o.remove(this.line),e.remove(this.target)}},e.update=function(){var t=this.currentController;if(t){var e=this.gravity,n=this.controllerPosition,r=this.controllerDirection,i=this.targetPosition;t.getWorldPosition(n),t.getWorldDirection(r),r.multiplyScalar(6);for(var o=(-r.y+Math.sqrt(Math.pow(r.y,2)-2*n.y*e.y))/e.y,a=i.set(0,0,0),s=1;s<=10;s++)this.getPositionT(a,s*o/10,n,r,e),t.worldToLocal(a),a.toArray(this.vertices,3*s);this.line.geometry.attributes.position.needsUpdate=!0,this.getPositionT(this.target.position,.98*o,n,r,e)}},e.getPositionT=function(t,e,n,r,i){return t.copy(n),t.addScaledVector(r,e),t.addScaledVector(i,.5*Math.pow(e,2)),t},t}(),Co="waiting",xo="enabled",Ro="ended",Io="started",Oo="disabled",Mo="needs-https",Lo="unavailable",ko=function(){function t(){var e=this;if(t.service_)throw"VRService is a singleton class!";var r=this.state_={camera:{position:new THREE.Vector3,quaternion:new THREE.Quaternion,scale:new THREE.Vector3,array:new Array(10).fill(0)}};this.onSessionStarted=this.onSessionStarted.bind(this),this.onSessionEnded=this.onSessionEnded.bind(this),this.status$=new n.BehaviorSubject(Co),this.session$=new n.Subject,this.state$=new n.BehaviorSubject(r),this.currentSession=null,"xr"in navigator?navigator.xr.isSessionSupported("immersive-vr").then((function(t){t?e.status$.next(xo):e.status$.next(Oo)})):!1===window.isSecureContext?this.status$.next(Mo):this.status$.next(Lo)}t.getService=function(){return this.service_||(this.service_=new t),this.service_},c(t,[{key:"status",get:function(){return this.status$.getValue()}},{key:"state",get:function(){return this.state$.getValue()}}]);var e=t.prototype;return e.onSessionStarted=function(t){t.addEventListener("end",this.onSessionEnded),this.currentSession=t,this.session$.next(t),this.status$.next(Io)},e.onSessionEnded=function(){this.currentSession.removeEventListener("end",this.onSessionEnded),this.currentSession=null,this.session$.next(null),this.status$.next(Ro)},e.toggleVR=function(t){if(null===this.currentSession){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(this.onSessionStarted)}else this.currentSession.end()},e.isDisabled=function(){switch(this.status$.getValue()){case Co:case Oo:case Mo:case Lo:return!0;default:return!1}},e.getLabel=function(){var t;switch(this.status$.getValue()){case Co:t="Waiting VR";break;case xo:case Ro:t="Enter VR";break;case Io:t="Exit VR";break;case Oo:t="VR Disabled";break;case Mo:t="VR Needs Https";break;case Lo:t="VR Unavailable"}return t},e.updateState=function(t){if(this.status===Io){t.renderer,t.scene;var e=t.camera,n=this.state_;e.matrixWorld.decompose(n.camera.position,n.camera.quaternion,n.camera.scale),n.camera.array[0]=n.camera.position.x,n.camera.array[1]=n.camera.position.y,n.camera.array[2]=n.camera.position.z,n.camera.array[3]=n.camera.quaternion.x,n.camera.array[4]=n.camera.quaternion.y,n.camera.array[5]=n.camera.quaternion.z,n.camera.array[6]=n.camera.quaternion.w,n.camera.array[7]=n.camera.scale.x,n.camera.array[8]=n.camera.scale.y,n.camera.array[9]=n.camera.scale.z,this.state$.next(n)}},t}(),Bo=function(t){function e(e){var n;return(n=t.call(this)||this).gamepad=e,n.buttons={},n.axes={},n}d(e,t);var n=e.prototype;return n.update=function(){this.updateButtons(),this.updateAxes()},n.updateButtons=function(){var t=this;this.gamepad.buttons.forEach((function(e,n){var r=e.pressed,i=t.buttons[n]||(t.buttons[n]=new No(n,t));i.pressed!==r&&(i.pressed=r,r?t.emit("press",i):void 0!==status&&t.emit("release",i))}))},n.updateAxes=function(){for(var t=this.gamepad.axes,e=0;e<t.length;e+=2){var n=Math.floor(e/2),r=this.axes[n]||(this.axes[n]=new Po(n,this)),i=t[e],o=t[e+1];if(r.x!==i||r.y!==o){if(r.x=i,r.y=o,Math.abs(i)>Math.abs(o)){var a=i<-.85,s=i>.85;r.left!==a&&(r.left=a,this.emit(a?"left":"none",r)),r.right!==s&&(r.right=s,this.emit(s?"right":"none",r))}else{var c=o<-.85,u=o>.85;r.up!==c&&(r.up=c,this.emit(c?"up":"none",r)),r.down!==u&&(r.down=u,this.emit(u?"down":"none",r))}this.emit("axis",r)}}},n.feedback=function(t,e){void 0===t&&(t=.1),void 0===e&&(e=50);var n=this.gamepad.hapticActuators;return n&&n.length?n[0].pulse(t,e):Promise.reject()},e}(function(){function t(){this.events={}}var e=t.prototype;return e.on=function(t,e){var n=this,r=this.events[t]=this.events[t]||[];return r.push(e),function(){n.events[t]=r.filter((function(t){return t!==e}))}},e.off=function(t,e){var n=this.events[t];n&&(this.events[t]=n.filter((function(t){return t!==e})))},e.emit=function(t,e){var n=this.events[t];n&&n.forEach((function(t){t(e)}));var r=this.events.broadcast;r&&r.forEach((function(n){n(t,e)}))},t}()),No=function(t,e){this.index=t,this.gamepad=e,this.pressed=!1},Po=function(t){function e(e,n){var r;return(r=t.call(this)||this).index=e,r.gamepad=n,r.left=r.right=r.up=r.down=!1,r}return d(e,t),e}(THREE.Vector2),Uo=THREE,Do=Uo.AnimationClip,Fo=Uo.Bone,Ho=Uo.Box3,jo=Uo.BufferAttribute,Vo=Uo.BufferGeometry,Go=Uo.CanvasTexture,Qo=Uo.ClampToEdgeWrapping,zo=Uo.Color,qo=Uo.DirectionalLight,Wo=Uo.DoubleSide,Ko=Uo.FileLoader,Xo=Uo.FrontSide,Jo=Uo.Group,Yo=Uo.ImageBitmapLoader,$o=Uo.InterleavedBuffer,Zo=Uo.InterleavedBufferAttribute,ta=Uo.Interpolant,ea=Uo.InterpolateDiscrete,na=Uo.InterpolateLinear,ra=Uo.Line,ia=Uo.LineBasicMaterial,oa=Uo.LineLoop,aa=Uo.LineSegments,sa=Uo.LinearFilter,ca=Uo.LinearMipmapLinearFilter,ua=Uo.LinearMipmapNearestFilter,la=Uo.Loader,da=Uo.LoaderUtils,ha=Uo.Material,fa=Uo.MathUtils,pa=Uo.Matrix4,va=Uo.Mesh,ma=Uo.MeshBasicMaterial,ga=Uo.MeshPhysicalMaterial,Aa=Uo.MeshStandardMaterial,ya=Uo.MirroredRepeatWrapping,ba=Uo.NearestFilter,wa=Uo.NearestMipmapLinearFilter,Ea=Uo.NearestMipmapNearestFilter,_a=Uo.NumberKeyframeTrack,Sa=Uo.Object3D,Ta=Uo.OrthographicCamera,Ca=Uo.PerspectiveCamera,xa=Uo.PointLight,Ra=Uo.Points,Ia=Uo.PointsMaterial,Oa=Uo.PropertyBinding,Ma=Uo.QuaternionKeyframeTrack,La=Uo.RGBFormat,ka=Uo.RepeatWrapping,Ba=Uo.Skeleton,Na=Uo.SkinnedMesh,Pa=Uo.Sphere,Ua=Uo.SpotLight,Da=Uo.TangentSpaceNormalMap,Fa=Uo.TextureLoader,Ha=Uo.TriangleFanDrawMode,ja=Uo.TriangleStripDrawMode,Va=Uo.Vector2,Ga=Uo.Vector3,Qa=Uo.VectorKeyframeTrack,za=Uo.sRGBEncoding,qa=function(t){function e(e){var n;return(n=t.call(this,e)||this).dracoLoader=null,n.ktx2Loader=null,n.meshoptDecoder=null,n.pluginCallbacks=[],n.register((function(t){return new Ya(t)})),n.register((function(t){return new Za(t)})),n.register((function(t){return new ts(t)})),n.register((function(t){return new $a(t)})),n.register((function(t){return new Xa(t)})),n.register((function(t){return new es(t)})),n}d(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:da.extractUrlBase(t),this.manager.itemStart(t);var a=function(e){r?r(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},s=new Ko(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{o.parse(n,i,(function(n){e(n),o.manager.itemEnd(t)}),a)}catch(t){a(t)}}),n,a)},n.setDRACOLoader=function(t){return this.dracoLoader=t,this},n.setDDSLoader=function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},n.setKTX2Loader=function(t){return this.ktx2Loader=t,this},n.setMeshoptDecoder=function(t){return this.meshoptDecoder=t,this},n.register=function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},n.unregister=function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},n.parse=function(t,e,n,r){var i,o={},a={};if("string"==typeof t)i=t;else if(da.decodeText(new Uint8Array(t,0,4))===ns){try{o[Ka.KHR_BINARY_GLTF]=new os(t)}catch(t){return void(r&&r(t))}i=o[Ka.KHR_BINARY_GLTF].content}else i=da.decodeText(new Uint8Array(t));var s=JSON.parse(i);if(void 0===s.asset||s.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new Ns(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var l=this.pluginCallbacks[u](c);a[l.name]=l,o[l.name]=!0}if(s.extensionsUsed)for(var d=0;d<s.extensionsUsed.length;++d){var h=s.extensionsUsed[d],f=s.extensionsRequired||[];switch(h){case Ka.KHR_MATERIALS_UNLIT:o[h]=new Ja;break;case Ka.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[h]=new us;break;case Ka.KHR_DRACO_MESH_COMPRESSION:o[h]=new as(s,this.dracoLoader);break;case Ka.KHR_TEXTURE_TRANSFORM:o[h]=new ss;break;case Ka.KHR_MESH_QUANTIZATION:o[h]=new ls;break;default:f.indexOf(h)>=0&&void 0===a[h]&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,r)}},e}(la);function Wa(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var Ka={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Xa=function(){function t(t){this.parser=t,this.name=Ka.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}var e=t.prototype;return e._markDefs=function(){for(var t=this.parser,e=this.parser.json.nodes||[],n=0,r=e.length;n<r;n++){var i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}},e._loadLight=function(t){var e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;var i,o=e.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t],s=new zo(16777215);void 0!==a.color&&s.fromArray(a.color);var c=void 0!==a.range?a.range:0;switch(a.type){case"directional":(i=new qo(s)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new xa(s)).distance=c;break;case"spot":(i=new Ua(s)).distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,i.angle=a.spot.outerConeAngle,i.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return i.position.set(0,0,0),i.decay=2,void 0!==a.intensity&&(i.intensity=a.intensity),i.name=e.createUniqueName(a.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r},e.createNodeAttachment=function(t){var e=this,n=this.parser,r=n.json.nodes[t],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return n._getNodeRef(e.cache,i,t)}))},t}(),Ja=function(){function t(){this.name=Ka.KHR_MATERIALS_UNLIT}var e=t.prototype;return e.getMaterialType=function(){return ma},e.extendParams=function(t,e,n){var r=[];t.color=new zo(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(r)},t}(),Ya=function(){function t(t){this.parser=t,this.name=Ka.KHR_MATERIALS_CLEARCOAT}var e=t.prototype;return e.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?ga:null},e.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Va(a,-a)}return Promise.all(i)},t}(),$a=function(){function t(t){this.parser=t,this.name=Ka.KHR_MATERIALS_TRANSMISSION}var e=t.prototype;return e.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?ga:null},e.extendMaterialParams=function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(e.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(i)},t}(),Za=function(){function t(t){this.parser=t,this.name=Ka.KHR_TEXTURE_BASISU}return t.prototype.loadTexture=function(t){var e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],a=e.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o,a)},t}(),ts=function(){function t(t){this.parser=t,this.name=Ka.EXT_TEXTURE_WEBP,this.isSupported=null}var e=t.prototype;return e.loadTexture=function(t){var e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;var o=i.extensions[e],a=r.images[o.source],s=n.textureLoader;if(a.uri){var c=n.options.manager.getHandler(a.uri);null!==c&&(s=c)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,a,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))},e.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported},t}(),es=function(){function t(t){this.name=Ka.EXT_MESHOPT_COMPRESSION,this.parser=t}return t.prototype.loadBufferView=function(t){var e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then((function(t){var e=r.byteOffset||0,n=r.byteLength||0,i=r.count,a=r.byteStride,s=new ArrayBuffer(i*a),c=new Uint8Array(t[0],e,n);return o.decodeGltfBuffer(new Uint8Array(s),i,a,c,r.mode,r.filter),s}))}return null},t}(),ns="glTF",rs=1313821514,is=5130562,os=function(t){this.name=Ka.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,12);if(this.header={magic:da.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==ns)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=this.header.length-12,r=new DataView(t,12),i=0;i<n;){var o=r.getUint32(i,!0);i+=4;var a=r.getUint32(i,!0);if(i+=4,a===rs){var s=new Uint8Array(t,12+i,o);this.content=da.decodeText(s)}else if(a===is){var c=12+i;this.body=t.slice(c,c+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")},as=function(){function t(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ka.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}return t.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},s={},c={};for(var u in o){var l=_s[u]||u.toLowerCase();a[l]=o[u]}for(var d in t.attributes){var h=_s[d]||d.toLowerCase();if(void 0!==o[d]){var f=n.accessors[t.attributes[d]],p=ys[f.componentType];c[h]=p,s[h]=!0===f.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}e(t)}),a,c)}))}))},t}(),ss=function(){function t(){this.name=Ka.KHR_TEXTURE_TRANSFORM}return t.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},t}(),cs=function(t){function e(e){var n;(n=t.call(this)||this).isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),c={specular:{value:(new zo).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return n._extraUniforms=c,n.onBeforeCompile=function(t){for(var e in c)t.uniforms[e]=c[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(h(n),{specular:{get:function(){return c.specular.value},set:function(t){c.specular.value=t}},specularMap:{get:function(){return c.specularMap.value},set:function(t){c.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(t){c.glossiness.value=t}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(t){c.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete n.metalness,delete n.roughness,delete n.metalnessMap,delete n.roughnessMap,n.setValues(e),n}return d(e,t),e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},e}(Aa),us=function(){function t(){this.name=Ka.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}var e=t.prototype;return e.getMaterialType=function(){return cs},e.extendParams=function(t,e,n){var r=e.extensions[this.name];t.color=new zo(1,1,1),t.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var o=r.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new zo(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new zo(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var a=r.specularGlossinessTexture;i.push(n.assignTexture(t,"glossinessMap",a)),i.push(n.assignTexture(t,"specularMap",a))}return Promise.all(i)},e.createMaterial=function(t){var e=new cs(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=Da,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e},t}(),ls=function(){this.name=Ka.KHR_MESH_QUANTIZATION},ds=function(t){function e(e,n,r,i){return t.call(this,e,n,r,i)||this}return d(e,t),e.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,o=0;o!==r;o++)e[o]=n[i+o];return e},e}(ta);ds.prototype.beforeStart_=ds.prototype.copySampleValue_,ds.prototype.afterEnd_=ds.prototype.copySampleValue_,ds.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,c=3*a,u=r-e,l=(n-e)/u,d=l*l,h=d*l,f=t*c,p=f-c,v=-2*h+3*d,m=h-d,g=1-v,A=m-d+l,y=0;y!==a;y++){var b=o[p+y+a],w=o[p+y+s]*u,E=o[f+y+a],_=o[f+y]*u;i[y]=g*b+A*w+v*E+m*_}return i};var hs=0,fs=1,ps=2,vs=3,ms=4,gs=5,As=6,ys={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bs={9728:ba,9729:sa,9984:Ea,9985:ua,9986:wa,9987:ca},ws={33071:Qo,33648:ya,10497:ka},Es={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_s={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ss={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ts={CUBICSPLINE:void 0,LINEAR:na,STEP:ea},Cs="OPAQUE",xs="MASK",Rs="BLEND";function Is(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function Os(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function Ms(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ls(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(var o=0,a=i.length;o<a;o++)t.morphTargetDictionary[i[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ks(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function Bs(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var Ns=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Wa,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new Yo(this.options.manager):this.textureLoader=new Fa(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ko(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}var e=t.prototype;return e.setExtensions=function(t){this.extensions=t},e.setPlugins=function(t){this.plugins=t},e.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){var o={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};Os(i,o,r),Ms(o,r),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(o)}))).then((function(){t(o)}))})).catch(e)},e._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r=0,i=e.length;r<i;r++)for(var o=e[r].joints,a=0,s=o.length;a<s;a++)t[o[a]].isBone=!0;for(var c=0,u=t.length;c<u;c++){var l=t[c];void 0!==l.mesh&&(this._addNodeRef(this.meshCache,l.mesh),void 0!==l.skin&&(n[l.mesh].isSkinnedMesh=!0)),void 0!==l.camera&&this._addNodeRef(this.cameraCache,l.camera)}},e._addNodeRef=function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)},e._getNodeRef=function(t,e,n){if(t.refs[e]<=1)return n;var r=n.clone();return r.name+="_instance_"+t.uses[e]++,r},e._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}return null},e._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++){var i=t(e[r]);i&&n.push(i)}return n},e.getDependency=function(t,e){var n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r},e.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},e.loadBuffer=function(t){var e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Ka.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(t,i){n.load(Is(e.uri,r.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},e.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},e.loadAccessor=function(t){var e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){var i,o,a=t[0],s=Es[r.type],c=ys[r.componentType],u=c.BYTES_PER_ELEMENT,l=u*s,d=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(h&&h!==l){var p=Math.floor(d/h),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count,m=e.cache.get(v);m||(i=new c(a,p*h,r.count*h/u),m=new $o(i,h/u),e.cache.add(v,m)),o=new Zo(m,s,d%h/u,f)}else i=null===a?new c(r.count*s):new c(a,d,r.count*s),o=new jo(i,s,f);if(void 0!==r.sparse){var g=Es.SCALAR,A=ys[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,w=new A(t[1],y,r.sparse.count*g),E=new c(t[2],b,r.sparse.count*s);null!==a&&(o=new jo(o.array.slice(),o.itemSize,o.normalized));for(var _=0,S=w.length;_<S;_++){var T=w[_];if(o.setX(T,E[_*s]),s>=2&&o.setY(T,E[_*s+1]),s>=3&&o.setZ(T,E[_*s+2]),s>=4&&o.setW(T,E[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},e.loadTexture=function(t){var e=this.json,n=this.options,r=e.textures[t],i=e.images[r.source],o=this.textureLoader;if(i.uri){var a=n.manager.getHandler(i.uri);null!==a&&(o=a)}return this.loadTextureImage(t,i,o)},e.loadTextureImage=function(t,e,n){var r=this,i=this.json,o=this.options,a=i.textures[t],s=self.URL||self.webkitURL,c=e.uri,u=!1,l=!0;if("image/jpeg"===e.mimeType&&(l=!1),void 0!==e.bufferView)c=r.getDependency("bufferView",e.bufferView).then((function(t){if("image/png"===e.mimeType){var n=new DataView(t,25,1).getUint8(0,!1);l=6===n||4===n||3===n}u=!0;var r=new Blob([t],{type:e.mimeType});return c=s.createObjectURL(r)}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");return Promise.resolve(c).then((function(t){return new Promise((function(e,r){var i=e;!0===n.isImageBitmapLoader&&(i=function(t){e(new Go(t))}),n.load(Is(t,o.path),i,void 0,r)}))})).then((function(e){!0===u&&s.revokeObjectURL(c),e.flipY=!1,a.name&&(e.name=a.name),l||(e.format=La);var n=(i.samplers||{})[a.sampler]||{};return e.magFilter=bs[n.magFilter]||sa,e.minFilter=bs[n.minFilter]||ca,e.wrapS=ws[n.wrapS]||ka,e.wrapT=ws[n.wrapT]||ka,r.associations.set(e,{type:"textures",index:t}),e}))},e.assignTexture=function(t,e,n){var r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),r.extensions[Ka.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[Ka.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var a=r.associations.get(i);i=r.extensions[Ka.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),r.associations.set(i,a)}}t[e]=i}))},e.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,r=void 0!==e.attributes.tangent,i=void 0!==e.attributes.color,o=void 0===e.attributes.normal,a=!0===t.isSkinnedMesh,s=Object.keys(e.morphAttributes).length>0,c=s&&void 0!==e.morphAttributes.normal;if(t.isPoints){var u="PointsMaterial:"+n.uuid,l=this.cache.get(u);l||(l=new Ia,ha.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(u,l)),n=l}else if(t.isLine){var d="LineBasicMaterial:"+n.uuid,h=this.cache.get(d);h||(h=new ia,ha.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(d,h)),n=h}if(r||i||o||a||s){var f="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(f+="specular-glossiness:"),a&&(f+="skinning:"),r&&(f+="vertex-tangents:"),i&&(f+="vertex-colors:"),o&&(f+="flat-shading:"),s&&(f+="morph-targets:"),c&&(f+="morph-normals:");var p=this.cache.get(f);p||(p=n.clone(),a&&(p.skinning=!0),i&&(p.vertexColors=!0),o&&(p.flatShading=!0),s&&(p.morphTargets=!0),c&&(p.morphNormals=!0),r&&(p.vertexTangents=!0,p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(f,p),this.associations.set(p,this.associations.get(n))),n=p}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n},e.getMaterialType=function(){return Aa},e.loadMaterial=function(t){var e,n=this,r=this.json,i=this.extensions,o=r.materials[t],a={},s=o.extensions||{},c=[];if(s[Ka.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[Ka.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=u.getMaterialType(),c.push(u.extendParams(a,o,n))}else if(s[Ka.KHR_MATERIALS_UNLIT]){var l=i[Ka.KHR_MATERIALS_UNLIT];e=l.getMaterialType(),c.push(l.extendParams(a,o,n))}else{var d=o.pbrMetallicRoughness||{};if(a.color=new zo(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}void 0!==d.baseColorTexture&&c.push(n.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(n.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),c.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===o.doubleSided&&(a.side=Wo);var f=o.alphaMode||Cs;return f===Rs?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===xs&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&e!==ma&&(c.push(n.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new Va(1,-1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&e!==ma&&(c.push(n.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&e!==ma&&(a.emissive=(new zo).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&e!==ma&&c.push(n.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){var r;return r=e===cs?i[Ka.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new e(a),o.name&&(r.name=o.name),r.map&&(r.map.encoding=za),r.emissiveMap&&(r.emissiveMap.encoding=za),Ms(r,o),n.associations.set(r,{type:"materials",index:t}),o.extensions&&Os(i,r,o),r}))},e.createUniqueName=function(t){for(var e=Oa.sanitizeNodeName(t||""),n=e,r=1;this.nodeNamesUsed[n];++r)n=e+"_"+r;return this.nodeNamesUsed[n]=!0,n},e.loadGeometries=function(t){var e=this,n=this.extensions,r=this.primitiveCache;function i(t){return n[Ka.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Us(n,t,e)}))}for(var o,a,s=[],c=0,u=t.length;c<u;c++){var l=t[c],d=(a=void 0,(a=(o=l).extensions&&o.extensions[Ka.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+ks(a.attributes):o.indices+":"+ks(o.attributes)+":"+o.mode),h=r[d];if(h)s.push(h.promise);else{var f=void 0;f=l.extensions&&l.extensions[Ka.KHR_DRACO_MESH_COMPRESSION]?i(l):Us(new Vo,l,e),r[d]={primitive:l,promise:f},s.push(f)}}return Promise.all(s)},e.loadMesh=function(t){for(var e,n=this,r=this.json,i=this.extensions,o=r.meshes[t],a=o.primitives,s=[],c=0,u=a.length;c<u;c++){var l=void 0===a[c].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new Aa({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Xo})),e.DefaultMaterial):this.getDependency("material",a[c].material);s.push(l)}return s.push(n.loadGeometries(a)),Promise.all(s).then((function(e){for(var r=e.slice(0,e.length-1),s=e[e.length-1],c=[],u=0,l=s.length;u<l;u++){var d=s[u],h=a[u],f=void 0,p=r[u];if(h.mode===ms||h.mode===gs||h.mode===As||void 0===h.mode)!0!==(f=!0===o.isSkinnedMesh?new Na(d,p):new va(d,p)).isSkinnedMesh||f.geometry.attributes.skinWeight.normalized||f.normalizeSkinWeights(),h.mode===gs?f.geometry=Ds(f.geometry,ja):h.mode===As&&(f.geometry=Ds(f.geometry,Ha));else if(h.mode===fs)f=new aa(d,p);else if(h.mode===vs)f=new ra(d,p);else if(h.mode===ps)f=new oa(d,p);else{if(h.mode!==hs)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);f=new Ra(d,p)}Object.keys(f.geometry.morphAttributes).length>0&&Ls(f,o),f.name=n.createUniqueName(o.name||"mesh_"+t),Ms(f,o),h.extensions&&Os(i,f,h),n.assignFinalMaterial(f),c.push(f)}if(1===c.length)return c[0];for(var v=new Jo,m=0,g=c.length;m<g;m++)v.add(c[m]);return v}))},e.loadCamera=function(t){var e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new Ca(fa.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new Ta(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Ms(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},e.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},e.loadAnimation=function(t){for(var e=this.json.animations[t],n=[],r=[],i=[],o=[],a=[],s=0,c=e.channels.length;s<c;s++){var u=e.channels[s],l=e.samplers[u.sampler],d=u.target,h=void 0!==d.node?d.node:d.id,f=void 0!==e.parameters?e.parameters[l.input]:l.input,p=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",h)),r.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",p)),o.push(l),a.push(d)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(a)]).then((function(n){for(var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=[],u=function(t,e){var n=r[t],u=i[t],l=o[t],d=a[t],h=s[t];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var f=void 0;switch(Ss[h.path]){case Ss.weights:f=_a;break;case Ss.rotation:f=Ma;break;case Ss.position:case Ss.scale:default:f=Qa}var p=n.name?n.name:n.uuid,v=void 0!==d.interpolation?Ts[d.interpolation]:na,m=[];Ss[h.path]===Ss.weights?n.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&m.push(t.name?t.name:t.uuid)})):m.push(p);var g=l.array;if(l.normalized){for(var A=Bs(g.constructor),y=new Float32Array(g.length),b=0,w=g.length;b<w;b++)y[b]=g[b]*A;g=y}for(var E=0,_=m.length;E<_;E++){var S=new f(m[E]+"."+Ss[h.path],u.array,g,v);"CUBICSPLINE"===d.interpolation&&(S.createInterpolant=function(t){return new ds(this.times,this.values,this.getValueSize()/3,t)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(S)}},l=0,d=r.length;l<d;l++)u(l);var h=e.name?e.name:"animation_"+t;return new Do(h,void 0,c)}))},e.createNodeMesh=function(t){var e=this.json,n=this,r=e.nodes[t];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(t){var e=n._getNodeRef(n.meshCache,r.mesh,t);return void 0!==r.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=r.weights.length;e<n;e++)t.morphTargetInfluences[e]=r.weights[e]})),e}))},e.loadNode=function(t){var e,n,r=this.json,i=this.extensions,o=this,a=r.nodes[t],s=a.name?o.createUniqueName(a.name):"";return(e=[],n=o._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)})),n&&e.push(n),void 0!==a.camera&&e.push(o.getDependency("camera",a.camera).then((function(t){return o._getNodeRef(o.cameraCache,a.camera,t)}))),o._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)).then((function(e){var n;if((n=!0===a.isBone?new Fo:e.length>1?new Jo:1===e.length?e[0]:new Sa)!==e[0])for(var r=0,c=e.length;r<c;r++)n.add(e[r]);if(a.name&&(n.userData.name=a.name,n.name=s),Ms(n,a),a.extensions&&Os(i,n,a),void 0!==a.matrix){var u=new pa;u.fromArray(a.matrix),n.applyMatrix4(u)}else void 0!==a.translation&&n.position.fromArray(a.translation),void 0!==a.rotation&&n.quaternion.fromArray(a.rotation),void 0!==a.scale&&n.scale.fromArray(a.scale);return o.associations.set(n,{type:"nodes",index:t}),n}))},e.loadScene=function(t){var e=this.json,n=this.extensions,r=this.json.scenes[t],i=new Jo;r.name&&(i.name=this.createUniqueName(r.name)),Ms(i,r),r.extensions&&Os(n,i,r);for(var o=r.nodes||[],a=[],s=0,c=o.length;s<c;s++)a.push(Ps(o[s],i,e,this));return Promise.all(a).then((function(){return i}))},t}();function Ps(t,e,n,r){var i=n.nodes[t];return r.getDependency("node",t).then((function(t){return void 0===i.skin?t:r.getDependency("skin",i.skin).then((function(t){for(var n=[],i=0,o=(e=t).joints.length;i<o;i++)n.push(r.getDependency("node",e.joints[i]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var r=[],i=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){r.push(s);var c=new pa;void 0!==e.inverseBindMatrices&&c.fromArray(e.inverseBindMatrices.array,16*o),i.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}t.bind(new Ba(r,i),t.matrixWorld)}})),t}));var e})).then((function(t){e.add(t);var o=[];if(i.children)for(var a=i.children,s=0,c=a.length;s<c;s++){var u=a[s];o.push(Ps(u,t,n,r))}return Promise.all(o)}))}function Us(t,e,n){var r=e.attributes,i=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var a in r){var s=_s[a]||a.toLowerCase();s in t.attributes||i.push(o(r[a],s))}if(void 0!==e.indices&&!t.index){var c=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(c)}return Ms(t,e),function(t,e,n){var r=e.attributes,i=new Ho;if(void 0!==r.POSITION){var o=n.json.accessors[r.POSITION],a=o.min,s=o.max;if(void 0!==a&&void 0!==s){if(i.set(new Ga(a[0],a[1],a[2]),new Ga(s[0],s[1],s[2])),o.normalized){var c=Bs(ys[o.componentType]);i.min.multiplyScalar(c),i.max.multiplyScalar(c)}var u=e.targets;if(void 0!==u){for(var l=new Ga,d=new Ga,h=0,f=u.length;h<f;h++){var p=u[h];if(void 0!==p.POSITION){var v=n.json.accessors[p.POSITION],m=v.min,g=v.max;if(void 0!==m&&void 0!==g){if(d.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),d.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),d.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),v.normalized){var A=Bs(ys[v.componentType]);d.multiplyScalar(A)}l.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}t.boundingBox=i;var y=new Pa;i.getCenter(y.center),y.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=y}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,n){for(var r=!1,i=!1,o=0,a=e.length;o<a;o++){var s=e[o];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);for(var c=[],u=[],l=0,d=e.length;l<d;l++){var h=e[l];if(r){var f=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):t.attributes.position;c.push(f)}if(i){var p=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):t.attributes.normal;u.push(p)}}return Promise.all([Promise.all(c),Promise.all(u)]).then((function(e){var n=e[0],o=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function Ds(t,e){var n=t.getIndex();if(null===n){var r=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<i.count;o++)r.push(o);t.setIndex(r),n=t.getIndex()}var a=n.count-2,s=[];if(e===Ha)for(var c=1;c<=a;c++)s.push(n.getX(0)),s.push(n.getX(c)),s.push(n.getX(c+1));else for(var u=0;u<a;u++)u%2==0?(s.push(n.getX(u)),s.push(n.getX(u+1)),s.push(n.getX(u+2))):(s.push(n.getX(u+2)),s.push(n.getX(u+1)),s.push(n.getX(u)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=t.clone();return l.setIndex(s),l}var Fs={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})},Hs={xAxis:0,yAxis:0,button:0,state:Fs.ComponentState.DEFAULT};function js(t){return Vs.apply(this,arguments)}function Vs(){return(Vs=a(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if((n=t.sent).ok){t.next=7;break}throw new Error(n.statusText);case 7:return t.abrupt("return",n.json());case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Gs(t){return Qs.apply(this,arguments)}function Qs(){return(Qs=a(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("No basePath supplied");case 2:return"profilesList.json",t.next=5,js(e+"/profilesList.json");case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zs(){return(zs=a(regeneratorRuntime.mark((function t(e,n,r,i){var o,a,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===r&&(r=null),void 0===i&&(i=!0),e){t.next=4;break}throw new Error("No xrInputSource supplied");case 4:if(n){t.next=6;break}throw new Error("No basePath supplied");case 6:return t.next=8,Gs(n);case 8:if(o=t.sent,e.profiles.some((function(t){var e=o[t];return e&&(a={profileId:t,profilePath:n+"/"+e.path,deprecated:!!e.deprecated}),!!a})),a){t.next=17;break}if(r){t.next=13;break}throw new Error("No matching profile name found");case 13:if(s=o[r]){t.next=16;break}throw new Error('No matching profile name found and default profile "'+r+'" missing.');case 16:a={profileId:r,profilePath:n+"/"+s.path,deprecated:!!s.deprecated};case 17:return t.next=19,js(a.profilePath);case 19:if(c=t.sent,!i){t.next=25;break}if(l="any"===e.handedness?c.layouts[Object.keys(c.layouts)[0]]:c.layouts[e.handedness]){t.next=24;break}throw new Error("No matching handedness, "+e.handedness+", in profile "+a.profileId);case 24:l.assetPath&&(u=a.profilePath.replace("profile.json",l.assetPath));case 25:return t.abrupt("return",{profile:c,assetPath:u});case 26:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var qs=function(){function t(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Fs.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(Hs)}return t.prototype.updateFromComponent=function(t){var e=t.xAxis,n=t.yAxis,r=t.button,i=t.state,o=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var n=t,r=e;if(Math.sqrt(t*t+e*e)>1){var i=Math.atan2(e,t);n=Math.cos(i),r=Math.sin(i)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5}}(e,n),a=o.normalizedXAxis,s=o.normalizedYAxis;switch(this.componentProperty){case Fs.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?a:.5;break;case Fs.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case Fs.ComponentProperty.BUTTON:this.value=this.states.includes(i)?r:0;break;case Fs.ComponentProperty.STATE:this.valueNodeProperty===Fs.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty "+this.componentProperty)}},t}(),Ws=function(){function t(t,e){var n=this;if(!(t&&e&&e.visualResponses&&e.gamepadIndices&&0!==Object.keys(e.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach((function(t){var r=new qs(e.visualResponses[t]);n.visualResponses[t]=r})),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Fs.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}return t.prototype.updateFromGamepad=function(t){var e=this;if(this.values.state=Fs.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&t.buttons.length>this.gamepadIndices.button){var n=t.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||1===this.values.button?this.values.state=Fs.ComponentState.PRESSED:(n.touched||this.values.button>Fs.ButtonTouchThreshold)&&(this.values.state=Fs.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Fs.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Fs.AxisTouchThreshold&&(this.values.state=Fs.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Fs.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Fs.AxisTouchThreshold&&(this.values.state=Fs.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((function(t){t.updateFromComponent(e.values)}))},c(t,[{key:"data",get:function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:this.id},this.values)}}]),t}(),Ks=function(){function t(t,e,n){var r=this;if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((function(t){var e=r.layoutDescription.components[t];r.components[t]=new Ws(t,e)})),this.updateFromGamepad()}return t.prototype.updateFromGamepad=function(){var t=this;Object.values(this.components).forEach((function(e){e.updateFromGamepad(t.xrInputSource.gamepad)}))},c(t,[{key:"gripSpace",get:function(){return this.xrInputSource.gripSpace}},{key:"targetRaySpace",get:function(){return this.xrInputSource.targetRaySpace}},{key:"data",get:function(){var t=[];return Object.values(this.components).forEach((function(e){t.push(e.data)})),t}}]),t}(),Xs=function(t){function e(){var e;return(e=t.call(this)||this).motionController=null,e.envMap=null,e}d(e,t);var n=e.prototype;return n.setEnvironmentMap=function(t){var e=this;return this.envMap==t||(this.envMap=t,this.traverse((function(t){t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)}))),this},n.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((function(t){Object.values(t.visualResponses).forEach((function(t){var e=t.valueNode,n=t.minNode,r=t.maxNode,i=t.value,o=t.valueNodeProperty;e&&(o===Fs.VisualResponseProperty.VISIBILITY?e.visible=i:o===Fs.VisualResponseProperty.TRANSFORM&&(e.quaternion.slerpQuaternions(n.quaternion,r.quaternion,i),e.position.lerpVectors(n.position,r.position,i)))}))})))},e}(THREE.Object3D);function Js(t,e){!function(t,e){Object.values(t.components).forEach((function(t){var n=t.type,r=t.touchPointNodeName,i=t.visualResponses;if(n===Fs.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){var o=new THREE.SphereGeometry(.001),a=new THREE.MeshBasicMaterial({color:255}),s=new THREE.Mesh(o,a);t.touchPointNode.add(s)}else console.warn("Could not find touch dot, "+t.touchPointNodeName+", in touchpad component "+t.id);Object.values(i).forEach((function(t){var n=t.valueNodeName,r=t.minNodeName,i=t.maxNodeName;if(t.valueNodeProperty===Fs.VisualResponseProperty.TRANSFORM){if(t.minNode=e.getObjectByName(r),t.maxNode=e.getObjectByName(i),!t.minNode)return void console.warn("Could not find "+r+" in the model");if(!t.maxNode)return void console.warn("Could not find "+i+" in the model")}t.valueNode=e.getObjectByName(n),t.valueNode||console.warn("Could not find "+n+" in the model")}))}))}(t.motionController,e),t.envMap&&e.traverse((function(e){e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)})),t.add(e)}var Ys=function(){function t(t){void 0===t&&(t=null),this.gltfLoader=t,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new qa)}return t.prototype.createControllerModel=function(t){var e=this,n=new Xs,r=null;return t.addEventListener("connected",(function(t){var i=t.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&function(t,e,n,r){return zs.apply(this,arguments)}(i,e.path,"generic-trigger").then((function(t){var o=t.profile,a=t.assetPath;n.motionController=new Ks(i,o,a);var s=e._assetCache[n.motionController.assetUrl];if(s)r=s.scene.clone(),Js(n,r);else{if(!e.gltfLoader)throw new Error("GLTFLoader not set.");e.gltfLoader.setPath(""),e.gltfLoader.load(n.motionController.assetUrl,(function(t){e._assetCache[n.motionController.assetUrl]=t,r=t.scene.clone(),Js(n,r)}),null,(function(){throw new Error("Asset "+n.motionController.assetUrl+" missing or malformed.")}))}})).catch((function(t){console.warn(t)}))})),t.addEventListener("disconnected",(function(){n.motionController=null,n.remove(r),r=null})),n},t}(),$s=new THREE.Vector3,Zs=new THREE.Vector3(0,-1,0),tc={type:qe,orientation:{latitude:0,longitude:0},zoom:1,cameraGroup:{position:[0,0,0],rotation:[0,0,0]},pointer:[0,0,0]},ec=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var t=this;gi.host=this,this.defaultTexture=zi.gridTexture,this.index=0,this.error_=null,this.loading=null,this.waiting=null,this.avatars={},this.createScene(),this.setView(),this.addListeners(),this.animate(),Ei.keys$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.keys=e}))},o.onDestroy=function(){this.removeListeners(),this.renderer.setAnimationLoop((function(){}))},o.createScene=function(){var e=this,n=t.getContext(this).node;this.size={left:0,top:0,width:0,height:0,aspect:0},this.mouse=new THREE.Vector2,this.controllerMatrix_=new THREE.Matrix4,this.controllerWorldPosition_=new THREE.Vector3,this.controllerWorldDirection_=new THREE.Vector3;var i=this.container=n,o=(this.info=n.querySelector(".world__info"),this.worldRect=Ii.fromNode(i),this.cameraRect=new Ii,this.cameraGroup=new THREE.Group),a=this.camera=new THREE.PerspectiveCamera(70,i.offsetWidth/i.offsetHeight,.01,1e3);a.target=new THREE.Vector3,o.add(a);this.orbitService=new fo(a);var s=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0});s.setClearColor(0,1),s.setPixelRatio(window.devicePixelRatio),s.setSize(i.offsetWidth,i.offsetHeight),s.xr.enabled=!0,s.outputEncoding=THREE.sRGBEncoding,s.toneMapping=THREE.NoToneMapping,s.toneMappingExposure=1,i.childElementCount>0?i.insertBefore(s.domElement,i.children[0]):i.appendChild(s.domElement),(this.raycaster=new THREE.Raycaster).setFromCamera(this.mouse,a);var c=this.scene=new THREE.Scene;c.add(o),de.flags.useTextureEnvironment&&this.addEnvironment();var u=this.objects=new THREE.Group;u.name="[objects]",c.add(u);var l=this.panorama=new yo(s);this.panoramaIntersectObjects=[l.mesh],this.intersectObjects=this.panoramaIntersectObjects,u.add(l.mesh);this.indicator=new So,this.pointer=new So("#ff4332");var d=this.ambient=new THREE.AmbientLight(16777215,1);u.add(d);var h=this.direct=new THREE.DirectionalLight(16777215,1);h.position.set(-40,-40,-40),h.target.position.set(0,0,0),u.add(h),this.addControllers(),this.resize(),Si.progress$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){var n=0===t.count,r=e.view_;r.items&&r.items.forEach((function(t){t.visible=n}))}))},o.addEnvironment=function(){var t=this,e=de.textures.envMap.split("/"),n=e.pop(),r=e.join("/")+"/",i=-1!==n.indexOf(".hdr");(i?new Qi:new THREE.TextureLoader).setPath(de.getPath(r)).load(n,(function(e){i&&e?(e.mapping=THREE.EquirectangularReflectionMapping,t.scene.environment=e):t.setBackground(e)}))},o.addOffCanvasScene=function(t){var e=new Mi(t);this.avatars[t.clientId]=e},o.removeOffCanvasScene=function(t){this.avatars[t.clientId];delete this.avatars[t.clientId]},o.updateOffCanvasScene=function(t){var e=this.avatars[t.clientId];e&&e.update(t)},o.setBackground=function(t){var e=t||this.defaultTexture;e.mapping=THREE.EquirectangularReflectionMapping,e.encoding=THREE.sRGBEncoding,this.scene.environment=e},o.setView=function(){var e=this;if(this.renderer&&this.panorama){var n=this.view_;if(n){null!=zt.state.zoomedId&&zt.patchState({zoomedId:null}),this.views&&this.views.forEach((function(t){return delete t.onUpdateAsset}));var r=this.requestInfoResult;r&&n instanceof Ar&&void 0!==r.gridIndex&&(n.index_=r.gridIndex),n.ready=!1,this.cameraGroup.position.set(0,0,0),this.cameraGroup.rotation.set(0,0,0),n.type.name===pr.Room3d.name?(this.renderer.setClearColor(0,1),this.objects.remove(this.panorama.mesh),this.ambient.visible=!1,this.direct.visible=!1):(this.renderer.setClearColor(0,1),this.objects.add(this.panorama.mesh),this.ambient.visible=!0,this.direct.visible=!0),this.pushChanges(),Ri.cancel(),this.panorama.change(n,this.renderer,(function(r){de.flags.useTextureEnvironment||e.setBackground(r),n.ready=!0,n.onUpdateAsset=function(){e.onViewAssetDidChange()},t.getContext(e)&&e.pushChanges()}),(function(t){e.setViewOrientation(t),Ri.prefetch(t.prefetchAssets)}))}}},o.onViewAssetDidChange=function(){var t=this;this.panorama&&this.panorama.crossfade(this.view,this.renderer,(function(e){de.flags.useTextureEnvironment||t.setBackground(e)}))},o.setViewOrientation=function(t){var e,n=this.requestInfoResult;(this.requestInfoResult=null,this.orbitService)&&(this.orbitService.mode=t.type.name,this.renderer.xr.isPresenting||(n?(e=n.orientation,this.orbitService.setOrientation(e),this.orbitService.zoom=n.zoom,this.camera.updateProjectionMatrix()):t.keepOrientation||(e=t.useLastOrientation?t.lastOrientation:t.orientation,this.orbitService.setOrientation(e),this.orbitService.zoom=t.zoom,this.camera.updateProjectionMatrix())))},o.addControllers=function(){var t=this.controllerGroup=new THREE.Group;this.teleport=new To;this.controllers=[],this.controllerModelFactory=new Ys,this.addController(0),this.addController(1),this.cameraGroup.add(t)},o.addController=function(t){var e=this,n=zt.state.live,r=this.renderer,i=this.controllerGroup,o=r.xr.getController(t),a=this.controllerModelFactory,s=this.teleport,c=this.scene,u=this.camera,l=this.cameraGroup;o.name="[controller"+(t+1)+"]",i.add(o);var d=function(t){switch(t.index){case 0:case 1:break;case 4:Ln.send({type:un})}},h=function(t){e.onModelUp()},f=function(t){e.cameraGroup.rotation.y+=Math.PI/180*45},p=function(t){e.cameraGroup.rotation.y-=Math.PI/180*45},v=function(t){e.onModelDistance(t.y)};o.userData.update=function(){},o.addEventListener("selectstart",(function(t){o.userData.isSelecting=!0,function(t){e.controller=t}(o)})),o.addEventListener("selectend",(function(t){o.userData.isSelecting=!1})),o.addEventListener("connected",(function(s){if(o.add(e.buildController(s.data)),n&&"left"===s.data.handedness){var c=e.phone=new _o;o.add(c.mesh)}if(!n||"right"===s.data.handedness){var u=r.xr.getControllerGrip(t);u.name="[controller-grip"+(t+1)+"]";var l=a.createControllerModel(u);o.userData.model=l,u.add(l),i.add(u)}var m=new Bo(s.data.gamepad);m.on("press",d),m.on("release",h),m.on("left",f),m.on("right",p),m.on("axis",v),o.userData.gamepad=m,o.userData.update=function(){m.update()}})),o.addEventListener("disconnected",(function(e){for(;o.children.length;)o.remove(o.children[0]);for(var n=r.xr.getControllerGrip(t);n.children.length;)n.remove(n.children[0]);i.remove(n),o.userData.update=function(){};var a=o.userData.gamepad;a&&(a.off("press",d),a.off("release",h),a.off("left",f),a.off("right",p),a.off("axis",v),delete o.userData.gamepad),s.removeFromController(o,c,r,u,l)})),o.addEventListener("squeezestart",(function(t){e.view&&e.view.type.name===pr.Room3d.name&&(s.addToController(o,c),e.indicator.mesh.visible=!1,o.children[0].visible=!1)})),o.addEventListener("squeezeend",(function(t){s.removeFromController(o,c,r,u,l),e.indicator.mesh.visible=!0,o.children[0].visible=!0})),this.controllers.push(o)},o.buildController=function(t){var e,n;switch(t.targetRayMode){case"tracked-pointer":return(e=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new THREE.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),new THREE.Line(e,n);case"gaze":return e=new THREE.RingBufferGeometry(.02,.04,32).translate(0,0,-1),n=new THREE.MeshBasicMaterial({opacity:.5,transparent:!0}),new THREE.Mesh(e,n)}},o.onModelDown=function(t){var e=this.controller;if(e&&this.renderer.xr.isPresenting){var n=this.tempTarget=t.mesh,r=(this.tempParent=n.parent,new THREE.Vector3);n.localToWorld(r),e.worldToLocal(r),e.add(n),n.position.copy(r)}},o.onModelDistance=function(t){var e=this.controller,n=this.tempTarget;if(e&&n&&this.renderer.xr.isPresenting){var r=new THREE.Vector3;r=r.copy(n.position);var i=Math.max(1,Math.min(8,r.distanceTo($s)+.02*t));r.normalize(),r=r.multiplyScalar(i),n.position.copy(r)}},o.onModelUp=function(){var t=this.tempTarget,e=this.tempParent;if(t&&e){var n=new THREE.Vector3;t.localToWorld(n),e.worldToLocal(n),e.add(t),t.position.copy(n),this.tempTarget=null,this.tempParent=null}},o.updateRaycasterXR=function(t,e){if(t)return this.controllerMatrix_.identity().extractRotation(t.matrixWorld),e.ray.origin.setFromMatrixPosition(t.matrixWorld),e.ray.direction.set(0,0,-1).applyMatrix4(this.controllerMatrix_),e},o.repos=function(t,e){var n=this.worldRect;t.scale.set(.8,.8,.8);var r=(e.x+e.width/2-n.width/2)/n.width*2*this.camera.aspect,i=(e.y+e.height/2-n.height/2)/n.height*2*this.camera.aspect;t.position.set(r,-i,0)},o.render=function(t){try{var e=this.renderer,n=this.scene,r=this.camera,i=this.avatars,o=e.xr.isPresenting;if(!o&&zt.state.mode===vn)return;o?(gsap.ticker.tick(),this.controllers.forEach((function(t){return t.userData.update()})),this.teleport.update()):this.navWithKeys(),this.orbitService.render();var a=performance.now(),s=this.tick_?++this.tick_:this.tick_=1;n.traverse((function(t){var i=t.userData.render;"function"==typeof i&&i(a,s,e,n,r)})),Object.keys(i).forEach((function(t){i[t].render()})),this.vrService.updateState(this),this.raycasterXRHitTest(),e.render(n,r)}catch(t){this.error=t}},o.navWithKeys=function(){if(this.view&&this.view.type.name===pr.Room3d.name&&this.view.mesh&&!this.locked&&!Yn.hasModal){this.intersectObjects=this.view.intersectObjects;var t=this.velocity||(this.velocity=new THREE.Vector3),e=this.direction||(this.direction=new THREE.Vector3),n=this.camera,r=.1;if(this.keys.w||this.keys.ArrowUp)n.getWorldDirection(e),e.multiplyScalar(r),t.copy(e);else if(this.keys.s||this.keys.ArrowDown)n.getWorldDirection(e),e.multiplyScalar(-.1),t.copy(e);else if(this.keys.d||this.keys.ArrowRight){n.getWorldDirection(e),e.multiplyScalar(r);var i=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),o=-Math.PI/2;e.applyAxisAngle(i,o),t.copy(e)}else if(this.keys.a||this.keys.ArrowLeft){n.getWorldDirection(e),e.multiplyScalar(-.1);var a=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),s=-Math.PI/2;e.applyAxisAngle(a,s),t.copy(e)}if(t.manhattanLength()>1e-5){e.copy(this.cameraGroup.position),e.add(t),e.y=0;var c=this.raycaster;c.set(e,Zs),c.intersectObjects(this.view.navIntersectObjects).length&&(this.cameraGroup.position.add(t),this.cameraGroup.position.y=0,this.orbitService.markAsDirty()),t.lerp($s,.1)}else t.set(0,0,0)}else this.intersectObjects=this.panoramaIntersectObjects},o.animate=function(){this.renderer.setAnimationLoop(this.render)},o.resize=function(){try{var t=this.container,e=this.renderer,n=this.camera,r=this.size,i=t.getBoundingClientRect();if(r.left=Math.floor(i.left),r.top=Math.floor(i.top),r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),r.aspect=r.width/r.height,this.worldRect.setSize(r.width,r.height),!e.xr.isPresenting&&(e.setSize(r.width,r.height),n)){n.aspect=r.width/r.height;var o=n.fov*Math.PI/180,a=Math.abs(n.position.z*Math.tan(o/2)*2),s=this.cameraRect;s.width=a*n.aspect,s.height=a,n.updateProjectionMatrix()}}catch(t){this.error=t}},o.updateRaycasterMouse=function(t){var e=this.size.width/2,n=this.size.height/2;this.mouse.x=(t.clientX-this.size.left-e)/e,this.mouse.y=-(t.clientY-this.size.top-n)/n;var r=this.raycaster;return r.setFromCamera(this.mouse,this.camera),r},o.raycasterXRHitTest=function(){if(this.renderer.xr.isPresenting&&!this.locked){var t=this.updateRaycasterXR(this.controller,this.raycaster);if(t){Ai.hittest(t,this.controller.userData.isSelecting);this.indicator.update(this.renderer.xr.getCamera(this.camera))}}},o.raycasterDesktopHitTest=function(t){var e=this.updateRaycasterMouse(t);if(!this.lockedOrXR)if(this.dragItem){if("function"==typeof this.dragItem.onDragMove){var n=e.intersectObjects(this.intersectObjects);if(n.length){var r=n[0],i=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),o=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),a=i.copy(r.point),s=o.copy(r.face.normal);this.dragItem.onDragMove(a,s,this.intersectObjects===this.panoramaIntersectObjects)}}}else if(this.resizeItem);else{Ai.hittest(e);this.controlEvent$.next(tc)}},o.onMouseDown=function(t){try{if(this.locked)return;if(0!==t.button)return;var e=this.updateRaycasterMouse(t);Ai.hittest(e,!0);if(this.editor||ee)if(this.keys.Shift||this.keys.Control);else{this.select.next({item:null});var n=e.intersectObjects(this.intersectObjects);if(n.length){var r=n[0],i=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),o=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),a=i.copy(r.point),s=o.copy(r.face.normal);this.viewHit.next({position:a,normal:s,spherical:this.intersectObjects===this.panoramaIntersectObjects})}}}catch(t){this.error=t}},o.onMouseMove=function(t){try{this.raycasterDesktopHitTest(t)}catch(t){this.error=t}},o.onMouseUp=function(t){try{if(this.lockedOrXR)return;this.dragItem&&"function"==typeof this.dragItem.onDragEnd&&(this.dragItem.onDragEnd(),this.dragEnd.next(this.dragItem)),this.dragItem=null,this.resizeItem&&"function"==typeof this.resizeItem.onResizeEnd&&(this.resizeItem.onResizeEnd(),this.resizeEnd.next(this.resizeItem)),this.resizeItem=null;var e=this.updateRaycasterMouse(t);Ai.hittest(e,!1);this.checkSelectedItem()}catch(t){this.error=t}},o.onMouseWheel=function(t){try{if(this.lockedOrXR)return;var e=t.deltaY*(void 0!==t.wheelDeltaY?1:37),n=this.orbitService;gsap.to(n,{duration:.5,zoom:n.zoom+.1*e,ease:Power4.easeOut,overwrite:!0})}catch(t){this.error=t}},o.onOrientationDidChange=function(){this.controlEvent$.next(tc)},o.checkSelectedItem=function(){if(this.view){var t=this.view.items.find((function(t){return t.selected}));t&&t.mesh&&"model"!==this.view.type.name&&this.orbitService.lookAt(t.mesh)}},o.onVRStarted=function(){this.objects.position.y=1.3,this.scene.add(this.indicator.mesh),Ln.send({type:an})},o.onVREnded=function(){this.objects.position.y=0,this.cameraGroup.rotation.y=0,this.cameraGroup.position.y=0,this.scene.remove(this.indicator.mesh),this.orbitService.markAsDirty(),Ln.send({type:sn})},o.onVRStateDidChange=function(t){Ln.send({type:cn,camera:t.camera.array})},o.onMenuNav=function(t){this.menu=void 0,this.navTo.next({viewId:t.id})},o.onMenuToggle=function(t){this.locked||(this.menu=t,this.view.items.forEach((function(t){return t.showPanel=!1})),this.pushChanges())},o.onNavOver=function(t){this.menu||(this.view.items.forEach((function(t){return t.showPanel=!1})),t.item.to&&clearTimeout(t.item.to),t.item.showPanel=t.shouldShowPanel(),this.pushChanges(),Ln.send({type:Ke,itemId:t.item.showPanel?t.item.id:null}))},o.onNavOut=function(t){var e=this;t.item.to=setTimeout((function(){t.item.showPanel=!1,e.pushChanges()}),4e3),this.pushChanges()},o.onNavDown=function(t){t.item.showPanel=!1,this.locked||(this.editor&&this.keys.Shift?(this.dragItem=t,this.select.next(t)):this.editor&&this.keys.Control?(this.resizeItem=t,this.select.next(t)):this.navTo.next(t.item))},o.onNavLink=function(t){this.locked||(de.flags.useIframe?(Ln.send({type:rn,itemId:t.id}),this.navLink.next(t)):window.open(t.link.href,"_blank"))},o.onPanelDown=function(t){this.locked||(de.flags.useIframe?(Ln.send({type:rn,itemId:t.id}),this.navLink.next(t)):window.open(t.link.href,"_blank"))},o.onObjectDown=function(t){this.lockedOrXR||(this.editor&&this.keys.Shift?(this.dragItem=t,this.select.next(t)):this.editor&&this.keys.Control&&(this.resizeItem=t,this.select.next(t)))},o.onPlayMedia=function(t){Ln.send({type:Xe,itemId:t.itemId,playing:t.playing})},o.onZoomMedia=function(t){t.zoomed&&this.view.items.forEach((function(e){e.mesh instanceof Ji&&e.id!==t.itemId&&e.mesh.setZoomedState(!1)})),this.view.items.forEach((function(t){return t.showPanel=!1})),zt.patchState({zoomedId:t.zoomed?t.itemId:null}),Ln.send({type:Je,itemId:t.itemId,zoomed:t.zoomed})},o.onCurrentTimeMedia=function(t){Ln.send({type:Ye,itemId:t.itemId,currentTime:t.currentTime})},o.onPlayModel=function(t){Ln.send({type:$e,itemId:t.itemId,actionIndex:t.actionIndex})},o.onGridMove=function(t){var e=this;this.view.items=[],this.pushChanges(),this.orbitService.walk(t.position,(function(n,r){var i=e.view.getTile(t.indices.x,t.indices.y);i&&e.panorama.crossfade(i,e.renderer,(function(t){de.flags.useTextureEnvironment||e.setBackground(t),e.orbitService.walkComplete(n,r),e.view.updateCurrentItems(),e.pushChanges()}))}))},o.onGridNav=function(t){this.locked||(Ln.send({type:nn,viewId:this.view.id,gridIndex:t}),this.pushChanges())},o.control$=function(){var t=this;return this.controlEvent$.pipe(r.filter((function(){return t.controlling||t.spyed||t.editor})),r.auditTime(40),r.tap((function(e){e.orientation.latitude=t.orbitService.latitude,e.orientation.longitude=t.orbitService.longitude,e.zoom=t.orbitService.zoom,e.cameraGroup={position:t.cameraGroup.position.toArray(),rotation:t.cameraGroup.rotation.toArray()};var n=t.raycaster.intersectObjects(t.intersectObjects),r=n.length?n[0].point.normalize():null;r&&(e.pointer[0]=r.x,e.pointer[1]=r.y,e.pointer[2]=r.z),Ln.send(e)})))},o.addListeners=function(){var t=this;this.controlEvent$=new n.ReplaySubject(1),this.control$().pipe(r.takeUntil(this.unsubscribe$)).subscribe();var e=this.vrService=ko.getService();e.session$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.renderer.xr.setSession(e),e?t.onVRStarted():t.onVREnded()})),e.state$.pipe(r.takeUntil(this.unsubscribe$),r.auditTime(Math.floor(1e3/15))).subscribe((function(e){t.onVRStateDidChange(e)})),this.orbitService.observe$(this.container).pipe(r.shareReplay(1)).pipe(r.filter((function(t){return t instanceof co})),r.auditTime(Math.floor(1e3/15))).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.onOrientationDidChange()})),Ln.out$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case He:e.type=je,e.viewId=t.view.id,e.orientation=t.orbitService.getOrientation(),e.zoom=t.orbitService.zoom,e.cameraGroup={position:t.cameraGroup.position.toArray(),rotation:t.cameraGroup.rotation.toArray()},t.view instanceof Ar&&(e.gridIndex=t.view.index),Ln.sendBack(e),zt.state.role!==qt.Publisher&&zt.patchState({spying:e.remoteId});break;case je:ri.viewId!==e.viewId?(ri.viewId=e.viewId,t.requestInfoResult=e):(t.renderer.xr.isPresenting||(t.orbitService.setOrientation(e.orientation),t.orbitService.zoom=e.zoom,t.cameraGroup.position.set(e.cameraGroup.position[0],e.cameraGroup.position[1],e.cameraGroup.position[2]),t.cameraGroup.rotation.set(e.cameraGroup.rotation[0],e.cameraGroup.rotation[1],e.cameraGroup.rotation[2])),t.view instanceof Ar&&e.gridIndex&&(t.view.index=e.gridIndex),t.view&&t.view.ready||(t.requestInfoResult=e));break;case Ke:t.menu&&t.menu.removeMenu(),t.view.items.forEach((function(t){return t.showPanel=t.id===e.itemId})),t.pushChanges();break;case rn:var n=t.view.items.find((function(t){return t.id===e.itemId}));n&&t.navLink.next(n);break;case on:t.view.items.find((function(t){return t.id===e.itemId}))&&Yn.resolve();break;case Xe:var r=t.view.items.find((function(t){return t.id===e.itemId}));r&&r.mesh instanceof Ji&&r.mesh.setPlayingState(e.playing);break;case Je:t.view.items.forEach((function(t){t.mesh instanceof Ji&&(t.id===e.itemId?t.mesh.setZoomedState(e.zoomed):t.mesh.setZoomedState(!1))})),zt.patchState({zoomedId:e.zoomed?e.itemId:null});break;case Ye:var i=t.view.items.find((function(t){return t.id===e.itemId}));i&&i.mesh instanceof Ji&&i.mesh.setCurrentTime(e.currentTime);break;case $e:var o=t.view.items.find((function(t){return t.id===e.itemId}));o&&o.onMessage(e);break;case nn:t.view.id===e.viewId&&(t.view.index=e.gridIndex);break;case an:t.addOffCanvasScene(e);break;case sn:t.removeOffCanvasScene(e);break;case cn:t.updateOffCanvasScene(e),zt.state.spying!==e.clientId&&zt.state.controlling!==e.clientId||t.orbitService.setVRCamera(e.camera);break;case qe:t.renderer.xr.isPresenting||(t.orbitService.setOrientation(e.orientation),t.orbitService.zoom=e.zoom,t.cameraGroup.position.set(e.cameraGroup.position[0],e.cameraGroup.position[1],e.cameraGroup.position[2]),t.cameraGroup.rotation.set(e.cameraGroup.rotation[0],e.cameraGroup.rotation[1],e.cameraGroup.rotation[2])),t.pointer.setPosition(e.pointer[0],e.pointer[1],e.pointer[2],t.camera)}})),Ln.in$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case fn:t.checkSelectedItem()}})),zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.showPointer=t.locked})),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),window.addEventListener("resize",this.resize,!1),this.container.addEventListener("wheel",this.onMouseWheel,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1),this.container.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1)},o.removeListeners=function(){window.removeEventListener("resize",this.resize,!1),window.removeEventListener("resize",this.resize,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("wheel",this.onMouseWheel,!1),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("mouseup",this.onMouseUp,!1)},c(i,[{key:"error",get:function(){return this.error_},set:function(t){this.error_!==t&&(this.error_=t,this.pushChanges())}},{key:"view",get:function(){return this.view_},set:function(t){this.view_!==t&&(this.view_=t,this.setView())}},{key:"debugging",get:function(){return ee}},{key:"controlled",get:function(){return zt.state.controlling&&zt.state.controlling!==zt.state.uid}},{key:"controlling",get:function(){return zt.state.controlling&&zt.state.controlling===zt.state.uid}},{key:"silencing",get:function(){return zt.state.silencing}},{key:"silenced",get:function(){return zt.state.silencing&&zt.state.role===qt.Streamer}},{key:"spyed",get:function(){return zt.state.spying&&zt.state.spying===zt.state.uid}},{key:"spying",get:function(){return zt.state.spying&&zt.state.spying!==zt.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"lockedOrXR",get:function(){return this.locked||this.renderer.xr.isPresenting}},{key:"showMenu",get:function(){return zt.state.hosted&&zt.state.navigable&&("embed"!==zt.state.mode||de.flags.menuEmbed)}},{key:"showPointer",get:function(){return null!=this.pointer.mesh.parent},set:function(t){this.showPointer!==t&&(t?this.scene.add(this.pointer.mesh):this.scene.remove(this.pointer.mesh))}},{key:"menu",set:function(t){this.menu_!==t&&(this.menu_=t,this.scene.traverse((function(e){(e instanceof Ji||e instanceof qi)&&(e.freezed=null!=t)})))},get:function(){return this.menu_}}]),i}(t.Component);ec.meta={selector:"[world]",inputs:["view","views","editor"],outputs:["navTo","navLink","viewHit","dragEnd","resizeEnd","select"],template:'\n\t<div class="world__view" *if="view">\n\t\t<div class="grid" model-grid *if="view.type.name === \'panorama-grid\'" [view]="view" (move)="onGridMove($event)" (nav)="onGridNav($event)"></div>\n\t\t<div *if="view.ready">\n\t\t\t<div model-room [view]="view" *if="view.type.name === \'room-3d\'"></div>\n\t\t\t<div class="world__item" *for="let item of view.pathItems; let index = index;">\n\t\t\t\t<div model-nav [item]="item" [view]="view" (over)="onNavOver($event)" (out)="onNavOut($event)" (down)="onNavDown($event)" (link)="onNavLink($event)" *if="item.type.name == \'nav\'"></div>\n\t\t\t\t<div model-plane [item]="item" [view]="view" (play)="onPlayMedia($event)" (zoom)="onZoomMedia($event)" (currentTime)="onCurrentTimeMedia($event)" *if="item.type.name == \'plane\'"></div>\n\t\t\t\t<div model-curved-plane [item]="item" [view]="view" (play)="onPlayMedia($event)" (zoom)="onZoomMedia($event)" (currentTime)="onCurrentTimeMedia($event)" *if="item.type.name == \'curved-plane\'"></div>\n\t\t\t\t<div class="model-viewer__item" model-model [item]="item" [view]="view" (down)="onModelDown($event)" (play)="onPlayModel($event)" *if="item.type.name == \'model\'"></div>\n\t\t\t\t<div class="panel" [class]="{ \'panel--lg\': item.asset != null }" model-panel [item]="item" (down)="onPanelDown($event)" *if="item.showPanel">\n\t\t\t\t\t<div class="panel__title" [innerHTML]="item.title"></div>\n\t\t\t\t\t<div class="panel__abstract" [innerHTML]="item.abstract"></div>\n\t\t\t\t\t<img class="panel__picture" [src]="item.asset | asset" *if="item.asset">\n\t\t\t\t\t<a class="panel__link" [href]="item.link.href" target="_blank" rel="noopener" *if="item.link" [innerHTML]="item.link.title"></a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="progress-indicator" model-progress [view]="view">\n\t\t<div class="inner"></div>\n\t</div>\n\t<div model-menu [views]="views" (nav)="onMenuNav($event)" (toggle)="onMenuToggle($event)" *if="showMenu">\n\t\t<div class="btn--menu" (mousedown)="onToggle($event)">\n\t\t\t<svg class="menu-light" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu-light"></use></svg>\n\t\t\t<div class="btn--menu__spinner"></div>\n\t\t\t<svg class="bullets" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu"></use></svg>\n\t\t\t<svg class="progress" width="50" height="50" viewBox="0 0 50 50">\n\t\t\t\t<circle id="circle" r="23" cx="25" cy="25" fill="transparent"></circle>\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n\t<div model-debug *if="debugging"></div>\n\t<div class="world__info" *if="error" [innerHTML]="error"></div>\n\t'};var nc=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){var t=this;if(!this.host)throw"ModelComponent host is undefined";this.scale=new THREE.Vector3(1,1,1),this.position=new THREE.Vector3;var e=this.group=new THREE.Group;e.name=this.getName(),e.userData.render=function(e,n){t.render(t,e,n)},this.getContainer().add(e),this.onCreate((function(e,n){return t.onMount(e,n)}),(function(e,n){return t.onDismount(e,n)}))},r.onDestroy=function(){var t=this.group;this.getContainer().remove(t),delete t.userData.render,this.disposeObject(t),this.group=null},r.getContainer=function(){return this.host.objects},r.getName=function(t){return this.constructor.meta.selector+"-"+this.rxcompId+(t?"-"+t:"")},r.onCreate=function(t,e){var n=new THREE.MeshStandardMaterial({color:new THREE.Color("#ffcc00"),roughness:.4,metalness:.01,flatShading:!0,transparent:!0,opacity:.9}),r=new THREE.Mesh(mi.defaultGeometry,n);return"function"==typeof t&&t(r),r},r.onMount=function(t,e){var n=this;this.mesh&&this.onDismount(this.mesh),t.name=this.getName("mesh"),this.mesh=t,e&&(e.mesh=t,Object.defineProperty(e,"visible",{get:function(){return t.visible},set:function(t){n.setVisible(t)},configurable:!0}),e.onUpdate=function(){n.onUpdate(e,t)},e.onUpdateAsset=function(){n.onUpdateAsset(e,t)},e.onMessage=function(t){n.onMessage(t)}),this.group&&this.group.add(t)},r.onDismount=function(t,e){this.group.remove(t),"function"==typeof t.dispose&&t.dispose(),this.disposeObject(t),this.mesh=null,e&&(delete e.mesh,delete e.onUpdate,delete e.onUpdateAsset,delete e.onMessage)},r.disposeObject=function(t){t.traverse((function(t){(t.isInteractiveMesh||t.isInteractiveSprite)&&Ai.dispose(t),t.isMesh?(t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose(),t.geometry.dispose()):t.isSprite&&(t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose())}))},r.calculateScaleAndPosition=function(){var e=t.getContext(this).node;this.host.repos(this,e.getBoundingClientRect())},r.render=function(t,e){},r.setVisible=function(t){this.mesh&&(this.mesh.visible=t)},r.getScroll=function(t){return this.intersection.scroll(t)},r.getTween=function(t){var e=Math.min(0,this.intersection.offset(t))+1;return e=Math.max(0,e),e-=1},r.onUpdate=function(t,e){},r.onUpdateAsset=function(t,e){},r.onMessage=function(t){},c(n,[{key:"renderOrder",set:function(t){this.group.renderOrder=t}}]),n}(t.Component);nc.meta={selector:"[model]",hosts:{host:ec},inputs:["item"]};var rc=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){t.prototype.onInit.call(this),this.RADIUS=100},n.onDestroy=function(){this.editing=!1,t.prototype.onDestroy.call(this)},n.setHelper=function(t){t?(this.helper||(this.helper=new THREE.BoxHelper(this.mesh,65280)),this.host.scene.add(this.helper)):this.helper&&this.host.scene.remove(this.helper)},n.updateHelper=function(){this.helper&&this.helper.setFromObject(this.mesh)},c(e,[{key:"editing",get:function(){return this.editing_},set:function(t){this.editing_!==t&&(this.editing_=t,this.setHelper(t))}}]),e}(nc);rc.meta={selector:"[model-editable]",hosts:{host:ec},inputs:["item"]};var ic="none",oc="move",ac="info",sc="point",cc="title",uc="transparent",lc="wishlist",dc=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return u(h(e=t.call.apply(t,[this].concat(r))||this),"hidden_",!1),e}d(e,t),e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getTexturePoint=function(){return e.texturePoint||(e.texturePoint=e.getLoader().load(de.getPath("textures/ui/nav-point.png")))},e.getTexturePointImportant=function(){return e.texturePointImportant||(e.texturePointImportant=e.getLoader().load(de.getPath("textures/ui/nav-point-important.png")))},e.getTextureMove=function(){return e.textureMove||(e.textureMove=e.getLoader().load(de.getPath("textures/ui/nav-more.png")))},e.getTextureMoveImportant=function(){return e.textureMoveImportant||(e.textureMoveImportant=e.getLoader().load(de.getPath("textures/ui/nav-more-important.png")))},e.getTextureInfo=function(){return e.textureInfo||(e.textureInfo=e.getLoader().load(de.getPath("textures/ui/nav-info.png")))},e.getTextureInfoImportant=function(){return e.textureInfoImportant||(e.textureInfoImportant=e.getLoader().load(de.getPath("textures/ui/nav-info-important.png")))},e.getTextureWishlist=function(){return e.textureWishlist||(e.textureWishlist=e.getLoader().load(de.getPath("textures/ui/nav-wishlist-off.png")))},e.getTextureWishlistAdded=function(){return e.textureWishlistAdded||(e.textureWishlistAdded=e.getLoader().load(de.getPath("textures/ui/nav-wishlist-on.png")))},e.getTexture=function(t,e){var n;switch(t){case oc:n=e.important?this.getTextureMoveImportant():this.getTextureMove();break;case ac:n=e.important?this.getTextureInfoImportant():this.getTextureInfo();break;case sc:case cc:n=e.important?this.getTexturePointImportant():this.getTexturePoint();break;case lc:n=e.added?this.getTextureWishlistAdded():this.getTextureWishlist()}return n.disposable=!1,n.encoding=THREE.sRGBEncoding,n},e.getTitleTexture=function(t,e){var n;if(e===cc){var r=t.title,i=document.createElement("canvas");i.width=512,i.height=32;var o=i.getContext("2d");o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.font="24px "+de.fontFamily;var a=o.measureText(r).width+8,s=(a=Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))))/2;i.width=a,o.font="24px "+de.fontFamily,o.textAlign="center",o.textBaseline="middle",o.strokeStyle="rgba(0, 0, 0, 0.5)",o.lineWidth=6,o.lineJoin="round",o.miterLimit=2,o.strokeText(r,s,16),o.fillStyle="white",o.fillText(r,s,16),n=new THREE.CanvasTexture(i)}return n},e.getNavMode=function(t,e){var n=ic;return t.hook&&"ToggleWishlist"===t.hook?n=lc:t.transparent?n=uc:t.viewId!==e.id?(n=oc,this.isValidText(t.title)&&(n=cc),(this.isValidText(t.abstract)||t.asset&&t.asset.id||t.link&&t.link.href)&&(n=sc)):(this.isValidText(t.title)||this.isValidText(t.abstract)||t.asset&&t.asset.id||t.link&&t.link.href)&&(n=ac),n},e.hasNavInfo=function(t){var e=this;return null!=t.items.find((function(n){return e.getNavMode(n,t)===ac}))},e.isValidText=function(t){return t&&t.length>0};var n=e.prototype;return n.shouldShowPanel=function(){return!this.editing&&this.mode!==oc&&this.mode!==cc&&this.mode!==lc&&(this.mode!==uc||e.isValidText(this.item.title))},n.updateVisibility=function(t){this.mesh&&(this.mesh.visible=t),this.sphere&&(this.sphere.freezed=!t),!t&&this.item&&(this.item.showPanel=!1)},n.setVisible=function(t){this.mesh&&(this.mesh.visible=t&&!this.hidden_)},n.onInit=function(){t.prototype.onInit.call(this)},n.onChanges=function(){var t=this.view,n=this.item;(this.mode=e.getNavMode(n,this.view))===lc&&(n.added=ci.has({viewId:t.id,itemId:n.id}),this.onCreateSprites(this.mesh,1)),this.editing=n.selected,this.hidden=this.isHidden},n.onCreate=function(t,n){var r=this,i=this.view,o=this.item,a=this.mode=e.getNavMode(o,this.view);if(a!==ic){a===lc&&(o.added=ci.has({viewId:i.id,itemId:o.id}));var s=this.isAnimated,c=new THREE.Group;if(a===uc){var u=this.editor?.1:0;c.position.fromArray(o.position),c.rotation.fromArray(o.rotation),c.scale.fromArray(o.scale);var l=mi.planeGeometry,d=this.plane=new wi(l,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:u,color:new THREE.Color(de.colors.menuOverBackground)}));if(d.name="[nav] "+o.id,d.depthTest=!1,c.add(d),s){var h={pow:0};gsap.to(h,{pow:1,duration:.6,delay:.5+.1*o.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:function(){d.material.opacity=.3*h.pow}})}d.on("over",(function(){s||(d.material.opacity=.2),r.over.next(r)})),d.on("out",(function(){s||(d.material.opacity=u),r.out.next(r)})),d.on("down",(function(){s||(d.material.opacity=.3),r.down.next(r),!r.editor&&!r.shouldShowPanel()&&r.item.link&&r.item.link.href&&(r.shouldNavToLink=r.item.link.href)})),d.on("up",(function(){s||(d.material.opacity=u),null!=r.shouldNavToLink&&(r.shouldNavToLink=null,r.link.next(r.item))}))}else{var f=new THREE.Vector3(o.position[0],o.position[1],o.position[2]),p=new THREE.Vector3(o.position[0],o.position[1],o.position[2]).normalize();f.distanceToSquared(p)<1e-4&&f.multiplyScalar(e.RADIUS),c.position.copy(f),this.onCreateSprites(c);var v=mi.sphereGeometry,m=this.sphere=new wi(v,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0,color:65535}));m.name="[nav] "+o.id,m.depthTest=!1,c.add(m);var g={pow:0};gsap.to(g,{pow:1,duration:.7,delay:.5+.1*o.index,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){r.materials.forEach((function(t){t.opacity=g.pow}))},onComplete:function(){if(s){var t=r.icon;g.pow=0,gsap.to(g,{pow:1,duration:.6,delay:.5+.1*o.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:function(){var e=r.iconMinScale+g.pow*(r.iconMaxScale-r.iconMinScale);t.scale.set(e,e,e),t.material.opacity=g.pow}})}}}),m.on("over",(function(){if(r.over.next(r),!s){var t=r.icon,e={scale:t.scale.x};gsap.to(e,{duration:.35,scale:r.iconMaxScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){t.scale.set(e.scale,e.scale,e.scale)}})}})),m.on("out",(function(){if(r.out.next(r),!s){var t=r.icon,e={scale:t.scale.x};gsap.to(e,{duration:.35,scale:r.iconMinScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){t.scale.set(e.scale,e.scale,e.scale)}})}})),m.on("down",(function(){r.down.next(r)}))}"function"==typeof t&&t(c,o)}},n.onCreateSprites=function(t,n){void 0===n&&(n=0),this.onRemoveSprite(this.icon),this.onRemoveSprite(this.title);var r=this.item,i=this.mode=e.getNavMode(r,this.view);if(i!==ic)if(i===uc)this.materials=[];else{var o,a=e.getTexture(i,r),s=new THREE.SpriteMaterial({map:a,depthTest:!1,depthWrite:!1,transparent:!0,sizeAttenuation:!1,opacity:n}),c=[s],u=this.iconMinScale,l=this.icon=new THREE.Sprite(s);l.renderOrder=de.renderOrder.nav,l.scale.set(u,u,u),t.add(l);var d=e.getTitleTexture(r,i);if(d){o=new THREE.SpriteMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:d,sizeAttenuation:!1,opacity:n});var h=d.image,f=this.title=new THREE.Sprite(o);f.scale.set(u*h.width/h.height,u,u),f.position.set(0,-3.5,0),t.add(f),c.push(o)}this.materials=c}},n.onRemoveSprite=function(t){t&&(t.parent&&t.parent.remove(t),t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose())},n.onDestroy=function(){Ai.dispose(this.sphere),t.prototype.onDestroy.call(this)},n.onUpdate=function(t,e){this.item=t,this.onCreateSprites(e,1),this.mode===uc?(t.position&&e.position.fromArray(t.position),t.rotation&&e.rotation.fromArray(t.rotation),t.scale&&e.scale.fromArray(t.scale)):(e.position.fromArray(t.position),e.rotation.set(0,0,0),e.scale.set(1,1,1)),this.updateHelper()},n.onDragMove=function(t,n,r){var i=this.item,o=this.mesh;this.editing=!0,i.showPanel=!1,this.mode===uc?r?(t.normalize().multiplyScalar(e.RADIUS),o.position.set(t.x,t.y,t.z),o.lookAt(gi.origin)):(o.position.set(0,0,0),o.lookAt(n),o.position.set(t.x,t.y,t.z),o.position.add(n.multiplyScalar(.01))):r?(t.normalize().multiplyScalar(e.RADIUS),o.position.set(t.x,t.y,t.z)):(o.position.set(t.x,t.y,t.z),o.position.add(n.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var t=this.item,e=this.mesh;this.mode===uc?(t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray()):t.position=e.position.toArray(),this.editing=!1},c(e,[{key:"hidden",get:function(){return this.hidden_},set:function(t){this.hidden_!==t&&(this.hidden_=t,this.updateVisibility(!t))}},{key:"isHidden",get:function(){return null!=zt.state.zoomedId||de.flags.hideNavInfo&&!this.editor&&!zt.state.showNavInfo&&!(this.host.renderer.xr.isPresenting||zt.state.role===qt.SelfService||zt.state.role===qt.Embed)&&this.mode===ac}},{key:"isAnimated",get:function(){var t=!1,e=this.mode,n=this.item.important;switch(e){case ac:t=n?de.flags.navInfoImportantAnimated:de.flags.navInfoAnimated;break;case oc:t=n?de.flags.navMoveImportantAnimated:de.flags.navMoveAnimated;break;case sc:t=n?de.flags.navPointImportantAnimated:de.flags.navPointAnimated;break;case cc:t=n?de.flags.navTitleImportantAnimated:de.flags.navTitleAnimated;break;case uc:t=n?de.flags.navTransparentImportantAnimated:de.flags.navTransparentAnimated}return t}},{key:"iconMinScale",get:function(){return.03*(de.navs.iconMinScale||1)}},{key:"iconMaxScale",get:function(){return.03*(de.navs.iconMaxScale||1.5)}}]),e}(rc);dc.RADIUS=100,dc.meta={selector:"[model-nav]",hosts:{host:ec},outputs:["over","out","down","link"],inputs:["item","view","editor"]};var hc=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this;console.log("AgoraComponent.onInit",this.host),t.getContext(this).node.classList.remove("hidden"),this.platform=Dn.platform,this.route=this.host?this.host.route:null,this.state={},this.hosted=null,this.view=null,this.previousView=null,this.form=null,this.local=null,this.screen=null,this.remoteScreen_=null,this.navmaps=[],this.navmap=null,this.hasScreenViewItem=!1,this.remotes=[],(this.vrService=ko.getService()).status$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.pushChanges()})),this.resolveUser()},o.getName=function(t){return zt.state.name||Jt.getName(t)},o.getLinkRole=function(){var t=null;if(this.isSelfServiceTour)return t=qt.SelfService;var e=(C.get("link")||"").match(/\d{9}-(\d{4})-\d{13}/);if(e){var n=parseInt(e[1]);t=Object.keys(qt).reduce((function(t,e,r){return r===n?qt[e]:t}),null)}return t},o.resolveUser=function(){var t=this;this.isEmbed?Rn.temporaryUser$(qt.Embed).pipe(r.first()).subscribe((function(e){t.initWithUser(e)})):this.isSelfServiceTour?Rn.temporaryUser$(qt.SelfService).pipe(r.first()).subscribe((function(e){t.initWithUser(e)})):Rn.me$().pipe(r.first()).subscribe((function(e){t.initWithUser(e)}))},o.userGuard=function(t){console.log("AgoraComponent.userGuard",t);var e=this.getLinkRole();!t||e&&t.type!==e?this.initWithUser({type:e}):this.initWithUser(t)},o.userGuardRedirect=function(t){console.log("AgoraComponent.userGuardRedirect",t);var e=this.getLinkRole();!t||e&&e!==t.type?e===qt.Publisher||e===qt.Attendee?Qt.setRouterLink(me.transform(":lang.access")):this.initWithUser({type:e}):this.initWithUser(t)},o.setNextStatus=function(){var t=ye,e=zt.state;return e.role===qt.SmartDevice&&(e.name=e.name||"Smart Device"),t=e.checklist?e.link?e.user.id||e.role!==qt.Publisher&&e.role!==qt.Attendee?e.name?e.role!==qt.Viewer&&e.role!==qt.SmartDevice?Se:Te:_e:Ee:we:be,zt.patchState({status:t}),t},o.getPathId=function(){var t=C.get("pathId")||null;if(t)return parseInt(t);var e=C.get("link")||null;e&&(t=new Xt(e).pathId);return t},o.initWithUser=function(t){var e=this;console.log("AgoraComponent.initWithUser",t);var n=C.get("link")||null,i=this.getPathId(),o=this.getLinkRole()||(t?t.type:null);switch(o){case qt.SelfService:if(!t||t.type!==qt.SelfService&&t.type!==qt.Publisher)return void Qt.setRouterLink(me.transform(":lang.access"));t=Object.assign({},t,{type:qt.SelfService});break;default:o!==(t=t||{type:o}).type&&(t={type:o})}var a=Rn.getMode(o),s=C.get("name")||(t.firstName&&t.lastName?t.firstName+" "+t.lastName:null),c=o===qt.Publisher,u=o!==qt.SelfService&&o!==qt.Embed&&!ee,l=this.isNavigable,d={user:t,role:o,mode:a,name:s,checklist:null,pathId:i,link:n,channelName:de.channelName,uid:null,status:ye,connecting:!1,connected:!1,controlling:!1,spying:!1,silencing:!1,hosted:c,live:u,navigable:l,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};zt.state=d,zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.hosted=t.hosted,e.pushChanges(),e.locked?document.body.classList.add("locked"):document.body.classList.remove("locked")})),this.initAgora()},o.viewObserver$=function(){var t=this;return ri.data$().pipe(r.switchMap((function(t){return console.log("AgoraComponent.viewObserver$","pathId",zt.state.pathId),ur.getCurrentPath$(zt.state.pathId).pipe(r.switchMap((function(e){return ri.hostedView$(t,e)})))})),r.map((function(e){return t.agora&&t.agora.navToView(e.id,e.keepOrientation,e.useLastOrientation),t.previousView=t.view,t.view=e,t.setNavmap(e),t.hasScreenViewItem=null!=e.items.find((function(t){return vi.isPublisherScreen(t)||vi.isAttendeeScreen(t)})),t.pushChanges(),e})))},o.load=function(t){this.loadNavmaps(),this.viewObserver$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){"function"==typeof t&&(t(),t=null)}))},o.loadNavmaps=function(){var t=this;de.flags.navmaps&&Mr.navmapGet$().pipe(r.first()).subscribe((function(e){t.navmaps=e}))},o.setNavmap=function(t){var e=(this.navmaps||[]).find((function(e){return null!=(e.items||[]).find((function(e){return e.viewId===t.id}))}))||null;this.navmap=e},o.toggleNavmap=function(){zt.patchState({showNavmap:!zt.state.showNavmap})},o.onNavmapItem=function(t){zt.patchState({showNavmap:!1}),this.onNavTo(t)},o.loadAndConnect=function(t){var e=this;this.load((function(){e.connect(t)}))},o.initAgora=function(){var t=this;this.state.role===qt.SelfService||this.state.role===qt.Embed||ee?(this.load((function(){zt.patchState({status:xe,hosted:!0})})),this.checkSelfServiceProposition(),this.checkSelfServiceAudio()):tr.isChecked$().pipe(r.first()).subscribe((function(e){zt.patchState({checklist:e}),t.agora=Qn.getSingleton();t.getLinkRole(),t.setNextStatus()})),Gn.local$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.local=e,t.pushChanges()})),Gn.screen$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.screen===t.remoteScreen&&(t.remoteScreen=null),t.screen=e,t.remoteScreen=e||t.remoteScreen,t.pushChanges()})),Gn.orderedRemotes$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.remotes=[],t.remoteScreen=t.screen,e.forEach((function(e){e.clientInfo&&e.clientInfo.screenUid===e.getId()?t.remoteScreen=e:t.remotes.push(e)})),t.pushChanges()})),Ln.out$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case Ie:if(t.isSelfServiceSupport)e.members.length>0?(jr.open$({message:pe.transform("bhere_support_request_sent"),type:Br,position:Ur}),Ln.send({type:Oe})):jr.open$({message:pe.transform("bhere_support_request_leaved"),type:Br,position:Ur});break;case Oe:t.isSelfServiceProposition&&t.openSupportRequestDialog(e.clientInfo);break;case De:e.type=Fe,e.clientInfo={role:zt.state.role,name:zt.state.name,uid:zt.state.uid,screenUid:zt.state.screenUid,controllingId:zt.state.controlling,mode:zt.state.mode},Ln.sendBack(e);break;case Me:jr.open$({message:pe.transform("bhere_support_request_accepted"),type:Br,position:Ur});break;case Le:jr.open$({message:pe.transform("bhere_support_request_rejected"),type:Br,position:Ur});break;case ke:e.type=Be,Ln.sendBack(e),zt.patchState({controlling:e.controllingId}),t.agora&&t.agora.sendControlRemoteRequestInfo(e.controllingId);break;case ze:zt.patchState({silencing:e.silencing}),t.setAudio(e.silencing);break;case en:t.onRemoteNavTo(e);break;case Ze:zt.patchState({mode:e.mode}),window.dispatchEvent(new Event("resize"));break;case tn:t.hidePanels(),zt.patchState({showNavInfo:e.showNavInfo});break;case We:ri.setViewLike$(e).pipe(r.first()).subscribe((function(e){return t.showLove(e)}));break;case ln:zt.state.chat||zt.patchState({chatDirty:!0})}})),Ln.in$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.agora&&t.agora.sendMessage(e)})),this.fullscreen$().pipe(r.takeUntil(this.unsubscribe$)).subscribe(),this.agora&&zt.state.status===Te&&this.loadAndConnect()},o.onChecked=function(t){zt.patchState({checklist:!0}),this.setNextStatus()},o.onLink=function(t){var e=new Xt(t).pathId,n=this.getLinkRole(),r=Rn.getMode(n),i=zt.state.user;n!==qt.Publisher&&n!==qt.Attendee||i.id&&i.type===n?zt.state.name?n===qt.Viewer||n===qt.SmartDevice?(zt.patchState({link:t,pathId:e,role:n,mode:r}),this.loadAndConnect()):zt.patchState({link:t,pathId:e,role:n,mode:r,status:Se}):zt.patchState({link:t,pathId:e,role:n,mode:r,status:_e}):zt.patchState({link:t,pathId:e,role:n,mode:r,status:Ee})},o.onLogin=function(t){var e=this.getName(t);e?zt.patchState({user:t,name:e,status:Se}):zt.patchState({user:t,status:_e})},o.onName=function(t){zt.state.role===qt.Viewer||zt.state.role===qt.SmartDevice?(zt.patchState({name:t}),this.loadAndConnect()):zt.patchState({name:t,status:Se})},o.onEnter=function(t){this.loadAndConnect(t)},o.connect=function(t){if(this.agora.connect$(t).pipe(r.takeUntil(this.unsubscribe$)).subscribe(),this.state.role===qt.SelfService)Lr.push({action:"b-here-tour",userType:this.state.role});else if(this.state.role===qt.Embed)Lr.push({action:"b-here-embed",userType:this.state.role});else{var e=this.state.link.replace(/-\d+-/,"-"),n={meetingId:this.state.link,sharedMeetingId:e,fullName:this.state.name,userType:this.state.role};Rn.log$(n).pipe(r.first()).subscribe(),Lr.push({action:"b-here-meeting",meetingId:this.state.link,sharedMeetingId:e,userType:this.state.role})}},o.disconnect=function(){this.agora?this.agora.leaveChannel().then((function(){window.location.reload()}),console.log):this.patchState({connecting:!1,connected:!1})},o.onNavTo=function(t){var e=t.viewId,n=this.pathViews.find((function(t){return t.id===e}));n&&(ri.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation},this.onHandleHook(n,t))},o.onNavLink=function(t){Yn.open$({iframe:t.link.href}).pipe(r.first()).subscribe((function(e){Ln.send({type:on,itemId:t.id})}))},o.onRemoteNavTo=function(t){var e=t.viewId,n=t.gridIndex;if(e&&ri.viewId!==e){var r=this.pathViews.find((function(t){return t.id===e}));r&&(ri.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation},null!=n&&r instanceof Ar&&(r.index=n))}},o.onHandleHook=function(t,e){var n=this;switch(e.hook){case"ToggleWishlist":var i={viewId:t.id,itemId:e.id};ci.toggle$(i).pipe(r.switchMap((function(t){return i.added=ci.has(i),ai.send$(e.hook,i,e.extra)})),r.first()).subscribe((function(t){console.log("AgoraComponent.onHandleHook",t),e.added=i.added,n.pushChanges()}))}},o.patchState=function(t){this.state=Object.assign({},this.state,t),this.pushChanges()},o.toggleCamera=function(){this.agora?this.agora.toggleCamera():this.patchState({cameraMuted:!this.state.cameraMuted})},o.toggleAudio=function(){this.agora?this.agora.toggleAudio():this.patchState({audioMuted:!this.state.audioMuted})},o.setAudio=function(t){this.agora?this.agora.setAudio(t):this.patchState({audioMuted:t})},o.toggleScreen=function(){this.agora?this.agora.toggleScreen():this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))},o.toggleVolume=function(){var t=!this.state.volumeMuted;zt.patchState({volumeMuted:t});var e=this.selfServiceAudio;e&&(e.volume=t?0:.5)},o.toggleMode=function(){if(this.agora&&zt.state.role===qt.Publisher)this.agora.toggleMode();else{var t=this.state.mode===pn?vn:pn;zt.patchState({mode:t})}window.dispatchEvent(new Event("resize"))},o.toggleFullScreen=function(){var e=t.getContext(this).node;!this.state.fullScreen?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},o.fullscreen$=function(){return n.fromEvent(document,"fullscreenchange").pipe(r.tap((function(t){var e=null!=document.fullscreenElement;zt.patchState({fullScreen:e})})))},o.toggleChat=function(){zt.patchState({chat:!zt.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))},o.onChatClose=function(){zt.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))},o.toggleNavInfo=function(){this.hidePanels(),this.agora?this.agora.toggleNavInfo():this.patchState({showNavInfo:!this.state.showNavInfo})},o.onBack=function(){this.previousView&&this.view&&this.previousView.id!==this.view.id&&(ri.action={viewId:this.previousView.id,useLastOrientation:!0})},o.hidePanels=function(){this.view.items.forEach((function(t){return t.showPanel=!1}))},o.onToggleControl=function(t){if(this.agora)this.agora.toggleControl(t);else{var e=this.state.controlling===t?null:t;this.patchState({controlling:e,spying:!1})}},o.onToggleSilence=function(){this.agora?this.agora.toggleSilence():this.patchState({silencing:!this.state.silencing})},o.onToggleSpy=function(t){if(this.agora)this.agora.toggleSpy(t);else{var e=this.state.spying===t?null:t;this.patchState({spying:e,controlling:!1})}},o.addLike=function(){var t=this;ri.viewLike$(this.view).pipe(r.first()).subscribe((function(e){e&&(t.view.liked=!0,t.showLove(e),Ln.send({type:We,viewId:t.view.id,likes:t.view.likes}))}))},o.showLove=function(t){var e=this;if(t&&this.view.id===t.id){var n=this.view.showLove;this.view.likes=t.likes,this.view.showLove=!0,this.pushChanges(),n||setTimeout((function(){e.view.showLove=!1,e.pushChanges()}),3100)}},o.tryInAr=function(){this.platform===Bn||this.platform===Nn?Gr.openInAR(this.view):Yn.open$({template:Gr.chunk(),data:this.view}).pipe(r.first()).subscribe((function(t){}))},o.checkSelfServiceProposition=function(){var t=this;this.isSelfServiceProposition&&tr.check$().pipe(r.first()).subscribe((function(e){var n=new Xt({pathId:zt.state.pathId}).toRoles(),i=new Jt({link:n.id,support:!0}).toGuidedTourUrl();Rn.selfServiceSupportRequest$(zt.state.user,n.id,i).pipe(r.first()).subscribe((function(e){var r=t.getName(zt.state.user);zt.patchState({checklist:!0,link:n.idSelfService,name:r}),t.agora=Qn.getSingleton(),t.connect()}))}),(function(t){console.log("AgoraComponent.initAgora.isSelfServiceProposition.error",t,name)}))},o.checkSelfServiceAudio=function(){if(zt.state.role===qt.SelfService&&de.selfServiceAudio){var e=document.createElement("audio");e.setAttribute("playsinline","true"),e.setAttribute("autoplay","true"),e.setAttribute("loop","true"),e.volume=.5,e.src=de.selfServiceAudio,t.getContext(this).node.parentNode.appendChild(e),this.selfServiceAudio=e,vi.events$.pipe(r.tap((function(t){t instanceof li?e.pause():(t instanceof di||t instanceof hi)&&e.play()})),r.takeUntil(this.unsubscribe$)).subscribe()}},o.openSupportRequestDialog=function(t){jr.open$({message:pe.transform("bhere_support_request_dialog"),acceptMessage:pe.transform("bhere_support_request_dialog_accept"),rejectMessage:pe.transform("bhere_support_request_dialog_reject"),type:Nr,position:Ur}).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){if(t instanceof Fr){Ln.send({type:Me});var e=zt.state.name,n=new Xt(zt.state.link);n.role=qt.Streamer;var r=new Jt({link:n.toString(),name:e}).toGuidedTourUrl();setTimeout((function(){window.location.href=r}),1e3)}else Ln.send({type:Le})}))},c(i,[{key:"meetingUrl",get:function(){return this.meetingUrl_||(this.meetingUrl_=new Jt),this.meetingUrl_}},{key:"isVirtualTourUser",get:function(){return-1!==[qt.Publisher,qt.Attendee,qt.Streamer,qt.Viewer].indexOf(zt.state.role)}},{key:"isEmbed",get:function(){if(this.route)return"embed"===this.route.params.mode}},{key:"isSelfServiceTour",get:function(){if(this.route)return"selfServiceTour"===this.route.params.mode}},{key:"isNavigable",get:function(){return null==this.meetingUrl.embedViewId}},{key:"isBackButtonVisible",get:function(){return this.view&&(this.view.type.name===pr.Media.name||this.view.type.name===pr.Model.name)}},{key:"isSelfServiceProposition",get:function(){return zt.state.role===qt.SelfService&&de.flags.selfServiceProposition}},{key:"isSelfServiceSupport",get:function(){return zt.state.role===qt.Publisher&&de.flags.selfServiceProposition&&this.meetingUrl.support}},{key:"showNavInfoToggler",get:function(){return de.flags.hideNavInfo&&this.state.mode!==vn&&this.view&&dc.hasNavInfo(this.view)}},{key:"uiClass",get:function(){var t={};return t[this.state.role]=!0,t.chat=this.state.chat,t.remotes=this.state.mode===vn,t.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,t.locked=this.locked,t}},{key:"remoteClass",get:function(){return"group--remote--"+Math.min(9,this.remotes.length)}},{key:"controlled",get:function(){return zt.state.controlling&&zt.state.controlling!==zt.state.uid}},{key:"controlling",get:function(){return zt.state.controlling&&zt.state.controlling===zt.state.uid}},{key:"silencing",get:function(){return zt.state.silencing}},{key:"silenced",get:function(){return zt.state.silencing&&zt.state.role===qt.Streamer}},{key:"spyed",get:function(){return zt.state.spying&&zt.state.spying===zt.state.uid}},{key:"spying",get:function(){return zt.state.spying&&zt.state.spying!==zt.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"remoteScreen",get:function(){return this.remoteScreen_},set:function(t){this.remoteScreen_!==t&&(this.remoteScreen_=t,setTimeout((function(){window.dispatchEvent(new Event("resize"))}),1))}},{key:"pathViews",get:function(){return ri.pathViews}}]),i}(t.Component);hc.meta={selector:"[agora-component]",hosts:{host:Yt},template:'\n\t<div class="page page--agora">\n\t\t'+E+'\n\t\t\x3c!-- Status Checklist --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'checklist\'" [agora-checklist] (checked)="onChecked($event)"></div>\n\t\t\x3c!-- Status Link --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'link\'" [agora-link] (link)="onLink($event)"></div>\n\t\t\x3c!-- Status Login --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'login\'" [agora-login] (login)="onLogin($event)"></div>\n\t\t\x3c!-- Status Name --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'name\' || (state.status == \'disconnected\' && state.role === \'viewer\')" [agora-name] (name)="onName($event)"></div>\n\t\t\x3c!-- Status Device --\x3e\n\t\t<div class="ui ui--info" *if="state.status == \'device\' || (state.status == \'disconnected\' && state.role !== \'viewer\')" [agora-device] (enter)="onEnter($event)"></div>\n\t\t\n\x3c!-- Virtual Tour --\x3e\n<div class="ui virtual-tour" [class]="uiClass" *if="state.status == \'connected\' && isVirtualTourUser">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t\n\x3c!-- remote sidebar --\x3e\n<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t<div class="agora-stream" (toggleControl)="onToggleControl($event)" (toggleSpy)="onToggleSpy($event)" agora-stream [stream]="remote" type="remote" *for="let remote of remotes">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info" [class]="{ spyed: state.spying == streamId, controlling: state.controlling == streamId }">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t<button type="button" class="btn--control" [title]="\'title_control\' | label" (click)="onToggleControl(streamId)" *if="state.role === \'publisher\'">\n\t\t\t\t<svg class="control" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="btn--spy" [title]="\'title_spy\' | label" (click)="onToggleSpy(streamId)" *if="state.role === \'publisher\'">\n\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="group--members" *if="state.mode == \'virtual-tour\'">\n\t\t<div class="members">\n\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t</div>\n\t\t<div class="credits">\n\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n\x3c!-- remote screen --\x3e\n<div class="group--remote-screen" *if="remoteScreen">\n\t<div class="agora-stream" agora-stream [stream]="remoteScreen" type="remote">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t</div>\n\t</div>\n</div>\n\n\t<div class="group--header">\n\t\t\n\x3c!-- service --\x3e\n<div class="group--service">\n\t<button type="button" class="btn--back" [title]="\'title_back\' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t</button>\n\t<button type="button" class="btn--view-mode" [title]="\'title_view_mode\' | label" (click)="toggleMode($event)" *if="state.mode != \'embed\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'virtual-tour\'"><use xlink:href="#live-meeting"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'live-meeting\'"><use xlink:href="#virtual-tour"></use></svg>\n\t</button>\n\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--navmap" [title]="\'title_navmap\' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != \'live-meeting\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t</button>\n</div>\n\n\t\t\n\x3c!-- local streams --\x3e\n<div class="group--local" [class]="{ publisher: state.role == \'publisher\', viewer: state.role == \'viewer\' }" *if="state.live">\n\t<button type="button" class="btn--silence" [title]="\'title_silence\' | label" [class]="{ active: state.silencing }" (click)="onToggleSilence()" *if="state.role === \'publisher\'">\n\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t</button>\n\t<button type="button" class="btn--control" [title]="\'title_control\' | label" [class]="{ active: state.controlling == state.uid }" (click)="onToggleControl(state.uid)" *if="state.role == \'publisher\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t</button>\n\t<div class="agora-stream" *if="!local"></div>\n\t<div class="agora-stream" agora-stream [stream]="local" type="local" *if="local">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t</div>\n\t</div>\n\t<div class="agora-stream agora-stream--screen" agora-stream [stream]="screen" type="local" *if="screen && hasScreenViewItem">\n\t\t<div class="agora-stream__player"></div>\n\t</div>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t\n\x3c!-- controls --\x3e\n<div class="group--controls" *if="state.live">\n\t<div class="group--actions">\n\t\t<button type="button" class="btn--call" [title]="\'title_disconnect\' | label" (click)="disconnect()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--cam" [title]="\'title_mute_camera\' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--mic" [title]="\'title_mute_mic\' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--screen" [title]="\'title_share_screen\' | label" [class]="{ active: screen }" (click)="toggleScreen()" *if="state.role == \'publisher\' || state.role == \'attendee\' || controlling">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#screen"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--chat" [title]="\'title_chat\' | label" [class]="{ active: state.chatDirty }" (click)="toggleChat()" *if="(\'chat\' | flag)">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#chat"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--navinfo" [title]="\'title_navinfo\' | label" [class]="{ active: state.showNavInfo }" (click)="toggleNavInfo()" *if="showNavInfoToggler">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navinfo"></use></svg>\n\t\t</button>\n\t</div>\n</div>\n\n\t\t\n\x3c!-- media --\x3e\n<div class="group--media" media-player>\n\t<button type="button" class="btn--play" [title]="\'title_play\' | label" (click)="onPlay()" *if="!playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#play"></use></svg>\n\t</button>\n\t<button type="button" class="btn--pause" [title]="\'title_pause\' | label" (click)="onPause()" *if="playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pause"></use></svg>\n\t</button>\n\t<div class="track" (click)="onTrack($event)">\n\t\t<div class="track__progress" [style]="{ transform: \'scale(\' + this.progress + \', 1)\'}"></div>\n\t</div>\n</div>\n\n\t\t\n\x3c!-- ar-vr --\x3e\n<div class="group--ar-vr">\n\t<button type="button" class="btn--ar" [title]="\'title_ar\' | label" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t</button>\n\t<button type="button" class="btn--vr" [title]="\'title_vr\' | label" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t</button>\n</div>\n\n\t\t\n\x3c!-- like --\x3e\n<div class="group--heart" *if="view && (\'like\' | flag)">\n\t<svg class="love" [class]="{ active: view.showLove }" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t<button type="button" class="btn--heart" [class]="{ active: view.showLove }" (click)="addLike($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t\t<span class="badge" [innerHTML]="view.likes" *if="view.likes"></span>\n\t</button>\n</div>\n<div class="group--spacer" *if="!view || !(\'like\' | flag)"></div>\n\n\t</div>\n\t\n\x3c!-- members --\x3e\n<div class="group--members" *if="state.mode == \'live-meeting\'">\n\t<div class="members">\n\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t</div>\n\t<div class="credits">\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t</div>\n</div>\n\n\t\n\x3c!-- chat --\x3e\n<div class="group--chat" *if="state.chat" agora-chat (close)="onChatClose()"></div>\n\n\t\n\x3c!-- lock --\x3e\n<div class="ui__lock" [class]="{ spying: spying }" *if="locked || controlling"></div>\n\n\t\n\x3c!-- navmap --\x3e\n<div class="group--navmap" *if="navmap && state.showNavmap && state.mode != \'live-meeting\'">\n\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (click)="onNavmapItem(item)" *for="let item of navmap.items">\n\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t<div class="title" [innerHTML]="item.title"></div>\n\t</div>\n</div>\n\n</div>\n\n\t\t\n\x3c!-- Smart Device --\x3e\n<div class="ui remotes" [class]="uiClass" *if="state.status == \'connected\' && state.role == \'smart-device\'">\n\t<div class="ui__body"></div>\n\t\x3c!-- remote sidebar --\x3e\n\t<div class="group--remote" [class]="\'group--remote--\' + remotes.length" *if="state.live">\n\t\t<div class="agora-stream" (toggleSpy)="onToggleSpy($event)" agora-stream [stream]="remote" type="remote" *for="let remote of remotes">\n\t\t\t<div class="agora-stream__player"></div>\n\t\t\t<div class="agora-stream__info">\n\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\x3c!-- remote screen --\x3e\n\t<div class="group--remote-screen" *if="remoteScreen && !hasScreenViewItem">\n\t\t<div class="agora-stream" agora-stream [stream]="remoteScreen" type="remote">\n\t\t\t<div class="agora-stream__player"></div>\n\t\t\t<div class="agora-stream__info">\n\t\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="group--header">\n\t\t\n\x3c!-- local streams --\x3e\n<div class="group--local" [class]="{ publisher: state.role == \'publisher\', viewer: state.role == \'viewer\' }" *if="state.live">\n\t<div class="agora-stream" agora-stream [stream]="local" type="local" *if="local">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t</div>\n\t</div>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t\n\x3c!-- controls --\x3e\n<div class="group--controls" *if="state.live">\n\t<div class="group--actions">\n\t\t<button type="button" class="btn--call" [title]="\'title_disconnect\' | label" (click)="disconnect()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--cam" [title]="\'title_mute_camera\' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--mic" [title]="\'title_mute_mic\' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t</button>\n\t</div>\n</div>\n\n\t</div>\n\t\n\x3c!-- members --\x3e\n<div class="group--members">\n\t<div class="members">\n\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t</div>\n\t<div class="credits">\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t</div>\n</div>\n\n</div>\n\n\t\t\n\x3c!-- Self Service Tour --\x3e\n<div class="ui" [class]="uiClass" *if="state.status == \'connected\' && state.mode == \'self-service-tour\'">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t<div class="group--header">\n\t\t\n\x3c!-- service --\x3e\n<div class="group--service">\n\t<button type="button" class="btn--back" [title]="\'title_back\' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t</button>\n\t<button type="button" class="btn--view-mode" [title]="\'title_view_mode\' | label" (click)="toggleMode($event)" *if="state.mode != \'embed\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'virtual-tour\'"><use xlink:href="#live-meeting"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'live-meeting\'"><use xlink:href="#virtual-tour"></use></svg>\n\t</button>\n\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--navmap" [title]="\'title_navmap\' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != \'live-meeting\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t</button>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t<div class="group--spacer"></div>\n\t\t\n\x3c!-- media --\x3e\n<div class="group--media" media-player>\n\t<button type="button" class="btn--play" [title]="\'title_play\' | label" (click)="onPlay()" *if="!playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#play"></use></svg>\n\t</button>\n\t<button type="button" class="btn--pause" [title]="\'title_pause\' | label" (click)="onPause()" *if="playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pause"></use></svg>\n\t</button>\n\t<div class="track" (click)="onTrack($event)">\n\t\t<div class="track__progress" [style]="{ transform: \'scale(\' + this.progress + \', 1)\'}"></div>\n\t</div>\n</div>\n\n\t\t\n\x3c!-- ar-vr --\x3e\n<div class="group--ar-vr">\n\t<button type="button" class="btn--ar" [title]="\'title_ar\' | label" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t</button>\n\t<button type="button" class="btn--vr" [title]="\'title_vr\' | label" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t</button>\n</div>\n\n\t\t\n\x3c!-- like --\x3e\n<div class="group--heart" *if="view && (\'like\' | flag)">\n\t<svg class="love" [class]="{ active: view.showLove }" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t<button type="button" class="btn--heart" [class]="{ active: view.showLove }" (click)="addLike($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t\t<span class="badge" [innerHTML]="view.likes" *if="view.likes"></span>\n\t</button>\n</div>\n<div class="group--spacer" *if="!view || !(\'like\' | flag)"></div>\n\n\t</div>\n\t\n\x3c!-- navmap --\x3e\n<div class="group--navmap" *if="navmap && state.showNavmap && state.mode != \'live-meeting\'">\n\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (click)="onNavmapItem(item)" *for="let item of navmap.items">\n\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t<div class="title" [innerHTML]="item.title"></div>\n\t</div>\n</div>\n\n</div>\n\n\t\t\n\x3c!-- Embed --\x3e\n<div class="ui" [class]="uiClass" *if="state.status == \'connected\' && state.mode == \'embed\'">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t<div class="group--header">\n\t\t\n\x3c!-- service --\x3e\n<div class="group--service">\n\t<button type="button" class="btn--back" [title]="\'title_back\' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t</button>\n\t<button type="button" class="btn--view-mode" [title]="\'title_view_mode\' | label" (click)="toggleMode($event)" *if="state.mode != \'embed\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'virtual-tour\'"><use xlink:href="#live-meeting"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'live-meeting\'"><use xlink:href="#virtual-tour"></use></svg>\n\t</button>\n\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--navmap" [title]="\'title_navmap\' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != \'live-meeting\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t</button>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t<div class="group--spacer"></div>\n\t\t\n\x3c!-- media --\x3e\n<div class="group--media" media-player>\n\t<button type="button" class="btn--play" [title]="\'title_play\' | label" (click)="onPlay()" *if="!playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#play"></use></svg>\n\t</button>\n\t<button type="button" class="btn--pause" [title]="\'title_pause\' | label" (click)="onPause()" *if="playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pause"></use></svg>\n\t</button>\n\t<div class="track" (click)="onTrack($event)">\n\t\t<div class="track__progress" [style]="{ transform: \'scale(\' + this.progress + \', 1)\'}"></div>\n\t</div>\n</div>\n\n\t\t\n\x3c!-- ar-vr --\x3e\n<div class="group--ar-vr">\n\t<button type="button" class="btn--ar" [title]="\'title_ar\' | label" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t</button>\n\t<button type="button" class="btn--vr" [title]="\'title_vr\' | label" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t</button>\n</div>\n\n\t\t\n\x3c!-- like --\x3e\n<div class="group--heart" *if="view && (\'like\' | flag)">\n\t<svg class="love" [class]="{ active: view.showLove }" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t<button type="button" class="btn--heart" [class]="{ active: view.showLove }" (click)="addLike($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t\t<span class="badge" [innerHTML]="view.likes" *if="view.likes"></span>\n\t</button>\n</div>\n<div class="group--spacer" *if="!view || !(\'like\' | flag)"></div>\n\n\t</div>\n</div>\n\n\t\t'+_+"\n\t\t"+S+"\n\t\t"+T+"\n\t</div>\n\t"};var fc=function(){function t(){}return t.assetCreate$=function(t){return xn.post$("/api/asset",t).pipe(r.map((function(t){return ei(t)})))},t.assetUpdate$=function(t){return xn.put$("/api/asset/"+t.id,t).pipe(r.map((function(t){return ei(t)})))},t.assetDelete$=function(t){return t&&t.id?xn.delete$("/api/asset/"+t.id).pipe(r.map((function(){return null}))):n.of(null)},t.localizedAssetCreate$=function(t,e){return xn.post$("/api/"+t+"/asset",e).pipe(r.map((function(t){return ei(t)})))},t.localizedAssetUpdate$=function(t,e){return xn.put$("/api/"+t+"/asset/"+e.id,e).pipe(r.map((function(t){return ei(t)})))},t.upload$=function(t){var e=new FormData;t.forEach((function(t){return e.append("file",t,t.name)}));var i=new XMLHttpRequest,o=n.merge(n.fromEvent(i.upload,"loadstart"),n.fromEvent(i.upload,"progress"),n.fromEvent(i.upload,"load"),n.fromEvent(i,"readystatechange")).pipe(r.map((function(t){switch(t.type){case"readystatechange":return 4===i.readyState?JSON.parse(i.responseText):null;default:return null}})),r.filter((function(t){return null!==t})));return i.open("POST","/api/upload/",!0),i.send(e),o},t.createOrUpdateAsset$=function(e,n){var r=e[0],i=ti.fromUrl(r.url);return n.value&&n.value.id?(i.id=n.value.id,t.assetUpdate$(i)):t.assetCreate$(i)},t.createOrUpdateLocalizedAsset$=function(e,n,r){var i=e[0],o=ti.fromUrl(i.url);return n.value&&n.value.id?(o.id=n.value.id,t.localizedAssetUpdate$(r,o)):t.localizedAssetCreate$(r,o)},t.assetDidChange=function(t,e){var n=null,r=null,i=null,o=null;return t&&(n=t.id,r=t.file),e&&(i=e.id,o=e.file),n!==i||r!==o},t}(),pc=function(){function t(){}return t.data$=function(){return this.data$_||(this.data$_=xn.get$("/api/view").pipe(r.map((function(t){return t.views=t.views.map((function(t){return Tr(t)})),t})),r.shareReplay(1))),this.data$_},t.viewIdOptions$=function(){return this.data$().pipe(r.map((function(t){var e=t.views.map((function(t){return{id:t.id,name:t.name}}));return e.unshift({id:null,name:"select"}),e})))},t.viewCreate$=function(t){return xn.post$("/api/view",t).pipe(r.map((function(t){return Tr(t)})))},t.viewUpdate$=function(t){return xn.put$("/api/view/"+t.id,t.payload).pipe(r.map((function(t){return Tr(t)})))},t.viewDelete$=function(t){return xn.delete$("/api/view/"+t.id)},t.getTile=function(t){var e;return t.type.name===pr.PanoramaGrid.name&&(e=t.tiles[t.index]),e},t.inferItemCreate$=function(t,e){var n=this.getTile(t);return n?this.tileItemCreate$(t,n,e):this.itemCreate$(t,e)},t.inferItemUpdate$=function(t,e){var n=this.getTile(t);return n?this.tileItemUpdate$(t,n,e):this.itemUpdate$(t,e)},t.inferItemDelete$=function(t,e){var n=this.getTile(t);return n?this.tileItemDelete$(t,n,e):this.itemDelete$(t,e)},t.inferItemUpdateResult$=function(t,e){var n,r=this.getTile(t);(n=r?r.navs.find((function(t){return t.id===e.id})):t.items.find((function(t){return t.id===e.id})))&&Object.assign(n,e)},t.inferItemDeleteResult$=function(t,e){var n,r=this.getTile(t);if(n=r?r.navs:t.items){var i=n.indexOf(e);-1!==i&&n.splice(i,1),r&&t.updateCurrentItems()}},t.itemCreate$=function(t,e){return xn.post$("/api/view/"+t.id+"/item",e).pipe(r.map((function(t){return Cr(t)})))},t.itemUpdate$=function(t,e){return xn.put$("/api/view/"+t.id+"/item/"+e.id,e.payload).pipe(r.map((function(t){return Cr(t)})))},t.itemDelete$=function(t,e){return xn.delete$("/api/view/"+t.id+"/item/"+e.id)},t.tileItemCreate$=function(t,e,n){return xn.post$("/api/view/"+t.id+"/tile/"+e.id+"/item",n).pipe(r.map((function(t){return Cr(t)})))},t.tileItemUpdate$=function(t,e,n){return xn.put$("/api/view/"+t.id+"/tile/"+e.id+"/item/"+n.id,n.payload).pipe(r.map((function(t){return Cr(t)})))},t.tileItemDelete$=function(t,e,n){return xn.delete$("/api/view/"+t.id+"/tile/"+e.id+"/item/"+n.id)},t}(),vc=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this,n=this.object,r=this.form=new e.FormGroup({type:vr.CurvedPlane,position:new e.FormControl(n.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(n.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([1,1,1],e.RequiredValidator()),radius:new e.FormControl(35,e.RequiredValidator()),height:new e.FormControl(20,e.RequiredValidator()),arc:new e.FormControl(90,e.RequiredValidator()),asset:null});this.controls=r.controls,r.changes$.subscribe((function(e){t.pushChanges()}))},o.onSubmit=function(){if(this.form.valid){var t=Object.assign({},this.form.value);pc.inferItemCreate$(this.view,t).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(t){return console.log("CurvedPlaneModalComponent.onSubmit.error",t)}))}else this.form.touched=!0},o.onClose=function(){Yn.reject()},c(i,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"view",get:function(){var t=null,e=this.data;return e&&(t=e.view),t}},{key:"object",get:function(){var t=new THREE.Object3D,e=this.data;if(e){var n=e.hit.position.clone(),r=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(20),t.position.copy(n),t.lookAt(gi.origin)):(t.lookAt(r),t.position.set(n.x,n.y,n.z),t.position.add(r.multiplyScalar(.01)))}return t}}]),i}(t.Component);vc.meta={selector:"[curved-plane-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Curved Plane.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t\x3c!-- <div control-text [control]="controls.title" label="Title"></div> --\x3e\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.radius" label="Radius" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.height" label="Height" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.arc" label="Arc" [precision]="0" [disabled]="true"></div>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},vc.chunk=function(){return'<div class="curved-plane-modal" curved-plane-modal></div>'};var mc=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this,n=this.object,r=this.form=new e.FormGroup({type:vr.Model,position:new e.FormControl(n.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl([0,0,0],e.RequiredValidator()),scale:new e.FormControl([1,1,1],e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=r.controls,r.changes$.subscribe((function(e){t.pushChanges()}))},o.onSubmit=function(){if(this.form.valid){var t=Object.assign({},this.form.value);pc.inferItemCreate$(this.view,t).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(t){return console.log("ItemModelModalComponent.onSubmit.error",t)}))}else this.form.touched=!0},o.onClose=function(){Yn.reject()},c(i,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"view",get:function(){var t=null,e=this.data;return e&&(t=e.view),t}},{key:"object",get:function(){var t=new THREE.Object3D,e=this.data;if(e){var n=e.hit.position.clone(),r=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(4),t.position.copy(n),t.lookAt(gi.origin)):(t.lookAt(r),t.position.set(n.x,n.y,n.z),t.position.add(r.multiplyScalar(.01)))}return t}}]),i}(t.Component);mc.meta={selector:"[item-model-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Model Item.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},mc.chunk=function(){return'<div class="item-model-modal" item-model-modal></div>'};var gc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({type:pr.Media,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={type:e.type,name:e.name,asset:e.asset,orientation:{latitude:0,longitude:0},zoom:75};return pc.viewCreate$(n).pipe(r.switchMap((function(t){var n={type:vr.Plane,position:[20,0,0],rotation:[0,-Math.PI/2,0],scale:[12,6.75,1],asset:e.asset};return pc.itemCreate$(t,n).pipe(r.map((function(e){return t.items=[e],t})))})),r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("MediaModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);gc.meta={selector:"[media-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Media.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},gc.chunk=function(){return'<div class="media-modal" media-modal></div>'};var Ac=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({type:pr.Model,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator()),model:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={type:e.type,name:e.name,asset:e.asset,orientation:{latitude:0,longitude:0},zoom:75};return pc.viewCreate$(n).pipe(r.switchMap((function(t){var n={type:vr.Model,asset:e.model};return pc.itemCreate$(t,n).pipe(r.map((function(e){return t.items=[e],t})))})),r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("ModelModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);Ac.meta={selector:"[model-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Model View.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.model" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Ac.chunk=function(){return'<div class="model-modal" model-modal></div>'};var yc=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this,n=this.object;this.error=null,this.useHooks=ai.enabled;var i=this.form=new e.FormGroup({type:vr.Nav,title:null,abstract:null,viewId:null,hook:null,hookExtra:null,keepOrientation:!1,important:!1,transparent:!1,position:new e.FormControl(n.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(n.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([20,5,1],e.RequiredValidator()),asset:null,link:new e.FormGroup({title:new e.FormControl(null),href:new e.FormControl(null),target:"_blank"})});if(this.controls=i.controls,ai.enabled){var o=de.webhook.methods.map((function(t){return{id:t,name:t}}));o.unshift({id:null,name:"select"}),this.controls.hook.options=o}i.changes$.subscribe((function(e){t.pushChanges()})),pc.viewIdOptions$().pipe(r.first()).subscribe((function(e){t.controls.viewId.options=e,t.pushChanges()}))},o.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=Object.assign({},this.form.value);e.viewId=e.viewId?parseInt(e.viewId):this.view.id,!e.link||e.link.title&&e.link.href||(e.link=null),pc.inferItemCreate$(this.view,e).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("NavModalComponent.onSubmit.error",e),t.error=e,t.form.submitted=!1}))}else this.form.touched=!0},o.onViewIdDidChange=function(t){if(null!=t&&de.flags.navAutoUpdateTitle){var e=this.controls.viewId.options,n=e.find((function(e){return e.id===t}));if(null!=n){var r=n.name,i=this.form.value.title;i&&!e.find((function(t){return t.name===i}))||this.form.patch({title:r})}}},o.onClose=function(){Yn.reject()},c(i,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"view",get:function(){var t=null,e=this.data;return e&&(t=e.view),t}},{key:"position",get:function(){var t=null,e=this.data;return e&&(t=e.hit.position),t}},{key:"object",get:function(){var t=new THREE.Object3D,e=this.data;if(e){var n=e.hit.position.clone(),r=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(dc.RADIUS),t.position.copy(n),t.lookAt(gi.origin)):(t.lookAt(r),t.position.set(n.x,n.y,n.z),t.position.add(r.multiplyScalar(.01)))}return t}}]),i}(t.Component);yc.meta={selector:"[nav-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Nav.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView" (change)="onViewIdDidChange($event)"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.keepOrientation" label="Keep Orientation"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.important" label="Important"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.transparent" label="Transparent"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3" [disabled]="true"></div>\n\t\t\t\t\t\t<div *if="controls.transparent.value == true">\n\t\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png, image/jpeg"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.link.controls.title" label="Link Title"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.link.controls.href" label="Link Url"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.hook" label="Hook" *if="useHooks"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.hookExtra" label="Hook Extra" *if="useHooks"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},yc.chunk=function(){return'<div class="nav-modal" nav-modal></div>'};var bc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({type:pr.PanoramaGrid,name:new e.FormControl(null,e.RequiredValidator()),assets:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value.assets,n=Ar.mapTiles(e.map((function(t){return{asset:t,navs:[]}})),!1,!0);n.sort((function(t,e){return 1e4*t.indices.x+t.indices.y-(1e4*e.indices.x+e.indices.y)}));var i=n[0].asset,o={type:this.form.value.type,name:this.form.value.name,asset:i,tiles:n,invertAxes:!0,flipAxes:!1,orientation:{latitude:0,longitude:0},zoom:75};pc.viewCreate$(o).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("PanoramaGridModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}else this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);bc.meta={selector:"[panorama-grid-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Panorama Grid.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-assets [control]="controls.assets" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},bc.chunk=function(){return'<div class="panorama-grid-modal" panorama-grid-modal></div>'};var wc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({type:pr.Panorama,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={type:e.type,name:e.name,asset:e.asset,orientation:{latitude:0,longitude:0},zoom:75};return pc.viewCreate$(n).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("PanoramaModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);wc.meta={selector:"[panorama-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Panorama.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<div class="group--form group--form--fixed">\n\t\t\t\t\t\t<code [innerHTML]="form.value | json"></code>\n\t\t\t\t\t\t<button type="button" class="btn--test" (click)="test()"><span>test</span></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t--\x3e\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},wc.chunk=function(){return'<div class="panorama-modal" panorama-modal></div>'};var Ec=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var n=this,r=t.getContext(this).parentInstance;r instanceof Vr&&(this.data=r.modal.data),this.error=null;var i=this.form=new e.FormGroup({name:new e.FormControl(null,e.RequiredValidator())});this.controls=i.controls,i.changes$.subscribe((function(t){n.pushChanges()}))},o.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e={name:this.form.value.name,items:this.data?this.data.item.items:[]};return ur.pathCreate$(e).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("PathAddModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},o.onClose=function(){Yn.reject()},i}(t.Component);Ec.meta={selector:"[path-add-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Add Path.</div>\n\t\t\t\t<div class="description">Aggiungi un percorso</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Ec.chunk=function(){return'<div class="panorama-modal" path-add-modal></div>'};var _c=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var n=this;this.item=null,this.views=null;var r=t.getContext(this).parentInstance;if(r instanceof Vr){var i=r.modal.data;i&&(this.item=i.item?i.item:null,this.views=this.parseViews(i.views,this.item))}this.error=null;var o=this.form=new e.FormGroup({name:new e.FormControl(this.item?this.item.name:null,e.RequiredValidator())});this.controls=o.controls,o.changes$.subscribe((function(t){n.pushChanges()}))},o.parseViews=function(t,e){return t&&e?t.map((function(t){return{id:t.id,name:t.name,type:t.type,active:-1===e.items.indexOf(t.id)}})):[]},o.onToggleView=function(t){t.active=!t.active,this.pushChanges()},o.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={id:this.item.id,name:e.name,items:this.views.filter((function(t){return!t.active})).map((function(t){return t.id}))};return ur.pathUpdate$(n).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("PathEditModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},o.onSelectAll=function(){this.views.forEach((function(t){return t.active=!0})),this.pushChanges()},o.onSelectNone=function(){this.views.forEach((function(t){return t.active=!1})),this.pushChanges()},o.onClose=function(){Yn.reject()},i}(t.Component);_c.meta={selector:"[path-edit-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Edit Path <span *if="item">&ldquo;<span [innerHTML]="item.title || item.name"></span>&rdquo;</span>.</div>\n\t\t\t\t<div class="description">Modifica il percorso</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="nav--flag" *if="views">\n\t\t\t\t\t\t<li class="nav__item" *for="let view of views">\n\t\t\t\t\t\t\t<button type="button" class="btn--flag" [class]="{ active: view.active }" [title]="view.name" (click)="onToggleView(view)">\n\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class="name" [innerHTML]="view.name"></span>\n\t\t\t\t\t\t\t\t<span class="flag">\n\t\t\t\t\t\t\t\t\t<svg class="check" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#check"></use></svg>\n\t\t\t\t\t\t\t\t\t<svg class="close" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<div class="group--options">\n\t\t\t\t\t\t\t<button type="button" class="btn--link" (click)="onSelectAll()">\n\t\t\t\t\t\t\t\t<span>Select all</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--link" (click)="onSelectNone()">\n\t\t\t\t\t\t\t\t<span>Select none</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Save</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},_c.chunk=function(){return'<div class="path-edit-modal" path-edit-modal></div>'};var Sc=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this,n=this.object,r=this.form=new e.FormGroup({type:vr.Plane,position:new e.FormControl(n.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(n.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([12,6.75,1],e.RequiredValidator()),asset:null});this.controls=r.controls,r.changes$.subscribe((function(e){t.pushChanges()}))},o.onSubmit=function(){if(this.form.valid){var t=Object.assign({},this.form.value);console.log("PlaneModalComponent.onSubmit",this.view,t),pc.inferItemCreate$(this.view,t).pipe(r.first()).subscribe((function(t){console.log("PlaneModalComponent.onSubmit.success",t),Yn.resolve(t)}),(function(t){return console.log("PlaneModalComponent.onSubmit.error",t)}))}else this.form.touched=!0},o.onClose=function(){Yn.reject()},c(i,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"view",get:function(){var t=null,e=this.data;return e&&(t=e.view),t}},{key:"object",get:function(){var t=new THREE.Object3D,e=this.data;if(e){var n=e.hit.position.clone(),r=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(20),t.position.copy(n),t.lookAt(gi.origin)):(t.lookAt(r),t.position.set(n.x,n.y,n.z),t.position.add(r.multiplyScalar(.01)))}return t}}]),i}(t.Component);Sc.meta={selector:"[plane-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Plane.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t\x3c!-- <div control-text [control]="controls.title" label="Title"></div> --\x3e\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Sc.chunk=function(){return'<div class="plane-modal" plane-modal></div>'};var Tc=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onRemove=function(){Yn.resolve()},r.onCancel=function(){Yn.reject()},r.onClose=function(){Yn.reject()},c(n,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"item",get:function(){var t=null,e=this.data;return e&&(t=e.item),t}}]),n}(t.Component);Tc.meta={selector:"[remove-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Remove <span *if="item">&ldquo;<span [innerHTML]="item.title || item.name"></span>&rdquo;</span>.</div>\n\t\t\t\t<div class="abstract">are you sure?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t\t<span>Remove</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onCancel($event)">\n\t\t\t\t\t\t<span>Cancel</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Tc.chunk=function(){return'<div class="remove-modal" remove-modal></div>'};var Cc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({type:pr.Room3d,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={type:e.type,name:e.name,asset:e.asset,orientation:{latitude:0,longitude:0},zoom:75};return pc.viewCreate$(n).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("Room3DModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);Cc.meta={selector:"[room-3d-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Room 3D View.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.model" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Cc.chunk=function(){return'<div class="room-3d-modal" room-3d-modal></div>'};var xc={menu:[{id:"menu",title:"editor_menu",active:!0},{id:"navmaps",title:"editor_navmaps",active:!0}],current:null,active:!1},Rc=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this;t.getContext(this).node.classList.remove("hidden"),this.settings=this.getSettings(),this.aside=!1,this.state={},this.view=null,this.paths=null,this.path=null,this.form=null,this.local=null,this.remotes=[],this.viewHit=new n.Subject,(this.vrService=ko.getService()).status$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.pushChanges()})),this.resolveUser()},o.resolveUser=function(){var t=this;Rn.me$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){e&&e.type===qt.Publisher?(t.user=e,t.initState()):Qt.setRouterLink(me.transform(":lang.access"))}))},o.initState=function(){var t=this,e=this.user,n={user:e,role:e.type,name:e.firstName&&e.lastName?e.firstName+" "+e.lastName:null,mode:pn,link:null,channelName:de.channelName,uid:null,status:xe,connecting:!1,connected:!0,controlling:!1,spying:!1,silencing:!1,hosted:!0,live:!1,navigable:!0,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};zt.state=n,zt.state$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.hosted=e.hosted,t.pushChanges()})),this.viewObserver$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){})),Gn.mode=Vn},o.viewObserver$=function(){var t=this;return pc.data$().pipe(r.switchMap((function(e){var n=C.has("pathId")?parseInt(C.get("pathId")):null;return ur.getCurrentPath$(n).pipe(r.switchMap((function(n){return t.paths=ur.paths,t.path=n,ri.editorView$(e,n)})))})),r.tap((function(e){t.view=null,t.pushChanges()})),r.delay(1),r.tap((function(e){t.view=e,t.pushChanges()})))},o.onAddPath=function(){Yn.open$({template:Ec.chunk()}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&ur.addPath(t.data)}))},o.onEditPath=function(t){Yn.open$({template:_c.chunk(),data:{item:t,views:ri.validViews}}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&ur.editPath(t.data)}))},o.onDuplicatePath=function(t){Yn.open$({template:Ec.chunk(),data:{item:t}}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&ur.addPath(t.data)}))},o.onDeletePath=function(t){Yn.open$({template:Tc.chunk(),data:{item:t}}).pipe(r.first()).subscribe((function(e){e instanceof Xn&&ur.pathDelete$(t).pipe(r.first()).subscribe((function(e){ur.deletePath(t)}))}))},o.onSelectPath=function(t){ur.path=t},o.isPathSelected=function(t){return ur.path.id===t.id},o.onNavTo=function(t){var e=t.viewId;ri.pathViews.find((function(t){return t.id===e}))&&(ri.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation})},o.onNavLink=function(t){Yn.open$({iframe:t.link.href}).pipe(r.first()).subscribe((function(e){Ln.send({type:on,itemId:t.id})}))},o.patchState=function(t){this.state=Object.assign({},this.state,t),this.pushChanges()},o.tryInAr=function(){Yn.open$({template:Gr.chunk(),data:this.view}).pipe(r.first()).subscribe((function(t){}))},o.onToggleAside=function(){this.aside=!this.aside,this.pushChanges(),window.dispatchEvent(new Event("resize"))},o.getSettings=function(){var t=Object.assign({},xc);return t.menu=t.menu.filter((function(t){return de.flags[t.id]})),t.current=t.menu.length?t.menu[0].id:null,t},o.onToggleSettings=function(){var t=this.settings;t.active=!t.active,this.pushChanges()},o.onSelectSetting=function(t){this.settings.current=t.id,this.pushChanges()},o.onViewHit=function(t){this.viewHit.next(t)},o.onViewHitted=function(t){this.viewHitSubscription&&(this.viewHitSubscription.unsubscribe(),this.viewHitSubscription=null),"function"==typeof t&&(this.viewHitSubscription=this.viewHit.pipe(r.first()).subscribe((function(e){return t(e)})))},o.onDragEnd=function(t){var e=this;pc.inferItemUpdate$(this.view,t.item).pipe(r.first()).subscribe((function(t){e.pushChanges()}),(function(n){return console.log("EditorComponent.onDragEnd.inferItemUpdate$.error",n,e.view,t.item,t.item.payload)}))},o.onResizeEnd=function(t){},o.onWorldSelect=function(t){var e;this.view&&(this.view.items.forEach((function(t){return t.showPanel=!1})),this.view.items.forEach((function(n){n.selected=n===t.item,e=n.selected?n:e})),this.view.selected=!e,this.pushChanges(),e&&(this.aside=!0,this.pushChanges(),window.dispatchEvent(new Event("resize"))))},o.onOpenModal=function(t,e){var n=this,i=null;switch(t.type){case"view":switch(t.value){case pr.Panorama.name:i=wc.chunk();break;case pr.PanoramaGrid.name:i=bc.chunk();break;case pr.Model.name:i=Ac.chunk();break;case pr.Room3d.name:i=Cc.chunk();break;case pr.Media.name:i=gc.chunk()}break;case"viewItem":switch(t.value){case vr.Nav.name:i=yc.chunk();break;case vr.Plane.name:i=Sc.chunk();break;case vr.CurvedPlane.name:i=vc.chunk();break;case vr.Model.name:i=mc.chunk()}}i&&Yn.open$({template:i,data:e}).pipe(r.first()).subscribe((function(e){if(e instanceof Xn)switch(t.type){case"view":switch(t.value){case pr.Panorama.name:case pr.PanoramaGrid.name:case pr.Model.name:case pr.Room3d.name:case pr.Media.name:ri.addView(e.data)}break;case"viewItem":switch(t.value){case vr.Nav.name:case vr.Plane.name:case vr.CurvedPlane.name:case vr.Model.name:var r=e.data,i=pc.getTile(n.view);if(i){var o=i.navs||[];o.push(r),i.navs=o,n.view.updateCurrentItems()}else{r.path=!0;var a=n.view.items||[];a.push(r),n.view.items=a}n.pushChanges()}}n.pushChanges()}))},o.onAsideSelect=function(t){var e=this;if(t.value)switch(t.value){case vr.Nav.name:case vr.Plane.name:case vr.CurvedPlane.name:this.onViewHitted((function(n){e.onOpenModal(t,{view:e.view,hit:n})})),jr.open$({message:"Click a point on the view"});break;case vr.Model.name:if("viewItem"===t.type){if(this.view.type.name===pr.Model.name)return;this.onViewHitted((function(n){e.onOpenModal(t,{view:e.view,hit:n})})),jr.open$({message:"Click a point on the view"})}else this.onOpenModal(t,{view:this.view});break;default:this.onOpenModal(t,{view:this.view})}else if(t.view&&(t.item||null===t.item))t.view.selected=!1,t.view.items.forEach((function(e){return e.selected=e===t.item})),Ln.send({type:fn}),this.pushChanges();else if(t.view&&(t.tile||null===t.tile))t.view.selected=!1,t.view.tiles.forEach((function(e){return e.selected=e===t.tile})),Ln.send({type:fn}),this.pushChanges();else if(t.view||null===t.view){this.view.selected=this.view===t.view,this.view.items.forEach((function(t){return t.selected=!1}));var n=pc.getTile(this.view);n&&this.view.tiles.forEach((function(t){return t.selected=t===n})),Ln.send({type:fn}),this.pushChanges()}},o.onAsideUpdate=function(t){if(t.item&&t.view)this.pushChanges();else if(t.tile&&t.view);else if(t.view)if(ri.viewId!==t.view.id)ri.viewId=t.view.id;else{var e=fc.assetDidChange(this.view.asset,t.view.asset);Object.assign(this.view,t.view),e&&"function"==typeof this.view.onUpdateAsset&&this.view.onUpdateAsset(),this.pushChanges()}},o.onAsideDelete=function(t){var e=this;t.item&&t.view?pc.inferItemDelete$(t.view,t.item).pipe(r.first()).subscribe((function(n){pc.inferItemDeleteResult$(t.view,t.item),e.pushChanges()}),(function(t){return console.log("EditorComponent.onAsideDelete.inferItemDelete$.error",t)})):t.view&&pc.viewDelete$(t.view).pipe(r.first()).subscribe((function(e){ri.deleteView(t.view)}),(function(t){return console.log("EditorComponent.onAsideDelete.viewDelete$.error",t)}))},c(i,[{key:"dataViews",get:function(){return ri.dataViews}},{key:"pathViews",get:function(){return ri.pathViews}}]),i}(t.Component);Rc.meta={selector:"[editor-component]",hosts:{host:Yt},template:'\n\t<div class="page page--editor">\n\t\t<div class="ui" [class]="{ open: aside }" *if="dataViews.length">\n\t\t\t<div class="ui__navbar">\n\t\t\t\t<div class="btn--settings" [class]="{ active: settings.active }" (click)="onToggleSettings($event)" *if="settings.menu.length > 0">\n\t\t\t\t\t<svg class="settings" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#settings-full"></use></svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="headline" *if="view">\n\t\t\t\t\t<div class="headline__id" [innerHTML]="view.id"></div>\n\t\t\t\t\t<div class="headline__icon">\n\t\t\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="headline__name" [innerHTML]="view.name"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--path" *if="(\'usePaths\' | flag) && path">\n\t\t\t\t\t<div class="group--path__select">\n\t\t\t\t\t\t<div class="group--form--select" [dropdown]="\'path\'">\n\t\t\t\t\t\t\t<label>Percorso</label>\n\t\t\t\t\t\t\t<span class="control--custom-select" [innerHTML]="path.name"></span>\n\t\t\t\t\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="dropdown dropdown-item" [dropdown-item]="\'path\'">\n\t\t\t\t\t\t\t<div class="category">Percorso</div>\n\t\t\t\t\t\t\t<ul class="nav--dropdown">\n\t\t\t\t\t\t\t\t<li [class]="{ active: isPathSelected(item) }" *for="let item of paths">\n\t\t\t\t\t\t\t\t\t<span [innerHTML]="item.name" (click)="onSelectPath(item)"></span>\n\t\t\t\t\t\t\t\t\t<div class="check">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#check"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--flags" (click)="onEditPath(item)" title="Edit" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#flags"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--duplicate" (click)="onDuplicatePath(item)" title="Duplicate" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#duplicate"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--trash" (click)="onDeletePath(item)" title="Delete" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#trash"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<div class="btn--mode" (click)="onAddPath()">Aggiungi un percorso</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--edit" [class]="{ active: aside }" (click)="onToggleAside($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#edit"></use></svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world" world [view]="view" [views]="pathViews" [editor]="true" (navTo)="onNavTo($event)" (viewHit)="onViewHit($event)" (dragEnd)="onDragEnd($event)" (select)="onWorldSelect($event)">\n\t\t\t\t\t<div class="world__view" *if="view">\n\t\t\t\t\t\t<div class="grid" model-grid *if="view.type.name === \'panorama-grid\'" [view]="view" (move)="onGridMove($event)" (nav)="onGridNav($event)"></div>\n\t\t\t\t\t\t<div *if="view.ready">\n\t\t\t\t\t\t\t<div model-room [view]="view" *if="view.type.name === \'room-3d\'"></div>\n\t\t\t\t\t\t\t<div class="world__item" *for="let item of view.pathItems; let index = index;">\n\t\t\t\t\t\t\t\t<div model-nav [item]="item" [view]="view" [editor]="true" (over)="onNavOver($event)" (out)="onNavOut($event)" (down)="onNavDown($event)" *if="item.type.name == \'nav\'"></div>\n\t\t\t\t\t\t\t\t<div model-plane [item]="item" [view]="view" (zoom)="onZoomMedia($event)" (down)="onObjectDown($event)" *if="item.type.name == \'plane\'"></div>\n\t\t\t\t\t\t\t\t<div model-curved-plane [item]="item" [view]="view" (zoom)="onZoomMedia($event)" (down)="onObjectDown($event)" *if="item.type.name == \'curved-plane\'"></div>\n\t\t\t\t\t\t\t\t<div class="model-viewer__item" model-model [item]="item" [view]="view" (down)="onObjectDown($event)" *if="item.type.name == \'model\'">\n\t\t\t\t\t\t\t\t\t\x3c!-- <div class="banner loading" model-banner [item]="progress" *if="progress"></div> --\x3e\n\t\t\t\t\t\t\t\t\t\x3c!-- <div class="progress" [innerHTML]="progress.title" *if="progress"></div> --\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="panel" [class]="{ \'panel--lg\': item.asset != null }" model-panel [item]="item" (down)="onPanelDown($event)" *if="item.showPanel">\n\t\t\t\t\t\t\t\t\t<div class="panel__title" [innerHTML]="item.title"></div>\n\t\t\t\t\t\t\t\t\t<div class="panel__abstract" [innerHTML]="item.abstract"></div>\n\t\t\t\t\t\t\t\t\t<img class="panel__picture" [src]="item.asset | asset" *if="item.asset">\n\t\t\t\t\t\t\t\t\t<a class="panel__link" [href]="item.link.href" target="_blank" rel="noopener" *if="item.link" [innerHTML]="item.link.title"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<div class="banner loading" model-banner [item]="loading" *if="loading">\n\t\t\t\t\t\t\t<div class="banner__title" [innerHTML]="item.title"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="banner waiting" model-banner [item]="waiting" *if="waiting">\n\t\t\t\t\t\t\t<div class="banner__title" [innerHTML]="item.title"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="progress-indicator" model-progress [view]="view">\n\t\t\t\t\t\t<div class="inner"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div model-menu [views]="views" [editor]="true" (nav)="onMenuNav($event)" (toggle)="onMenuToggle($event)">\n\t\t\t\t\t\t<div class="btn--menu" (mousedown)="onToggle($event)">\n\t\t\t\t\t\t\t<div class="btn--menu__spinner"></div>\n\t\t\t\t\t\t\t<svg class="bullets" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu"></use></svg>\n\t\t\t\t\t\t\t<svg class="progress" width="50" height="50" viewBox="0 0 50 50">\n\t\t\t\t\t\t\t\t<circle id="circle" r="23" cx="25" cy="25" fill="transparent"></circle>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div model-debug *if="debugging"></div>\n\t\t\t\t\t<div class="world__info" *if="error" [innerHTML]="error"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- footer --\x3e\n\t\t\t<div class="group--footer">\n\t\t\t\t<div class="group--ar-vr">\n\t\t\t\t\t<button type="button" class="btn--ar" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--vr" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui__settings" *if="settings.active">\n\t\t\t\t\x3c!-- settings navs --\x3e\n\t\t\t\t<div class="group--nav">\n\t\t\t\t\t<ul class="nav--menu">\n\t\t\t\t\t\t<li class="nav__item" *for="let item of settings.menu" [class]="{ active: settings.current === item.id }" (click)="onSelectSetting(item)"><span class="title" [innerHTML]="item.title | label"></span></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- menu --\x3e\n\t\t\t\t<div class="group--content" menu-builder [views]="dataViews" *if="settings.current === \'menu\'">\n\t\t\t\t\t<div class="group--head">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_menu\' | label"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--main">\n\t\t\t\t\t\t<div class="nav--tree" *if="form">\n\t\t\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t\t\t<div class="abstract" *if="controls.items.controls.length == 0" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t\t\t\t\t\t<div *for="let control of controls.items.controls">\n\t\t\t\t\t\t\t\t\t<div control-menu [control]="control" (remove)="onRemoveControl($event)" (link)="onLinkControl($event)" (up)="onUpControl($event)" (down)="onDownControl($event)"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--foot">\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onAddItem($event)" [innerHTML]="\'editor_add\' | label"></button>\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="isValid() && onSubmit()" *if="changes > 1" [innerHTML]="\'editor_save\' | label"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- navmaps --\x3e\n\t\t\t\t<div class="group--content" navmap-builder [views]="dataViews" *if="settings.current === \'navmaps\'">\n\t\t\t\t\t<div class="group--head">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_navmaps\' | label"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--main">\n\t\t\t\t\t\t\x3c!-- listing navmaps --\x3e\n\t\t\t\t\t\t<div class="listing--navmaps" *if="!navmap">\n\t\t\t\t\t\t\t<div class="abstract" *if="navmaps.length == 0" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t\t\t\t\t<div class="listing__item" *for="let item of navmaps">\n\t\t\t\t\t\t\t\t<div class="card--navmap" (click)="onSet(item)">\n\t\t\t\t\t\t\t\t\t<div class="card__picture">\n\t\t\t\t\t\t\t\t\t\t<img [src]="item.asset | asset" *if="item.asset" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="card__content">\n\t\t\t\t\t\t\t\t\t\t<div class="card__name" [innerHTML]="item.name"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- navmap edit --\x3e\n\t\t\t\t\t\t<div class="navmap" navmap-edit [navmap]="navmap" (delete)="onDelete($event)" *if="navmap">\n\t\t\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t\t\t<div class="title"><span [innerHTML]="navmap.name"></span> <span [innerHTML]="navmap.id"></span></div>\n\t\t\t\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png"></div>\n\t\t\t\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t\t\t\t<span [innerHTML]="\'editor_save\' | label"></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t\t\t\t\t\t<span [innerHTML]="\'editor_remove\' | label"></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="navmap-control" [class]="mode">\n\t\t\t\t\t\t\t\t\t<div class="navmap-control__image">\n\t\t\t\t\t\t\t\t\t\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t\t\t\t\t\t\t\t\t\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (mousedown)="onMoveItem($event, item)" (click)="onRemoveItem(item)" *for="let item of navmap.items">\n\t\t\t\t\t\t\t\t\t\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t\t\t\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.title"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<ul class="navmap-control__toolbar">\n\t\t\t\t\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'insert\' }" (click)="onToggleMode(\'insert\')"><svg class="pencil" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pencil"></use></svg></span></li>\n\t\t\t\t\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'move\' }" (click)="onToggleMode(\'move\')"><svg class="move" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#move"></use></svg></span></li>\n\t\t\t\t\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'remove\' }" (click)="onToggleMode(\'remove\')"><svg class="erase" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#erase"></use></svg></span></li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--foot">\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onAdd($event)" [innerHTML]="\'editor_add\' | label" *if="!navmap"></button>\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)" [innerHTML]="\'editor_back\' | label" *if="navmap"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="aside" [class]="{ active: aside }" aside [view]="view" (select)="onAsideSelect($event)" (update)="onAsideUpdate($event)" (delete)="onAsideDelete($event)" *if="view && aside">\n\t\t\t<div class="headline">\n\t\t\t\t<ul class="nav--tab">\n\t\t\t\t\t<li [class]="{ active: mode === 1 }" (click)="setMode(1)" [innerHTML]="\'editor_properties\' | label"></li>\n\t\t\t\t\t<li [class]="{ active: mode === 2 }" (click)="setMode(2)" [innerHTML]="\'editor_views\' | label"></li>\n\t\t\t\t\t<li [class]="{ active: mode === 3 }" (click)="setMode(3)" [innerHTML]="\'editor_view_items\' | label"></li>\n\t\t\t\t</ul>\n\t\t\t\t\x3c!--\n\t\t\t\t<div class="btn--mode" [class]="{ active: mode === 1 }" (click)="setMode(1)" [innerHTML]="\'editor_properties\' | label"></div>\n\t\t\t\t<div class="btn--mode" [class]="{ active: mode === 2 }" (click)="setMode(2)" [innerHTML]="\'editor_views\' | label"></div>\n\t\t\t\t<div class="btn--mode" [class]="{ active: mode === 3 }" (click)="setMode(3)" [innerHTML]="\'editor_view_items\' | label"></div>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t\t<div class="scrollable">\n\t\t\t\t<ul class="nav--editor" *if="mode === 1">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_properties\' | label"></div>\n\t\t\t\t\t\t<update-view [view]="view" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)"></update-view>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li *if="view.type.name != \'panorama-grid\'">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_items\' | label"></div>\n\t\t\t\t\t\t<update-view-item [view]="view" [item]="item" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)" *for="let item of view.pathItems"></update-view-item>\n\t\t\t\t\t\t<div class="abstract" *if="view.pathItems.length == 0" [innerHTML]="\'editor_no_items\' | label"></div>\n\t\t\t\t\t\t<div class="btn--mode" (click)="setMode(3)" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_tiles\' | label"></div>\n\t\t\t\t\t\t<div *for="let tile of view.tiles">\n\t\t\t\t\t\t\t<div *if="tile.selected">\n\t\t\t\t\t\t\t\t<update-view-tile [view]="view" [tile]="tile" (update)="onUpdate($event)" (delete)="onDelete($event)"></update-view-tile>\n\t\t\t\t\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t<update-view-item [view]="view" [item]="item" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)" *for="let item of tile.navs"></update-view-item>\n\t\t\t\t\t\t\t\t\t\t<div class="abstract" *if="tile.navs.length == 0" [innerHTML]="\'editor_no_navs\' | label"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="btn--mode" (click)="onSelect({ type:\'viewItem\', value: \'nav\', tile: tile })" [innerHTML]="\'editor_add_nav\' | label"></div>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect({ type:\'viewItem\', value: \'nav\', tile: tile })">\n\t\t\t\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t\t\t\t<svg-icon name="nav"></svg-icon>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_add_nav\' | label"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="abstract" *if="view.tiles.length == 0" [innerHTML]="\'editor_no_tiles\' | label"></div>\n\t\t\t\t\t\t\x3c!-- <div class="btn--mode" (click)="setMode(3)">Add Tile</div> --\x3e\n\t\t\t\t\t</li>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<li *if="false">\n\t\t\t\t\t\t<div class="title">Icons</div>\n\t\t\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'animated-tabs\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 2 8.4 L 12 8.4 L 12 2 L 6 2 C 3.791 2 2 3.791 2 6 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 8.4 L 22 8.4 L 22 6 C 22 3.791 20.209 2 18 2 L 12 2 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Animated Tabs</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'card-list\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 6.8 13.6 C 6.8 13.158 7.158 12.8 7.6 12.8 L 16.8 12.8 C 17.242 12.8 17.6 13.158 17.6 13.6 L 17.6 16.8 C 17.6 17.242 17.242 17.6 16.8 17.6 L 7.6 17.6 C 7.158 17.6 6.8 17.242 6.8 16.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 6.8 7.2 C 6.8 6.758 7.158 6.4 7.6 6.4 L 16.8 6.4 C 17.242 6.4 17.6 6.758 17.6 7.2 L 17.6 10.4 C 17.6 10.842 17.242 11.2 16.8 11.2 L 7.6 11.2 C 7.158 11.2 6.8 10.842 6.8 10.4 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Card List</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'container-transitions\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.667 13 C 17.139 13 18.333 14.194 18.333 15.667 C 18.333 17.139 17.139 18.333 15.667 18.333 C 14.194 18.333 13 17.139 13 15.667 C 13 14.194 14.194 13 15.667 13 Z" fill="var(--svg-icon-tint)"></path></svg></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Container Transitions</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'dynamic-grid\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><g transform="translate(6.6 6.6)"><path d="M 6.048 0.8 C 6.048 0.358 6.406 0 6.848 0 L 10 0 C 10.442 0 10.8 0.358 10.8 0.8 L 10.8 3.952 C 10.8 4.394 10.442 4.752 10 4.752 L 6.848 4.752 C 6.406 4.752 6.048 4.394 6.048 3.952 Z" fill="var(--svg-icon-tint)" opacity="0.5"></path><path d="M 6.048 6.848 C 6.048 6.406 6.406 6.048 6.848 6.048 L 10 6.048 C 10.442 6.048 10.8 6.406 10.8 6.848 L 10.8 10 C 10.8 10.442 10.442 10.8 10 10.8 L 6.848 10.8 C 6.406 10.8 6.048 10.442 6.048 10 Z" fill="var(--svg-icon-tint)"></path><path d="M 0 0.8 C 0 0.358 0.358 0 0.8 0 L 3.952 0 C 4.394 0 4.752 0.358 4.752 0.8 L 4.752 3.952 C 4.752 4.394 4.394 4.752 3.952 4.752 L 0.8 4.752 C 0.358 4.752 0 4.394 0 3.952 Z" fill="var(--svg-icon-tint)"></path><path d="M 0 6.848 C 0 6.406 0.358 6.048 0.8 6.048 L 3.952 6.048 C 4.394 6.048 4.752 6.406 4.752 6.848 L 4.752 10 C 4.752 10.442 4.394 10.8 3.952 10.8 L 0.8 10.8 C 0.358 10.8 0 10.442 0 10 Z" fill="var(--svg-icon-tint)" opacity="0.5"></path></g></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Dynamic Grid</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'expand-on-tap\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 0 0 L 7.833 0" transform="translate(8.583 11.583) rotate(270 3.917 0.5)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 14.667 9.333 L 12 6.667 L 9.333 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 14.667 14.667 L 12 17.333 L 9.333 14.667" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"></path> </svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Expand on Tap</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'image-gallery-2\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 10.333 7.333 C 10.886 7.333 11.333 7.781 11.333 8.333 L 11.333 10.333 C 11.333 10.886 10.886 11.333 10.333 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.333 8.333 C 12.333 7.781 12.781 7.333 13.333 7.333 L 15.333 7.333 C 15.886 7.333 16.333 7.781 16.333 8.333 L 16.333 10.333 C 16.333 10.886 15.886 11.333 15.333 11.333 L 13.333 11.333 C 12.781 11.333 12.333 10.886 12.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.333 12.667 C 15.886 12.667 16.333 13.114 16.333 13.667 L 16.333 15.667 C 16.333 16.219 15.886 16.667 15.333 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Image Gallery 2</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-ui\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 6.8 4.8 C 7.905 4.8 8.8 5.695 8.8 6.8 C 8.8 7.905 7.905 8.8 6.8 8.8 C 5.695 8.8 4.8 7.905 4.8 6.8 C 4.8 5.695 5.695 4.8 6.8 4.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 4.8 C 13.105 4.8 14 5.695 14 6.8 C 14 7.905 13.105 8.8 12 8.8 C 10.895 8.8 10 7.905 10 6.8 C 10 5.695 10.895 4.8 12 4.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 17.2 4.8 C 18.305 4.8 19.2 5.695 19.2 6.8 C 19.2 7.905 18.305 8.8 17.2 8.8 C 16.095 8.8 15.2 7.905 15.2 6.8 C 15.2 5.695 16.095 4.8 17.2 4.8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Stories UI</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'todo-list\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8 12.333 L 10.5 14.833 L 16 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">To-Do List</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'toggle-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 17.333 15.333 C 18.438 15.333 19.333 16.229 19.333 17.333 C 19.333 18.438 18.438 19.333 17.333 19.333 C 16.229 19.333 15.333 18.438 15.333 17.333 C 15.333 16.229 16.229 15.333 17.333 15.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 17.333 10 C 18.438 10 19.333 10.895 19.333 12 C 19.333 13.105 18.438 14 17.333 14 C 16.229 14 15.333 13.105 15.333 12 C 15.333 10.895 16.229 10 17.333 10 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 17.333 4.667 C 18.438 4.667 19.333 5.562 19.333 6.667 C 19.333 7.771 18.438 8.667 17.333 8.667 C 16.229 8.667 15.333 7.771 15.333 6.667 C 15.333 5.562 16.229 4.667 17.333 4.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Toggle Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'bottom-sheet\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 10.333 C 22 10.886 21.552 11.333 21 11.333 L 3 11.333 C 2.448 11.333 2 10.886 2 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 13.333 C 2 12.781 2.448 12.333 3 12.333 L 21 12.333 C 21.552 12.333 22 12.781 22 13.333 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Bottom Sheet</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'draggable-sheet\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 14 C 2 12.895 2.895 12 4 12 L 20 12 C 21.105 12 22 12.895 22 14 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z M 10.667 15.333 L 13.333 15.333 C 13.702 15.333 14 15.035 14 14.667 C 14 14.298 13.702 14 13.333 14 L 10.667 14 C 10.298 14 10 14.298 10 14.667 C 10 15.035 10.298 15.333 10.667 15.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Draggable Sheet</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'modal-box\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 9.333 C 7.333 8.229 8.229 7.333 9.333 7.333 L 14.667 7.333 C 15.771 7.333 16.667 8.229 16.667 9.333 L 16.667 14.667 C 16.667 15.771 15.771 16.667 14.667 16.667 L 9.333 16.667 C 8.229 16.667 7.333 15.771 7.333 14.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Modal Box</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'side-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 11 2 C 11.552 2 12 2.448 12 3 L 12 21 C 12 21.552 11.552 22 11 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Side Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-form\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 11.667 7.333 C 11.667 7.333 11.667 7.333 11.667 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 9 C 16.667 9.552 16.219 10 15.667 10 L 13.333 10 L 13.333 15.667 C 13.333 16.219 12.886 16.667 12.333 16.667 L 11.667 16.667 C 11.114 16.667 10.667 16.219 10.667 15.667 L 10.667 10 L 8.333 10 C 7.781 10 7.333 9.552 7.333 9 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Input Form</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'loading-indicator\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 16.4 10.4 C 17.284 10.4 18 11.116 18 12 C 18 12.884 17.284 13.6 16.4 13.6 C 15.516 13.6 14.8 12.884 14.8 12 C 14.8 11.116 15.516 10.4 16.4 10.4 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 10.4 C 12.884 10.4 13.6 11.116 13.6 12 C 13.6 12.884 12.884 13.6 12 13.6 C 11.116 13.6 10.4 12.884 10.4 12 C 10.4 11.116 11.116 10.4 12 10.4 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.6 10.4 C 8.484 10.4 9.2 11.116 9.2 12 C 9.2 12.884 8.484 13.6 7.6 13.6 C 6.716 13.6 6 12.884 6 12 C 6 11.116 6.716 10.4 7.6 10.4 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Loading Indicator</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'radio-button-form\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 9.833 8.167 L 14.167 8.167 C 16.284 8.167 18 9.883 18 12 C 18 14.117 16.284 15.833 14.167 15.833 L 9.833 15.833 C 7.716 15.833 6 14.117 6 12 C 6 9.883 7.716 8.167 9.833 8.167 Z M 11.333 12 C 11.333 13.473 12.527 14.667 14 14.667 C 15.473 14.667 16.667 13.473 16.667 12 C 16.667 10.527 15.473 9.333 14 9.333 C 12.527 9.333 11.333 10.527 11.333 12 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Radio Button Form</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'checkbox-form\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8.651 6.931 C 7.911 6.738 7.238 7.411 7.431 8.151 L 9.363 15.558 C 9.592 16.435 10.775 16.58 11.208 15.784 L 13 12.5 L 16.284 10.708 C 17.08 10.275 16.935 9.092 16.058 8.863 Z" fill="var(--svg-icon-tint)"></path><path d="M 16 15.5 L 11 10.5" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Checkbox Form</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'splash-screen\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.757 13.414 C 6.976 12.633 6.976 11.367 7.757 10.586 L 10.586 7.757 C 11.367 6.976 12.633 6.976 13.414 7.757 L 16.243 10.586 C 17.024 11.367 17.024 12.633 16.243 13.414 L 13.414 16.243 C 12.633 17.024 11.367 17.024 10.586 16.243 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Splash Screen</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'timeout-transition\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1 5.8 C 1 3.149 3.149 1 5.8 1 L 18.2 1 C 20.851 1 23 3.149 23 5.8 L 23 18.2 C 23 20.851 20.851 23 18.2 23 L 5.8 23 C 3.149 23 1 20.851 1 18.2 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 12 6.72 C 14.916 6.72 17.28 9.084 17.28 12 C 17.28 14.916 14.916 17.28 12 17.28 C 9.084 17.28 6.72 14.916 6.72 12 C 6.72 9.084 9.084 6.72 12 6.72 Z M 11.34 12 C 11.34 12.365 11.635 12.66 12 12.66 L 14.2 12.66 C 14.565 12.66 14.86 12.365 14.86 12 C 14.86 11.635 14.565 11.34 14.2 11.34 L 12.66 11.34 L 12.66 9.8 C 12.66 9.435 12.365 9.14 12 9.14 C 11.635 9.14 11.34 9.435 11.34 9.8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Timeout Transition</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'accordion-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 16 10.667 L 12 14.667 L 8 10.667" fill="transparent" stroke-width="2" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Accordion Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'drop-on-scroll\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 0 0 L 8 0" transform="translate(8.5 11.5) rotate(270 4 0.5)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 15.333 11.333 L 12 8 L 8.667 11.333" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Drop on Scroll</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'nested-scroll\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 7 C 21.82 7.552 21.372 8 20.82 8 L 2.82 8 C 2.267 8 1.82 7.552 1.82 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 1.82 17 C 1.82 16.448 2.267 16 2.82 16 L 20.82 16 C 21.372 16 21.82 16.448 21.82 17 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 8.82 10 C 8.82 9.448 9.267 9 9.82 9 L 20.82 9 C 21.372 9 21.82 9.448 21.82 10 L 21.82 14 C 21.82 14.552 21.372 15 20.82 15 L 9.82 15 C 9.267 15 8.82 14.552 8.82 14 Z" fill="var(--svg-icon-tint)"></path><path d="M 1.82 10 C 1.82 9.448 2.267 9 2.82 9 L 6.82 9 C 7.372 9 7.82 9.448 7.82 10 L 7.82 14 C 7.82 14.552 7.372 15 6.82 15 L 2.82 15 C 2.267 15 1.82 14.552 1.82 14 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Nested Scroll</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'star-rating\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 11.399 6.884 C 11.645 6.386 12.355 6.386 12.601 6.884 L 13.705 9.122 C 13.803 9.32 13.992 9.457 14.21 9.489 L 16.68 9.848 C 17.229 9.928 17.449 10.603 17.051 10.99 L 15.264 12.733 C 15.106 12.887 15.034 13.108 15.071 13.326 L 15.493 15.786 C 15.587 16.333 15.013 16.75 14.521 16.492 L 12.312 15.331 C 12.117 15.228 11.883 15.228 11.688 15.331 L 9.479 16.492 C 8.987 16.75 8.413 16.333 8.507 15.786 L 8.929 13.326 C 8.966 13.108 8.894 12.887 8.736 12.733 L 6.949 10.99 C 6.551 10.603 6.771 9.928 7.32 9.848 L 9.79 9.489 C 10.008 9.457 10.197 9.32 10.295 9.122 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Star Rating</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'swipe-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 17.33 C 2 16.595 2.595 16 3.33 16 L 21 16 C 21.552 16 22 16.448 22 17 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 10 C 2 9.448 2.448 9 3 9 L 14 9 C 14.552 9 15 9.448 15 10 L 15 14 C 15 14.552 14.552 15 14 15 L 3 15 C 2.448 15 2 14.552 2 14 Z M 19 9 C 20.657 9 22 10.343 22 12 C 22 13.657 20.657 15 19 15 C 17.343 15 16 13.657 16 12 C 16 10.343 17.343 9 19 9 Z" fill="var(--svg-icon-tint)"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 7 C 22 7.552 21.552 8 21 8 L 3 8 C 2.448 8 2 7.552 2 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Swipe Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'switch-sheet\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.667 13.333 C 17.139 13.333 18.333 14.527 18.333 16 C 18.333 17.473 17.139 18.667 15.667 18.667 C 14.194 18.667 13 17.473 13 16 C 13 14.527 14.194 13.333 15.667 13.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 8.333 13.333 C 9.806 13.333 11 14.527 11 16 C 11 17.473 9.806 18.667 8.333 18.667 C 6.861 18.667 5.667 17.473 5.667 16 C 5.667 14.527 6.861 13.333 8.333 13.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Switch Sheet</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'tab-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 10 15.333 L 14 15.333 L 14 18.667 L 10 18.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 5.333 16.333 C 5.333 15.781 5.781 15.333 6.333 15.333 L 9.333 15.333 L 9.333 18.667 L 6.333 18.667 C 5.781 18.667 5.333 18.219 5.333 17.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 18.667 16.333 C 18.667 15.781 18.219 15.333 17.667 15.333 L 14.667 15.333 L 14.667 18.667 L 17.667 18.667 C 18.219 18.667 18.667 18.219 18.667 17.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Tab Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'wheel-picker\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 3.667 6 C 3.667 3.791 5.458 2 7.667 2 L 16.333 2 C 18.542 2 20.333 3.791 20.333 6 L 20.333 7 C 20.333 7.552 19.886 8 19.333 8 L 4.667 8 C 4.114 8 3.667 7.552 3.667 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 11 C 2 9.895 2.895 9 4 9 L 20 9 C 21.105 9 22 9.895 22 11 L 22 13 C 22 14.105 21.105 15 20 15 L 4 15 C 2.895 15 2 14.105 2 13 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.667 17 C 3.667 16.448 4.114 16 4.667 16 L 19.333 16 C 19.886 16 20.333 16.448 20.333 17 L 20.333 18 C 20.333 20.209 18.542 22 16.333 22 L 7.667 22 C 5.458 22 3.667 20.209 3.667 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Wheel Picker</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'cover-flow\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 11.333 17.962 C 11.333 18.385 11.068 18.762 10.67 18.904 L 4.673 21.045 C 3.37 21.511 2 20.545 2 19.162 L 2 4.838 C 2 3.455 3.37 2.489 4.673 2.955 L 10.67 5.096 C 11.068 5.238 11.333 5.615 11.333 6.038 Z" fill="var(--svg-icon-tint)"></path><path d="M 22 4.838 C 22 3.455 20.63 2.489 19.327 2.955 L 13.33 5.096 C 12.932 5.238 12.667 5.615 12.667 6.038 L 12.667 17.962 C 12.667 18.385 12.932 18.762 13.33 18.904 L 19.327 21.045 C 20.63 21.511 22 20.545 22 19.162 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Cover Flow</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'cube-effect\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6.743 C 2 5.898 2.531 5.144 3.327 4.859 L 9.997 2.477 C 10.648 2.245 11.333 2.727 11.333 3.419 L 11.333 20.581 C 11.333 21.273 10.648 21.755 9.997 21.523 L 3.327 19.141 C 2.531 18.856 2 18.102 2 17.257 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.667 3.419 C 12.667 2.727 13.352 2.245 14.003 2.477 L 20.673 4.859 C 21.469 5.144 22 5.898 22 6.743 L 22 17.257 C 22 18.102 21.469 18.856 20.673 19.141 L 14.003 21.523 C 13.352 21.755 12.667 21.273 12.667 20.581 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Cube Effect</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'flip-effect\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 11.333 4.667 C 11.333 4.114 10.886 3.667 10.333 3.667 L 4 3.667 C 2.895 3.667 2 4.562 2 5.667 L 2 18.333 C 2 19.438 2.895 20.333 4 20.333 L 10.333 20.333 C 10.886 20.333 11.333 19.886 11.333 19.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 20 4.167 C 20 3.891 20.224 3.667 20.5 3.667 L 20.5 3.667 C 21.328 3.667 22 4.338 22 5.167 L 22 18.833 C 22 19.662 21.328 20.333 20.5 20.333 L 20.5 20.333 C 20.224 20.333 20 20.109 20 19.833 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 18.667 4.631 C 18.667 3.309 17.406 2.35 16.131 2.704 L 13.399 3.463 C 12.966 3.583 12.667 3.978 12.667 4.427 L 12.667 19.573 C 12.667 20.022 12.966 20.417 13.399 20.537 L 16.131 21.296 C 17.406 21.65 18.667 20.691 18.667 19.369 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Flip Effect</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'parallax-scroll\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 6.667 C 12 5.562 12.895 4.667 14 4.667 L 17.333 4.667 C 18.438 4.667 19.333 5.562 19.333 6.667 L 19.333 10 C 19.333 11.105 18.438 12 17.333 12 L 14 12 C 12.895 12 12 11.105 12 10 Z" fill="var(--svg-icon-tint)"></path><path d="M 4.667 14 C 4.667 12.895 5.562 12 6.667 12 L 10 12 C 11.105 12 12 12.895 12 14 L 12 17.333 C 12 18.438 11.105 19.333 10 19.333 L 6.667 19.333 C 5.562 19.333 4.667 18.438 4.667 17.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Parallax Scroll</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'pile-effect\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 6.5 4 C 6.224 4 6 3.776 6 3.5 L 6 3.5 C 6 2.672 6.672 2 7.5 2 L 16.5 2 C 17.328 2 18 2.672 18 3.5 L 18 3.5 C 18 3.776 17.776 4 17.5 4 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 4.5 7 C 4.224 7 4 6.776 4 6.5 L 4 6.5 C 4 5.672 4.672 5 5.5 5 L 18.5 5 C 19.328 5 20 5.672 20 6.5 L 20 6.5 C 20 6.776 19.776 7 19.5 7 Z" fill="var(--svg-icon-tint)" opacity="0.7"></path><path d="M 0 2.67 C 0 1.195 1.195 0 2.67 0 L 11.33 0 C 12.805 0 14 1.195 14 2.67 L 14 17.33 C 14 18.805 12.805 20 11.33 20 L 2.67 20 C 1.195 20 0 18.805 0 17.33 Z" transform="translate(5 5) rotate(-90 7 10)" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Pile Effect</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'shuffle\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.174 10.452 L 16.708 9.06 L 15.174 7.667" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 15.174 16.333 L 16.708 14.94 L 15.174 13.548" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.145 9.06 C 16.145 9.06 13.982 8.542 12.617 9.679 C 11.252 10.815 11.829 12.213 10.776 13.548 C 9.724 14.882 7.708 14.94 7.708 14.94" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.145 14.823 C 16.145 14.823 13.982 15.34 12.617 14.204 C 11.252 13.068 11.829 11.669 10.776 10.335 C 9.724 9.001 7.708 8.942 7.708 8.942" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Shuffle</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'svg-animation\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8 12.333 L 10.5 14.833 L 16 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">SVG Animation</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'google-sheets\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7 8.667 C 7 8.206 7.373 7.833 7.833 7.833 L 7.833 7.833 C 8.294 7.833 8.667 8.206 8.667 8.667 L 8.667 8.667 C 8.667 9.127 8.294 9.5 7.833 9.5 L 7.833 9.5 C 7.373 9.5 7 9.127 7 8.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 7 12 C 7 11.54 7.373 11.167 7.833 11.167 L 7.833 11.167 C 8.294 11.167 8.667 11.54 8.667 12 L 8.667 12 C 8.667 12.46 8.294 12.833 7.833 12.833 L 7.833 12.833 C 7.373 12.833 7 12.46 7 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 7 15.333 C 7 14.873 7.373 14.5 7.833 14.5 L 7.833 14.5 C 8.294 14.5 8.667 14.873 8.667 15.333 L 8.667 15.333 C 8.667 15.794 8.294 16.167 7.833 16.167 L 7.833 16.167 C 7.373 16.167 7 15.794 7 15.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 8.667 C 9.778 8.206 10.151 7.833 10.611 7.833 L 16.167 7.833 C 16.627 7.833 17 8.206 17 8.667 L 17 8.667 C 17 9.127 16.627 9.5 16.167 9.5 L 10.611 9.5 C 10.151 9.5 9.778 9.127 9.778 8.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 12 C 9.778 11.54 10.151 11.167 10.611 11.167 L 16.167 11.167 C 16.627 11.167 17 11.54 17 12 L 17 12 C 17 12.46 16.627 12.833 16.167 12.833 L 10.611 12.833 C 10.151 12.833 9.778 12.46 9.778 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 15.333 C 9.778 14.873 10.151 14.5 10.611 14.5 L 16.167 14.5 C 16.627 14.5 17 14.873 17 15.333 L 17 15.333 C 17 15.794 16.627 16.167 16.167 16.167 L 10.611 16.167 C 10.151 16.167 9.778 15.794 9.778 15.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Google Sheets</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'map\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 11.82 6.504 C 14.029 6.504 15.82 8.282 15.82 10.476 C 15.82 10.698 15.801 10.915 15.766 11.127 C 15.359 14.488 13.033 16.581 12.155 17.261 C 12.051 17.341 11.976 17.437 11.82 17.437 C 11.663 17.437 11.586 17.34 11.481 17.258 C 10.6 16.576 8.28 14.483 7.873 11.127 C 7.838 10.915 7.82 10.698 7.82 10.476 C 7.82 8.282 9.61 6.504 11.82 6.504 Z M 9.486 10.644 C 9.486 11.933 10.531 12.977 11.82 12.977 C 13.108 12.977 14.153 11.933 14.153 10.644 C 14.153 9.355 13.108 8.311 11.82 8.311 C 10.531 8.311 9.486 9.355 9.486 10.644 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Map</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'signature-pad\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8.82 13.068 C 8.56 12.807 8.56 12.385 8.82 12.125 L 13.733 7.212 C 13.993 6.952 14.415 6.952 14.676 7.212 L 16.788 9.324 C 17.048 9.585 17.048 10.007 16.788 10.267 L 11.875 15.18 C 11.615 15.44 11.193 15.44 10.932 15.18 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.096 0.303 C 3.318 0.17 3.6 0.33 3.6 0.589 L 3.6 3.732 C 3.6 3.991 3.318 4.151 3.096 4.018 L 0.953 2.732 C 0.521 2.473 0.521 1.848 0.953 1.589 Z" transform="translate(6.24 13.8) rotate(-45 1.8 2.16)" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Signature Pad</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'sound-effects\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 14.225 10.793 C 14.471 11.102 14.623 11.529 14.623 12 C 14.623 12.471 14.471 12.898 14.225 13.207" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.224 9.185 C 16.96 9.911 17.417 10.905 17.417 12 C 17.417 13.095 16.96 14.09 16.224 14.816" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 6.083 10.656 C 6.083 10.288 6.382 9.989 6.75 9.989 L 7.674 9.989 L 11.021 7.835 C 11.464 7.549 12.048 7.868 12.048 8.396 L 12.048 15.604 C 12.048 16.132 11.464 16.451 11.021 16.165 L 7.674 14.011 L 6.75 14.011 C 6.382 14.011 6.083 13.712 6.083 13.344 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Sound Effects</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'card-swipe\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 3.423 7.423 C 3.423 5.214 5.214 3.423 7.423 3.423 L 16.756 3.423 C 18.965 3.423 20.756 5.214 20.756 7.423 L 20.756 16.756 C 20.756 18.965 18.965 20.756 16.756 20.756 L 7.423 20.756 C 5.214 20.756 3.423 18.965 3.423 16.756 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 9.172 3.377 C 10.734 1.815 13.266 1.815 14.828 3.377 L 20.721 9.269 C 22.283 10.831 22.283 13.364 20.721 14.926 L 14.828 20.819 C 13.266 22.381 10.734 22.381 9.172 20.819 L 3.279 14.926 C 1.717 13.364 1.717 10.831 3.279 9.269 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Card Swipe</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'custom-effect\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6.2 C 2 5.673 2.31 5.195 2.792 4.981 L 7.063 3.083 C 7.503 2.887 8 3.21 8 3.693 L 8 20.307 C 8 20.79 7.503 21.113 7.063 20.917 L 2.792 19.019 C 2.31 18.805 2 18.327 2 17.8 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 9.333 3.297 C 9.333 2.642 9.954 2.163 10.588 2.33 L 20.509 4.941 C 21.388 5.172 22 5.967 22 6.875 L 22 17.125 C 22 18.033 21.388 18.828 20.509 19.059 L 10.588 21.67 C 9.954 21.837 9.333 21.358 9.333 20.703 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Custom Effect</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'drag-handle\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 2.667 L 2.667 0 L 0 2.667" transform="translate(5.667 10.667) rotate(-90 2.667 1.333)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 5.333 0 L 2.667 2.667 L 0 0" transform="translate(13 10.667) rotate(-90 2.667 1.333)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Drag Handle</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'dynamic-header\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 8 L 2 8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Dynamic Header</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'image-panning\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 14 C 12 12.895 12.895 12 14 12 L 20 12 C 21.105 12 22 12.895 22 14 L 22 18 C 22 20.209 20.209 22 18 22 L 14 22 C 12.895 22 12 21.105 12 20 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Image Panning</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-data\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 10.333 C 16.667 10.886 16.219 11.333 15.667 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.667 12.667 C 16.219 12.667 16.667 13.114 16.667 13.667 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Input Data</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-validation\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 10.333 C 16.667 10.886 16.219 11.333 15.667 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.667 12.667 C 16.219 12.667 16.667 13.114 16.667 13.667 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Input Validation</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'like-animation\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.28 0 C 7.017 0 7.747 2.366 6.357 3.755 C 4.968 5.144 3.543 5.905 3.543 5.905 C 3.543 5.905 2.118 5.144 0.728 3.755 C -0.661 2.365 0.069 -0 1.806 0 C 3.543 0 3.543 1.701 3.543 1.701 C 3.543 1.701 3.543 0 5.28 0 Z" transform="translate(11.213 11.787) rotate(15 3.543 2.953)" fill="var(--svg-icon-tint)"></path><path d="M 5.28 0 C 7.017 -0 7.747 2.365 6.357 3.755 C 4.968 5.144 3.543 5.905 3.543 5.905 C 3.543 5.905 2.118 5.144 0.728 3.755 C -0.661 2.366 0.069 0 1.806 0 C 3.543 0 3.543 1.701 3.543 1.701 C 3.543 1.701 3.543 0 5.28 0 Z" transform="translate(5.701 6.669) rotate(-15 3.543 2.953)" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Like Animation</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'like-counter\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 14.778 7.333 C 17.556 7.333 18.724 11.072 16.502 13.268 C 14.279 15.464 12 16.667 12 16.667 C 12 16.667 9.721 15.464 7.498 13.268 C 5.276 11.072 6.444 7.333 9.222 7.333 C 12 7.333 12 10.022 12 10.022 C 12 10.022 12 7.333 14.778 7.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Like Counter</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'lock-screen\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 11 C 7.333 10.448 7.781 10 8.333 10 L 15.667 10 C 16.219 10 16.667 10.448 16.667 11 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 7.333 C 13.289 7.333 14.333 8.378 14.333 9.667 C 14.333 10.955 13.289 12 12 12 C 10.711 12 9.667 10.955 9.667 9.667 C 9.667 8.378 10.711 7.333 12 7.333 Z" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Lock Screen</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'long-press-menu\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 16.667 10.667 C 17.771 10.667 18.667 11.562 18.667 12.667 C 18.667 13.771 17.771 14.667 16.667 14.667 C 15.562 14.667 14.667 13.771 14.667 12.667 C 14.667 11.562 15.562 10.667 16.667 10.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12 8 C 13.105 8 14 8.895 14 10 C 14 11.105 13.105 12 12 12 C 10.895 12 10 11.105 10 10 C 10 8.895 10.895 8 12 8 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.333 10.667 C 8.438 10.667 9.333 11.562 9.333 12.667 C 9.333 13.771 8.438 14.667 7.333 14.667 C 6.229 14.667 5.333 13.771 5.333 12.667 C 5.333 11.562 6.229 10.667 7.333 10.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Long Press Menu</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'perspective-3d\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 6.913 22 C 5.987 22 5.182 21.364 4.967 20.463 L 2.586 10.463 C 2.287 9.206 3.24 8 4.532 8 L 19.468 8 C 20.76 8 21.713 9.206 21.414 10.463 L 19.033 20.463 C 18.818 21.364 18.013 22 17.087 22 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.833 7 C 3.557 7 3.333 6.776 3.333 6.5 L 3.333 6.5 C 3.333 5.672 4.005 5 4.833 5 L 19.167 5 C 19.995 5 20.667 5.672 20.667 6.5 L 20.667 6.5 C 20.667 6.776 20.443 7 20.167 7 Z" fill="var(--svg-icon-tint)" opacity="0.7"></path><path d="M 5.167 4 C 4.891 4 4.667 3.776 4.667 3.5 L 4.667 3.5 C 4.667 2.672 5.338 2 6.167 2 L 17.833 2 C 18.662 2 19.333 2.672 19.333 3.5 L 19.333 3.5 C 19.333 3.776 19.109 4 18.833 4 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Perspective 3D</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'progress-bar\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.153 17 C 5.153 16.08 5.899 15.333 6.82 15.333 L 16.82 15.333 C 17.74 15.333 18.486 16.08 18.486 17 L 18.486 17 C 18.486 17.92 17.74 18.667 16.82 18.667 L 6.82 18.667 C 5.899 18.667 5.153 17.92 5.153 17 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 5.153 17 C 5.153 16.08 5.899 15.333 6.82 15.333 L 11.486 15.333 C 12.407 15.333 13.153 16.08 13.153 17 L 13.153 17 C 13.153 17.92 12.407 18.667 11.486 18.667 L 6.82 18.667 C 5.899 18.667 5.153 17.92 5.153 17 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Progress Bar</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'scroll-progress\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 10.333 C 7.333 9.781 7.781 9.333 8.333 9.333 L 15.667 9.333 C 16.219 9.333 16.667 9.781 16.667 10.333 L 16.667 11.667 C 16.667 12.219 16.219 12.667 15.667 12.667 L 8.333 12.667 C 7.781 12.667 7.333 12.219 7.333 11.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 14.667 C 7.333 14.114 7.781 13.667 8.333 13.667 L 15.667 13.667 C 16.219 13.667 16.667 14.114 16.667 14.667 L 16.667 16 C 16.667 16.552 16.219 17 15.667 17 L 8.333 17 C 7.781 17 7.333 16.552 7.333 16 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 7.667 C 7.333 7.298 7.632 7 8 7 L 16 7 C 16.368 7 16.667 7.298 16.667 7.667 L 16.667 7.667 C 16.667 8.035 16.368 8.333 16 8.333 L 8 8.333 C 7.632 8.333 7.333 8.035 7.333 7.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 7.667 C 7.333 7.298 7.632 7 8 7 L 12.667 7 C 13.035 7 13.333 7.298 13.333 7.667 L 13.333 7.667 C 13.333 8.035 13.035 8.333 12.667 8.333 L 8 8.333 C 7.632 8.333 7.333 8.035 7.333 7.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Scroll Progress</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'show-password\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 10.6 12 C 10.6 11.227 11.227 10.6 12 10.6 L 12 10.6 C 12.773 10.6 13.4 11.227 13.4 12 L 13.4 12 C 13.4 12.773 12.773 13.4 12 13.4 L 12 13.4 C 11.227 13.4 10.6 12.773 10.6 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 12.166 7.833 C 14.892 7.833 17.161 9.42 17.811 12 C 17.161 14.58 14.892 16.167 12.166 16.167 C 9.44 16.167 7.127 14.58 6.478 12 C 7.127 9.42 9.44 7.833 12.166 7.833 Z M 9.333 12 C 9.333 13.473 10.527 14.667 12 14.667 C 13.473 14.667 14.667 13.473 14.667 12 C 14.667 10.527 13.473 9.333 12 9.333 C 10.527 9.333 9.333 10.527 9.333 12 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Show Password</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'slider\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.667 12 L 18.333 12" stroke="var(--svg-icon-tint)" fill="transparent" opacity="0.4" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 12 8.333 C 14.025 8.333 15.667 9.975 15.667 12 C 15.667 14.025 14.025 15.667 12 15.667 C 9.975 15.667 8.333 14.025 8.333 12 C 8.333 9.975 9.975 8.333 12 8.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Slider</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-drag\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 6.667 C 5.333 5.93 5.93 5.333 6.667 5.333 L 10 5.333 C 10.736 5.333 11.333 5.93 11.333 6.667 L 11.333 6.667 C 11.333 7.403 10.736 8 10 8 L 6.667 8 C 5.93 8 5.333 7.403 5.333 6.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.667 6.667 C 12.667 5.93 13.264 5.333 14 5.333 L 17.333 5.333 C 18.07 5.333 18.667 5.93 18.667 6.667 L 18.667 6.667 C 18.667 7.403 18.07 8 17.333 8 L 14 8 C 13.264 8 12.667 7.403 12.667 6.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Stories: Drag</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-tap\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 6.667 C 5.333 5.93 5.93 5.333 6.667 5.333 L 10 5.333 C 10.736 5.333 11.333 5.93 11.333 6.667 L 11.333 6.667 C 11.333 7.403 10.736 8 10 8 L 6.667 8 C 5.93 8 5.333 7.403 5.333 6.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 12.667 6.667 C 12.667 5.93 13.264 5.333 14 5.333 L 17.333 5.333 C 18.07 5.333 18.667 5.93 18.667 6.667 L 18.667 6.667 C 18.667 7.403 18.07 8 17.333 8 L 14 8 C 13.264 8 12.667 7.403 12.667 6.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Stories: Tap</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'toast-prompt\')">\n\t\t\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18.333 C 22 20.542 20.209 22.333 18 22.333 L 6 22.333 C 3.791 22.333 2 20.542 2 18.333 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 6.333 C 15.13 6.333 17.667 8.87 17.667 12 C 17.667 15.13 15.13 17.667 12 17.667 C 8.87 17.667 6.333 15.13 6.333 12 C 6.333 8.87 8.87 6.333 12 6.333 Z" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)"></path><path d="M 12 13 C 12.552 13 13 13.448 13 14 C 13 14.552 12.552 15 12 15 C 11.448 15 11 14.552 11 14 C 11 13.448 11.448 13 12 13 Z" fill="var(--svg-icon-tint)"></path><path d="M 11.06 9.998 C 11.027 9.457 11.458 9 12 9 L 12 9 C 12.542 9 12.973 9.457 12.94 9.998 L 12.848 11.535 C 12.821 11.983 12.449 12.333 12 12.333 L 12 12.333 C 11.551 12.333 11.179 11.983 11.152 11.535 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t\t\t<div class="title">Toast Prompt</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t\t--\x3e\n\t\t\t\t</ul>\n\t\t\t\t<ul class="nav--editor" *if="mode === 2">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_views\' | label"></div>\n\t\t\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t\t\t<li *for="let item of supportedViewTypes">\n\t\t\t\t\t\t\t\t<div class="btn" [class]="{ disabled: item.disabled }" (click)="onSelect({ type:\'view\', value: item.type.name })">\n\t\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.name"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<ul class="nav--editor" *if="mode === 3">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_view_items\' | label"></div>\n\t\t\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t\t\t<li *for="let item of supportedViewItemTypes">\n\t\t\t\t\t\t\t\t<div class="btn" [class]="{ disabled: item.disabled }" (click)="onSelect({ type:\'viewItem\', value: item.type.name })" [title]="item.id">\n\t\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.name"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<div class="abstract" *if="supportedViewItemTypes.length == 0" [innerHTML]="\'editor_type_no_items\' | label"></div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t'};var Ic=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var t=this,e=this.meetingUrl.embedViewId;this.state={status:C.get("status")||xe,role:C.get("role")||qt.Publisher,membersCount:3,controlling:!1,spying:!1,silencing:!1,hosted:!0,chat:!1,chatDirty:!0,name:"Jhon Appleseed",uid:"7341614597544882",showNavInfo:!0},this.state.live=this.state.role!==qt.SelfService&&this.state.role!==qt.Embed&&!ee,this.state.navigable=null==e,this.state.mode=Rn.getMode(this.state.role),this.view={likes:41,type:{id:2,name:"panorama"}},this.local={},this.screen=null,this.remoteScreen_=null,this.media=null,this.hasScreenViewItem=!1,this.media=!0,this.remotes=new Array(8).fill(0).map((function(t,e){return{id:e+1}})),this.languageService=ve,this.showLanguages=!1,zt.patchState(this.state),this.fullscreen$().pipe(r.takeUntil(this.unsubscribe$)).subscribe();this.vrService=ko.getService();console.log("LayoutComponent",this),setTimeout((function(){var e=Nr;switch(e){case kr:jr.open$({message:pe.transform("bhere_support_request_sent")}).pipe(r.takeUntil(t.unsubscribe$)).subscribe((function(t){t instanceof Fr&&console.log("ToastResolveEvent",t)}));break;case Br:jr.open$({message:pe.transform("bhere_support_request_sent"),type:e,position:Ur}).pipe(r.takeUntil(t.unsubscribe$)).subscribe((function(t){t instanceof Fr?console.log("ToastResolveEvent",t):t instanceof Hr&&console.log("ToastRejectEvent",t)}));break;case Nr:jr.open$({message:pe.transform("bhere_support_request_dialog"),acceptMessage:pe.transform("bhere_support_request_dialog_accept"),rejectMessage:pe.transform("bhere_support_request_dialog_reject"),type:e,position:Ur}).pipe(r.takeUntil(t.unsubscribe$)).subscribe((function(t){t instanceof Fr?console.log("ToastResolveEvent",t):t instanceof Hr&&console.log("ToastRejectEvent",t)}))}}),3e3)},o.setLanguage=function(t){var e=this;this.languageService.setLanguage$(t).pipe(first()).subscribe((function(t){e.showLanguages=!1,e.pushChanges()}))},o.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},o.patchState=function(t){this.state=Object.assign({},this.state,t),this.screen=this.state.screen||null,this.remoteScreen=this.screen,this.pushChanges()},o.toggleCamera=function(){this.patchState({cameraMuted:!this.state.cameraMuted})},o.toggleAudio=function(){this.patchState({audioMuted:!this.state.audioMuted})},o.toggleScreen=function(){this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))},o.toggleVolume=function(){this.patchState({volumeMuted:!this.state.volumeMuted})},o.toggleMode=function(){var t=this.state.mode===pn?vn:pn;this.patchState({mode:t})},o.toggleFullScreen=function(){var e=t.getContext(this).node;!this.state.fullScreen?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},o.fullscreen$=function(){var t=this;return n.fromEvent(document,"fullscreenchange").pipe(r.tap((function(e){var n=null!=document.fullscreenElement;t.patchState({fullScreen:n})})))},o.toggleChat=function(){this.patchState({chat:!this.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))},o.toggleNavInfo=function(){this.patchState({showNavInfo:!this.state.showNavInfo})},o.onBack=function(){console.log("LayoutComponent.onBack")},o.onChatClose=function(){this.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))},o.onToggleControl=function(t){var e=this.state.controlling===t?null:t;this.patchState({controlling:e,spying:!1})},o.onToggleSilence=function(){this.patchState({silencing:!this.state.silencing})},o.onToggleSpy=function(t){var e=this.state.spying===t?null:t;this.patchState({spying:e,controlling:!1})},o.addLike=function(){this.view.liked=!0,this.showLove(this.view)},o.showLove=function(t){var e=this;if(t&&this.view.id===t.id){var n=this.view.showLove;this.view.likes=t.likes,this.view.showLove=!0,this.pushChanges(),n||setTimeout((function(){e.view.showLove=!1,e.pushChanges()}),3100)}},o.disconnect=function(){},c(i,[{key:"meetingUrl",get:function(){return this.meetingUrl_||(this.meetingUrl_=new Jt),this.meetingUrl_}},{key:"isVirtualTourUser",get:function(){return-1!==[qt.Publisher,qt.Attendee,qt.Streamer,qt.Viewer].indexOf(this.state.role)}},{key:"isEmbed",get:function(){if(this.route)return"embed"===this.route.params.mode}},{key:"isSelfServiceTour",get:function(){if(this.route)return"selfServiceTour"===this.route.params.mode}},{key:"isNavigable",get:function(){return null==this.meetingUrl.embedViewId}},{key:"isBackButtonVisible",get:function(){return this.view&&(this.view.type.name===pr.Media.name||this.view.type.name===pr.Model.name)}},{key:"showNavInfoToggler",get:function(){return de.flags.hideNavInfo&&this.state.mode!==vn}},{key:"uiClass",get:function(){var t={};return t[this.state.role]=!0,t.chat=this.state.chat,t.remotes=this.state.mode===vn,t.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,t.media=!t.remotes&&this.media,t.locked=this.locked,t}},{key:"remoteClass",get:function(){return"group--remote--"+Math.min(9,this.remotes.length)}},{key:"controlled",get:function(){return this.state.controlling&&this.state.controlling!==this.state.uid}},{key:"controlling",get:function(){return this.state.controlling&&this.state.controlling===this.state.uid}},{key:"silencing",get:function(){return zt.state.silencing}},{key:"silenced",get:function(){return zt.state.silencing&&zt.state.role===qt.Streamer}},{key:"spyed",get:function(){return this.state.spying&&this.state.spying===this.state.uid}},{key:"spying",get:function(){return this.state.spying&&this.state.spying!==this.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"remoteScreen",get:function(){return this.remoteScreen_},set:function(t){this.remoteScreen_!==t&&(this.remoteScreen_=t,window.dispatchEvent(new Event("resize")))}}]),i}(t.Component);Ic.meta={selector:"[layout-component]",hosts:{host:Yt},template:'\n\t<div class="page page--agora">\n\t\t'+E+'\n\t\t\x3c!-- Status Checklist --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'checklist\'" [agora-checklist] (checked)="onChecked($event)"></div>\n\t\t\x3c!-- Status Link --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'link\'" [agora-link] (link)="onLink($event)"></div>\n\t\t\x3c!-- Status Login --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'login\'" [agora-login] (login)="onLogin($event)"></div>\n\t\t\x3c!-- Status Name --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == \'name\' || (state.status == \'disconnected\' && state.role === \'viewer\')" [agora-name] (name)="onName($event)"></div>\n\t\t\x3c!-- Status Device --\x3e\n\t\t<div class="ui ui--info" *if="state.status == \'device\' || (state.status == \'disconnected\' && state.role !== \'viewer\')" [agora-device] (enter)="onEnter($event)"></div>\n\t\t\x3c!-- Virtual Tour --\x3e\n\t\t<div class="ui virtual-tour" [class]="uiClass" *if="state.status == \'connected\' && isVirtualTourUser">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote sidebar --\x3e\n\t\t\t<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t\t\t\t<div class="agora-stream" *for="let remote of remotes">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info" [class]="{ spyed: state.spying == remote.id, controlling: state.controlling == remote.id }">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t\t<button type="button" class="btn--control" [title]="\'title_control\' | label" (click)="onToggleControl(remote.id)" *if="state.role === \'publisher\'">\n\t\t\t\t\t\t\t<svg class="control" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn--spy" [title]="\'title_spy\' | label" (click)="onToggleSpy(remote.id)" *if="state.role === \'publisher\'">\n\t\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--members" *if="state.mode == \'virtual-tour\'">\n\t\t\t\t\t<div class="members">\n\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="credits">\n\t\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote screen --\x3e\n\t\t\t<div class="group--remote-screen" *if="remoteScreen">\n\t\t\t\t<div class="agora-stream">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--header">\n\t\t\t\t\x3c!-- service --\x3e\n\t\t\t\t<div class="group--service">\n\t\t\t\t\t<button type="button" class="btn--back" [title]="\'title_back\' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--view-mode" [title]="\'title_view_mode\' | label" (click)="toggleMode($event)" *if="state.mode != \'embed\'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'virtual-tour\'"><use xlink:href="#live-meeting"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'live-meeting\'"><use xlink:href="#virtual-tour"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--navmap" [title]="\'title_navmap\' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != \'live-meeting\'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- local streams --\x3e\n\t\t\t\t<div class="group--local" [class]="{ publisher: state.role == \'publisher\', viewer: state.role == \'viewer\' }" *if="state.live">\n\t\t\t\t\t<button type="button" class="btn--silence" [title]="\'title_silence\' | label" [class]="{ active: state.silencing }" (click)="onToggleSilence()" *if="state.role === \'publisher\'">\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--control" [title]="\'title_control\' | label" [class]="{ active: state.controlling == state.uid }" (click)="onToggleControl(state.uid)" *if="state.role == \'publisher\'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class="agora-stream" *if="!local"></div>\n\t\t\t\t\t<div class="agora-stream" *if="local">\n\t\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="agora-stream agora-stream--screen" *if="screen">\n\t\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--footer">\n\t\t\t\t'+v+"\n\t\t\t\t"+m+"\n\t\t\t\t"+g+"\n\t\t\t\t"+A+'\n\t\t\t</div>\n\t\t\t\x3c!-- members --\x3e\n\t\t\t<div class="group--members" *if="state.mode == \'live-meeting\'">\n\t\t\t\t<div class="members">\n\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="credits">\n\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t'+y+"\n\t\t\t"+b+"\n\t\t\t"+w+'\n\t\t</div>\n\t\t\x3c!-- Smart Device --\x3e\n\t\t<div class="ui remotes" [class]="uiClass" *if="state.status == \'connected\' && state.role == \'smart-device\'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t</div>\n\t\t\t\x3c!-- remote sidebar --\x3e\n\t\t\t<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t\t\t\t<div class="agora-stream" *for="let remote of remotes">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t\t<button type="button" class="btn--spy" [title]="\'title_spy\' | label" *if="state.role === \'publisher\'" (click)="onToggleSpy(remote.id)">\n\t\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote screen --\x3e\n\t\t\t<div class="group--remote-screen" *if="remoteScreen">\n\t\t\t\t<div class="agora-stream">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- local streams --\x3e\n\t\t\t<div class="group--local" [class]="{ publisher: state.role == \'publisher\', viewer: state.role == \'viewer\' }" *if="state.live">\n\t\t\t\t<div class="agora-stream" *if="local">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- controls --\x3e\n\t\t\t<div class="group--controls" *if="state.live">\n\t\t\t\t<div class="group--actions">\n\t\t\t\t\t<button type="button" class="btn--call" [title]="\'title_disconnect\' | label" (click)="disconnect()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--cam" [title]="\'title_mute_camera\' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--mic" [title]="\'title_mute_mic\' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--screen" [title]="\'title_share_screen\' | label" [class]="{ active: screen }" (click)="toggleScreen()" *if="state.role == \'publisher\' || state.role == \'attendee\' || controlling">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#screen"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--chat" [title]="\'title_chat\' | label" [class]="{ active: state.chatDirty }" (click)="toggleChat()" *if="(\'chat\' | flag)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#chat"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--navinfo" [title]="\'title_navinfo\' | label" [class]="{ active: state.showNavInfo }" (click)="toggleNavInfo()" *if="showNavInfoToggler">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navinfo"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- members --\x3e\n\t\t\t<div class="group--members">\n\t\t\t\t<div class="members">\n\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="credits">\n\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- Self Service Tour --\x3e\n\t\t<div class="ui" [class]="uiClass" *if="state.status == \'connected\' && state.mode == \'self-service-tour\'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- service --\x3e\n\t\t\t<div class="group--service">\n\t\t\t\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t'+g+"\n\t\t\t"+A+'\n\t\t</div>\n\t\t\x3c!-- Embed --\x3e\n\t\t<div class="ui" [class]="uiClass" *if="state.status == \'connected\' && state.mode == \'embed\'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- service --\x3e\n\t\t\t<div class="group--service">\n\t\t\t\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t'+g+"\n\t\t\t"+A+'\n\t\t</div>\n\t\t<a class="btn--logo" [href]="\'index\' | slug" *if="state.status != \'connected\'">\n\t\t\t<img [src]="\'logo\' | env" *if="\'logo\' | env" />\n\t\t\t<svg viewBox="0 0 270 98" *if="!(\'logo\' | env)"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener" *if="state.status != \'connected\'">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t\t<div class="group--language" language (set)="pushChanges()" *if="state.status != \'connected\'"></div>\n\t</div>\n\t'};var Oc=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var e=this;this.platform=Dn.platform,this.missingAr=!1,this.missingUsdz=!1,this.missingGltf=!1;var n=this.viewId=this.getViewId();n&&ri.viewById$(n).pipe(r.first()).subscribe((function(n){if(!n.ar)return e.missingAr=!0,void e.pushChanges();if(e.platform===Bn){var r=e.getUsdzSrc(n);r?window.location.href=r:(e.missingUsdz=!0,e.pushChanges())}else if(null!==e.getGltfSrc(n)){var i=e.getModelViewerNode(n);t.getContext(e).node.appendChild(i)}else e.missingGltf=!0,e.pushChanges()}))},i.getUsdzSrc=function(t){return t.ar&&t.ar.usdz?de.getPath(t.ar.usdz.folder+t.ar.usdz.file):null},i.getGltfSrc=function(t){return t.ar&&t.ar.gltf?de.getPath(t.ar.gltf.folder+t.ar.gltf.file):null},i.getViewId=function(){var t=new Jt,e=null;return t.viewId&&(e=parseInt(t.viewId)),e},i.getModelViewerNode=function(t){var e=de.getPath(t.asset.folder+t.asset.file),n=this.getUsdzSrc(t),r=this.getGltfSrc(t),i='\n\t\t\t<model-viewer alt="'+t.name+'" skybox-image="'+e+'" ios-src="'+n+'" src="'+r+'" ar ar-modes="webxr scene-viewer quick-look" ar-scale="auto" camera-controls></model-viewer>\n\t\t',o=document.createElement("div");return o.innerHTML=i,o.firstElementChild},n}(t.Component);Oc.meta={selector:"[try-in-ar]",hosts:{host:Yt},template:'\n\t\t<div class="page page--try-in-ar">\n\t\t\t<div *if="platform != \'ios\'">\n\t\t\t\t<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"><\/script>\n\t\t\t\t<script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"><\/script>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="!viewId">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Unknown url.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingAr">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing AR in view.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingUsdz">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing .usdz in ar.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingGltf">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing .gltf in ar.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var Mc=[{name:"index",path:"/",forwardTo:"it"},{name:"it",path:"/it",defaultParams:{lang:"it",mode:"access"},factory:In},{name:"it.access",path:"/accesso",defaultParams:{lang:"it",mode:"access"},factory:In},{name:"it.accessCode",path:"/codice-di-accesso?:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"it",mode:"accessCode"},factory:$t},{name:"it.guidedTour",path:"/tour-guidato?:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"it",mode:"guidedTour"},factory:hc},{name:"it.selfServiceTour",path:"/tour-self-service?:viewId&:pathId",defaultParams:{lang:"it",mode:"selfServiceTour"},factory:hc},{name:"it.embed",path:"/embed",defaultParams:{lang:"it",mode:"embed"},factory:hc},{name:"it.tryInAr",path:"/prova-in-ar",defaultParams:{lang:"it",mode:"tryInAr"},factory:Oc},{name:"it.editor",path:"/editor",defaultParams:{lang:"it",mode:"editor"},factory:Rc},{name:"it.layout",path:"/layout",defaultParams:{lang:"it",mode:"layout"},factory:Ic},{name:"en",path:"/en",defaultParams:{lang:"en",mode:"access"},factory:In},{name:"en.access",path:"/access",defaultParams:{lang:"en",mode:"access"},factory:In},{name:"en.accessCode",path:"/accesso-code?:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"en",mode:"accessCode"},factory:$t},{name:"en.guidedTour",path:"/guided-tour?:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"en",mode:"guidedTour"},factory:hc},{name:"en.selfServiceTour",path:"/self-service-tour?:viewId&:pathId",defaultParams:{lang:"en",mode:"selfServiceTour"},factory:hc},{name:"en.embed",path:"/embed",defaultParams:{lang:"en",mode:"embed"},factory:hc},{name:"en.tryInAr",path:"/try-in-ar",defaultParams:{lang:"en",mode:"tryInAr"},factory:Oc},{name:"en.editor",path:"/editor",defaultParams:{lang:"en",mode:"editor"},factory:Rc},{name:"en.layout",path:"/layout",defaultParams:{lang:"en",mode:"layout"},factory:Ic}],Lc=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onInit=function(){Qt.event$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){var e=t.route;e&&"embed"===e.params.mode&&(de.flags.like=!1);var n=Mc;ve.setRoute(e,n)})),t.getContext(this).node.classList.remove("hidden")},n}(t.Component);Lc.meta={selector:"[b-here-component]",template:'\n\t\t\x3c!-- svg --\x3e\n\t\t\n\t\t<svg width="0" height="0" class="hidden" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true">\n\t\t\t<symbol id="arrow-down" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 7.33l2.829-2.83 9.175 9.339 9.167-9.339 2.829 2.83-11.996 12.17z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="arrow-next" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="arrow-prev" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="call" viewBox="0 0 24 24">\n\t\t\t\t<path d="M20 22.621l-3.521-6.795c-.008.004-1.974.97-2.064 1.011-2.24 1.086-6.799-7.82-4.609-8.994l2.083-1.026-3.493-6.817-2.106 1.039c-7.202 3.755 4.233 25.982 11.6 22.615.121-.055 2.102-1.029 2.11-1.033z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="heart" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="heart-outline" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 9.229c.234-1.12 1.547-6.229 5.382-6.229 2.22 0 4.618 1.551 4.618 5.003 0 3.907-3.627 8.47-10 12.629-6.373-4.159-10-8.722-10-12.629 0-3.484 2.369-5.005 4.577-5.005 3.923 0 5.145 5.126 5.423 6.231zm-12-1.226c0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-7.962-9.648-9.028-12-3.737-2.338-5.262-12-4.27-12 3.737z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="cam" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16 18c0 1.104-.896 2-2 2h-12c-1.105 0-2-.896-2-2v-12c0-1.104.895-2 2-2h12c1.104 0 2 .896 2 2v12zm8-14l-6 6.223v3.554l6 6.223v-16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="cam-muted" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0.7,19.5L15.5,4.7C15.1,4.3,14.6,4,14,4H2C0.9,4,0,4.9,0,6v12C0,18.6,0.3,19.1,0.7,19.5z"></path>\n\t\t\t\t<path d="M18 13.8L24 20 24 4 18 10.2z"></path>\n\t\t\t\t<path d="M7.8,20H14c1.1,0,2-0.9,2-2v-6.2L7.8,20z"></path>\n\t\t\t\t<path d="M-3.4 11.2H27.400000000000002V12.7H-3.4z" transform="rotate(-45.001 12 12)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="mic" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16 11c0 2.209-1.791 4-4 4s-4-1.791-4-4v-7c0-2.209 1.791-4 4-4s4 1.791 4 4v7zm4-2v2c0 4.418-3.582 8-8 8s-8-3.582-8-8v-2h2v2c0 3.309 2.691 6 6 6s6-2.691 6-6v-2h2zm-7 13v-2h-2v2h-4v2h10v-2h-4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="mic-muted" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16,11.4L12.4,15C14.3,14.8,15.8,13.3,16,11.4z"></path>\n\t\t\t\t<path d="M16,4.6V4c0-2.2-1.8-4-4-4S8,1.8,8,4v7c0,0.5,0.1,0.9,0.3,1.4L16,4.6z"></path>\n\t\t\t\t<path d="M13 20L11 20 11 22 7 22 7 24 17 24 17 22 13 22z"></path>\n\t\t\t\t<path d="M18,11c0,3.3-2.7,6-6,6c-0.5,0-1-0.1-1.4-0.2L9,18.4c0.9,0.4,2,0.6,3,0.6c4.4,0,8-3.6,8-8V9h-2V11z"></path>\n\t\t\t\t<path d="M6.7,13.9C6.3,13,6,12,6,11V9H4v2c0,1.6,0.5,3.1,1.3,4.3L6.7,13.9z"></path>\n\t\t\t\t<path d="M-3.4 11.2H27.400000000000002V12.7H-3.4z" transform="rotate(-45.001 12 12)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="gamepad" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17.622 3c-1.913 0-2.558 1.382-5.623 1.382-3.009 0-3.746-1.382-5.623-1.382-5.209 0-6.376 10.375-6.376 14.348 0 2.145.817 3.652 2.469 3.652 3.458 0 2.926-5 6.915-5h5.23c3.989 0 3.457 5 6.915 5 1.652 0 2.471-1.506 2.471-3.651 0-3.973-1.169-14.349-6.378-14.349zm-10.622 10c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zm10-6c.552 0 1 .447 1 1 0 .553-.448 1-1 1s-1-.447-1-1c0-.553.448-1 1-1zm-2 4c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm2 2c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm2-2c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm-10.25-1c0 .965-.785 1.75-1.75 1.75s-1.75-.785-1.75-1.75.785-1.75 1.75-1.75 1.75.785 1.75 1.75z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="ar" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 0l-11 6v12.131l11 5.869 11-5.869v-12.066l-11-6.065zm7.91 6.646l-7.905 4.218-7.872-4.294 7.862-4.289 7.915 4.365zm-16.91 1.584l8 4.363v8.607l-8-4.268v-8.702zm10 12.97v-8.6l8-4.269v8.6l-8 4.269zm6.678-5.315c.007.332-.256.605-.588.612-.332.007-.604-.256-.611-.588-.006-.331.256-.605.588-.612.331-.007.605.256.611.588zm-2.71-1.677c-.332.006-.595.28-.588.611.006.332.279.595.611.588s.594-.28.588-.612c-.007-.331-.279-.594-.611-.587zm-2.132-1.095c-.332.007-.595.281-.588.612.006.332.279.594.611.588.332-.007.594-.28.588-.612-.007-.331-.279-.594-.611-.588zm-9.902 2.183c.332.007.594.281.588.612-.007.332-.279.595-.611.588-.332-.006-.595-.28-.588-.612.005-.331.279-.594.611-.588zm1.487-.5c-.006.332.256.605.588.612s.605-.257.611-.588c.007-.332-.256-.605-.588-.611-.332-.008-.604.255-.611.587zm2.132-1.094c-.006.332.256.605.588.612.332.006.605-.256.611-.588.007-.332-.256-.605-.588-.612-.332-.007-.604.256-.611.588zm3.447-5.749c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6zm0-2.225c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6zm0-2.031c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="close" viewBox="0 0 24 24">\n\t\t\t\t<path d="M23 20.168l-8.185-8.187 8.185-8.174-2.832-2.807-8.182 8.179-8.176-8.179-2.81 2.81 8.186 8.196-8.186 8.184 2.81 2.81 8.203-8.192 8.18 8.192z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="vr" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22.3,4.3H1.7C0.8,4.3,0,5.1,0,6v12c0,0.9,0.8,1.7,1.7,1.7h5.6c0.7,0,1.4-0.5,1.6-1.2l1.4-4.2c0.5-1.6,2.7-1.6,3.3,0 l1.4,4.2c0.2,0.7,0.9,1.2,1.6,1.2h5.6c0.9,0,1.7-0.8,1.7-1.7V6C24,5.1,23.2,4.3,22.3,4.3z M6,14.6c-1.4,0-2.6-1.2-2.6-2.6 S4.6,9.4,6,9.4s2.6,1.2,2.6,2.6S7.4,14.6,6,14.6z M18,14.6c-1.4,0-2.6-1.2-2.6-2.6s1.2-2.6,2.6-2.6s2.6,1.2,2.6,2.6 S19.4,14.6,18,14.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="vr-02" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22.5,8.6c-0.3,0-0.6,0.1-0.8,0.3c-0.3-1.9-1.9-3.4-3.9-3.4H6.2c-2,0-3.6,1.5-3.9,3.4C2,8.7,1.7,8.6,1.4,8.6 C0.6,8.6,0,9.3,0,10.1v3.9c0,0.8,0.6,1.4,1.4,1.4c0.3,0,0.6-0.1,0.8-0.3c0.3,1.9,1.9,3.4,3.9,3.4h11.6c2,0,3.6-1.5,3.9-3.4 c0.2,0.2,0.5,0.3,0.8,0.3c0.8,0,1.4-0.6,1.4-1.4v-3.9C24,9.3,23.3,8.6,22.5,8.6z M20.7,14.6c0,1.6-1.3,2.8-2.8,2.8H6.2 c-1.6,0-2.8-1.3-2.8-2.8V9.4c0-1.6,1.3-2.8,2.8-2.8h11.6c1.6,0,2.8,1.3,2.8,2.8V14.6z"></path><circle cx="5.7" cy="8.7" r=".8"></circle><circle cx="18.3" cy="8.6" r=".8"></circle><circle cx="5.7" cy="15.4" r=".8"></circle><circle cx="18.3" cy="15.3" r=".8"></circle>\n\t\t\t</symbol>\n\t\t\t<symbol id="the-spy" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17,14c-1.8,0-3.3,1.3-3.7,3h-2.5c-0.5-2.1-2.5-3.4-4.6-2.9c-2.1,0.5-3.4,2.5-2.9,4.6s2.5,3.4,4.6,2.9 c1.4-0.3,2.6-1.5,2.9-2.9h2.5c0.5,2.1,2.5,3.4,4.6,2.9s3.4-2.5,2.9-4.6C20.4,15.3,18.8,14,17,14z"></path>\n\t\t\t\t<path d="M23.2,11.5h-2.6V6c0-0.7-0.5-1.4-1.2-1.6l-5.5-1.8c-1.2-0.4-2.6-0.4-3.8,0L4.6,4.4C3.9,4.6,3.4,5.3,3.4,6v5.4H0.8 c-0.5,0-0.8,0.4-0.8,0.8s0.4,0.8,0.8,0.8h22.3c0.5,0,0.8-0.4,0.8-0.8S23.6,11.5,23.2,11.5z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spy-eye" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,19.6c-4.6,0-8.9-3.5-11.7-6.8c-0.4-0.5-0.4-1.2,0-1.6C3.1,7.9,7.4,4.4,12,4.4s8.9,3.5,11.7,6.8 c0.4,0.5,0.4,1.2,0,1.6C20.9,16.1,16.6,19.6,12,19.6z M12,7.5c2.5,0,4.4,1.9,4.4,4.4s-1.9,4.4-4.4,4.4s-4.4-1.9-4.4-4.4 S9.5,7.5,12,7.5z" clip-rule="evenodd"></path>\n\t\t\t\t<path d="M12,9.3c1.4,0,2.6,1.2,2.6,2.6s-1.2,2.6-2.6,2.6s-2.6-1.2-2.6-2.6S10.6,9.3,12,9.3z" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="copy" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7 16h10v1h-10v-1zm0-1h10v-1h-10v1zm15-13v22h-20v-22h3c1.229 0 2.18-1.084 3-2h8c.82.916 1.771 2 3 2h3zm-11 1c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm9 1h-4l-2 2h-3.898l-2.102-2h-4v18h16v-18zm-13 9h10v-1h-10v1zm0-2h10v-1h-10v1z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="menu" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 18c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="menu-light" viewBox="0 0 24 24">\n\t\t\t\t<path d="M14 19h-14v-1h14v1zm9.247-8.609l-3.247 4.049-3.263-4.062-.737.622 4 5 4-5-.753-.609zm-9.247 2.609h-14v-1h14v1zm0-6h-14v-1h14v1z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="settings" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 14.187v-4.374c-2.148-.766-2.726-.802-3.027-1.529-.303-.729.083-1.169 1.059-3.223l-3.093-3.093c-2.026.963-2.488 1.364-3.224 1.059-.727-.302-.768-.889-1.527-3.027h-4.375c-.764 2.144-.8 2.725-1.529 3.027-.752.313-1.203-.1-3.223-1.059l-3.093 3.093c.977 2.055 1.362 2.493 1.059 3.224-.302.727-.881.764-3.027 1.528v4.375c2.139.76 2.725.8 3.027 1.528.304.734-.081 1.167-1.059 3.223l3.093 3.093c1.999-.95 2.47-1.373 3.223-1.059.728.302.764.88 1.529 3.027h4.374c.758-2.131.799-2.723 1.537-3.031.745-.308 1.186.099 3.215 1.062l3.093-3.093c-.975-2.05-1.362-2.492-1.059-3.223.3-.726.88-.763 3.027-1.528zm-4.875.764c-.577 1.394-.068 2.458.488 3.578l-1.084 1.084c-1.093-.543-2.161-1.076-3.573-.49-1.396.581-1.79 1.693-2.188 2.877h-1.534c-.398-1.185-.791-2.297-2.183-2.875-1.419-.588-2.507-.045-3.579.488l-1.083-1.084c.557-1.118 1.066-2.18.487-3.58-.579-1.391-1.691-1.784-2.876-2.182v-1.533c1.185-.398 2.297-.791 2.875-2.184.578-1.394.068-2.459-.488-3.579l1.084-1.084c1.082.538 2.162 1.077 3.58.488 1.392-.577 1.785-1.69 2.183-2.875h1.534c.398 1.185.792 2.297 2.184 2.875 1.419.588 2.506.045 3.579-.488l1.084 1.084c-.556 1.121-1.065 2.187-.488 3.58.577 1.391 1.689 1.784 2.875 2.183v1.534c-1.188.398-2.302.791-2.877 2.183zm-7.125-5.951c1.654 0 3 1.346 3 3s-1.346 3-3 3-3-1.346-3-3 1.346-3 3-3zm0-2c-2.762 0-5 2.238-5 5s2.238 5 5 5 5-2.238 5-5-2.238-5-5-5z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="settings-full" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="emoji" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,2c5.5,0,10,4.5,10,10s-4.5,10-10,10S2,17.5,2,12S6.5,2,12,2z M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12 S18.6,0,12,0z M18,14H6c0.3,1.5,2.8,4,6,4C15.1,18,17.7,15.5,18,14z M8.5,8C7.7,8,7,8.7,7,9.5S7.7,11,8.5,11S10,10.3,10,9.5 S9.3,8,8.5,8z M15.5,8C14.7,8,14,8.7,14,9.5s0.7,1.5,1.5,1.5c0.8,0,1.5-0.7,1.5-1.5S16.3,8,15.5,8z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="pencil" viewBox="0 0 24 24">\n\t\t\t\t<path d="M19.769 9.923l-12.642 12.639-7.127 1.438 1.438-7.128 12.641-12.64 5.69 5.691zm1.414-1.414l2.817-2.82-5.691-5.689-2.816 2.817 5.69 5.692z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="erase" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5.662 23l-5.369-5.365c-.195-.195-.293-.45-.293-.707 0-.256.098-.512.293-.707l14.929-14.928c.195-.194.451-.293.707-.293.255 0 .512.099.707.293l7.071 7.073c.196.195.293.451.293.708 0 .256-.097.511-.293.707l-11.216 11.219h5.514v2h-12.343zm3.657-2l-5.486-5.486-1.419 1.414 4.076 4.072h2.829zm.456-11.429l-4.528 4.528 5.658 5.659 4.527-4.53-5.657-5.657z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="move" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 10c1.104 0 2 .896 2 2s-.896 2-2 2-2-.896-2-2 .896-2 2-2zm-3.857 3c-.084-.321-.143-.652-.143-1s.059-.679.143-1h-2.143v-4l-6 5 6 5v-4h2.143zm7.714-2c.084.321.143.652.143 1s-.059.679-.143 1h2.143v4l6-5-6-5v4h-2.143zm-2.857 4.857c-.321.084-.652.143-1 .143s-.679-.059-1-.143v2.143h-4l5 6 5-6h-4v-2.143zm-2-7.714c.321-.084.652-.143 1-.143s.679.059 1 .143v-2.143h4l-5-6-5 6h4v2.143z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="caret-down" viewBox="0 0 8 5">\n\t\t\t\t<path d="M0 0h8L4 5 0 0z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="caret-right" viewBox="0 0 8 12">\n\t\t\t\t<path d="M0 12V0l8 6-8 6z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="websolute" viewBox="0 0 20 20">\n\t\t\t\t<path d="M20 10c0 5.5-4.5 10-10 10S0 15.5 0 10 4.5 0 10 0s10 4.5 10 10m-10 2.3c.5.5 1.3.8 2.1.8s1.5-.3 2.1-.8c.5-.5.8-1.2.8-2V7.5h-1.7v2.8c0 .3-.1.6-.4.8-.1.1-.3.2-.4.3-.2.1-.3.1-.5.1s-.3 0-.5-.1c-.1-.1-.3-.2-.4-.3-.2-.2-.4-.5-.4-.8V7.6H9.2v2.8c0 .3-.1.6-.4.9-.2.2-.5.4-.8.4-.3 0-.7-.1-.9-.3-.2-.2-.4-.5-.3-.8V7.5H5v2.8c0 .7.3 1.5.8 2 .6.5 1.3.8 2.1.8.8.1 1.6-.2 2.1-.8z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="search" viewBox="0 0 21 23">\n\t\t\t\t<path d="M20.6 20.3l-4.9-5.2c1.2-1.7 1.8-3.7 1.8-5.7 0-5.2-3.9-9.4-8.7-9.4S0 4.2 0 9.4s3.7 7.8 6.3 8.4c1.8.4 3.9.6 7.1-.7l5.1 5.4c.5.6 1.4.6 2 .1l.1-.1c.5-.6.5-1.6 0-2.2zM15 9.4c-.2 3.5-3.2 6.1-6.7 5.8S2.2 12 2.5 8.5c.2-3.3 3-5.8 6.3-5.8 3.5.1 6.3 3.1 6.2 6.7z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="result-indicator" viewBox="0 0 24 24">\n\t\t\t\t<path d="M11 21.883l-6.235-7.527-.765.644 7.521 9 7.479-9-.764-.645-6.236 7.529v-21.884h-1v21.883z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="bullet" viewBox="0 0 18 18">\n\t\t\t\t<path d="M9 2c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7m0-2C4 0 0 4 0 9s4 9 9 9 9-4 9-9-4-9-9-9z" opacity=".15" fill="#17265a"></path>\n\t\t\t\t<circle cx="9" cy="9" r="4" fill="#17265a"></circle>\n\t\t\t</symbol>\n\t\t\t<symbol id="play" viewBox="0 0 16 20">\n\t\t\t\t<path d="M0,0v19.8l15.4-11L0,0z" fill-rule="evenodd" clip-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="play-progress" viewBox="0 0 196 196">\n\t\t\t\t<path d="M195.5,98c0,53.8-43.7,97.5-97.5,97.5S0.5,151.8,0.5,98S44.2,0.5,98,0.5S195.5,44.2,195.5,98z" stroke-width="2px" stroke-linecap="square" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="pause" viewBox="0 0 16 20">\n\t\t\t\t<path d="M0 0.9H4V18.9H0z"></path>\n\t\t\t\t<path d="M11.4 0.9H15.4V18.9H11.4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist-add" viewBox="0 0 25 20">\n\t\t\t\t<path d="M12.5,20.8c-0.3,0-0.5-0.1-0.8-0.3c-0.3-0.2-0.6-0.4-0.9-0.6c-0.7-0.5-1.4-0.9-2.1-1.5 c-1.1-0.8-2.1-1.6-3.1-2.4C4.2,15,3,13.8,1.9,12.4c-0.9-1.1-1.4-2.3-1.7-3.7C0.1,8.5,0.1,8.2,0,7.9l0-0.2l0.1-1.4 c0-0.1,0.1-0.3,0.1-0.4c0.1-0.3,0.1-0.7,0.3-1c0.6-1.7,1.8-3.2,3.4-4c1.5-0.8,3.3-1.1,5-0.8c1.4,0.2,2.6,0.8,3.7,1.7 c2.9-2.4,7.2-2.4,10,0.1c1.1,0.9,1.9,2.2,2.2,3.5c0.1,0.3,0.1,0.6,0.2,0.8L25,6.7l-0.1,1.4c-0.2,1.2-0.6,2.4-1.2,3.4 c-0.5,0.8-1.1,1.6-1.8,2.3c-0.8,0.9-1.7,1.7-2.6,2.5c-0.7,0.6-1.6,1.3-2.6,2c-0.8,0.5-1.5,1.1-2.3,1.6c-0.4,0.3-0.8,0.5-1.2,0.8 C13.1,20.8,12.8,20.8,12.5,20.8z M2.1,7.6c0,0.2,0.1,0.4,0.1,0.6c0.2,1.1,0.7,2,1.4,2.9c1,1.2,2.1,2.3,3.3,3.3c1,0.8,2,1.6,3,2.4 c0.7,0.5,1.4,0.9,2.1,1.4l0.5,0.3c0.2-0.2,0.5-0.3,0.7-0.5c0.8-0.5,1.5-1,2.3-1.6c0.9-0.7,1.8-1.4,2.5-1.9c0.9-0.7,1.7-1.5,2.4-2.3 c0.6-0.6,1.1-1.2,1.5-1.9c0.5-0.8,0.8-1.7,0.9-2.6c0-0.1,0-0.1,0-0.2l0-0.9c0-0.2-0.1-0.4-0.1-0.6c-0.3-1-0.8-1.9-1.6-2.5 c-2.1-1.8-5.2-1.8-7.3,0c-0.1,0.1-0.3,0.2-0.4,0.4l-0.9,1.2l-1-1.3c-0.8-0.8-1.9-1.4-3-1.6C7.2,2,5.9,2.2,4.9,2.8 c-1.1,0.6-2,1.6-2.4,2.8C2.4,5.9,2.3,6.1,2.3,6.4c0,0.1-0.1,0.3-0.1,0.4l0,0L2.1,7.6L2.1,7.6z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist-added" viewBox="0 0 25 20">\n\t\t\t\t<path d="M12.5,20.8c-0.3,0-0.5-0.1-0.8-0.3c-0.3-0.2-0.6-0.4-0.9-0.6c-0.7-0.5-1.4-0.9-2.1-1.5 c-1.1-0.8-2.1-1.6-3.1-2.4c-1.4-1-2.6-2.2-3.7-3.6C1,11.3,0.5,10.1,0.2,8.7C0.1,8.5,0.1,8.2,0,7.9V7.7l0.1-1.4 c0-0.1,0.1-0.3,0.1-0.4c0.1-0.3,0.1-0.7,0.3-1c0.6-1.7,1.8-3.2,3.4-4c1.5-0.8,3.3-1.1,5-0.8c1.4,0.2,2.6,0.8,3.7,1.7 c2.9-2.4,7.2-2.4,10,0.1c1.1,0.9,1.9,2.2,2.2,3.5C24.9,5.7,24.9,6,25,6.2v0.5l-0.1,1.4c-0.2,1.2-0.6,2.4-1.2,3.4 c-0.5,0.8-1.1,1.6-1.8,2.3c-0.8,0.9-1.7,1.7-2.6,2.5c-0.7,0.6-1.6,1.3-2.6,2c-0.8,0.5-1.5,1.1-2.3,1.6c-0.4,0.3-0.8,0.5-1.2,0.8 C13.1,20.8,12.8,20.8,12.5,20.8z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist" viewBox="0 0 16 14">\n\t\t\t\t<path d="M8,14c-0.2,0-0.3-0.1-0.5-0.2l-0.6-0.4c-0.5-0.3-0.9-0.6-1.4-1c-0.7-0.5-1.4-1.1-2-1.6 c-0.9-0.7-1.6-1.6-2.3-2.5C0.7,7.6,0.3,6.8,0.1,5.9c0-0.2-0.1-0.4-0.1-0.5l0-0.1l0-1c0-0.1,0-0.2,0.1-0.3c0.1-0.2,0.1-0.4,0.2-0.7 c0.4-1.1,1.2-2.1,2.2-2.7c1.8-1,4-0.8,5.5,0.6c1.8-1.6,4.6-1.6,6.4,0.1c0.7,0.6,1.2,1.5,1.4,2.4C15.9,3.8,15.9,4,16,4.2l0,0.3l0,0.9 c-0.1,0.8-0.4,1.6-0.8,2.3c-0.3,0.5-0.7,1-1.1,1.5c-0.5,0.6-1.1,1.1-1.7,1.7c-0.4,0.4-1,0.9-1.7,1.3c-0.5,0.4-1,0.7-1.5,1.1 c-0.2,0.2-0.5,0.3-0.7,0.5C8.4,13.9,8.2,14,8,14z M1.4,5.1c0,0.1,0.1,0.3,0.1,0.4c0.1,0.7,0.4,1.4,0.9,1.9C2.9,8.3,3.6,9,4.4,9.7 c0.6,0.5,1.3,1.1,1.9,1.6c0.4,0.3,0.9,0.6,1.3,0.9c0.1,0.1,0.2,0.2,0.3,0.2c0.2-0.1,0.3-0.2,0.5-0.3c0.5-0.3,1-0.7,1.5-1 c0.6-0.4,1.2-0.9,1.6-1.3c0.5-0.5,1.1-1,1.5-1.5c0.4-0.4,0.7-0.8,1-1.3c0.3-0.5,0.5-1.1,0.6-1.7c0,0,0-0.1,0-0.1l0-0.6 c0-0.1,0-0.3-0.1-0.4c-0.2-0.7-0.5-1.2-1-1.7c-1.3-1.2-3.4-1.2-4.7,0C8.7,2.4,8.6,2.5,8.5,2.6L8,3.4L7.3,2.5 C6.3,1.4,4.5,1.1,3.1,1.9C2.4,2.3,1.8,3,1.6,3.8C1.5,3.9,1.5,4.1,1.4,4.3L1.4,4.6l0,0L1.4,5.1L1.4,5.1z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="expand" viewBox="0 0 29 30">\n\t\t\t\t<path d="M26 16.3V5.9L2.2 29.7.1 27.6 24 3.3H13v-3h16v16h-3z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="download" viewBox="0 0 9 13">\n\t\t\t\t<path d="M8.5 7.9c-.3-.4-.8-.4-1.2-.1l-.1.1-2 2V1.2c0-.2-.1-.4-.2-.6-.2-.3-.7-.3-1 0-.2.2-.3.4-.3.6v8.6l-2-2c-.2-.1-.4-.2-.7-.2-.2 0-.4.1-.6.3-.1.2-.1.4-.1.6 0 .2.1.4.2.5l3.4 3.4c.2.2.4.2.6.2.2 0 .4-.1.6-.2L8.4 9c.2-.1.2-.3.3-.6 0-.1-.1-.4-.2-.5z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="upload" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10 9H4l8-9 8 9h-6v11h-4V9zm11 11v2H3v-2H1v4h22v-4h-2z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="user" viewBox="0 0 24 24">\n\t\t\t\t<path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418C20.452 4.766 16.983 0 12 0 6.918 0 3.536 4.949 8.268 13.678c1.597 2.945-1.725 3.641-5.09 4.418C.105 18.806-.01 20.332 0 23l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="back" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2.117 12l7.527 6.235L9 19l-9-7.521L9 4l.645.764L2.116 11H24v1H2.117z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="add" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="remove" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 10h24v4h-24z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="link" viewBox="0 0 24 24">\n\t\t\t\t<path d="M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="up" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7 11h-6l11-11 11 11h-6v13h-10z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="down" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17,13h6L12,24L1,13h6V0h10V13z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="waiting-room" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2,6c0-2.2,1.8-4,4-4h12c2.2,0,4,1.8,4,4v12c0,2.2-1.8,4-4,4H6c-2.2,0-4-1.8-4-4V6z" opacity=".2"></path>\n\t\t\t\t<path d="M17.8,10.7c0.7,0,1.3,0.6,1.3,1.3s-0.6,1.3-1.3,1.3H6.2c-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3H17.8z M19.7,12 c0-1.1-0.9-1.9-1.9-1.9H6.2c-1.1,0-1.9,0.9-1.9,1.9s0.9,1.9,1.9,1.9h11.6C18.9,13.9,19.7,13.1,19.7,12z M13.9,11.4H6.2 c-0.4,0-0.6,0.3-0.6,0.6s0.3,0.6,0.6,0.6h7.7c0.4,0,0.6-0.3,0.6-0.6S14.3,11.4,13.9,11.4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="panorama" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 9 15 C 9 14.448 9.448 14 10 14 L 14 14 C 14.552 14 15 14.448 15 15 L 15 16 C 15 16.552 14.552 17 14 17 L 10 17 C 9.448 17 9 16.552 9 16 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 7 8 C 7 7.448 7.448 7 8 7 L 16 7 C 16.552 7 17 7.448 17 8 L 17 12 C 17 12.552 16.552 13 16 13 L 8 13 C 7.448 13 7 12.552 7 12 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="panorama-grid" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 10.333 7.333 C 10.886 7.333 11.333 7.781 11.333 8.333 L 11.333 10.333 C 11.333 10.886 10.886 11.333 10.333 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 12.333 8.333 C 12.333 7.781 12.781 7.333 13.333 7.333 L 15.333 7.333 C 15.886 7.333 16.333 7.781 16.333 8.333 L 16.333 10.333 C 16.333 10.886 15.886 11.333 15.333 11.333 L 13.333 11.333 C 12.781 11.333 12.333 10.886 12.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 10.333 12.667 C 10.886 12.667 11.333 13.114 11.333 13.667 L 11.333 15.667 C 11.333 16.219 10.886 16.667 10.333 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t\t<path d="M 12.333 13.667 C 12.333 13.114 12.781 12.667 13.333 12.667 L 15.333 12.667 C 15.886 12.667 16.333 13.114 16.333 13.667 L 16.333 15.667 C 16.333 16.219 15.886 16.667 15.333 16.667 L 13.333 16.667 C 12.781 16.667 12.333 16.219 12.333 15.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="room-3d" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 6.6 9.056 C 6.6 8.533 6.905 8.059 7.381 7.842 L 8.995 7.108 C 9.436 6.907 9.938 7.23 9.938 7.715 L 9.938 16.272 C 9.938 16.757 9.436 17.08 8.995 16.879 L 7.381 16.145 C 6.905 15.928 6.6 15.454 6.6 14.931 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 10.754 7.453 C 10.754 6.795 11.378 6.316 12.014 6.487 L 16.32 7.647 C 17.193 7.882 17.8 8.674 17.8 9.578 L 17.8 14.105 C 17.8 15.009 17.193 15.801 16.32 16.036 L 12.014 17.196 C 11.378 17.367 10.754 16.889 10.754 16.231 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="model" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M 11.298 7.283 C 11.602 6.729 12.398 6.729 12.702 7.283 L 14.009 9.673 C 14.082 9.807 14.193 9.918 14.327 9.991 L 16.717 11.298 C 17.271 11.602 17.271 12.398 16.717 12.702 L 14.327 14.009 C 14.193 14.082 14.082 14.193 14.009 14.327 L 12.702 16.717 C 12.398 17.271 11.602 17.271 11.298 16.717 L 9.991 14.327 C 9.918 14.193 9.807 14.082 9.673 14.009 L 7.283 12.702 C 6.729 12.398 6.729 11.602 7.283 11.298 L 9.673 9.991 C 9.807 9.918 9.918 9.807 9.991 9.673 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="media" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2,6c0-2.2,1.8-4,4-4h12c2.2,0,4,1.8,4,4v12c0,2.2-1.8,4-4,4H6c-2.2,0-4-1.8-4-4V6z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M12,19c-2.2,0-4.3-1-5.6-2.7L7,15.9c1.2,1.5,3,2.4,5,2.4c1.9,0,3.8-0.9,5-2.4l0.6,0.4C16.3,18,14.2,19,12,19z M5.5,14.7C5.2,13.8,5,12.8,5,12c0-3.5,2.7-6.5,6.2-7v0.6C8,6.1,5.7,8.8,5.7,12c0,0.8,0.1,1.5,0.4,2.4L5.5,14.7z M18,14.4 c0.3-0.8,0.4-1.6,0.4-2.4c0-3.2-2.3-5.9-5.5-6.4c0-0.2,0-0.5,0-0.6c3.5,0.4,6.2,3.4,6.2,7c0,0.8-0.2,1.8-0.5,2.7L18,14.4z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M10.2,15V8.9l5.5,3.1L10.2,15z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="nav" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 6.5 8.667 C 6.5 8.114 6.948 7.667 7.5 7.667 L 16.5 7.667 C 17.052 7.667 17.5 8.114 17.5 8.667 L 17.5 14.495 C 17.5 15.046 17.053 15.494 16.502 15.495 L 14.189 15.499 C 13.959 15.5 13.736 15.58 13.558 15.725 L 12.211 16.827 C 12.088 16.928 11.912 16.928 11.789 16.827 L 10.442 15.725 C 10.264 15.58 10.041 15.5 9.811 15.499 L 7.498 15.495 C 6.947 15.494 6.5 15.046 6.5 14.495 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="plane" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(4.667 11.5) rotate(-90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(17.333 11.5) rotate(90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 8 9 C 8 8.448 8.448 8 9 8 L 15 8 C 15.552 8 16 8.448 16 9 L 16 15 C 16 15.552 15.552 16 15 16 L 9 16 C 8.448 16 8 15.552 8 15 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="curved-plane" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(4.667 11.5) rotate(-90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(17.333 11.5) rotate(90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 8 9 C 8 8.448 8.448 8 9 8 L 15 8 C 15.552 8 16 8.448 16 9 L 16 15 C 16 15.552 15.552 16 15 16 L 9 16 C 8.448 16 8 15.552 8 15 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="texture" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 7.333 8.95 C 7.333 8.274 7.839 7.705 8.511 7.626 L 14.805 6.886 C 15.796 6.769 16.667 7.543 16.667 8.541 L 16.667 15.49 C 16.667 16.477 15.814 17.247 14.833 17.148 L 8.533 16.513 C 7.852 16.444 7.333 15.871 7.333 15.187 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="gltf" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M 11.298 7.283 C 11.602 6.729 12.398 6.729 12.702 7.283 L 14.009 9.673 C 14.082 9.807 14.193 9.918 14.327 9.991 L 16.717 11.298 C 17.271 11.602 17.271 12.398 16.717 12.702 L 14.327 14.009 C 14.193 14.082 14.082 14.193 14.009 14.327 L 12.702 16.717 C 12.398 17.271 11.602 17.271 11.298 16.717 L 9.991 14.327 C 9.918 14.193 9.807 14.082 9.673 14.009 L 7.283 12.702 C 6.729 12.398 6.729 11.602 7.283 11.298 L 9.673 9.991 C 9.807 9.918 9.918 9.807 9.991 9.673 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="tile" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 15.667 13 C 17.139 13 18.333 14.194 18.333 15.667 C 18.333 17.139 17.139 18.333 15.667 18.333 C 14.194 18.333 13 17.139 13 15.667 C 13 14.194 14.194 13 15.667 13 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="image" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 8.5c0-.828.672-1.5 1.5-1.5s1.5.672 1.5 1.5c0 .829-.672 1.5-1.5 1.5s-1.5-.671-1.5-1.5zm9 .5l-2.519 4-2.481-1.96-4 5.96h14l-5-8zm8-4v14h-20v-14h20zm2-2h-24v18h24v-18z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="video" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2.184 7.874l-2.184-.918 2.967-2.956.933 2.164-1.716 1.71zm21.816 2.126l-3 2v4l3 2v-8zm-7-2h-7.018l.79.787c.356.355.629.769.831 1.213h4.897c.276 0 .5.224.5.5v7c0 .276-.224.5-.5.5h-11c-.276 0-.5-.224-.5-.5v-2.909l-.018-.014-1.982-1.975v5.398c0 1.104.896 2 2 2h12c1.104 0 2-.896 2-2v-8c0-1.104-.896-2-2-2zm-14.65 1.13l2.967-2.956 4.044 4.029c.819.816.819 2.14 0 2.956-.819.816-2.147.815-2.967 0l-4.044-4.029z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="stream" viewBox="0 0 24 24">\n\t\t\t\t<path d="M6.613 18.581m9.387-9.581c0 2.209-1.791 4-4 4s-4-1.791-4-4 1.791-4 4-4 4 1.791 4 4zm-2 0c0-1.103-.896-2-2-2s-2 .897-2 2 .896 2 2 2 2-.897 2-2zm-9 0c0 3.86 3.141 7 7 7s7-3.14 7-7-3.141-7-7-7-7 3.14-7 7zm16 0c0 4.97-4.029 9-9 9s-9-4.03-9-9 4.029-9 9-9 9 4.03 9 9zm-.404 12.501c1.007 1.142-.014 2.679-1.448 2.481-1.795-.245-3.236-1.702-7.147-1.702-3.91 0-5.352 1.458-7.146 1.702-1.436.198-2.456-1.34-1.449-2.481l2.898-3.289c.559.388 1.156.725 1.79.994l-2.025 2.298c1.295-.524 3.065-1.225 5.933-1.225s4.638.7 5.933 1.224l-2.025-2.298c.634-.27 1.231-.606 1.79-.994l2.896 3.29z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spinner" viewBox="0 0 24 24">\n\t\t\t\t<path d="M8.175 7.377l-3.042-5.27 1.732-1 3.045 5.273c-.635.238-1.222.573-1.735.997zm-.799.8l-5.27-3.042-1 1.732 5.274 3.045c.237-.635.572-1.223.996-1.735zm-1.376 3.823c0-.341.035-.673.09-.999h-6.09v1.999h6.09c-.055-.326-.09-.659-.09-1zm11.351-2.705l5.208-3.007-.333-.577-5.206 3.007c.121.185.23.379.331.577zm-5.351-3.295c.341 0 .673.035.999.09v-6.09h-1.999v6.09c.326-.055.659-.09 1-.09zm3.14.894l3.004-5.204-.288-.166-3 5.197.284.173zm1.685 8.662l5.234 3.022.666-1.154-5.229-3.019c-.181.41-.408.794-.671 1.151zm-10.444-1.467l-5.274 3.046 1 1.732 5.27-3.042c-.424-.513-.759-1.1-.996-1.736zm11.594-2.589l.025.5-.025.5h6.025v-1h-6.025zm-3.727 6.061l3.03 5.249 1.442-.833-3.031-5.25c-.437.34-.92.623-1.441.834zm-2.248.439c-.341 0-.674-.035-1-.09v6.09h1.999v-6.09c-.326.055-.658.09-.999.09zm-3.824-1.376l-3.042 5.27 1.732 1 3.045-5.274c-.635-.237-1.222-.572-1.735-.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="update" viewBox="0 0 24 24">\n\t\t\t\t<path d="M23 12c0 1.042-.154 2.045-.425 3h-2.101c.335-.94.526-1.947.526-3 0-4.962-4.037-9-9-9-1.706 0-3.296.484-4.655 1.314l1.858 2.686h-6.994l2.152-7 1.849 2.673c1.684-1.049 3.659-1.673 5.79-1.673 6.074 0 11 4.925 11 11zm-6.354 7.692c-1.357.826-2.944 1.308-4.646 1.308-4.962 0-9-4.038-9-9 0-1.053.191-2.06.525-3h-2.1c-.271.955-.425 1.958-.425 3 0 6.075 4.925 11 11 11 2.127 0 4.099-.621 5.78-1.667l1.853 2.667 2.152-6.989h-6.994l1.855 2.681z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="edit" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 1h24v2h-24v-2zm11 7h13v-2h-13v2zm0 5h13v-2h-13v2zm0 5h13v-2h-13v2zm-11 5h24v-2h-24v2zm8-17l-8 6 8 6v-12z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="lock" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4h-3v14h18v-14h-3zm-10 0v-4c0-2.206 1.794-4 4-4s4 1.794 4 4v4h-8z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="volume-off" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm15.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="volume-on" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm11.008 2.093c.742.743 1.2 1.77 1.198 2.903-.002 1.133-.462 2.158-1.205 2.9l1.219 1.223c1.057-1.053 1.712-2.511 1.715-4.121.002-1.611-.648-3.068-1.702-4.125l-1.225 1.22zm2.142-2.135c1.288 1.292 2.082 3.073 2.079 5.041s-.804 3.75-2.096 5.039l1.25 1.254c1.612-1.608 2.613-3.834 2.616-6.291.005-2.457-.986-4.681-2.595-6.293l-1.254 1.25z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="fullscreen-off" viewBox="0 0 24 24">\n\t\t\t\t<path d="M15 2h2v5h7v2h-9v-7zm9 13v2h-7v5h-2v-7h9zm-15 7h-2v-5h-7v-2h9v7zm-9-13v-2h7v-5h2v7h-9z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="fullscreen-on" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 9h-2v-7h-7v-2h9v9zm-9 15v-2h7v-7h2v9h-9zm-15-9h2v7h7v2h-9v-9zm9-15v2h-7v7h-2v-9h9z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="navmap" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 22.586l-2.823-2.823c.526-.792.836-1.74.836-2.763 0-2.762-2.238-5-5-5s-5 2.238-5 5 2.238 5 5 5c1.016 0 1.957-.307 2.746-.827l2.827 2.827 1.414-1.414zm-9.987-5.586c0-1.654 1.346-3 3-3s3 1.346 3 3-1.346 3-3 3-3-1.346-3-3zm-4 0l.002-.034-3.015 2.175v-13.068l4-2.886v10.247c.508-.854 1.189-1.591 2-2.161v-8.086l4 2.886v3.927h.013c.336 0 .664.032.987.078v-4.007l4-2.479v8.504c1.188 1.208 1.936 2.844 2 4.653v-16.749l-6.455 4-5.545-4-5.545 4-6.455-4v18l6.455 4 3.91-2.82c-.226-.687-.352-1.419-.352-2.18zm-4.013 2.365l-4-2.479v-13.294l4 2.479v13.294z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="screen" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 0v19h24v-19h-24zm22 14h-20v-12h20v12zm-6.599 7l2.599 3h-12l2.599-3h6.802z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="chat" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22 3v13h-11.643l-4.357 3.105v-3.105h-4v-13h20zm2-2h-24v16.981h4v5.019l7-5.019h13v-16.981z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="send" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22 12l-20 12 5-12-5-12z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="users" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10.644 17.08c2.866-.662 4.539-1.241 3.246-3.682-3.932-7.427-1.042-11.398 3.111-11.398 4.235 0 7.054 4.124 3.11 11.398-1.332 2.455.437 3.034 3.242 3.682 2.483.574 2.647 1.787 2.647 3.889v1.031h-18c0-2.745-.22-4.258 2.644-4.92zm-12.644 4.92h7.809c-.035-8.177 3.436-5.313 3.436-11.127 0-2.511-1.639-3.873-3.748-3.873-3.115 0-5.282 2.979-2.333 8.549.969 1.83-1.031 2.265-3.181 2.761-1.862.43-1.983 1.34-1.983 2.917v.773z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="virtual-tour" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17 17h-10v-10h10v10zm7 3l-5-3v-10l5-3v16zm-24-16l5 3v10l-5 3v-16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="live-meeting" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18 18h6v6h-6v-6zm-9 6h6v-6h-6v6zm-9 0h6v-6h-6v6zm0-8h24v-16h-24v16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="control" viewBox="0 0 24 24">\n\t\t\t\t<circle cx="7" cy="10" r="1"></circle>\n\t\t\t\t<path d="M17,3H7c-3.9,0-7,3.1-7,7v6c0,2.8,2.2,5,5,5c2.4,0,4.4-1.7,4.9-4h4.2c0.5,2.7,3.2,4.5,5.9,3.9c2.3-0.5,4-2.5,4-4.9v-6 C24,6.1,20.9,3,17,3z M17,7c0.6,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1S16.4,7,17,7z M7,13c-1.7,0-3-1.3-3-3s1.3-3,3-3s3,1.3,3,3 S8.7,13,7,13z M15,11c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S15.6,11,15,11z M17,13c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1s1,0.4,1,1 C18,12.5,17.6,13,17,13z M19,11c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S19.6,11,19,11z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spy" viewBox="0 0 24 24">\n\t\t\t\t<path fill-rule="evenodd" d="M0.2,11.4c5.2-8.6,18.3-8.5,23.6,0c0.2,0.3,0.2,0.8,0,1.2c-5.3,8.4-18.4,8.6-23.6,0 C-0.1,12.2-0.1,11.7,0.2,11.4z M12,7.8c2.3,0,4.2,1.9,4.2,4.3s-1.9,4.2-4.2,4.2S7.8,14.3,7.8,12S9.7,7.8,12,7.8z" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="joystick" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10.7,10.5V16H9.3C8.6,16,8,16.6,8,17.3h8c0-0.7-0.6-1.3-1.3-1.3h-1.3v-5.5c2.8-0.7,4.5-3.6,3.8-6.5 c-0.7-2.8-3.6-4.5-6.5-3.8S6.1,3.9,6.9,6.7C7.3,8.6,8.8,10,10.7,10.5z"></path>\n\t\t\t\t<path d="M1.4,18.6h21.2c0.7,0,1.3,0.6,1.3,1.3v2.7c0,0.7-0.6,1.3-1.3,1.3H1.4c-0.7,0-1.3-0.6-1.3-1.3V20 C0.1,19.2,0.7,18.6,1.4,18.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="navinfo" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,2c5.5,0,10,4.5,10,10s-4.5,10-10,10S2,17.5,2,12S6.5,2,12,2z M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12 S18.6,0,12,0z"/>\n\t\t\t\t<path d="M13,18h-2v-8h2V18z M12,5.8c0.7,0,1.2,0.6,1.2,1.2S12.7,8.2,12,8.2S10.8,7.7,10.8,7S11.3,5.8,12,5.8z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="check" viewBox="0 0 24 24">\n\t\t\t\t<path d="M9,21l-9-8.6l2.8-2.9l6.2,5.9L21.2,3L24,5.8L9,21z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="duplicate" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18,6V0H0v18h6v6h18V6H18z M6,16H2V2h14v4H6V16z M22,22H8V8h14V22z M19,14h-3v-3h-2v3h-3v2h3v3h2v-3h3V14z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="trash" viewBox="0 0 24 24">\n\t\t\t\t<path fill-rule="evenodd" d="M19,24H5c-1.1,0-2-0.9-2-2V5H2V3h6V1.5C8,0.7,8.7,0,9.5,0h5C15.3,0,16,0.7,16,1.5V3h6v2h-1v17 C21,23.1,20.1,24,19,24z M19,5H5v16.5C5,21.8,5.2,22,5.5,22h13c0.3,0,0.5-0.2,0.5-0.5V5z M10,9c0-0.6-0.4-1-1-1S8,8.4,8,9v9 c0,0.6,0.4,1,1,1s1-0.4,1-1V9z M16,9c0-0.6-0.4-1-1-1s-1,0.4-1,1v9c0,0.6,0.4,1,1,1s1-0.4,1-1V9z M14,2h-4v1h4V2z" clip-rule="evenodd"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="flags" viewBox="0 0 24 24">\n\t\t\t\t<path d="M19,18c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2S19,16.9,19,18z M5,15c-1.7,0-3,1.3-3,3s1.3,3,3,3h14c1.7,0,3-1.3,3-3 s-1.3-3-3-3H5z M24,18c0,2.8-2.2,5-5,5H5c-2.8,0-5-2.2-5-5s2.2-5,5-5h14C21.8,13,24,15.2,24,18z M7,4C5.9,4,5,4.9,5,6s0.9,2,2,2 s2-0.9,2-2S8.1,4,7,4z M5,3C3.3,3,2,4.3,2,6s1.3,3,3,3h14c1.7,0,3-1.3,3-3s-1.3-3-3-3H5z M24,6c0,2.8-2.2,5-5,5H5c-2.8,0-5-2.2-5-5 s2.2-5,5-5h14C21.8,1,24,3.2,24,6z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="b-here" viewBox="0 0 270 98">\n\t\t\t\t<path d="M61.5,87.9c0-2.7,0.9-5,2.8-6.9c1.9-1.9,4.2-2.8,7-2.8c1.4,0,2.7,0.2,3.9,0.8c1.2,0.5,2.2,1.2,3.2,2 c0.9,0.9,1.6,1.9,2.1,3.1s0.8,2.5,0.8,3.8s-0.2,2.6-0.8,3.8c-0.5,1.2-1.2,2.2-2.1,3.1s-1.9,1.6-3.2,2.1c-1.2,0.5-2.5,0.8-3.9,0.8 s-2.7-0.2-3.9-0.8c-1.2-0.5-2.2-1.2-3.1-2.1s-1.6-1.9-2.1-3.1S61.5,89.2,61.5,87.9z"></path>\n\t\t\t\t<path d="M16,70.2H0.7v-70H16V29c0.6-1.1,1.4-2.1,2.4-3.1s2.2-1.9,3.5-2.6s2.8-1.3,4.2-1.8c1.5-0.4,3-0.6,4.6-0.6 c3.5,0,6.7,0.6,9.6,1.9s5.4,3.1,7.4,5.3c2.1,2.2,3.7,4.9,4.8,8s1.7,6.4,1.7,10.1c0,3.6-0.6,6.9-1.7,10c-1.1,3.1-2.7,5.8-4.8,8 c-2.1,2.2-4.5,4-7.4,5.3s-6.1,2-9.6,2c-1.6,0-3.1-0.2-4.6-0.7c-1.5-0.4-2.9-1-4.2-1.7c-1.3-0.7-2.5-1.5-3.5-2.5s-1.8-2-2.4-3.1 C16,63.5,16,70.2,16,70.2z M27.6,58.5c1.7,0,3.2-0.3,4.6-1c1.4-0.7,2.6-1.5,3.6-2.7c1-1.1,1.8-2.4,2.4-3.9c0.6-1.5,0.8-3.1,0.8-4.8 s-0.3-3.2-0.8-4.7c-0.6-1.5-1.4-2.8-2.4-3.9c-1-1.1-2.2-2-3.6-2.7c-1.4-0.7-2.9-1-4.6-1s-3.3,0.3-4.8,1c-1.4,0.7-2.7,1.6-3.7,2.7 c-1,1.1-1.8,2.4-2.3,3.9c-0.6,1.5-0.8,3-0.8,4.7s0.3,3.2,0.8,4.8s1.3,2.8,2.3,3.9c1,1.1,2.2,2,3.7,2.7 C24.3,58.2,25.9,58.5,27.6,58.5z"></path>\n\t\t\t\t<path d="M64.1,0.2h14.8V29c1.3-2.5,3.3-4.5,6-6s5.9-2.2,9.6-2.2c3.1,0,5.8,0.5,7.9,1.4c2.1,1,3.9,2.3,5.2,4.1 c1.5,1.9,2.6,4,3.1,6.5s0.8,5.4,0.8,8.9v28.5H96.7V45.5c0-3.5-0.6-6.3-1.8-8.5c-1.2-2.2-3.5-3.2-6.7-3.2c-3.1,0-5.5,1.1-7,3.3 s-2.3,5.2-2.3,8.9v24.2H64.1V0.2z"></path>\n\t\t\t\t<path d="M135.9,49.8c0.1,1.5,0.3,2.9,0.7,4.2s1,2.4,1.8,3.4s1.9,1.7,3.2,2.3s3,0.8,5,0.8c2.7,0,4.7-0.5,6-1.6 c1.4-1.1,2.3-2.4,2.9-3.9h15c-0.3,2.3-1.1,4.4-2.4,6.4c-1.2,2-2.9,3.8-4.9,5.2c-2,1.5-4.4,2.7-7.2,3.5c-2.8,0.9-5.9,1.3-9.3,1.3 c-4.2,0-7.9-0.6-11.2-1.8c-3.2-1.2-6-3-8.2-5.2c-2.2-2.3-3.9-5-5-8c-1.1-3.1-1.7-6.5-1.7-10.2c0-3.5,0.5-6.8,1.6-9.9s2.7-5.8,4.9-8 c2.2-2.3,4.8-4.1,8-5.5c3.2-1.3,6.8-2,11-2c3.8,0,7.2,0.6,10.2,1.8c3,1.2,5.6,2.8,7.8,4.8s3.8,4.3,5,7s1.8,5.5,1.8,8.4 c0,1,0,2.1,0,3.2c0,1.1-0.2,2.4-0.5,3.9h-34.5V49.8z M146.2,31c-3,0-5.5,0.9-7.4,2.6c-1.9,1.7-2.9,4.2-2.9,7.5h20.2 c0-3.1-0.9-5.6-2.8-7.4C151.5,31.9,149.1,31,146.2,31z"></path>\n\t\t\t\t<path d="M216.1,36c-1.1-0.3-2-0.5-2.7-0.6c-0.7-0.1-1.6-0.1-2.7-0.1c-4.2,0-7.6,1.2-10.1,3.7s-3.8,6.6-3.8,12.5v18.8h-15.3V22h15.3 v7.8c1.1-2.3,3-4.3,5.7-6c2.6-1.7,5.6-2.6,9-2.6c1.8,0,3.3,0.3,4.6,0.8V36z"></path>\n\t\t\t\t<path d="M234.3,49.8c0.1,1.5,0.3,2.9,0.7,4.2s1,2.4,1.8,3.4s1.9,1.7,3.2,2.3s3,0.8,5,0.8c2.7,0,4.7-0.5,6-1.6 c1.4-1.1,2.3-2.4,2.9-3.9h15c-0.3,2.3-1.1,4.4-2.4,6.4c-1.2,2-2.9,3.8-4.9,5.2c-2,1.5-4.4,2.7-7.2,3.5c-2.8,0.9-5.9,1.3-9.3,1.3 c-4.2,0-7.9-0.6-11.2-1.8c-3.2-1.2-6-3-8.2-5.2c-2.2-2.3-3.9-5-5-8c-1.1-3.1-1.7-6.5-1.7-10.2c0-3.5,0.5-6.8,1.6-9.9s2.7-5.8,4.9-8 c2.2-2.3,4.8-4.1,8-5.5c3.2-1.3,6.8-2,11-2c3.8,0,7.2,0.6,10.2,1.8c3,1.2,5.6,2.8,7.8,4.8c2.2,2,3.8,4.3,5,7s1.8,5.5,1.8,8.4 c0,1,0,2.1,0,3.2c0,1.1-0.2,2.4-0.5,3.9h-34.5V49.8z M244.6,31c-3,0-5.5,0.9-7.4,2.6c-1.9,1.7-2.9,4.2-2.9,7.5h20.2 c0-3.1-0.9-5.6-2.8-7.4C249.9,31.9,247.5,31,244.6,31z"></path>\n\t\t\t</symbol>\n\t\t</svg>\n\t\n\t\t\x3c!-- header --\x3e\n\t\t<router-outlet></router-outlet>\n\t\t\x3c!-- footer --\x3e\n\t\t<div class="toast-outlet" toast-outlet></div>\n\t\t<div class="modal-outlet" modal-outlet></div>\n\t'};var kc=["bmp","gif","ico","jpeg","jpg","png","svg","tif","tiff","webp","hdr"],Bc=["mp4","avi","mpeg","ogv","ts","webm","3gp","3g2"],Nc=["fbx","gltf","glb","obj","usdz"],Pc=["publisherStream","nextAttendeeStream","publisherScreen","attendeeScreen"];var Uc=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t,e){if(void 0===e&&(e=null),null!=e&&(t=t.type.name===e?t:null),t){if("string"==typeof t)return de.getPath(t);switch(t.type.name){case Wr.Image.name:case Wr.Video.name:case Wr.Model.name:t=t.folder+t.file,t=de.getPath(t);break;case Wr.PublisherStream.name:case Wr.AttendeeStream.name:case Wr.PublisherScreen.name:case Wr.AttendeeScreen.name:case Wr.SmartDeviceStream.name:t=de.getPath(t.file);break;default:n=t.file,new RegExp("/.("+kc.join("|")+")$/i").test(n)||function(t){return new RegExp("/.("+Bc.join("|")+")$/i").test(t)}(t.file)?(t=t.folder+t.file,t=de.getPath(t)):!function(t){return new RegExp("/.("+Nc.join("|")+")$/i").test(t)}(t.file)?function(t){return-1!==Pc.indexOf(t)}(t.file)&&(t=t.file):(t=t.folder+t.file,t=de.getPath(t))}t=t}else t=null;var n;return t},e}(t.Pipe);Uc.meta={name:"asset"};var Dc=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){e.prototype.onInit.call(this);var n=t.getContext(this).parentInstance;n instanceof Vr&&(this.data=n.modal.data)},r.onAccept=function(t){Yn.resolve()},r.onReject=function(t){Yn.reject()},r.onClose=function(){Yn.reject()},n}(t.Component);Dc.meta={selector:"[control-request-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">L\'utente ha richiesto il controllo della navigazione. Accetti?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()">\n\t\t\t\t\t\t<span>Rifiuta</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t\t<span>Accetta</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Dc.chunk=function(){return'<div class="control-request-modal" control-request-modal></div>'};var Fc=function(e){function i(){return e.apply(this,arguments)||this}return d(i,e),i.prototype.onInit=function(){var e=t.getContext(this),i=e.module,o=e.node,a=e.parentInstance,s=(e.selector,"drop"),c=n.fromEvent(o,s).pipe(r.shareReplay(1)),u=o.getAttribute("(drop)");if(u){var l=i.makeFunction(u,["$event"]);c.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){i.resolve(l,a,t)})),n.fromEvent(o,"dragover").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return t.preventDefault()}))}else a.drop$=c},i}(t.Directive);Fc.meta={selector:"[(drop)]"};var Hc=1e6,jc=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var e=this,i=t.getContext(this).node,o=i.getAttribute("dropdown-trigger");this.trigger=o?i.querySelector(o):i,this.opened=null,this.onClick=this.onClick.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this),this.openDropdown=this.openDropdown.bind(this),this.closeDropdown=this.closeDropdown.bind(this),this.addListeners(),n.dropdown$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.id===t?i.classList.add("dropped"):i.classList.remove("dropped")}))},i.onClick=function(e){var n=t.getContext(this).node;null===this.opened?this.openDropdown():n.querySelector("[dropdown-item]")||this.closeDropdown()},i.onDocumentClick=function(e){var n=t.getContext(this).node;n===e.target||n.contains(e.target)||this.closeDropdown()},i.openDropdown=function(){null===this.opened&&(this.opened=!0,this.addDocumentListeners(),n.dropdown$.next(this.id),this.dropped.next(this.id))},i.closeDropdown=function(){null!==this.opened&&(this.removeDocumentListeners(),this.opened=null,n.dropdown$.getValue()===this.id&&(n.dropdown$.next(null),this.dropped.next(null)))},i.addListeners=function(){this.trigger.addEventListener("click",this.onClick)},i.addDocumentListeners=function(){document.addEventListener("click",this.onDocumentClick)},i.removeListeners=function(){this.trigger.removeEventListener("click",this.onClick)},i.removeDocumentListeners=function(){document.removeEventListener("click",this.onDocumentClick)},i.onDestroy=function(){this.removeListeners(),this.removeDocumentListeners()},n.nextId=function(){return Hc++},c(n,[{key:"id",get:function(){return this.dropdown||this.id_||(this.id_=n.nextId())}}]),n}(t.Directive);jc.meta={selector:"[dropdown]",inputs:["dropdown","dropdown-trigger"],outputs:["dropped"]},jc.dropdown$=new n.BehaviorSubject(null);var Vc=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onInit=function(){var e=this,n=t.getContext(this).node;n.classList.add("dropdown-item"),jc.dropdown$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.id===t?n.classList.add("dropped"):n.classList.remove("dropped")}))},c(n,[{key:"id",get:function(){return this["dropdown-item"]}}]),n}(t.Directive);Vc.meta={selector:"[dropdown-item], [[dropdown-item]]",inputs:["dropdown-item"]};var Gc=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.toast=null,this.lastToast=null,jr.toast$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){e&&(t.lastToast=e),t.toast=e,t.pushChanges()}))},n.getClass=function(){var t={};return this.toast&&(t.active=!0),this.lastToast&&(t[this.lastToast.type]=!0,t[this.lastToast.position]=!0),t},n.onClose=function(){jr.reject(this.toast)},n.onAccept=function(){jr.resolve(this.toast)},n.onReject=function(){jr.reject(this.toast)},e}(t.Component);Gc.meta={selector:"[toast-outlet]",template:'\n\t<div class="toast-outlet__container" [class]="getClass()">\n\t\t<div class="toast-outlet__toast" *if="lastToast">\n\t\t\t<span class="toast-outlet__message" [innerHTML]="lastToast.message"></span>\n\t\t\t<div class="group--cta" *if="lastToast.type != \'info\'">\n\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t<span [innerHTML]="lastToast.acceptMessage"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()" *if="lastToast.type == \'dialog\'">\n\t\t\t\t\t<span [innerHTML]="lastToast.rejectMessage"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button type="button" class="btn--close" (click)="onClose()" *if="lastToast.type != \'info\'">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'};var Qc=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){this.mode=1,this.viewTypes=Object.keys(pr).map((function(t){var e=pr[t];return{type:e,name:pe.getKeys("editor",e.name),disabled:-1!==de.editor.disabledViewTypes.indexOf(e.name)}})),this.viewItemTypes=Object.keys(vr).map((function(t){var e=vr[t];return{type:e,name:pe.getKeys("editor",e.name),disabled:-1!==de.editor.disabledViewItemTypes.indexOf(e.name)}})),this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.onChanges=function(){this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.setSupportedViewTypes=function(){var t=this;this.supportedViewTypes=this.viewTypes.filter((function(e){return t.supportedViewType(e.type.name)})).sort((function(t,e){return t.disabled===e.disabled?0:t.disabled?1:-1}))},n.setSupportedViewItemTypes=function(){var t=this;this.view?this.supportedViewItemTypes=this.viewItemTypes.filter((function(e){return t.supportedViewItemType(t.view.type.name,e.type.name)})).sort((function(t,e){return t.disabled===e.disabled?0:t.disabled?1:-1})):this.supportedViewItemTypes=[]},n.setMode=function(t){this.mode!==t&&(this.mode=t,this.pushChanges())},n.supportedViewType=function(t){return-1!==[pr.Panorama.name,pr.PanoramaGrid.name,pr.Room3d.name,pr.Model.name,pr.Media.name].indexOf(t)},n.supportedViewItemType=function(t,e){var n;switch(t){case pr.WaitingRoom.name:n=!1;break;case pr.Panorama.name:case pr.PanoramaGrid.name:n=-1!==[vr.Nav.name,vr.Model.name,vr.Plane.name,vr.CurvedPlane.name].indexOf(e);break;case pr.Room3d.name:n=-1!==[vr.Nav.name,vr.Model.name,vr.Plane.name,vr.Texture.name].indexOf(e);break;case pr.Model.name:n=-1!==[vr.Nav.name,vr.Model.name,vr.Plane.name,vr.CurvedPlane.name].indexOf(e);break;case pr.Media.name:n=-1!==[].indexOf(e)}return n},n.onSelect=function(t){this.select.next(t)},n.onUpdate=function(t){this.update.next(t)},n.onDelete=function(t){this.delete.next(t)},e}(t.Component);Qc.meta={selector:"[aside]",outputs:["select","update","delete"],inputs:["view"]};var zc=0,qc=function(){function t(){}return t.menu$=function(){var t=this;return this.getMenu$().pipe(r.switchMap((function(e){return t.menu$_.next(e),t.menu$_})))},t.getMenu$=function(){return xn.get$("/api/menu").pipe(r.map((function(t){return t.menu.sort((function(t,e){return t.order-e.order})),t.menu})))},t.updateMenu$=function(t){return xn.put$("/api/menu",t)},t.createMenuItem$=function(t,e){void 0===t&&(t=null),void 0===e&&(e=0);var n={parentId:t,viewId:null,order:10*e,name:"Folder "+ ++zc};return xn.post$("/api/menu",n)},t.updateMenuItem$=function(t){return xn.put$("/api/menu/"+t.id,t)},t.deleteMenuItem$=function(t){return xn.delete$("/api/menu/"+t.id)},t.getModelMenu$=function(t,e){var n=this;return void 0===e&&(e=!1),this.menu$().pipe(r.map((function(r){if(r&&r.length)return r=r.filter((function(e){return null==e.viewId||null!=t.find((function(t){return t.id===e.viewId}))})),n.mapMenuItems(r);var i={};return t.forEach((function(t){if(t.type.name!==pr.WaitingRoom.name&&(!t.hidden||e)){var n=i[t.type.name];n||(n=i[t.type.name]=[]),n.push(t)}})),Object.keys(i).map((function(n){var r="Button";switch(n){case pr.WaitingRoom.name:r="Waiting Room";break;case pr.Panorama.name:r="Experience";break;case pr.PanoramaGrid.name:r="Virtual Tour";break;case pr.Room3d.name:r="Stanze 3D";break;case pr.Model.name:r="Modelli 3D";break;case pr.Media.name:r="Media"}return{name:r,type:{name:"menu-group"},items:t.filter((function(t){return t.type.name===n&&(!t.hidden||e)}))}}))})))},t.mapMenuItem=function(t,e){return t.viewId?{id:t.viewId,name:t.name,type:{name:"panorama"}}:{name:t.name,type:{name:"menu-group"},items:this.mapMenuItems(e,t.id)}},t.mapMenuItems=function(t,e){var n=this;return void 0===e&&(e=null),t.filter((function(t){return(t.parentId||null)===e})).map((function(e){return n.mapMenuItem(e,t)})).filter((function(t){return null!=t.id||t.items.length>0}))},c(t,null,[{key:"active",set:function(t){this.active$.next(t)},get:function(){return this.active$.getValue()}}]),t}();u(qc,"active$",new n.BehaviorSubject(!1)),u(qc,"menu$_",new n.BehaviorSubject([]));var Wc=function(){function e(){}return e.drop$=function(e){if(t.isPlatformBrowser&&e){var i=document.querySelector("body");return n.merge(n.fromEvent(i,"drop"),n.fromEvent(i,"dragover")).pipe(r.map((function(t){t.preventDefault(),t.target===e&&(e.files=t.dataTransfer.files)})))}return n.EMPTY},e.change$=function(e){return t.isPlatformBrowser&&e?n.fromEvent(e,"change").pipe(r.filter((function(t){return e.files&&e.files.length})),r.map((function(t){return Array.from(e.files)}))):n.EMPTY},e.asset$=function(t,e){var i=this;return void 0===e&&(e=[]),this.change$(t).pipe(r.switchMap((function(t){e.length=t.length,e.fill(null);var o=t.map((function(t,n){return i.read$(t,n,e).pipe(r.map((function(){return t})),r.switchMap((function(t){return fc.upload$([t])})),r.switchMap((function(t){var e=t[0],n=ti.fromUrl(e.url);return fc.assetCreate$(n)})))}));return n.combineLatest(o)})))},e.read$=function(t,e,i){var o=this;void 0===i&&(i=[]);var a=new FileReader,s=n.fromEvent(a,"load").pipe(r.switchMap((function(t){var e=t.target.result;return o.resize$(e)})),r.tap((function(t){i[e]=t})));return a.readAsDataURL(t),s},e.resize$=function(t){return n.from(this.resize_(t))},e.resize_=function(t){return new Promise((function(e,n){var r=document.createElement("img");r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d"),i=r.width,o=r.height;i>o?i>320&&(o*=320/i,i=320):o>240&&(i*=240/o,o=240),t.width=i,t.height=o,n.drawImage(r,0,0,i,o);var a=t.toDataURL("image/jpeg",.9);e(a)},r.onerror=function(){n(t)},r.src=t}))},e}(),Kc=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onChanges=function(){var e=t.getContext(this).node,n=this.control.flags;Object.keys(n).forEach((function(t){n[t]?e.classList.add(t):e.classList.remove(t)}))},n}(t.Component);Kc.meta={selector:"[control]",inputs:["control"]};var Xc=function(e){function i(){return e.apply(this,arguments)||this}return d(i,e),i.prototype.onInit=function(){var e=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg";var i=t.getContext(this).node.querySelector("input");i.setAttribute("accept",this.accept),Wc.drop$(i).pipe(r.takeUntil(this.unsubscribe$)).subscribe(),Wc.change$(i).pipe(r.switchMap((function(t){var i=t.map((function(t,n){return fc.upload$([t]).pipe(r.switchMap((function(t){return fc.createOrUpdateAsset$(t,e.control)})))}));return n.combineLatest(i)})),r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.control.value=t[0]}))},i}(Kc);Xc.meta={selector:"[control-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="control.value | asset" [size]="{ width: 320, height: 240 }" *if="control.value && control.value.type.name === \'image\'" />\n\t\t\t\t<video [src]="control.value | asset" *if="control.value && control.value.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Jc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t),n.itemToFormGroup=function(t){return new e.FormGroup({id:t.id,parentId:t.parentId,viewId:t.viewId,name:t.name,items:new e.FormArray})};var i=n.prototype;return i.onInit=function(){var t=this;this.dropdownId=jc.nextId(),this.controls=this.control.controls,pc.viewIdOptions$().pipe(r.first()).subscribe((function(e){t.controls.viewId.options=e}))},i.onAddItem=function(){var t=this;qc.createMenuItem$(this.controls.id.value,this.controls.items.length).pipe(r.first()).subscribe((function(e){t.controls.items.push(n.itemToFormGroup(e))}))},i.onRemoveItem=function(){this.remove.next(this.control)},i.onRemoveControl=function(t){var e=this;qc.deleteMenuItem$(t.value).pipe(r.first()).subscribe((function(){e.controls.items.remove(t)}))},i.onLinkItem=function(){this.link.next(this.control)},i.onLinkControl=function(t){this.link.next(t)},i.onItemUp=function(){this.up.next(this.control)},i.onItemDown=function(){this.down.next(this.control)},i.onUpControl=function(t){var e=this.controls.items,n=e.controls.length,r=e.controls.indexOf(t);e.controls.splice(r,1),r>0?r--:r=n-1,e.insert(t,r)},i.onDownControl=function(t){var e=this.controls.items,n=e.controls.length,r=e.controls.indexOf(t);e.controls.splice(r,1),r<n-1?r++:r=0,e.insert(t,r)},i.setView=function(t){var e=this,n=Object.assign({},this.control.value);n.viewId=t.id,t.id&&(n.name=t.name),qc.updateMenuItem$(n).pipe(r.first()).subscribe((function(){e.controls.viewId.value=t.id,t.id&&(e.controls.name.value=t.name,e.controls.items.controls=[],e.controls.items.switchSubjects_())}))},i.onTextDidChange=function(t){qc.updateMenuItem$(this.control.value).pipe(r.first()).subscribe()},i.hasOption=function(t){return this.controls.viewId.value===t.id},i.onDropped=function(t){},n}(Xc);Jc.meta={selector:"[control-menu]",outputs:["remove","link","up","down"],inputs:["control"],template:'\n\t\t<div class="group--form">\n\t\t\t<button type="button" class="control-menu__link" [class]="{ active: control.controls.viewId.value }" (click)="onLinkItem($event)" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#link"></use></svg>\n\t\t\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t\t\t<div class="category">View</div>\n\t\t\t\t\t<ul class="nav--dropdown">\n\t\t\t\t\t\t<li (click)="setView(item)" [class]="{ empty: item.id == null }" *for="let item of control.controls.viewId.options">\n\t\t\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<input type="text" class="control--text" [formControl]="control.controls.name" placeholder="Name" (change)="onTextDidChange($event)" />\n\t\t\t\x3c!--\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)">\n\t\t\t\t<span [innerHTML]="control.controls.viewId.value"></span>\n\t\t\t</button>\n\t\t\t--\x3e\n\t\t\t\x3c!--\n\t\t\t<select class="control--select" [formControl]="control.controls.viewId">\n\t\t\t\t<option [value]="item.id" *for="let item of control.controls.viewId.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t--\x3e\n\t\t\t<button type="button" class="control-menu__up" (click)="onItemUp($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#up"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__down" (click)="onItemDown($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#down"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)" *if="!control.controls.viewId.value">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#add"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__remove" (click)="onRemoveItem($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#remove"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="group--items">\n\t\t\t<div control-menu *for="let sub of control.controls.items.controls" [control]="sub" (remove)="onRemoveControl($event)" (link)="onLinkControl($event)" (up)="onUpControl($event)" (down)="onDownControl($event)"></div>\n\t\t</div>\n\t'};var Yc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.changes=0,this.form=null,qc.getMenu$().pipe(r.first()).subscribe((function(e){return t.initForm(e)}))},i.initForm=function(t){var n=this;void 0===t&&(t=[]);var i=this.menuToControls(t),o=this.form=new e.FormGroup({items:i});this.controls=o.controls;o.changes$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){n.changes++,n.pushChanges()}))},i.onLinkControl=function(t){},i.onUpControl=function(t){var e=this.controls.items,n=e.controls.length,r=e.controls.indexOf(t);e.controls.splice(r,1),r>0?r--:r=n-1,e.insert(t,r)},i.onDownControl=function(t){var e=this.controls.items,n=e.controls.length,r=e.controls.indexOf(t);e.controls.splice(r,1),r<n-1?r++:r=0,e.insert(t,r)},i.onAddItem=function(){var t=this;qc.createMenuItem$(null,this.controls.items.length).pipe(r.first()).subscribe((function(e){t.controls.items.push(Jc.itemToFormGroup(e))}))},i.onRemoveControl=function(t){var e=this;qc.deleteMenuItem$(t.value).pipe(r.first()).subscribe((function(){e.controls.items.remove(t)}))},i.isValid=function(){var t=this.form.valid;return t},i.onSubmit=function(t){if(this.form.valid){var e=this.form.value,n=this.controlsToMenu(e);qc.updateMenu$(n)}else this.form.touched=!0},i.menuToControls=function(t,n){var r=this;return void 0===n&&(n=null),new e.FormArray(t.filter((function(t){return(t.parentId||null)===n})).map((function(n){var i=r.menuToControls(t,n.id);return new e.FormGroup({id:n.id,parentId:n.parentId,viewId:n.viewId,name:n.name,items:i})})))},i.controlsToMenu=function(t){var e=[];return function t(n){n&&n.forEach((function(n,r){var i=Object.assign({},n);i.order=10*r,delete i.items,e.push(i),t(n.items)}))}(t.items),e},n}(t.Component);Yc.meta={selector:"[menu-builder]",inputs:["views"]};var $c=function(n){function i(){return n.apply(this,arguments)||this}d(i,n);var o=i.prototype;return o.onInit=function(){var t=this,n=this.position;this.error=null;var i=this.form=new e.FormGroup({type:vr.Nav,title:null,abstract:null,viewId:new e.FormControl(null,e.RequiredValidator()),keepOrientation:!1,important:!1,transparent:!1,position:new e.FormControl(n,e.RequiredValidator()),asset:null});this.controls=i.controls,i.changes$.subscribe((function(e){t.pushChanges()})),pc.viewIdOptions$().pipe(r.first()).subscribe((function(e){t.controls.viewId.options=e,t.pushChanges()}))},o.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=Object.assign({},this.form.value);e.viewId=parseInt(e.viewId),Mr.itemCreate$(this.navmap,e).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("NavmapItemModalComponent.onSubmit.error",e),t.error=e,t.form.submitted=!1}))}else this.form.touched=!0},o.onClose=function(){Yn.reject()},c(i,[{key:"data",get:function(){var e=null,n=t.getContext(this).parentInstance;return n instanceof Vr&&(e=n.modal.data),e}},{key:"navmap",get:function(){var t=null,e=this.data;return e&&(t=e.navmap),t}},{key:"position",get:function(){var t=[0,0,0],e=this.data;return e&&(t=[e.hit.x,e.hit.y,0]),t}}]),i}(t.Component);$c.meta={selector:"[navmap-item-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Map Nav.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3" [disabled]="true"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},$c.chunk=function(){return'<div class="nav-modal" navmap-item-modal></div>'};var Zc=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.error=null;var n=this.form=new e.FormGroup({name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){t.pushChanges()}))},i.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n={name:e.name,asset:e.asset};return Mr.navmapCreate$(n).pipe(r.first()).subscribe((function(t){Yn.resolve(t)}),(function(e){console.log("NavmapModalComponent.onSubmit.error",e),t.error=e,t.form.reset()}))}this.form.touched=!0},i.onClose=function(){Yn.reject()},n}(t.Component);Zc.meta={selector:"[navmap-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Map.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">Formato immagine .png con trasparenza (2048x1024 o 1024x512)</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Zc.chunk=function(){return'<div class="panorama-modal" navmap-modal></div>'};var tu=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.navmap=null,this.navmaps=[],Mr.navmapGet$().pipe(r.first()).subscribe((function(e){t.navmaps=e,t.pushChanges()}))},n.onBack=function(t){this.navmap=null,this.pushChanges()},n.onAdd=function(){var t=this;Yn.open$({template:Zc.chunk()}).pipe(r.first()).subscribe((function(e){e instanceof Xn&&(t.navmaps.push(e.data),t.navmap=e.data,t.pushChanges())}))},n.onSet=function(t){this.navmap=this.navmaps.find((function(e){return e.id===t.id})),this.pushChanges()},n.onAddItem=function(t,e){var n=this;Yn.open$({template:$c.chunk(),data:{navmap:t,hit:e}}).pipe(r.first()).subscribe((function(e){if(e instanceof Xn){var r=t.items||[];r.push(e.data),Object.assign(t,{items:r}),n.pushChanges()}}))},n.onDelete=function(t){var e=this.navmaps.indexOf(t);-1!==e&&this.navmaps.splice(e,1),this.navmap=null,this.pushChanges()},e}(t.Component);tu.meta={selector:"[navmap-builder]",inputs:["views"]};var eu="idle",nu="insert",ru="remove",iu="move",ou=function(t,e){var n=t.getBoundingClientRect();this.x=(e.clientX-n.x)/n.width,this.y=(e.clientY-n.y)/n.height},au=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ou),su=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ou),cu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(ou),uu=function(i){function o(){return i.apply(this,arguments)||this}d(o,i);var a=o.prototype;return a.onInit=function(){var t=this;this.mode=eu,this.error=null;var n=this.navmap,i=this.form=new e.FormGroup({name:new e.FormControl(n.name,e.RequiredValidator()),asset:new e.FormControl(n.asset,e.RequiredValidator())});this.controls=i.controls,i.changes$.subscribe((function(e){t.pushChanges()})),this.insert$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){var i=e;Yn.open$({template:$c.chunk(),data:{navmap:n,hit:i}}).pipe(r.first()).subscribe((function(e){if(e instanceof Xn){var r=n.items||[];r.push(e.data),Object.assign(n,{items:r}),t.pushChanges()}}))}))},a.insert$=function(){var e=this,i=t.getContext(this).node.querySelector(".navmap-control__image");return n.fromEvent(i,"pointerdown").pipe(r.filter((function(t){return e.mode===nu})),r.map((function(t){return new au(i,t)})))},a.onToggleMode=function(t){this.mode=this.mode===t?eu:t,this.pushChanges()},a.onMoveItem=function(e,i){var o=this,a=this.navmap;switch(this.mode){case iu:var s=t.getContext(this).node.querySelector(".navmap-control__image"),c=i.position.slice(),u=new au(s,e),l=n.fromEvent(s,"mousemove").pipe(r.map((function(t){return new su(s,t)})),r.tap((function(t){var e=t.x-u.x,n=t.y-u.y;i.position=[Math.max(0,Math.min(1,c[0]+e)),Math.max(0,Math.min(1,c[1]+n)),0],o.pushChanges()}))),d=n.fromEvent(s,"mouseup").pipe(r.map((function(t){return new cu(s,t)})),r.tap((function(t){var e=t.x-u.x,n=t.y-u.y;i.position=[Math.max(0,Math.min(1,c[0]+e)),Math.max(0,Math.min(1,c[1]+n)),0],Mr.itemUpdate$(a,i).pipe(r.first()).subscribe((function(t){Object.assign(i,t),o.pushChanges()}))})));l.pipe(r.takeUntil(d)).subscribe()}},a.onRemoveItem=function(t){var e=this,n=this.navmap;switch(this.mode){case ru:Mr.itemDelete$(n,t).pipe(r.first()).subscribe((function(r){var i=n.items||[],o=i.indexOf(t);-1!==o&&i.splice(o,1),Object.assign(n,{items:i}),e.pushChanges()}))}},a.onSubmit=function(){var t=this;if(this.form.valid){this.form.submitted=!0;var e=this.form.value,n=Object.assign({items:[]},this.navmap,{name:e.name});Mr.navmapUpdate$(n).pipe(r.first()).subscribe((function(e){Object.assign(t.navmap,e),t.pushChanges()}),(function(e){t.error=e,t.form.reset()}))}else this.form.touched=!0},a.onRemove=function(){var t=this,e=this.navmap;Yn.open$({template:Tc.chunk(),data:{item:e}}).pipe(r.first()).subscribe((function(n){n instanceof Xn&&Mr.navmapDelete$(e).pipe(r.first()).subscribe((function(n){t.delete.next(e)}))}))},o}(t.Component);uu.meta={selector:"[navmap-edit]",outputs:["delete"],inputs:["navmap"]};var lu=function(t){function i(){return t.apply(this,arguments)||this}d(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.busy=!1,this.active=!1,this.useHooks=ai.enabled;var n=this.form=new e.FormGroup;this.controls=n.controls;var r=this.item;this.originalItem=Object.assign({},r),r.hasChromaKeyColor=!(!r.asset||!r.asset.chromaKeyColor),r.autoplay=r.asset&&r.asset.type.name===Wr.Video.name?r.asset.autoplay:void 0,r.loop=r.asset&&r.asset.type.name===Wr.Video.name?r.asset.loop:void 0,r.assetType=Yr(r).id,this.doUpdateForm(),n.changes$.subscribe((function(e){t.doUpdateItem(e),t.pushChanges()}))},o.getFlagsDidChange=function(t,e){return["hasChromaKeyColor","autoplay","loop"].reduce((function(n,r){var i=e[r]||!1,o=t[r]||!1;return n||i!==o}),!1)},o.getAssetDidChange=function(t,e){return fc.assetDidChange(t.asset,e.asset)},o.doUpdateItem=function(t){var e=this,i=this.item,o=this.getAssetDidChange(i,t),a=this.getFlagsDidChange(i,t);(Object.assign(i,t),i.asset&&(i.asset.chromaKeyColor=i.hasChromaKeyColor?[0,1,0]:null,i.asset.autoplay=i.autoplay,i.asset.loop=i.loop),o||a)&&((i.asset?fc.assetUpdate$(i.asset):n.of(null)).pipe(r.switchMap((function(){return pc.inferItemUpdate$(e.view,i)})),r.first()).subscribe(),this.view.updateIndices(this.view.items),"function"==typeof i.onUpdateAsset&&i.onUpdateAsset());"function"==typeof i.onUpdate&&i.onUpdate()},o.doUpdateForm=function(){var t=this,n=this.item,i=this.form;if(this.type&&this.type.name===n.type.name)Object.keys(this.controls).forEach((function(e){switch(e){case"link":var r=n.link?n.link.title:null,i=n.link?n.link.href:null;t.controls[e].value={title:r,href:i,target:"_blank"};break;case"hasChromaKeyColor":t.controls[e].value=!(!n.asset||!n.asset.chromaKeyColor);break;case"autoplay":t.controls[e].value=!(!n.asset||!n.asset.autoplay);break;case"loop":t.controls[e].value=!(!n.asset||!n.asset.loop);break;case"assetType":t.controls[e].value=Yr(n).id;break;default:t.controls[e].value=null!=n[e]?n[e]:null}}));else{var o;switch(this.type=n.type,Object.keys(this.controls).forEach((function(t){i.removeKey(t)})),n.type.name){case vr.Nav.name:o=this.useHooks?["id","type","title?","abstract?","viewId?","hook?","hookExtra?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?"]:["id","type","title?","abstract?","viewId?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?"];break;case vr.Plane.name:o=["id","type","position","rotation","scale","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case vr.CurvedPlane.name:o=["id","type","position","rotation","scale","radius","height","arc","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case vr.Texture.name:o=["id","type","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case vr.Model.name:o=this.view.type.name===pr.Model?["id","type","asset?"]:["id","type","position","rotation","asset?"];break;default:o=["id","type"]}o.forEach((function(o){var a=-1!==o.indexOf("?");o=o.replace("?","");var s,c=null!=n[o]?n[o]:null;switch(o){case"viewId":s=new e.FormControl(c,a?void 0:e.RequiredValidator()),pc.viewIdOptions$().pipe(r.first()).subscribe((function(e){s.options=e,s.value=s.value||null,t.pushChanges()}));break;case"hook":if(s=new e.FormControl(c,a?void 0:e.RequiredValidator()),ai.enabled){var u=de.webhook.methods.map((function(t){return{id:t,name:t}}));u.unshift({id:null,name:"select"}),s.options=u}s.value=s.value||null,t.pushChanges();break;case"assetType":(s=new e.FormControl(c,a?void 0:e.RequiredValidator())).options=Object.keys(Kr).map((function(t){return Kr[t]}));break;case"link":var l=n.link?n.link.title:null,d=n.link?n.link.href:null;s=new e.FormGroup({title:new e.FormControl(l),href:new e.FormControl(d),target:"_blank"});break;default:s=new e.FormControl(c,a?void 0:e.RequiredValidator())}i.add(s,o)})),this.controls=i.controls}},o.onAssetTypeDidChange=function(t){var e=this,i=this.item,o=Yr(i).id;if(t!==o){i.assetType=t;var a=n.of(null);t!==Kr.ImageOrVideo.id&&(a=a.pipe(r.switchMap((function(){var e=$r(t);return fc.assetCreate$(e)})))),a.pipe(r.first()).subscribe((function(t){e.controls.asset.value=t}))}},o.onChanges=function(t){this.doUpdateForm()},o.onSubmit=function(){var t=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var e=this.form.value,n=Object.assign({},e);this.item.type.name===vr.Nav.name&&(n.viewId=n.viewId||this.view.id);var i=this.view,o=new Er(n);pc.inferItemUpdate$(i,o).pipe(r.first()).subscribe((function(e){pc.inferItemUpdateResult$(i,o),t.update.next({view:i,item:o}),t.setTimeout((function(){t.busy=!1,t.pushChanges()}))}),(function(t){return console.log("UpdateViewItemComponent.onSubmit.inferItemUpdate$.error",t)}))}else this.form.touched=!0},o.onRemove=function(t){var e=this;Yn.open$({template:Tc.chunk(),data:{item:this.item}}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&e.delete.next({view:e.view,item:e.item})}))},o.onSelect=function(t){this.select.next({view:this.view,item:this.item.selected?null:this.item})},o.getTitle=function(t){return pe.getKeys("editor",t.type.name)},o.clearTimeout=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){this.to&&clearTimeout(this.to)})),o.setTimeout=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))})),o.onDestroy=function(){this.clearTimeout()},i}(t.Component);lu.meta={selector:"update-view-item",outputs:["select","update","delete"],inputs:["view","item"],template:'\n\t\t<div class="group--headline" [class]="{ active: item.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="item.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(item)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="item.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'nav\'">\n\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView"></div>\n\t\t\t\t<div control-checkbox [control]="controls.keepOrientation" label="Keep Orientation"></div>\n\t\t\t\t<div control-checkbox [control]="controls.important" label="Important"></div>\n\t\t\t\t<div control-checkbox [control]="controls.transparent" label="Transparent"></div>\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3"></div>\n\t\t\t\t<div *if="controls.transparent.value == true">\n\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t</div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\t\t\t\t<div control-text [control]="controls.link.controls.title" label="Link Title"></div>\n\t\t\t\t<div control-text [control]="controls.link.controls.href" label="Link Url"></div>\n\t\t\t\t<div *if="useHooks">\n\t\t\t\t\t<div control-custom-select [control]="controls.hook" label="Hook"></div>\n\t\t\t\t\t<div control-text [control]="controls.hookExtra" label="Hook Extra"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name != \'media\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name == \'media\'">\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'curved-plane\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\x3c!-- <div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-number [control]="controls.radius" label="Radius" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.height" label="Height" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.arc" label="Arc" [precision]="0"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'texture\'">\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'model\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var du=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.busy=!1,this.active=!1;var n=this.form=new e.FormGroup({id:new e.FormControl(this.tile.id,e.RequiredValidator()),asset:new e.FormControl(this.tile.asset,e.RequiredValidator()),navs:new e.FormControl(this.tile.navs,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(e){var n=t.tile;Object.assign(n,e),"function"==typeof n.onUpdate&&n.onUpdate(),t.pushChanges()}))},i.onSubmit=function(){var t=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var e=Object.assign({},this.form.value),n=this.view,r=e;this.update.next({view:n,tile:r}),this.setTimeout((function(){t.busy=!1,t.pushChanges()}))}else this.form.touched=!0},i.onRemove=function(t){var e=this;Yn.open$({template:Tc.chunk(),data:{tile:this.tile}}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&e.delete.next({view:e.view,tile:e.tile})}))},i.onSelect=function(t){this.select.next({view:this.view,tile:this.tile.selected?null:this.tile})},i.clearTimeout=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){this.to&&clearTimeout(this.to)})),i.setTimeout=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))})),i.onDestroy=function(){this.clearTimeout()},n}(t.Component);du.meta={selector:"update-view-tile",outputs:["select","update","delete"],inputs:["view","tile"],template:'\n\t\t<div class="group--headline" [class]="{ active: tile.selected }" (click)="onSelect($event)">\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon name="tile"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title">Tile {{tile.id}}</div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="tile.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t\x3c!--\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t</form>\n\t'};var hu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.busy=!1;var n=this.form=new e.FormGroup;this.controls=n.controls,this.doUpdateForm(),n.changes$.subscribe((function(e){t.doUpdateView(e),t.pushChanges()})),this.orbit$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(t.view.type.name){case pr.WaitingRoom.name:case pr.Panorama.name:case pr.PanoramaGrid.name:case pr.Room3d.name:case pr.Model.name:case pr.Media.name:t.form.patch({latitude:e.orientation.latitude,longitude:e.orientation.longitude,zoom:e.zoom})}}))},i.orbit$=function(){var t,e,n=null;return Ln.in$.pipe(r.filter((function(t){return t.type===qe})),r.auditTime(65),r.distinctUntilChanged((function(r,i){var o=t!==i.orientation.latitude||e!==i.orientation.longitude||n!==i.zoom;return t=i.orientation.latitude,e=i.orientation.longitude,n=i.zoom,!o})))},i.getAssetDidChange=function(t){var e=this.view;if(e.type.name===pr.PanoramaGrid.name)return!1;var n=fc.assetDidChange(e.asset,t.asset),r=fc.assetDidChange(e.ar?e.ar.usdz:null,t.usdz),i=fc.assetDidChange(e.ar?e.ar.gltf:null,t.gltf);return!!(n||r||i)},i.doUpdateView=function(t){this.getAssetDidChange(t)&&this.onSubmit()},i.doUpdateForm=function(){var t=this.view;if(!this.type||this.type.name!==t.type.name){this.type=t.type;var n,r=this.form;switch(Object.keys(this.controls).forEach((function(t){r.removeKey(t)})),t.type.name){case pr.WaitingRoom.name:n=["id","type","name","latitude","longitude","zoom","asset"];break;case pr.Panorama.name:n=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case pr.PanoramaGrid.name:n=["id","type","name","hidden?","latitude","longitude","zoom"];break;case pr.Room3d.name:case pr.Model.name:n=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case pr.Media.name:n=["id","type","name","hidden?","asset"];break;default:n=["id","type","name"]}t.type.name!==pr.WaitingRoom.name&&de.flags.ar&&(n.push("usdz?"),n.push("gltf?")),n.forEach((function(n){var i=-1!==n.indexOf("?");switch(n=n.replace("?","")){case"latitude":case"longitude":var o=t.orientation||{latitude:0,longitude:0};r.add(new e.FormControl(o[n],e.RequiredValidator()),n);break;case"usdz":case"gltf":r.add(new e.FormControl(t.ar&&t.ar[n]||null,i?void 0:e.RequiredValidator()),n);break;default:r.add(new e.FormControl(null!=t[n]?t[n]:null,i?void 0:e.RequiredValidator()),n)}})),this.controls=r.controls}},i.onChanges=function(t){this.doUpdateForm()},i.onSubmit=function(){var t=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var e=Object.assign({},this.form.value);null!=e.latitude&&(e.orientation={latitude:e.latitude,longitude:e.longitude},delete e.latitude,delete e.longitude);var n=e.usdz||null,i=e.gltf||null;delete e.usdz,delete e.gltf,e.ar=n||i?{usdz:n,gltf:i}:null;var o=new mr(Object.assign({},this.view,e));pc.viewUpdate$(o).pipe(r.first()).subscribe((function(e){t.update.next({view:o}),t.setTimeout((function(){t.busy=!1,t.pushChanges()}))}),(function(t){return console.log("UpdateViewComponent.onSubmit.viewUpdate$.error",t)}))}else this.form.touched=!0},i.onRemove=function(t){var e=this;Yn.open$({template:Tc.chunk(),data:{item:this.item}}).pipe(r.first()).subscribe((function(t){t instanceof Xn&&e.delete.next({view:e.view})}))},i.onSelect=function(t){this.select.next({view:this.view.selected?null:this.view})},i.getTitle=function(t){return pe.getKeys("editor",t.type.name)},i.clearTimeout=function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){this.to&&clearTimeout(this.to)})),i.setTimeout=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))})),i.onDestroy=function(){this.clearTimeout()},n}(t.Component);hu.meta={selector:"update-view",outputs:["select","update","delete"],inputs:["view"],template:'\n\t\t<div class="group--headline" [class]="{ active: view.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="view.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(view)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="view.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'waiting-room\'">\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'room-3d\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'model\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name != \'waiting-room\' && (\'ar\' | flag)">\n\t\t\t\t<div control-model [control]="controls.usdz" label="AR IOS (.usdz)" accept=".usdz"></div>\n\t\t\t\t<div control-model [control]="controls.gltf" label="AR Android (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" *if="view.type.name != \'waiting-room\'" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var fu=[Qc,vc,Rc,mc,tu,uu,Zc,$c,gc,Yc,Ac,yc,wc,bc,Ec,_c,Sc,Tc,Cc,Gc,lu,du,hu],pu=[],vu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(t.Module);vu.meta={imports:[],declarations:[].concat(fu,pu),exports:[].concat(fu,pu)};var mu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onClose=function(){Yn.reject()},e}(t.Component);mu.meta={selector:"[iframe-modal]",inputs:["src"],template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="modal__content">\n\t\t\t<iframe [src]="src"></iframe>\n\t\t</div>\n\t'},mu.chunk=function(t){return'<div class="iframe-modal" iframe-modal src="'+t+'"></div>'};var gu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){for(var e=de,n=t.split("."),r=n.shift();n.length>0&&e[r];)e=e[r],r=n.shift();return e[r]||null},e}(t.Pipe);gu.meta={name:"env"};var Au=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){return de.flags[t]||!1},e}(t.Pipe);Au.meta={name:"flag"};var yu=function(t){this.file=t,this.name=t.name,this.type=Zr(t.name),this.progress=0,this.size=t.size,this.uploading=!1,this.paused=!1,this.success=!1,this.complete=!1,this.error=null,this.preview=null},bu=function(t){t&&Object.assign(this,t)},wu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(bu),Eu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(bu),_u=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(bu),Su=function(){function e(){this.concurrent$=new n.BehaviorSubject(0),this.items$=new n.BehaviorSubject([]),this.events$=new n.ReplaySubject(1)}var i=e.prototype;return i.upload$=function(){var t=this,e=this.items$.getValue().filter((function(t){return!t.uploading}));return n.combineLatest(e.map((function(e){return t.uploadItem$(e)})))},i.uploadItem$=function(t){var e=this;t.uploading=!0,this.events$.next(new wu({item:t}));var i=[t.file];return n.of(i).pipe(r.delayWhen((function(){return e.concurrent$.pipe(r.filter((function(t){return t<4})))})),r.tap((function(){return e.concurrent$.next(e.concurrent$.getValue()+1)})),r.first(),r.switchMap((function(t){return fc.upload$(t)})),r.switchMap((function(n){var i=n[0];t.uploading=!1,t.complete=!0;var o=ti.fromUrl(i.url);return e.events$.next(new Eu({item:t,asset:o})),fc.assetCreate$(o).pipe(r.tap((function(n){e.remove(t),e.events$.next(new _u({item:t,asset:n})),e.concurrent$.next(e.concurrent$.getValue()-1)})))})))},i.addItems=function(t){if(t&&t.length){var e=this.items$.getValue(),n=Array.from(t).map((function(t){return new yu(t)}));e.push.apply(e,n),this.items$.next(e)}},i.remove=function(t){var e=this.items$.getValue(),n=e.indexOf(t);-1!==n&&e.splice(n,1),this.items$.next(e)},i.removeAll=function(){this.items$.next([])},i.drop$=function(e,i){var o=this;if(t.isPlatformBrowser&&e){i=i||e;var a=document.querySelector("body");return n.merge(n.fromEvent(a,"drop"),n.fromEvent(a,"dragover")).pipe(r.map((function(t){return t.preventDefault(),t.target===i&&o.addItems(t.dataTransfer.files),o.items$})))}return n.EMPTY},i.change$=function(e){var i=this;return t.isPlatformBrowser&&e?n.fromEvent(e,"change").pipe(r.switchMap((function(t){return e.files.length&&(i.addItems(e.files),e.value=""),i.items$}))):n.EMPTY},i.files$=function(t){var e=this;return n.combineLatest(Array.from(t).map((function(t,n){return e.file$(t,n)})))},i.file$=function(t,e){var n=this;return this.read$(t,e).pipe(r.switchMap((function(){return n.uploadFile$(t)})))},i.read$=function(t,e){var i=this,o=new FileReader,a=n.fromEvent(o,"load").pipe(r.tap((function(t){var n=t.target.result;i.resize(n,(function(t){i.previews[e]=t,i.pushChanges()}))})));return o.readAsDataURL(t),a},i.uploadFile$=function(t){return fc.upload$([t]).pipe(r.switchMap((function(t){var e=t[0],n=ti.fromUrl(e.url);return fc.assetCreate$(n)})))},i.resize=function(t,e){if("function"==typeof e){var n=document.createElement("img");n.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d"),i=n.width,o=n.height;i>o?i>320&&(o*=320/i,i=320):o>240&&(i*=240/o,o=240),t.width=i,t.height=o,r.drawImage(n,0,0,i,o);var a=t.toDataURL("image/jpeg",.9);e(a)},n.src=t}},i.supported=function(){return(e=document.createElement("input")).type="file","files"in e&&!!((t=new XMLHttpRequest)&&"upload"in t&&"onprogress"in t.upload)&&!!window.FormData;var t,e},e}(),Tu=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var e=this;this.label=this.label||"label",this.accept=this.accept||"image/png, image/jpeg",this.multiple=!1!==this.multiple,this.items=[],this.assets=this.control.value||[],this.hasFiles=!1;var n=t.getContext(this).node,i=n.querySelector("input");i.setAttribute("accept",this.accept);var o=n.querySelector(".upload-drop"),a=this.service=new Su;a.drop$(i,o).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.items=t,e.pushChanges()})),a.change$(i).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.items=t,e.pushChanges()})),a.events$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){t instanceof _u&&(e.assets.push(t.asset),e.control.value=e.assets),e.items=e.items,e.pushChanges()}))},i.onUpload=function(){this.service.upload$().pipe(r.first()).subscribe()},i.onCancel=function(){this.service.removeAll()},i.onItemPause=function(t){},i.onItemResume=function(t){},i.onItemCancel=function(t){},i.onItemRemove=function(t){this.service.remove(t)},c(n,[{key:"items",get:function(){return this.items_},set:function(t){this.items_=t,this.uploadCount=t.reduce((function(t,e){return t+(e.uploading||e.completed?0:1)}),0)}}]),n}(Kc);Tu.meta={selector:"[control-assets]",inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="listing--assets">\n\t\t\t\t<div class="listing__item" *for="let item of assets">\n\t\t\t\t\t<div class="upload-item">\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<img [lazy]="item | asset" [size]="{ width: 320, height: 240 }" *if="item.type.name === \'image\'" />\n\t\t\t\t\t\t\t<video [src]="item | asset" *if="item.type.name === \'video\'"></video>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="name" [innerHTML]="item.file"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="listing__item" *for="let item of items">\n\t\t\t\t\t<div upload-item [item]="item" (pause)="onItemPause($event)" (resume)="onItemResume($event)" (cancel)="onItemCancel($event)" (remove)="onItemRemove($event)"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<div class="btn--browse">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t\t<input type="file" accept="image/jpeg" multiple />\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--upload" (click)="onUpload()" *if="uploadCount > 0" [innerHTML]="\'upload\' | label"></div>\n\t\t\t\t<div class="btn--cancel" (click)="onCancel()" *if="uploadCount > 0" [innerHTML]="\'cancel\' | label"></div>\n\t\t\t</div>\n\t\t\t<div class="upload-drop">\n    \t\t\t<span [innerHTML]="\'drag_and_drop_images\' | label"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Cu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onInit=function(){this.label=this.label||"label"},e}(Kc);Cu.meta={selector:"[control-checkbox]",inputs:["control","label"],template:'\n\t\t<div class="group--form--checkbox" [class]="{ required: control.validators.length }">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox" class="control--checkbox" [formControl]="control" [value]="true" />\n\t\t\t\t<span [innerHTML]="label | html"></span>\n\t\t\t</label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var xu=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var t=this;this.label=this.label||"label",this.dropped=!1,this.dropdownId=jc.nextId(),Ei.typing$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.scrollToWord(e)}))},i.scrollToWord=function(e){for(var n=this.control.options||[],r=-1,i=0;i<n.length;i++){if(0===n[i].name.toLowerCase().indexOf(e.toLowerCase())){r=i;break}}if(-1!==r){var o=t.getContext(this).node,a=o.querySelector(".dropdown"),s=o.querySelector(".nav--dropdown").children[r];s&&a.scrollTo(0,s.offsetTop)}},i.setOption=function(t){var e;if(this.isMultiple){var n=this.control.value||[],r=n.indexOf(t.id);-1!==r?n.splice(r,1):n.push(t.id),function(t){throw new Error('"'+t+'" is read-only')}("value"),n=n.length?n.slice():null}else e=t.id;this.control.value=e,this.change.next(e)},i.hasOption=function(t){return this.isMultiple?-1!==(this.control.value||[]).indexOf(t.id):this.control.value===t.id},i.getLabel=function(){var t=this.control.value,e=this.control.options||[];if(this.isMultiple)return(t=t||[]).length?t.map((function(t){var n=e.find((function(e){return e.id===t||e.name===t}));return n?n.name:""})).join(", "):"select";var n=e.find((function(e){return e.id===t||e.name===t}));return n?n.name:"select"},i.onDropped=function(t){this.dropped&&null===t&&(this.control.touched=!0),this.dropped=t===this.dropdownId},c(n,[{key:"isMultiple",get:function(){return this.multiple&&!1!==this.multiple&&"false"!==this.multiple}}]),n}(Kc);xu.meta={selector:"[control-custom-select]",outputs:["change"],inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length, multiple: isMultiple }" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="control--custom-select" [innerHTML]="getLabel() | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t<div class="category" [innerHTML]="label"></div>\n\t\t\t<ul class="nav--dropdown" [class]="{ multiple: isMultiple }">\n\t\t\t\t<li (click)="setOption(item)" [class]="{ empty: item.id == null }" *for="let item of control.options">\n\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name | label"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t'};var Ru=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1;var e=getContext(this).node,n=this.input=e.querySelector("input");merge(fromEvent(n,"input")).pipe(takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidChange(e)})),fromEvent(n,"blur").pipe(takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidBlur(e)}))},n.onInputDidChange=function(t){console.log("ControlLinkComponent.onInputDidChange",t.target.value)},n.onInputDidBlur=function(t){this.control.touched=!0,this.value=this.input.value},e}(Kc);Ru.meta={selector:"[control-link]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Iu=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg",this.languages=de.languages,this.currentLanguage=de.defaultLanguage;var i=t.getContext(this).node.querySelector("input");i.setAttribute("accept",this.accept),Wc.drop$(i).pipe(r.takeUntil(this.unsubscribe$)).subscribe(),Wc.change$(i).pipe(r.switchMap((function(t){var i=t.map((function(t,n){return fc.upload$([t]).pipe(r.switchMap((function(t){return(e.languages.length>1?fc.createOrUpdateLocalizedAsset$:fc.createOrUpdateAsset$)(t,e.control,e.currentLanguage)})))}));return n.combineLatest(i)})),r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.control.value=t[0]}))},o.setLanguage=function(t){this.currentLanguage=t,this.pushChanges()},c(i,[{key:"localizedValue",get:function(){var t=this.control.value;if(t&&t.locale){var e=t.locale[this.currentLanguage];e&&(t=e)}return t}}]),i}(Kc);Iu.meta={selector:"[control-localized-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="localizedValue | asset" [size]="{ width: 320, height: 240 }" *if="localizedValue && localizedValue.type.name === \'image\'" />\n\t\t\t\t<video [src]="localizedValue | asset" *if="localizedValue && localizedValue.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="localizedValue" [innerHTML]="localizedValue.file"></div>\n\t\t\t<ul class="nav--languages" *if="languages.length > 1">\n\t\t\t\t<li class="nav__item" [class]="{ active: lang == currentLanguage }" (click)="setLanguage(lang)" [innerHTML]="lang" *for="let lang of languages"></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Ou=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||".glb";var i=t.getContext(this).node,o=this.input=i.querySelector("input");o.setAttribute("accept",this.accept),Wc.change$(o).pipe(r.switchMap((function(t){var i=t.map((function(t,n){return fc.upload$([t]).pipe(r.switchMap((function(t){return fc.createOrUpdateAsset$(t,e.control)})))}));return n.combineLatest(i)})),r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.control.value=t[0]}))},o.onRemove=function(t){var e=this;fc.assetDelete$(this.control.value).pipe(r.first()).subscribe((function(){e.control.value=null,e.input.value=null,e.control.touched=!0}))},o.read$=function(t,e){return n.of(t)},i}(Xc);Ou.meta={selector:"[control-model]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--model">\n\t\t\t\t<div class="file-name" *if="!control.value" [innerHTML]="\'select_file\' | label"></div>\n\t\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t\t\t<div class="btn--upload"><input type="file"><span [innerHTML]="\'browse\' | label"></span></div>\n\t\t\t\t<div class="btn--remove" *if="control.value" (click)="onRemove($event)"><span [innerHTML]="\'remove\' | label"></span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Mu=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1},n.updateValue=function(t){this.control.value=t},e}(Kc);Mu.meta={selector:"[control-number]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--number">\n\t\t\t\t<input-value label="" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value" (update)="updateValue($event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Lu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onInit=function(){this.label=this.label||"label"},e}(Kc);Lu.meta={selector:"[control-password]",inputs:["control","label"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="password" class="control--text" [formControl]="control" [placeholder]="label" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var ku=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onInit=function(){this.label=this.label||"label"},e}(Kc);ku.meta={selector:"[control-select]",inputs:["control","label"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<select class="control--select" [formControl]="control" required>\n\t\t\t\t<option [value]="null" [innerHTML]="\'select\' | label"></option>\n\t\t\t\t<option [value]="item.id" *for="let item of control.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Bu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onInit=function(){this.label=this.label||"label",this.disabled=this.disabled||!1},e}(Kc);Bu.meta={selector:"[control-text]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Nu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.onInit=function(){this.label=this.label||"label",this.disabled=this.disabled||!1},e}(Kc);Nu.meta={selector:"[control-textarea]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form--textarea" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<textarea class="control--text" [formControl]="control" [placeholder]="label" [innerHTML]="label" rows="4" [disabled]="disabled"></textarea>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Pu=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1},n.updateValue=function(t,e){var n=this.control.value;n[t]=e,this.control.value=n.slice()},e}(Kc);Pu.meta={selector:"[control-vector]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--vector">\n\t\t\t\t<input-value label="x" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[0]" (update)="updateValue(0, $event)"></input-value>\n\t\t\t\t<input-value label="y" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[1]" (update)="updateValue(1, $event)"></input-value>\n\t\t\t\t<input-value label="z" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[2]" (update)="updateValue(2, $event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Uu=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onChanges=function(){var e=t.getContext(this).node;!0===this.disabled?(e.disabled=this.disabled,e.setAttribute("disabled",this.disabled)):(delete e.disabled,e.removeAttribute("disabled"))},n}(t.Directive);Uu.meta={selector:"input[disabled],textarea[disabled]",inputs:["disabled"]};var Du=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.prototype.getLabel=function(t,e){return pe.transform("error_"+t)},e}(Kc);Du.meta={selector:"errors-component",inputs:["control"],template:'\n\t<div class="inner" [style]="{ display: control.invalid && control.touched ? \'block\' : \'none\' }">\n\t\t<div class="error" *for="let [key, value] of control.errors">\n\t\t\t<span [innerHTML]="getLabel(key, value)"></span>\n\t\t\t\x3c!-- <span class="key" [innerHTML]="key"></span> <span class="value" [innerHTML]="value | json"></span> --\x3e\n\t\t</div>\n\t</div>\n\t'};var Fu=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.label=this.label||"label",this.value=this.value||0,this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.increment$(".btn--more",1).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.value+=t,e.update.next(e.value),e.pushChanges()})),this.increment$(".btn--less",-1).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.value+=t,e.update.next(e.value),e.pushChanges()}));var i=t.getContext(this).node,o=this.input=i.querySelector("input");n.merge(n.fromEvent(o,"input")).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidChange(t)})),n.merge(n.fromEvent(o,"blur"),n.fromEvent(o,"keydown").pipe(r.filter((function(t){return"Enter"===t.key||13===t.keyCode})))).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidBlur(t)}))},o.onInputDidChange=function(t){t.target.value=t.target.value.replace(/[^\d|\.|-]/g,"")},o.onInputDidBlur=function(t){var e=parseFloat(this.input.value);this.value!==e&&(NaN!==e?(this.value=e,this.update.next(this.value)):this.input.value=this.getValue())},o.increment$=function(e,i){var o,a,s=this,c=t.getContext(this).node.querySelector(e);return n.race(n.fromEvent(c,"mousedown"),n.fromEvent(c,"touchstart")).pipe(r.tap((function(){a=s.increment,o=16})),r.switchMap((function(t){return n.interval(30).pipe(r.filter((function(t){return t%o==0})),r.map((function(){var t=a*i;return o=Math.max(1,Math.floor(.85*o)),t})),r.takeUntil(n.race(n.fromEvent(c,"mouseup"),n.fromEvent(c,"touchend"))))})))},o.getValue=function(){return this.value.toFixed(this.precision)},o.setValue=function(t){this.value+=this.increment*t,this.update.next(this.value),this.pushChanges()},i}(t.Component);Fu.meta={selector:"input-value",outputs:["update"],inputs:["value","label","precision","increment","disabled"],template:'\n\t\t<div class="group--control" [class]="{ disabled: disabled }">\n\t\t\t<input type="text" class="control--text" [placeholder]="label" [value]="getValue()" [disabled]="disabled" />\n\t\t\t<div class="control--trigger">\n\t\t\t\t<div class="btn--more" (click)="setValue(1)">+</div>\n\t\t\t\t<div class="btn--less" (click)="setValue(-1)">-</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var Hu=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){this.env=ae},n.onTest=function(t){this.test.next(t)},n.onReset=function(t){this.reset.next(t)},e}(t.Component);Hu.meta={selector:"test-component",inputs:["form"],outputs:["test","reset"],template:'\n\t<div class="group--form--results" *if="env.DEVELOPMENT">\n\t\t<code [innerHTML]="form.value | json"></code>\n\t\t<button type="button" class="btn--mode" (click)="onTest($event)"><span>test</span></button>\n\t\t<button type="button" class="btn--mode" (click)="onReset($event)"><span>reset</span></button>\n\t</div>\n\t'};var ju=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onChanges=function(e){var n=t.getContext(this).node;n.value=this.value,n.setAttribute("value",this.value)},n}(t.Directive);ju.meta={selector:"[value]",inputs:["value"]};var Vu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){if(t){t=t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e))}));var e=['"',"&","'","<",">"," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","×","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ","&","•","°","∞","‰","⋅","±","†","—","¬","µ","⊥","∥","€","£","¥","¢","©","®","™","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],n=new RegExp("(&"+["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")+";)","g");return t=t.replace(n,(function(){for(var t=1;t<arguments.length;t++)if(arguments[t])return e[t-1]}))}},e}(t.Pipe);Vu.meta={name:"html"};var Gu=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.onChanges=function(){t.getContext(this).node.setAttribute("id",this.id)},n}(t.Directive);Gu.meta={selector:"[id]",inputs:["id"]};var Qu=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){this.showLanguages=!1,this.languageService=ve},n.setLanguage=function(t){var e=this;this.languageService.setLanguage$(t).pipe(r.first()).subscribe((function(t){e.showLanguages=!1,e.pushChanges(),e.set.next()}))},n.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},e}(t.Component);Qu.meta={selector:"[language]",outputs:["set"],template:'\n\t\t<button type="button" class="btn--language" (click)="toggleLanguages()" *if="languageService.hasLanguages"><span [innerHTML]="languageService.activeLanguage.title"></span> <svg viewBox="0 0 8 5"><use xlink:href="#caret-down"></use></svg></button>\n\t\t<ul class="nav--language" *if="showLanguages">\n\t\t\t<li (click)="setLanguage(language)" *for="let language of languageService.languages"><span [innerHTML]="language.title"></span></li>\n\t\t</ul>\n\t'};var zu=function(){function t(){}return t.observer=function(){var t=this;return this.observer_||(this.readySubject_=new n.BehaviorSubject(!1),this.observerSubject_=new n.Subject,this.observer_=new IntersectionObserver((function(e){t.observerSubject_.next(e)}))),this.observer_},t.intersection$=function(t){if("IntersectionObserver"in window){var e=this.observer();return e.observe(t),this.observerSubject_.pipe(r.map((function(e){return e.find((function(e){return e.target===t}))})),r.filter((function(t){return void 0!==t&&t.isIntersecting})),r.first(),r.finalize((function(){return e.unobserve(t)})))}return n.of({target:t})},t}(),qu=function(){function t(){}return t.get=function(t){return this.cache[t]},t.set=function(t,e){this.cache[t]=e;var n=Object.keys(this.cache);n.length>100&&this.remove(n[0])},t.remove=function(t){delete this.cache[t]},c(t,null,[{key:"cache",get:function(){return this.cache_||(this.cache_={}),this.cache_}}]),t}(),Wu=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=t.getContext(this).node;i.classList.add("lazy"),this.input$=(new n.Subject).pipe(r.distinctUntilChanged(),r.switchMap((function(t){var r=qu.get(t);return r?n.of(r):(i.classList.remove("lazyed"),e.lazy$(t))})),r.takeUntil(this.unsubscribe$)),this.input$.subscribe((function(t){qu.set(e.lazy,t),i.setAttribute("src",t),i.classList.add("lazyed")}))},o.onChanges=function(){this.input$.next(this.lazy)},o.lazy$=function(e){var n=this,i=t.getContext(this).node;return zu.intersection$(i).pipe(r.switchMap((function(){return go.load$(e,n.size)})),r.first())},i}(t.Directive);Wu.meta={selector:"[lazy],[[lazy]]",inputs:["lazy","size"]};var Ku=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){var n=e.urlify(t);return n=e.breakLines(n)},e.urlify=function(t){return t.replace(/(?:(?:https?|ftp):\/\/|\b(?:[a-z\d]+\.))(?:(?:[^\s()<>]+|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))?\))+(?:\((?:[^\s()<>]+|(?:\(?:[^\s()<>]+\)))?\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))?/gim,(function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"}))},e.breakLines=function(t){return t.replace(/\n/gm,(function(t){return"<br>"}))},e}(t.Pipe);Ku.meta={name:"message"};var Xu=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){var e=t.getContext(this).parentInstance;e instanceof Vr&&(this.data=e.modal.data)},r.onClose=function(){Yn.reject()},n}(t.Component);Xu.meta={selector:"[modal]"};var Ju=function(e){function i(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return u(h(t=e.call.apply(e,[this].concat(r))||this),"path",void 0),u(h(t),"segments",void 0),u(h(t),"routerLink_",void 0),t}d(i,e);var o=i.prototype;return o.onInit=function(){this.routerLink$().pipe(r.takeUntil(this.unsubscribe$)).subscribe()},o.onChanges=function(){var e=t.getContext(this).node,n=this.routerLink;if(n.length){var r=Qt.buildUrl.apply(Qt,n);e.setAttribute("href",r)}else e.setAttribute("href","")},o.routerLink$=function(){var e=this,i=t.getContext(this).node;return n.fromEvent(i,"click").pipe(r.map((function(t){return console.log(e.routerLink),Qt.setRouterLink.apply(Qt,e.routerLink),t.preventDefault(),!1})))},o.getSegments=function(t){var e=[];return t.forEach((function(t){if("string"==typeof t)for(var n,r=[],i=p(t.matchAll(/([^:]+)|\:([^\/]+)/g));!(n=i()).done;){var o=n.value,a=o[1],s=o[2];if(a)r.push(a);else if(s){var c={};c[s]=null,r.push(c)}}else e.push(new RouteSegment("",{}))})),e},c(i,[{key:"routerLink",get:function(){return this.routerLink_},set:function(t){this.routerLink_=Array.isArray(t)?t:[t]}}]),i}(t.Directive);u(Ju,"meta",{selector:"[routerLink]",inputs:["routerLink"]});var Yu=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e.transform=function(t){return de.url[t]||"#"+t},e}(t.Pipe);Yu.meta={name:"slug"};var $u=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){e.prototype.onInit.call(this);var n=t.getContext(this).parentInstance;n instanceof Vr&&(this.data=n.modal.data)},r.onAccept=function(t){Yn.resolve()},r.onReject=function(t){Yn.reject()},r.onClose=function(){Yn.reject()},n}(t.Component);$u.meta={selector:"[support-request-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Un operatore è disponibile per un tour guidato.<br>Desideri Accettare?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t\t<span>Accetta</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()">\n\t\t\t\t\t\t<span>Rifiuta</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},$u.chunk=function(){return'<div class="support-request-modal" support-request-modal></div>'};var Zu=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){this.update()},r.onChanges=function(){this.update()},r.update=function(){if(this.name_!==this.name){this.name_=this.name;var e=t.getContext(this).node;if(e.parentNode){var n,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=this.width||24,o=this.height||24;r.setAttribute("class","icon--"+this.name),r.setAttributeNS(null,"viewBox","0 0 "+i+" "+o),r.innerHTML='<use xlink:href="#'+this.name+'"></use>',r.rxcompId=e.rxcompId,(n=r.classList).add.apply(n,e.classList),e.parentNode.replaceChild(r,e)}}},n}(t.Structure);Zu.meta={selector:"svg-icon",inputs:["name","width","height"]};var tl=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),c(n,[{key:"title",set:function(e){if(this.title_!==e){this.title_=e;var n=t.getContext(this).node;e?n.setAttribute("title",e):n.removeAttribute("title")}},get:function(){return this.title_}}]),n}(t.Directive);tl.meta={selector:"[[title]]",inputs:["title"]};var el=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var i=e.prototype;return i.onInit=function(){var t=this;null===this.item.preview&&this.read$(this.item.file).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){t.item.preview=e,t.pushChanges()}))},i.read$=function(t){var e=this,i=new FileReader,o=n.fromEvent(i,"load").pipe(r.switchMap((function(t){var r=t.target.result;return e.item.type.name===Wr.Image.name?e.resize$(r):n.of(r)})));return i.readAsDataURL(t),o},i.resize$=function(t){return new Promise((function(e,n){var r=document.createElement("img");r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d"),i=r.width,o=r.height;i>o?i>320&&(o*=320/i,i=320):o>240&&(i*=240/o,o=240),t.width=i,t.height=o,n.drawImage(r,0,0,i,o);var a=t.toDataURL("image/jpeg",.9);e(a)},r.onerror=function(t){n(t)},r.src=t}))},i.onPause=function(){this.pause.next(this.item)},i.onResume=function(){this.resume.next(this.item)},i.onCancel=function(){this.cancel.next(this.item)},i.onRemove=function(){this.remove.next(this.item)},e}(t.Component);el.meta={selector:"[upload-item]",outputs:["pause","resume","cancel","remove"],inputs:["item"],template:'\n\t<div class="upload-item" [class]="{ \'error\': item.error, \'success\': item.success }">\n\t\t<div class="picture">\n\t\t\t<img [lazy]="item.preview" [size]="{ width: 320, height: 240 }" *if="item.preview && item.type.name === \'image\'" />\n\t\t\t<video [src]="item.preview" *if="item.preview && item.type.name === \'video\'"></video>\n\t\t\t<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" [class]="{ uploading: item.uploading }" *if="item.uploading"><use xlink:href="#spinner"></use></svg>\n\t\t</div>\n\t\t<div class="name">{{item.name}}</div>\n\t\t\x3c!--\n\t\t<div class="group--info">\n\t\t\t<div>progress: {{item.progress}}</div>\n\t\t\t<div>size: {{item.size}} bytes</div>\n\t\t\t<div>current speed: {{item.currentSpeed}} bytes/s</div>\n\t\t\t<div>average speed: {{item.averageSpeed}} bytes/s</div>\n\t\t\t<div>time ramining: {{item.timeRemaining}}s</div>\n\t\t\t<div>paused: {{item.paused}}</div>\n\t\t\t<div>success: {{item.success}}</div>\n\t\t\t<div>complete: {{item.complete}}</div>\n\t\t\t<div>error: {{item.error}}</div>\n\t\t</div>\n\t\t--\x3e\n\t\t\x3c!--\n\t\t<div class="group--cta" *if="!item.complete && item.uploading">\n\t\t\t<div class="btn--pause" (click)="onPause()">pause</div>\n\t\t\t<div class="btn--resume" (click)="onResume()">resume</div>\n\t\t\t<div class="btn--cancel" (click)="onCancel()">cancel</div>\n\t\t</div>\n\t\t--\x3e\n\t\t<div class="group--cta">\n\t\t\t<div class="btn--remove" (click)="onRemove()" *if="!item.complete">remove</div>\n\t\t</div>\n\t</div>\n\t'};var nl=function(e){function n(){return e.apply(this,arguments)||this}return d(n,e),n.prototype.play=function(e){var n=t.getContext(this).node;if(Hls.isSupported()){var r=new Hls;r.attachMedia(n),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(e),r.on(Hls.Events.MANIFEST_PARSED,(function(t,e){n.play()}))}))}},c(n,[{key:"hls",set:function(t){this.hls_!==t&&(this.hls_=t,this.play(t))},get:function(){return this.hls_}}]),n}(t.Directive);nl.meta={selector:"[[hls]]",inputs:["hls"]};var rl=function(t){function e(e,n,r,i,o,a,s){var c;return(c=t.call(this,s)||this)[e]=n,c[r]=i,c.index=o,c.count=a,c}return d(e,t),c(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(t.Context),il=1,ol=2,al=3,sl=4,cl=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var e=t.getContext(this),i=e.module,o=e.node,a=o.firstElementChild,s=o.getAttribute("*virtual");o.removeAttribute("*virtual"),o.removeChild(a);var c=this.tokens=this.getExpressionTokens(s);this.virtualFunction=i.makeFunction(c.iterable),this.container=o,this.template=a,this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.reverse=!0===this.reverse,this.options={width:this.width,gutter:this.gutter,reverse:this.reverse,containerWidth:0,containerHeight:0,top:0,cols:[0]},this.cachedRects={},this.cachedInstances=[],this.cacheNodes=[],this.items$=new n.BehaviorSubject([]),this.update$().pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){}))},o.onChanges=function(e){var n=t.getContext(this),r=n.module.resolve(this.virtualFunction,n.parentInstance,this)||[];this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.options.width=this.width,this.updateView(!0),this.items$.next(r)},o.update$=function(){var t=this;return this.updateView(!0),n.merge(this.scroll$(),this.resize$(),this.items$.pipe(r.distinctUntilChanged())).pipe(r.map((function(e){return t.updateForward()})))},o.updateForward=function(){var t=this,e=this.options,n=this.items$.getValue(),r=n.length;this.container.position="relative";for(var i=0,o=this.getWidth(),a=this.getGutter(o),s=[],c=0,u=n.length;c<u;c++){var l,d=n[c],h=void 0,f=void 0,p=void 0,v=void 0,m=this.cachedRects[c];if(m?(h=m.col,f=m.height,p=m.left):(h=this.getCol(),f=this.getHeight(o,d)),l=e.cols[h],this.intersect(l+e.top,l+f+e.top,0,e.containerHeight)){m||(p=this.getLeft(h,o,a));var g=this.cachedNode(c,c,d,r);g.style.position="absolute",g.style.top=l+"px",g.style.left=p+"px",g.style.width=o+"px",f!==g.offsetHeight&&(f=g.offsetHeight),v=l+f+e.gutter,i=Math.max(i,v),e.cols[h]=v,m?(m.height=f,m.bottom=v):this.cachedRects[c]={col:h,width:o,height:f,left:p,top:l,bottom:v},s.push(d)}else this.removeNode(c),v=l+f+e.gutter,e.cols[h]=v,i=Math.max(i,v)}for(var A=n.length;A<this.cacheNodes.length;)this.removeNode(A),A++;this.cacheNodes.length=n.length;var y=this.container.parentNode;if(this.reverse&&i<y.offsetHeight-1){var b=y.offsetHeight-1-i;n.forEach((function(e,n){if(-1!==s.indexOf(e)){var i=t.cachedRects[n];t.cachedNode(n,n,e,r).style.top=i.top+b+"px"}})),this.container.style.height=y.offsetHeight-1+"px"}else this.container.style.height=i+"px";return s},o.getCols=function(){var t=this.options,e=Math.floor((t.containerWidth+t.gutter)/(t.width+t.gutter))||1;return new Array(e).fill(0)},o.getCol=function(){var t,e=this.options;switch(this.mode){case ol:case al:case il:t=e.cols.reduce((function(t,e,n,r){return e<r[t]?n:t}),0);break;case sl:default:t=0}return t},o.getWidth=function(){var t,e=this.options;switch(this.mode){case ol:case al:t=e.width;break;case il:t=(e.containerWidth-(e.cols.length-1)*e.gutter)/e.cols.length;break;case sl:default:t=e.containerWidth}return t},o.getHeight=function(t,e){var n,r=this.options;switch(this.mode){case ol:case al:case il:n=r.width;break;case sl:default:n=80}return n},o.getGutter=function(t){var e,n=this.options;switch(this.mode){case ol:case al:e=n.gutter;break;case il:e=(n.containerWidth-n.cols.length*t)/(n.cols.length-1);break;case sl:default:e=0}return e},o.getLeft=function(t,e,n){var r,i=this.options;switch(this.mode){case ol:case il:r=t*(e+n);break;case al:r=(i.containerWidth-i.cols.length*(e+n)+n)/2+t*(e+n);break;case sl:default:r=0}return r},o.cachedNode=function(t,e,n,r){return this.cacheNodes[t]?this.updateNode(t,e,n):this.createNode(t,e,n,r)},o.createNode=function(e,n,r,i){var o=this.template.cloneNode(!0);delete o.rxcompId,this.container.appendChild(o),this.cacheNodes[e]=o;var a=t.getContext(this),s=a.module,c=this.tokens,u=[c.key,n,c.value,r,n,i,a.parentInstance],l=s.makeInstance(o,rl,a.selector,a.parentInstance,u),d=t.getContext(l);return s.compile(o,d.instance),this.cachedInstances[e]=l,o},o.updateNode=function(t,e,n){var r=this.cachedInstances[t],i=this.tokens;return r[i.key]!==e&&(r[i.key]=e,r[i.value]=n,r.pushChanges()),this.cacheNodes[t]},o.removeNode=function(e){this.cachedInstances[e]=void 0;var n=this.cacheNodes[e];if(n){var r=t.getContext(this).module;n.parentNode.removeChild(n),r.remove(n)}return this.cacheNodes[e]=void 0,n},o.intersect=function(t,e,n,r){return n<e&&r>t},o.resize$=function(){var t=this;return n.fromEvent(window,"resize").pipe(r.startWith((function(t){return null})),r.auditTime(100),r.tap((function(){return t.updateView(!0)})))},o.scroll$=function(){var e=this,i=t.getContext(this).node;return i.parentNode&&"auto"===getComputedStyle(i.parentNode).overflowY?n.fromEvent(i.parentNode,"scroll").pipe(r.tap((function(){e.updateView()}))):n.fromEvent(window,"scroll").pipe(r.tap((function(){return e.updateView()})))},o.updateView=function(t){var e=this.container.getBoundingClientRect(),n=this.options;n.top=e.top,n.containerWidth=e.width,n.containerHeight=this.container.parentNode.offsetHeight,n.cols=this.getCols(),t&&(this.cachedRects={})},o.getExpressionTokens=function(t){if(null===t)throw new Error("invalid virtual");if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw new Error("invalid virtual");var e=t.split(";").map((function(t){return t.trim()})).filter((function(t){return""!==t})),n=e[0].split(" of ").map((function(t){return t.trim()})),r=n[0].replace(/\s*let\s*/,""),i=n[1],o="index",a=r.match(/\[(.+)\s*,\s*(.+)\]/);if(a&&(o=a[1],r=a[2]),e.length>1){var s=e[1].split(/\s*let\s*|\s*=\s*index/).map((function(t){return t.trim()}));3===s.length&&(o=s[1])}return{key:o,value:r,iterable:i}},i}(t.Structure);cl.meta={selector:"[*virtual]",inputs:["mode","width","gutter","reverse"]};var ul=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){this.playing=!1,this.progress=0,this.media$().pipe(r.takeUntil(this.unsubscribe$)).subscribe(),this.drag$().pipe(r.takeUntil(this.unsubscribe$)).subscribe()},i.media$=function(){var e=this,n=t.getContext(this).node,i=document.querySelector(".page");return vi.events$.pipe(r.tap((function(t){t instanceof li?(e.media=t.loader,e.playing=!0,n.classList.add("active"),i.classList.add("media-player-active"),e.pushChanges()):e.media===t.loader&&(t instanceof di?(e.playing=!1,e.pushChanges()):t instanceof fi?e.dragging||(e.progress=e.media.progress,e.pushChanges()):t instanceof hi&&(e.media=null,n.classList.remove("active"),i.classList.remove("media-player-active"),e.pushChanges()))})))},i.drag$=function(){var e,n=this,i=t.getContext(this).node.querySelector(".track");return no.observe$(i).pipe(r.filter((function(t){return n.media})),r.tap((function(t){if(t instanceof Zi){var r=i.getBoundingClientRect();e=Math.max(0,Math.min(1,(t.down.x-r.left)/r.width)),n.dragging=!0}else if(t instanceof to){var o=i.getBoundingClientRect(),a=Math.max(0,Math.min(1,e+t.distance.x/o.width));n.progress=a,n.pushChanges()}else t instanceof eo&&(n.media.progress=n.progress,n.dragging=!1)})))},i.onPlay=function(){this.media.play()},i.onPause=function(){this.media.pause()},i.onTrack=function(t){var e=t.currentTarget.getBoundingClientRect(),n=(t.screenX-e.left)/e.width;this.media.progress=n},n}(t.Component);ul.meta={selector:"[media-player]"};var ll=100.99,dl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onChanges=function(){this.title=this.item.title},n.createBanner=function(){var t=this;this.getCanvasTexture().then((function(e){var n=e.texture;n.wrapS=n.wrapY=THREE.RepeatWrapping,n.repeat.x=24,n.encoding=THREE.sRGBEncoding;var r=24*e.width/e.height,i=Math.PI/180*360,o=ll*i/r,a=new THREE.CylinderBufferGeometry(ll,ll,o,80,2,!0,0,i);a.scale(-1,1,1);var s=new THREE.MeshBasicMaterial({map:n,transparent:!0,opacity:0}),c=t.mesh;(t.banners=new Array(1).fill(0).map((function(t){return new THREE.Mesh(a,s)}))).forEach((function(t,e){t.rotation.y=Math.PI/2*e}));var u={value:0};gsap.to(u,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){s.opacity=u.value,s.needsUpdate=!0}}),c.userData={render:function(){c.rotation.y+=Math.PI/180*.02,s.needsUpdate=!0}}}))},n.updateBanner=function(){this.getCanvasTexture().then((function(t){}))},n.onCreate=function(t,e){var n=new THREE.Group;"function"==typeof t&&t(n)},n.getCanvasTexture=function(){var t=this;return new Promise((function(e,n){var r,i=512,o=128,a=Math.floor(102.4),s=Math.floor(9.6);(r=t.canvas?t.canvas:t.canvas=document.createElement("canvas")).width=i,r.height=o;var c,u=t.item.title,l=r.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.font=a+"px "+de.fontFamily,i=l.measureText(u).width+8,i=Math.max(512,Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))),r.width=i,l.clearRect(0,0,i,o),l.fillStyle="#0000005A",l.fillRect(0,0,i,o),l.font=a+"px "+de.fontFamily,l.textAlign="center",l.textBaseline="middle",l.strokeStyle="rgba(0, 0, 0, 0.5)",l.lineWidth=s,l.lineJoin="round",l.miterLimit=2,l.strokeText(u,i/2,64),l.fillStyle="white",l.fillText(u,i/2,64,i),t.texture?(c=t.texture).needsUpdate=!0:c=t.texture=new THREE.CanvasTexture(r),e({texture:c,width:i,height:o})}))},c(e,[{key:"title",get:function(){return this.title_},set:function(t){if(this.title_!==t){var e=null!=this.title_;this.title_=t,e?this.updateBanner():this.createBanner()}}}]),e}(nc);dl.meta={selector:"[model-banner]",hosts:{host:ec},inputs:["item"]};var hl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){t.prototype.onInit.call(this)},n.onChanges=function(){var t=this.item.selected;this.editing=t,this.mesh&&(this.mesh.editing=t)},n.onCreate=function(t,e){var n,i,o=this,a=this.item,s=this.view,c=(s.items,this.getCurvedPanelGeometry(a));this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),Ji.getStreamId$(a).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(u){o.streamId!==u&&(o.streamId=u,i&&(i.unsubscribe(),i=null),u||!a.asset?(a.streamId=u,(n=o.disposableMesh=new Ji(a,s,c,o.host)).updateFromItem(a),n.name="curved-plane",n.load((function(){o.disposableMesh=null,"function"==typeof t&&t(n,a),i=n.events$().pipe(r.takeUntil(o.unsubscribe$)).subscribe((function(){}))})),o.addMeshListeners(n)):o.mesh&&e(o.mesh,a))}))},n.addMeshListeners=function(t){t.on("down",this.onMeshDown),t.on("playing",this.onMeshPlaying),t.on("zoomed",this.onMeshZoomed),t.on("currentTime",this.onMeshCurrentTime)},n.removeMeshListeners=function(t){t.off("down",this.onMeshDown),t.off("playing",this.onMeshPlaying),t.off("zoomed",this.onMeshZoomed),t.off("currentTime",this.onMeshCurrentTime)},n.onMeshDown=function(){this.down.next(this)},n.onMeshPlaying=function(t){this.play.next({itemId:this.item.id,playing:t})},n.onMeshZoomed=function(t){this.zoom.next({itemId:this.item.id,zoomed:t})},n.onMeshCurrentTime=function(t){this.currentTime.next({itemId:this.item.id,currentTime:t})},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())},n.onUpdate=function(t,e){if(t.radius!==this.radius_||t.height!==this.height_||t.arc!==this.arc_){e.geometry.dispose();var n=this.getCurvedPanelGeometry(t);e.geometry=n}e.updateFromItem(t),this.updateHelper()},n.onUpdateAsset=function(t,e){e.updateByItem(t),Ji.getStreamId$(t).pipe(r.filter((function(t){return null!==t})),r.take(1)).subscribe((function(n){t.streamId=n,e.load((function(){}))}))},n.onDragMove=function(t,e,n){var r=this.item,i=this.mesh;r.showPanel=!1,this.editing=!0,i.position.set(t.x,t.y,t.z),n?(t.normalize().multiplyScalar(20),i.lookAt(gi.origin)):(i.position.set(0,0,0),i.lookAt(e),i.position.set(t.x,t.y,t.z),i.position.add(e.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var t=this.item,e=this.mesh;t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray(),e.updateFromItem(t),this.editing=!1},n.getCurvedPanelGeometry=function(t){this.radius_=t.radius,this.height_=t.height,this.arc_=t.arc;var e=Math.PI/180*t.arc,n=new THREE.CylinderBufferGeometry(t.radius,t.radius,t.height,36,2,!0,0,e);return n.rotateY(-Math.PI-e/2),n.scale(-1,1,1),n},e}(rc);hl.textures={},hl.meta={selector:"[model-curved-plane]",hosts:{host:ec},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};var fl=function(){function t(){if(t.service_)throw"DebugService is a singleton class!";this.message$=new n.BehaviorSubject(null)}return t.getService=function(){return this.service_||(this.service_=new t),this.service_},c(t,[{key:"message",get:function(){return this.message$.getValue()}}]),t.prototype.setMessage=function(t){this.message!==t&&this.message$.next(t)},t}(),pl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t),e.getLoader=function(){return e.loader||(e.loader=new THREE.FontLoader)},e.getFontLoader=function(t){return e.fontLoader||(e.fontLoader=e.getLoader().load(de.getPath("fonts/helvetiker/helvetiker_regular.typeface.json"),t))};var n=e.prototype;return n.onInit=function(){var e=this;t.prototype.onInit.call(this),(this.vrService=ko.getService()).session$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){t?e.text&&e.textGroup.add(e.text):e.text&&e.text.parent.remove(e.text)})),(this.debugService=fl.getService()).message$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.message=t}))},n.createText=function(){var t=document.createElement("canvas");t.width=e.W,t.height=e.H;var n=new THREE.CanvasTexture(t);n.encoding=THREE.sRGBEncoding,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.needsUpdate=!0;var r=new THREE.PlaneBufferGeometry(4,1,2,2),i=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:n,color:16777215,transparent:!0,opacity:1}),o=new THREE.Mesh(r,i);return o.renderOrder=de.renderOrder.debug,o.position.y=0,o},n.loadFont=function(){var t=this;this.fontLoader=e.getFontLoader((function(e){t.font=e,t.message_&&t.setText(t.message_)}))},n.onCreate=function(t,e){var n=this.textGroup=new THREE.Group;this.material=new THREE.MeshBasicMaterial({depthTest:!1,color:16777215,transparent:!0,opacity:1,side:THREE.DoubleSide}),this.text=this.createText();"function"==typeof t&&t(n)},n.render=function(t,e){var n=this.group,r=this.host.camera,i=this.position;this.host.renderer.xr.isPresenting&&(r=this.host.renderer.xr.getCamera(r)),r.getWorldDirection(i),i.multiplyScalar(3),n.position.copy(i),n.lookAt(gi.origin)},n.setText=function(t){var n=this.text;if(n)if(this.host.renderer.xr.isPresenting&&null!=t){var r=n.material.map.image.getContext("2d");r.clearRect(0,0,e.W,e.H),r.font="30px "+de.fontFamily,r.textBaseline="middle",r.textAlign="center",r.fillStyle="#FFFFFF",r.strokeStyle="#000000",r.lineWidth=5,r.fillText(t,e.W/2,e.H/2,e.W-20),n.material.map.needsUpdate=!0,this.textGroup.add(n)}else n.parent&&n.parent.remove(n)},c(e,[{key:"message",get:function(){return this.message_},set:function(t){t=t&&""!==t?t:null,this.message_!==t&&(this.message_=t,this.setText(t))}}]),e}(nc);pl.W=1024,pl.H=256,pl.meta={selector:"[model-debug]",hosts:{host:ec}};var vl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t),e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getTexture=function(){return e.texture||(e.texture=e.getLoader().load(de.getPath("textures/ui/floor-nav.png")))},e.getOverTexture=function(){return e.textureOver||(e.textureOver=e.getLoader().load(de.getPath("textures/ui/floor-nav-over.png")))};var n=e.prototype;return n.getCoords=function(t){var n=e.RADIUS/10,r=Math.ceil((t.x+n/2)/n)-1,i=Math.ceil((t.z+n/2)/n)-1,o=Math.floor(e.COLS/2),a=Math.floor(e.ROWS/2),s=Math.min(o,Math.abs(r))*(r?Math.abs(r)/r:1),c=Math.min(a,Math.abs(i))*(i?Math.abs(i)/i:1);if(this.view.hasTile(this.indices.x+s,this.indices.y+c))return new THREE.Vector2(s,c)},n.onInit=function(){var e=this;t.prototype.onInit.call(this),this.indices=new THREE.Vector2,this.view.index$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){e.moveToIndex(t)}))},n.addTiles=function(t){var n=this,r=e.RADIUS/10,i=.9*r,o=new THREE.PlaneBufferGeometry(i,i,2,2);o.rotateX(-Math.PI/2);var a=e.getTexture();a.disposable=!1,a.encoding=THREE.sRGBEncoding;var s=e.getOverTexture();s.disposable=!1,s.encoding=THREE.sRGBEncoding;var c=this.tileMap={};this.tiles=new Array(e.COLS*e.ROWS).fill(0).map((function(i,u){var l=new THREE.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform float opacity;\nuniform float tween;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = mix(colorA, colorB, tween);\n\tcolor.a = clamp(color.a * opacity, 0.0, 1.0);\n\tcolor.rgb /= color.a;\n\tgl_FragColor = color;\n}\n",uniforms:{textureA:{type:"t",value:a},textureB:{type:"t",value:s},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}}),d=new THREE.Mesh(o,l),h=Math.floor(e.COLS/2),f=Math.floor(e.ROWS/2),p=Math.floor(u/e.COLS),v=-h+u%e.COLS,m=-f+p;d.position.set(v*r,.15*-e.RADIUS,m*r),d.name=n.getName("tile_"+v+"_"+m);d.uniforms={tween:0,opacity:0,ci:v,ri:m};return c[v+"_"+m]=d,t.add(d),d}));this.showTiles()},n.showTiles=function(){var t=this;this.tiles.forEach((function(e,n){var r=t.indices?t.indices.x:0,i=t.indices?t.indices.y:0,o=t.view.hasTile(r+e.uniforms.ci,i+e.uniforms.ri),a=e.uniforms;gsap.to(a,{opacity:o?1:0,duration:.4,ease:Power2.easeInOut,onUpdate:function(){e.material.uniforms.opacity.value=a.opacity,e.material.needsUpdate=!0}})}))},n.addHitArea=function(t){this.onGroundOver=this.onGroundOver.bind(this),this.onGroundMove=this.onGroundMove.bind(this),this.onGroundDown=this.onGroundDown.bind(this),this.onGroundOut=this.onGroundOut.bind(this);var n=new THREE.PlaneBufferGeometry(e.RADIUS,e.RADIUS,8,8);n.rotateX(-Math.PI/2);var r=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0}),i=this.ground=new wi(n,r);i.name=this.getName("ground"),i.position.set(0,.15*-e.RADIUS,0),i.on("over",this.onGroundOver),i.on("move",this.onGroundMove),i.on("out",this.onGroundOut),i.on("down",this.onGroundDown),t.add(i)},n.onGroundOver=function(){var t=this.ground,e=this.getCoords(t.intersection.point);this.coords=e},n.onGroundMove=function(){var t=this.ground,e=this.getCoords(t.intersection.point);this.coords=e},n.onGroundDown=function(){var t=this.ground,e=this.getCoords(t.intersection.point);if(this.coords=e,e){var n=this.view.getTileIndex(this.indices.x+e.x,this.indices.y+e.y);this.view.index=n,this.nav.next(n)}},n.onGroundOut=function(){this.coords=null},n.moveToIndex=function(t){this.coords=null;var n=this.view.tiles[t],r=new THREE.Vector2(n.indices.x-this.indices.x,n.indices.y-this.indices.y);this.indices.x=n.indices.x,this.indices.y=n.indices.y,this.showTiles();var i=e.RADIUS/10;this.move.next({indices:this.indices,coords:r,position:r.clone().multiplyScalar(i)})},n.onCreate=function(t,e){var n=new THREE.Group;this.addTiles(n),this.addHitArea(n),"function"==typeof t&&t(n)},n.onDestroy=function(){t.prototype.onDestroy.call(this);var e=this.ground;e.off("over",this.onGroundOver),e.off("move",this.onGroundMove),e.off("down",this.onGroundDown),e.off("out",this.onGroundOut)},c(e,[{key:"coords",set:function(t){if(!t&&this.coords_!==t||!this.coords_||t.x!==this.coords_.x||t.y!==this.coords_.y){var e=this.tileMap;if(this.coords_){var n=e[this.coords_.x+"_"+this.coords_.y],r=n.uniforms;gsap.to(r,{tween:0,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:function(){n.material.uniforms.tween.value=r.tween,n.material.needsUpdate=!0}})}if(t){var i=this.currentTile=e[t.x+"_"+t.y],o=i.uniforms;gsap.to(o,{tween:1,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:function(){i.material.uniforms.tween.value=o.tween,i.material.needsUpdate=!0}})}this.coords_=t}}},{key:"coords__",set:function(t){if(!t&&this.coords_!==t||!this.coords_||t.x!==this.coords_.x||t.y!==this.coords_.y){var e=this.tileMap;if(this.coords_){var n=e[this.coords_.x+"_"+this.coords_.y],r={tween:1};gsap.to(r,{duration:.4,tween:0,delay:0,ease:Power2.easeInOut,onUpdate:function(){n.material.opacity=r.tween}})}if(t){var i=this.currentTile=e[t.x+"_"+t.y],o={tween:0};gsap.to(o,{duration:.4,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){i.material.opacity=o.tween}})}this.coords_=t}}}]),e}(nc);vl.RADIUS=101,vl.COLS=11,vl.ROWS=11,vl.meta={selector:"[model-grid]",hosts:{host:ec},outputs:["move","nav"],inputs:["view"]};var ml=function(t){function e(n,r,i){var o,a=e.geometry,s=e.material;(o=t.call(this,a,s)||this).renderOrder=de.renderOrder.menu,o.name=n.name,o.item=n,o.index=r,o.total=i,o.tween=0,o.opacity=0;var c=o.textureA=o.getTextureA(n.name);s.uniforms.textureA.value=c,s.uniforms.resolutionA.value=new THREE.Vector2(c.width,c.height);var u=o.textureB=o.getTextureB(n.name);return s.uniforms.textureB.value=u,s.uniforms.resolutionA.value=new THREE.Vector2(u.width,u.height),s.uniforms.tween.value=o.tween,s.uniforms.opacity.value=o.opacity,s.needsUpdate=!0,o.position.set(e.getX(r,i),e.getY(r,i),0),o.onOver=o.onOver.bind(h(o)),o.onOut=o.onOut.bind(h(o)),o}d(e,t),e.getGrid=function(t){var n=Math.ceil(t/e.ROWS);return[Math.ceil(t/n),n]},e.getX=function(t,n){var r=Math.ceil(n/e.ROWS),i=t%r,o=1/e.W*(e.W+e.G);return o/2-r*o/2+i*o},e.getY=function(t,n){var r=Math.ceil(n/e.ROWS),i=Math.ceil(n/r),o=Math.floor(t/r),a=1/e.W*(e.H+e.G);return i*a/2-a/2+o*-a},c(e,null,[{key:"geometry",get:function(){if(this.geometry_)return this.geometry_;var t=new THREE.PlaneBufferGeometry(1,1/e.W*e.H,2,2);return this.geometry_=t,t}},{key:"material",get:function(){return new THREE.ShaderMaterial({depthTest:!1,transparent:!0,vertexShader:Al.VERTEX_SHADER,fragmentShader:Al.FRAGMENT_SHADER,uniforms:{textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}})}}]);var n=e.prototype;return n.getTextureA=function(t){var n=e.W,r=e.H,i=document.createElement("canvas");i.width=n,i.height=r;var o=i.getContext("2d");o.fillStyle=de.colors.menuBackground,o.fillRect(0,0,n,r),o.font="20px "+de.fontFamily,o.fillStyle=de.colors.menuForeground,o.fillText(t,10,50,n-20);var a=new THREE.CanvasTexture(i);return a.minFilter=THREE.LinearFilter,a.magFilter=THREE.LinearFilter,a.mapping=THREE.UVMapping,a.encoding=THREE.sRGBEncoding,a.needsUpdate=!0,a},n.getTextureB=function(t){var n=e.W,r=e.H,i=document.createElement("canvas");i.width=n,i.height=r;var o=i.getContext("2d");o.fillStyle=de.colors.menuOverBackground,o.fillRect(0,0,n,r),o.font="20px "+de.fontFamily,o.fillStyle=de.colors.menuOverForeground,o.fillText(t,10,50,n-20);var a=new THREE.CanvasTexture(i);return a.encoding=THREE.sRGBEncoding,a.magFilter=THREE.LinearFilter,a.needsUpdate=!0,a},n.onOver=function(){var t=this;gsap.to(this,{duration:.4,tween:1,ease:Power2.easeOut,onUpdate:function(){t.position.z=.1*t.tween,t.material.uniforms.tween.value=t.tween,t.material.needsUpdate=!0}})},n.onOut=function(){var t=this;gsap.to(this,{duration:.4,tween:0,ease:Power2.easeOut,onUpdate:function(){t.position.z=.1*t.tween,t.material.uniforms.tween.value=t.tween,t.material.needsUpdate=!0}})},n.dispose=function(){Ai.dispose(this),this.textureA.dispose(),this.textureB.dispose(),this.material.dispose(),this.geometry.dispose()},e}(wi);ml.W=256,ml.H=64,ml.G=2,ml.ROWS=6;var gl=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}d(e,t);var n=e.prototype;return n.getTextureA=function(t){var e=ml.W,n=ml.H,r=document.createElement("canvas");r.width=e,r.height=n;var i=r.getContext("2d");i.fillStyle=de.colors.menuBackBackground,i.fillRect(0,0,e,n),i.font="20px "+de.fontFamily,i.fillStyle=de.colors.menuBackForeground,i.fillText(t,10,50,e-20);var o=new THREE.CanvasTexture(r);return o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,o.mapping=THREE.UVMapping,o.needsUpdate=!0,o},n.getTextureB=function(t){var e=ml.W,n=ml.H,r=document.createElement("canvas");r.width=e,r.height=n;var i=r.getContext("2d");i.fillStyle=de.colors.menuBackOverBackground,i.fillRect(0,0,e,n),i.font="20px "+de.fontFamily,i.fillStyle=de.colors.menuBackOverForeground,i.fillText(t,10,50,e-20);var o=new THREE.CanvasTexture(r);return o.encoding=THREE.sRGBEncoding,o.magFilter=THREE.LinearFilter,o.needsUpdate=!0,o},e}(ml),Al=function(e){function i(){return e.apply(this,arguments)||this}d(i,e);var o=i.prototype;return o.onInit=function(){var n=this;e.prototype.onInit.call(this),this.onDown=this.onDown.bind(this),this.onToggle=this.onToggle.bind(this);var i=t.getContext(this).node;this.progressIndicator=i.querySelector(".progress circle"),Si.progress$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){n.loading=t.count>0;var e=144.51;t.count&&(e=144.51*(1-t.value)),gsap.set(n.progressIndicator,{strokeDashoffset:e})})),Ln.in$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case un:n.onToggle()}}))},o.onDestroy=function(){this.buttons&&this.buttons.forEach((function(t){return Ai.dispose(t)})),e.prototype.onDestroy.call(this)},o.getContainer=function(){return this.host.cameraGroup},o.onCreate=function(t,e){var n=this.menuGroup=new THREE.Group;"function"==typeof t&&t(n)},o.render=function(t,e){var n=this.group,r=(this.host.cameraGroup,this.host.camera),i=this.position;if(this.host.renderer.xr.isPresenting)(r=this.host.renderer.xr.getCamera(r)).getWorldDirection(i),i.y+=.5,i.multiplyScalar(3),this.host.cameraGroup.worldToLocal(i),i.y+=this.host.cameraGroup.position.y,n.position.copy(i),n.scale.set(1,1,1),n.lookAt(gi.origin);else{r.getWorldDirection(i),fo.mode===io?i.multiplyScalar(.01):i.multiplyScalar(3),n.position.copy(i);var o=1/r.zoom;n.scale.set(o,o,o),n.lookAt(gi.origin)}},o.items$=function(t){var e=this;return void 0===t&&(t=null),t?n.of(t.items):this.rootItems?n.of(this.rootItems):qc.getModelMenu$(this.views,this.editor).pipe(r.first(),r.tap((function(t){e.editor||(e.rootItems=t)})))},o.addMenu=function(t){var e=this;void 0===t&&(t=null),this.removeMenu(),t&&"menu-group"!==t.type.name?this.nav.next(t):(qc.active=!0,this.items$(t).pipe(r.first()).subscribe((function(n){if(n){n=n.slice();var r={type:{name:"back"},name:t?"Back":"Close",backItem:t};n.push(r);var i=e.buttons=n.map((function(e,n,r){return e.backItem=t,"back"===e.type.name?new gl(e,n,r.length):new ml(e,n,r.length)}));i.forEach((function(t){t.depthTest=!1,t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",e.onDown),e.menuGroup.add(t)})),gsap.to(i,{duration:.3,opacity:.8,ease:Power2.easeOut,stagger:{grid:ml.getGrid(i.length),from:0,amount:.02*i.length},onUpdate:function(){i.forEach((function(t){t.material.uniforms.opacity.value=t.opacity*(t.item.hidden?.5:1)}))}})}})))},o.removeMenu=function(){qc.active=!1,this.removeButtons(),this.removeToggler()},o.removeButtons=function(){var t=this,e=this.buttons;e&&e.forEach((function(e){t.menuGroup.remove(e),e.off("over",e.onOver),e.off("out",e.onOut),e.off("down",t.onDown),e.dispose()})),this.buttons=null},o.addToggler=function(){this.removeMenu();var t=this.toggler=new ml({type:{name:"menu"},name:"Menu"},0,1);t.opacity=.8,t.material.uniforms.opacity.value=t.opacity,t.material.needsUpdate=!0,t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",this.onToggle),this.menuGroup.add(t)},o.removeToggler=function(){var t=this.toggler;t&&(this.menuGroup.remove(t),t.off("over",t.onOver),t.off("out",t.onOut),t.off("down",this.onToggle),t.dispose()),this.toggler=null},o.onDown=function(t){t.item&&"back"===t.item.type.name?(this.removeMenu(),t.item.backItem?this.addMenu(t.item.backItem.backItem):this.toggle.next()):this.addMenu(t.item)},o.onToggle=function(t){t&&(t.preventDefault(),t.stopImmediatePropagation()),this.locked||(qc.active?(this.removeMenu(),this.toggle.next()):(this.addMenu(),this.toggle.next(this)))},c(i,[{key:"controlled",get:function(){return zt.state.controlling&&zt.state.controlling!==zt.state.uid}},{key:"controlling",get:function(){return zt.state.controlling&&zt.state.controlling===zt.state.uid}},{key:"silencing",get:function(){return zt.state.silencing}},{key:"silenced",get:function(){return zt.state.silencing&&zt.state.role===qt.Streamer}},{key:"spyed",get:function(){return zt.state.spying&&zt.state.spying===zt.state.uid}},{key:"spying",get:function(){return zt.state.spying&&zt.state.spying!==zt.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"loading",get:function(){return this.loading_},set:function(e){this.loading_!==e&&(this.loading_=e,t.getContext(this).node.querySelector(".btn--menu").classList.toggle("loading",e))}}]),i}(nc);Al.VERTEX_SHADER="\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",Al.FRAGMENT_SHADER="\nvarying vec2 vUv;\nuniform float opacity;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = vec4(mix(colorA.rgb, colorB.rgb, tween), opacity);\n\tgl_FragColor = color;\n}\n",Al.meta={selector:"[model-menu]",hosts:{host:ec},outputs:["nav","toggle"],inputs:["views","editor"]};var yl=THREE,bl=yl.BufferAttribute,wl=yl.BufferGeometry,El=yl.FileLoader,_l=yl.Loader,Sl=new WeakMap,Tl=function(t){function e(e){var n;return(n=t.call(this,e)||this).decoderPath="",n.decoderConfig={},n.decoderBinary=null,n.decoderPending=null,n.workerLimit=4,n.workerPool=[],n.workerNextTaskID=1,n.workerSourceURL="",n.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},n.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},n}d(e,t);var n=e.prototype;return n.setDecoderPath=function(t){return this.decoderPath=t,this},n.setDecoderConfig=function(t){return this.decoderConfig=t,this},n.setWorkerLimit=function(t){return this.workerLimit=t,this},n.load=function(t,e,n,r){var i=this,o=new El(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(t){var n={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(t,n).then(e).catch(r)}),n,r)},n.decodeDracoFile=function(t,e,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,i).then(e)},n.decodeGeometry=function(t,e){var n=this;for(var r in e.attributeTypes){var i=e.attributeTypes[r];void 0!==i.BYTES_PER_ELEMENT&&(e.attributeTypes[r]=i.name)}var o,a=JSON.stringify(e);if(Sl.has(t)){var s=Sl.get(t);if(s.key===a)return s.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var c=this.workerNextTaskID++,u=t.byteLength,l=this._getWorker(c,u).then((function(n){return o=n,new Promise((function(n,r){o._callbacks[c]={resolve:n,reject:r},o.postMessage({type:"decode",id:c,taskConfig:e,buffer:t},[t])}))})).then((function(t){return n._createGeometry(t.geometry)}));return l.catch((function(){return!0})).then((function(){o&&c&&n._releaseTask(o,c)})),Sl.set(t,{key:a,promise:l}),l},n._createGeometry=function(t){var e=new wl;t.index&&e.setIndex(new bl(t.index.array,1));for(var n=0;n<t.attributes.length;n++){var r=t.attributes[n],i=r.name,o=r.array,a=r.itemSize;e.setAttribute(i,new bl(o,a))}return e},n._loadLibrary=function(t,e){var n=new El(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise((function(e,r){n.load(t,e,void 0,r)}))},n.preload=function(){return this._initDecoder(),this},n._initDecoder=function(){var t=this;if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];e||(t.decoderConfig.wasmBinary=n[1]);var i=Cl.toString(),o=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");t.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending},n._getWorker=function(t,e){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(t){var e=t.data;switch(e.type){case"decode":r._callbacks[e.id].resolve(e);break;case"error":r._callbacks[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));var i=n.workerPool[n.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))},n._releaseTask=function(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]},n.debug=function(){console.log("Task load: ",this.workerPool.map((function(t){return t._taskLoad})))},n.dispose=function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this},e}(_l);function Cl(){var t,e;function n(t,e,n,r,i,o){var a=o.num_components(),s=n.num_points()*a,c=s*i.BYTES_PER_ELEMENT,u=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,i),l=t._malloc(c);e.GetAttributeDataArrayForAllPoints(n,o,u,c,l);var d=new i(t.HEAPF32.buffer,l,s).slice();return t._free(l),{name:r,array:d,itemSize:a}}onmessage=function(r){var i=r.data;switch(i.type){case"init":t=i.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":var o=i.buffer,a=i.taskConfig;e.then((function(t){var e=t.draco,r=new e.Decoder,s=new e.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var c=function(t,e,r,i){var o,a,s=i.attributeIDs,c=i.attributeTypes,u=e.GetEncodedGeometryType(r);if(u===t.TRIANGULAR_MESH)o=new t.Mesh,a=e.DecodeBufferToMesh(r,o);else{if(u!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,a=e.DecodeBufferToPointCloud(r,o)}if(!a.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var l={index:null,attributes:[]};for(var d in s){var h=self[c[d]],f=void 0,p=void 0;if(i.useUniqueIDs)p=s[d],f=e.GetAttributeByUniqueId(o,p);else{if(-1===(p=e.GetAttributeId(o,t[s[d]])))continue;f=e.GetAttribute(o,p)}l.attributes.push(n(t,e,o,d,h,f))}u===t.TRIANGULAR_MESH&&(l.index=function(t,e,n){var r=3*n.num_faces(),i=4*r,o=t._malloc(i);e.GetTrianglesUInt32Array(n,i,o);var a=new Uint32Array(t.HEAPF32.buffer,o,r).slice();return t._free(o),{array:a,itemSize:1}}(t,e,o));return t.destroy(o),l}(e,r,s,a),u=c.attributes.map((function(t){return t.array.buffer}));c.index&&u.push(c.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:c},u)}catch(t){console.error(t),self.postMessage({type:"error",id:i.id,error:t.message})}finally{e.destroy(s),e.destroy(r)}}))}}}var xl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var e=this;t.prototype.onInit.call(this),this.isPresenting=!1,qc.active$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.freezed=t}))},n.onChanges=function(){this.editing=this.item.selected},n.onCreate=function(t,e){var n=this;this.loadGlb(de.getPath(this.item.asset.folder),this.item.asset.file,(function(r,i){n.onGlbLoaded(r,i,t,e)}))},n.loadGlb=function(t,e,n){this.host.renderer;var r=Si.getRef(),i=(new qa).setPath(t),o=de.dist+"js/draco/",a=new Tl;a.setDecoderPath(o),i.setDRACOLoader(a),i.load(e,(function(t){"function"==typeof n&&n(t.scene,t.animations),Si.setProgress(r,1)}),(function(t){Si.setProgress(r,t.loaded,t.total)}))},n.onGlbLoaded=function(t,e,n,r){var i=this;this.parseAnimations(t,e);var o,a=(new THREE.Box3).setFromObject(t),s=a.max.clone().sub(a.min),c=1.7/Math.max(s.x,s.y,s.z);t.scale.set(c,c,c);var u=this.view,l=this.item;if(u.type.name===pr.Model.name){(o=new THREE.Group).add(t),a.setFromObject(o);var d=a.getCenter(new THREE.Vector3);o.position.set(t.position.x-d.x,t.position.y-d.y,t.position.z-d.z+(this.host.renderer.xr.isPresenting?-2:0));var h=o.position.y,f={tween:1},p=function(){o.position.y=h+3*f.tween,o.rotation.y=0+Math.PI*f.tween};p(),this.makeInteractive(t),gsap.to(f,{duration:1.5,tween:0,delay:.1,ease:Power2.easeInOut,onUpdate:p,onComplete:function(){i.updateHelper()}})}else{a.setFromObject(t);var v=a.getCenter(new THREE.Vector3);t.position.set(-v.x,-v.y,-v.z),(o=new THREE.Group).add(t),l.position&&o.position.fromArray(l.position),l.rotation&&o.rotation.fromArray(l.rotation),l.scale&&o.scale.fromArray(l.scale),this.makeInteractive(t),this.updateHelper()}"function"==typeof n&&(n(o,this.item),this.freezed=qc.active)},n.parseAnimations=function(t,e){this.actionIndex=-1;var n=this.actions=[];if(e&&e.length){this.clock=new THREE.Clock;var r=this.mixer=new THREE.AnimationMixer(t);r.timeScale=1,e.forEach((function(t){var e=r.clipAction(t);e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.setLoop(THREE.LoopRepeat),n.push(e)}))}},n.onClipToggle=function(){var t,e=this.actions;1===e.length?(t=-1===this.actionIndex?0:-1,this.setSingleAction(t)):e.length>1&&((t=this.actionIndex+1)===e.length&&(t=-1),this.setMultiAction(t)),this.play.next({itemId:this.item.id,actionIndex:t})},n.setSingleAction=function(t){if(this.actionIndex!==t){this.actionIndex=t;var e=this.actions[0];0===t?e.paused||0===e.timeScale?e.paused=!1:e.play():-1===t&&e.halt(.3)}},n.setMultiAction=function(t){if(this.actionIndex!==t){var e=this.actions,n=this.actionIndex>-1?e[this.actionIndex]:null;if(this.actionIndex=t,n&&n.halt(.3),t>-1){var r=e[t];r.paused&&(r.paused=!1),0===r.timeScale&&(r.timeScale=1),r.play()}}},n.onMessage=function(t){switch(t.type){case $e:var e=this.actions;1===e.length?this.setSingleAction(t.actionIndex):e.length>1&&this.setMultiAction(t.actionIndex)}},n.render=function(t,e){var n=this.view,r=(this.item,this.mesh),i=this.host.renderer.xr.isPresenting;this.group;r&&(n.type.name===pr.Model.name?(this.isPresenting!==i&&(this.isPresenting=i,i?(r.position.x=0,r.position.y=0,r.position.z=-2,r.rotation.y=0):(r.position.x=0,r.position.y=0,r.position.z=0,r.rotation.y=0)),i&&(r.rotation.y-=Math.PI/180/60*5)):i&&(r.rotation.y-=Math.PI/180/60*5));var o=this.mixer,a=this.clock;if(o){var s=a.getDelta();o.update(s)}},n.onUpdate=function(t,e){this.view.type.name!==pr.Model.name&&(t.position&&e.position.fromArray(t.position),t.rotation&&e.rotation.fromArray(t.rotation),t.scale&&e.scale.fromArray(t.scale)),this.updateHelper()},n.onUpdateAsset=function(t,e){var n=this;this.loadGlb(de.getPath(t.asset.folder),t.asset.file,(function(t,e){n.onGlbLoaded(t,e,(function(t,e){return n.onMount(t,e)}),(function(t,e){return n.onDismount(t,e)}))}))},n.onDragMove=function(t,e,n){n&&t.normalize().multiplyScalar(4),this.editing=!0,this.view.type.name!==pr.Model.name&&this.mesh.position.set(t.x,t.y,t.z),this.updateHelper()},n.onDragEnd=function(){this.view.type.name!==pr.Model.name&&(this.item.position=this.mesh.position.toArray(),this.item.rotation=this.mesh.rotation.toArray(),this.item.scale=this.mesh.scale.toArray()),this.editing=!1},e.getInteractiveDescriptors=function(){var t=e.interactiveDescriptors;if(!t){var n=Object.getOwnPropertyDescriptors(yi.prototype),r=Object.getOwnPropertyDescriptors(bi.prototype),i=Object.getOwnPropertyDescriptors(wi.prototype);t=Object.assign({},n,r,i),e.interactiveDescriptors=t}return t},n.makeInteractive=function(t){var n=this,r=e.getInteractiveDescriptors();t.traverse((function(t){t.isMesh&&(Object.keys(r).forEach((function(e){"constructor"!==e&&Object.defineProperty(t,e,r[e])})),t.freezed=!1,t.events={},t.depthTest=!0,t.over_=!1,t.down_=!1,Ai.items.push(t),t.on("down",(function(){n.onClipToggle(),n.down.next(n)})))}))},c(e,[{key:"freezed",get:function(){return this.freezed_},set:function(t){if(this.freezed_!==t){this.freezed_=t;var e=this.mesh;e&&e.traverse((function(e){e.isInteractiveMesh&&(e.freezed=t)}))}}}]),e}(rc);xl.meta={selector:"[model-model]",hosts:{host:ec},outputs:["down","play"],inputs:["item","view"]};var Rl=function(t){function e(e){var n;return(n=t.call(this,e)||this).depthTest=!0,n.over_=!1,n.down_=!1,Ai.items.push(h(n)),n}return d(e,t),c(e,[{key:"isInteractiveSprite",get:function(){return!0}},{key:"over",get:function(){return this.over_},set:function(t){this.over_!=t&&(this.over_=t,t?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(t){t=t&&this.over,this.down_!=t&&(this.down_=t,t?this.emit("down",this):this.emit("up",this))}}]),e}(function(t){function e(e){var n;return e=e||new THREE.SpriteMaterial({color:16711935}),(n=t.call(this,e)||this).events={},n}d(e,t);var n=e.prototype;return n.on=function(t,e){var n=this,r=this.events[t]=this.events[t]||[];return r.push(e),function(){n.events[t]=r.filter((function(t){return t!==e}))}},n.off=function(t,e){var n=this.events[t];n&&(this.events[t]=n.filter((function(t){return t!==e})))},n.emit=function(t,e){var n=this.events[t];n&&n.forEach((function(t){t(e)}));var r=this.events.broadcast;r&&r.forEach((function(n){n(t,e)}))},e}(function(t){function e(e){var n;return e=e||new THREE.SpriteMaterial({color:16711935}),(n=t.call(this,e)||this).freezed=!1,n}d(e,t),c(e,[{key:"freezed",get:function(){return this.freezed_},set:function(t){this.freezed_=t,this.children.filter((function(t){return t.__lookupGetter__("freezed")})).forEach((function(e){return e.freezed=t}))}}]);var n=e.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},e}(THREE.Sprite))),Il=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){e.prototype.onInit.call(this)},r.onView=function(){var e=this;if(!this.viewed){this.viewed=!0;var r=t.getContext(this).node;this.getCanvasTexture(r).then((function(t){if(e.mesh){var i=.2*(e.item.asset?1.5:1),o=t.width/t.height,a=n.PANEL_RADIUS*i,s=n.PANEL_RADIUS*i/o,c=.25*a,u=e.item.mesh.position.normalize().multiplyScalar(n.PANEL_RADIUS),l=new THREE.SpriteMaterial({depthTest:!1,transparent:!0,opacity:0,map:t.map,sizeAttenuation:!1}),d=e.panel=new Rl(l);d.renderOrder=de.renderOrder.panel,d.scale.set(.02*a,.02*s,1),d.position.set(u.x,u.y+(s+2*c),u.z),d.on("down",(function(t){var n={x:parseInt(t.intersection.uv.x*r.offsetWidth),y:parseInt((1-t.intersection.uv.y)*r.offsetHeight)},i=Array.prototype.slice.call(r.querySelectorAll(".panel__link")).find((function(t){return n.x>=t.offsetLeft&&n.y>=t.offsetTop&&n.x<=t.offsetLeft+t.offsetWidth&&n.y<=t.offsetTop+t.offsetHeight}));if(i){e.down.next(e.item);var o=r.getBoundingClientRect(),a=new MouseEvent("mouseup",{button:0,buttons:0,clientX:n.x+o.left,clientY:n.y+o.top,movementX:0,movementY:0,relatedTarget:i,screenX:n.x,screenY:n.y});i.dispatchEvent(a),setTimeout((function(){no.dismissEvent(a,no.events$,no.dismiss$,no.downEvent)}),1)}})),e.mesh.add(d);var h={value:0};gsap.to(h,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){d.position.set(u.x,u.y+(s+2*c)-c*h.value,u.z),d.lookAt(gi.origin),d.material.opacity=h.value,d.material.needsUpdate=!0}})}}),(function(t){console.log("ModelPanelComponent.getCanvasTexture.error",t)}))}},r.onCreate=function(t,e){var n=new THREE.Group;"function"==typeof t&&t(n)},r.onDestroy=function(){e.prototype.onDestroy.call(this)},r.imagesLoaded=function(){var e=t.getContext(this).node;if(e){var n=Array.prototype.slice.call(e.querySelectorAll("img")).map((function(t){return new Promise((function(e,n){var r=t.src&&-1===t.src.indexOf(location.origin);if(t.complete)return setTimeout((function(){e(r)}),10);var i=function(){t.removeEventListener("load",o),t.removeEventListener("error",a)},o=function(){i(),setTimeout((function(){e(r)}),10)},a=function(){i(),e(!1)};t.addEventListener("load",o),t.addEventListener("error",a)}))}));return n.length?Promise.all(n):Promise.resolve()}},r.getCanvasTexture=function(e){var n=this;return new Promise((function(r,o){setTimeout((function(){n.item.panelTexture?r(n.item.panelTexture):n.imagesLoaded().then((function(a){var s=t.getContext(n);if(s&&s.node){e=s.node;var c=a&&null!=a.find((function(t){return!0===t}));i(e,{backgroundColor:"#ffffff00",scale:2,useCORS:c}).then((function(t){var e=new THREE.CanvasTexture(t);n.item.panelTexture={map:e,width:t.width,height:t.height},r(n.item.panelTexture)}),(function(t){o(t)}))}}))}),1)}))},n}(nc);Il.PANEL_RADIUS=99,Il.meta={selector:"[model-panel]",hosts:{host:ec},outputs:["over","out","down"],inputs:["item"]};var Ol=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){t.prototype.onInit.call(this)},n.onCreate=function(t,e){var n=new THREE.Group;"function"==typeof t&&t(n)},e}(nc);Ol.meta={selector:"[model-picture]",hosts:{host:ec},inputs:["item"]};var Ml=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){t.prototype.onInit.call(this)},n.onChanges=function(){var t=this.item.selected;this.editing=t,this.mesh&&(this.mesh.editing=t)},n.onCreate=function(t,e){var n,i,o=this,a=this.item,s=this.view,c=(s.items,mi.planeGeometry);this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),Ji.getStreamId$(a).pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(u){o.streamId!==u&&(o.streamId=u,i&&(i.unsubscribe(),i=null),u||!a.asset?(a.streamId=u,(n=o.disposableMesh=new Ji(a,s,c,o.host)).updateFromItem(a),n.name="plane",n.load((function(){o.disposableMesh=null,"function"==typeof t&&t(n,a),i=n.events$().pipe(r.takeUntil(o.unsubscribe$)).subscribe((function(){}))})),o.addMeshListeners(n)):o.mesh&&e(o.mesh,a))}))},n.addMeshListeners=function(t){t.on("down",this.onMeshDown),t.on("playing",this.onMeshPlaying),t.on("zoomed",this.onMeshZoomed),t.on("currentTime",this.onMeshCurrentTime)},n.removeMeshListeners=function(t){t.off("down",this.onMeshDown),t.off("playing",this.onMeshPlaying),t.off("zoomed",this.onMeshZoomed),t.off("currentTime",this.onMeshCurrentTime)},n.onMeshDown=function(){this.down.next(this)},n.onMeshPlaying=function(t){this.play.next({itemId:this.item.id,playing:t})},n.onMeshZoomed=function(t){this.zoom.next({itemId:this.item.id,zoomed:t})},n.onMeshCurrentTime=function(t){this.currentTime.next({itemId:this.item.id,currentTime:t})},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())},n.onUpdate=function(t,e){e.updateFromItem(t),this.updateHelper()},n.onUpdateAsset=function(t,e){e.updateByItem(t),Ji.getStreamId$(t).pipe(r.filter((function(t){return null!==t})),r.take(1)).subscribe((function(n){t.streamId=n,e.load((function(){}))}))},n.onDragMove=function(t,e,n){var r=this.item,i=this.mesh;r.showPanel=!1,this.editing=!0,n?(t.normalize().multiplyScalar(20),i.position.set(t.x,t.y,t.z),i.lookAt(gi.origin)):(i.position.set(0,0,0),i.lookAt(e),i.position.set(t.x,t.y,t.z),i.position.add(e.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var t=this.item,e=this.mesh;t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray(),e.updateFromItem(t),this.editing=!1},e}(rc);Ml.textures={},Ml.meta={selector:"[model-plane]",hosts:{host:ec},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};var Ll=100.99,kl=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var i=n.prototype;return i.onInit=function(){var t=this;this.title_="",this.visible_=this.host.renderer.xr.isPresenting,e.prototype.onInit.call(this),(this.vrService=ko.getService()).session$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.visible=null!=e}))},i.onCreate=function(e,n){var i=this,o=t.getContext(this).node,a=o.querySelector(".inner");this.getCanvasTexture().then((function(t){var n=i.createMesh(t);"function"==typeof e&&e(n),Si.progress$.pipe(r.takeUntil(i.unsubscribe$)).subscribe((function(t){t.count>0?o.classList.add("active"):o.classList.remove("active"),a.style.width=100*t.value+"%",t.count?i.title=0===t.value?pe.transform("loading"):t.title:i.title=i.getTitle()}))}))},i.getTitle=function(){return this.view&&this.view.type.name===pr.WaitingRoom.name?pe.transform("waiting_host"):""},i.show=function(){this.mesh.add(this.banner),this.material.opacity=1,this.material.needsUpdate=!0},i.hide=function(){this.mesh.remove(this.banner),this.material.opacity=0,this.material.needsUpdate=!0},i.createMesh=function(t){var e=new THREE.Group,n=Math.PI/180*360,r=Ll*n,i=r/360*2.4,o=r/(t.width*i/t.height),a=new THREE.CylinderBufferGeometry(Ll,Ll,i,80,2,!0,0,n);a.scale(-1,1,1);var s=t.texture;s.wrapS=s.wrapY=THREE.RepeatWrapping,s.repeat.x=o,s.encoding=THREE.sRGBEncoding;var c=this.material=new THREE.MeshBasicMaterial({map:s,transparent:!0,opacity:0});this.banner=new THREE.Mesh(a,c);return e.userData={render:function(){e.rotation.y+=Math.PI/180*.02}},e},i.updateProgress=function(){var t=this;this.getCanvasTexture().then((function(e){var n=Math.PI/180*360,r=Ll*n,i=r/360*2.4,o=r/(e.width*i/e.height);t.texture.repeat.x=o}))},i.getCanvasTexture=function(){var t=this;return new Promise((function(e,n){var r,i=512,o=64,a=Math.floor(48),s=Math.floor(3.2);(r=t.canvas?t.canvas:t.canvas=document.createElement("canvas")).width=i,r.height=o;var c,u=t.title_,l=r.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.font="300 "+a+"px "+de.fontFamily,i=l.measureText(u).width+8,i=Math.max(512,Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))),r.width=i,l.clearRect(0,0,i,o),l.fillStyle="#0000005A",l.fillRect(0,0,i,o),l.font="300 "+a+"px "+de.fontFamily,l.textAlign="center",l.textBaseline="middle",l.strokeStyle="rgba(0, 0, 0, 0.35)",l.lineWidth=s,l.lineJoin="round",l.miterLimit=2,l.strokeText(u,i/2,32),l.fillStyle="white",l.fillText(u,i/2,32,i),t.texture?(c=t.texture).needsUpdate=!0:c=t.texture=new THREE.CanvasTexture(r),e({texture:c,width:i,height:o})}))},c(n,[{key:"title",get:function(){return this.title_},set:function(t){this.title_!==t&&(this.title_=t,t===pe.transform("waiting_host")||""!==t&&this.visible_?(this.updateProgress(),this.show()):this.hide())}},{key:"visible",get:function(){return this.visible_},set:function(t){this.visible_!==t&&(this.visible_=t,t&&""!==this.title_?(this.updateProgress(),this.show()):this.hide())}}]),n}(nc);kl.meta={selector:"[model-progress]",hosts:{host:ec},inputs:["view"]};var Bl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){var e=this;t.prototype.onInit.call(this),this.isPresenting=!1,qc.active$.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.freezed=t}))},n.onChanges=function(){this.editing=this.view.selected},n.onCreate=function(t,e){var n=this;this.loadGlb(de.getPath(this.view.asset.folder),this.view.asset.file,(function(r,i){n.onGlbLoaded(r,i,t,e)}))},n.loadGlb=function(t,e,n){this.host.renderer;var r=Si.getRef(),i=(new qa).setPath(t),o=de.dist+"js/draco/",a=new Tl;a.setDecoderPath(o),i.setDRACOLoader(a),i.load(e,(function(t){"function"==typeof n&&n(t.scene,t.animations),Si.setProgress(r,1)}),(function(t){Si.setProgress(r,t.loaded,t.total)}))},n.onGlbLoaded=function(t,e,n,r){var i=this,o=this.view;t.position.set(0,-1.76,0);var a,s=[];t.traverse((function(t){t.isMesh&&s.push(t),"nav"===t.name&&(o.navIntersectObjects=[t],i.makeTransparent(t))})),o.intersectObjects=s,(a=new THREE.Group).add(t),"function"==typeof n&&n(a,this.view)},n.makeTransparent=function(t){t.isMesh&&(t.material=e.transparentMaterial),t.traverse((function(t){t.isMesh&&(t.material=e.transparentMaterial)}))},n.onUpdateAsset=function(t,e){var n=this;this.loadGlb(de.getPath(t.asset.folder),t.asset.file,(function(t,e){n.onGlbLoaded(t,e,(function(t,e){return n.onMount(t,e)}),(function(t,e){return n.onDismount(t,e)}))}))},c(e,[{key:"freezed",get:function(){return this.freezed_},set:function(t){if(this.freezed_!==t){this.freezed_=t;var e=this.mesh;e&&e.traverse((function(e){e.isInteractiveMesh&&(e.freezed=t)}))}}}],[{key:"transparentMaterial",get:function(){return this.transparentMaterial_||(this.transparentMaterial_=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:0})),this.transparentMaterial_}}]),e}(nc);Bl.meta={selector:"[model-room]",hosts:{host:ec},inputs:["view"]};var Nl=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var n=e.prototype;return n.onInit=function(){t.prototype.onInit.call(this)},n.onCreate=function(t,e){var n=new THREE.Group;"function"==typeof t&&t(n)},e}(nc);Nl.meta={selector:"[model-text]",hosts:{host:ec},inputs:["item"]},Qt.useBrowser(Mc);var Pl=function(t){function e(){return t.apply(this,arguments)||this}return d(e,t),e}(t.Module);return Pl.meta={imports:[t.CoreModule,e.FormModule,vu],declarations:[$t,In,qn,Mn,Wn,nr,hc,er,or,ir,lr,dr,hr,fr,Uc,Xc,Tu,Cu,xu,Ru,Iu,Jc,Ou,Mu,Lu,Dc,he,ku,Nu,Bu,Pu,Uu,Fc,jc,Vc,gu,Du,Au,nl,Vu,mu,Gu,Fu,pe,Qu,Ic,Wu,ul,Ku,Xu,Vr,dl,nc,hl,pl,vl,Al,xl,dc,Il,Ol,Ml,kl,Bl,Nl,Yu,me,$u,Zu,Hu,tl,Oc,Gr,el,ju,cl,ec,Yt,Ju],bootstrap:Lc},function(){function e(t,e){"object"==typeof window&&(e&&de.merge(e),this.bootstrap(t),console.log("BHere",t,e)),this.environment=de}return e.prototype.bootstrap=function(e){"string"==typeof e&&(e=document.querySelector(e)),e||((e=document.createElement("div")).setAttribute("b-here",""),document.body.appendChild(e)),e.innerHTML='<div class="b-here hidden" b-here-component></div>',this.target=e,t.Browser.bootstrap(Pl)},e}()}(rxcomp,rxcomp.form,rxjs,rxjs.operators,html2canvas);
//# sourceMappingURL=bhere.min.js.map